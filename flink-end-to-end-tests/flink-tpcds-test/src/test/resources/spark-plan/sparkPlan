read query: spark_queries/q1.sql
explain query: q1
== Parsed Logical Plan ==
CTE [customer_total_return]
:  +- 'SubqueryAlias customer_total_return
:     +- 'Aggregate ['sr_customer_sk, 'sr_store_sk], ['sr_customer_sk AS ctr_customer_sk#1861, 'sr_store_sk AS ctr_store_sk#1862, 'sum('sr_fee) AS ctr_total_return#1863]
:        +- 'Filter (('sr_returned_date_sk = 'd_date_sk) AND ('d_year = 2000))
:           +- 'Join Inner
:              :- 'UnresolvedRelation [store_returns], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['c_customer_id ASC NULLS FIRST], true
         +- 'Project ['c_customer_id]
            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#1860 []) AND ('s_store_sk = 'ctr1.ctr_store_sk)) AND (('s_state = NM) AND ('ctr1.ctr_customer_sk = 'c_customer_sk)))
               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]
               :     +- 'Filter ('ctr1.ctr_store_sk = 'ctr2.ctr_store_sk)
               :        +- 'SubqueryAlias ctr2
               :           +- 'UnresolvedRelation [customer_total_return], [], false
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'SubqueryAlias ctr1
                  :  :  +- 'UnresolvedRelation [customer_total_return], [], false
                  :  +- 'UnresolvedRelation [store], [], false
                  +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_customer_id: string
WithCTE
:- CTERelationDef 0
:  +- SubqueryAlias customer_total_return
:     +- Aggregate [sr_customer_sk#1866L, sr_store_sk#1870L], [sr_customer_sk#1866L AS ctr_customer_sk#1861L, sr_store_sk#1870L AS ctr_store_sk#1862L, sum(sr_fee#1877) AS ctr_total_return#1863]
:        +- Filter ((sr_returned_date_sk#1883L = d_date_sk#1884L) AND (d_year#1890 = 2000))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#1864L,sr_item_sk#1865L,sr_customer_sk#1866L,sr_cdemo_sk#1867L,sr_hdemo_sk#1868L,sr_addr_sk#1869L,sr_store_sk#1870L,sr_reason_sk#1871L,sr_ticket_number#1872L,sr_return_quantity#1873,sr_return_amt#1874,sr_return_tax#1875,sr_return_amt_inc_tax#1876,sr_fee#1877,sr_return_ship_cost#1878,sr_refunded_cash#1879,sr_reversed_charge#1880,sr_store_credit#1881,sr_net_loss#1882,sr_returned_date_sk#1883L] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_date_id#1885,d_date#1886,d_month_seq#1887,d_week_seq#1888,d_quarter_seq#1889,d_year#1890,d_dow#1891,d_moy#1892,d_dom#1893,d_qoy#1894,d_fy_year#1895,d_fy_quarter_seq#1896,d_fy_week_seq#1897,d_day_name#1898,d_quarter_name#1899,d_holiday#1900,d_weekend#1901,d_following_holiday#1902,d_first_dom#1903,d_last_dom#1904,d_same_day_ly#1905,d_same_day_lq#1906,d_current_day#1907,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [c_customer_id#1942 ASC NULLS FIRST], true
         +- Project [c_customer_id#1942]
            +- Filter (((ctr_total_return#1863 > scalar-subquery#1860 [ctr_store_sk#1862L]) AND (s_store_sk#1912L = ctr_store_sk#1862L)) AND ((s_state#1936 = NM) AND (ctr_customer_sk#1861L = c_customer_sk#1941L)))
               :  +- Aggregate [(avg(ctr_total_return#1863) * cast(1.2 as double)) AS (avg(ctr_total_return) * 1.2)#1961]
               :     +- Filter (outer(ctr_store_sk#1862L) = ctr_store_sk#1862L)
               :        +- SubqueryAlias ctr2
               :           +- SubqueryAlias customer_total_return
               :              +- CTERelationRef 0, true, [ctr_customer_sk#1861L, ctr_store_sk#1862L, ctr_total_return#1863]
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias ctr1
                  :  :  +- SubqueryAlias customer_total_return
                  :  :     +- CTERelationRef 0, true, [ctr_customer_sk#1861L, ctr_store_sk#1862L, ctr_total_return#1863]
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#1912L,s_store_id#1913,s_rec_start_date#1914,s_rec_end_date#1915,s_closed_date_sk#1916L,s_store_name#1917,s_number_employees#1918,s_floor_space#1919,s_hours#1920,s_manager#1921,s_market_id#1922,s_geography_class#1923,s_market_desc#1924,s_market_manager#1925,s_division_id#1926,s_division_name#1927,s_company_id#1928,s_company_name#1929,s_street_number#1930,s_street_name#1931,s_street_type#1932,s_suite_number#1933,s_city#1934,s_county#1935,... 5 more fields] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#1941L,c_customer_id#1942,c_current_cdemo_sk#1943L,c_current_hdemo_sk#1944L,c_current_addr_sk#1945L,c_first_shipto_date_sk#1946L,c_first_sales_date_sk#1947L,c_salutation#1948,c_first_name#1949,c_last_name#1950,c_preferred_cust_flag#1951,c_birth_day#1952,c_birth_month#1953,c_birth_year#1954,c_birth_country#1955,c_login#1956,c_email_address#1957,c_last_review_date#1958] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_customer_id#1942 ASC NULLS FIRST], true
      +- Project [c_customer_id#1942]
         +- Join Inner, (ctr_customer_sk#1861L = c_customer_sk#1941L)
            :- Project [ctr_customer_sk#1861L]
            :  +- Join Inner, ((ctr_total_return#1863 > (avg(ctr_total_return) * 1.2)#1961) AND (ctr_store_sk#1862L = ctr_store_sk#1862L#1963L))
            :     :- Project [ctr_customer_sk#1861L, ctr_store_sk#1862L, ctr_total_return#1863]
            :     :  +- Join Inner, (s_store_sk#1912L = ctr_store_sk#1862L)
            :     :     :- Filter isnotnull(ctr_total_return#1863)
            :     :     :  +- Aggregate [sr_customer_sk#1866L, sr_store_sk#1870L], [sr_customer_sk#1866L AS ctr_customer_sk#1861L, sr_store_sk#1870L AS ctr_store_sk#1862L, sum(sr_fee#1877) AS ctr_total_return#1863]
            :     :     :     +- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877]
            :     :     :        +- Join Inner, (sr_returned_date_sk#1883L = d_date_sk#1884L)
            :     :     :           :- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877, sr_returned_date_sk#1883L]
            :     :     :           :  +- Filter (((isnotnull(sr_returned_date_sk#1883L) AND isnotnull(sr_store_sk#1870L)) AND isnotnull(sr_customer_sk#1866L)) AND dynamicpruning#1964 [sr_returned_date_sk#1883L])
            :     :     :           :     :  +- Project [d_date_sk#1884L]
            :     :     :           :     :     +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
            :     :     :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_date_id#1885,d_date#1886,d_month_seq#1887,d_week_seq#1888,d_quarter_seq#1889,d_year#1890,d_dow#1891,d_moy#1892,d_dom#1893,d_qoy#1894,d_fy_year#1895,d_fy_quarter_seq#1896,d_fy_week_seq#1897,d_day_name#1898,d_quarter_name#1899,d_holiday#1900,d_weekend#1901,d_following_holiday#1902,d_first_dom#1903,d_last_dom#1904,d_same_day_ly#1905,d_same_day_lq#1906,d_current_day#1907,... 4 more fields] orc
            :     :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#1864L,sr_item_sk#1865L,sr_customer_sk#1866L,sr_cdemo_sk#1867L,sr_hdemo_sk#1868L,sr_addr_sk#1869L,sr_store_sk#1870L,sr_reason_sk#1871L,sr_ticket_number#1872L,sr_return_quantity#1873,sr_return_amt#1874,sr_return_tax#1875,sr_return_amt_inc_tax#1876,sr_fee#1877,sr_return_ship_cost#1878,sr_refunded_cash#1879,sr_reversed_charge#1880,sr_store_credit#1881,sr_net_loss#1882,sr_returned_date_sk#1883L] orc
            :     :     :           +- Project [d_date_sk#1884L]
            :     :     :              +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
            :     :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_date_id#1885,d_date#1886,d_month_seq#1887,d_week_seq#1888,d_quarter_seq#1889,d_year#1890,d_dow#1891,d_moy#1892,d_dom#1893,d_qoy#1894,d_fy_year#1895,d_fy_quarter_seq#1896,d_fy_week_seq#1897,d_day_name#1898,d_quarter_name#1899,d_holiday#1900,d_weekend#1901,d_following_holiday#1902,d_first_dom#1903,d_last_dom#1904,d_same_day_ly#1905,d_same_day_lq#1906,d_current_day#1907,... 4 more fields] orc
            :     :     +- Project [s_store_sk#1912L]
            :     :        +- Filter ((isnotnull(s_state#1936) AND (s_state#1936 = NM)) AND isnotnull(s_store_sk#1912L))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#1912L,s_store_id#1913,s_rec_start_date#1914,s_rec_end_date#1915,s_closed_date_sk#1916L,s_store_name#1917,s_number_employees#1918,s_floor_space#1919,s_hours#1920,s_manager#1921,s_market_id#1922,s_geography_class#1923,s_market_desc#1924,s_market_manager#1925,s_division_id#1926,s_division_name#1927,s_company_id#1928,s_company_name#1929,s_street_number#1930,s_street_name#1931,s_street_type#1932,s_suite_number#1933,s_city#1934,s_county#1935,... 5 more fields] orc
            :     +- Filter isnotnull((avg(ctr_total_return) * 1.2)#1961)
            :        +- Aggregate [ctr_store_sk#1862L], [(avg(ctr_total_return#1863) * 1.2) AS (avg(ctr_total_return) * 1.2)#1961, ctr_store_sk#1862L AS ctr_store_sk#1862L#1963L]
            :           +- Aggregate [sr_customer_sk#1866L, sr_store_sk#1870L], [sr_store_sk#1870L AS ctr_store_sk#1862L, sum(sr_fee#1877) AS ctr_total_return#1863]
            :              +- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877]
            :                 +- Join Inner, (sr_returned_date_sk#1883L = d_date_sk#1884L)
            :                    :- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877, sr_returned_date_sk#1883L]
            :                    :  +- Filter ((isnotnull(sr_returned_date_sk#1883L) AND isnotnull(sr_store_sk#1870L)) AND dynamicpruning#1965 [sr_returned_date_sk#1883L])
            :                    :     :  +- Project [d_date_sk#1884L]
            :                    :     :     +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
            :                    :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_date_id#1885,d_date#1886,d_month_seq#1887,d_week_seq#1888,d_quarter_seq#1889,d_year#1890,d_dow#1891,d_moy#1892,d_dom#1893,d_qoy#1894,d_fy_year#1895,d_fy_quarter_seq#1896,d_fy_week_seq#1897,d_day_name#1898,d_quarter_name#1899,d_holiday#1900,d_weekend#1901,d_following_holiday#1902,d_first_dom#1903,d_last_dom#1904,d_same_day_ly#1905,d_same_day_lq#1906,d_current_day#1907,... 4 more fields] orc
            :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#1864L,sr_item_sk#1865L,sr_customer_sk#1866L,sr_cdemo_sk#1867L,sr_hdemo_sk#1868L,sr_addr_sk#1869L,sr_store_sk#1870L,sr_reason_sk#1871L,sr_ticket_number#1872L,sr_return_quantity#1873,sr_return_amt#1874,sr_return_tax#1875,sr_return_amt_inc_tax#1876,sr_fee#1877,sr_return_ship_cost#1878,sr_refunded_cash#1879,sr_reversed_charge#1880,sr_store_credit#1881,sr_net_loss#1882,sr_returned_date_sk#1883L] orc
            :                    +- Project [d_date_sk#1884L]
            :                       +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_date_id#1885,d_date#1886,d_month_seq#1887,d_week_seq#1888,d_quarter_seq#1889,d_year#1890,d_dow#1891,d_moy#1892,d_dom#1893,d_qoy#1894,d_fy_year#1895,d_fy_quarter_seq#1896,d_fy_week_seq#1897,d_day_name#1898,d_quarter_name#1899,d_holiday#1900,d_weekend#1901,d_following_holiday#1902,d_first_dom#1903,d_last_dom#1904,d_same_day_ly#1905,d_same_day_lq#1906,d_current_day#1907,... 4 more fields] orc
            +- Project [c_customer_sk#1941L, c_customer_id#1942]
               +- Filter isnotnull(c_customer_sk#1941L)
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#1941L,c_customer_id#1942,c_current_cdemo_sk#1943L,c_current_hdemo_sk#1944L,c_current_addr_sk#1945L,c_first_shipto_date_sk#1946L,c_first_sales_date_sk#1947L,c_salutation#1948,c_first_name#1949,c_last_name#1950,c_preferred_cust_flag#1951,c_birth_day#1952,c_birth_month#1953,c_birth_year#1954,c_birth_country#1955,c_login#1956,c_email_address#1957,c_last_review_date#1958] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_customer_id#1942 ASC NULLS FIRST], output=[c_customer_id#1942])
   +- Project [c_customer_id#1942]
      +- SortMergeJoin [ctr_customer_sk#1861L], [c_customer_sk#1941L], Inner
         :- Sort [ctr_customer_sk#1861L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(ctr_customer_sk#1861L, 3000), ENSURE_REQUIREMENTS, [id=#1145]
         :     +- Project [ctr_customer_sk#1861L]
         :        +- BroadcastHashJoin [ctr_store_sk#1862L], [ctr_store_sk#1862L#1963L], Inner, BuildRight, (ctr_total_return#1863 > (avg(ctr_total_return) * 1.2)#1961), false
         :           :- Project [ctr_customer_sk#1861L, ctr_store_sk#1862L, ctr_total_return#1863]
         :           :  +- BroadcastHashJoin [ctr_store_sk#1862L], [s_store_sk#1912L], Inner, BuildRight, false
         :           :     :- Filter isnotnull(ctr_total_return#1863)
         :           :     :  +- HashAggregate(keys=[sr_customer_sk#1866L, sr_store_sk#1870L], functions=[sum(sr_fee#1877)], output=[ctr_customer_sk#1861L, ctr_store_sk#1862L, ctr_total_return#1863])
         :           :     :     +- Exchange hashpartitioning(sr_customer_sk#1866L, sr_store_sk#1870L, 3000), ENSURE_REQUIREMENTS, [id=#1120]
         :           :     :        +- HashAggregate(keys=[sr_customer_sk#1866L, sr_store_sk#1870L], functions=[partial_sum(sr_fee#1877)], output=[sr_customer_sk#1866L, sr_store_sk#1870L, sum#1967])
         :           :     :           +- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877]
         :           :     :              +- BroadcastHashJoin [sr_returned_date_sk#1883L], [d_date_sk#1884L], Inner, BuildRight, false
         :           :     :                 :- Filter (isnotnull(sr_store_sk#1870L) AND isnotnull(sr_customer_sk#1866L))
         :           :     :                 :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_customer_sk#1866L,sr_store_sk#1870L,sr_fee#1877,sr_returned_date_sk#1883L] Batched: true, DataFilters: [isnotnull(sr_store_sk#1870L), isnotnull(sr_customer_sk#1866L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#1883L), dynamicpruningexpression(sr_returned_date_sk#1883L IN dyna..., PushedFilters: [IsNotNull(sr_store_sk), IsNotNull(sr_customer_sk)], ReadSchema: struct<sr_customer_sk:bigint,sr_store_sk:bigint,sr_fee:double>
         :           :     :                 :        +- SubqueryAdaptiveBroadcast dynamicpruning#1964, 0, true, Project [d_date_sk#1884L], [d_date_sk#1884L]
         :           :     :                 :           +- AdaptiveSparkPlan isFinalPlan=false
         :           :     :                 :              +- Project [d_date_sk#1884L]
         :           :     :                 :                 +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
         :           :     :                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_year#1890] Batched: true, DataFilters: [isnotnull(d_year#1890), (d_year#1890 = 2000), isnotnull(d_date_sk#1884L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :           :     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#1115]
         :           :     :                    +- Project [d_date_sk#1884L]
         :           :     :                       +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
         :           :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_year#1890] Batched: true, DataFilters: [isnotnull(d_year#1890), (d_year#1890 = 2000), isnotnull(d_date_sk#1884L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#1124]
         :           :        +- Project [s_store_sk#1912L]
         :           :           +- Filter ((isnotnull(s_state#1936) AND (s_state#1936 = NM)) AND isnotnull(s_store_sk#1912L))
         :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#1912L,s_state#1936] Batched: true, DataFilters: [isnotnull(s_state#1936), (s_state#1936 = NM), isnotnull(s_store_sk#1912L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_state), EqualTo(s_state,NM), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_state:string>
         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, bigint, true]),false), [id=#1140]
         :              +- Filter isnotnull((avg(ctr_total_return) * 1.2)#1961)
         :                 +- HashAggregate(keys=[ctr_store_sk#1862L], functions=[avg(ctr_total_return#1863)], output=[(avg(ctr_total_return) * 1.2)#1961, ctr_store_sk#1862L#1963L])
         :                    +- Exchange hashpartitioning(ctr_store_sk#1862L, 3000), ENSURE_REQUIREMENTS, [id=#1136]
         :                       +- HashAggregate(keys=[ctr_store_sk#1862L], functions=[partial_avg(ctr_total_return#1863)], output=[ctr_store_sk#1862L, sum#1970, count#1971L])
         :                          +- HashAggregate(keys=[sr_customer_sk#1866L, sr_store_sk#1870L], functions=[sum(sr_fee#1877)], output=[ctr_store_sk#1862L, ctr_total_return#1863])
         :                             +- Exchange hashpartitioning(sr_customer_sk#1866L, sr_store_sk#1870L, 3000), ENSURE_REQUIREMENTS, [id=#1132]
         :                                +- HashAggregate(keys=[sr_customer_sk#1866L, sr_store_sk#1870L], functions=[partial_sum(sr_fee#1877)], output=[sr_customer_sk#1866L, sr_store_sk#1870L, sum#1967])
         :                                   +- Project [sr_customer_sk#1866L, sr_store_sk#1870L, sr_fee#1877]
         :                                      +- BroadcastHashJoin [sr_returned_date_sk#1883L], [d_date_sk#1884L], Inner, BuildRight, false
         :                                         :- Filter isnotnull(sr_store_sk#1870L)
         :                                         :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_customer_sk#1866L,sr_store_sk#1870L,sr_fee#1877,sr_returned_date_sk#1883L] Batched: true, DataFilters: [isnotnull(sr_store_sk#1870L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#1883L), dynamicpruningexpression(sr_returned_date_sk#1883L IN dyna..., PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_customer_sk:bigint,sr_store_sk:bigint,sr_fee:double>
         :                                         :        +- SubqueryAdaptiveBroadcast dynamicpruning#1965, 0, true, Project [d_date_sk#1884L], [d_date_sk#1884L]
         :                                         :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                         :              +- Project [d_date_sk#1884L]
         :                                         :                 +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
         :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_year#1890] Batched: true, DataFilters: [isnotnull(d_year#1890), (d_year#1890 = 2000), isnotnull(d_date_sk#1884L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                         +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#1127]
         :                                            +- Project [d_date_sk#1884L]
         :                                               +- Filter ((isnotnull(d_year#1890) AND (d_year#1890 = 2000)) AND isnotnull(d_date_sk#1884L))
         :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#1884L,d_year#1890] Batched: true, DataFilters: [isnotnull(d_year#1890), (d_year#1890 = 2000), isnotnull(d_date_sk#1884L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         +- Sort [c_customer_sk#1941L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(c_customer_sk#1941L, 3000), ENSURE_REQUIREMENTS, [id=#1146]
               +- Filter isnotnull(c_customer_sk#1941L)
                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#1941L,c_customer_id#1942] Batched: true, DataFilters: [isnotnull(c_customer_sk#1941L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string>

read query: spark_queries/q2.sql
explain query: q2
== Parsed Logical Plan ==
CTE [wscs, wswscs]
:  :- 'SubqueryAlias wscs
:  :  +- 'Union false, false
:  :     :- 'Project ['sold_date_sk, 'sales_price]
:  :     :  +- 'SubqueryAlias x
:  :     :     +- 'Project ['ws_sold_date_sk AS sold_date_sk#1988, 'ws_ext_sales_price AS sales_price#1989]
:  :     :        +- 'UnresolvedRelation [web_sales], [], false
:  :     +- 'Project ['cs_sold_date_sk AS sold_date_sk#1990, 'cs_ext_sales_price AS sales_price#1991]
:  :        +- 'UnresolvedRelation [catalog_sales], [], false
:  +- 'SubqueryAlias wswscs
:     +- 'Aggregate ['d_week_seq], ['d_week_seq, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'sales_price ELSE null END) AS sun_sales#1992, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'sales_price ELSE null END) AS mon_sales#1993, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'sales_price ELSE null END) AS tue_sales#1994, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'sales_price ELSE null END) AS wed_sales#1995, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'sales_price ELSE null END) AS thu_sales#1996, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'sales_price ELSE null END) AS fri_sales#1997, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'sales_price ELSE null END) AS sat_sales#1998]
:        +- 'Filter ('d_date_sk = 'sold_date_sk)
:           +- 'Join Inner
:              :- 'UnresolvedRelation [wscs], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'Sort ['d_week_seq1 ASC NULLS FIRST], true
   +- 'Project ['d_week_seq1, unresolvedalias('round(('sun_sales1 / 'sun_sales2), 2), None), unresolvedalias('round(('mon_sales1 / 'mon_sales2), 2), None), unresolvedalias('round(('tue_sales1 / 'tue_sales2), 2), None), unresolvedalias('round(('wed_sales1 / 'wed_sales2), 2), None), unresolvedalias('round(('thu_sales1 / 'thu_sales2), 2), None), unresolvedalias('round(('fri_sales1 / 'fri_sales2), 2), None), unresolvedalias('round(('sat_sales1 / 'sat_sales2), 2), None)]
      +- 'Filter ('d_week_seq1 = ('d_week_seq2 - 53))
         +- 'Join Inner
            :- 'SubqueryAlias y
            :  +- 'Project ['wswscs.d_week_seq AS d_week_seq1#1972, 'sun_sales AS sun_sales1#1973, 'mon_sales AS mon_sales1#1974, 'tue_sales AS tue_sales1#1975, 'wed_sales AS wed_sales1#1976, 'thu_sales AS thu_sales1#1977, 'fri_sales AS fri_sales1#1978, 'sat_sales AS sat_sales1#1979]
            :     +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) AND ('d_year = 2001))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [wswscs], [], false
            :           +- 'UnresolvedRelation [date_dim], [], false
            +- 'SubqueryAlias z
               +- 'Project ['wswscs.d_week_seq AS d_week_seq2#1980, 'sun_sales AS sun_sales2#1981, 'mon_sales AS mon_sales2#1982, 'tue_sales AS tue_sales2#1983, 'wed_sales AS wed_sales2#1984, 'thu_sales AS thu_sales2#1985, 'fri_sales AS fri_sales2#1986, 'sat_sales AS sat_sales2#1987]
                  +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) AND ('d_year = (2001 + 1)))
                     +- 'Join Inner
                        :- 'UnresolvedRelation [wswscs], [], false
                        +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
d_week_seq1: int, round((sun_sales1 / sun_sales2), 2): double, round((mon_sales1 / mon_sales2), 2): double, round((tue_sales1 / tue_sales2), 2): double, round((wed_sales1 / wed_sales2), 2): double, round((thu_sales1 / thu_sales2), 2): double, round((fri_sales1 / fri_sales2), 2): double, round((sat_sales1 / sat_sales2), 2): double
WithCTE
:- CTERelationDef 1
:  +- SubqueryAlias wscs
:     +- Union false, false
:        :- Project [sold_date_sk#1988L, sales_price#1989]
:        :  +- SubqueryAlias x
:        :     +- Project [ws_sold_date_sk#2032L AS sold_date_sk#1988L, ws_ext_sales_price#2021 AS sales_price#1989]
:        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#1999L,ws_ship_date_sk#2000L,ws_item_sk#2001L,ws_bill_customer_sk#2002L,ws_bill_cdemo_sk#2003L,ws_bill_hdemo_sk#2004L,ws_bill_addr_sk#2005L,ws_ship_customer_sk#2006L,ws_ship_cdemo_sk#2007L,ws_ship_hdemo_sk#2008L,ws_ship_addr_sk#2009L,ws_web_page_sk#2010L,ws_web_site_sk#2011L,ws_ship_mode_sk#2012L,ws_warehouse_sk#2013L,ws_promo_sk#2014L,ws_order_number#2015L,ws_quantity#2016,ws_wholesale_cost#2017,ws_list_price#2018,ws_sales_price#2019,ws_ext_discount_amt#2020,ws_ext_sales_price#2021,ws_ext_wholesale_cost#2022,... 10 more fields] orc
:        +- Project [cs_sold_date_sk#2066L AS sold_date_sk#1990L, cs_ext_sales_price#2055 AS sales_price#1991]
:           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#2033L,cs_ship_date_sk#2034L,cs_bill_customer_sk#2035L,cs_bill_cdemo_sk#2036L,cs_bill_hdemo_sk#2037L,cs_bill_addr_sk#2038L,cs_ship_customer_sk#2039L,cs_ship_cdemo_sk#2040L,cs_ship_hdemo_sk#2041L,cs_ship_addr_sk#2042L,cs_call_center_sk#2043L,cs_catalog_page_sk#2044L,cs_ship_mode_sk#2045L,cs_warehouse_sk#2046L,cs_item_sk#2047L,cs_promo_sk#2048L,cs_order_number#2049L,cs_quantity#2050,cs_wholesale_cost#2051,cs_list_price#2052,cs_sales_price#2053,cs_ext_discount_amt#2054,cs_ext_sales_price#2055,cs_ext_wholesale_cost#2056,... 10 more fields] orc
:- CTERelationDef 2
:  +- SubqueryAlias wswscs
:     +- Aggregate [d_week_seq#2071], [d_week_seq#2071, sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 ELSE cast(null as double) END) AS sun_sales#1992, sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 ELSE cast(null as double) END) AS mon_sales#1993, sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 ELSE cast(null as double) END) AS tue_sales#1994, sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 ELSE cast(null as double) END) AS wed_sales#1995, sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 ELSE cast(null as double) END) AS thu_sales#1996, sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 ELSE cast(null as double) END) AS fri_sales#1997, sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 ELSE cast(null as double) END) AS sat_sales#1998]
:        +- Filter (d_date_sk#2067L = sold_date_sk#1988L)
:           +- Join Inner
:              :- SubqueryAlias wscs
:              :  +- CTERelationRef 1, true, [sold_date_sk#1988L, sales_price#1989]
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2067L,d_date_id#2068,d_date#2069,d_month_seq#2070,d_week_seq#2071,d_quarter_seq#2072,d_year#2073,d_dow#2074,d_moy#2075,d_dom#2076,d_qoy#2077,d_fy_year#2078,d_fy_quarter_seq#2079,d_fy_week_seq#2080,d_day_name#2081,d_quarter_name#2082,d_holiday#2083,d_weekend#2084,d_following_holiday#2085,d_first_dom#2086,d_last_dom#2087,d_same_day_ly#2088,d_same_day_lq#2089,d_current_day#2090,... 4 more fields] orc
+- Sort [d_week_seq1#1972 ASC NULLS FIRST], true
   +- Project [d_week_seq1#1972, round((sun_sales1#1973 / sun_sales2#1981), 2) AS round((sun_sales1 / sun_sales2), 2)#2158, round((mon_sales1#1974 / mon_sales2#1982), 2) AS round((mon_sales1 / mon_sales2), 2)#2159, round((tue_sales1#1975 / tue_sales2#1983), 2) AS round((tue_sales1 / tue_sales2), 2)#2160, round((wed_sales1#1976 / wed_sales2#1984), 2) AS round((wed_sales1 / wed_sales2), 2)#2161, round((thu_sales1#1977 / thu_sales2#1985), 2) AS round((thu_sales1 / thu_sales2), 2)#2162, round((fri_sales1#1978 / fri_sales2#1986), 2) AS round((fri_sales1 / fri_sales2), 2)#2163, round((sat_sales1#1979 / sat_sales2#1987), 2) AS round((sat_sales1 / sat_sales2), 2)#2164]
      +- Filter (d_week_seq1#1972 = (d_week_seq2#1980 - 53))
         +- Join Inner
            :- SubqueryAlias y
            :  +- Project [d_week_seq#2071 AS d_week_seq1#1972, sun_sales#1992 AS sun_sales1#1973, mon_sales#1993 AS mon_sales1#1974, tue_sales#1994 AS tue_sales1#1975, wed_sales#1995 AS wed_sales1#1976, thu_sales#1996 AS thu_sales1#1977, fri_sales#1997 AS fri_sales1#1978, sat_sales#1998 AS sat_sales1#1979]
            :     +- Filter ((d_week_seq#2099 = d_week_seq#2071) AND (d_year#2101 = 2001))
            :        +- Join Inner
            :           :- SubqueryAlias wswscs
            :           :  +- CTERelationRef 2, true, [d_week_seq#2071, sun_sales#1992, mon_sales#1993, tue_sales#1994, wed_sales#1995, thu_sales#1996, fri_sales#1997, sat_sales#1998]
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2095L,d_date_id#2096,d_date#2097,d_month_seq#2098,d_week_seq#2099,d_quarter_seq#2100,d_year#2101,d_dow#2102,d_moy#2103,d_dom#2104,d_qoy#2105,d_fy_year#2106,d_fy_quarter_seq#2107,d_fy_week_seq#2108,d_day_name#2109,d_quarter_name#2110,d_holiday#2111,d_weekend#2112,d_following_holiday#2113,d_first_dom#2114,d_last_dom#2115,d_same_day_ly#2116,d_same_day_lq#2117,d_current_day#2118,... 4 more fields] orc
            +- SubqueryAlias z
               +- Project [d_week_seq#2071 AS d_week_seq2#1980, sun_sales#1992 AS sun_sales2#1981, mon_sales#1993 AS mon_sales2#1982, tue_sales#1994 AS tue_sales2#1983, wed_sales#1995 AS wed_sales2#1984, thu_sales#1996 AS thu_sales2#1985, fri_sales#1997 AS fri_sales2#1986, sat_sales#1998 AS sat_sales2#1987]
                  +- Filter ((d_week_seq#2127 = d_week_seq#2071) AND (d_year#2129 = (2001 + 1)))
                     +- Join Inner
                        :- SubqueryAlias wswscs
                        :  +- CTERelationRef 2, true, [d_week_seq#2071, sun_sales#1992, mon_sales#1993, tue_sales#1994, wed_sales#1995, thu_sales#1996, fri_sales#1997, sat_sales#1998]
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2123L,d_date_id#2124,d_date#2125,d_month_seq#2126,d_week_seq#2127,d_quarter_seq#2128,d_year#2129,d_dow#2130,d_moy#2131,d_dom#2132,d_qoy#2133,d_fy_year#2134,d_fy_quarter_seq#2135,d_fy_week_seq#2136,d_day_name#2137,d_quarter_name#2138,d_holiday#2139,d_weekend#2140,d_following_holiday#2141,d_first_dom#2142,d_last_dom#2143,d_same_day_ly#2144,d_same_day_lq#2145,d_current_day#2146,... 4 more fields] orc

== Optimized Logical Plan ==
Sort [d_week_seq1#1972 ASC NULLS FIRST], true
+- Project [d_week_seq1#1972, round((sun_sales1#1973 / sun_sales2#1981), 2) AS round((sun_sales1 / sun_sales2), 2)#2158, round((mon_sales1#1974 / mon_sales2#1982), 2) AS round((mon_sales1 / mon_sales2), 2)#2159, round((tue_sales1#1975 / tue_sales2#1983), 2) AS round((tue_sales1 / tue_sales2), 2)#2160, round((wed_sales1#1976 / wed_sales2#1984), 2) AS round((wed_sales1 / wed_sales2), 2)#2161, round((thu_sales1#1977 / thu_sales2#1985), 2) AS round((thu_sales1 / thu_sales2), 2)#2162, round((fri_sales1#1978 / fri_sales2#1986), 2) AS round((fri_sales1 / fri_sales2), 2)#2163, round((sat_sales1#1979 / sat_sales2#1987), 2) AS round((sat_sales1 / sat_sales2), 2)#2164]
   +- Join Inner, (d_week_seq1#1972 = (d_week_seq2#1980 - 53))
      :- Project [d_week_seq#2071 AS d_week_seq1#1972, sun_sales#1992 AS sun_sales1#1973, mon_sales#1993 AS mon_sales1#1974, tue_sales#1994 AS tue_sales1#1975, wed_sales#1995 AS wed_sales1#1976, thu_sales#1996 AS thu_sales1#1977, fri_sales#1997 AS fri_sales1#1978, sat_sales#1998 AS sat_sales1#1979]
      :  +- Join Inner, (d_week_seq#2099 = d_week_seq#2071)
      :     :- Aggregate [d_week_seq#2071], [d_week_seq#2071, sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END) AS sun_sales#1992, sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END) AS mon_sales#1993, sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END) AS tue_sales#1994, sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END) AS wed_sales#1995, sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END) AS thu_sales#1996, sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END) AS fri_sales#1997, sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END) AS sat_sales#1998]
      :     :  +- Project [sales_price#1989, d_week_seq#2071, d_day_name#2081]
      :     :     +- Join Inner, (d_date_sk#2067L = sold_date_sk#1988L)
      :     :        :- Union false, false
      :     :        :  :- Project [ws_sold_date_sk#2032L AS sold_date_sk#1988L, ws_ext_sales_price#2021 AS sales_price#1989]
      :     :        :  :  +- Filter isnotnull(ws_sold_date_sk#2032L)
      :     :        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#1999L,ws_ship_date_sk#2000L,ws_item_sk#2001L,ws_bill_customer_sk#2002L,ws_bill_cdemo_sk#2003L,ws_bill_hdemo_sk#2004L,ws_bill_addr_sk#2005L,ws_ship_customer_sk#2006L,ws_ship_cdemo_sk#2007L,ws_ship_hdemo_sk#2008L,ws_ship_addr_sk#2009L,ws_web_page_sk#2010L,ws_web_site_sk#2011L,ws_ship_mode_sk#2012L,ws_warehouse_sk#2013L,ws_promo_sk#2014L,ws_order_number#2015L,ws_quantity#2016,ws_wholesale_cost#2017,ws_list_price#2018,ws_sales_price#2019,ws_ext_discount_amt#2020,ws_ext_sales_price#2021,ws_ext_wholesale_cost#2022,... 10 more fields] orc
      :     :        :  +- Project [cs_sold_date_sk#2066L AS sold_date_sk#1990L, cs_ext_sales_price#2055 AS sales_price#1991]
      :     :        :     +- Filter isnotnull(cs_sold_date_sk#2066L)
      :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#2033L,cs_ship_date_sk#2034L,cs_bill_customer_sk#2035L,cs_bill_cdemo_sk#2036L,cs_bill_hdemo_sk#2037L,cs_bill_addr_sk#2038L,cs_ship_customer_sk#2039L,cs_ship_cdemo_sk#2040L,cs_ship_hdemo_sk#2041L,cs_ship_addr_sk#2042L,cs_call_center_sk#2043L,cs_catalog_page_sk#2044L,cs_ship_mode_sk#2045L,cs_warehouse_sk#2046L,cs_item_sk#2047L,cs_promo_sk#2048L,cs_order_number#2049L,cs_quantity#2050,cs_wholesale_cost#2051,cs_list_price#2052,cs_sales_price#2053,cs_ext_discount_amt#2054,cs_ext_sales_price#2055,cs_ext_wholesale_cost#2056,... 10 more fields] orc
      :     :        +- Project [d_date_sk#2067L, d_week_seq#2071, d_day_name#2081]
      :     :           +- Filter (isnotnull(d_date_sk#2067L) AND isnotnull(d_week_seq#2071))
      :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2067L,d_date_id#2068,d_date#2069,d_month_seq#2070,d_week_seq#2071,d_quarter_seq#2072,d_year#2073,d_dow#2074,d_moy#2075,d_dom#2076,d_qoy#2077,d_fy_year#2078,d_fy_quarter_seq#2079,d_fy_week_seq#2080,d_day_name#2081,d_quarter_name#2082,d_holiday#2083,d_weekend#2084,d_following_holiday#2085,d_first_dom#2086,d_last_dom#2087,d_same_day_ly#2088,d_same_day_lq#2089,d_current_day#2090,... 4 more fields] orc
      :     +- Project [d_week_seq#2099]
      :        +- Filter ((isnotnull(d_year#2101) AND (d_year#2101 = 2001)) AND isnotnull(d_week_seq#2099))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2095L,d_date_id#2096,d_date#2097,d_month_seq#2098,d_week_seq#2099,d_quarter_seq#2100,d_year#2101,d_dow#2102,d_moy#2103,d_dom#2104,d_qoy#2105,d_fy_year#2106,d_fy_quarter_seq#2107,d_fy_week_seq#2108,d_day_name#2109,d_quarter_name#2110,d_holiday#2111,d_weekend#2112,d_following_holiday#2113,d_first_dom#2114,d_last_dom#2115,d_same_day_ly#2116,d_same_day_lq#2117,d_current_day#2118,... 4 more fields] orc
      +- Project [d_week_seq#2071 AS d_week_seq2#1980, sun_sales#1992 AS sun_sales2#1981, mon_sales#1993 AS mon_sales2#1982, tue_sales#1994 AS tue_sales2#1983, wed_sales#1995 AS wed_sales2#1984, thu_sales#1996 AS thu_sales2#1985, fri_sales#1997 AS fri_sales2#1986, sat_sales#1998 AS sat_sales2#1987]
         +- Join Inner, (d_week_seq#2127 = d_week_seq#2071)
            :- Aggregate [d_week_seq#2071], [d_week_seq#2071, sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END) AS sun_sales#1992, sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END) AS mon_sales#1993, sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END) AS tue_sales#1994, sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END) AS wed_sales#1995, sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END) AS thu_sales#1996, sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END) AS fri_sales#1997, sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END) AS sat_sales#1998]
            :  +- Project [sales_price#1989, d_week_seq#2071, d_day_name#2081]
            :     +- Join Inner, (d_date_sk#2067L = sold_date_sk#1988L)
            :        :- Union false, false
            :        :  :- Project [ws_sold_date_sk#2032L AS sold_date_sk#1988L, ws_ext_sales_price#2021 AS sales_price#1989]
            :        :  :  +- Filter isnotnull(ws_sold_date_sk#2032L)
            :        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#1999L,ws_ship_date_sk#2000L,ws_item_sk#2001L,ws_bill_customer_sk#2002L,ws_bill_cdemo_sk#2003L,ws_bill_hdemo_sk#2004L,ws_bill_addr_sk#2005L,ws_ship_customer_sk#2006L,ws_ship_cdemo_sk#2007L,ws_ship_hdemo_sk#2008L,ws_ship_addr_sk#2009L,ws_web_page_sk#2010L,ws_web_site_sk#2011L,ws_ship_mode_sk#2012L,ws_warehouse_sk#2013L,ws_promo_sk#2014L,ws_order_number#2015L,ws_quantity#2016,ws_wholesale_cost#2017,ws_list_price#2018,ws_sales_price#2019,ws_ext_discount_amt#2020,ws_ext_sales_price#2021,ws_ext_wholesale_cost#2022,... 10 more fields] orc
            :        :  +- Project [cs_sold_date_sk#2066L AS sold_date_sk#1990L, cs_ext_sales_price#2055 AS sales_price#1991]
            :        :     +- Filter isnotnull(cs_sold_date_sk#2066L)
            :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#2033L,cs_ship_date_sk#2034L,cs_bill_customer_sk#2035L,cs_bill_cdemo_sk#2036L,cs_bill_hdemo_sk#2037L,cs_bill_addr_sk#2038L,cs_ship_customer_sk#2039L,cs_ship_cdemo_sk#2040L,cs_ship_hdemo_sk#2041L,cs_ship_addr_sk#2042L,cs_call_center_sk#2043L,cs_catalog_page_sk#2044L,cs_ship_mode_sk#2045L,cs_warehouse_sk#2046L,cs_item_sk#2047L,cs_promo_sk#2048L,cs_order_number#2049L,cs_quantity#2050,cs_wholesale_cost#2051,cs_list_price#2052,cs_sales_price#2053,cs_ext_discount_amt#2054,cs_ext_sales_price#2055,cs_ext_wholesale_cost#2056,... 10 more fields] orc
            :        +- Project [d_date_sk#2067L, d_week_seq#2071, d_day_name#2081]
            :           +- Filter (isnotnull(d_date_sk#2067L) AND isnotnull(d_week_seq#2071))
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2067L,d_date_id#2068,d_date#2069,d_month_seq#2070,d_week_seq#2071,d_quarter_seq#2072,d_year#2073,d_dow#2074,d_moy#2075,d_dom#2076,d_qoy#2077,d_fy_year#2078,d_fy_quarter_seq#2079,d_fy_week_seq#2080,d_day_name#2081,d_quarter_name#2082,d_holiday#2083,d_weekend#2084,d_following_holiday#2085,d_first_dom#2086,d_last_dom#2087,d_same_day_ly#2088,d_same_day_lq#2089,d_current_day#2090,... 4 more fields] orc
            +- Project [d_week_seq#2127]
               +- Filter ((isnotnull(d_year#2129) AND (d_year#2129 = 2002)) AND isnotnull(d_week_seq#2127))
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2123L,d_date_id#2124,d_date#2125,d_month_seq#2126,d_week_seq#2127,d_quarter_seq#2128,d_year#2129,d_dow#2130,d_moy#2131,d_dom#2132,d_qoy#2133,d_fy_year#2134,d_fy_quarter_seq#2135,d_fy_week_seq#2136,d_day_name#2137,d_quarter_name#2138,d_holiday#2139,d_weekend#2140,d_following_holiday#2141,d_first_dom#2142,d_last_dom#2143,d_same_day_ly#2144,d_same_day_lq#2145,d_current_day#2146,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [d_week_seq1#1972 ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(d_week_seq1#1972 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#1316]
      +- Project [d_week_seq1#1972, round((sun_sales1#1973 / sun_sales2#1981), 2) AS round((sun_sales1 / sun_sales2), 2)#2158, round((mon_sales1#1974 / mon_sales2#1982), 2) AS round((mon_sales1 / mon_sales2), 2)#2159, round((tue_sales1#1975 / tue_sales2#1983), 2) AS round((tue_sales1 / tue_sales2), 2)#2160, round((wed_sales1#1976 / wed_sales2#1984), 2) AS round((wed_sales1 / wed_sales2), 2)#2161, round((thu_sales1#1977 / thu_sales2#1985), 2) AS round((thu_sales1 / thu_sales2), 2)#2162, round((fri_sales1#1978 / fri_sales2#1986), 2) AS round((fri_sales1 / fri_sales2), 2)#2163, round((sat_sales1#1979 / sat_sales2#1987), 2) AS round((sat_sales1 / sat_sales2), 2)#2164]
         +- BroadcastHashJoin [d_week_seq1#1972], [(d_week_seq2#1980 - 53)], Inner, BuildRight, false
            :- Project [d_week_seq#2071 AS d_week_seq1#1972, sun_sales#1992 AS sun_sales1#1973, mon_sales#1993 AS mon_sales1#1974, tue_sales#1994 AS tue_sales1#1975, wed_sales#1995 AS wed_sales1#1976, thu_sales#1996 AS thu_sales1#1977, fri_sales#1997 AS fri_sales1#1978, sat_sales#1998 AS sat_sales1#1979]
            :  +- BroadcastHashJoin [d_week_seq#2071], [d_week_seq#2099], Inner, BuildRight, false
            :     :- HashAggregate(keys=[d_week_seq#2071], functions=[sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END)], output=[d_week_seq#2071, sun_sales#1992, mon_sales#1993, tue_sales#1994, wed_sales#1995, thu_sales#1996, fri_sales#1997, sat_sales#1998])
            :     :  +- Exchange hashpartitioning(d_week_seq#2071, 3000), ENSURE_REQUIREMENTS, [id=#1294]
            :     :     +- HashAggregate(keys=[d_week_seq#2071], functions=[partial_sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END)], output=[d_week_seq#2071, sum#2180, sum#2181, sum#2182, sum#2183, sum#2184, sum#2185, sum#2186])
            :     :        +- Project [sales_price#1989, d_week_seq#2071, d_day_name#2081]
            :     :           +- BroadcastHashJoin [sold_date_sk#1988L], [d_date_sk#2067L], Inner, BuildRight, false
            :     :              :- Union
            :     :              :  :- Project [ws_sold_date_sk#2032L AS sold_date_sk#1988L, ws_ext_sales_price#2021 AS sales_price#1989]
            :     :              :  :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_ext_sales_price#2021,ws_sold_date_sk#2032L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#2032L)], PushedFilters: [], ReadSchema: struct<ws_ext_sales_price:double>
            :     :              :  +- Project [cs_sold_date_sk#2066L AS sold_date_sk#1990L, cs_ext_sales_price#2055 AS sales_price#1991]
            :     :              :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ext_sales_price#2055,cs_sold_date_sk#2066L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#2066L)], PushedFilters: [], ReadSchema: struct<cs_ext_sales_price:double>
            :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1289]
            :     :                 +- Filter (isnotnull(d_date_sk#2067L) AND isnotnull(d_week_seq#2071))
            :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2067L,d_week_seq#2071,d_day_name#2081] Batched: true, DataFilters: [isnotnull(d_date_sk#2067L), isnotnull(d_week_seq#2071)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int,d_day_name:string>
            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#1297]
            :        +- Project [d_week_seq#2099]
            :           +- Filter ((isnotnull(d_year#2101) AND (d_year#2101 = 2001)) AND isnotnull(d_week_seq#2099))
            :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#2099,d_year#2101] Batched: true, DataFilters: [isnotnull(d_year#2101), (d_year#2101 = 2001), isnotnull(d_week_seq#2099)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>
            +- BroadcastExchange HashedRelationBroadcastMode(List(cast((input[0, int, true] - 53) as bigint)),false), [id=#1312]
               +- Project [d_week_seq#2071 AS d_week_seq2#1980, sun_sales#1992 AS sun_sales2#1981, mon_sales#1993 AS mon_sales2#1982, tue_sales#1994 AS tue_sales2#1983, wed_sales#1995 AS wed_sales2#1984, thu_sales#1996 AS thu_sales2#1985, fri_sales#1997 AS fri_sales2#1986, sat_sales#1998 AS sat_sales2#1987]
                  +- BroadcastHashJoin [d_week_seq#2071], [d_week_seq#2127], Inner, BuildRight, false
                     :- HashAggregate(keys=[d_week_seq#2071], functions=[sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END), sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END)], output=[d_week_seq#2071, sun_sales#1992, mon_sales#1993, tue_sales#1994, wed_sales#1995, thu_sales#1996, fri_sales#1997, sat_sales#1998])
                     :  +- Exchange hashpartitioning(d_week_seq#2071, 3000), ENSURE_REQUIREMENTS, [id=#1305]
                     :     +- HashAggregate(keys=[d_week_seq#2071], functions=[partial_sum(CASE WHEN (d_day_name#2081 = Sunday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Monday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Tuesday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Wednesday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Thursday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Friday) THEN sales_price#1989 END), partial_sum(CASE WHEN (d_day_name#2081 = Saturday) THEN sales_price#1989 END)], output=[d_week_seq#2071, sum#2194, sum#2195, sum#2196, sum#2197, sum#2198, sum#2199, sum#2200])
                     :        +- Project [sales_price#1989, d_week_seq#2071, d_day_name#2081]
                     :           +- BroadcastHashJoin [sold_date_sk#1988L], [d_date_sk#2067L], Inner, BuildRight, false
                     :              :- Union
                     :              :  :- Project [ws_sold_date_sk#2032L AS sold_date_sk#1988L, ws_ext_sales_price#2021 AS sales_price#1989]
                     :              :  :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_ext_sales_price#2021,ws_sold_date_sk#2032L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#2032L)], PushedFilters: [], ReadSchema: struct<ws_ext_sales_price:double>
                     :              :  +- Project [cs_sold_date_sk#2066L AS sold_date_sk#1990L, cs_ext_sales_price#2055 AS sales_price#1991]
                     :              :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ext_sales_price#2055,cs_sold_date_sk#2066L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#2066L)], PushedFilters: [], ReadSchema: struct<cs_ext_sales_price:double>
                     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1300]
                     :                 +- Filter (isnotnull(d_date_sk#2067L) AND isnotnull(d_week_seq#2071))
                     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2067L,d_week_seq#2071,d_day_name#2081] Batched: true, DataFilters: [isnotnull(d_date_sk#2067L), isnotnull(d_week_seq#2071)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int,d_day_name:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#1308]
                        +- Project [d_week_seq#2127]
                           +- Filter ((isnotnull(d_year#2129) AND (d_year#2129 = 2002)) AND isnotnull(d_week_seq#2127))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#2127,d_year#2129] Batched: true, DataFilters: [isnotnull(d_year#2129), (d_year#2129 = 2002), isnotnull(d_week_seq#2127)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>

read query: spark_queries/q3.sql
explain query: q3
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['dt.d_year ASC NULLS FIRST, 'sum_agg DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true
      +- 'Aggregate ['dt.d_year, 'item.i_brand, 'item.i_brand_id], ['dt.d_year, 'item.i_brand_id AS brand_id#2201, 'item.i_brand AS brand#2202, 'sum('ss_ext_sales_price) AS sum_agg#2203]
         +- 'Filter ((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) AND ('store_sales.ss_item_sk = 'item.i_item_sk)) AND (('item.i_manufact_id = 436) AND ('dt.d_moy = 12)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias dt
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store_sales], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
d_year: int, brand_id: int, brand: string, sum_agg: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [d_year#2210 ASC NULLS FIRST, sum_agg#2203 DESC NULLS LAST, brand_id#2201 ASC NULLS FIRST], true
      +- Aggregate [d_year#2210, i_brand#2263, i_brand_id#2262], [d_year#2210, i_brand_id#2262 AS brand_id#2201, i_brand#2263 AS brand#2202, sum(ss_ext_sales_price#2246) AS sum_agg#2203]
         +- Filter (((d_date_sk#2204L = ss_sold_date_sk#2254L) AND (ss_item_sk#2233L = i_item_sk#2255L)) AND ((i_manufact_id#2268 = 436) AND (d_moy#2212 = 12)))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias dt
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2204L,d_date_id#2205,d_date#2206,d_month_seq#2207,d_week_seq#2208,d_quarter_seq#2209,d_year#2210,d_dow#2211,d_moy#2212,d_dom#2213,d_qoy#2214,d_fy_year#2215,d_fy_quarter_seq#2216,d_fy_week_seq#2217,d_day_name#2218,d_quarter_name#2219,d_holiday#2220,d_weekend#2221,d_following_holiday#2222,d_first_dom#2223,d_last_dom#2224,d_same_day_ly#2225,d_same_day_lq#2226,d_current_day#2227,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#2232L,ss_item_sk#2233L,ss_customer_sk#2234L,ss_cdemo_sk#2235L,ss_hdemo_sk#2236L,ss_addr_sk#2237L,ss_store_sk#2238L,ss_promo_sk#2239L,ss_ticket_number#2240L,ss_quantity#2241,ss_wholesale_cost#2242,ss_list_price#2243,ss_sales_price#2244,ss_ext_discount_amt#2245,ss_ext_sales_price#2246,ss_ext_wholesale_cost#2247,ss_ext_list_price#2248,ss_ext_tax#2249,ss_coupon_amt#2250,ss_net_paid#2251,ss_net_paid_inc_tax#2252,ss_net_profit#2253,ss_sold_date_sk#2254L] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#2255L,i_item_id#2256,i_rec_start_date#2257,i_rec_end_date#2258,i_item_desc#2259,i_current_price#2260,i_wholesale_cost#2261,i_brand_id#2262,i_brand#2263,i_class_id#2264,i_class#2265,i_category_id#2266,i_category#2267,i_manufact_id#2268,i_manufact#2269,i_size#2270,i_formulation#2271,i_color#2272,i_units#2273,i_container#2274,i_manager_id#2275,i_product_name#2276] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [d_year#2210 ASC NULLS FIRST, sum_agg#2203 DESC NULLS LAST, brand_id#2201 ASC NULLS FIRST], true
      +- Aggregate [d_year#2210, i_brand#2263, i_brand_id#2262], [d_year#2210, i_brand_id#2262 AS brand_id#2201, i_brand#2263 AS brand#2202, sum(ss_ext_sales_price#2246) AS sum_agg#2203]
         +- Project [d_year#2210, ss_ext_sales_price#2246, i_brand_id#2262, i_brand#2263]
            +- Join Inner, (d_date_sk#2204L = ss_sold_date_sk#2254L)
               :- Project [ss_ext_sales_price#2246, ss_sold_date_sk#2254L, i_brand_id#2262, i_brand#2263]
               :  +- Join Inner, (ss_item_sk#2233L = i_item_sk#2255L)
               :     :- Project [ss_item_sk#2233L, ss_ext_sales_price#2246, ss_sold_date_sk#2254L]
               :     :  +- Filter ((isnotnull(ss_sold_date_sk#2254L) AND isnotnull(ss_item_sk#2233L)) AND dynamicpruning#2282 [ss_sold_date_sk#2254L])
               :     :     :  +- Project [d_date_sk#2204L, d_year#2210]
               :     :     :     +- Filter ((isnotnull(d_moy#2212) AND (d_moy#2212 = 12)) AND isnotnull(d_date_sk#2204L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2204L,d_date_id#2205,d_date#2206,d_month_seq#2207,d_week_seq#2208,d_quarter_seq#2209,d_year#2210,d_dow#2211,d_moy#2212,d_dom#2213,d_qoy#2214,d_fy_year#2215,d_fy_quarter_seq#2216,d_fy_week_seq#2217,d_day_name#2218,d_quarter_name#2219,d_holiday#2220,d_weekend#2221,d_following_holiday#2222,d_first_dom#2223,d_last_dom#2224,d_same_day_ly#2225,d_same_day_lq#2226,d_current_day#2227,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#2232L,ss_item_sk#2233L,ss_customer_sk#2234L,ss_cdemo_sk#2235L,ss_hdemo_sk#2236L,ss_addr_sk#2237L,ss_store_sk#2238L,ss_promo_sk#2239L,ss_ticket_number#2240L,ss_quantity#2241,ss_wholesale_cost#2242,ss_list_price#2243,ss_sales_price#2244,ss_ext_discount_amt#2245,ss_ext_sales_price#2246,ss_ext_wholesale_cost#2247,ss_ext_list_price#2248,ss_ext_tax#2249,ss_coupon_amt#2250,ss_net_paid#2251,ss_net_paid_inc_tax#2252,ss_net_profit#2253,ss_sold_date_sk#2254L] orc
               :     +- Project [i_item_sk#2255L, i_brand_id#2262, i_brand#2263]
               :        +- Filter ((isnotnull(i_manufact_id#2268) AND (i_manufact_id#2268 = 436)) AND isnotnull(i_item_sk#2255L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#2255L,i_item_id#2256,i_rec_start_date#2257,i_rec_end_date#2258,i_item_desc#2259,i_current_price#2260,i_wholesale_cost#2261,i_brand_id#2262,i_brand#2263,i_class_id#2264,i_class#2265,i_category_id#2266,i_category#2267,i_manufact_id#2268,i_manufact#2269,i_size#2270,i_formulation#2271,i_color#2272,i_units#2273,i_container#2274,i_manager_id#2275,i_product_name#2276] orc
               +- Project [d_date_sk#2204L, d_year#2210]
                  +- Filter ((isnotnull(d_moy#2212) AND (d_moy#2212 = 12)) AND isnotnull(d_date_sk#2204L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2204L,d_date_id#2205,d_date#2206,d_month_seq#2207,d_week_seq#2208,d_quarter_seq#2209,d_year#2210,d_dow#2211,d_moy#2212,d_dom#2213,d_qoy#2214,d_fy_year#2215,d_fy_quarter_seq#2216,d_fy_week_seq#2217,d_day_name#2218,d_quarter_name#2219,d_holiday#2220,d_weekend#2221,d_following_holiday#2222,d_first_dom#2223,d_last_dom#2224,d_same_day_ly#2225,d_same_day_lq#2226,d_current_day#2227,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[d_year#2210 ASC NULLS FIRST,sum_agg#2203 DESC NULLS LAST,brand_id#2201 ASC NULLS FIRST], output=[d_year#2210,brand_id#2201,brand#2202,sum_agg#2203])
   +- HashAggregate(keys=[d_year#2210, i_brand#2263, i_brand_id#2262], functions=[sum(ss_ext_sales_price#2246)], output=[d_year#2210, brand_id#2201, brand#2202, sum_agg#2203])
      +- Exchange hashpartitioning(d_year#2210, i_brand#2263, i_brand_id#2262, 3000), ENSURE_REQUIREMENTS, [id=#1400]
         +- HashAggregate(keys=[d_year#2210, i_brand#2263, i_brand_id#2262], functions=[partial_sum(ss_ext_sales_price#2246)], output=[d_year#2210, i_brand#2263, i_brand_id#2262, sum#2284])
            +- Project [d_year#2210, ss_ext_sales_price#2246, i_brand_id#2262, i_brand#2263]
               +- BroadcastHashJoin [ss_sold_date_sk#2254L], [d_date_sk#2204L], Inner, BuildRight, false
                  :- Project [ss_ext_sales_price#2246, ss_sold_date_sk#2254L, i_brand_id#2262, i_brand#2263]
                  :  +- BroadcastHashJoin [ss_item_sk#2233L], [i_item_sk#2255L], Inner, BuildRight, false
                  :     :- Filter isnotnull(ss_item_sk#2233L)
                  :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#2233L,ss_ext_sales_price#2246,ss_sold_date_sk#2254L] Batched: true, DataFilters: [isnotnull(ss_item_sk#2233L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#2254L), dynamicpruningexpression(ss_sold_date_sk#2254L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
                  :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#2282, 0, true, Project [d_date_sk#2204L, d_year#2210], [d_date_sk#2204L]
                  :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              +- Project [d_date_sk#2204L, d_year#2210]
                  :     :                 +- Filter ((isnotnull(d_moy#2212) AND (d_moy#2212 = 12)) AND isnotnull(d_date_sk#2204L))
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2204L,d_year#2210,d_moy#2212] Batched: true, DataFilters: [isnotnull(d_moy#2212), (d_moy#2212 = 12), isnotnull(d_date_sk#2204L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#1391]
                  :        +- Project [i_item_sk#2255L, i_brand_id#2262, i_brand#2263]
                  :           +- Filter ((isnotnull(i_manufact_id#2268) AND (i_manufact_id#2268 = 436)) AND isnotnull(i_item_sk#2255L))
                  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#2255L,i_brand_id#2262,i_brand#2263,i_manufact_id#2268] Batched: true, DataFilters: [isnotnull(i_manufact_id#2268), (i_manufact_id#2268 = 436), isnotnull(i_item_sk#2255L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,436), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_brand:string,i_manufact_id:int>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#1395]
                     +- Project [d_date_sk#2204L, d_year#2210]
                        +- Filter ((isnotnull(d_moy#2212) AND (d_moy#2212 = 12)) AND isnotnull(d_date_sk#2204L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2204L,d_year#2210,d_moy#2212] Batched: true, DataFilters: [isnotnull(d_moy#2212), (d_moy#2212 = 12), isnotnull(d_date_sk#2204L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q4.sql
explain query: q4
== Parsed Logical Plan ==
CTE [year_total]
:  +- 'SubqueryAlias year_total
:     +- 'Union false, false
:        :- 'Union false, false
:        :  :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#2285, 'c_first_name AS customer_first_name#2286, 'c_last_name AS customer_last_name#2287, 'c_preferred_cust_flag AS customer_preferred_cust_flag#2288, 'c_birth_country AS customer_birth_country#2289, 'c_login AS customer_login#2290, 'c_email_address AS customer_email_address#2291, 'd_year AS dyear#2292, 'sum((((('ss_ext_list_price - 'ss_ext_wholesale_cost) - 'ss_ext_discount_amt) + 'ss_ext_sales_price) / 2)) AS year_total#2293, s AS sale_type#2294]
:        :  :  +- 'Filter (('c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk))
:        :  :     +- 'Join Inner
:        :  :        :- 'Join Inner
:        :  :        :  :- 'UnresolvedRelation [customer], [], false
:        :  :        :  +- 'UnresolvedRelation [store_sales], [], false
:        :  :        +- 'UnresolvedRelation [date_dim], [], false
:        :  +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#2295, 'c_first_name AS customer_first_name#2296, 'c_last_name AS customer_last_name#2297, 'c_preferred_cust_flag AS customer_preferred_cust_flag#2298, 'c_birth_country AS customer_birth_country#2299, 'c_login AS customer_login#2300, 'c_email_address AS customer_email_address#2301, 'd_year AS dyear#2302, 'sum((((('cs_ext_list_price - 'cs_ext_wholesale_cost) - 'cs_ext_discount_amt) + 'cs_ext_sales_price) / 2)) AS year_total#2303, c AS sale_type#2304]
:        :     +- 'Filter (('c_customer_sk = 'cs_bill_customer_sk) AND ('cs_sold_date_sk = 'd_date_sk))
:        :        +- 'Join Inner
:        :           :- 'Join Inner
:        :           :  :- 'UnresolvedRelation [customer], [], false
:        :           :  +- 'UnresolvedRelation [catalog_sales], [], false
:        :           +- 'UnresolvedRelation [date_dim], [], false
:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#2305, 'c_first_name AS customer_first_name#2306, 'c_last_name AS customer_last_name#2307, 'c_preferred_cust_flag AS customer_preferred_cust_flag#2308, 'c_birth_country AS customer_birth_country#2309, 'c_login AS customer_login#2310, 'c_email_address AS customer_email_address#2311, 'd_year AS dyear#2312, 'sum((((('ws_ext_list_price - 'ws_ext_wholesale_cost) - 'ws_ext_discount_amt) + 'ws_ext_sales_price) / 2)) AS year_total#2313, w AS sale_type#2314]
:           +- 'Filter (('c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk))
:              +- 'Join Inner
:                 :- 'Join Inner
:                 :  :- 'UnresolvedRelation [customer], [], false
:                 :  +- 'UnresolvedRelation [web_sales], [], false
:                 +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['t_s_secyear.customer_preferred_cust_flag ASC NULLS FIRST], true
         +- 'Project ['t_s_secyear.customer_preferred_cust_flag]
            +- 'Filter (((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) AND ('t_s_firstyear.customer_id = 't_c_secyear.customer_id)) AND ('t_s_firstyear.customer_id = 't_c_firstyear.customer_id)) AND ((('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) AND ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) AND ('t_s_firstyear.sale_type = s))) AND (((('t_c_firstyear.sale_type = c) AND ('t_w_firstyear.sale_type = w)) AND ('t_s_secyear.sale_type = s)) AND (('t_c_secyear.sale_type = c) AND ('t_w_secyear.sale_type = w)))) AND ((((('t_s_firstyear.dyear = 2001) AND ('t_s_secyear.dyear = (2001 + 1))) AND ('t_c_firstyear.dyear = 2001)) AND ((('t_c_secyear.dyear = (2001 + 1)) AND ('t_w_firstyear.dyear = 2001)) AND ('t_w_secyear.dyear = (2001 + 1)))) AND (((('t_s_firstyear.year_total > 0) AND ('t_c_firstyear.year_total > 0)) AND ('t_w_firstyear.year_total > 0)) AND ((CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END) AND (CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END)))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'Join Inner
                  :  :  :  :- 'Join Inner
                  :  :  :  :  :- 'SubqueryAlias t_s_firstyear
                  :  :  :  :  :  +- 'UnresolvedRelation [year_total], [], false
                  :  :  :  :  +- 'SubqueryAlias t_s_secyear
                  :  :  :  :     +- 'UnresolvedRelation [year_total], [], false
                  :  :  :  +- 'SubqueryAlias t_c_firstyear
                  :  :  :     +- 'UnresolvedRelation [year_total], [], false
                  :  :  +- 'SubqueryAlias t_c_secyear
                  :  :     +- 'UnresolvedRelation [year_total], [], false
                  :  +- 'SubqueryAlias t_w_firstyear
                  :     +- 'UnresolvedRelation [year_total], [], false
                  +- 'SubqueryAlias t_w_secyear
                     +- 'UnresolvedRelation [year_total], [], false

== Analyzed Logical Plan ==
customer_preferred_cust_flag: string
WithCTE
:- CTERelationDef 3
:  +- SubqueryAlias year_total
:     +- Union false, false
:        :- Union false, false
:        :  :- Aggregate [c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362], [c_customer_id#2316 AS customer_id#2285, c_first_name#2323 AS customer_first_name#2286, c_last_name#2324 AS customer_last_name#2287, c_preferred_cust_flag#2325 AS customer_preferred_cust_flag#2288, c_birth_country#2329 AS customer_birth_country#2289, c_login#2330 AS customer_login#2290, c_email_address#2331 AS customer_email_address#2291, d_year#2362 AS dyear#2292, sum(((((ss_ext_list_price#2349 - ss_ext_wholesale_cost#2348) - ss_ext_discount_amt#2346) + ss_ext_sales_price#2347) / cast(2 as double))) AS year_total#2293, s AS sale_type#2294]
:        :  :  +- Filter ((c_customer_sk#2315L = ss_customer_sk#2335L) AND (ss_sold_date_sk#2355L = d_date_sk#2356L))
:        :  :     +- Join Inner
:        :  :        :- Join Inner
:        :  :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:        :  :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2315L,c_customer_id#2316,c_current_cdemo_sk#2317L,c_current_hdemo_sk#2318L,c_current_addr_sk#2319L,c_first_shipto_date_sk#2320L,c_first_sales_date_sk#2321L,c_salutation#2322,c_first_name#2323,c_last_name#2324,c_preferred_cust_flag#2325,c_birth_day#2326,c_birth_month#2327,c_birth_year#2328,c_birth_country#2329,c_login#2330,c_email_address#2331,c_last_review_date#2332] orc
:        :  :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:        :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#2333L,ss_item_sk#2334L,ss_customer_sk#2335L,ss_cdemo_sk#2336L,ss_hdemo_sk#2337L,ss_addr_sk#2338L,ss_store_sk#2339L,ss_promo_sk#2340L,ss_ticket_number#2341L,ss_quantity#2342,ss_wholesale_cost#2343,ss_list_price#2344,ss_sales_price#2345,ss_ext_discount_amt#2346,ss_ext_sales_price#2347,ss_ext_wholesale_cost#2348,ss_ext_list_price#2349,ss_ext_tax#2350,ss_coupon_amt#2351,ss_net_paid#2352,ss_net_paid_inc_tax#2353,ss_net_profit#2354,ss_sold_date_sk#2355L] orc
:        :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:        :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2356L,d_date_id#2357,d_date#2358,d_month_seq#2359,d_week_seq#2360,d_quarter_seq#2361,d_year#2362,d_dow#2363,d_moy#2364,d_dom#2365,d_qoy#2366,d_fy_year#2367,d_fy_quarter_seq#2368,d_fy_week_seq#2369,d_day_name#2370,d_quarter_name#2371,d_holiday#2372,d_weekend#2373,d_following_holiday#2374,d_first_dom#2375,d_last_dom#2376,d_same_day_ly#2377,d_same_day_lq#2378,d_current_day#2379,... 4 more fields] orc
:        :  +- Aggregate [c_customer_id#2385, c_first_name#2392, c_last_name#2393, c_preferred_cust_flag#2394, c_birth_country#2398, c_login#2399, c_email_address#2400, d_year#2442], [c_customer_id#2385 AS customer_id#2295, c_first_name#2392 AS customer_first_name#2296, c_last_name#2393 AS customer_last_name#2297, c_preferred_cust_flag#2394 AS customer_preferred_cust_flag#2298, c_birth_country#2398 AS customer_birth_country#2299, c_login#2399 AS customer_login#2300, c_email_address#2400 AS customer_email_address#2301, d_year#2442 AS dyear#2302, sum(((((cs_ext_list_price#2426 - cs_ext_wholesale_cost#2425) - cs_ext_discount_amt#2423) + cs_ext_sales_price#2424) / cast(2 as double))) AS year_total#2303, c AS sale_type#2304]
:        :     +- Filter ((c_customer_sk#2384L = cs_bill_customer_sk#2404L) AND (cs_sold_date_sk#2435L = d_date_sk#2436L))
:        :        +- Join Inner
:        :           :- Join Inner
:        :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:        :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2384L,c_customer_id#2385,c_current_cdemo_sk#2386L,c_current_hdemo_sk#2387L,c_current_addr_sk#2388L,c_first_shipto_date_sk#2389L,c_first_sales_date_sk#2390L,c_salutation#2391,c_first_name#2392,c_last_name#2393,c_preferred_cust_flag#2394,c_birth_day#2395,c_birth_month#2396,c_birth_year#2397,c_birth_country#2398,c_login#2399,c_email_address#2400,c_last_review_date#2401] orc
:        :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:        :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#2402L,cs_ship_date_sk#2403L,cs_bill_customer_sk#2404L,cs_bill_cdemo_sk#2405L,cs_bill_hdemo_sk#2406L,cs_bill_addr_sk#2407L,cs_ship_customer_sk#2408L,cs_ship_cdemo_sk#2409L,cs_ship_hdemo_sk#2410L,cs_ship_addr_sk#2411L,cs_call_center_sk#2412L,cs_catalog_page_sk#2413L,cs_ship_mode_sk#2414L,cs_warehouse_sk#2415L,cs_item_sk#2416L,cs_promo_sk#2417L,cs_order_number#2418L,cs_quantity#2419,cs_wholesale_cost#2420,cs_list_price#2421,cs_sales_price#2422,cs_ext_discount_amt#2423,cs_ext_sales_price#2424,cs_ext_wholesale_cost#2425,... 10 more fields] orc
:        :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:        :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2436L,d_date_id#2437,d_date#2438,d_month_seq#2439,d_week_seq#2440,d_quarter_seq#2441,d_year#2442,d_dow#2443,d_moy#2444,d_dom#2445,d_qoy#2446,d_fy_year#2447,d_fy_quarter_seq#2448,d_fy_week_seq#2449,d_day_name#2450,d_quarter_name#2451,d_holiday#2452,d_weekend#2453,d_following_holiday#2454,d_first_dom#2455,d_last_dom#2456,d_same_day_ly#2457,d_same_day_lq#2458,d_current_day#2459,... 4 more fields] orc
:        +- Aggregate [c_customer_id#2465, c_first_name#2472, c_last_name#2473, c_preferred_cust_flag#2474, c_birth_country#2478, c_login#2479, c_email_address#2480, d_year#2522], [c_customer_id#2465 AS customer_id#2305, c_first_name#2472 AS customer_first_name#2306, c_last_name#2473 AS customer_last_name#2307, c_preferred_cust_flag#2474 AS customer_preferred_cust_flag#2308, c_birth_country#2478 AS customer_birth_country#2309, c_login#2479 AS customer_login#2310, c_email_address#2480 AS customer_email_address#2311, d_year#2522 AS dyear#2312, sum(((((ws_ext_list_price#2506 - ws_ext_wholesale_cost#2505) - ws_ext_discount_amt#2503) + ws_ext_sales_price#2504) / cast(2 as double))) AS year_total#2313, w AS sale_type#2314]
:           +- Filter ((c_customer_sk#2464L = ws_bill_customer_sk#2485L) AND (ws_sold_date_sk#2515L = d_date_sk#2516L))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2464L,c_customer_id#2465,c_current_cdemo_sk#2466L,c_current_hdemo_sk#2467L,c_current_addr_sk#2468L,c_first_shipto_date_sk#2469L,c_first_sales_date_sk#2470L,c_salutation#2471,c_first_name#2472,c_last_name#2473,c_preferred_cust_flag#2474,c_birth_day#2475,c_birth_month#2476,c_birth_year#2477,c_birth_country#2478,c_login#2479,c_email_address#2480,c_last_review_date#2481] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#2482L,ws_ship_date_sk#2483L,ws_item_sk#2484L,ws_bill_customer_sk#2485L,ws_bill_cdemo_sk#2486L,ws_bill_hdemo_sk#2487L,ws_bill_addr_sk#2488L,ws_ship_customer_sk#2489L,ws_ship_cdemo_sk#2490L,ws_ship_hdemo_sk#2491L,ws_ship_addr_sk#2492L,ws_web_page_sk#2493L,ws_web_site_sk#2494L,ws_ship_mode_sk#2495L,ws_warehouse_sk#2496L,ws_promo_sk#2497L,ws_order_number#2498L,ws_quantity#2499,ws_wholesale_cost#2500,ws_list_price#2501,ws_sales_price#2502,ws_ext_discount_amt#2503,ws_ext_sales_price#2504,ws_ext_wholesale_cost#2505,... 10 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2516L,d_date_id#2517,d_date#2518,d_month_seq#2519,d_week_seq#2520,d_quarter_seq#2521,d_year#2522,d_dow#2523,d_moy#2524,d_dom#2525,d_qoy#2526,d_fy_year#2527,d_fy_quarter_seq#2528,d_fy_week_seq#2529,d_day_name#2530,d_quarter_name#2531,d_holiday#2532,d_weekend#2533,d_following_holiday#2534,d_first_dom#2535,d_last_dom#2536,d_same_day_ly#2537,d_same_day_lq#2538,d_current_day#2539,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [customer_preferred_cust_flag#2550 ASC NULLS FIRST], true
         +- Project [customer_preferred_cust_flag#2550]
            +- Filter ((((((customer_id#2547 = customer_id#2285) AND (customer_id#2285 = customer_id#2567)) AND (customer_id#2285 = customer_id#2557)) AND (((customer_id#2285 = customer_id#2577) AND (customer_id#2285 = customer_id#2587)) AND (sale_type#2294 = s))) AND ((((sale_type#2566 = c) AND (sale_type#2586 = w)) AND (sale_type#2556 = s)) AND ((sale_type#2576 = c) AND (sale_type#2596 = w)))) AND (((((dyear#2292 = 2001) AND (dyear#2554 = (2001 + 1))) AND (dyear#2564 = 2001)) AND (((dyear#2574 = (2001 + 1)) AND (dyear#2584 = 2001)) AND (dyear#2594 = (2001 + 1)))) AND ((((year_total#2293 > cast(0 as double)) AND (year_total#2565 > cast(0 as double))) AND (year_total#2585 > cast(0 as double))) AND ((CASE WHEN (year_total#2565 > cast(0 as double)) THEN (year_total#2575 / year_total#2565) ELSE cast(null as double) END > CASE WHEN (year_total#2293 > cast(0 as double)) THEN (year_total#2555 / year_total#2293) ELSE cast(null as double) END) AND (CASE WHEN (year_total#2565 > cast(0 as double)) THEN (year_total#2575 / year_total#2565) ELSE cast(null as double) END > CASE WHEN (year_total#2585 > cast(0 as double)) THEN (year_total#2595 / year_total#2585) ELSE cast(null as double) END)))))
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- Join Inner
                  :  :  :  :- Join Inner
                  :  :  :  :  :- SubqueryAlias t_s_firstyear
                  :  :  :  :  :  +- SubqueryAlias year_total
                  :  :  :  :  :     +- CTERelationRef 3, true, [customer_id#2285, customer_first_name#2286, customer_last_name#2287, customer_preferred_cust_flag#2288, customer_birth_country#2289, customer_login#2290, customer_email_address#2291, dyear#2292, year_total#2293, sale_type#2294]
                  :  :  :  :  +- SubqueryAlias t_s_secyear
                  :  :  :  :     +- SubqueryAlias year_total
                  :  :  :  :        +- CTERelationRef 3, true, [customer_id#2547, customer_first_name#2548, customer_last_name#2549, customer_preferred_cust_flag#2550, customer_birth_country#2551, customer_login#2552, customer_email_address#2553, dyear#2554, year_total#2555, sale_type#2556]
                  :  :  :  +- SubqueryAlias t_c_firstyear
                  :  :  :     +- SubqueryAlias year_total
                  :  :  :        +- CTERelationRef 3, true, [customer_id#2557, customer_first_name#2558, customer_last_name#2559, customer_preferred_cust_flag#2560, customer_birth_country#2561, customer_login#2562, customer_email_address#2563, dyear#2564, year_total#2565, sale_type#2566]
                  :  :  +- SubqueryAlias t_c_secyear
                  :  :     +- SubqueryAlias year_total
                  :  :        +- CTERelationRef 3, true, [customer_id#2567, customer_first_name#2568, customer_last_name#2569, customer_preferred_cust_flag#2570, customer_birth_country#2571, customer_login#2572, customer_email_address#2573, dyear#2574, year_total#2575, sale_type#2576]
                  :  +- SubqueryAlias t_w_firstyear
                  :     +- SubqueryAlias year_total
                  :        +- CTERelationRef 3, true, [customer_id#2577, customer_first_name#2578, customer_last_name#2579, customer_preferred_cust_flag#2580, customer_birth_country#2581, customer_login#2582, customer_email_address#2583, dyear#2584, year_total#2585, sale_type#2586]
                  +- SubqueryAlias t_w_secyear
                     +- SubqueryAlias year_total
                        +- CTERelationRef 3, true, [customer_id#2587, customer_first_name#2588, customer_last_name#2589, customer_preferred_cust_flag#2590, customer_birth_country#2591, customer_login#2592, customer_email_address#2593, dyear#2594, year_total#2595, sale_type#2596]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [customer_preferred_cust_flag#2550 ASC NULLS FIRST], true
      +- Project [customer_preferred_cust_flag#2550]
         +- Join Inner, ((customer_id#2285 = customer_id#2587) AND (CASE WHEN (year_total#3074 > 0.0) THEN (year_total#2575 / year_total#3074) END > CASE WHEN (year_total#3552 > 0.0) THEN (year_total#2595 / year_total#3552) END))
            :- Project [customer_id#2285, customer_preferred_cust_flag#2550, year_total#3074, year_total#2575, year_total#3552]
            :  +- Join Inner, (customer_id#2285 = customer_id#3544)
            :     :- Project [customer_id#2285, customer_preferred_cust_flag#2550, year_total#3074, year_total#2575]
            :     :  +- Join Inner, ((customer_id#2285 = customer_id#2567) AND (CASE WHEN (year_total#3074 > 0.0) THEN (year_total#2575 / year_total#3074) END > CASE WHEN (year_total#2293 > 0.0) THEN (year_total#2555 / year_total#2293) END))
            :     :     :- Project [customer_id#2285, year_total#2293, customer_preferred_cust_flag#2550, year_total#2555, year_total#3074]
            :     :     :  +- Join Inner, (customer_id#2285 = customer_id#3066)
            :     :     :     :- Project [customer_id#2285, year_total#2293, customer_preferred_cust_flag#2550, year_total#2555]
            :     :     :     :  +- Join Inner, (customer_id#2547 = customer_id#2285)
            :     :     :     :     :- Filter (isnotnull(year_total#2293) AND (year_total#2293 > 0.0))
            :     :     :     :     :  +- Aggregate [c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362], [c_customer_id#2316 AS customer_id#2285, sum(((((ss_ext_list_price#2349 - ss_ext_wholesale_cost#2348) - ss_ext_discount_amt#2346) + ss_ext_sales_price#2347) / 2.0)) AS year_total#2293]
            :     :     :     :     :     +- Project [c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, ss_ext_discount_amt#2346, ss_ext_sales_price#2347, ss_ext_wholesale_cost#2348, ss_ext_list_price#2349, d_year#2362]
            :     :     :     :     :        +- Join Inner, (c_customer_sk#2315L = ss_customer_sk#2335L)
            :     :     :     :     :           :- Project [ss_customer_sk#2335L, ss_ext_discount_amt#2346, ss_ext_sales_price#2347, ss_ext_wholesale_cost#2348, ss_ext_list_price#2349, d_year#2362]
            :     :     :     :     :           :  +- Join Inner, (ss_sold_date_sk#2355L = d_date_sk#2356L)
            :     :     :     :     :           :     :- Project [ss_customer_sk#2335L, ss_ext_discount_amt#2346, ss_ext_sales_price#2347, ss_ext_wholesale_cost#2348, ss_ext_list_price#2349, ss_sold_date_sk#2355L]
            :     :     :     :     :           :     :  +- Filter ((isnotnull(ss_customer_sk#2335L) AND isnotnull(ss_sold_date_sk#2355L)) AND dynamicpruning#3893 [ss_sold_date_sk#2355L])
            :     :     :     :     :           :     :     :  +- Project [d_date_sk#2356L, d_year#2362]
            :     :     :     :     :           :     :     :     +- Filter ((isnotnull(d_year#2362) AND (d_year#2362 = 2001)) AND isnotnull(d_date_sk#2356L))
            :     :     :     :     :           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2356L,d_date_id#2357,d_date#2358,d_month_seq#2359,d_week_seq#2360,d_quarter_seq#2361,d_year#2362,d_dow#2363,d_moy#2364,d_dom#2365,d_qoy#2366,d_fy_year#2367,d_fy_quarter_seq#2368,d_fy_week_seq#2369,d_day_name#2370,d_quarter_name#2371,d_holiday#2372,d_weekend#2373,d_following_holiday#2374,d_first_dom#2375,d_last_dom#2376,d_same_day_ly#2377,d_same_day_lq#2378,d_current_day#2379,... 4 more fields] orc
            :     :     :     :     :           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#2333L,ss_item_sk#2334L,ss_customer_sk#2335L,ss_cdemo_sk#2336L,ss_hdemo_sk#2337L,ss_addr_sk#2338L,ss_store_sk#2339L,ss_promo_sk#2340L,ss_ticket_number#2341L,ss_quantity#2342,ss_wholesale_cost#2343,ss_list_price#2344,ss_sales_price#2345,ss_ext_discount_amt#2346,ss_ext_sales_price#2347,ss_ext_wholesale_cost#2348,ss_ext_list_price#2349,ss_ext_tax#2350,ss_coupon_amt#2351,ss_net_paid#2352,ss_net_paid_inc_tax#2353,ss_net_profit#2354,ss_sold_date_sk#2355L] orc
            :     :     :     :     :           :     +- Project [d_date_sk#2356L, d_year#2362]
            :     :     :     :     :           :        +- Filter ((isnotnull(d_year#2362) AND (d_year#2362 = 2001)) AND isnotnull(d_date_sk#2356L))
            :     :     :     :     :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2356L,d_date_id#2357,d_date#2358,d_month_seq#2359,d_week_seq#2360,d_quarter_seq#2361,d_year#2362,d_dow#2363,d_moy#2364,d_dom#2365,d_qoy#2366,d_fy_year#2367,d_fy_quarter_seq#2368,d_fy_week_seq#2369,d_day_name#2370,d_quarter_name#2371,d_holiday#2372,d_weekend#2373,d_following_holiday#2374,d_first_dom#2375,d_last_dom#2376,d_same_day_ly#2377,d_same_day_lq#2378,d_current_day#2379,... 4 more fields] orc
            :     :     :     :     :           +- Project [c_customer_sk#2315L, c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331]
            :     :     :     :     :              +- Filter (isnotnull(c_customer_sk#2315L) AND isnotnull(c_customer_id#2316))
            :     :     :     :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2315L,c_customer_id#2316,c_current_cdemo_sk#2317L,c_current_hdemo_sk#2318L,c_current_addr_sk#2319L,c_first_shipto_date_sk#2320L,c_first_sales_date_sk#2321L,c_salutation#2322,c_first_name#2323,c_last_name#2324,c_preferred_cust_flag#2325,c_birth_day#2326,c_birth_month#2327,c_birth_year#2328,c_birth_country#2329,c_login#2330,c_email_address#2331,c_last_review_date#2332] orc
            :     :     :     :     +- Aggregate [c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, d_year#2645], [c_customer_id#2599 AS customer_id#2547, c_preferred_cust_flag#2608 AS customer_preferred_cust_flag#2550, sum(((((ss_ext_list_price#2632 - ss_ext_wholesale_cost#2631) - ss_ext_discount_amt#2629) + ss_ext_sales_price#2630) / 2.0)) AS year_total#2555]
            :     :     :     :        +- Project [c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, ss_ext_discount_amt#2629, ss_ext_sales_price#2630, ss_ext_wholesale_cost#2631, ss_ext_list_price#2632, d_year#2645]
            :     :     :     :           +- Join Inner, (c_customer_sk#2598L = ss_customer_sk#2618L)
            :     :     :     :              :- Project [ss_customer_sk#2618L, ss_ext_discount_amt#2629, ss_ext_sales_price#2630, ss_ext_wholesale_cost#2631, ss_ext_list_price#2632, d_year#2645]
            :     :     :     :              :  +- Join Inner, (ss_sold_date_sk#2638L = d_date_sk#2639L)
            :     :     :     :              :     :- Project [ss_customer_sk#2618L, ss_ext_discount_amt#2629, ss_ext_sales_price#2630, ss_ext_wholesale_cost#2631, ss_ext_list_price#2632, ss_sold_date_sk#2638L]
            :     :     :     :              :     :  +- Filter ((isnotnull(ss_customer_sk#2618L) AND isnotnull(ss_sold_date_sk#2638L)) AND dynamicpruning#3894 [ss_sold_date_sk#2638L])
            :     :     :     :              :     :     :  +- Project [d_date_sk#2639L, d_year#2645]
            :     :     :     :              :     :     :     +- Filter ((isnotnull(d_year#2645) AND (d_year#2645 = 2002)) AND isnotnull(d_date_sk#2639L))
            :     :     :     :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2639L,d_date_id#2640,d_date#2641,d_month_seq#2642,d_week_seq#2643,d_quarter_seq#2644,d_year#2645,d_dow#2646,d_moy#2647,d_dom#2648,d_qoy#2649,d_fy_year#2650,d_fy_quarter_seq#2651,d_fy_week_seq#2652,d_day_name#2653,d_quarter_name#2654,d_holiday#2655,d_weekend#2656,d_following_holiday#2657,d_first_dom#2658,d_last_dom#2659,d_same_day_ly#2660,d_same_day_lq#2661,d_current_day#2662,... 4 more fields] orc
            :     :     :     :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#2616L,ss_item_sk#2617L,ss_customer_sk#2618L,ss_cdemo_sk#2619L,ss_hdemo_sk#2620L,ss_addr_sk#2621L,ss_store_sk#2622L,ss_promo_sk#2623L,ss_ticket_number#2624L,ss_quantity#2625,ss_wholesale_cost#2626,ss_list_price#2627,ss_sales_price#2628,ss_ext_discount_amt#2629,ss_ext_sales_price#2630,ss_ext_wholesale_cost#2631,ss_ext_list_price#2632,ss_ext_tax#2633,ss_coupon_amt#2634,ss_net_paid#2635,ss_net_paid_inc_tax#2636,ss_net_profit#2637,ss_sold_date_sk#2638L] orc
            :     :     :     :              :     +- Project [d_date_sk#2639L, d_year#2645]
            :     :     :     :              :        +- Filter ((isnotnull(d_year#2645) AND (d_year#2645 = 2002)) AND isnotnull(d_date_sk#2639L))
            :     :     :     :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2639L,d_date_id#2640,d_date#2641,d_month_seq#2642,d_week_seq#2643,d_quarter_seq#2644,d_year#2645,d_dow#2646,d_moy#2647,d_dom#2648,d_qoy#2649,d_fy_year#2650,d_fy_quarter_seq#2651,d_fy_week_seq#2652,d_day_name#2653,d_quarter_name#2654,d_holiday#2655,d_weekend#2656,d_following_holiday#2657,d_first_dom#2658,d_last_dom#2659,d_same_day_ly#2660,d_same_day_lq#2661,d_current_day#2662,... 4 more fields] orc
            :     :     :     :              +- Project [c_customer_sk#2598L, c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614]
            :     :     :     :                 +- Filter (isnotnull(c_customer_sk#2598L) AND isnotnull(c_customer_id#2599))
            :     :     :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2598L,c_customer_id#2599,c_current_cdemo_sk#2600L,c_current_hdemo_sk#2601L,c_current_addr_sk#2602L,c_first_shipto_date_sk#2603L,c_first_sales_date_sk#2604L,c_salutation#2605,c_first_name#2606,c_last_name#2607,c_preferred_cust_flag#2608,c_birth_day#2609,c_birth_month#2610,c_birth_year#2611,c_birth_country#2612,c_login#2613,c_email_address#2614,c_last_review_date#2615] orc
            :     :     :     +- Project [customer_id#2295 AS customer_id#3066, year_total#2303 AS year_total#3074]
            :     :     :        +- Filter (isnotnull(year_total#2303) AND (year_total#2303 > 0.0))
            :     :     :           +- Aggregate [c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, d_year#2964], [c_customer_id#2907 AS customer_id#2295, sum(((((cs_ext_list_price#2948 - cs_ext_wholesale_cost#2947) - cs_ext_discount_amt#2945) + cs_ext_sales_price#2946) / 2.0)) AS year_total#2303]
            :     :     :              +- Project [c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, cs_ext_discount_amt#2945, cs_ext_sales_price#2946, cs_ext_wholesale_cost#2947, cs_ext_list_price#2948, d_year#2964]
            :     :     :                 +- Join Inner, (c_customer_sk#2906L = cs_bill_customer_sk#2926L)
            :     :     :                    :- Project [cs_bill_customer_sk#2926L, cs_ext_discount_amt#2945, cs_ext_sales_price#2946, cs_ext_wholesale_cost#2947, cs_ext_list_price#2948, d_year#2964]
            :     :     :                    :  +- Join Inner, (cs_sold_date_sk#2957L = d_date_sk#2958L)
            :     :     :                    :     :- Project [cs_bill_customer_sk#2926L, cs_ext_discount_amt#2945, cs_ext_sales_price#2946, cs_ext_wholesale_cost#2947, cs_ext_list_price#2948, cs_sold_date_sk#2957L]
            :     :     :                    :     :  +- Filter ((isnotnull(cs_bill_customer_sk#2926L) AND isnotnull(cs_sold_date_sk#2957L)) AND dynamicpruning#3895 [cs_sold_date_sk#2957L])
            :     :     :                    :     :     :  +- Project [d_date_sk#2958L, d_year#2964]
            :     :     :                    :     :     :     +- Filter ((isnotnull(d_year#2964) AND (d_year#2964 = 2001)) AND isnotnull(d_date_sk#2958L))
            :     :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2958L,d_date_id#2959,d_date#2960,d_month_seq#2961,d_week_seq#2962,d_quarter_seq#2963,d_year#2964,d_dow#2965,d_moy#2966,d_dom#2967,d_qoy#2968,d_fy_year#2969,d_fy_quarter_seq#2970,d_fy_week_seq#2971,d_day_name#2972,d_quarter_name#2973,d_holiday#2974,d_weekend#2975,d_following_holiday#2976,d_first_dom#2977,d_last_dom#2978,d_same_day_ly#2979,d_same_day_lq#2980,d_current_day#2981,... 4 more fields] orc
            :     :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#2924L,cs_ship_date_sk#2925L,cs_bill_customer_sk#2926L,cs_bill_cdemo_sk#2927L,cs_bill_hdemo_sk#2928L,cs_bill_addr_sk#2929L,cs_ship_customer_sk#2930L,cs_ship_cdemo_sk#2931L,cs_ship_hdemo_sk#2932L,cs_ship_addr_sk#2933L,cs_call_center_sk#2934L,cs_catalog_page_sk#2935L,cs_ship_mode_sk#2936L,cs_warehouse_sk#2937L,cs_item_sk#2938L,cs_promo_sk#2939L,cs_order_number#2940L,cs_quantity#2941,cs_wholesale_cost#2942,cs_list_price#2943,cs_sales_price#2944,cs_ext_discount_amt#2945,cs_ext_sales_price#2946,cs_ext_wholesale_cost#2947,... 10 more fields] orc
            :     :     :                    :     +- Project [d_date_sk#2958L, d_year#2964]
            :     :     :                    :        +- Filter ((isnotnull(d_year#2964) AND (d_year#2964 = 2001)) AND isnotnull(d_date_sk#2958L))
            :     :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2958L,d_date_id#2959,d_date#2960,d_month_seq#2961,d_week_seq#2962,d_quarter_seq#2963,d_year#2964,d_dow#2965,d_moy#2966,d_dom#2967,d_qoy#2968,d_fy_year#2969,d_fy_quarter_seq#2970,d_fy_week_seq#2971,d_day_name#2972,d_quarter_name#2973,d_holiday#2974,d_weekend#2975,d_following_holiday#2976,d_first_dom#2977,d_last_dom#2978,d_same_day_ly#2979,d_same_day_lq#2980,d_current_day#2981,... 4 more fields] orc
            :     :     :                    +- Project [c_customer_sk#2906L, c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922]
            :     :     :                       +- Filter (isnotnull(c_customer_sk#2906L) AND isnotnull(c_customer_id#2907))
            :     :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2906L,c_customer_id#2907,c_current_cdemo_sk#2908L,c_current_hdemo_sk#2909L,c_current_addr_sk#2910L,c_first_shipto_date_sk#2911L,c_first_sales_date_sk#2912L,c_salutation#2913,c_first_name#2914,c_last_name#2915,c_preferred_cust_flag#2916,c_birth_day#2917,c_birth_month#2918,c_birth_year#2919,c_birth_country#2920,c_login#2921,c_email_address#2922,c_last_review_date#2923] orc
            :     :     +- Aggregate [c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, d_year#3203], [c_customer_id#3146 AS customer_id#2567, sum(((((cs_ext_list_price#3187 - cs_ext_wholesale_cost#3186) - cs_ext_discount_amt#3184) + cs_ext_sales_price#3185) / 2.0)) AS year_total#2575]
            :     :        +- Project [c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, cs_ext_discount_amt#3184, cs_ext_sales_price#3185, cs_ext_wholesale_cost#3186, cs_ext_list_price#3187, d_year#3203]
            :     :           +- Join Inner, (c_customer_sk#3145L = cs_bill_customer_sk#3165L)
            :     :              :- Project [cs_bill_customer_sk#3165L, cs_ext_discount_amt#3184, cs_ext_sales_price#3185, cs_ext_wholesale_cost#3186, cs_ext_list_price#3187, d_year#3203]
            :     :              :  +- Join Inner, (cs_sold_date_sk#3196L = d_date_sk#3197L)
            :     :              :     :- Project [cs_bill_customer_sk#3165L, cs_ext_discount_amt#3184, cs_ext_sales_price#3185, cs_ext_wholesale_cost#3186, cs_ext_list_price#3187, cs_sold_date_sk#3196L]
            :     :              :     :  +- Filter ((isnotnull(cs_bill_customer_sk#3165L) AND isnotnull(cs_sold_date_sk#3196L)) AND dynamicpruning#3896 [cs_sold_date_sk#3196L])
            :     :              :     :     :  +- Project [d_date_sk#3197L, d_year#3203]
            :     :              :     :     :     +- Filter ((isnotnull(d_year#3203) AND (d_year#3203 = 2002)) AND isnotnull(d_date_sk#3197L))
            :     :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3197L,d_date_id#3198,d_date#3199,d_month_seq#3200,d_week_seq#3201,d_quarter_seq#3202,d_year#3203,d_dow#3204,d_moy#3205,d_dom#3206,d_qoy#3207,d_fy_year#3208,d_fy_quarter_seq#3209,d_fy_week_seq#3210,d_day_name#3211,d_quarter_name#3212,d_holiday#3213,d_weekend#3214,d_following_holiday#3215,d_first_dom#3216,d_last_dom#3217,d_same_day_ly#3218,d_same_day_lq#3219,d_current_day#3220,... 4 more fields] orc
            :     :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#3163L,cs_ship_date_sk#3164L,cs_bill_customer_sk#3165L,cs_bill_cdemo_sk#3166L,cs_bill_hdemo_sk#3167L,cs_bill_addr_sk#3168L,cs_ship_customer_sk#3169L,cs_ship_cdemo_sk#3170L,cs_ship_hdemo_sk#3171L,cs_ship_addr_sk#3172L,cs_call_center_sk#3173L,cs_catalog_page_sk#3174L,cs_ship_mode_sk#3175L,cs_warehouse_sk#3176L,cs_item_sk#3177L,cs_promo_sk#3178L,cs_order_number#3179L,cs_quantity#3180,cs_wholesale_cost#3181,cs_list_price#3182,cs_sales_price#3183,cs_ext_discount_amt#3184,cs_ext_sales_price#3185,cs_ext_wholesale_cost#3186,... 10 more fields] orc
            :     :              :     +- Project [d_date_sk#3197L, d_year#3203]
            :     :              :        +- Filter ((isnotnull(d_year#3203) AND (d_year#3203 = 2002)) AND isnotnull(d_date_sk#3197L))
            :     :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3197L,d_date_id#3198,d_date#3199,d_month_seq#3200,d_week_seq#3201,d_quarter_seq#3202,d_year#3203,d_dow#3204,d_moy#3205,d_dom#3206,d_qoy#3207,d_fy_year#3208,d_fy_quarter_seq#3209,d_fy_week_seq#3210,d_day_name#3211,d_quarter_name#3212,d_holiday#3213,d_weekend#3214,d_following_holiday#3215,d_first_dom#3216,d_last_dom#3217,d_same_day_ly#3218,d_same_day_lq#3219,d_current_day#3220,... 4 more fields] orc
            :     :              +- Project [c_customer_sk#3145L, c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161]
            :     :                 +- Filter (isnotnull(c_customer_sk#3145L) AND isnotnull(c_customer_id#3146))
            :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3145L,c_customer_id#3146,c_current_cdemo_sk#3147L,c_current_hdemo_sk#3148L,c_current_addr_sk#3149L,c_first_shipto_date_sk#3150L,c_first_sales_date_sk#3151L,c_salutation#3152,c_first_name#3153,c_last_name#3154,c_preferred_cust_flag#3155,c_birth_day#3156,c_birth_month#3157,c_birth_year#3158,c_birth_country#3159,c_login#3160,c_email_address#3161,c_last_review_date#3162] orc
            :     +- Project [customer_id#2305 AS customer_id#3544, year_total#2313 AS year_total#3552]
            :        +- Filter (isnotnull(year_total#2313) AND (year_total#2313 > 0.0))
            :           +- Aggregate [c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, d_year#3522], [c_customer_id#3465 AS customer_id#2305, sum(((((ws_ext_list_price#3506 - ws_ext_wholesale_cost#3505) - ws_ext_discount_amt#3503) + ws_ext_sales_price#3504) / 2.0)) AS year_total#2313]
            :              +- Project [c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, ws_ext_discount_amt#3503, ws_ext_sales_price#3504, ws_ext_wholesale_cost#3505, ws_ext_list_price#3506, d_year#3522]
            :                 +- Join Inner, (c_customer_sk#3464L = ws_bill_customer_sk#3485L)
            :                    :- Project [ws_bill_customer_sk#3485L, ws_ext_discount_amt#3503, ws_ext_sales_price#3504, ws_ext_wholesale_cost#3505, ws_ext_list_price#3506, d_year#3522]
            :                    :  +- Join Inner, (ws_sold_date_sk#3515L = d_date_sk#3516L)
            :                    :     :- Project [ws_bill_customer_sk#3485L, ws_ext_discount_amt#3503, ws_ext_sales_price#3504, ws_ext_wholesale_cost#3505, ws_ext_list_price#3506, ws_sold_date_sk#3515L]
            :                    :     :  +- Filter ((isnotnull(ws_bill_customer_sk#3485L) AND isnotnull(ws_sold_date_sk#3515L)) AND dynamicpruning#3897 [ws_sold_date_sk#3515L])
            :                    :     :     :  +- Project [d_date_sk#3516L, d_year#3522]
            :                    :     :     :     +- Filter ((isnotnull(d_year#3522) AND (d_year#3522 = 2001)) AND isnotnull(d_date_sk#3516L))
            :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3516L,d_date_id#3517,d_date#3518,d_month_seq#3519,d_week_seq#3520,d_quarter_seq#3521,d_year#3522,d_dow#3523,d_moy#3524,d_dom#3525,d_qoy#3526,d_fy_year#3527,d_fy_quarter_seq#3528,d_fy_week_seq#3529,d_day_name#3530,d_quarter_name#3531,d_holiday#3532,d_weekend#3533,d_following_holiday#3534,d_first_dom#3535,d_last_dom#3536,d_same_day_ly#3537,d_same_day_lq#3538,d_current_day#3539,... 4 more fields] orc
            :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#3482L,ws_ship_date_sk#3483L,ws_item_sk#3484L,ws_bill_customer_sk#3485L,ws_bill_cdemo_sk#3486L,ws_bill_hdemo_sk#3487L,ws_bill_addr_sk#3488L,ws_ship_customer_sk#3489L,ws_ship_cdemo_sk#3490L,ws_ship_hdemo_sk#3491L,ws_ship_addr_sk#3492L,ws_web_page_sk#3493L,ws_web_site_sk#3494L,ws_ship_mode_sk#3495L,ws_warehouse_sk#3496L,ws_promo_sk#3497L,ws_order_number#3498L,ws_quantity#3499,ws_wholesale_cost#3500,ws_list_price#3501,ws_sales_price#3502,ws_ext_discount_amt#3503,ws_ext_sales_price#3504,ws_ext_wholesale_cost#3505,... 10 more fields] orc
            :                    :     +- Project [d_date_sk#3516L, d_year#3522]
            :                    :        +- Filter ((isnotnull(d_year#3522) AND (d_year#3522 = 2001)) AND isnotnull(d_date_sk#3516L))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3516L,d_date_id#3517,d_date#3518,d_month_seq#3519,d_week_seq#3520,d_quarter_seq#3521,d_year#3522,d_dow#3523,d_moy#3524,d_dom#3525,d_qoy#3526,d_fy_year#3527,d_fy_quarter_seq#3528,d_fy_week_seq#3529,d_day_name#3530,d_quarter_name#3531,d_holiday#3532,d_weekend#3533,d_following_holiday#3534,d_first_dom#3535,d_last_dom#3536,d_same_day_ly#3537,d_same_day_lq#3538,d_current_day#3539,... 4 more fields] orc
            :                    +- Project [c_customer_sk#3464L, c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480]
            :                       +- Filter (isnotnull(c_customer_sk#3464L) AND isnotnull(c_customer_id#3465))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3464L,c_customer_id#3465,c_current_cdemo_sk#3466L,c_current_hdemo_sk#3467L,c_current_addr_sk#3468L,c_first_shipto_date_sk#3469L,c_first_sales_date_sk#3470L,c_salutation#3471,c_first_name#3472,c_last_name#3473,c_preferred_cust_flag#3474,c_birth_day#3475,c_birth_month#3476,c_birth_year#3477,c_birth_country#3478,c_login#3479,c_email_address#3480,c_last_review_date#3481] orc
            +- Aggregate [c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, d_year#3761], [c_customer_id#3704 AS customer_id#2587, sum(((((ws_ext_list_price#3745 - ws_ext_wholesale_cost#3744) - ws_ext_discount_amt#3742) + ws_ext_sales_price#3743) / 2.0)) AS year_total#2595]
               +- Project [c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, ws_ext_discount_amt#3742, ws_ext_sales_price#3743, ws_ext_wholesale_cost#3744, ws_ext_list_price#3745, d_year#3761]
                  +- Join Inner, (c_customer_sk#3703L = ws_bill_customer_sk#3724L)
                     :- Project [ws_bill_customer_sk#3724L, ws_ext_discount_amt#3742, ws_ext_sales_price#3743, ws_ext_wholesale_cost#3744, ws_ext_list_price#3745, d_year#3761]
                     :  +- Join Inner, (ws_sold_date_sk#3754L = d_date_sk#3755L)
                     :     :- Project [ws_bill_customer_sk#3724L, ws_ext_discount_amt#3742, ws_ext_sales_price#3743, ws_ext_wholesale_cost#3744, ws_ext_list_price#3745, ws_sold_date_sk#3754L]
                     :     :  +- Filter ((isnotnull(ws_bill_customer_sk#3724L) AND isnotnull(ws_sold_date_sk#3754L)) AND dynamicpruning#3898 [ws_sold_date_sk#3754L])
                     :     :     :  +- Project [d_date_sk#3755L, d_year#3761]
                     :     :     :     +- Filter ((isnotnull(d_year#3761) AND (d_year#3761 = 2002)) AND isnotnull(d_date_sk#3755L))
                     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3755L,d_date_id#3756,d_date#3757,d_month_seq#3758,d_week_seq#3759,d_quarter_seq#3760,d_year#3761,d_dow#3762,d_moy#3763,d_dom#3764,d_qoy#3765,d_fy_year#3766,d_fy_quarter_seq#3767,d_fy_week_seq#3768,d_day_name#3769,d_quarter_name#3770,d_holiday#3771,d_weekend#3772,d_following_holiday#3773,d_first_dom#3774,d_last_dom#3775,d_same_day_ly#3776,d_same_day_lq#3777,d_current_day#3778,... 4 more fields] orc
                     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#3721L,ws_ship_date_sk#3722L,ws_item_sk#3723L,ws_bill_customer_sk#3724L,ws_bill_cdemo_sk#3725L,ws_bill_hdemo_sk#3726L,ws_bill_addr_sk#3727L,ws_ship_customer_sk#3728L,ws_ship_cdemo_sk#3729L,ws_ship_hdemo_sk#3730L,ws_ship_addr_sk#3731L,ws_web_page_sk#3732L,ws_web_site_sk#3733L,ws_ship_mode_sk#3734L,ws_warehouse_sk#3735L,ws_promo_sk#3736L,ws_order_number#3737L,ws_quantity#3738,ws_wholesale_cost#3739,ws_list_price#3740,ws_sales_price#3741,ws_ext_discount_amt#3742,ws_ext_sales_price#3743,ws_ext_wholesale_cost#3744,... 10 more fields] orc
                     :     +- Project [d_date_sk#3755L, d_year#3761]
                     :        +- Filter ((isnotnull(d_year#3761) AND (d_year#3761 = 2002)) AND isnotnull(d_date_sk#3755L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3755L,d_date_id#3756,d_date#3757,d_month_seq#3758,d_week_seq#3759,d_quarter_seq#3760,d_year#3761,d_dow#3762,d_moy#3763,d_dom#3764,d_qoy#3765,d_fy_year#3766,d_fy_quarter_seq#3767,d_fy_week_seq#3768,d_day_name#3769,d_quarter_name#3770,d_holiday#3771,d_weekend#3772,d_following_holiday#3773,d_first_dom#3774,d_last_dom#3775,d_same_day_ly#3776,d_same_day_lq#3777,d_current_day#3778,... 4 more fields] orc
                     +- Project [c_customer_sk#3703L, c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719]
                        +- Filter (isnotnull(c_customer_sk#3703L) AND isnotnull(c_customer_id#3704))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3703L,c_customer_id#3704,c_current_cdemo_sk#3705L,c_current_hdemo_sk#3706L,c_current_addr_sk#3707L,c_first_shipto_date_sk#3708L,c_first_sales_date_sk#3709L,c_salutation#3710,c_first_name#3711,c_last_name#3712,c_preferred_cust_flag#3713,c_birth_day#3714,c_birth_month#3715,c_birth_year#3716,c_birth_country#3717,c_login#3718,c_email_address#3719,c_last_review_date#3720] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[customer_preferred_cust_flag#2550 ASC NULLS FIRST], output=[customer_preferred_cust_flag#2550])
   +- Project [customer_preferred_cust_flag#2550]
      +- SortMergeJoin [customer_id#2285], [customer_id#2587], Inner, (CASE WHEN (year_total#3074 > 0.0) THEN (year_total#2575 / year_total#3074) END > CASE WHEN (year_total#3552 > 0.0) THEN (year_total#2595 / year_total#3552) END)
         :- Project [customer_id#2285, customer_preferred_cust_flag#2550, year_total#3074, year_total#2575, year_total#3552]
         :  +- SortMergeJoin [customer_id#2285], [customer_id#3544], Inner
         :     :- Project [customer_id#2285, customer_preferred_cust_flag#2550, year_total#3074, year_total#2575]
         :     :  +- SortMergeJoin [customer_id#2285], [customer_id#2567], Inner, (CASE WHEN (year_total#3074 > 0.0) THEN (year_total#2575 / year_total#3074) END > CASE WHEN (year_total#2293 > 0.0) THEN (year_total#2555 / year_total#2293) END)
         :     :     :- Project [customer_id#2285, year_total#2293, customer_preferred_cust_flag#2550, year_total#2555, year_total#3074]
         :     :     :  +- SortMergeJoin [customer_id#2285], [customer_id#3066], Inner
         :     :     :     :- Project [customer_id#2285, year_total#2293, customer_preferred_cust_flag#2550, year_total#2555]
         :     :     :     :  +- SortMergeJoin [customer_id#2285], [customer_id#2547], Inner
         :     :     :     :     :- Sort [customer_id#2285 ASC NULLS FIRST], false, 0
         :     :     :     :     :  +- Exchange hashpartitioning(customer_id#2285, 3000), ENSURE_REQUIREMENTS, [id=#1939]
         :     :     :     :     :     +- Filter (isnotnull(year_total#2293) AND (year_total#2293 > 0.0))
         :     :     :     :     :        +- HashAggregate(keys=[c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362], functions=[sum(((((ss_ext_list_price#2349 - ss_ext_wholesale_cost#2348) - ss_ext_discount_amt#2346) + ss_ext_sales_price#2347) / 2.0))], output=[customer_id#2285, year_total#2293])
         :     :     :     :     :           +- Exchange hashpartitioning(c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362, 3000), ENSURE_REQUIREMENTS, [id=#1919]
         :     :     :     :     :              +- HashAggregate(keys=[c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362], functions=[partial_sum(((((ss_ext_list_price#2349 - ss_ext_wholesale_cost#2348) - ss_ext_discount_amt#2346) + ss_ext_sales_price#2347) / 2.0))], output=[c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, d_year#2362, sum#3900])
         :     :     :     :     :                 +- Project [c_customer_id#2316, c_first_name#2323, c_last_name#2324, c_preferred_cust_flag#2325, c_birth_country#2329, c_login#2330, c_email_address#2331, ss_ext_discount_amt#2346, ss_ext_sales_price#2347, ss_ext_wholesale_cost#2348, ss_ext_list_price#2349, d_year#2362]
         :     :     :     :     :                    +- SortMergeJoin [ss_customer_sk#2335L], [c_customer_sk#2315L], Inner
         :     :     :     :     :                       :- Sort [ss_customer_sk#2335L ASC NULLS FIRST], false, 0
         :     :     :     :     :                       :  +- Exchange hashpartitioning(ss_customer_sk#2335L, 3000), ENSURE_REQUIREMENTS, [id=#1911]
         :     :     :     :     :                       :     +- Project [ss_customer_sk#2335L, ss_ext_discount_amt#2346, ss_ext_sales_price#2347, ss_ext_wholesale_cost#2348, ss_ext_list_price#2349, d_year#2362]
         :     :     :     :     :                       :        +- BroadcastHashJoin [ss_sold_date_sk#2355L], [d_date_sk#2356L], Inner, BuildRight, false
         :     :     :     :     :                       :           :- Filter isnotnull(ss_customer_sk#2335L)
         :     :     :     :     :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#2335L,ss_ext_discount_amt#2346,ss_ext_sales_price#2347,ss_ext_wholesale_cost#2348,ss_ext_list_price#2349,ss_sold_date_sk#2355L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#2335L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#2355L), dynamicpruningexpression(ss_sold_date_sk#2355L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_ext_discount_amt:double,ss_ext_sales_price:double,ss_ext_wholesal...
         :     :     :     :     :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3893, 0, true, Project [d_date_sk#2356L, d_year#2362], [d_date_sk#2356L]
         :     :     :     :     :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :     :     :     :                       :           :              +- Filter ((isnotnull(d_year#2362) AND (d_year#2362 = 2001)) AND isnotnull(d_date_sk#2356L))
         :     :     :     :     :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2356L,d_year#2362] Batched: true, DataFilters: [isnotnull(d_year#2362), (d_year#2362 = 2001), isnotnull(d_date_sk#2356L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :     :     :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1906]
         :     :     :     :     :                       :              +- Filter ((isnotnull(d_year#2362) AND (d_year#2362 = 2001)) AND isnotnull(d_date_sk#2356L))
         :     :     :     :     :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2356L,d_year#2362] Batched: true, DataFilters: [isnotnull(d_year#2362), (d_year#2362 = 2001), isnotnull(d_date_sk#2356L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :     :     :                       +- Sort [c_customer_sk#2315L ASC NULLS FIRST], false, 0
         :     :     :     :     :                          +- Exchange hashpartitioning(c_customer_sk#2315L, 3000), ENSURE_REQUIREMENTS, [id=#1912]
         :     :     :     :     :                             +- Filter (isnotnull(c_customer_sk#2315L) AND isnotnull(c_customer_id#2316))
         :     :     :     :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2315L,c_customer_id#2316,c_first_name#2323,c_last_name#2324,c_preferred_cust_flag#2325,c_birth_country#2329,c_login#2330,c_email_address#2331] Batched: true, DataFilters: [isnotnull(c_customer_sk#2315L), isnotnull(c_customer_id#2316)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     :     :     :     +- Sort [customer_id#2547 ASC NULLS FIRST], false, 0
         :     :     :     :        +- Exchange hashpartitioning(customer_id#2547, 3000), ENSURE_REQUIREMENTS, [id=#1940]
         :     :     :     :           +- HashAggregate(keys=[c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, d_year#2645], functions=[sum(((((ss_ext_list_price#2632 - ss_ext_wholesale_cost#2631) - ss_ext_discount_amt#2629) + ss_ext_sales_price#2630) / 2.0))], output=[customer_id#2547, customer_preferred_cust_flag#2550, year_total#2555])
         :     :     :     :              +- Exchange hashpartitioning(c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, d_year#2645, 3000), ENSURE_REQUIREMENTS, [id=#1935]
         :     :     :     :                 +- HashAggregate(keys=[c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, d_year#2645], functions=[partial_sum(((((ss_ext_list_price#2632 - ss_ext_wholesale_cost#2631) - ss_ext_discount_amt#2629) + ss_ext_sales_price#2630) / 2.0))], output=[c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, d_year#2645, sum#3902])
         :     :     :     :                    +- Project [c_customer_id#2599, c_first_name#2606, c_last_name#2607, c_preferred_cust_flag#2608, c_birth_country#2612, c_login#2613, c_email_address#2614, ss_ext_discount_amt#2629, ss_ext_sales_price#2630, ss_ext_wholesale_cost#2631, ss_ext_list_price#2632, d_year#2645]
         :     :     :     :                       +- SortMergeJoin [ss_customer_sk#2618L], [c_customer_sk#2598L], Inner
         :     :     :     :                          :- Sort [ss_customer_sk#2618L ASC NULLS FIRST], false, 0
         :     :     :     :                          :  +- Exchange hashpartitioning(ss_customer_sk#2618L, 3000), ENSURE_REQUIREMENTS, [id=#1927]
         :     :     :     :                          :     +- Project [ss_customer_sk#2618L, ss_ext_discount_amt#2629, ss_ext_sales_price#2630, ss_ext_wholesale_cost#2631, ss_ext_list_price#2632, d_year#2645]
         :     :     :     :                          :        +- BroadcastHashJoin [ss_sold_date_sk#2638L], [d_date_sk#2639L], Inner, BuildRight, false
         :     :     :     :                          :           :- Filter isnotnull(ss_customer_sk#2618L)
         :     :     :     :                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#2618L,ss_ext_discount_amt#2629,ss_ext_sales_price#2630,ss_ext_wholesale_cost#2631,ss_ext_list_price#2632,ss_sold_date_sk#2638L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#2618L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#2638L), dynamicpruningexpression(ss_sold_date_sk#2638L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_ext_discount_amt:double,ss_ext_sales_price:double,ss_ext_wholesal...
         :     :     :     :                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3894, 0, true, Project [d_date_sk#2639L, d_year#2645], [d_date_sk#2639L]
         :     :     :     :                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :     :     :                          :           :              +- Filter ((isnotnull(d_year#2645) AND (d_year#2645 = 2002)) AND isnotnull(d_date_sk#2639L))
         :     :     :     :                          :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2639L,d_year#2645] Batched: true, DataFilters: [isnotnull(d_year#2645), (d_year#2645 = 2002), isnotnull(d_date_sk#2639L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :     :                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1922]
         :     :     :     :                          :              +- Filter ((isnotnull(d_year#2645) AND (d_year#2645 = 2002)) AND isnotnull(d_date_sk#2639L))
         :     :     :     :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2639L,d_year#2645] Batched: true, DataFilters: [isnotnull(d_year#2645), (d_year#2645 = 2002), isnotnull(d_date_sk#2639L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :     :                          +- Sort [c_customer_sk#2598L ASC NULLS FIRST], false, 0
         :     :     :     :                             +- Exchange hashpartitioning(c_customer_sk#2598L, 3000), ENSURE_REQUIREMENTS, [id=#1928]
         :     :     :     :                                +- Filter (isnotnull(c_customer_sk#2598L) AND isnotnull(c_customer_id#2599))
         :     :     :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2598L,c_customer_id#2599,c_first_name#2606,c_last_name#2607,c_preferred_cust_flag#2608,c_birth_country#2612,c_login#2613,c_email_address#2614] Batched: true, DataFilters: [isnotnull(c_customer_sk#2598L), isnotnull(c_customer_id#2599)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     :     :     +- Sort [customer_id#3066 ASC NULLS FIRST], false, 0
         :     :     :        +- Exchange hashpartitioning(customer_id#3066, 3000), ENSURE_REQUIREMENTS, [id=#1964]
         :     :     :           +- Project [customer_id#2295 AS customer_id#3066, year_total#2303 AS year_total#3074]
         :     :     :              +- Filter (isnotnull(year_total#2303) AND (year_total#2303 > 0.0))
         :     :     :                 +- HashAggregate(keys=[c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, d_year#2964], functions=[sum(((((cs_ext_list_price#2948 - cs_ext_wholesale_cost#2947) - cs_ext_discount_amt#2945) + cs_ext_sales_price#2946) / 2.0))], output=[customer_id#2295, year_total#2303])
         :     :     :                    +- Exchange hashpartitioning(c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, d_year#2964, 3000), ENSURE_REQUIREMENTS, [id=#1958]
         :     :     :                       +- HashAggregate(keys=[c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, d_year#2964], functions=[partial_sum(((((cs_ext_list_price#2948 - cs_ext_wholesale_cost#2947) - cs_ext_discount_amt#2945) + cs_ext_sales_price#2946) / 2.0))], output=[c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, d_year#2964, sum#3904])
         :     :     :                          +- Project [c_customer_id#2907, c_first_name#2914, c_last_name#2915, c_preferred_cust_flag#2916, c_birth_country#2920, c_login#2921, c_email_address#2922, cs_ext_discount_amt#2945, cs_ext_sales_price#2946, cs_ext_wholesale_cost#2947, cs_ext_list_price#2948, d_year#2964]
         :     :     :                             +- SortMergeJoin [cs_bill_customer_sk#2926L], [c_customer_sk#2906L], Inner
         :     :     :                                :- Sort [cs_bill_customer_sk#2926L ASC NULLS FIRST], false, 0
         :     :     :                                :  +- Exchange hashpartitioning(cs_bill_customer_sk#2926L, 3000), ENSURE_REQUIREMENTS, [id=#1950]
         :     :     :                                :     +- Project [cs_bill_customer_sk#2926L, cs_ext_discount_amt#2945, cs_ext_sales_price#2946, cs_ext_wholesale_cost#2947, cs_ext_list_price#2948, d_year#2964]
         :     :     :                                :        +- BroadcastHashJoin [cs_sold_date_sk#2957L], [d_date_sk#2958L], Inner, BuildRight, false
         :     :     :                                :           :- Filter isnotnull(cs_bill_customer_sk#2926L)
         :     :     :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#2926L,cs_ext_discount_amt#2945,cs_ext_sales_price#2946,cs_ext_wholesale_cost#2947,cs_ext_list_price#2948,cs_sold_date_sk#2957L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#2926L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#2957L), dynamicpruningexpression(cs_sold_date_sk#2957L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_ext_discount_amt:double,cs_ext_sales_price:double,cs_ext_who...
         :     :     :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3895, 0, true, Project [d_date_sk#2958L, d_year#2964], [d_date_sk#2958L]
         :     :     :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :     :                                :           :              +- Filter ((isnotnull(d_year#2964) AND (d_year#2964 = 2001)) AND isnotnull(d_date_sk#2958L))
         :     :     :                                :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2958L,d_year#2964] Batched: true, DataFilters: [isnotnull(d_year#2964), (d_year#2964 = 2001), isnotnull(d_date_sk#2958L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1945]
         :     :     :                                :              +- Filter ((isnotnull(d_year#2964) AND (d_year#2964 = 2001)) AND isnotnull(d_date_sk#2958L))
         :     :     :                                :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#2958L,d_year#2964] Batched: true, DataFilters: [isnotnull(d_year#2964), (d_year#2964 = 2001), isnotnull(d_date_sk#2958L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :                                +- Sort [c_customer_sk#2906L ASC NULLS FIRST], false, 0
         :     :     :                                   +- Exchange hashpartitioning(c_customer_sk#2906L, 3000), ENSURE_REQUIREMENTS, [id=#1951]
         :     :     :                                      +- Filter (isnotnull(c_customer_sk#2906L) AND isnotnull(c_customer_id#2907))
         :     :     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#2906L,c_customer_id#2907,c_first_name#2914,c_last_name#2915,c_preferred_cust_flag#2916,c_birth_country#2920,c_login#2921,c_email_address#2922] Batched: true, DataFilters: [isnotnull(c_customer_sk#2906L), isnotnull(c_customer_id#2907)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     :     +- Sort [customer_id#2567 ASC NULLS FIRST], false, 0
         :     :        +- Exchange hashpartitioning(customer_id#2567, 3000), ENSURE_REQUIREMENTS, [id=#1985]
         :     :           +- HashAggregate(keys=[c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, d_year#3203], functions=[sum(((((cs_ext_list_price#3187 - cs_ext_wholesale_cost#3186) - cs_ext_discount_amt#3184) + cs_ext_sales_price#3185) / 2.0))], output=[customer_id#2567, year_total#2575])
         :     :              +- Exchange hashpartitioning(c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, d_year#3203, 3000), ENSURE_REQUIREMENTS, [id=#1981]
         :     :                 +- HashAggregate(keys=[c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, d_year#3203], functions=[partial_sum(((((cs_ext_list_price#3187 - cs_ext_wholesale_cost#3186) - cs_ext_discount_amt#3184) + cs_ext_sales_price#3185) / 2.0))], output=[c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, d_year#3203, sum#3906])
         :     :                    +- Project [c_customer_id#3146, c_first_name#3153, c_last_name#3154, c_preferred_cust_flag#3155, c_birth_country#3159, c_login#3160, c_email_address#3161, cs_ext_discount_amt#3184, cs_ext_sales_price#3185, cs_ext_wholesale_cost#3186, cs_ext_list_price#3187, d_year#3203]
         :     :                       +- SortMergeJoin [cs_bill_customer_sk#3165L], [c_customer_sk#3145L], Inner
         :     :                          :- Sort [cs_bill_customer_sk#3165L ASC NULLS FIRST], false, 0
         :     :                          :  +- Exchange hashpartitioning(cs_bill_customer_sk#3165L, 3000), ENSURE_REQUIREMENTS, [id=#1973]
         :     :                          :     +- Project [cs_bill_customer_sk#3165L, cs_ext_discount_amt#3184, cs_ext_sales_price#3185, cs_ext_wholesale_cost#3186, cs_ext_list_price#3187, d_year#3203]
         :     :                          :        +- BroadcastHashJoin [cs_sold_date_sk#3196L], [d_date_sk#3197L], Inner, BuildRight, false
         :     :                          :           :- Filter isnotnull(cs_bill_customer_sk#3165L)
         :     :                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#3165L,cs_ext_discount_amt#3184,cs_ext_sales_price#3185,cs_ext_wholesale_cost#3186,cs_ext_list_price#3187,cs_sold_date_sk#3196L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#3165L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#3196L), dynamicpruningexpression(cs_sold_date_sk#3196L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_ext_discount_amt:double,cs_ext_sales_price:double,cs_ext_who...
         :     :                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3896, 0, true, Project [d_date_sk#3197L, d_year#3203], [d_date_sk#3197L]
         :     :                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                          :           :              +- Filter ((isnotnull(d_year#3203) AND (d_year#3203 = 2002)) AND isnotnull(d_date_sk#3197L))
         :     :                          :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3197L,d_year#3203] Batched: true, DataFilters: [isnotnull(d_year#3203), (d_year#3203 = 2002), isnotnull(d_date_sk#3197L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1968]
         :     :                          :              +- Filter ((isnotnull(d_year#3203) AND (d_year#3203 = 2002)) AND isnotnull(d_date_sk#3197L))
         :     :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3197L,d_year#3203] Batched: true, DataFilters: [isnotnull(d_year#3203), (d_year#3203 = 2002), isnotnull(d_date_sk#3197L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                          +- Sort [c_customer_sk#3145L ASC NULLS FIRST], false, 0
         :     :                             +- Exchange hashpartitioning(c_customer_sk#3145L, 3000), ENSURE_REQUIREMENTS, [id=#1974]
         :     :                                +- Filter (isnotnull(c_customer_sk#3145L) AND isnotnull(c_customer_id#3146))
         :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3145L,c_customer_id#3146,c_first_name#3153,c_last_name#3154,c_preferred_cust_flag#3155,c_birth_country#3159,c_login#3160,c_email_address#3161] Batched: true, DataFilters: [isnotnull(c_customer_sk#3145L), isnotnull(c_customer_id#3146)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     +- Sort [customer_id#3544 ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(customer_id#3544, 3000), ENSURE_REQUIREMENTS, [id=#2008]
         :           +- Project [customer_id#2305 AS customer_id#3544, year_total#2313 AS year_total#3552]
         :              +- Filter (isnotnull(year_total#2313) AND (year_total#2313 > 0.0))
         :                 +- HashAggregate(keys=[c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, d_year#3522], functions=[sum(((((ws_ext_list_price#3506 - ws_ext_wholesale_cost#3505) - ws_ext_discount_amt#3503) + ws_ext_sales_price#3504) / 2.0))], output=[customer_id#2305, year_total#2313])
         :                    +- Exchange hashpartitioning(c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, d_year#3522, 3000), ENSURE_REQUIREMENTS, [id=#2002]
         :                       +- HashAggregate(keys=[c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, d_year#3522], functions=[partial_sum(((((ws_ext_list_price#3506 - ws_ext_wholesale_cost#3505) - ws_ext_discount_amt#3503) + ws_ext_sales_price#3504) / 2.0))], output=[c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, d_year#3522, sum#3908])
         :                          +- Project [c_customer_id#3465, c_first_name#3472, c_last_name#3473, c_preferred_cust_flag#3474, c_birth_country#3478, c_login#3479, c_email_address#3480, ws_ext_discount_amt#3503, ws_ext_sales_price#3504, ws_ext_wholesale_cost#3505, ws_ext_list_price#3506, d_year#3522]
         :                             +- SortMergeJoin [ws_bill_customer_sk#3485L], [c_customer_sk#3464L], Inner
         :                                :- Sort [ws_bill_customer_sk#3485L ASC NULLS FIRST], false, 0
         :                                :  +- Exchange hashpartitioning(ws_bill_customer_sk#3485L, 3000), ENSURE_REQUIREMENTS, [id=#1994]
         :                                :     +- Project [ws_bill_customer_sk#3485L, ws_ext_discount_amt#3503, ws_ext_sales_price#3504, ws_ext_wholesale_cost#3505, ws_ext_list_price#3506, d_year#3522]
         :                                :        +- BroadcastHashJoin [ws_sold_date_sk#3515L], [d_date_sk#3516L], Inner, BuildRight, false
         :                                :           :- Filter isnotnull(ws_bill_customer_sk#3485L)
         :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#3485L,ws_ext_discount_amt#3503,ws_ext_sales_price#3504,ws_ext_wholesale_cost#3505,ws_ext_list_price#3506,ws_sold_date_sk#3515L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#3485L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#3515L), dynamicpruningexpression(ws_sold_date_sk#3515L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_ext_discount_amt:double,ws_ext_sales_price:double,ws_ext_who...
         :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3897, 0, true, Project [d_date_sk#3516L, d_year#3522], [d_date_sk#3516L]
         :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                :           :              +- Filter ((isnotnull(d_year#3522) AND (d_year#3522 = 2001)) AND isnotnull(d_date_sk#3516L))
         :                                :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3516L,d_year#3522] Batched: true, DataFilters: [isnotnull(d_year#3522), (d_year#3522 = 2001), isnotnull(d_date_sk#3516L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#1989]
         :                                :              +- Filter ((isnotnull(d_year#3522) AND (d_year#3522 = 2001)) AND isnotnull(d_date_sk#3516L))
         :                                :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3516L,d_year#3522] Batched: true, DataFilters: [isnotnull(d_year#3522), (d_year#3522 = 2001), isnotnull(d_date_sk#3516L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                +- Sort [c_customer_sk#3464L ASC NULLS FIRST], false, 0
         :                                   +- Exchange hashpartitioning(c_customer_sk#3464L, 3000), ENSURE_REQUIREMENTS, [id=#1995]
         :                                      +- Filter (isnotnull(c_customer_sk#3464L) AND isnotnull(c_customer_id#3465))
         :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3464L,c_customer_id#3465,c_first_name#3472,c_last_name#3473,c_preferred_cust_flag#3474,c_birth_country#3478,c_login#3479,c_email_address#3480] Batched: true, DataFilters: [isnotnull(c_customer_sk#3464L), isnotnull(c_customer_id#3465)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         +- Sort [customer_id#2587 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(customer_id#2587, 3000), ENSURE_REQUIREMENTS, [id=#2029]
               +- HashAggregate(keys=[c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, d_year#3761], functions=[sum(((((ws_ext_list_price#3745 - ws_ext_wholesale_cost#3744) - ws_ext_discount_amt#3742) + ws_ext_sales_price#3743) / 2.0))], output=[customer_id#2587, year_total#2595])
                  +- Exchange hashpartitioning(c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, d_year#3761, 3000), ENSURE_REQUIREMENTS, [id=#2025]
                     +- HashAggregate(keys=[c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, d_year#3761], functions=[partial_sum(((((ws_ext_list_price#3745 - ws_ext_wholesale_cost#3744) - ws_ext_discount_amt#3742) + ws_ext_sales_price#3743) / 2.0))], output=[c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, d_year#3761, sum#3910])
                        +- Project [c_customer_id#3704, c_first_name#3711, c_last_name#3712, c_preferred_cust_flag#3713, c_birth_country#3717, c_login#3718, c_email_address#3719, ws_ext_discount_amt#3742, ws_ext_sales_price#3743, ws_ext_wholesale_cost#3744, ws_ext_list_price#3745, d_year#3761]
                           +- SortMergeJoin [ws_bill_customer_sk#3724L], [c_customer_sk#3703L], Inner
                              :- Sort [ws_bill_customer_sk#3724L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_bill_customer_sk#3724L, 3000), ENSURE_REQUIREMENTS, [id=#2017]
                              :     +- Project [ws_bill_customer_sk#3724L, ws_ext_discount_amt#3742, ws_ext_sales_price#3743, ws_ext_wholesale_cost#3744, ws_ext_list_price#3745, d_year#3761]
                              :        +- BroadcastHashJoin [ws_sold_date_sk#3754L], [d_date_sk#3755L], Inner, BuildRight, false
                              :           :- Filter isnotnull(ws_bill_customer_sk#3724L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#3724L,ws_ext_discount_amt#3742,ws_ext_sales_price#3743,ws_ext_wholesale_cost#3744,ws_ext_list_price#3745,ws_sold_date_sk#3754L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#3724L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#3754L), dynamicpruningexpression(ws_sold_date_sk#3754L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_ext_discount_amt:double,ws_ext_sales_price:double,ws_ext_who...
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#3898, 0, true, Project [d_date_sk#3755L, d_year#3761], [d_date_sk#3755L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Filter ((isnotnull(d_year#3761) AND (d_year#3761 = 2002)) AND isnotnull(d_date_sk#3755L))
                              :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3755L,d_year#3761] Batched: true, DataFilters: [isnotnull(d_year#3761), (d_year#3761 = 2002), isnotnull(d_date_sk#3755L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#2012]
                              :              +- Filter ((isnotnull(d_year#3761) AND (d_year#3761 = 2002)) AND isnotnull(d_date_sk#3755L))
                              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#3755L,d_year#3761] Batched: true, DataFilters: [isnotnull(d_year#3761), (d_year#3761 = 2002), isnotnull(d_date_sk#3755L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              +- Sort [c_customer_sk#3703L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(c_customer_sk#3703L, 3000), ENSURE_REQUIREMENTS, [id=#2018]
                                    +- Filter (isnotnull(c_customer_sk#3703L) AND isnotnull(c_customer_id#3704))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#3703L,c_customer_id#3704,c_first_name#3711,c_last_name#3712,c_preferred_cust_flag#3713,c_birth_country#3717,c_login#3718,c_email_address#3719] Batched: true, DataFilters: [isnotnull(c_customer_sk#3703L), isnotnull(c_customer_id#3704)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...

read query: spark_queries/q5.sql
explain query: q5
== Parsed Logical Plan ==
CTE [ssr, csr, wsr]
:  :- 'SubqueryAlias ssr
:  :  +- 'Aggregate ['s_store_id], ['s_store_id, 'sum('sales_price) AS sales#3935, 'sum('profit) AS profit#3936, 'sum('return_amt) AS returns#3937, 'sum('net_loss) AS profit_loss#3938]
:  :     +- 'Filter ((('date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '14' DAY)))) AND ('store_sk = 's_store_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'SubqueryAlias salesreturns
:  :           :  :  +- 'Union false, false
:  :           :  :     :- 'Project ['ss_store_sk AS store_sk#3923, 'ss_sold_date_sk AS date_sk#3924, 'ss_ext_sales_price AS sales_price#3925, 'ss_net_profit AS profit#3926, cast(0 as decimal(7,2)) AS return_amt#3927, cast(0 as decimal(7,2)) AS net_loss#3928]
:  :           :  :     :  +- 'UnresolvedRelation [store_sales], [], false
:  :           :  :     +- 'Project ['sr_store_sk AS store_sk#3929, 'sr_returned_date_sk AS date_sk#3930, cast(0 as decimal(7,2)) AS sales_price#3931, cast(0 as decimal(7,2)) AS profit#3932, 'sr_return_amt AS return_amt#3933, 'sr_net_loss AS net_loss#3934]
:  :           :  :        +- 'UnresolvedRelation [store_returns], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [store], [], false
:  :- 'SubqueryAlias csr
:  :  +- 'Aggregate ['cp_catalog_page_id], ['cp_catalog_page_id, 'sum('sales_price) AS sales#3951, 'sum('profit) AS profit#3952, 'sum('return_amt) AS returns#3953, 'sum('net_loss) AS profit_loss#3954]
:  :     +- 'Filter ((('date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '14' DAY)))) AND ('page_sk = 'cp_catalog_page_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'SubqueryAlias salesreturns
:  :           :  :  +- 'Union false, false
:  :           :  :     :- 'Project ['cs_catalog_page_sk AS page_sk#3939, 'cs_sold_date_sk AS date_sk#3940, 'cs_ext_sales_price AS sales_price#3941, 'cs_net_profit AS profit#3942, cast(0 as decimal(7,2)) AS return_amt#3943, cast(0 as decimal(7,2)) AS net_loss#3944]
:  :           :  :     :  +- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  :     +- 'Project ['cr_catalog_page_sk AS page_sk#3945, 'cr_returned_date_sk AS date_sk#3946, cast(0 as decimal(7,2)) AS sales_price#3947, cast(0 as decimal(7,2)) AS profit#3948, 'cr_return_amount AS return_amt#3949, 'cr_net_loss AS net_loss#3950]
:  :           :  :        +- 'UnresolvedRelation [catalog_returns], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [catalog_page], [], false
:  +- 'SubqueryAlias wsr
:     +- 'Aggregate ['web_site_id], ['web_site_id, 'sum('sales_price) AS sales#3967, 'sum('profit) AS profit#3968, 'sum('return_amt) AS returns#3969, 'sum('net_loss) AS profit_loss#3970]
:        +- 'Filter ((('date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '14' DAY)))) AND ('wsr_web_site_sk = 'web_site_sk))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'SubqueryAlias salesreturns
:              :  :  +- 'Union false, false
:              :  :     :- 'Project ['ws_web_site_sk AS wsr_web_site_sk#3955, 'ws_sold_date_sk AS date_sk#3956, 'ws_ext_sales_price AS sales_price#3957, 'ws_net_profit AS profit#3958, cast(0 as decimal(7,2)) AS return_amt#3959, cast(0 as decimal(7,2)) AS net_loss#3960]
:              :  :     :  +- 'UnresolvedRelation [web_sales], [], false
:              :  :     +- 'Project ['ws_web_site_sk AS wsr_web_site_sk#3961, 'wr_returned_date_sk AS date_sk#3962, cast(0 as decimal(7,2)) AS sales_price#3963, cast(0 as decimal(7,2)) AS profit#3964, 'wr_return_amt AS return_amt#3965, 'wr_net_loss AS net_loss#3966]
:              :  :        +- 'Join LeftOuter, (('wr_item_sk = 'ws_item_sk) AND ('wr_order_number = 'ws_order_number))
:              :  :           :- 'UnresolvedRelation [web_returns], [], false
:              :  :           +- 'UnresolvedRelation [web_sales], [], false
:              :  +- 'UnresolvedRelation [date_dim], [], false
:              +- 'UnresolvedRelation [web_site], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true
         +- 'Aggregate [rollup(Vector(0), Vector(1), 'channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#3920, 'sum('returns) AS returns#3921, 'sum('profit) AS profit#3922]
            +- 'SubqueryAlias x
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [store channel AS channel#3911, concat(store, 's_store_id) AS id#3912, 'sales, 'returns, ('profit - 'profit_loss) AS profit#3913]
                  :  :  +- 'UnresolvedRelation [ssr], [], false
                  :  +- 'Project [catalog channel AS channel#3914, concat(catalog_page, 'cp_catalog_page_id) AS id#3915, 'sales, 'returns, ('profit - 'profit_loss) AS profit#3916]
                  :     +- 'UnresolvedRelation [csr], [], false
                  +- 'Project [web channel AS channel#3917, concat(web_site, 'web_site_id) AS id#3918, 'sales, 'returns, ('profit - 'profit_loss) AS profit#3919]
                     +- 'UnresolvedRelation [wsr], [], false

== Analyzed Logical Plan ==
channel: string, id: string, sales: double, returns: double, profit: double
WithCTE
:- CTERelationDef 4
:  +- SubqueryAlias ssr
:     +- Aggregate [s_store_id#4043], [s_store_id#4043, sum(sales_price#3925) AS sales#3935, sum(profit#3926) AS profit#3936, sum(return_amt#4315) AS returns#3937, sum(net_loss#4316) AS profit_loss#3938]
:        +- Filter (((date_sk#3924L = d_date_sk#4014L) AND ((d_date#4016 >= cast(1998-08-04 as date)) AND (d_date#4016 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '14' DAY))))) AND (store_sk#3923L = s_store_sk#4042L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias salesreturns
:              :  :  +- Union false, false
:              :  :     :- Project [store_sk#3923L, date_sk#3924L, sales_price#3925, profit#3926, cast(return_amt#3927 as double) AS return_amt#4315, cast(net_loss#3928 as double) AS net_loss#4316]
:              :  :     :  +- Project [ss_store_sk#3977L AS store_sk#3923L, ss_sold_date_sk#3993L AS date_sk#3924L, ss_ext_sales_price#3985 AS sales_price#3925, ss_net_profit#3992 AS profit#3926, cast(0 as decimal(7,2)) AS return_amt#3927, cast(0 as decimal(7,2)) AS net_loss#3928]
:              :  :     :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#3971L,ss_item_sk#3972L,ss_customer_sk#3973L,ss_cdemo_sk#3974L,ss_hdemo_sk#3975L,ss_addr_sk#3976L,ss_store_sk#3977L,ss_promo_sk#3978L,ss_ticket_number#3979L,ss_quantity#3980,ss_wholesale_cost#3981,ss_list_price#3982,ss_sales_price#3983,ss_ext_discount_amt#3984,ss_ext_sales_price#3985,ss_ext_wholesale_cost#3986,ss_ext_list_price#3987,ss_ext_tax#3988,ss_coupon_amt#3989,ss_net_paid#3990,ss_net_paid_inc_tax#3991,ss_net_profit#3992,ss_sold_date_sk#3993L] orc
:              :  :     +- Project [store_sk#3929L, date_sk#3930L, cast(sales_price#3931 as double) AS sales_price#4317, cast(profit#3932 as double) AS profit#4318, return_amt#3933, net_loss#3934]
:              :  :        +- Project [sr_store_sk#4000L AS store_sk#3929L, sr_returned_date_sk#4013L AS date_sk#3930L, cast(0 as decimal(7,2)) AS sales_price#3931, cast(0 as decimal(7,2)) AS profit#3932, sr_return_amt#4004 AS return_amt#3933, sr_net_loss#4012 AS net_loss#3934]
:              :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#3994L,sr_item_sk#3995L,sr_customer_sk#3996L,sr_cdemo_sk#3997L,sr_hdemo_sk#3998L,sr_addr_sk#3999L,sr_store_sk#4000L,sr_reason_sk#4001L,sr_ticket_number#4002L,sr_return_quantity#4003,sr_return_amt#4004,sr_return_tax#4005,sr_return_amt_inc_tax#4006,sr_fee#4007,sr_return_ship_cost#4008,sr_refunded_cash#4009,sr_reversed_charge#4010,sr_store_credit#4011,sr_net_loss#4012,sr_returned_date_sk#4013L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date_id#4015,d_date#4016,d_month_seq#4017,d_week_seq#4018,d_quarter_seq#4019,d_year#4020,d_dow#4021,d_moy#4022,d_dom#4023,d_qoy#4024,d_fy_year#4025,d_fy_quarter_seq#4026,d_fy_week_seq#4027,d_day_name#4028,d_quarter_name#4029,d_holiday#4030,d_weekend#4031,d_following_holiday#4032,d_first_dom#4033,d_last_dom#4034,d_same_day_ly#4035,d_same_day_lq#4036,d_current_day#4037,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4042L,s_store_id#4043,s_rec_start_date#4044,s_rec_end_date#4045,s_closed_date_sk#4046L,s_store_name#4047,s_number_employees#4048,s_floor_space#4049,s_hours#4050,s_manager#4051,s_market_id#4052,s_geography_class#4053,s_market_desc#4054,s_market_manager#4055,s_division_id#4056,s_division_name#4057,s_company_id#4058,s_company_name#4059,s_street_number#4060,s_street_name#4061,s_street_type#4062,s_suite_number#4063,s_city#4064,s_county#4065,... 5 more fields] orc
:- CTERelationDef 5
:  +- SubqueryAlias csr
:     +- Aggregate [cp_catalog_page_id#4161], [cp_catalog_page_id#4161, sum(sales_price#3941) AS sales#3951, sum(profit#3942) AS profit#3952, sum(return_amt#4319) AS returns#3953, sum(net_loss#4320) AS profit_loss#3954]
:        +- Filter (((date_sk#3940L = d_date_sk#4132L) AND ((d_date#4134 >= cast(1998-08-04 as date)) AND (d_date#4134 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '14' DAY))))) AND (page_sk#3939L = cp_catalog_page_sk#4160L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias salesreturns
:              :  :  +- Union false, false
:              :  :     :- Project [page_sk#3939L, date_sk#3940L, sales_price#3941, profit#3942, cast(return_amt#3943 as double) AS return_amt#4319, cast(net_loss#3944 as double) AS net_loss#4320]
:              :  :     :  +- Project [cs_catalog_page_sk#4082L AS page_sk#3939L, cs_sold_date_sk#4104L AS date_sk#3940L, cs_ext_sales_price#4093 AS sales_price#3941, cs_net_profit#4103 AS profit#3942, cast(0 as decimal(7,2)) AS return_amt#3943, cast(0 as decimal(7,2)) AS net_loss#3944]
:              :  :     :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#4071L,cs_ship_date_sk#4072L,cs_bill_customer_sk#4073L,cs_bill_cdemo_sk#4074L,cs_bill_hdemo_sk#4075L,cs_bill_addr_sk#4076L,cs_ship_customer_sk#4077L,cs_ship_cdemo_sk#4078L,cs_ship_hdemo_sk#4079L,cs_ship_addr_sk#4080L,cs_call_center_sk#4081L,cs_catalog_page_sk#4082L,cs_ship_mode_sk#4083L,cs_warehouse_sk#4084L,cs_item_sk#4085L,cs_promo_sk#4086L,cs_order_number#4087L,cs_quantity#4088,cs_wholesale_cost#4089,cs_list_price#4090,cs_sales_price#4091,cs_ext_discount_amt#4092,cs_ext_sales_price#4093,cs_ext_wholesale_cost#4094,... 10 more fields] orc
:              :  :     +- Project [page_sk#3945L, date_sk#3946L, cast(sales_price#3947 as double) AS sales_price#4321, cast(profit#3948 as double) AS profit#4322, return_amt#3949, net_loss#3950]
:              :  :        +- Project [cr_catalog_page_sk#4116L AS page_sk#3945L, cr_returned_date_sk#4131L AS date_sk#3946L, cast(0 as decimal(7,2)) AS sales_price#3947, cast(0 as decimal(7,2)) AS profit#3948, cr_return_amount#4122 AS return_amt#3949, cr_net_loss#4130 AS net_loss#3950]
:              :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#4105L,cr_item_sk#4106L,cr_refunded_customer_sk#4107L,cr_refunded_cdemo_sk#4108L,cr_refunded_hdemo_sk#4109L,cr_refunded_addr_sk#4110L,cr_returning_customer_sk#4111L,cr_returning_cdemo_sk#4112L,cr_returning_hdemo_sk#4113L,cr_returning_addr_sk#4114L,cr_call_center_sk#4115L,cr_catalog_page_sk#4116L,cr_ship_mode_sk#4117L,cr_warehouse_sk#4118L,cr_reason_sk#4119L,cr_order_number#4120L,cr_return_quantity#4121,cr_return_amount#4122,cr_return_tax#4123,cr_return_amt_inc_tax#4124,cr_fee#4125,cr_return_ship_cost#4126,cr_refunded_cash#4127,cr_reversed_charge#4128,... 3 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date_id#4133,d_date#4134,d_month_seq#4135,d_week_seq#4136,d_quarter_seq#4137,d_year#4138,d_dow#4139,d_moy#4140,d_dom#4141,d_qoy#4142,d_fy_year#4143,d_fy_quarter_seq#4144,d_fy_week_seq#4145,d_day_name#4146,d_quarter_name#4147,d_holiday#4148,d_weekend#4149,d_following_holiday#4150,d_first_dom#4151,d_last_dom#4152,d_same_day_ly#4153,d_same_day_lq#4154,d_current_day#4155,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_page
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#4160L,cp_catalog_page_id#4161,cp_start_date_sk#4162L,cp_end_date_sk#4163L,cp_department#4164,cp_catalog_number#4165,cp_catalog_page_number#4166,cp_description#4167,cp_type#4168] orc
:- CTERelationDef 6
:  +- SubqueryAlias wsr
:     +- Aggregate [web_site_id#4290], [web_site_id#4290, sum(sales_price#3957) AS sales#3967, sum(profit#3958) AS profit#3968, sum(return_amt#4323) AS returns#3969, sum(net_loss#4324) AS profit_loss#3970]
:        +- Filter (((date_sk#3956L = d_date_sk#4261L) AND ((d_date#4263 >= cast(1998-08-04 as date)) AND (d_date#4263 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '14' DAY))))) AND (wsr_web_site_sk#3955L = web_site_sk#4289L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias salesreturns
:              :  :  +- Union false, false
:              :  :     :- Project [wsr_web_site_sk#3955L, date_sk#3956L, sales_price#3957, profit#3958, cast(return_amt#3959 as double) AS return_amt#4323, cast(net_loss#3960 as double) AS net_loss#4324]
:              :  :     :  +- Project [ws_web_site_sk#4181L AS wsr_web_site_sk#3955L, ws_sold_date_sk#4202L AS date_sk#3956L, ws_ext_sales_price#4191 AS sales_price#3957, ws_net_profit#4201 AS profit#3958, cast(0 as decimal(7,2)) AS return_amt#3959, cast(0 as decimal(7,2)) AS net_loss#3960]
:              :  :     :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#4169L,ws_ship_date_sk#4170L,ws_item_sk#4171L,ws_bill_customer_sk#4172L,ws_bill_cdemo_sk#4173L,ws_bill_hdemo_sk#4174L,ws_bill_addr_sk#4175L,ws_ship_customer_sk#4176L,ws_ship_cdemo_sk#4177L,ws_ship_hdemo_sk#4178L,ws_ship_addr_sk#4179L,ws_web_page_sk#4180L,ws_web_site_sk#4181L,ws_ship_mode_sk#4182L,ws_warehouse_sk#4183L,ws_promo_sk#4184L,ws_order_number#4185L,ws_quantity#4186,ws_wholesale_cost#4187,ws_list_price#4188,ws_sales_price#4189,ws_ext_discount_amt#4190,ws_ext_sales_price#4191,ws_ext_wholesale_cost#4192,... 10 more fields] orc
:              :  :     +- Project [wsr_web_site_sk#3961L, date_sk#3962L, cast(sales_price#3963 as double) AS sales_price#4325, cast(profit#3964 as double) AS profit#4326, return_amt#3965, net_loss#3966]
:              :  :        +- Project [ws_web_site_sk#4239L AS wsr_web_site_sk#3961L, wr_returned_date_sk#4226L AS date_sk#3962L, cast(0 as decimal(7,2)) AS sales_price#3963, cast(0 as decimal(7,2)) AS profit#3964, wr_return_amt#4217 AS return_amt#3965, wr_net_loss#4225 AS net_loss#3966]
:              :  :           +- Join LeftOuter, ((wr_item_sk#4204L = ws_item_sk#4229L) AND (wr_order_number#4215L = ws_order_number#4243L))
:              :  :              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :  :              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#4203L,wr_item_sk#4204L,wr_refunded_customer_sk#4205L,wr_refunded_cdemo_sk#4206L,wr_refunded_hdemo_sk#4207L,wr_refunded_addr_sk#4208L,wr_returning_customer_sk#4209L,wr_returning_cdemo_sk#4210L,wr_returning_hdemo_sk#4211L,wr_returning_addr_sk#4212L,wr_web_page_sk#4213L,wr_reason_sk#4214L,wr_order_number#4215L,wr_return_quantity#4216,wr_return_amt#4217,wr_return_tax#4218,wr_return_amt_inc_tax#4219,wr_fee#4220,wr_return_ship_cost#4221,wr_refunded_cash#4222,wr_reversed_charge#4223,wr_account_credit#4224,wr_net_loss#4225,wr_returned_date_sk#4226L] orc
:              :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#4227L,ws_ship_date_sk#4228L,ws_item_sk#4229L,ws_bill_customer_sk#4230L,ws_bill_cdemo_sk#4231L,ws_bill_hdemo_sk#4232L,ws_bill_addr_sk#4233L,ws_ship_customer_sk#4234L,ws_ship_cdemo_sk#4235L,ws_ship_hdemo_sk#4236L,ws_ship_addr_sk#4237L,ws_web_page_sk#4238L,ws_web_site_sk#4239L,ws_ship_mode_sk#4240L,ws_warehouse_sk#4241L,ws_promo_sk#4242L,ws_order_number#4243L,ws_quantity#4244,ws_wholesale_cost#4245,ws_list_price#4246,ws_sales_price#4247,ws_ext_discount_amt#4248,ws_ext_sales_price#4249,ws_ext_wholesale_cost#4250,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date_id#4262,d_date#4263,d_month_seq#4264,d_week_seq#4265,d_quarter_seq#4266,d_year#4267,d_dow#4268,d_moy#4269,d_dom#4270,d_qoy#4271,d_fy_year#4272,d_fy_quarter_seq#4273,d_fy_week_seq#4274,d_day_name#4275,d_quarter_name#4276,d_holiday#4277,d_weekend#4278,d_following_holiday#4279,d_first_dom#4280,d_last_dom#4281,d_same_day_ly#4282,d_same_day_lq#4283,d_current_day#4284,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_site
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#4289L,web_site_id#4290,web_rec_start_date#4291,web_rec_end_date#4292,web_name#4293,web_open_date_sk#4294L,web_close_date_sk#4295L,web_class#4296,web_manager#4297,web_mkt_id#4298,web_mkt_class#4299,web_mkt_desc#4300,web_market_manager#4301,web_company_id#4302,web_company_name#4303,web_street_number#4304,web_street_name#4305,web_street_type#4306,web_suite_number#4307,web_city#4308,web_county#4309,web_state#4310,web_zip#4311,web_country#4312,... 2 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [channel#4345 ASC NULLS FIRST, id#4346 ASC NULLS FIRST], true
         +- Aggregate [channel#4345, id#4346, spark_grouping_id#4344L], [channel#4345, id#4346, sum(sales#3935) AS sales#3920, sum(returns#3937) AS returns#3921, sum(profit#3913) AS profit#3922]
            +- Expand [[channel#3911, id#3912, sales#3935, returns#3937, profit#3913, channel#4342, id#4343, 0], [channel#3911, id#3912, sales#3935, returns#3937, profit#3913, channel#4342, null, 1], [channel#3911, id#3912, sales#3935, returns#3937, profit#3913, null, null, 3]], [channel#3911, id#3912, sales#3935, returns#3937, profit#3913, channel#4345, id#4346, spark_grouping_id#4344L]
               +- Project [channel#3911, id#3912, sales#3935, returns#3937, profit#3913, channel#3911 AS channel#4342, id#3912 AS id#4343]
                  +- SubqueryAlias x
                     +- Union false, false
                        :- Union false, false
                        :  :- Project [store channel AS channel#3911, concat(store, s_store_id#4043) AS id#3912, sales#3935, returns#3937, (profit#3936 - profit_loss#3938) AS profit#3913]
                        :  :  +- SubqueryAlias ssr
                        :  :     +- CTERelationRef 4, true, [s_store_id#4043, sales#3935, profit#3936, returns#3937, profit_loss#3938]
                        :  +- Project [catalog channel AS channel#3914, concat(catalog_page, cp_catalog_page_id#4161) AS id#3915, sales#3951, returns#3953, (profit#3952 - profit_loss#3954) AS profit#3916]
                        :     +- SubqueryAlias csr
                        :        +- CTERelationRef 5, true, [cp_catalog_page_id#4161, sales#3951, profit#3952, returns#3953, profit_loss#3954]
                        +- Project [web channel AS channel#3917, concat(web_site, web_site_id#4290) AS id#3918, sales#3967, returns#3969, (profit#3968 - profit_loss#3970) AS profit#3919]
                           +- SubqueryAlias wsr
                              +- CTERelationRef 6, true, [web_site_id#4290, sales#3967, profit#3968, returns#3969, profit_loss#3970]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#4345 ASC NULLS FIRST, id#4346 ASC NULLS FIRST], true
      +- Aggregate [channel#4345, id#4346, spark_grouping_id#4344L], [channel#4345, id#4346, sum(sales#3935) AS sales#3920, sum(returns#3937) AS returns#3921, sum(profit#3913) AS profit#3922]
         +- Expand [[sales#3935, returns#3937, profit#3913, channel#4342, id#4343, 0], [sales#3935, returns#3937, profit#3913, channel#4342, null, 1], [sales#3935, returns#3937, profit#3913, null, null, 3]], [sales#3935, returns#3937, profit#3913, channel#4345, id#4346, spark_grouping_id#4344L]
            +- Union false, false
               :- Aggregate [s_store_id#4043], [sum(sales_price#3925) AS sales#3935, sum(return_amt#4315) AS returns#3937, (sum(profit#3926) - sum(net_loss#4316)) AS profit#3913, store channel AS channel#4342, concat(store, s_store_id#4043) AS id#4343]
               :  +- Project [sales_price#3925, profit#3926, return_amt#4315, net_loss#4316, s_store_id#4043]
               :     +- Join Inner, (store_sk#3923L = s_store_sk#4042L)
               :        :- Project [store_sk#3923L, sales_price#3925, profit#3926, return_amt#4315, net_loss#4316]
               :        :  +- Join Inner, (date_sk#3924L = d_date_sk#4014L)
               :        :     :- Union false, false
               :        :     :  :- Project [ss_store_sk#3977L AS store_sk#3923L, ss_sold_date_sk#3993L AS date_sk#3924L, ss_ext_sales_price#3985 AS sales_price#3925, ss_net_profit#3992 AS profit#3926, 0.0 AS return_amt#4315, 0.0 AS net_loss#4316]
               :        :     :  :  +- Filter ((isnotnull(ss_sold_date_sk#3993L) AND isnotnull(ss_store_sk#3977L)) AND dynamicpruning#4356 [ss_sold_date_sk#3993L])
               :        :     :  :     :  +- Project [d_date_sk#4014L]
               :        :     :  :     :     +- Filter ((isnotnull(d_date#4016) AND ((d_date#4016 >= 1998-08-04) AND (d_date#4016 <= 1998-08-18))) AND isnotnull(d_date_sk#4014L))
               :        :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date_id#4015,d_date#4016,d_month_seq#4017,d_week_seq#4018,d_quarter_seq#4019,d_year#4020,d_dow#4021,d_moy#4022,d_dom#4023,d_qoy#4024,d_fy_year#4025,d_fy_quarter_seq#4026,d_fy_week_seq#4027,d_day_name#4028,d_quarter_name#4029,d_holiday#4030,d_weekend#4031,d_following_holiday#4032,d_first_dom#4033,d_last_dom#4034,d_same_day_ly#4035,d_same_day_lq#4036,d_current_day#4037,... 4 more fields] orc
               :        :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#3971L,ss_item_sk#3972L,ss_customer_sk#3973L,ss_cdemo_sk#3974L,ss_hdemo_sk#3975L,ss_addr_sk#3976L,ss_store_sk#3977L,ss_promo_sk#3978L,ss_ticket_number#3979L,ss_quantity#3980,ss_wholesale_cost#3981,ss_list_price#3982,ss_sales_price#3983,ss_ext_discount_amt#3984,ss_ext_sales_price#3985,ss_ext_wholesale_cost#3986,ss_ext_list_price#3987,ss_ext_tax#3988,ss_coupon_amt#3989,ss_net_paid#3990,ss_net_paid_inc_tax#3991,ss_net_profit#3992,ss_sold_date_sk#3993L] orc
               :        :     :  +- Project [sr_store_sk#4000L AS store_sk#3929L, sr_returned_date_sk#4013L AS date_sk#3930L, 0.0 AS sales_price#4317, 0.0 AS profit#4318, sr_return_amt#4004 AS return_amt#3933, sr_net_loss#4012 AS net_loss#3934]
               :        :     :     +- Filter ((isnotnull(sr_returned_date_sk#4013L) AND isnotnull(sr_store_sk#4000L)) AND dynamicpruning#4356 [sr_returned_date_sk#4013L])
               :        :     :        :  +- Project [d_date_sk#4014L]
               :        :     :        :     +- Filter ((isnotnull(d_date#4016) AND ((d_date#4016 >= 1998-08-04) AND (d_date#4016 <= 1998-08-18))) AND isnotnull(d_date_sk#4014L))
               :        :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date_id#4015,d_date#4016,d_month_seq#4017,d_week_seq#4018,d_quarter_seq#4019,d_year#4020,d_dow#4021,d_moy#4022,d_dom#4023,d_qoy#4024,d_fy_year#4025,d_fy_quarter_seq#4026,d_fy_week_seq#4027,d_day_name#4028,d_quarter_name#4029,d_holiday#4030,d_weekend#4031,d_following_holiday#4032,d_first_dom#4033,d_last_dom#4034,d_same_day_ly#4035,d_same_day_lq#4036,d_current_day#4037,... 4 more fields] orc
               :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#3994L,sr_item_sk#3995L,sr_customer_sk#3996L,sr_cdemo_sk#3997L,sr_hdemo_sk#3998L,sr_addr_sk#3999L,sr_store_sk#4000L,sr_reason_sk#4001L,sr_ticket_number#4002L,sr_return_quantity#4003,sr_return_amt#4004,sr_return_tax#4005,sr_return_amt_inc_tax#4006,sr_fee#4007,sr_return_ship_cost#4008,sr_refunded_cash#4009,sr_reversed_charge#4010,sr_store_credit#4011,sr_net_loss#4012,sr_returned_date_sk#4013L] orc
               :        :     +- Project [d_date_sk#4014L]
               :        :        +- Filter ((isnotnull(d_date#4016) AND ((d_date#4016 >= 1998-08-04) AND (d_date#4016 <= 1998-08-18))) AND isnotnull(d_date_sk#4014L))
               :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date_id#4015,d_date#4016,d_month_seq#4017,d_week_seq#4018,d_quarter_seq#4019,d_year#4020,d_dow#4021,d_moy#4022,d_dom#4023,d_qoy#4024,d_fy_year#4025,d_fy_quarter_seq#4026,d_fy_week_seq#4027,d_day_name#4028,d_quarter_name#4029,d_holiday#4030,d_weekend#4031,d_following_holiday#4032,d_first_dom#4033,d_last_dom#4034,d_same_day_ly#4035,d_same_day_lq#4036,d_current_day#4037,... 4 more fields] orc
               :        +- Project [s_store_sk#4042L, s_store_id#4043]
               :           +- Filter isnotnull(s_store_sk#4042L)
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4042L,s_store_id#4043,s_rec_start_date#4044,s_rec_end_date#4045,s_closed_date_sk#4046L,s_store_name#4047,s_number_employees#4048,s_floor_space#4049,s_hours#4050,s_manager#4051,s_market_id#4052,s_geography_class#4053,s_market_desc#4054,s_market_manager#4055,s_division_id#4056,s_division_name#4057,s_company_id#4058,s_company_name#4059,s_street_number#4060,s_street_name#4061,s_street_type#4062,s_suite_number#4063,s_city#4064,s_county#4065,... 5 more fields] orc
               :- Aggregate [cp_catalog_page_id#4161], [sum(sales_price#3941) AS sales#3951, sum(return_amt#4319) AS returns#3953, (sum(profit#3942) - sum(net_loss#4320)) AS profit#3916, catalog channel AS channel#4352, concat(catalog_page, cp_catalog_page_id#4161) AS id#4353]
               :  +- Project [sales_price#3941, profit#3942, return_amt#4319, net_loss#4320, cp_catalog_page_id#4161]
               :     +- Join Inner, (page_sk#3939L = cp_catalog_page_sk#4160L)
               :        :- Project [page_sk#3939L, sales_price#3941, profit#3942, return_amt#4319, net_loss#4320]
               :        :  +- Join Inner, (date_sk#3940L = d_date_sk#4132L)
               :        :     :- Union false, false
               :        :     :  :- Project [cs_catalog_page_sk#4082L AS page_sk#3939L, cs_sold_date_sk#4104L AS date_sk#3940L, cs_ext_sales_price#4093 AS sales_price#3941, cs_net_profit#4103 AS profit#3942, 0.0 AS return_amt#4319, 0.0 AS net_loss#4320]
               :        :     :  :  +- Filter ((isnotnull(cs_sold_date_sk#4104L) AND isnotnull(cs_catalog_page_sk#4082L)) AND dynamicpruning#4357 [cs_sold_date_sk#4104L])
               :        :     :  :     :  +- Project [d_date_sk#4132L]
               :        :     :  :     :     +- Filter ((isnotnull(d_date#4134) AND ((d_date#4134 >= 1998-08-04) AND (d_date#4134 <= 1998-08-18))) AND isnotnull(d_date_sk#4132L))
               :        :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date_id#4133,d_date#4134,d_month_seq#4135,d_week_seq#4136,d_quarter_seq#4137,d_year#4138,d_dow#4139,d_moy#4140,d_dom#4141,d_qoy#4142,d_fy_year#4143,d_fy_quarter_seq#4144,d_fy_week_seq#4145,d_day_name#4146,d_quarter_name#4147,d_holiday#4148,d_weekend#4149,d_following_holiday#4150,d_first_dom#4151,d_last_dom#4152,d_same_day_ly#4153,d_same_day_lq#4154,d_current_day#4155,... 4 more fields] orc
               :        :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#4071L,cs_ship_date_sk#4072L,cs_bill_customer_sk#4073L,cs_bill_cdemo_sk#4074L,cs_bill_hdemo_sk#4075L,cs_bill_addr_sk#4076L,cs_ship_customer_sk#4077L,cs_ship_cdemo_sk#4078L,cs_ship_hdemo_sk#4079L,cs_ship_addr_sk#4080L,cs_call_center_sk#4081L,cs_catalog_page_sk#4082L,cs_ship_mode_sk#4083L,cs_warehouse_sk#4084L,cs_item_sk#4085L,cs_promo_sk#4086L,cs_order_number#4087L,cs_quantity#4088,cs_wholesale_cost#4089,cs_list_price#4090,cs_sales_price#4091,cs_ext_discount_amt#4092,cs_ext_sales_price#4093,cs_ext_wholesale_cost#4094,... 10 more fields] orc
               :        :     :  +- Project [cr_catalog_page_sk#4116L AS page_sk#3945L, cr_returned_date_sk#4131L AS date_sk#3946L, 0.0 AS sales_price#4321, 0.0 AS profit#4322, cr_return_amount#4122 AS return_amt#3949, cr_net_loss#4130 AS net_loss#3950]
               :        :     :     +- Filter ((isnotnull(cr_returned_date_sk#4131L) AND isnotnull(cr_catalog_page_sk#4116L)) AND dynamicpruning#4357 [cr_returned_date_sk#4131L])
               :        :     :        :  +- Project [d_date_sk#4132L]
               :        :     :        :     +- Filter ((isnotnull(d_date#4134) AND ((d_date#4134 >= 1998-08-04) AND (d_date#4134 <= 1998-08-18))) AND isnotnull(d_date_sk#4132L))
               :        :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date_id#4133,d_date#4134,d_month_seq#4135,d_week_seq#4136,d_quarter_seq#4137,d_year#4138,d_dow#4139,d_moy#4140,d_dom#4141,d_qoy#4142,d_fy_year#4143,d_fy_quarter_seq#4144,d_fy_week_seq#4145,d_day_name#4146,d_quarter_name#4147,d_holiday#4148,d_weekend#4149,d_following_holiday#4150,d_first_dom#4151,d_last_dom#4152,d_same_day_ly#4153,d_same_day_lq#4154,d_current_day#4155,... 4 more fields] orc
               :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#4105L,cr_item_sk#4106L,cr_refunded_customer_sk#4107L,cr_refunded_cdemo_sk#4108L,cr_refunded_hdemo_sk#4109L,cr_refunded_addr_sk#4110L,cr_returning_customer_sk#4111L,cr_returning_cdemo_sk#4112L,cr_returning_hdemo_sk#4113L,cr_returning_addr_sk#4114L,cr_call_center_sk#4115L,cr_catalog_page_sk#4116L,cr_ship_mode_sk#4117L,cr_warehouse_sk#4118L,cr_reason_sk#4119L,cr_order_number#4120L,cr_return_quantity#4121,cr_return_amount#4122,cr_return_tax#4123,cr_return_amt_inc_tax#4124,cr_fee#4125,cr_return_ship_cost#4126,cr_refunded_cash#4127,cr_reversed_charge#4128,... 3 more fields] orc
               :        :     +- Project [d_date_sk#4132L]
               :        :        +- Filter ((isnotnull(d_date#4134) AND ((d_date#4134 >= 1998-08-04) AND (d_date#4134 <= 1998-08-18))) AND isnotnull(d_date_sk#4132L))
               :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date_id#4133,d_date#4134,d_month_seq#4135,d_week_seq#4136,d_quarter_seq#4137,d_year#4138,d_dow#4139,d_moy#4140,d_dom#4141,d_qoy#4142,d_fy_year#4143,d_fy_quarter_seq#4144,d_fy_week_seq#4145,d_day_name#4146,d_quarter_name#4147,d_holiday#4148,d_weekend#4149,d_following_holiday#4150,d_first_dom#4151,d_last_dom#4152,d_same_day_ly#4153,d_same_day_lq#4154,d_current_day#4155,... 4 more fields] orc
               :        +- Project [cp_catalog_page_sk#4160L, cp_catalog_page_id#4161]
               :           +- Filter isnotnull(cp_catalog_page_sk#4160L)
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#4160L,cp_catalog_page_id#4161,cp_start_date_sk#4162L,cp_end_date_sk#4163L,cp_department#4164,cp_catalog_number#4165,cp_catalog_page_number#4166,cp_description#4167,cp_type#4168] orc
               +- Aggregate [web_site_id#4290], [sum(sales_price#3957) AS sales#3967, sum(return_amt#4323) AS returns#3969, (sum(profit#3958) - sum(net_loss#4324)) AS profit#3919, web channel AS channel#4354, concat(web_site, web_site_id#4290) AS id#4355]
                  +- Project [sales_price#3957, profit#3958, return_amt#4323, net_loss#4324, web_site_id#4290]
                     +- Join Inner, (wsr_web_site_sk#3955L = web_site_sk#4289L)
                        :- Project [wsr_web_site_sk#3955L, sales_price#3957, profit#3958, return_amt#4323, net_loss#4324]
                        :  +- Join Inner, (date_sk#3956L = d_date_sk#4261L)
                        :     :- Union false, false
                        :     :  :- Project [ws_web_site_sk#4181L AS wsr_web_site_sk#3955L, ws_sold_date_sk#4202L AS date_sk#3956L, ws_ext_sales_price#4191 AS sales_price#3957, ws_net_profit#4201 AS profit#3958, 0.0 AS return_amt#4323, 0.0 AS net_loss#4324]
                        :     :  :  +- Filter ((isnotnull(ws_sold_date_sk#4202L) AND isnotnull(ws_web_site_sk#4181L)) AND dynamicpruning#4358 [ws_sold_date_sk#4202L])
                        :     :  :     :  +- Project [d_date_sk#4261L]
                        :     :  :     :     +- Filter ((isnotnull(d_date#4263) AND ((d_date#4263 >= 1998-08-04) AND (d_date#4263 <= 1998-08-18))) AND isnotnull(d_date_sk#4261L))
                        :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date_id#4262,d_date#4263,d_month_seq#4264,d_week_seq#4265,d_quarter_seq#4266,d_year#4267,d_dow#4268,d_moy#4269,d_dom#4270,d_qoy#4271,d_fy_year#4272,d_fy_quarter_seq#4273,d_fy_week_seq#4274,d_day_name#4275,d_quarter_name#4276,d_holiday#4277,d_weekend#4278,d_following_holiday#4279,d_first_dom#4280,d_last_dom#4281,d_same_day_ly#4282,d_same_day_lq#4283,d_current_day#4284,... 4 more fields] orc
                        :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#4169L,ws_ship_date_sk#4170L,ws_item_sk#4171L,ws_bill_customer_sk#4172L,ws_bill_cdemo_sk#4173L,ws_bill_hdemo_sk#4174L,ws_bill_addr_sk#4175L,ws_ship_customer_sk#4176L,ws_ship_cdemo_sk#4177L,ws_ship_hdemo_sk#4178L,ws_ship_addr_sk#4179L,ws_web_page_sk#4180L,ws_web_site_sk#4181L,ws_ship_mode_sk#4182L,ws_warehouse_sk#4183L,ws_promo_sk#4184L,ws_order_number#4185L,ws_quantity#4186,ws_wholesale_cost#4187,ws_list_price#4188,ws_sales_price#4189,ws_ext_discount_amt#4190,ws_ext_sales_price#4191,ws_ext_wholesale_cost#4192,... 10 more fields] orc
                        :     :  +- Project [ws_web_site_sk#4239L AS wsr_web_site_sk#3961L, wr_returned_date_sk#4226L AS date_sk#3962L, 0.0 AS sales_price#4325, 0.0 AS profit#4326, wr_return_amt#4217 AS return_amt#3965, wr_net_loss#4225 AS net_loss#3966]
                        :     :     +- Join Inner, ((wr_item_sk#4204L = ws_item_sk#4229L) AND (wr_order_number#4215L = ws_order_number#4243L))
                        :     :        :- Project [wr_item_sk#4204L, wr_order_number#4215L, wr_return_amt#4217, wr_net_loss#4225, wr_returned_date_sk#4226L]
                        :     :        :  +- Filter (isnotnull(wr_returned_date_sk#4226L) AND dynamicpruning#4358 [wr_returned_date_sk#4226L])
                        :     :        :     :  +- Project [d_date_sk#4261L]
                        :     :        :     :     +- Filter ((isnotnull(d_date#4263) AND ((d_date#4263 >= 1998-08-04) AND (d_date#4263 <= 1998-08-18))) AND isnotnull(d_date_sk#4261L))
                        :     :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date_id#4262,d_date#4263,d_month_seq#4264,d_week_seq#4265,d_quarter_seq#4266,d_year#4267,d_dow#4268,d_moy#4269,d_dom#4270,d_qoy#4271,d_fy_year#4272,d_fy_quarter_seq#4273,d_fy_week_seq#4274,d_day_name#4275,d_quarter_name#4276,d_holiday#4277,d_weekend#4278,d_following_holiday#4279,d_first_dom#4280,d_last_dom#4281,d_same_day_ly#4282,d_same_day_lq#4283,d_current_day#4284,... 4 more fields] orc
                        :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#4203L,wr_item_sk#4204L,wr_refunded_customer_sk#4205L,wr_refunded_cdemo_sk#4206L,wr_refunded_hdemo_sk#4207L,wr_refunded_addr_sk#4208L,wr_returning_customer_sk#4209L,wr_returning_cdemo_sk#4210L,wr_returning_hdemo_sk#4211L,wr_returning_addr_sk#4212L,wr_web_page_sk#4213L,wr_reason_sk#4214L,wr_order_number#4215L,wr_return_quantity#4216,wr_return_amt#4217,wr_return_tax#4218,wr_return_amt_inc_tax#4219,wr_fee#4220,wr_return_ship_cost#4221,wr_refunded_cash#4222,wr_reversed_charge#4223,wr_account_credit#4224,wr_net_loss#4225,wr_returned_date_sk#4226L] orc
                        :     :        +- Project [ws_item_sk#4229L, ws_web_site_sk#4239L, ws_order_number#4243L]
                        :     :           +- Filter ((isnotnull(ws_item_sk#4229L) AND isnotnull(ws_order_number#4243L)) AND isnotnull(ws_web_site_sk#4239L))
                        :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#4227L,ws_ship_date_sk#4228L,ws_item_sk#4229L,ws_bill_customer_sk#4230L,ws_bill_cdemo_sk#4231L,ws_bill_hdemo_sk#4232L,ws_bill_addr_sk#4233L,ws_ship_customer_sk#4234L,ws_ship_cdemo_sk#4235L,ws_ship_hdemo_sk#4236L,ws_ship_addr_sk#4237L,ws_web_page_sk#4238L,ws_web_site_sk#4239L,ws_ship_mode_sk#4240L,ws_warehouse_sk#4241L,ws_promo_sk#4242L,ws_order_number#4243L,ws_quantity#4244,ws_wholesale_cost#4245,ws_list_price#4246,ws_sales_price#4247,ws_ext_discount_amt#4248,ws_ext_sales_price#4249,ws_ext_wholesale_cost#4250,... 10 more fields] orc
                        :     +- Project [d_date_sk#4261L]
                        :        +- Filter ((isnotnull(d_date#4263) AND ((d_date#4263 >= 1998-08-04) AND (d_date#4263 <= 1998-08-18))) AND isnotnull(d_date_sk#4261L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date_id#4262,d_date#4263,d_month_seq#4264,d_week_seq#4265,d_quarter_seq#4266,d_year#4267,d_dow#4268,d_moy#4269,d_dom#4270,d_qoy#4271,d_fy_year#4272,d_fy_quarter_seq#4273,d_fy_week_seq#4274,d_day_name#4275,d_quarter_name#4276,d_holiday#4277,d_weekend#4278,d_following_holiday#4279,d_first_dom#4280,d_last_dom#4281,d_same_day_ly#4282,d_same_day_lq#4283,d_current_day#4284,... 4 more fields] orc
                        +- Project [web_site_sk#4289L, web_site_id#4290]
                           +- Filter isnotnull(web_site_sk#4289L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#4289L,web_site_id#4290,web_rec_start_date#4291,web_rec_end_date#4292,web_name#4293,web_open_date_sk#4294L,web_close_date_sk#4295L,web_class#4296,web_manager#4297,web_mkt_id#4298,web_mkt_class#4299,web_mkt_desc#4300,web_market_manager#4301,web_company_id#4302,web_company_name#4303,web_street_number#4304,web_street_name#4305,web_street_type#4306,web_suite_number#4307,web_city#4308,web_county#4309,web_state#4310,web_zip#4311,web_country#4312,... 2 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#4345 ASC NULLS FIRST,id#4346 ASC NULLS FIRST], output=[channel#4345,id#4346,sales#3920,returns#3921,profit#3922])
   +- HashAggregate(keys=[channel#4345, id#4346, spark_grouping_id#4344L], functions=[sum(sales#3935), sum(returns#3937), sum(profit#3913)], output=[channel#4345, id#4346, sales#3920, returns#3921, profit#3922])
      +- Exchange hashpartitioning(channel#4345, id#4346, spark_grouping_id#4344L, 3000), ENSURE_REQUIREMENTS, [id=#2366]
         +- HashAggregate(keys=[channel#4345, id#4346, spark_grouping_id#4344L], functions=[partial_sum(sales#3935), partial_sum(returns#3937), partial_sum(profit#3913)], output=[channel#4345, id#4346, spark_grouping_id#4344L, sum#4362, sum#4363, sum#4364])
            +- Expand [[sales#3935, returns#3937, profit#3913, channel#4342, id#4343, 0], [sales#3935, returns#3937, profit#3913, channel#4342, null, 1], [sales#3935, returns#3937, profit#3913, null, null, 3]], [sales#3935, returns#3937, profit#3913, channel#4345, id#4346, spark_grouping_id#4344L]
               +- Union
                  :- HashAggregate(keys=[s_store_id#4043], functions=[sum(sales_price#3925), sum(return_amt#4315), sum(profit#3926), sum(net_loss#4316)], output=[sales#3935, returns#3937, profit#3913, channel#4342, id#4343])
                  :  +- Exchange hashpartitioning(s_store_id#4043, 3000), ENSURE_REQUIREMENTS, [id=#2329]
                  :     +- HashAggregate(keys=[s_store_id#4043], functions=[partial_sum(sales_price#3925), partial_sum(return_amt#4315), partial_sum(profit#3926), partial_sum(net_loss#4316)], output=[s_store_id#4043, sum#4369, sum#4370, sum#4371, sum#4372])
                  :        +- Project [sales_price#3925, profit#3926, return_amt#4315, net_loss#4316, s_store_id#4043]
                  :           +- BroadcastHashJoin [store_sk#3923L], [s_store_sk#4042L], Inner, BuildRight, false
                  :              :- Project [store_sk#3923L, sales_price#3925, profit#3926, return_amt#4315, net_loss#4316]
                  :              :  +- BroadcastHashJoin [date_sk#3924L], [d_date_sk#4014L], Inner, BuildRight, false
                  :              :     :- Union
                  :              :     :  :- Project [ss_store_sk#3977L AS store_sk#3923L, ss_sold_date_sk#3993L AS date_sk#3924L, ss_ext_sales_price#3985 AS sales_price#3925, ss_net_profit#3992 AS profit#3926, 0.0 AS return_amt#4315, 0.0 AS net_loss#4316]
                  :              :     :  :  +- Filter isnotnull(ss_store_sk#3977L)
                  :              :     :  :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#3977L,ss_ext_sales_price#3985,ss_net_profit#3992,ss_sold_date_sk#3993L] Batched: true, DataFilters: [isnotnull(ss_store_sk#3977L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#3993L), dynamicpruningexpression(ss_sold_date_sk#3993L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_ext_sales_price:double,ss_net_profit:double>
                  :              :     :  :           +- SubqueryAdaptiveBroadcast dynamicpruning#4356, 0, true, Project [d_date_sk#4014L], [d_date_sk#4014L]
                  :              :     :  :              +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :  :                 +- Project [d_date_sk#4014L]
                  :              :     :  :                    +- Filter (((isnotnull(d_date#4016) AND (d_date#4016 >= 1998-08-04)) AND (d_date#4016 <= 1998-08-18)) AND isnotnull(d_date_sk#4014L))
                  :              :     :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date#4016] Batched: true, DataFilters: [isnotnull(d_date#4016), (d_date#4016 >= 1998-08-04), (d_date#4016 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :  +- Project [sr_store_sk#4000L AS store_sk#3929L, sr_returned_date_sk#4013L AS date_sk#3930L, 0.0 AS sales_price#4317, 0.0 AS profit#4318, sr_return_amt#4004 AS return_amt#3933, sr_net_loss#4012 AS net_loss#3934]
                  :              :     :     +- Filter isnotnull(sr_store_sk#4000L)
                  :              :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_store_sk#4000L,sr_return_amt#4004,sr_net_loss#4012,sr_returned_date_sk#4013L] Batched: true, DataFilters: [isnotnull(sr_store_sk#4000L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#4013L), dynamicpruningexpression(sr_returned_date_sk#4013L IN dyna..., PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_store_sk:bigint,sr_return_amt:double,sr_net_loss:double>
                  :              :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#4356, 0, true, Project [d_date_sk#4014L], [d_date_sk#4014L]
                  :              :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :                    +- Project [d_date_sk#4014L]
                  :              :     :                       +- Filter (((isnotnull(d_date#4016) AND (d_date#4016 >= 1998-08-04)) AND (d_date#4016 <= 1998-08-18)) AND isnotnull(d_date_sk#4014L))
                  :              :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date#4016] Batched: true, DataFilters: [isnotnull(d_date#4016), (d_date#4016 >= 1998-08-04), (d_date#4016 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2320]
                  :              :        +- Project [d_date_sk#4014L]
                  :              :           +- Filter (((isnotnull(d_date#4016) AND (d_date#4016 >= 1998-08-04)) AND (d_date#4016 <= 1998-08-18)) AND isnotnull(d_date_sk#4014L))
                  :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4014L,d_date#4016] Batched: true, DataFilters: [isnotnull(d_date#4016), (d_date#4016 >= 1998-08-04), (d_date#4016 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#2324]
                  :                 +- Filter isnotnull(s_store_sk#4042L)
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4042L,s_store_id#4043] Batched: true, DataFilters: [isnotnull(s_store_sk#4042L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string>
                  :- HashAggregate(keys=[cp_catalog_page_id#4161], functions=[sum(sales_price#3941), sum(return_amt#4319), sum(profit#3942), sum(net_loss#4320)], output=[sales#3951, returns#3953, profit#3916, channel#4352, id#4353])
                  :  +- Exchange hashpartitioning(cp_catalog_page_id#4161, 3000), ENSURE_REQUIREMENTS, [id=#2340]
                  :     +- HashAggregate(keys=[cp_catalog_page_id#4161], functions=[partial_sum(sales_price#3941), partial_sum(return_amt#4319), partial_sum(profit#3942), partial_sum(net_loss#4320)], output=[cp_catalog_page_id#4161, sum#4377, sum#4378, sum#4379, sum#4380])
                  :        +- Project [sales_price#3941, profit#3942, return_amt#4319, net_loss#4320, cp_catalog_page_id#4161]
                  :           +- BroadcastHashJoin [page_sk#3939L], [cp_catalog_page_sk#4160L], Inner, BuildRight, false
                  :              :- Project [page_sk#3939L, sales_price#3941, profit#3942, return_amt#4319, net_loss#4320]
                  :              :  +- BroadcastHashJoin [date_sk#3940L], [d_date_sk#4132L], Inner, BuildRight, false
                  :              :     :- Union
                  :              :     :  :- Project [cs_catalog_page_sk#4082L AS page_sk#3939L, cs_sold_date_sk#4104L AS date_sk#3940L, cs_ext_sales_price#4093 AS sales_price#3941, cs_net_profit#4103 AS profit#3942, 0.0 AS return_amt#4319, 0.0 AS net_loss#4320]
                  :              :     :  :  +- Filter isnotnull(cs_catalog_page_sk#4082L)
                  :              :     :  :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_catalog_page_sk#4082L,cs_ext_sales_price#4093,cs_net_profit#4103,cs_sold_date_sk#4104L] Batched: true, DataFilters: [isnotnull(cs_catalog_page_sk#4082L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#4104L), dynamicpruningexpression(cs_sold_date_sk#4104L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_catalog_page_sk)], ReadSchema: struct<cs_catalog_page_sk:bigint,cs_ext_sales_price:double,cs_net_profit:double>
                  :              :     :  :           +- SubqueryAdaptiveBroadcast dynamicpruning#4357, 0, true, Project [d_date_sk#4132L], [d_date_sk#4132L]
                  :              :     :  :              +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :  :                 +- Project [d_date_sk#4132L]
                  :              :     :  :                    +- Filter (((isnotnull(d_date#4134) AND (d_date#4134 >= 1998-08-04)) AND (d_date#4134 <= 1998-08-18)) AND isnotnull(d_date_sk#4132L))
                  :              :     :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date#4134] Batched: true, DataFilters: [isnotnull(d_date#4134), (d_date#4134 >= 1998-08-04), (d_date#4134 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :  +- Project [cr_catalog_page_sk#4116L AS page_sk#3945L, cr_returned_date_sk#4131L AS date_sk#3946L, 0.0 AS sales_price#4321, 0.0 AS profit#4322, cr_return_amount#4122 AS return_amt#3949, cr_net_loss#4130 AS net_loss#3950]
                  :              :     :     +- Filter isnotnull(cr_catalog_page_sk#4116L)
                  :              :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_catalog_page_sk#4116L,cr_return_amount#4122,cr_net_loss#4130,cr_returned_date_sk#4131L] Batched: true, DataFilters: [isnotnull(cr_catalog_page_sk#4116L)], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#4131L), dynamicpruningexpression(cr_returned_date_sk#4131L IN dyna..., PushedFilters: [IsNotNull(cr_catalog_page_sk)], ReadSchema: struct<cr_catalog_page_sk:bigint,cr_return_amount:double,cr_net_loss:double>
                  :              :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#4357, 0, true, Project [d_date_sk#4132L], [d_date_sk#4132L]
                  :              :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :                    +- Project [d_date_sk#4132L]
                  :              :     :                       +- Filter (((isnotnull(d_date#4134) AND (d_date#4134 >= 1998-08-04)) AND (d_date#4134 <= 1998-08-18)) AND isnotnull(d_date_sk#4132L))
                  :              :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date#4134] Batched: true, DataFilters: [isnotnull(d_date#4134), (d_date#4134 >= 1998-08-04), (d_date#4134 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2331]
                  :              :        +- Project [d_date_sk#4132L]
                  :              :           +- Filter (((isnotnull(d_date#4134) AND (d_date#4134 >= 1998-08-04)) AND (d_date#4134 <= 1998-08-18)) AND isnotnull(d_date_sk#4132L))
                  :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4132L,d_date#4134] Batched: true, DataFilters: [isnotnull(d_date#4134), (d_date#4134 >= 1998-08-04), (d_date#4134 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#2335]
                  :                 +- Filter isnotnull(cp_catalog_page_sk#4160L)
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#4160L,cp_catalog_page_id#4161] Batched: true, DataFilters: [isnotnull(cp_catalog_page_sk#4160L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cp_catalog_page_sk)], ReadSchema: struct<cp_catalog_page_sk:bigint,cp_catalog_page_id:string>
                  +- HashAggregate(keys=[web_site_id#4290], functions=[sum(sales_price#3957), sum(return_amt#4323), sum(profit#3958), sum(net_loss#4324)], output=[sales#3967, returns#3969, profit#3919, channel#4354, id#4355])
                     +- Exchange hashpartitioning(web_site_id#4290, 3000), ENSURE_REQUIREMENTS, [id=#2360]
                        +- HashAggregate(keys=[web_site_id#4290], functions=[partial_sum(sales_price#3957), partial_sum(return_amt#4323), partial_sum(profit#3958), partial_sum(net_loss#4324)], output=[web_site_id#4290, sum#4385, sum#4386, sum#4387, sum#4388])
                           +- Project [sales_price#3957, profit#3958, return_amt#4323, net_loss#4324, web_site_id#4290]
                              +- BroadcastHashJoin [wsr_web_site_sk#3955L], [web_site_sk#4289L], Inner, BuildRight, false
                                 :- Project [wsr_web_site_sk#3955L, sales_price#3957, profit#3958, return_amt#4323, net_loss#4324]
                                 :  +- BroadcastHashJoin [date_sk#3956L], [d_date_sk#4261L], Inner, BuildRight, false
                                 :     :- Union
                                 :     :  :- Project [ws_web_site_sk#4181L AS wsr_web_site_sk#3955L, ws_sold_date_sk#4202L AS date_sk#3956L, ws_ext_sales_price#4191 AS sales_price#3957, ws_net_profit#4201 AS profit#3958, 0.0 AS return_amt#4323, 0.0 AS net_loss#4324]
                                 :     :  :  +- Filter isnotnull(ws_web_site_sk#4181L)
                                 :     :  :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_web_site_sk#4181L,ws_ext_sales_price#4191,ws_net_profit#4201,ws_sold_date_sk#4202L] Batched: true, DataFilters: [isnotnull(ws_web_site_sk#4181L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#4202L), dynamicpruningexpression(ws_sold_date_sk#4202L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_web_site_sk:bigint,ws_ext_sales_price:double,ws_net_profit:double>
                                 :     :  :           +- SubqueryAdaptiveBroadcast dynamicpruning#4358, 0, true, Project [d_date_sk#4261L], [d_date_sk#4261L]
                                 :     :  :              +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :  :                 +- Project [d_date_sk#4261L]
                                 :     :  :                    +- Filter (((isnotnull(d_date#4263) AND (d_date#4263 >= 1998-08-04)) AND (d_date#4263 <= 1998-08-18)) AND isnotnull(d_date_sk#4261L))
                                 :     :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date#4263] Batched: true, DataFilters: [isnotnull(d_date#4263), (d_date#4263 >= 1998-08-04), (d_date#4263 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                 :     :  +- Project [ws_web_site_sk#4239L AS wsr_web_site_sk#3961L, wr_returned_date_sk#4226L AS date_sk#3962L, 0.0 AS sales_price#4325, 0.0 AS profit#4326, wr_return_amt#4217 AS return_amt#3965, wr_net_loss#4225 AS net_loss#3966]
                                 :     :     +- SortMergeJoin [wr_item_sk#4204L, wr_order_number#4215L], [ws_item_sk#4229L, ws_order_number#4243L], Inner
                                 :     :        :- Sort [wr_item_sk#4204L ASC NULLS FIRST, wr_order_number#4215L ASC NULLS FIRST], false, 0
                                 :     :        :  +- Exchange hashpartitioning(wr_item_sk#4204L, wr_order_number#4215L, 3000), ENSURE_REQUIREMENTS, [id=#2343]
                                 :     :        :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#4204L,wr_order_number#4215L,wr_return_amt#4217,wr_net_loss#4225,wr_returned_date_sk#4226L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(2184 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(wr_returned_date_sk#4226L), dynamicpruningexpression(wr_returned_date_sk#4226L IN dyna..., PushedFilters: [], ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint,wr_return_amt:double,wr_net_loss:double>
                                 :     :        :           +- SubqueryAdaptiveBroadcast dynamicpruning#4358, 0, true, Project [d_date_sk#4261L], [d_date_sk#4261L]
                                 :     :        :              +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :        :                 +- Project [d_date_sk#4261L]
                                 :     :        :                    +- Filter (((isnotnull(d_date#4263) AND (d_date#4263 >= 1998-08-04)) AND (d_date#4263 <= 1998-08-18)) AND isnotnull(d_date_sk#4261L))
                                 :     :        :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date#4263] Batched: true, DataFilters: [isnotnull(d_date#4263), (d_date#4263 >= 1998-08-04), (d_date#4263 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                 :     :        +- Sort [ws_item_sk#4229L ASC NULLS FIRST, ws_order_number#4243L ASC NULLS FIRST], false, 0
                                 :     :           +- Exchange hashpartitioning(ws_item_sk#4229L, ws_order_number#4243L, 3000), ENSURE_REQUIREMENTS, [id=#2344]
                                 :     :              +- Project [ws_item_sk#4229L, ws_web_site_sk#4239L, ws_order_number#4243L]
                                 :     :                 +- Filter ((isnotnull(ws_item_sk#4229L) AND isnotnull(ws_order_number#4243L)) AND isnotnull(ws_web_site_sk#4239L))
                                 :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#4229L,ws_web_site_sk#4239L,ws_order_number#4243L,ws_sold_date_sk#4260L] Batched: true, DataFilters: [isnotnull(ws_item_sk#4229L), isnotnull(ws_order_number#4243L), isnotnull(ws_web_site_sk#4239L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_order_number), IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_web_site_sk:bigint,ws_order_number:bigint>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2351]
                                 :        +- Project [d_date_sk#4261L]
                                 :           +- Filter (((isnotnull(d_date#4263) AND (d_date#4263 >= 1998-08-04)) AND (d_date#4263 <= 1998-08-18)) AND isnotnull(d_date_sk#4261L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4261L,d_date#4263] Batched: true, DataFilters: [isnotnull(d_date#4263), (d_date#4263 >= 1998-08-04), (d_date#4263 <= 1998-08-18), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-08-18), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#2355]
                                    +- Filter isnotnull(web_site_sk#4289L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#4289L,web_site_id#4290] Batched: true, DataFilters: [isnotnull(web_site_sk#4289L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:bigint,web_site_id:string>

read query: spark_queries/q6.sql
explain query: q6
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['cnt ASC NULLS FIRST], true
      +- 'UnresolvedHaving ('count(1) >= 10)
         +- 'Aggregate ['a.ca_state], ['a.ca_state AS state#4389, 'count(1) AS cnt#4390]
            +- 'Filter (((('a.ca_address_sk = 'c.c_current_addr_sk) AND ('c.c_customer_sk = 's.ss_customer_sk)) AND ('s.ss_sold_date_sk = 'd.d_date_sk)) AND ((('s.ss_item_sk = 'i.i_item_sk) AND ('d.d_month_seq = scalar-subquery#4391 [])) AND ('i.i_current_price > (1.2 * scalar-subquery#4392 []))))
               :  :- 'Distinct
               :  :  +- 'Project ['d_month_seq]
               :  :     +- 'Filter (('d_year = 2000) AND ('d_moy = 2))
               :  :        +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'Project [unresolvedalias('avg('j.i_current_price), None)]
               :     +- 'Filter ('j.i_category = 'i.i_category)
               :        +- 'SubqueryAlias j
               :           +- 'UnresolvedRelation [item], [], false
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'Join Inner
                  :  :  :  :- 'SubqueryAlias a
                  :  :  :  :  +- 'UnresolvedRelation [customer_address], [], false
                  :  :  :  +- 'SubqueryAlias c
                  :  :  :     +- 'UnresolvedRelation [customer], [], false
                  :  :  +- 'SubqueryAlias s
                  :  :     +- 'UnresolvedRelation [store_sales], [], false
                  :  +- 'SubqueryAlias d
                  :     +- 'UnresolvedRelation [date_dim], [], false
                  +- 'SubqueryAlias i
                     +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
state: string, cnt: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cnt#4390L ASC NULLS FIRST], true
      +- Filter (cnt#4390L >= cast(10 as bigint))
         +- Aggregate [ca_state#4403], [ca_state#4403 AS state#4389, count(1) AS cnt#4390L]
            +- Filter ((((ca_address_sk#4395L = c_current_addr_sk#4412L) AND (c_customer_sk#4408L = ss_customer_sk#4428L)) AND (ss_sold_date_sk#4448L = d_date_sk#4449L)) AND (((ss_item_sk#4427L = i_item_sk#4477L) AND (d_month_seq#4452 = scalar-subquery#4391 [])) AND (i_current_price#4482 > (cast(1.2 as double) * scalar-subquery#4392 [i_category#4489]))))
               :  :- Distinct
               :  :  +- Project [d_month_seq#4502]
               :  :     +- Filter ((d_year#4505 = 2000) AND (d_moy#4507 = 2))
               :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4499L,d_date_id#4500,d_date#4501,d_month_seq#4502,d_week_seq#4503,d_quarter_seq#4504,d_year#4505,d_dow#4506,d_moy#4507,d_dom#4508,d_qoy#4509,d_fy_year#4510,d_fy_quarter_seq#4511,d_fy_week_seq#4512,d_day_name#4513,d_quarter_name#4514,d_holiday#4515,d_weekend#4516,d_following_holiday#4517,d_first_dom#4518,d_last_dom#4519,d_same_day_ly#4520,d_same_day_lq#4521,d_current_day#4522,... 4 more fields] orc
               :  +- Aggregate [avg(i_current_price#4532) AS avg(i_current_price)#4550]
               :     +- Filter (i_category#4539 = outer(i_category#4489))
               :        +- SubqueryAlias j
               :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4527L,i_item_id#4528,i_rec_start_date#4529,i_rec_end_date#4530,i_item_desc#4531,i_current_price#4532,i_wholesale_cost#4533,i_brand_id#4534,i_brand#4535,i_class_id#4536,i_class#4537,i_category_id#4538,i_category#4539,i_manufact_id#4540,i_manufact#4541,i_size#4542,i_formulation#4543,i_color#4544,i_units#4545,i_container#4546,i_manager_id#4547,i_product_name#4548] orc
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- Join Inner
                  :  :  :  :- SubqueryAlias a
                  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4395L,ca_address_id#4396,ca_street_number#4397,ca_street_name#4398,ca_street_type#4399,ca_suite_number#4400,ca_city#4401,ca_county#4402,ca_state#4403,ca_zip#4404,ca_country#4405,ca_gmt_offset#4406,ca_location_type#4407] orc
                  :  :  :  +- SubqueryAlias c
                  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#4408L,c_customer_id#4409,c_current_cdemo_sk#4410L,c_current_hdemo_sk#4411L,c_current_addr_sk#4412L,c_first_shipto_date_sk#4413L,c_first_sales_date_sk#4414L,c_salutation#4415,c_first_name#4416,c_last_name#4417,c_preferred_cust_flag#4418,c_birth_day#4419,c_birth_month#4420,c_birth_year#4421,c_birth_country#4422,c_login#4423,c_email_address#4424,c_last_review_date#4425] orc
                  :  :  +- SubqueryAlias s
                  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4426L,ss_item_sk#4427L,ss_customer_sk#4428L,ss_cdemo_sk#4429L,ss_hdemo_sk#4430L,ss_addr_sk#4431L,ss_store_sk#4432L,ss_promo_sk#4433L,ss_ticket_number#4434L,ss_quantity#4435,ss_wholesale_cost#4436,ss_list_price#4437,ss_sales_price#4438,ss_ext_discount_amt#4439,ss_ext_sales_price#4440,ss_ext_wholesale_cost#4441,ss_ext_list_price#4442,ss_ext_tax#4443,ss_coupon_amt#4444,ss_net_paid#4445,ss_net_paid_inc_tax#4446,ss_net_profit#4447,ss_sold_date_sk#4448L] orc
                  :  +- SubqueryAlias d
                  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4449L,d_date_id#4450,d_date#4451,d_month_seq#4452,d_week_seq#4453,d_quarter_seq#4454,d_year#4455,d_dow#4456,d_moy#4457,d_dom#4458,d_qoy#4459,d_fy_year#4460,d_fy_quarter_seq#4461,d_fy_week_seq#4462,d_day_name#4463,d_quarter_name#4464,d_holiday#4465,d_weekend#4466,d_following_holiday#4467,d_first_dom#4468,d_last_dom#4469,d_same_day_ly#4470,d_same_day_lq#4471,d_current_day#4472,... 4 more fields] orc
                  +- SubqueryAlias i
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4477L,i_item_id#4478,i_rec_start_date#4479,i_rec_end_date#4480,i_item_desc#4481,i_current_price#4482,i_wholesale_cost#4483,i_brand_id#4484,i_brand#4485,i_class_id#4486,i_class#4487,i_category_id#4488,i_category#4489,i_manufact_id#4490,i_manufact#4491,i_size#4492,i_formulation#4493,i_color#4494,i_units#4495,i_container#4496,i_manager_id#4497,i_product_name#4498] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cnt#4390L ASC NULLS FIRST], true
      +- Filter (cnt#4390L >= 10)
         +- Aggregate [ca_state#4403], [ca_state#4403 AS state#4389, count(1) AS cnt#4390L]
            +- Project [ca_state#4403]
               +- Join Inner, (c_customer_sk#4408L = ss_customer_sk#4428L)
                  :- Project [ss_customer_sk#4428L]
                  :  +- Join Inner, (ss_item_sk#4427L = i_item_sk#4477L)
                  :     :- Project [ss_item_sk#4427L, ss_customer_sk#4428L]
                  :     :  +- Join Inner, (ss_sold_date_sk#4448L = d_date_sk#4449L)
                  :     :     :- Project [ss_item_sk#4427L, ss_customer_sk#4428L, ss_sold_date_sk#4448L]
                  :     :     :  +- Filter (((isnotnull(ss_customer_sk#4428L) AND isnotnull(ss_sold_date_sk#4448L)) AND isnotnull(ss_item_sk#4427L)) AND dynamicpruning#4553 [ss_sold_date_sk#4448L])
                  :     :     :     :  +- Project [d_date_sk#4449L]
                  :     :     :     :     +- Filter ((isnotnull(d_month_seq#4452) AND (d_month_seq#4452 = scalar-subquery#4391 [])) AND isnotnull(d_date_sk#4449L))
                  :     :     :     :        :  +- Aggregate [d_month_seq#4502], [d_month_seq#4502]
                  :     :     :     :        :     +- Project [d_month_seq#4502]
                  :     :     :     :        :        +- Filter ((isnotnull(d_year#4505) AND isnotnull(d_moy#4507)) AND ((d_year#4505 = 2000) AND (d_moy#4507 = 2)))
                  :     :     :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4499L,d_date_id#4500,d_date#4501,d_month_seq#4502,d_week_seq#4503,d_quarter_seq#4504,d_year#4505,d_dow#4506,d_moy#4507,d_dom#4508,d_qoy#4509,d_fy_year#4510,d_fy_quarter_seq#4511,d_fy_week_seq#4512,d_day_name#4513,d_quarter_name#4514,d_holiday#4515,d_weekend#4516,d_following_holiday#4517,d_first_dom#4518,d_last_dom#4519,d_same_day_ly#4520,d_same_day_lq#4521,d_current_day#4522,... 4 more fields] orc
                  :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4449L,d_date_id#4450,d_date#4451,d_month_seq#4452,d_week_seq#4453,d_quarter_seq#4454,d_year#4455,d_dow#4456,d_moy#4457,d_dom#4458,d_qoy#4459,d_fy_year#4460,d_fy_quarter_seq#4461,d_fy_week_seq#4462,d_day_name#4463,d_quarter_name#4464,d_holiday#4465,d_weekend#4466,d_following_holiday#4467,d_first_dom#4468,d_last_dom#4469,d_same_day_ly#4470,d_same_day_lq#4471,d_current_day#4472,... 4 more fields] orc
                  :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4426L,ss_item_sk#4427L,ss_customer_sk#4428L,ss_cdemo_sk#4429L,ss_hdemo_sk#4430L,ss_addr_sk#4431L,ss_store_sk#4432L,ss_promo_sk#4433L,ss_ticket_number#4434L,ss_quantity#4435,ss_wholesale_cost#4436,ss_list_price#4437,ss_sales_price#4438,ss_ext_discount_amt#4439,ss_ext_sales_price#4440,ss_ext_wholesale_cost#4441,ss_ext_list_price#4442,ss_ext_tax#4443,ss_coupon_amt#4444,ss_net_paid#4445,ss_net_paid_inc_tax#4446,ss_net_profit#4447,ss_sold_date_sk#4448L] orc
                  :     :     +- Project [d_date_sk#4449L]
                  :     :        +- Filter ((isnotnull(d_month_seq#4452) AND (d_month_seq#4452 = scalar-subquery#4391 [])) AND isnotnull(d_date_sk#4449L))
                  :     :           :  +- Aggregate [d_month_seq#4502], [d_month_seq#4502]
                  :     :           :     +- Project [d_month_seq#4502]
                  :     :           :        +- Filter ((isnotnull(d_year#4505) AND isnotnull(d_moy#4507)) AND ((d_year#4505 = 2000) AND (d_moy#4507 = 2)))
                  :     :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4499L,d_date_id#4500,d_date#4501,d_month_seq#4502,d_week_seq#4503,d_quarter_seq#4504,d_year#4505,d_dow#4506,d_moy#4507,d_dom#4508,d_qoy#4509,d_fy_year#4510,d_fy_quarter_seq#4511,d_fy_week_seq#4512,d_day_name#4513,d_quarter_name#4514,d_holiday#4515,d_weekend#4516,d_following_holiday#4517,d_first_dom#4518,d_last_dom#4519,d_same_day_ly#4520,d_same_day_lq#4521,d_current_day#4522,... 4 more fields] orc
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4449L,d_date_id#4450,d_date#4451,d_month_seq#4452,d_week_seq#4453,d_quarter_seq#4454,d_year#4455,d_dow#4456,d_moy#4457,d_dom#4458,d_qoy#4459,d_fy_year#4460,d_fy_quarter_seq#4461,d_fy_week_seq#4462,d_day_name#4463,d_quarter_name#4464,d_holiday#4465,d_weekend#4466,d_following_holiday#4467,d_first_dom#4468,d_last_dom#4469,d_same_day_ly#4470,d_same_day_lq#4471,d_current_day#4472,... 4 more fields] orc
                  :     +- Project [i_item_sk#4477L]
                  :        +- Join Inner, ((i_current_price#4482 > (1.2 * avg(i_current_price)#4550)) AND (i_category#4539 = i_category#4489))
                  :           :- Project [i_item_sk#4477L, i_current_price#4482, i_category#4489]
                  :           :  +- Filter ((isnotnull(i_current_price#4482) AND isnotnull(i_category#4489)) AND isnotnull(i_item_sk#4477L))
                  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4477L,i_item_id#4478,i_rec_start_date#4479,i_rec_end_date#4480,i_item_desc#4481,i_current_price#4482,i_wholesale_cost#4483,i_brand_id#4484,i_brand#4485,i_class_id#4486,i_class#4487,i_category_id#4488,i_category#4489,i_manufact_id#4490,i_manufact#4491,i_size#4492,i_formulation#4493,i_color#4494,i_units#4495,i_container#4496,i_manager_id#4497,i_product_name#4498] orc
                  :           +- Filter isnotnull(avg(i_current_price)#4550)
                  :              +- Aggregate [i_category#4539], [avg(i_current_price#4532) AS avg(i_current_price)#4550, i_category#4539]
                  :                 +- Project [i_current_price#4532, i_category#4539]
                  :                    +- Filter isnotnull(i_category#4539)
                  :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4527L,i_item_id#4528,i_rec_start_date#4529,i_rec_end_date#4530,i_item_desc#4531,i_current_price#4532,i_wholesale_cost#4533,i_brand_id#4534,i_brand#4535,i_class_id#4536,i_class#4537,i_category_id#4538,i_category#4539,i_manufact_id#4540,i_manufact#4541,i_size#4542,i_formulation#4543,i_color#4544,i_units#4545,i_container#4546,i_manager_id#4547,i_product_name#4548] orc
                  +- Project [ca_state#4403, c_customer_sk#4408L]
                     +- Join Inner, (ca_address_sk#4395L = c_current_addr_sk#4412L)
                        :- Project [ca_address_sk#4395L, ca_state#4403]
                        :  +- Filter isnotnull(ca_address_sk#4395L)
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4395L,ca_address_id#4396,ca_street_number#4397,ca_street_name#4398,ca_street_type#4399,ca_suite_number#4400,ca_city#4401,ca_county#4402,ca_state#4403,ca_zip#4404,ca_country#4405,ca_gmt_offset#4406,ca_location_type#4407] orc
                        +- Project [c_customer_sk#4408L, c_current_addr_sk#4412L]
                           +- Filter (isnotnull(c_current_addr_sk#4412L) AND isnotnull(c_customer_sk#4408L))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#4408L,c_customer_id#4409,c_current_cdemo_sk#4410L,c_current_hdemo_sk#4411L,c_current_addr_sk#4412L,c_first_shipto_date_sk#4413L,c_first_sales_date_sk#4414L,c_salutation#4415,c_first_name#4416,c_last_name#4417,c_preferred_cust_flag#4418,c_birth_day#4419,c_birth_month#4420,c_birth_year#4421,c_birth_country#4422,c_login#4423,c_email_address#4424,c_last_review_date#4425] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[cnt#4390L ASC NULLS FIRST], output=[state#4389,cnt#4390L])
   +- Filter (cnt#4390L >= 10)
      +- HashAggregate(keys=[ca_state#4403], functions=[count(1)], output=[state#4389, cnt#4390L])
         +- Exchange hashpartitioning(ca_state#4403, 3000), ENSURE_REQUIREMENTS, [id=#2579]
            +- HashAggregate(keys=[ca_state#4403], functions=[partial_count(1)], output=[ca_state#4403, count#4555L])
               +- Project [ca_state#4403]
                  +- SortMergeJoin [ss_customer_sk#4428L], [c_customer_sk#4408L], Inner
                     :- Sort [ss_customer_sk#4428L ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(ss_customer_sk#4428L, 3000), ENSURE_REQUIREMENTS, [id=#2571]
                     :     +- Project [ss_customer_sk#4428L]
                     :        +- BroadcastHashJoin [ss_item_sk#4427L], [i_item_sk#4477L], Inner, BuildRight, false
                     :           :- Project [ss_item_sk#4427L, ss_customer_sk#4428L]
                     :           :  +- BroadcastHashJoin [ss_sold_date_sk#4448L], [d_date_sk#4449L], Inner, BuildRight, false
                     :           :     :- Filter (isnotnull(ss_customer_sk#4428L) AND isnotnull(ss_item_sk#4427L))
                     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#4427L,ss_customer_sk#4428L,ss_sold_date_sk#4448L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#4428L), isnotnull(ss_item_sk#4427L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#4448L), dynamicpruningexpression(ss_sold_date_sk#4448L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint>
                     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#4553, 0, true, Project [d_date_sk#4449L], [d_date_sk#4449L]
                     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                     :           :     :              +- Project [d_date_sk#4449L]
                     :           :     :                 +- Filter ((isnotnull(d_month_seq#4452) AND (d_month_seq#4452 = Subquery subquery#4391, [id=#2497])) AND isnotnull(d_date_sk#4449L))
                     :           :     :                    :  +- Subquery subquery#4391, [id=#2497]
                     :           :     :                    :     +- AdaptiveSparkPlan isFinalPlan=false
                     :           :     :                    :        +- HashAggregate(keys=[d_month_seq#4502], functions=[], output=[d_month_seq#4502])
                     :           :     :                    :           +- Exchange hashpartitioning(d_month_seq#4502, 3000), ENSURE_REQUIREMENTS, [id=#2495]
                     :           :     :                    :              +- HashAggregate(keys=[d_month_seq#4502], functions=[], output=[d_month_seq#4502])
                     :           :     :                    :                 +- Project [d_month_seq#4502]
                     :           :     :                    :                    +- Filter (((isnotnull(d_year#4505) AND isnotnull(d_moy#4507)) AND (d_year#4505 = 2000)) AND (d_moy#4507 = 2))
                     :           :     :                    :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#4502,d_year#4505,d_moy#4507] Batched: true, DataFilters: [isnotnull(d_year#4505), isnotnull(d_moy#4507), (d_year#4505 = 2000), (d_moy#4507 = 2)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,2)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                     :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4449L,d_month_seq#4452] Batched: true, DataFilters: [isnotnull(d_month_seq#4452), isnotnull(d_date_sk#4449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2548]
                     :           :        +- Project [d_date_sk#4449L]
                     :           :           +- Filter ((isnotnull(d_month_seq#4452) AND (d_month_seq#4452 = Subquery subquery#4391, [id=#2514])) AND isnotnull(d_date_sk#4449L))
                     :           :              :  +- Subquery subquery#4391, [id=#2514]
                     :           :              :     +- AdaptiveSparkPlan isFinalPlan=false
                     :           :              :        +- HashAggregate(keys=[d_month_seq#4502], functions=[], output=[d_month_seq#4502])
                     :           :              :           +- Exchange hashpartitioning(d_month_seq#4502, 3000), ENSURE_REQUIREMENTS, [id=#2512]
                     :           :              :              +- HashAggregate(keys=[d_month_seq#4502], functions=[], output=[d_month_seq#4502])
                     :           :              :                 +- Project [d_month_seq#4502]
                     :           :              :                    +- Filter (((isnotnull(d_year#4505) AND isnotnull(d_moy#4507)) AND (d_year#4505 = 2000)) AND (d_moy#4507 = 2))
                     :           :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#4502,d_year#4505,d_moy#4507] Batched: true, DataFilters: [isnotnull(d_year#4505), isnotnull(d_moy#4507), (d_year#4505 = 2000), (d_moy#4507 = 2)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,2)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4449L,d_month_seq#4452] Batched: true, DataFilters: [isnotnull(d_month_seq#4452), isnotnull(d_date_sk#4449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2559]
                     :              +- Project [i_item_sk#4477L]
                     :                 +- BroadcastHashJoin [i_category#4489], [i_category#4539], Inner, BuildRight, (i_current_price#4482 > (1.2 * avg(i_current_price)#4550)), false
                     :                    :- Filter ((isnotnull(i_current_price#4482) AND isnotnull(i_category#4489)) AND isnotnull(i_item_sk#4477L))
                     :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4477L,i_current_price#4482,i_category#4489] Batched: true, DataFilters: [isnotnull(i_current_price#4482), isnotnull(i_category#4489), isnotnull(i_item_sk#4477L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), IsNotNull(i_category), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double,i_category:string>
                     :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, string, true]),false), [id=#2555]
                     :                       +- Filter isnotnull(avg(i_current_price)#4550)
                     :                          +- HashAggregate(keys=[i_category#4539], functions=[avg(i_current_price#4532)], output=[avg(i_current_price)#4550, i_category#4539])
                     :                             +- Exchange hashpartitioning(i_category#4539, 3000), ENSURE_REQUIREMENTS, [id=#2551]
                     :                                +- HashAggregate(keys=[i_category#4539], functions=[partial_avg(i_current_price#4532)], output=[i_category#4539, sum#4558, count#4559L])
                     :                                   +- Filter isnotnull(i_category#4539)
                     :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_current_price#4532,i_category#4539] Batched: true, DataFilters: [isnotnull(i_category#4539)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category)], ReadSchema: struct<i_current_price:double,i_category:string>
                     +- Sort [c_customer_sk#4408L ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(c_customer_sk#4408L, 3000), ENSURE_REQUIREMENTS, [id=#2572]
                           +- Project [ca_state#4403, c_customer_sk#4408L]
                              +- SortMergeJoin [ca_address_sk#4395L], [c_current_addr_sk#4412L], Inner
                                 :- Sort [ca_address_sk#4395L ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(ca_address_sk#4395L, 3000), ENSURE_REQUIREMENTS, [id=#2563]
                                 :     +- Filter isnotnull(ca_address_sk#4395L)
                                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4395L,ca_state#4403] Batched: true, DataFilters: [isnotnull(ca_address_sk#4395L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                                 +- Sort [c_current_addr_sk#4412L ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(c_current_addr_sk#4412L, 3000), ENSURE_REQUIREMENTS, [id=#2564]
                                       +- Filter (isnotnull(c_current_addr_sk#4412L) AND isnotnull(c_customer_sk#4408L))
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#4408L,c_current_addr_sk#4412L] Batched: true, DataFilters: [isnotnull(c_current_addr_sk#4412L), isnotnull(c_customer_sk#4408L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>

read query: spark_queries/q7.sql
explain query: q7
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id], ['i_item_id, 'avg('ss_quantity) AS agg1#4560, 'avg('ss_list_price) AS agg2#4561, 'avg('ss_coupon_amt) AS agg3#4562, 'avg('ss_sales_price) AS agg4#4563]
         +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND ('ss_cdemo_sk = 'cd_demo_sk)) AND (('ss_promo_sk = 'p_promo_sk) AND ('cd_gender = F))) AND ((('cd_marital_status = W) AND ('cd_education_status = Primary)) AND ((('p_channel_email = N) OR ('p_channel_event = N)) AND ('d_year = 1998))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [promotion], [], false

== Analyzed Logical Plan ==
i_item_id: string, agg1: double, agg2: double, agg3: double, agg4: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#4625 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#4625], [i_item_id#4625, avg(ss_quantity#4573) AS agg1#4560, avg(ss_list_price#4575) AS agg2#4561, avg(ss_coupon_amt#4582) AS agg3#4562, avg(ss_sales_price#4576) AS agg4#4563]
         +- Filter (((((ss_sold_date_sk#4586L = d_date_sk#4596L) AND (ss_item_sk#4565L = i_item_sk#4624L)) AND (ss_cdemo_sk#4567L = cd_demo_sk#4587L)) AND ((ss_promo_sk#4571L = p_promo_sk#4646L) AND (cd_gender#4588 = F))) AND (((cd_marital_status#4589 = W) AND (cd_education_status#4590 = Primary)) AND (((p_channel_email#4655 = N) OR (p_channel_event#4660 = N)) AND (d_year#4602 = 1998))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4564L,ss_item_sk#4565L,ss_customer_sk#4566L,ss_cdemo_sk#4567L,ss_hdemo_sk#4568L,ss_addr_sk#4569L,ss_store_sk#4570L,ss_promo_sk#4571L,ss_ticket_number#4572L,ss_quantity#4573,ss_wholesale_cost#4574,ss_list_price#4575,ss_sales_price#4576,ss_ext_discount_amt#4577,ss_ext_sales_price#4578,ss_ext_wholesale_cost#4579,ss_ext_list_price#4580,ss_ext_tax#4581,ss_coupon_amt#4582,ss_net_paid#4583,ss_net_paid_inc_tax#4584,ss_net_profit#4585,ss_sold_date_sk#4586L] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#4587L,cd_gender#4588,cd_marital_status#4589,cd_education_status#4590,cd_purchase_estimate#4591,cd_credit_rating#4592,cd_dep_count#4593,cd_dep_employed_count#4594,cd_dep_college_count#4595] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4596L,d_date_id#4597,d_date#4598,d_month_seq#4599,d_week_seq#4600,d_quarter_seq#4601,d_year#4602,d_dow#4603,d_moy#4604,d_dom#4605,d_qoy#4606,d_fy_year#4607,d_fy_quarter_seq#4608,d_fy_week_seq#4609,d_day_name#4610,d_quarter_name#4611,d_holiday#4612,d_weekend#4613,d_following_holiday#4614,d_first_dom#4615,d_last_dom#4616,d_same_day_ly#4617,d_same_day_lq#4618,d_current_day#4619,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4624L,i_item_id#4625,i_rec_start_date#4626,i_rec_end_date#4627,i_item_desc#4628,i_current_price#4629,i_wholesale_cost#4630,i_brand_id#4631,i_brand#4632,i_class_id#4633,i_class#4634,i_category_id#4635,i_category#4636,i_manufact_id#4637,i_manufact#4638,i_size#4639,i_formulation#4640,i_color#4641,i_units#4642,i_container#4643,i_manager_id#4644,i_product_name#4645] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#4646L,p_promo_id#4647,p_start_date_sk#4648L,p_end_date_sk#4649L,p_item_sk#4650L,p_cost#4651,p_response_target#4652,p_promo_name#4653,p_channel_dmail#4654,p_channel_email#4655,p_channel_catalog#4656,p_channel_tv#4657,p_channel_radio#4658,p_channel_press#4659,p_channel_event#4660,p_channel_demo#4661,p_channel_details#4662,p_purpose#4663,p_discount_active#4664] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#4625 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#4625], [i_item_id#4625, avg(ss_quantity#4573) AS agg1#4560, avg(ss_list_price#4575) AS agg2#4561, avg(ss_coupon_amt#4582) AS agg3#4562, avg(ss_sales_price#4576) AS agg4#4563]
         +- Project [ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582, i_item_id#4625]
            +- Join Inner, (ss_item_sk#4565L = i_item_sk#4624L)
               :- Project [ss_item_sk#4565L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582]
               :  +- Join Inner, (ss_promo_sk#4571L = p_promo_sk#4646L)
               :     :- Project [ss_item_sk#4565L, ss_promo_sk#4571L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582]
               :     :  +- Join Inner, (ss_sold_date_sk#4586L = d_date_sk#4596L)
               :     :     :- Project [ss_item_sk#4565L, ss_promo_sk#4571L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582, ss_sold_date_sk#4586L]
               :     :     :  +- Join Inner, (ss_cdemo_sk#4567L = cd_demo_sk#4587L)
               :     :     :     :- Project [ss_item_sk#4565L, ss_cdemo_sk#4567L, ss_promo_sk#4571L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582, ss_sold_date_sk#4586L]
               :     :     :     :  +- Filter ((((isnotnull(ss_cdemo_sk#4567L) AND isnotnull(ss_sold_date_sk#4586L)) AND isnotnull(ss_item_sk#4565L)) AND isnotnull(ss_promo_sk#4571L)) AND dynamicpruning#4674 [ss_sold_date_sk#4586L])
               :     :     :     :     :  +- Project [d_date_sk#4596L]
               :     :     :     :     :     +- Filter ((isnotnull(d_year#4602) AND (d_year#4602 = 1998)) AND isnotnull(d_date_sk#4596L))
               :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4596L,d_date_id#4597,d_date#4598,d_month_seq#4599,d_week_seq#4600,d_quarter_seq#4601,d_year#4602,d_dow#4603,d_moy#4604,d_dom#4605,d_qoy#4606,d_fy_year#4607,d_fy_quarter_seq#4608,d_fy_week_seq#4609,d_day_name#4610,d_quarter_name#4611,d_holiday#4612,d_weekend#4613,d_following_holiday#4614,d_first_dom#4615,d_last_dom#4616,d_same_day_ly#4617,d_same_day_lq#4618,d_current_day#4619,... 4 more fields] orc
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4564L,ss_item_sk#4565L,ss_customer_sk#4566L,ss_cdemo_sk#4567L,ss_hdemo_sk#4568L,ss_addr_sk#4569L,ss_store_sk#4570L,ss_promo_sk#4571L,ss_ticket_number#4572L,ss_quantity#4573,ss_wholesale_cost#4574,ss_list_price#4575,ss_sales_price#4576,ss_ext_discount_amt#4577,ss_ext_sales_price#4578,ss_ext_wholesale_cost#4579,ss_ext_list_price#4580,ss_ext_tax#4581,ss_coupon_amt#4582,ss_net_paid#4583,ss_net_paid_inc_tax#4584,ss_net_profit#4585,ss_sold_date_sk#4586L] orc
               :     :     :     +- Project [cd_demo_sk#4587L]
               :     :     :        +- Filter ((((isnotnull(cd_gender#4588) AND isnotnull(cd_marital_status#4589)) AND isnotnull(cd_education_status#4590)) AND (((cd_gender#4588 = F) AND (cd_marital_status#4589 = W)) AND (cd_education_status#4590 = Primary))) AND isnotnull(cd_demo_sk#4587L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#4587L,cd_gender#4588,cd_marital_status#4589,cd_education_status#4590,cd_purchase_estimate#4591,cd_credit_rating#4592,cd_dep_count#4593,cd_dep_employed_count#4594,cd_dep_college_count#4595] orc
               :     :     +- Project [d_date_sk#4596L]
               :     :        +- Filter ((isnotnull(d_year#4602) AND (d_year#4602 = 1998)) AND isnotnull(d_date_sk#4596L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4596L,d_date_id#4597,d_date#4598,d_month_seq#4599,d_week_seq#4600,d_quarter_seq#4601,d_year#4602,d_dow#4603,d_moy#4604,d_dom#4605,d_qoy#4606,d_fy_year#4607,d_fy_quarter_seq#4608,d_fy_week_seq#4609,d_day_name#4610,d_quarter_name#4611,d_holiday#4612,d_weekend#4613,d_following_holiday#4614,d_first_dom#4615,d_last_dom#4616,d_same_day_ly#4617,d_same_day_lq#4618,d_current_day#4619,... 4 more fields] orc
               :     +- Project [p_promo_sk#4646L]
               :        +- Filter (((p_channel_email#4655 = N) OR (p_channel_event#4660 = N)) AND isnotnull(p_promo_sk#4646L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#4646L,p_promo_id#4647,p_start_date_sk#4648L,p_end_date_sk#4649L,p_item_sk#4650L,p_cost#4651,p_response_target#4652,p_promo_name#4653,p_channel_dmail#4654,p_channel_email#4655,p_channel_catalog#4656,p_channel_tv#4657,p_channel_radio#4658,p_channel_press#4659,p_channel_event#4660,p_channel_demo#4661,p_channel_details#4662,p_purpose#4663,p_discount_active#4664] orc
               +- Project [i_item_sk#4624L, i_item_id#4625]
                  +- Filter isnotnull(i_item_sk#4624L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4624L,i_item_id#4625,i_rec_start_date#4626,i_rec_end_date#4627,i_item_desc#4628,i_current_price#4629,i_wholesale_cost#4630,i_brand_id#4631,i_brand#4632,i_class_id#4633,i_class#4634,i_category_id#4635,i_category#4636,i_manufact_id#4637,i_manufact#4638,i_size#4639,i_formulation#4640,i_color#4641,i_units#4642,i_container#4643,i_manager_id#4644,i_product_name#4645] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#4625 ASC NULLS FIRST], output=[i_item_id#4625,agg1#4560,agg2#4561,agg3#4562,agg4#4563])
   +- HashAggregate(keys=[i_item_id#4625], functions=[avg(ss_quantity#4573), avg(ss_list_price#4575), avg(ss_coupon_amt#4582), avg(ss_sales_price#4576)], output=[i_item_id#4625, agg1#4560, agg2#4561, agg3#4562, agg4#4563])
      +- Exchange hashpartitioning(i_item_id#4625, 3000), ENSURE_REQUIREMENTS, [id=#2717]
         +- HashAggregate(keys=[i_item_id#4625], functions=[partial_avg(ss_quantity#4573), partial_avg(ss_list_price#4575), partial_avg(ss_coupon_amt#4582), partial_avg(ss_sales_price#4576)], output=[i_item_id#4625, sum#4683, count#4684L, sum#4685, count#4686L, sum#4687, count#4688L, sum#4689, count#4690L])
            +- Project [ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582, i_item_id#4625]
               +- SortMergeJoin [ss_item_sk#4565L], [i_item_sk#4624L], Inner
                  :- Sort [ss_item_sk#4565L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(ss_item_sk#4565L, 3000), ENSURE_REQUIREMENTS, [id=#2709]
                  :     +- Project [ss_item_sk#4565L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582]
                  :        +- BroadcastHashJoin [ss_promo_sk#4571L], [p_promo_sk#4646L], Inner, BuildRight, false
                  :           :- Project [ss_item_sk#4565L, ss_promo_sk#4571L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582]
                  :           :  +- BroadcastHashJoin [ss_sold_date_sk#4586L], [d_date_sk#4596L], Inner, BuildRight, false
                  :           :     :- Project [ss_item_sk#4565L, ss_promo_sk#4571L, ss_quantity#4573, ss_list_price#4575, ss_sales_price#4576, ss_coupon_amt#4582, ss_sold_date_sk#4586L]
                  :           :     :  +- BroadcastHashJoin [ss_cdemo_sk#4567L], [cd_demo_sk#4587L], Inner, BuildRight, false
                  :           :     :     :- Filter ((isnotnull(ss_cdemo_sk#4567L) AND isnotnull(ss_item_sk#4565L)) AND isnotnull(ss_promo_sk#4571L))
                  :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#4565L,ss_cdemo_sk#4567L,ss_promo_sk#4571L,ss_quantity#4573,ss_list_price#4575,ss_sales_price#4576,ss_coupon_amt#4582,ss_sold_date_sk#4586L] Batched: true, DataFilters: [isnotnull(ss_cdemo_sk#4567L), isnotnull(ss_item_sk#4565L), isnotnull(ss_promo_sk#4571L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#4586L), dynamicpruningexpression(ss_sold_date_sk#4586L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_cdemo_sk), IsNotNull(ss_item_sk), IsNotNull(ss_promo_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_cdemo_sk:bigint,ss_promo_sk:bigint,ss_quantity:int,ss_list_price:doub...
                  :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#4674, 0, true, Project [d_date_sk#4596L], [d_date_sk#4596L]
                  :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :     :     :              +- Project [d_date_sk#4596L]
                  :           :     :     :                 +- Filter ((isnotnull(d_year#4602) AND (d_year#4602 = 1998)) AND isnotnull(d_date_sk#4596L))
                  :           :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4596L,d_year#4602] Batched: true, DataFilters: [isnotnull(d_year#4602), (d_year#4602 = 1998), isnotnull(d_date_sk#4596L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2696]
                  :           :     :        +- Project [cd_demo_sk#4587L]
                  :           :     :           +- Filter ((((((isnotnull(cd_gender#4588) AND isnotnull(cd_marital_status#4589)) AND isnotnull(cd_education_status#4590)) AND (cd_gender#4588 = F)) AND (cd_marital_status#4589 = W)) AND (cd_education_status#4590 = Primary)) AND isnotnull(cd_demo_sk#4587L))
                  :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#4587L,cd_gender#4588,cd_marital_status#4589,cd_education_status#4590] Batched: true, DataFilters: [isnotnull(cd_gender#4588), isnotnull(cd_marital_status#4589), isnotnull(cd_education_status#4590..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_marital_status), IsNotNull(cd_education_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_education_status:string>
                  :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2700]
                  :           :        +- Project [d_date_sk#4596L]
                  :           :           +- Filter ((isnotnull(d_year#4602) AND (d_year#4602 = 1998)) AND isnotnull(d_date_sk#4596L))
                  :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4596L,d_year#4602] Batched: true, DataFilters: [isnotnull(d_year#4602), (d_year#4602 = 1998), isnotnull(d_date_sk#4596L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2704]
                  :              +- Project [p_promo_sk#4646L]
                  :                 +- Filter (((p_channel_email#4655 = N) OR (p_channel_event#4660 = N)) AND isnotnull(p_promo_sk#4646L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#4646L,p_channel_email#4655,p_channel_event#4660] Batched: true, DataFilters: [((p_channel_email#4655 = N) OR (p_channel_event#4660 = N)), isnotnull(p_promo_sk#4646L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(p_channel_email,N),EqualTo(p_channel_event,N)), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint,p_channel_email:string,p_channel_event:string>
                  +- Sort [i_item_sk#4624L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(i_item_sk#4624L, 3000), ENSURE_REQUIREMENTS, [id=#2710]
                        +- Filter isnotnull(i_item_sk#4624L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#4624L,i_item_id#4625] Batched: true, DataFilters: [isnotnull(i_item_sk#4624L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q8.sql
explain query: q8
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['s_store_name ASC NULLS FIRST], true
      +- 'Aggregate ['s_store_name], ['s_store_name, unresolvedalias('sum('ss_net_profit), None)]
         +- 'Filter (((('ss_store_sk = 's_store_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('d_qoy = 1)) AND (('d_year = 2002) AND ('substr('s_zip, 1, 2) = 'substr('V1.ca_zip, 1, 2))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store], [], false
               +- 'SubqueryAlias V1
                  +- 'Project ['ca_zip]
                     +- 'SubqueryAlias A2
                        +- 'Intersect false
                           :- 'Project ['substr('ca_zip, 1, 5) AS ca_zip#4691]
                           :  +- 'Filter 'substr('ca_zip, 1, 5) IN (89436,30868,65085,22977,83927,77557,58429,40697,80614,10502,32779,91137,61265,98294,17921,18427,21203,59362,87291,84093,21505,17184,10866,67898,25797,28055,18377,80332,74535,21757,29742,90885,29898,17819,40811,25990,47513,89531,91068,10391,18846,99223,82637,41368,83658,86199,81625,26696,89338,88425,32200,81427,19053,77471,36610,99823,43276,41249,48584,83550,82276,18842,78890,14090,38123,40936,34425,19850,43286,80072,79188,54191,11395,50497,84861,90733,21068,57666,37119,25004,57835,70067,62878,95806,19303,18840,19124,29785,16737,16022,49613,89977,68310,60069,98360,48649,39050,41793,25002,27413,39736,47208,16515,94808,57648,15009,80015,42961,63982,21744,71853,81087,67468,34175,64008,20261,11201,51799,48043,45645,61163,48375,36447,57042,21218,41100,89951,22745,35851,83326,61125,78298,80752,49858,52940,96976,63792,11376,53582,18717,90226,50530,94203,99447,27670,96577,57856,56372,16165,23427,54561,28806,44439,22926,30123,61451,92397,56979,92309,70873,13355,21801,46346,37562,56458,28286,47306,99555,69399,26234,47546,49661,88601,35943,39936,25632,24611,44166,56648,30379,59785,11110,14329,93815,52226,71381,13842,25612,63294,14664,21077,82626,18799,60915,81020,56447,76619,11433,13414,42548,92713,70467,30884,47484,16072,38936,13036,88376,45539,35901,19506,65690,73957,71850,49231,14276,20005,18384,76615,11635,38177,55607,41369,95447,58581,58149,91946,33790,76232,75692,95464,22246,51061,56692,53121,77209,15482,10688,14868,45907,73520,72666,25734,17959,24677,66446,94627,53535,15560,41967,69297,11929,59403,33283,52232,57350,43933,40921,36635,10827,71286,19736,80619,25251,95042,15526,36496,55854,49124,81980,35375,49157,63512,28944,14946,36503,54010,18767,23969,43905,66979,33113,21286,58471,59080,13395,79144,70373,67031,38360,26705,50906,52406,26066,73146,15884,31897,30045,61068,45550,92454,13376,14354,19770,22928,97790,50723,46081,30202,14410,20223,88500,67298,13261,14172,81410,93578,83583,46047,94167,82564,21156,15799,86709,37931,74703,83103,23054,70470,72008,49247,91911,69998,20961,70070,63197,54853,88191,91830,49521,19454,81450,89091,62378,25683,61869,51744,36580,85778,36871,48121,28810,83712,45486,67393,26935,42393,20132,55349,86057,21309,80218,10094,11357,48819,39734,40758,30432,21204,29467,30214,61024,55307,74621,11622,68908,33032,52868,99194,99900,84936,69036,99149,45013,32895,59004,32322,14933,32936,33562,72550,27385,58049,58200,16808,21360,32961,18586,79307,15492)
                           :     +- 'UnresolvedRelation [customer_address], [], false
                           +- 'Project ['ca_zip]
                              +- 'SubqueryAlias A1
                                 +- 'UnresolvedHaving ('count(1) > 10)
                                    +- 'Aggregate ['ca_zip], ['substr('ca_zip, 1, 5) AS ca_zip#4692, 'count(1) AS cnt#4693]
                                       +- 'Filter (('ca_address_sk = 'c_current_addr_sk) AND ('c_preferred_cust_flag = Y))
                                          +- 'Join Inner
                                             :- 'UnresolvedRelation [customer_address], [], false
                                             +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
s_store_name: string, sum(ss_net_profit): double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#4752 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#4752], [s_store_name#4752, sum(ss_net_profit#4717) AS sum(ss_net_profit)#4821]
         +- Filter ((((ss_store_sk#4702L = s_store_sk#4747L) AND (ss_sold_date_sk#4718L = d_date_sk#4719L)) AND (d_qoy#4729 = 1)) AND ((d_year#4725 = 2002) AND (substr(s_zip#4772, 1, 2) = substr(ca_zip#4691, 1, 2))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4696L,ss_item_sk#4697L,ss_customer_sk#4698L,ss_cdemo_sk#4699L,ss_hdemo_sk#4700L,ss_addr_sk#4701L,ss_store_sk#4702L,ss_promo_sk#4703L,ss_ticket_number#4704L,ss_quantity#4705,ss_wholesale_cost#4706,ss_list_price#4707,ss_sales_price#4708,ss_ext_discount_amt#4709,ss_ext_sales_price#4710,ss_ext_wholesale_cost#4711,ss_ext_list_price#4712,ss_ext_tax#4713,ss_coupon_amt#4714,ss_net_paid#4715,ss_net_paid_inc_tax#4716,ss_net_profit#4717,ss_sold_date_sk#4718L] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4719L,d_date_id#4720,d_date#4721,d_month_seq#4722,d_week_seq#4723,d_quarter_seq#4724,d_year#4725,d_dow#4726,d_moy#4727,d_dom#4728,d_qoy#4729,d_fy_year#4730,d_fy_quarter_seq#4731,d_fy_week_seq#4732,d_day_name#4733,d_quarter_name#4734,d_holiday#4735,d_weekend#4736,d_following_holiday#4737,d_first_dom#4738,d_last_dom#4739,d_same_day_ly#4740,d_same_day_lq#4741,d_current_day#4742,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4747L,s_store_id#4748,s_rec_start_date#4749,s_rec_end_date#4750,s_closed_date_sk#4751L,s_store_name#4752,s_number_employees#4753,s_floor_space#4754,s_hours#4755,s_manager#4756,s_market_id#4757,s_geography_class#4758,s_market_desc#4759,s_market_manager#4760,s_division_id#4761,s_division_name#4762,s_company_id#4763,s_company_name#4764,s_street_number#4765,s_street_name#4766,s_street_type#4767,s_suite_number#4768,s_city#4769,s_county#4770,... 5 more fields] orc
               +- SubqueryAlias V1
                  +- Project [ca_zip#4691]
                     +- SubqueryAlias A2
                        +- Intersect false
                           :- Project [substr(ca_zip#4785, 1, 5) AS ca_zip#4691]
                           :  +- Filter substr(ca_zip#4785, 1, 5) IN (89436,30868,65085,22977,83927,77557,58429,40697,80614,10502,32779,91137,61265,98294,17921,18427,21203,59362,87291,84093,21505,17184,10866,67898,25797,28055,18377,80332,74535,21757,29742,90885,29898,17819,40811,25990,47513,89531,91068,10391,18846,99223,82637,41368,83658,86199,81625,26696,89338,88425,32200,81427,19053,77471,36610,99823,43276,41249,48584,83550,82276,18842,78890,14090,38123,40936,34425,19850,43286,80072,79188,54191,11395,50497,84861,90733,21068,57666,37119,25004,57835,70067,62878,95806,19303,18840,19124,29785,16737,16022,49613,89977,68310,60069,98360,48649,39050,41793,25002,27413,39736,47208,16515,94808,57648,15009,80015,42961,63982,21744,71853,81087,67468,34175,64008,20261,11201,51799,48043,45645,61163,48375,36447,57042,21218,41100,89951,22745,35851,83326,61125,78298,80752,49858,52940,96976,63792,11376,53582,18717,90226,50530,94203,99447,27670,96577,57856,56372,16165,23427,54561,28806,44439,22926,30123,61451,92397,56979,92309,70873,13355,21801,46346,37562,56458,28286,47306,99555,69399,26234,47546,49661,88601,35943,39936,25632,24611,44166,56648,30379,59785,11110,14329,93815,52226,71381,13842,25612,63294,14664,21077,82626,18799,60915,81020,56447,76619,11433,13414,42548,92713,70467,30884,47484,16072,38936,13036,88376,45539,35901,19506,65690,73957,71850,49231,14276,20005,18384,76615,11635,38177,55607,41369,95447,58581,58149,91946,33790,76232,75692,95464,22246,51061,56692,53121,77209,15482,10688,14868,45907,73520,72666,25734,17959,24677,66446,94627,53535,15560,41967,69297,11929,59403,33283,52232,57350,43933,40921,36635,10827,71286,19736,80619,25251,95042,15526,36496,55854,49124,81980,35375,49157,63512,28944,14946,36503,54010,18767,23969,43905,66979,33113,21286,58471,59080,13395,79144,70373,67031,38360,26705,50906,52406,26066,73146,15884,31897,30045,61068,45550,92454,13376,14354,19770,22928,97790,50723,46081,30202,14410,20223,88500,67298,13261,14172,81410,93578,83583,46047,94167,82564,21156,15799,86709,37931,74703,83103,23054,70470,72008,49247,91911,69998,20961,70070,63197,54853,88191,91830,49521,19454,81450,89091,62378,25683,61869,51744,36580,85778,36871,48121,28810,83712,45486,67393,26935,42393,20132,55349,86057,21309,80218,10094,11357,48819,39734,40758,30432,21204,29467,30214,61024,55307,74621,11622,68908,33032,52868,99194,99900,84936,69036,99149,45013,32895,59004,32322,14933,32936,33562,72550,27385,58049,58200,16808,21360,32961,18586,79307,15492)
                           :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4776L,ca_address_id#4777,ca_street_number#4778,ca_street_name#4779,ca_street_type#4780,ca_suite_number#4781,ca_city#4782,ca_county#4783,ca_state#4784,ca_zip#4785,ca_country#4786,ca_gmt_offset#4787,ca_location_type#4788] orc
                           +- Project [ca_zip#4692]
                              +- SubqueryAlias A1
                                 +- Filter (cnt#4693L > cast(10 as bigint))
                                    +- Aggregate [ca_zip#4798], [substr(ca_zip#4798, 1, 5) AS ca_zip#4692, count(1) AS cnt#4693L]
                                       +- Filter ((ca_address_sk#4789L = c_current_addr_sk#4806L) AND (c_preferred_cust_flag#4812 = Y))
                                          +- Join Inner
                                             :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                                             :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4789L,ca_address_id#4790,ca_street_number#4791,ca_street_name#4792,ca_street_type#4793,ca_suite_number#4794,ca_city#4795,ca_county#4796,ca_state#4797,ca_zip#4798,ca_country#4799,ca_gmt_offset#4800,ca_location_type#4801] orc
                                             +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                                                +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#4802L,c_customer_id#4803,c_current_cdemo_sk#4804L,c_current_hdemo_sk#4805L,c_current_addr_sk#4806L,c_first_shipto_date_sk#4807L,c_first_sales_date_sk#4808L,c_salutation#4809,c_first_name#4810,c_last_name#4811,c_preferred_cust_flag#4812,c_birth_day#4813,c_birth_month#4814,c_birth_year#4815,c_birth_country#4816,c_login#4817,c_email_address#4818,c_last_review_date#4819] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#4752 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#4752], [s_store_name#4752, sum(ss_net_profit#4717) AS sum(ss_net_profit)#4821]
         +- Project [ss_net_profit#4717, s_store_name#4752]
            +- Join Inner, (substr(s_zip#4772, 1, 2) = substr(ca_zip#4691, 1, 2))
               :- Project [ss_net_profit#4717, s_store_name#4752, s_zip#4772]
               :  +- Join Inner, (ss_store_sk#4702L = s_store_sk#4747L)
               :     :- Project [ss_store_sk#4702L, ss_net_profit#4717]
               :     :  +- Join Inner, (ss_sold_date_sk#4718L = d_date_sk#4719L)
               :     :     :- Project [ss_store_sk#4702L, ss_net_profit#4717, ss_sold_date_sk#4718L]
               :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#4718L) AND isnotnull(ss_store_sk#4702L)) AND dynamicpruning#4824 [ss_sold_date_sk#4718L])
               :     :     :     :  +- Project [d_date_sk#4719L]
               :     :     :     :     +- Filter (((isnotnull(d_qoy#4729) AND isnotnull(d_year#4725)) AND ((d_qoy#4729 = 1) AND (d_year#4725 = 2002))) AND isnotnull(d_date_sk#4719L))
               :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4719L,d_date_id#4720,d_date#4721,d_month_seq#4722,d_week_seq#4723,d_quarter_seq#4724,d_year#4725,d_dow#4726,d_moy#4727,d_dom#4728,d_qoy#4729,d_fy_year#4730,d_fy_quarter_seq#4731,d_fy_week_seq#4732,d_day_name#4733,d_quarter_name#4734,d_holiday#4735,d_weekend#4736,d_following_holiday#4737,d_first_dom#4738,d_last_dom#4739,d_same_day_ly#4740,d_same_day_lq#4741,d_current_day#4742,... 4 more fields] orc
               :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4696L,ss_item_sk#4697L,ss_customer_sk#4698L,ss_cdemo_sk#4699L,ss_hdemo_sk#4700L,ss_addr_sk#4701L,ss_store_sk#4702L,ss_promo_sk#4703L,ss_ticket_number#4704L,ss_quantity#4705,ss_wholesale_cost#4706,ss_list_price#4707,ss_sales_price#4708,ss_ext_discount_amt#4709,ss_ext_sales_price#4710,ss_ext_wholesale_cost#4711,ss_ext_list_price#4712,ss_ext_tax#4713,ss_coupon_amt#4714,ss_net_paid#4715,ss_net_paid_inc_tax#4716,ss_net_profit#4717,ss_sold_date_sk#4718L] orc
               :     :     +- Project [d_date_sk#4719L]
               :     :        +- Filter (((isnotnull(d_qoy#4729) AND isnotnull(d_year#4725)) AND ((d_qoy#4729 = 1) AND (d_year#4725 = 2002))) AND isnotnull(d_date_sk#4719L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4719L,d_date_id#4720,d_date#4721,d_month_seq#4722,d_week_seq#4723,d_quarter_seq#4724,d_year#4725,d_dow#4726,d_moy#4727,d_dom#4728,d_qoy#4729,d_fy_year#4730,d_fy_quarter_seq#4731,d_fy_week_seq#4732,d_day_name#4733,d_quarter_name#4734,d_holiday#4735,d_weekend#4736,d_following_holiday#4737,d_first_dom#4738,d_last_dom#4739,d_same_day_ly#4740,d_same_day_lq#4741,d_current_day#4742,... 4 more fields] orc
               :     +- Project [s_store_sk#4747L, s_store_name#4752, s_zip#4772]
               :        +- Filter (isnotnull(s_store_sk#4747L) AND isnotnull(s_zip#4772))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4747L,s_store_id#4748,s_rec_start_date#4749,s_rec_end_date#4750,s_closed_date_sk#4751L,s_store_name#4752,s_number_employees#4753,s_floor_space#4754,s_hours#4755,s_manager#4756,s_market_id#4757,s_geography_class#4758,s_market_desc#4759,s_market_manager#4760,s_division_id#4761,s_division_name#4762,s_company_id#4763,s_company_name#4764,s_street_number#4765,s_street_name#4766,s_street_type#4767,s_suite_number#4768,s_city#4769,s_county#4770,... 5 more fields] orc
               +- Aggregate [ca_zip#4691], [ca_zip#4691]
                  +- Project [substr(ca_zip#4785, 1, 5) AS ca_zip#4691]
                     +- Join LeftSemi, (substr(ca_zip#4785, 1, 5) <=> ca_zip#4692)
                        :- Project [ca_zip#4785]
                        :  +- Filter (substr(ca_zip#4785, 1, 5) INSET 10094, 10391, 10502, 10688, 10827, 10866, 11110, 11201, 11357, 11376, 11395, 11433, 11622, 11635, 11929, 13036, 13261, 13355, 13376, 13395, 13414, 13842, 14090, 14172, 14276, 14329, 14354, 14410, 14664, 14868, 14933, 14946, 15009, 15482, 15492, 15526, 15560, 15799, 15884, 16022, 16072, 16165, 16515, 16737, 16808, 17184, 17819, 17921, 17959, 18377, 18384, 18427, 18586, 18717, 18767, 18799, 18840, 18842, 18846, 19053, 19124, 19303, 19454, 19506, 19736, 19770, 19850, 20005, 20132, 20223, 20261, 20961, 21068, 21077, 21156, 21203, 21204, 21218, 21286, 21309, 21360, 21505, 21744, 21757, 21801, 22246, 22745, 22926, 22928, 22977, 23054, 23427, 23969, 24611, 24677, 25002, 25004, 25251, 25612, 25632, 25683, 25734, 25797, 25990, 26066, 26234, 26696, 26705, 26935, 27385, 27413, 27670, 28055, 28286, 28806, 28810, 28944, 29467, 29742, 29785, 29898, 30045, 30123, 30202, 30214, 30379, 30432, 30868, 30884, 31897, 32200, 32322, 32779, 32895, 32936, 32961, 33032, 33113, 33283, 33562, 33790, 34175, 34425, 35375, 35851, 35901, 35943, 36447, 36496, 36503, 36580, 36610, 36635, 36871, 37119, 37562, 37931, 38123, 38177, 38360, 38936, 39050, 39734, 39736, 39936, 40697, 40758, 40811, 40921, 40936, 41100, 41249, 41368, 41369, 41793, 41967, 42393, 42548, 42961, 43276, 43286, 43905, 43933, 44166, 44439, 45013, 45486, 45539, 45550, 45645, 45907, 46047, 46081, 46346, 47208, 47306, 47484, 47513, 47546, 48043, 48121, 48375, 48584, 48649, 48819, 49124, 49157, 49231, 49247, 49521, 49613, 49661, 49858, 50497, 50530, 50723, 50906, 51061, 51744, 51799, 52226, 52232, 52406, 52868, 52940, 53121, 53535, 53582, 54010, 54191, 54561, 54853, 55307, 55349, 55607, 55854, 56372, 56447, 56458, 56648, 56692, 56979, 57042, 57350, 57648, 57666, 57835, 57856, 58049, 58149, 58200, 58429, 58471, 58581, 59004, 59080, 59362, 59403, 59785, 60069, 60915, 61024, 61068, 61125, 61163, 61265, 61451, 61869, 62378, 62878, 63197, 63294, 63512, 63792, 63982, 64008, 65085, 65690, 66446, 66979, 67031, 67298, 67393, 67468, 67898, 68310, 68908, 69036, 69297, 69399, 69998, 70067, 70070, 70373, 70467, 70470, 70873, 71286, 71381, 71850, 71853, 72008, 72550, 72666, 73146, 73520, 73957, 74535, 74621, 74703, 75692, 76232, 76615, 76619, 77209, 77471, 77557, 78298, 78890, 79144, 79188, 79307, 80015, 80072, 80218, 80332, 80614, 80619, 80752, 81020, 81087, 81410, 81427, 81450, 81625, 81980, 82276, 82564, 82626, 82637, 83103, 83326, 83550, 83583, 83658, 83712, 83927, 84093, 84861, 84936, 85778, 86057, 86199, 86709, 87291, 88191, 88376, 88425, 88500, 88601, 89091, 89338, 89436, 89531, 89951, 89977, 90226, 90733, 90885, 91068, 91137, 91830, 91911, 91946, 92309, 92397, 92454, 92713, 93578, 93815, 94167, 94203, 94627, 94808, 95042, 95447, 95464, 95806, 96577, 96976, 97790, 98294, 98360, 99149, 99194, 99223, 99447, 99555, 99823, 99900 AND isnotnull(substr(ca_zip#4785, 1, 5)))
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4776L,ca_address_id#4777,ca_street_number#4778,ca_street_name#4779,ca_street_type#4780,ca_suite_number#4781,ca_city#4782,ca_county#4783,ca_state#4784,ca_zip#4785,ca_country#4786,ca_gmt_offset#4787,ca_location_type#4788] orc
                        +- Project [ca_zip#4692]
                           +- Filter (cnt#4693L > 10)
                              +- Aggregate [ca_zip#4798], [substr(ca_zip#4798, 1, 5) AS ca_zip#4692, count(1) AS cnt#4693L]
                                 +- Project [ca_zip#4798]
                                    +- Join Inner, (ca_address_sk#4789L = c_current_addr_sk#4806L)
                                       :- Project [ca_address_sk#4789L, ca_zip#4798]
                                       :  +- Filter isnotnull(ca_address_sk#4789L)
                                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4789L,ca_address_id#4790,ca_street_number#4791,ca_street_name#4792,ca_street_type#4793,ca_suite_number#4794,ca_city#4795,ca_county#4796,ca_state#4797,ca_zip#4798,ca_country#4799,ca_gmt_offset#4800,ca_location_type#4801] orc
                                       +- Project [c_current_addr_sk#4806L]
                                          +- Filter ((isnotnull(c_preferred_cust_flag#4812) AND (c_preferred_cust_flag#4812 = Y)) AND isnotnull(c_current_addr_sk#4806L))
                                             +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#4802L,c_customer_id#4803,c_current_cdemo_sk#4804L,c_current_hdemo_sk#4805L,c_current_addr_sk#4806L,c_first_shipto_date_sk#4807L,c_first_sales_date_sk#4808L,c_salutation#4809,c_first_name#4810,c_last_name#4811,c_preferred_cust_flag#4812,c_birth_day#4813,c_birth_month#4814,c_birth_year#4815,c_birth_country#4816,c_login#4817,c_email_address#4818,c_last_review_date#4819] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name#4752 ASC NULLS FIRST], output=[s_store_name#4752,sum(ss_net_profit)#4821])
   +- HashAggregate(keys=[s_store_name#4752], functions=[sum(ss_net_profit#4717)], output=[s_store_name#4752, sum(ss_net_profit)#4821])
      +- Exchange hashpartitioning(s_store_name#4752, 3000), ENSURE_REQUIREMENTS, [id=#2913]
         +- HashAggregate(keys=[s_store_name#4752], functions=[partial_sum(ss_net_profit#4717)], output=[s_store_name#4752, sum#4826])
            +- Project [ss_net_profit#4717, s_store_name#4752]
               +- SortMergeJoin [substr(s_zip#4772, 1, 2)], [substr(ca_zip#4691, 1, 2)], Inner
                  :- Sort [substr(s_zip#4772, 1, 2) ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(substr(s_zip#4772, 1, 2), 3000), ENSURE_REQUIREMENTS, [id=#2905]
                  :     +- Project [ss_net_profit#4717, s_store_name#4752, s_zip#4772]
                  :        +- BroadcastHashJoin [ss_store_sk#4702L], [s_store_sk#4747L], Inner, BuildRight, false
                  :           :- Project [ss_store_sk#4702L, ss_net_profit#4717]
                  :           :  +- BroadcastHashJoin [ss_sold_date_sk#4718L], [d_date_sk#4719L], Inner, BuildRight, false
                  :           :     :- Filter isnotnull(ss_store_sk#4702L)
                  :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#4702L,ss_net_profit#4717,ss_sold_date_sk#4718L] Batched: true, DataFilters: [isnotnull(ss_store_sk#4702L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#4718L), dynamicpruningexpression(ss_sold_date_sk#4718L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_net_profit:double>
                  :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#4824, 0, true, Project [d_date_sk#4719L], [d_date_sk#4719L]
                  :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :     :              +- Project [d_date_sk#4719L]
                  :           :     :                 +- Filter ((((isnotnull(d_qoy#4729) AND isnotnull(d_year#4725)) AND (d_qoy#4729 = 1)) AND (d_year#4725 = 2002)) AND isnotnull(d_date_sk#4719L))
                  :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4719L,d_year#4725,d_qoy#4729] Batched: true, DataFilters: [isnotnull(d_qoy#4729), isnotnull(d_year#4725), (d_qoy#4729 = 1), (d_year#4725 = 2002), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#2875]
                  :           :        +- Project [d_date_sk#4719L]
                  :           :           +- Filter ((((isnotnull(d_qoy#4729) AND isnotnull(d_year#4725)) AND (d_qoy#4729 = 1)) AND (d_year#4725 = 2002)) AND isnotnull(d_date_sk#4719L))
                  :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#4719L,d_year#4725,d_qoy#4729] Batched: true, DataFilters: [isnotnull(d_qoy#4729), isnotnull(d_year#4725), (d_qoy#4729 = 1), (d_year#4725 = 2002), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#2879]
                  :              +- Filter (isnotnull(s_store_sk#4747L) AND isnotnull(s_zip#4772))
                  :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#4747L,s_store_name#4752,s_zip#4772] Batched: true, DataFilters: [isnotnull(s_store_sk#4747L), isnotnull(s_zip#4772)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_zip:string>
                  +- Sort [substr(ca_zip#4691, 1, 2) ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(substr(ca_zip#4691, 1, 2), 3000), ENSURE_REQUIREMENTS, [id=#2906]
                        +- HashAggregate(keys=[ca_zip#4691], functions=[], output=[ca_zip#4691])
                           +- Exchange hashpartitioning(ca_zip#4691, 3000), ENSURE_REQUIREMENTS, [id=#2901]
                              +- HashAggregate(keys=[ca_zip#4691], functions=[], output=[ca_zip#4691])
                                 +- Project [substr(ca_zip#4785, 1, 5) AS ca_zip#4691]
                                    +- BroadcastHashJoin [coalesce(substr(ca_zip#4785, 1, 5), ), isnull(substr(ca_zip#4785, 1, 5))], [coalesce(ca_zip#4692, ), isnull(ca_zip#4692)], LeftSemi, BuildRight, false
                                       :- Filter (substr(ca_zip#4785, 1, 5) INSET 10094, 10391, 10502, 10688, 10827, 10866, 11110, 11201, 11357, 11376, 11395, 11433, 11622, 11635, 11929, 13036, 13261, 13355, 13376, 13395, 13414, 13842, 14090, 14172, 14276, 14329, 14354, 14410, 14664, 14868, 14933, 14946, 15009, 15482, 15492, 15526, 15560, 15799, 15884, 16022, 16072, 16165, 16515, 16737, 16808, 17184, 17819, 17921, 17959, 18377, 18384, 18427, 18586, 18717, 18767, 18799, 18840, 18842, 18846, 19053, 19124, 19303, 19454, 19506, 19736, 19770, 19850, 20005, 20132, 20223, 20261, 20961, 21068, 21077, 21156, 21203, 21204, 21218, 21286, 21309, 21360, 21505, 21744, 21757, 21801, 22246, 22745, 22926, 22928, 22977, 23054, 23427, 23969, 24611, 24677, 25002, 25004, 25251, 25612, 25632, 25683, 25734, 25797, 25990, 26066, 26234, 26696, 26705, 26935, 27385, 27413, 27670, 28055, 28286, 28806, 28810, 28944, 29467, 29742, 29785, 29898, 30045, 30123, 30202, 30214, 30379, 30432, 30868, 30884, 31897, 32200, 32322, 32779, 32895, 32936, 32961, 33032, 33113, 33283, 33562, 33790, 34175, 34425, 35375, 35851, 35901, 35943, 36447, 36496, 36503, 36580, 36610, 36635, 36871, 37119, 37562, 37931, 38123, 38177, 38360, 38936, 39050, 39734, 39736, 39936, 40697, 40758, 40811, 40921, 40936, 41100, 41249, 41368, 41369, 41793, 41967, 42393, 42548, 42961, 43276, 43286, 43905, 43933, 44166, 44439, 45013, 45486, 45539, 45550, 45645, 45907, 46047, 46081, 46346, 47208, 47306, 47484, 47513, 47546, 48043, 48121, 48375, 48584, 48649, 48819, 49124, 49157, 49231, 49247, 49521, 49613, 49661, 49858, 50497, 50530, 50723, 50906, 51061, 51744, 51799, 52226, 52232, 52406, 52868, 52940, 53121, 53535, 53582, 54010, 54191, 54561, 54853, 55307, 55349, 55607, 55854, 56372, 56447, 56458, 56648, 56692, 56979, 57042, 57350, 57648, 57666, 57835, 57856, 58049, 58149, 58200, 58429, 58471, 58581, 59004, 59080, 59362, 59403, 59785, 60069, 60915, 61024, 61068, 61125, 61163, 61265, 61451, 61869, 62378, 62878, 63197, 63294, 63512, 63792, 63982, 64008, 65085, 65690, 66446, 66979, 67031, 67298, 67393, 67468, 67898, 68310, 68908, 69036, 69297, 69399, 69998, 70067, 70070, 70373, 70467, 70470, 70873, 71286, 71381, 71850, 71853, 72008, 72550, 72666, 73146, 73520, 73957, 74535, 74621, 74703, 75692, 76232, 76615, 76619, 77209, 77471, 77557, 78298, 78890, 79144, 79188, 79307, 80015, 80072, 80218, 80332, 80614, 80619, 80752, 81020, 81087, 81410, 81427, 81450, 81625, 81980, 82276, 82564, 82626, 82637, 83103, 83326, 83550, 83583, 83658, 83712, 83927, 84093, 84861, 84936, 85778, 86057, 86199, 86709, 87291, 88191, 88376, 88425, 88500, 88601, 89091, 89338, 89436, 89531, 89951, 89977, 90226, 90733, 90885, 91068, 91137, 91830, 91911, 91946, 92309, 92397, 92454, 92713, 93578, 93815, 94167, 94203, 94627, 94808, 95042, 95447, 95464, 95806, 96577, 96976, 97790, 98294, 98360, 99149, 99194, 99223, 99447, 99555, 99823, 99900 AND isnotnull(substr(ca_zip#4785, 1, 5)))
                                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_zip#4785] Batched: true, DataFilters: [substr(ca_zip#4785, 1, 5) INSET 10094, 10391, 10502, 10688, 10827, 10866, 11110, 11201, 11357, 1..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ca_zip:string>
                                       +- BroadcastExchange HashedRelationBroadcastMode(List(coalesce(input[0, string, true], ), isnull(input[0, string, true])),false), [id=#2896]
                                          +- Project [ca_zip#4692]
                                             +- Filter (cnt#4693L > 10)
                                                +- HashAggregate(keys=[ca_zip#4798], functions=[count(1)], output=[ca_zip#4692, cnt#4693L])
                                                   +- Exchange hashpartitioning(ca_zip#4798, 3000), ENSURE_REQUIREMENTS, [id=#2891]
                                                      +- HashAggregate(keys=[ca_zip#4798], functions=[partial_count(1)], output=[ca_zip#4798, count#4828L])
                                                         +- Project [ca_zip#4798]
                                                            +- SortMergeJoin [ca_address_sk#4789L], [c_current_addr_sk#4806L], Inner
                                                               :- Sort [ca_address_sk#4789L ASC NULLS FIRST], false, 0
                                                               :  +- Exchange hashpartitioning(ca_address_sk#4789L, 3000), ENSURE_REQUIREMENTS, [id=#2883]
                                                               :     +- Filter isnotnull(ca_address_sk#4789L)
                                                               :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#4789L,ca_zip#4798] Batched: true, DataFilters: [isnotnull(ca_address_sk#4789L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_zip:string>
                                                               +- Sort [c_current_addr_sk#4806L ASC NULLS FIRST], false, 0
                                                                  +- Exchange hashpartitioning(c_current_addr_sk#4806L, 3000), ENSURE_REQUIREMENTS, [id=#2884]
                                                                     +- Project [c_current_addr_sk#4806L]
                                                                        +- Filter ((isnotnull(c_preferred_cust_flag#4812) AND (c_preferred_cust_flag#4812 = Y)) AND isnotnull(c_current_addr_sk#4806L))
                                                                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_current_addr_sk#4806L,c_preferred_cust_flag#4812] Batched: true, DataFilters: [isnotnull(c_preferred_cust_flag#4812), (c_preferred_cust_flag#4812 = Y), isnotnull(c_current_add..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_preferred_cust_flag), EqualTo(c_preferred_cust_flag,Y), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_current_addr_sk:bigint,c_preferred_cust_flag:string>

read query: spark_queries/q9.sql
explain query: q9
== Parsed Logical Plan ==
'Project [CASE WHEN (scalar-subquery#4829 [] > 409437) THEN scalar-subquery#4830 [] ELSE scalar-subquery#4831 [] END AS bucket1#4832, CASE WHEN (scalar-subquery#4833 [] > 4595804) THEN scalar-subquery#4834 [] ELSE scalar-subquery#4835 [] END AS bucket2#4836, CASE WHEN (scalar-subquery#4837 [] > 7887297) THEN scalar-subquery#4838 [] ELSE scalar-subquery#4839 [] END AS bucket3#4840, CASE WHEN (scalar-subquery#4841 [] > 10872978) THEN scalar-subquery#4842 [] ELSE scalar-subquery#4843 [] END AS bucket4#4844, CASE WHEN (scalar-subquery#4845 [] > 43571537) THEN scalar-subquery#4846 [] ELSE scalar-subquery#4847 [] END AS bucket5#4848]
:  :- 'Project [unresolvedalias('count(1), None)]
:  :  +- 'Filter (('ss_quantity >= 1) AND ('ss_quantity <= 20))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_ext_list_price), None)]
:  :  +- 'Filter (('ss_quantity >= 1) AND ('ss_quantity <= 20))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_net_paid_inc_tax), None)]
:  :  +- 'Filter (('ss_quantity >= 1) AND ('ss_quantity <= 20))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('count(1), None)]
:  :  +- 'Filter (('ss_quantity >= 21) AND ('ss_quantity <= 40))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_ext_list_price), None)]
:  :  +- 'Filter (('ss_quantity >= 21) AND ('ss_quantity <= 40))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_net_paid_inc_tax), None)]
:  :  +- 'Filter (('ss_quantity >= 21) AND ('ss_quantity <= 40))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('count(1), None)]
:  :  +- 'Filter (('ss_quantity >= 41) AND ('ss_quantity <= 60))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_ext_list_price), None)]
:  :  +- 'Filter (('ss_quantity >= 41) AND ('ss_quantity <= 60))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_net_paid_inc_tax), None)]
:  :  +- 'Filter (('ss_quantity >= 41) AND ('ss_quantity <= 60))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('count(1), None)]
:  :  +- 'Filter (('ss_quantity >= 61) AND ('ss_quantity <= 80))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_ext_list_price), None)]
:  :  +- 'Filter (('ss_quantity >= 61) AND ('ss_quantity <= 80))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_net_paid_inc_tax), None)]
:  :  +- 'Filter (('ss_quantity >= 61) AND ('ss_quantity <= 80))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('count(1), None)]
:  :  +- 'Filter (('ss_quantity >= 81) AND ('ss_quantity <= 100))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  :- 'Project [unresolvedalias('avg('ss_ext_list_price), None)]
:  :  +- 'Filter (('ss_quantity >= 81) AND ('ss_quantity <= 100))
:  :     +- 'UnresolvedRelation [store_sales], [], false
:  +- 'Project [unresolvedalias('avg('ss_net_paid_inc_tax), None)]
:     +- 'Filter (('ss_quantity >= 81) AND ('ss_quantity <= 100))
:        +- 'UnresolvedRelation [store_sales], [], false
+- 'Filter ('r_reason_sk = 1)
   +- 'UnresolvedRelation [reason], [], false

== Analyzed Logical Plan ==
bucket1: double, bucket2: double, bucket3: double, bucket4: double, bucket5: double
Project [CASE WHEN (scalar-subquery#4829 [] > cast(409437 as bigint)) THEN scalar-subquery#4830 [] ELSE scalar-subquery#4831 [] END AS bucket1#4832, CASE WHEN (scalar-subquery#4833 [] > cast(4595804 as bigint)) THEN scalar-subquery#4834 [] ELSE scalar-subquery#4835 [] END AS bucket2#4836, CASE WHEN (scalar-subquery#4837 [] > cast(7887297 as bigint)) THEN scalar-subquery#4838 [] ELSE scalar-subquery#4839 [] END AS bucket3#4840, CASE WHEN (scalar-subquery#4841 [] > cast(10872978 as bigint)) THEN scalar-subquery#4842 [] ELSE scalar-subquery#4843 [] END AS bucket4#4844, CASE WHEN (scalar-subquery#4845 [] > cast(43571537 as bigint)) THEN scalar-subquery#4846 [] ELSE scalar-subquery#4847 [] END AS bucket5#4848]
:  :- Aggregate [count(1) AS count(1)#4876L]
:  :  +- Filter ((ss_quantity#4862 >= 1) AND (ss_quantity#4862 <= 20))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4853L,ss_item_sk#4854L,ss_customer_sk#4855L,ss_cdemo_sk#4856L,ss_hdemo_sk#4857L,ss_addr_sk#4858L,ss_store_sk#4859L,ss_promo_sk#4860L,ss_ticket_number#4861L,ss_quantity#4862,ss_wholesale_cost#4863,ss_list_price#4864,ss_sales_price#4865,ss_ext_discount_amt#4866,ss_ext_sales_price#4867,ss_ext_wholesale_cost#4868,ss_ext_list_price#4869,ss_ext_tax#4870,ss_coupon_amt#4871,ss_net_paid#4872,ss_net_paid_inc_tax#4873,ss_net_profit#4874,ss_sold_date_sk#4875L] orc
:  :- Aggregate [avg(ss_ext_list_price#4893) AS avg(ss_ext_list_price)#4901]
:  :  +- Filter ((ss_quantity#4886 >= 1) AND (ss_quantity#4886 <= 20))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4877L,ss_item_sk#4878L,ss_customer_sk#4879L,ss_cdemo_sk#4880L,ss_hdemo_sk#4881L,ss_addr_sk#4882L,ss_store_sk#4883L,ss_promo_sk#4884L,ss_ticket_number#4885L,ss_quantity#4886,ss_wholesale_cost#4887,ss_list_price#4888,ss_sales_price#4889,ss_ext_discount_amt#4890,ss_ext_sales_price#4891,ss_ext_wholesale_cost#4892,ss_ext_list_price#4893,ss_ext_tax#4894,ss_coupon_amt#4895,ss_net_paid#4896,ss_net_paid_inc_tax#4897,ss_net_profit#4898,ss_sold_date_sk#4899L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#4922) AS avg(ss_net_paid_inc_tax)#4926]
:  :  +- Filter ((ss_quantity#4911 >= 1) AND (ss_quantity#4911 <= 20))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4902L,ss_item_sk#4903L,ss_customer_sk#4904L,ss_cdemo_sk#4905L,ss_hdemo_sk#4906L,ss_addr_sk#4907L,ss_store_sk#4908L,ss_promo_sk#4909L,ss_ticket_number#4910L,ss_quantity#4911,ss_wholesale_cost#4912,ss_list_price#4913,ss_sales_price#4914,ss_ext_discount_amt#4915,ss_ext_sales_price#4916,ss_ext_wholesale_cost#4917,ss_ext_list_price#4918,ss_ext_tax#4919,ss_coupon_amt#4920,ss_net_paid#4921,ss_net_paid_inc_tax#4922,ss_net_profit#4923,ss_sold_date_sk#4924L] orc
:  :- Aggregate [count(1) AS count(1)#4951L]
:  :  +- Filter ((ss_quantity#4937 >= 21) AND (ss_quantity#4937 <= 40))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4928L,ss_item_sk#4929L,ss_customer_sk#4930L,ss_cdemo_sk#4931L,ss_hdemo_sk#4932L,ss_addr_sk#4933L,ss_store_sk#4934L,ss_promo_sk#4935L,ss_ticket_number#4936L,ss_quantity#4937,ss_wholesale_cost#4938,ss_list_price#4939,ss_sales_price#4940,ss_ext_discount_amt#4941,ss_ext_sales_price#4942,ss_ext_wholesale_cost#4943,ss_ext_list_price#4944,ss_ext_tax#4945,ss_coupon_amt#4946,ss_net_paid#4947,ss_net_paid_inc_tax#4948,ss_net_profit#4949,ss_sold_date_sk#4950L] orc
:  :- Aggregate [avg(ss_ext_list_price#4968) AS avg(ss_ext_list_price)#4976]
:  :  +- Filter ((ss_quantity#4961 >= 21) AND (ss_quantity#4961 <= 40))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4952L,ss_item_sk#4953L,ss_customer_sk#4954L,ss_cdemo_sk#4955L,ss_hdemo_sk#4956L,ss_addr_sk#4957L,ss_store_sk#4958L,ss_promo_sk#4959L,ss_ticket_number#4960L,ss_quantity#4961,ss_wholesale_cost#4962,ss_list_price#4963,ss_sales_price#4964,ss_ext_discount_amt#4965,ss_ext_sales_price#4966,ss_ext_wholesale_cost#4967,ss_ext_list_price#4968,ss_ext_tax#4969,ss_coupon_amt#4970,ss_net_paid#4971,ss_net_paid_inc_tax#4972,ss_net_profit#4973,ss_sold_date_sk#4974L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#4997) AS avg(ss_net_paid_inc_tax)#5001]
:  :  +- Filter ((ss_quantity#4986 >= 21) AND (ss_quantity#4986 <= 40))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4977L,ss_item_sk#4978L,ss_customer_sk#4979L,ss_cdemo_sk#4980L,ss_hdemo_sk#4981L,ss_addr_sk#4982L,ss_store_sk#4983L,ss_promo_sk#4984L,ss_ticket_number#4985L,ss_quantity#4986,ss_wholesale_cost#4987,ss_list_price#4988,ss_sales_price#4989,ss_ext_discount_amt#4990,ss_ext_sales_price#4991,ss_ext_wholesale_cost#4992,ss_ext_list_price#4993,ss_ext_tax#4994,ss_coupon_amt#4995,ss_net_paid#4996,ss_net_paid_inc_tax#4997,ss_net_profit#4998,ss_sold_date_sk#4999L] orc
:  :- Aggregate [count(1) AS count(1)#5026L]
:  :  +- Filter ((ss_quantity#5012 >= 41) AND (ss_quantity#5012 <= 60))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5003L,ss_item_sk#5004L,ss_customer_sk#5005L,ss_cdemo_sk#5006L,ss_hdemo_sk#5007L,ss_addr_sk#5008L,ss_store_sk#5009L,ss_promo_sk#5010L,ss_ticket_number#5011L,ss_quantity#5012,ss_wholesale_cost#5013,ss_list_price#5014,ss_sales_price#5015,ss_ext_discount_amt#5016,ss_ext_sales_price#5017,ss_ext_wholesale_cost#5018,ss_ext_list_price#5019,ss_ext_tax#5020,ss_coupon_amt#5021,ss_net_paid#5022,ss_net_paid_inc_tax#5023,ss_net_profit#5024,ss_sold_date_sk#5025L] orc
:  :- Aggregate [avg(ss_ext_list_price#5043) AS avg(ss_ext_list_price)#5051]
:  :  +- Filter ((ss_quantity#5036 >= 41) AND (ss_quantity#5036 <= 60))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5027L,ss_item_sk#5028L,ss_customer_sk#5029L,ss_cdemo_sk#5030L,ss_hdemo_sk#5031L,ss_addr_sk#5032L,ss_store_sk#5033L,ss_promo_sk#5034L,ss_ticket_number#5035L,ss_quantity#5036,ss_wholesale_cost#5037,ss_list_price#5038,ss_sales_price#5039,ss_ext_discount_amt#5040,ss_ext_sales_price#5041,ss_ext_wholesale_cost#5042,ss_ext_list_price#5043,ss_ext_tax#5044,ss_coupon_amt#5045,ss_net_paid#5046,ss_net_paid_inc_tax#5047,ss_net_profit#5048,ss_sold_date_sk#5049L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#5072) AS avg(ss_net_paid_inc_tax)#5076]
:  :  +- Filter ((ss_quantity#5061 >= 41) AND (ss_quantity#5061 <= 60))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5052L,ss_item_sk#5053L,ss_customer_sk#5054L,ss_cdemo_sk#5055L,ss_hdemo_sk#5056L,ss_addr_sk#5057L,ss_store_sk#5058L,ss_promo_sk#5059L,ss_ticket_number#5060L,ss_quantity#5061,ss_wholesale_cost#5062,ss_list_price#5063,ss_sales_price#5064,ss_ext_discount_amt#5065,ss_ext_sales_price#5066,ss_ext_wholesale_cost#5067,ss_ext_list_price#5068,ss_ext_tax#5069,ss_coupon_amt#5070,ss_net_paid#5071,ss_net_paid_inc_tax#5072,ss_net_profit#5073,ss_sold_date_sk#5074L] orc
:  :- Aggregate [count(1) AS count(1)#5101L]
:  :  +- Filter ((ss_quantity#5087 >= 61) AND (ss_quantity#5087 <= 80))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5078L,ss_item_sk#5079L,ss_customer_sk#5080L,ss_cdemo_sk#5081L,ss_hdemo_sk#5082L,ss_addr_sk#5083L,ss_store_sk#5084L,ss_promo_sk#5085L,ss_ticket_number#5086L,ss_quantity#5087,ss_wholesale_cost#5088,ss_list_price#5089,ss_sales_price#5090,ss_ext_discount_amt#5091,ss_ext_sales_price#5092,ss_ext_wholesale_cost#5093,ss_ext_list_price#5094,ss_ext_tax#5095,ss_coupon_amt#5096,ss_net_paid#5097,ss_net_paid_inc_tax#5098,ss_net_profit#5099,ss_sold_date_sk#5100L] orc
:  :- Aggregate [avg(ss_ext_list_price#5118) AS avg(ss_ext_list_price)#5126]
:  :  +- Filter ((ss_quantity#5111 >= 61) AND (ss_quantity#5111 <= 80))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5102L,ss_item_sk#5103L,ss_customer_sk#5104L,ss_cdemo_sk#5105L,ss_hdemo_sk#5106L,ss_addr_sk#5107L,ss_store_sk#5108L,ss_promo_sk#5109L,ss_ticket_number#5110L,ss_quantity#5111,ss_wholesale_cost#5112,ss_list_price#5113,ss_sales_price#5114,ss_ext_discount_amt#5115,ss_ext_sales_price#5116,ss_ext_wholesale_cost#5117,ss_ext_list_price#5118,ss_ext_tax#5119,ss_coupon_amt#5120,ss_net_paid#5121,ss_net_paid_inc_tax#5122,ss_net_profit#5123,ss_sold_date_sk#5124L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#5147) AS avg(ss_net_paid_inc_tax)#5151]
:  :  +- Filter ((ss_quantity#5136 >= 61) AND (ss_quantity#5136 <= 80))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5127L,ss_item_sk#5128L,ss_customer_sk#5129L,ss_cdemo_sk#5130L,ss_hdemo_sk#5131L,ss_addr_sk#5132L,ss_store_sk#5133L,ss_promo_sk#5134L,ss_ticket_number#5135L,ss_quantity#5136,ss_wholesale_cost#5137,ss_list_price#5138,ss_sales_price#5139,ss_ext_discount_amt#5140,ss_ext_sales_price#5141,ss_ext_wholesale_cost#5142,ss_ext_list_price#5143,ss_ext_tax#5144,ss_coupon_amt#5145,ss_net_paid#5146,ss_net_paid_inc_tax#5147,ss_net_profit#5148,ss_sold_date_sk#5149L] orc
:  :- Aggregate [count(1) AS count(1)#5176L]
:  :  +- Filter ((ss_quantity#5162 >= 81) AND (ss_quantity#5162 <= 100))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5153L,ss_item_sk#5154L,ss_customer_sk#5155L,ss_cdemo_sk#5156L,ss_hdemo_sk#5157L,ss_addr_sk#5158L,ss_store_sk#5159L,ss_promo_sk#5160L,ss_ticket_number#5161L,ss_quantity#5162,ss_wholesale_cost#5163,ss_list_price#5164,ss_sales_price#5165,ss_ext_discount_amt#5166,ss_ext_sales_price#5167,ss_ext_wholesale_cost#5168,ss_ext_list_price#5169,ss_ext_tax#5170,ss_coupon_amt#5171,ss_net_paid#5172,ss_net_paid_inc_tax#5173,ss_net_profit#5174,ss_sold_date_sk#5175L] orc
:  :- Aggregate [avg(ss_ext_list_price#5193) AS avg(ss_ext_list_price)#5201]
:  :  +- Filter ((ss_quantity#5186 >= 81) AND (ss_quantity#5186 <= 100))
:  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5177L,ss_item_sk#5178L,ss_customer_sk#5179L,ss_cdemo_sk#5180L,ss_hdemo_sk#5181L,ss_addr_sk#5182L,ss_store_sk#5183L,ss_promo_sk#5184L,ss_ticket_number#5185L,ss_quantity#5186,ss_wholesale_cost#5187,ss_list_price#5188,ss_sales_price#5189,ss_ext_discount_amt#5190,ss_ext_sales_price#5191,ss_ext_wholesale_cost#5192,ss_ext_list_price#5193,ss_ext_tax#5194,ss_coupon_amt#5195,ss_net_paid#5196,ss_net_paid_inc_tax#5197,ss_net_profit#5198,ss_sold_date_sk#5199L] orc
:  +- Aggregate [avg(ss_net_paid_inc_tax#5222) AS avg(ss_net_paid_inc_tax)#5226]
:     +- Filter ((ss_quantity#5211 >= 81) AND (ss_quantity#5211 <= 100))
:        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5202L,ss_item_sk#5203L,ss_customer_sk#5204L,ss_cdemo_sk#5205L,ss_hdemo_sk#5206L,ss_addr_sk#5207L,ss_store_sk#5208L,ss_promo_sk#5209L,ss_ticket_number#5210L,ss_quantity#5211,ss_wholesale_cost#5212,ss_list_price#5213,ss_sales_price#5214,ss_ext_discount_amt#5215,ss_ext_sales_price#5216,ss_ext_wholesale_cost#5217,ss_ext_list_price#5218,ss_ext_tax#5219,ss_coupon_amt#5220,ss_net_paid#5221,ss_net_paid_inc_tax#5222,ss_net_profit#5223,ss_sold_date_sk#5224L] orc
+- Filter (r_reason_sk#4849L = cast(1 as bigint))
   +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.reason
      +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#4849L,r_reason_id#4850,r_reason_desc#4851] orc

== Optimized Logical Plan ==
Project [CASE WHEN (scalar-subquery#4829 [] > 409437) THEN scalar-subquery#4830 [] ELSE scalar-subquery#4831 [] END AS bucket1#4832, CASE WHEN (scalar-subquery#4833 [] > 4595804) THEN scalar-subquery#4834 [] ELSE scalar-subquery#4835 [] END AS bucket2#4836, CASE WHEN (scalar-subquery#4837 [] > 7887297) THEN scalar-subquery#4838 [] ELSE scalar-subquery#4839 [] END AS bucket3#4840, CASE WHEN (scalar-subquery#4841 [] > 10872978) THEN scalar-subquery#4842 [] ELSE scalar-subquery#4843 [] END AS bucket4#4844, CASE WHEN (scalar-subquery#4845 [] > 43571537) THEN scalar-subquery#4846 [] ELSE scalar-subquery#4847 [] END AS bucket5#4848]
:  :- Aggregate [count(1) AS count(1)#4876L]
:  :  +- Project
:  :     +- Filter (isnotnull(ss_quantity#4862) AND ((ss_quantity#4862 >= 1) AND (ss_quantity#4862 <= 20)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4853L,ss_item_sk#4854L,ss_customer_sk#4855L,ss_cdemo_sk#4856L,ss_hdemo_sk#4857L,ss_addr_sk#4858L,ss_store_sk#4859L,ss_promo_sk#4860L,ss_ticket_number#4861L,ss_quantity#4862,ss_wholesale_cost#4863,ss_list_price#4864,ss_sales_price#4865,ss_ext_discount_amt#4866,ss_ext_sales_price#4867,ss_ext_wholesale_cost#4868,ss_ext_list_price#4869,ss_ext_tax#4870,ss_coupon_amt#4871,ss_net_paid#4872,ss_net_paid_inc_tax#4873,ss_net_profit#4874,ss_sold_date_sk#4875L] orc
:  :- Aggregate [avg(ss_ext_list_price#4893) AS avg(ss_ext_list_price)#4901]
:  :  +- Project [ss_ext_list_price#4893]
:  :     +- Filter (isnotnull(ss_quantity#4886) AND ((ss_quantity#4886 >= 1) AND (ss_quantity#4886 <= 20)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4877L,ss_item_sk#4878L,ss_customer_sk#4879L,ss_cdemo_sk#4880L,ss_hdemo_sk#4881L,ss_addr_sk#4882L,ss_store_sk#4883L,ss_promo_sk#4884L,ss_ticket_number#4885L,ss_quantity#4886,ss_wholesale_cost#4887,ss_list_price#4888,ss_sales_price#4889,ss_ext_discount_amt#4890,ss_ext_sales_price#4891,ss_ext_wholesale_cost#4892,ss_ext_list_price#4893,ss_ext_tax#4894,ss_coupon_amt#4895,ss_net_paid#4896,ss_net_paid_inc_tax#4897,ss_net_profit#4898,ss_sold_date_sk#4899L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#4922) AS avg(ss_net_paid_inc_tax)#4926]
:  :  +- Project [ss_net_paid_inc_tax#4922]
:  :     +- Filter (isnotnull(ss_quantity#4911) AND ((ss_quantity#4911 >= 1) AND (ss_quantity#4911 <= 20)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4902L,ss_item_sk#4903L,ss_customer_sk#4904L,ss_cdemo_sk#4905L,ss_hdemo_sk#4906L,ss_addr_sk#4907L,ss_store_sk#4908L,ss_promo_sk#4909L,ss_ticket_number#4910L,ss_quantity#4911,ss_wholesale_cost#4912,ss_list_price#4913,ss_sales_price#4914,ss_ext_discount_amt#4915,ss_ext_sales_price#4916,ss_ext_wholesale_cost#4917,ss_ext_list_price#4918,ss_ext_tax#4919,ss_coupon_amt#4920,ss_net_paid#4921,ss_net_paid_inc_tax#4922,ss_net_profit#4923,ss_sold_date_sk#4924L] orc
:  :- Aggregate [count(1) AS count(1)#4951L]
:  :  +- Project
:  :     +- Filter (isnotnull(ss_quantity#4937) AND ((ss_quantity#4937 >= 21) AND (ss_quantity#4937 <= 40)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4928L,ss_item_sk#4929L,ss_customer_sk#4930L,ss_cdemo_sk#4931L,ss_hdemo_sk#4932L,ss_addr_sk#4933L,ss_store_sk#4934L,ss_promo_sk#4935L,ss_ticket_number#4936L,ss_quantity#4937,ss_wholesale_cost#4938,ss_list_price#4939,ss_sales_price#4940,ss_ext_discount_amt#4941,ss_ext_sales_price#4942,ss_ext_wholesale_cost#4943,ss_ext_list_price#4944,ss_ext_tax#4945,ss_coupon_amt#4946,ss_net_paid#4947,ss_net_paid_inc_tax#4948,ss_net_profit#4949,ss_sold_date_sk#4950L] orc
:  :- Aggregate [avg(ss_ext_list_price#4968) AS avg(ss_ext_list_price)#4976]
:  :  +- Project [ss_ext_list_price#4968]
:  :     +- Filter (isnotnull(ss_quantity#4961) AND ((ss_quantity#4961 >= 21) AND (ss_quantity#4961 <= 40)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4952L,ss_item_sk#4953L,ss_customer_sk#4954L,ss_cdemo_sk#4955L,ss_hdemo_sk#4956L,ss_addr_sk#4957L,ss_store_sk#4958L,ss_promo_sk#4959L,ss_ticket_number#4960L,ss_quantity#4961,ss_wholesale_cost#4962,ss_list_price#4963,ss_sales_price#4964,ss_ext_discount_amt#4965,ss_ext_sales_price#4966,ss_ext_wholesale_cost#4967,ss_ext_list_price#4968,ss_ext_tax#4969,ss_coupon_amt#4970,ss_net_paid#4971,ss_net_paid_inc_tax#4972,ss_net_profit#4973,ss_sold_date_sk#4974L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#4997) AS avg(ss_net_paid_inc_tax)#5001]
:  :  +- Project [ss_net_paid_inc_tax#4997]
:  :     +- Filter (isnotnull(ss_quantity#4986) AND ((ss_quantity#4986 >= 21) AND (ss_quantity#4986 <= 40)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#4977L,ss_item_sk#4978L,ss_customer_sk#4979L,ss_cdemo_sk#4980L,ss_hdemo_sk#4981L,ss_addr_sk#4982L,ss_store_sk#4983L,ss_promo_sk#4984L,ss_ticket_number#4985L,ss_quantity#4986,ss_wholesale_cost#4987,ss_list_price#4988,ss_sales_price#4989,ss_ext_discount_amt#4990,ss_ext_sales_price#4991,ss_ext_wholesale_cost#4992,ss_ext_list_price#4993,ss_ext_tax#4994,ss_coupon_amt#4995,ss_net_paid#4996,ss_net_paid_inc_tax#4997,ss_net_profit#4998,ss_sold_date_sk#4999L] orc
:  :- Aggregate [count(1) AS count(1)#5026L]
:  :  +- Project
:  :     +- Filter (isnotnull(ss_quantity#5012) AND ((ss_quantity#5012 >= 41) AND (ss_quantity#5012 <= 60)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5003L,ss_item_sk#5004L,ss_customer_sk#5005L,ss_cdemo_sk#5006L,ss_hdemo_sk#5007L,ss_addr_sk#5008L,ss_store_sk#5009L,ss_promo_sk#5010L,ss_ticket_number#5011L,ss_quantity#5012,ss_wholesale_cost#5013,ss_list_price#5014,ss_sales_price#5015,ss_ext_discount_amt#5016,ss_ext_sales_price#5017,ss_ext_wholesale_cost#5018,ss_ext_list_price#5019,ss_ext_tax#5020,ss_coupon_amt#5021,ss_net_paid#5022,ss_net_paid_inc_tax#5023,ss_net_profit#5024,ss_sold_date_sk#5025L] orc
:  :- Aggregate [avg(ss_ext_list_price#5043) AS avg(ss_ext_list_price)#5051]
:  :  +- Project [ss_ext_list_price#5043]
:  :     +- Filter (isnotnull(ss_quantity#5036) AND ((ss_quantity#5036 >= 41) AND (ss_quantity#5036 <= 60)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5027L,ss_item_sk#5028L,ss_customer_sk#5029L,ss_cdemo_sk#5030L,ss_hdemo_sk#5031L,ss_addr_sk#5032L,ss_store_sk#5033L,ss_promo_sk#5034L,ss_ticket_number#5035L,ss_quantity#5036,ss_wholesale_cost#5037,ss_list_price#5038,ss_sales_price#5039,ss_ext_discount_amt#5040,ss_ext_sales_price#5041,ss_ext_wholesale_cost#5042,ss_ext_list_price#5043,ss_ext_tax#5044,ss_coupon_amt#5045,ss_net_paid#5046,ss_net_paid_inc_tax#5047,ss_net_profit#5048,ss_sold_date_sk#5049L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#5072) AS avg(ss_net_paid_inc_tax)#5076]
:  :  +- Project [ss_net_paid_inc_tax#5072]
:  :     +- Filter (isnotnull(ss_quantity#5061) AND ((ss_quantity#5061 >= 41) AND (ss_quantity#5061 <= 60)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5052L,ss_item_sk#5053L,ss_customer_sk#5054L,ss_cdemo_sk#5055L,ss_hdemo_sk#5056L,ss_addr_sk#5057L,ss_store_sk#5058L,ss_promo_sk#5059L,ss_ticket_number#5060L,ss_quantity#5061,ss_wholesale_cost#5062,ss_list_price#5063,ss_sales_price#5064,ss_ext_discount_amt#5065,ss_ext_sales_price#5066,ss_ext_wholesale_cost#5067,ss_ext_list_price#5068,ss_ext_tax#5069,ss_coupon_amt#5070,ss_net_paid#5071,ss_net_paid_inc_tax#5072,ss_net_profit#5073,ss_sold_date_sk#5074L] orc
:  :- Aggregate [count(1) AS count(1)#5101L]
:  :  +- Project
:  :     +- Filter (isnotnull(ss_quantity#5087) AND ((ss_quantity#5087 >= 61) AND (ss_quantity#5087 <= 80)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5078L,ss_item_sk#5079L,ss_customer_sk#5080L,ss_cdemo_sk#5081L,ss_hdemo_sk#5082L,ss_addr_sk#5083L,ss_store_sk#5084L,ss_promo_sk#5085L,ss_ticket_number#5086L,ss_quantity#5087,ss_wholesale_cost#5088,ss_list_price#5089,ss_sales_price#5090,ss_ext_discount_amt#5091,ss_ext_sales_price#5092,ss_ext_wholesale_cost#5093,ss_ext_list_price#5094,ss_ext_tax#5095,ss_coupon_amt#5096,ss_net_paid#5097,ss_net_paid_inc_tax#5098,ss_net_profit#5099,ss_sold_date_sk#5100L] orc
:  :- Aggregate [avg(ss_ext_list_price#5118) AS avg(ss_ext_list_price)#5126]
:  :  +- Project [ss_ext_list_price#5118]
:  :     +- Filter (isnotnull(ss_quantity#5111) AND ((ss_quantity#5111 >= 61) AND (ss_quantity#5111 <= 80)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5102L,ss_item_sk#5103L,ss_customer_sk#5104L,ss_cdemo_sk#5105L,ss_hdemo_sk#5106L,ss_addr_sk#5107L,ss_store_sk#5108L,ss_promo_sk#5109L,ss_ticket_number#5110L,ss_quantity#5111,ss_wholesale_cost#5112,ss_list_price#5113,ss_sales_price#5114,ss_ext_discount_amt#5115,ss_ext_sales_price#5116,ss_ext_wholesale_cost#5117,ss_ext_list_price#5118,ss_ext_tax#5119,ss_coupon_amt#5120,ss_net_paid#5121,ss_net_paid_inc_tax#5122,ss_net_profit#5123,ss_sold_date_sk#5124L] orc
:  :- Aggregate [avg(ss_net_paid_inc_tax#5147) AS avg(ss_net_paid_inc_tax)#5151]
:  :  +- Project [ss_net_paid_inc_tax#5147]
:  :     +- Filter (isnotnull(ss_quantity#5136) AND ((ss_quantity#5136 >= 61) AND (ss_quantity#5136 <= 80)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5127L,ss_item_sk#5128L,ss_customer_sk#5129L,ss_cdemo_sk#5130L,ss_hdemo_sk#5131L,ss_addr_sk#5132L,ss_store_sk#5133L,ss_promo_sk#5134L,ss_ticket_number#5135L,ss_quantity#5136,ss_wholesale_cost#5137,ss_list_price#5138,ss_sales_price#5139,ss_ext_discount_amt#5140,ss_ext_sales_price#5141,ss_ext_wholesale_cost#5142,ss_ext_list_price#5143,ss_ext_tax#5144,ss_coupon_amt#5145,ss_net_paid#5146,ss_net_paid_inc_tax#5147,ss_net_profit#5148,ss_sold_date_sk#5149L] orc
:  :- Aggregate [count(1) AS count(1)#5176L]
:  :  +- Project
:  :     +- Filter (isnotnull(ss_quantity#5162) AND ((ss_quantity#5162 >= 81) AND (ss_quantity#5162 <= 100)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5153L,ss_item_sk#5154L,ss_customer_sk#5155L,ss_cdemo_sk#5156L,ss_hdemo_sk#5157L,ss_addr_sk#5158L,ss_store_sk#5159L,ss_promo_sk#5160L,ss_ticket_number#5161L,ss_quantity#5162,ss_wholesale_cost#5163,ss_list_price#5164,ss_sales_price#5165,ss_ext_discount_amt#5166,ss_ext_sales_price#5167,ss_ext_wholesale_cost#5168,ss_ext_list_price#5169,ss_ext_tax#5170,ss_coupon_amt#5171,ss_net_paid#5172,ss_net_paid_inc_tax#5173,ss_net_profit#5174,ss_sold_date_sk#5175L] orc
:  :- Aggregate [avg(ss_ext_list_price#5193) AS avg(ss_ext_list_price)#5201]
:  :  +- Project [ss_ext_list_price#5193]
:  :     +- Filter (isnotnull(ss_quantity#5186) AND ((ss_quantity#5186 >= 81) AND (ss_quantity#5186 <= 100)))
:  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5177L,ss_item_sk#5178L,ss_customer_sk#5179L,ss_cdemo_sk#5180L,ss_hdemo_sk#5181L,ss_addr_sk#5182L,ss_store_sk#5183L,ss_promo_sk#5184L,ss_ticket_number#5185L,ss_quantity#5186,ss_wholesale_cost#5187,ss_list_price#5188,ss_sales_price#5189,ss_ext_discount_amt#5190,ss_ext_sales_price#5191,ss_ext_wholesale_cost#5192,ss_ext_list_price#5193,ss_ext_tax#5194,ss_coupon_amt#5195,ss_net_paid#5196,ss_net_paid_inc_tax#5197,ss_net_profit#5198,ss_sold_date_sk#5199L] orc
:  +- Aggregate [avg(ss_net_paid_inc_tax#5222) AS avg(ss_net_paid_inc_tax)#5226]
:     +- Project [ss_net_paid_inc_tax#5222]
:        +- Filter (isnotnull(ss_quantity#5211) AND ((ss_quantity#5211 >= 81) AND (ss_quantity#5211 <= 100)))
:           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5202L,ss_item_sk#5203L,ss_customer_sk#5204L,ss_cdemo_sk#5205L,ss_hdemo_sk#5206L,ss_addr_sk#5207L,ss_store_sk#5208L,ss_promo_sk#5209L,ss_ticket_number#5210L,ss_quantity#5211,ss_wholesale_cost#5212,ss_list_price#5213,ss_sales_price#5214,ss_ext_discount_amt#5215,ss_ext_sales_price#5216,ss_ext_wholesale_cost#5217,ss_ext_list_price#5218,ss_ext_tax#5219,ss_coupon_amt#5220,ss_net_paid#5221,ss_net_paid_inc_tax#5222,ss_net_profit#5223,ss_sold_date_sk#5224L] orc
+- Filter (isnotnull(r_reason_sk#4849L) AND (r_reason_sk#4849L = 1))
   +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#4849L,r_reason_id#4850,r_reason_desc#4851] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Project [CASE WHEN (Subquery subquery#4829, [id=#2935] > 409437) THEN Subquery subquery#4830, [id=#2948] ELSE Subquery subquery#4831, [id=#2961] END AS bucket1#4832, CASE WHEN (Subquery subquery#4833, [id=#2974] > 4595804) THEN Subquery subquery#4834, [id=#2987] ELSE Subquery subquery#4835, [id=#3000] END AS bucket2#4836, CASE WHEN (Subquery subquery#4837, [id=#3013] > 7887297) THEN Subquery subquery#4838, [id=#3026] ELSE Subquery subquery#4839, [id=#3039] END AS bucket3#4840, CASE WHEN (Subquery subquery#4841, [id=#3052] > 10872978) THEN Subquery subquery#4842, [id=#3065] ELSE Subquery subquery#4843, [id=#3078] END AS bucket4#4844, CASE WHEN (Subquery subquery#4845, [id=#3091] > 43571537) THEN Subquery subquery#4846, [id=#3104] ELSE Subquery subquery#4847, [id=#3117] END AS bucket5#4848]
   :  :- Subquery subquery#4829, [id=#2935]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#4876L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2933]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#5233L])
   :  :              +- Project
   :  :                 +- Filter ((isnotnull(ss_quantity#4862) AND (ss_quantity#4862 >= 1)) AND (ss_quantity#4862 <= 20))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4862,ss_sold_date_sk#4875L] Batched: true, DataFilters: [isnotnull(ss_quantity#4862), (ss_quantity#4862 >= 1), (ss_quantity#4862 <= 20)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int>
   :  :- Subquery subquery#4830, [id=#2948]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_ext_list_price#4893)], output=[avg(ss_ext_list_price)#4901])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2946]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_ext_list_price#4893)], output=[sum#5236, count#5237L])
   :  :              +- Project [ss_ext_list_price#4893]
   :  :                 +- Filter ((isnotnull(ss_quantity#4886) AND (ss_quantity#4886 >= 1)) AND (ss_quantity#4886 <= 20))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4886,ss_ext_list_price#4893,ss_sold_date_sk#4899L] Batched: true, DataFilters: [isnotnull(ss_quantity#4886), (ss_quantity#4886 >= 1), (ss_quantity#4886 <= 20)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int,ss_ext_list_price:double>
   :  :- Subquery subquery#4831, [id=#2961]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_net_paid_inc_tax#4922)], output=[avg(ss_net_paid_inc_tax)#4926])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2959]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_net_paid_inc_tax#4922)], output=[sum#5240, count#5241L])
   :  :              +- Project [ss_net_paid_inc_tax#4922]
   :  :                 +- Filter ((isnotnull(ss_quantity#4911) AND (ss_quantity#4911 >= 1)) AND (ss_quantity#4911 <= 20))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4911,ss_net_paid_inc_tax#4922,ss_sold_date_sk#4924L] Batched: true, DataFilters: [isnotnull(ss_quantity#4911), (ss_quantity#4911 >= 1), (ss_quantity#4911 <= 20)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int,ss_net_paid_inc_tax:double>
   :  :- Subquery subquery#4833, [id=#2974]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#4951L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2972]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#5243L])
   :  :              +- Project
   :  :                 +- Filter ((isnotnull(ss_quantity#4937) AND (ss_quantity#4937 >= 21)) AND (ss_quantity#4937 <= 40))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4937,ss_sold_date_sk#4950L] Batched: true, DataFilters: [isnotnull(ss_quantity#4937), (ss_quantity#4937 >= 21), (ss_quantity#4937 <= 40)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int>
   :  :- Subquery subquery#4834, [id=#2987]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_ext_list_price#4968)], output=[avg(ss_ext_list_price)#4976])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2985]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_ext_list_price#4968)], output=[sum#5246, count#5247L])
   :  :              +- Project [ss_ext_list_price#4968]
   :  :                 +- Filter ((isnotnull(ss_quantity#4961) AND (ss_quantity#4961 >= 21)) AND (ss_quantity#4961 <= 40))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4961,ss_ext_list_price#4968,ss_sold_date_sk#4974L] Batched: true, DataFilters: [isnotnull(ss_quantity#4961), (ss_quantity#4961 >= 21), (ss_quantity#4961 <= 40)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int,ss_ext_list_price:double>
   :  :- Subquery subquery#4835, [id=#3000]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_net_paid_inc_tax#4997)], output=[avg(ss_net_paid_inc_tax)#5001])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#2998]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_net_paid_inc_tax#4997)], output=[sum#5250, count#5251L])
   :  :              +- Project [ss_net_paid_inc_tax#4997]
   :  :                 +- Filter ((isnotnull(ss_quantity#4986) AND (ss_quantity#4986 >= 21)) AND (ss_quantity#4986 <= 40))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#4986,ss_net_paid_inc_tax#4997,ss_sold_date_sk#4999L] Batched: true, DataFilters: [isnotnull(ss_quantity#4986), (ss_quantity#4986 >= 21), (ss_quantity#4986 <= 40)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int,ss_net_paid_inc_tax:double>
   :  :- Subquery subquery#4837, [id=#3013]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#5026L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3011]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#5253L])
   :  :              +- Project
   :  :                 +- Filter ((isnotnull(ss_quantity#5012) AND (ss_quantity#5012 >= 41)) AND (ss_quantity#5012 <= 60))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5012,ss_sold_date_sk#5025L] Batched: true, DataFilters: [isnotnull(ss_quantity#5012), (ss_quantity#5012 >= 41), (ss_quantity#5012 <= 60)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int>
   :  :- Subquery subquery#4838, [id=#3026]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_ext_list_price#5043)], output=[avg(ss_ext_list_price)#5051])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3024]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_ext_list_price#5043)], output=[sum#5256, count#5257L])
   :  :              +- Project [ss_ext_list_price#5043]
   :  :                 +- Filter ((isnotnull(ss_quantity#5036) AND (ss_quantity#5036 >= 41)) AND (ss_quantity#5036 <= 60))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5036,ss_ext_list_price#5043,ss_sold_date_sk#5049L] Batched: true, DataFilters: [isnotnull(ss_quantity#5036), (ss_quantity#5036 >= 41), (ss_quantity#5036 <= 60)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int,ss_ext_list_price:double>
   :  :- Subquery subquery#4839, [id=#3039]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_net_paid_inc_tax#5072)], output=[avg(ss_net_paid_inc_tax)#5076])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3037]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_net_paid_inc_tax#5072)], output=[sum#5260, count#5261L])
   :  :              +- Project [ss_net_paid_inc_tax#5072]
   :  :                 +- Filter ((isnotnull(ss_quantity#5061) AND (ss_quantity#5061 >= 41)) AND (ss_quantity#5061 <= 60))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5061,ss_net_paid_inc_tax#5072,ss_sold_date_sk#5074L] Batched: true, DataFilters: [isnotnull(ss_quantity#5061), (ss_quantity#5061 >= 41), (ss_quantity#5061 <= 60)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int,ss_net_paid_inc_tax:double>
   :  :- Subquery subquery#4841, [id=#3052]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#5101L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3050]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#5263L])
   :  :              +- Project
   :  :                 +- Filter ((isnotnull(ss_quantity#5087) AND (ss_quantity#5087 >= 61)) AND (ss_quantity#5087 <= 80))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5087,ss_sold_date_sk#5100L] Batched: true, DataFilters: [isnotnull(ss_quantity#5087), (ss_quantity#5087 >= 61), (ss_quantity#5087 <= 80)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int>
   :  :- Subquery subquery#4842, [id=#3065]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_ext_list_price#5118)], output=[avg(ss_ext_list_price)#5126])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3063]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_ext_list_price#5118)], output=[sum#5266, count#5267L])
   :  :              +- Project [ss_ext_list_price#5118]
   :  :                 +- Filter ((isnotnull(ss_quantity#5111) AND (ss_quantity#5111 >= 61)) AND (ss_quantity#5111 <= 80))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5111,ss_ext_list_price#5118,ss_sold_date_sk#5124L] Batched: true, DataFilters: [isnotnull(ss_quantity#5111), (ss_quantity#5111 >= 61), (ss_quantity#5111 <= 80)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int,ss_ext_list_price:double>
   :  :- Subquery subquery#4843, [id=#3078]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_net_paid_inc_tax#5147)], output=[avg(ss_net_paid_inc_tax)#5151])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3076]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_net_paid_inc_tax#5147)], output=[sum#5270, count#5271L])
   :  :              +- Project [ss_net_paid_inc_tax#5147]
   :  :                 +- Filter ((isnotnull(ss_quantity#5136) AND (ss_quantity#5136 >= 61)) AND (ss_quantity#5136 <= 80))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5136,ss_net_paid_inc_tax#5147,ss_sold_date_sk#5149L] Batched: true, DataFilters: [isnotnull(ss_quantity#5136), (ss_quantity#5136 >= 61), (ss_quantity#5136 <= 80)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int,ss_net_paid_inc_tax:double>
   :  :- Subquery subquery#4845, [id=#3091]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#5176L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3089]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#5273L])
   :  :              +- Project
   :  :                 +- Filter ((isnotnull(ss_quantity#5162) AND (ss_quantity#5162 >= 81)) AND (ss_quantity#5162 <= 100))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5162,ss_sold_date_sk#5175L] Batched: true, DataFilters: [isnotnull(ss_quantity#5162), (ss_quantity#5162 >= 81), (ss_quantity#5162 <= 100)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int>
   :  :- Subquery subquery#4846, [id=#3104]
   :  :  +- AdaptiveSparkPlan isFinalPlan=false
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_ext_list_price#5193)], output=[avg(ss_ext_list_price)#5201])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3102]
   :  :           +- HashAggregate(keys=[], functions=[partial_avg(ss_ext_list_price#5193)], output=[sum#5276, count#5277L])
   :  :              +- Project [ss_ext_list_price#5193]
   :  :                 +- Filter ((isnotnull(ss_quantity#5186) AND (ss_quantity#5186 >= 81)) AND (ss_quantity#5186 <= 100))
   :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5186,ss_ext_list_price#5193,ss_sold_date_sk#5199L] Batched: true, DataFilters: [isnotnull(ss_quantity#5186), (ss_quantity#5186 >= 81), (ss_quantity#5186 <= 100)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int,ss_ext_list_price:double>
   :  +- Subquery subquery#4847, [id=#3117]
   :     +- AdaptiveSparkPlan isFinalPlan=false
   :        +- HashAggregate(keys=[], functions=[avg(ss_net_paid_inc_tax#5222)], output=[avg(ss_net_paid_inc_tax)#5226])
   :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#3115]
   :              +- HashAggregate(keys=[], functions=[partial_avg(ss_net_paid_inc_tax#5222)], output=[sum#5280, count#5281L])
   :                 +- Project [ss_net_paid_inc_tax#5222]
   :                    +- Filter ((isnotnull(ss_quantity#5211) AND (ss_quantity#5211 >= 81)) AND (ss_quantity#5211 <= 100))
   :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#5211,ss_net_paid_inc_tax#5222,ss_sold_date_sk#5224L] Batched: true, DataFilters: [isnotnull(ss_quantity#5211), (ss_quantity#5211 >= 81), (ss_quantity#5211 <= 100)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int,ss_net_paid_inc_tax:double>
   +- Filter (isnotnull(r_reason_sk#4849L) AND (r_reason_sk#4849L = 1))
      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#4849L] Batched: true, DataFilters: [isnotnull(r_reason_sk#4849L), (r_reason_sk#4849L = 1)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_sk), EqualTo(r_reason_sk,1)], ReadSchema: struct<r_reason_sk:bigint>

read query: spark_queries/q10.sql
explain query: q10
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_education_status ASC NULLS FIRST, 'cd_purchase_estimate ASC NULLS FIRST, 'cd_credit_rating ASC NULLS FIRST, 'cd_dep_count ASC NULLS FIRST, 'cd_dep_employed_count ASC NULLS FIRST, 'cd_dep_college_count ASC NULLS FIRST], true
      +- 'Aggregate ['cd_gender, 'cd_marital_status, 'cd_education_status, 'cd_purchase_estimate, 'cd_credit_rating, 'cd_dep_count, 'cd_dep_employed_count, 'cd_dep_college_count], ['cd_gender, 'cd_marital_status, 'cd_education_status, 'count(1) AS cnt1#5282, 'cd_purchase_estimate, 'count(1) AS cnt2#5283, 'cd_credit_rating, 'count(1) AS cnt3#5284, 'cd_dep_count, 'count(1) AS cnt4#5285, 'cd_dep_employed_count, 'count(1) AS cnt5#5286, 'cd_dep_college_count, 'count(1) AS cnt6#5287]
         +- 'Filter (((('c.c_current_addr_sk = 'ca.ca_address_sk) AND 'ca_county IN (Walker County,Richland County,Gaines County,Douglas County,Dona Ana County)) AND ('cd_demo_sk = 'c.c_current_cdemo_sk)) AND (exists#5288 [] AND (exists#5289 [] OR exists#5290 [])))
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND (('d_year = 2002) AND (('d_moy >= 4) AND ('d_moy <= (4 + 3)))))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [store_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('d_year = 2002) AND (('d_moy >= 4) AND ('d_moy <= (4 + 3)))))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [web_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  +- 'Project [*]
            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('d_year = 2002) AND (('d_moy >= 4) AND ('d_moy <= (4 + 3)))))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [catalog_sales], [], false
            :           +- 'UnresolvedRelation [date_dim], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias c
               :  :  +- 'UnresolvedRelation [customer], [], false
               :  +- 'SubqueryAlias ca
               :     +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [customer_demographics], [], false

== Analyzed Logical Plan ==
cd_gender: string, cd_marital_status: string, cd_education_status: string, cnt1: bigint, cd_purchase_estimate: int, cnt2: bigint, cd_credit_rating: string, cnt3: bigint, cd_dep_count: int, cnt4: bigint, cd_dep_employed_count: int, cnt5: bigint, cd_dep_college_count: int, cnt6: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cd_gender#5329 ASC NULLS FIRST, cd_marital_status#5330 ASC NULLS FIRST, cd_education_status#5331 ASC NULLS FIRST, cd_purchase_estimate#5332 ASC NULLS FIRST, cd_credit_rating#5333 ASC NULLS FIRST, cd_dep_count#5334 ASC NULLS FIRST, cd_dep_employed_count#5335 ASC NULLS FIRST, cd_dep_college_count#5336 ASC NULLS FIRST], true
      +- Aggregate [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336], [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, count(1) AS cnt1#5282L, cd_purchase_estimate#5332, count(1) AS cnt2#5283L, cd_credit_rating#5333, count(1) AS cnt3#5284L, cd_dep_count#5334, count(1) AS cnt4#5285L, cd_dep_employed_count#5335, count(1) AS cnt5#5286L, cd_dep_college_count#5336, count(1) AS cnt6#5287L]
         +- Filter ((((c_current_addr_sk#5301L = ca_address_sk#5315L) AND ca_county#5322 IN (Walker County,Richland County,Gaines County,Douglas County,Dona Ana County)) AND (cd_demo_sk#5328L = c_current_cdemo_sk#5299L)) AND (exists#5288 [c_customer_sk#5297L] AND (exists#5289 [c_customer_sk#5297L] OR exists#5290 [c_customer_sk#5297L])))
            :  :- Project [ss_sold_time_sk#5337L, ss_item_sk#5338L, ss_customer_sk#5339L, ss_cdemo_sk#5340L, ss_hdemo_sk#5341L, ss_addr_sk#5342L, ss_store_sk#5343L, ss_promo_sk#5344L, ss_ticket_number#5345L, ss_quantity#5346, ss_wholesale_cost#5347, ss_list_price#5348, ss_sales_price#5349, ss_ext_discount_amt#5350, ss_ext_sales_price#5351, ss_ext_wholesale_cost#5352, ss_ext_list_price#5353, ss_ext_tax#5354, ss_coupon_amt#5355, ss_net_paid#5356, ss_net_paid_inc_tax#5357, ss_net_profit#5358, ss_sold_date_sk#5359L, d_date_sk#5360L, ... 27 more fields]
            :  :  +- Filter (((outer(c_customer_sk#5297L) = ss_customer_sk#5339L) AND (ss_sold_date_sk#5359L = d_date_sk#5360L)) AND ((d_year#5366 = 2002) AND ((d_moy#5368 >= 4) AND (d_moy#5368 <= (4 + 3)))))
            :  :     +- Join Inner
            :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
            :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5337L,ss_item_sk#5338L,ss_customer_sk#5339L,ss_cdemo_sk#5340L,ss_hdemo_sk#5341L,ss_addr_sk#5342L,ss_store_sk#5343L,ss_promo_sk#5344L,ss_ticket_number#5345L,ss_quantity#5346,ss_wholesale_cost#5347,ss_list_price#5348,ss_sales_price#5349,ss_ext_discount_amt#5350,ss_ext_sales_price#5351,ss_ext_wholesale_cost#5352,ss_ext_list_price#5353,ss_ext_tax#5354,ss_coupon_amt#5355,ss_net_paid#5356,ss_net_paid_inc_tax#5357,ss_net_profit#5358,ss_sold_date_sk#5359L] orc
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5360L,d_date_id#5361,d_date#5362,d_month_seq#5363,d_week_seq#5364,d_quarter_seq#5365,d_year#5366,d_dow#5367,d_moy#5368,d_dom#5369,d_qoy#5370,d_fy_year#5371,d_fy_quarter_seq#5372,d_fy_week_seq#5373,d_day_name#5374,d_quarter_name#5375,d_holiday#5376,d_weekend#5377,d_following_holiday#5378,d_first_dom#5379,d_last_dom#5380,d_same_day_ly#5381,d_same_day_lq#5382,d_current_day#5383,... 4 more fields] orc
            :  :- Project [ws_sold_time_sk#5388L, ws_ship_date_sk#5389L, ws_item_sk#5390L, ws_bill_customer_sk#5391L, ws_bill_cdemo_sk#5392L, ws_bill_hdemo_sk#5393L, ws_bill_addr_sk#5394L, ws_ship_customer_sk#5395L, ws_ship_cdemo_sk#5396L, ws_ship_hdemo_sk#5397L, ws_ship_addr_sk#5398L, ws_web_page_sk#5399L, ws_web_site_sk#5400L, ws_ship_mode_sk#5401L, ws_warehouse_sk#5402L, ws_promo_sk#5403L, ws_order_number#5404L, ws_quantity#5405, ws_wholesale_cost#5406, ws_list_price#5407, ws_sales_price#5408, ws_ext_discount_amt#5409, ws_ext_sales_price#5410, ws_ext_wholesale_cost#5411, ... 38 more fields]
            :  :  +- Filter (((outer(c_customer_sk#5297L) = ws_bill_customer_sk#5391L) AND (ws_sold_date_sk#5421L = d_date_sk#5422L)) AND ((d_year#5428 = 2002) AND ((d_moy#5430 >= 4) AND (d_moy#5430 <= (4 + 3)))))
            :  :     +- Join Inner
            :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#5388L,ws_ship_date_sk#5389L,ws_item_sk#5390L,ws_bill_customer_sk#5391L,ws_bill_cdemo_sk#5392L,ws_bill_hdemo_sk#5393L,ws_bill_addr_sk#5394L,ws_ship_customer_sk#5395L,ws_ship_cdemo_sk#5396L,ws_ship_hdemo_sk#5397L,ws_ship_addr_sk#5398L,ws_web_page_sk#5399L,ws_web_site_sk#5400L,ws_ship_mode_sk#5401L,ws_warehouse_sk#5402L,ws_promo_sk#5403L,ws_order_number#5404L,ws_quantity#5405,ws_wholesale_cost#5406,ws_list_price#5407,ws_sales_price#5408,ws_ext_discount_amt#5409,ws_ext_sales_price#5410,ws_ext_wholesale_cost#5411,... 10 more fields] orc
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5422L,d_date_id#5423,d_date#5424,d_month_seq#5425,d_week_seq#5426,d_quarter_seq#5427,d_year#5428,d_dow#5429,d_moy#5430,d_dom#5431,d_qoy#5432,d_fy_year#5433,d_fy_quarter_seq#5434,d_fy_week_seq#5435,d_day_name#5436,d_quarter_name#5437,d_holiday#5438,d_weekend#5439,d_following_holiday#5440,d_first_dom#5441,d_last_dom#5442,d_same_day_ly#5443,d_same_day_lq#5444,d_current_day#5445,... 4 more fields] orc
            :  +- Project [cs_sold_time_sk#5450L, cs_ship_date_sk#5451L, cs_bill_customer_sk#5452L, cs_bill_cdemo_sk#5453L, cs_bill_hdemo_sk#5454L, cs_bill_addr_sk#5455L, cs_ship_customer_sk#5456L, cs_ship_cdemo_sk#5457L, cs_ship_hdemo_sk#5458L, cs_ship_addr_sk#5459L, cs_call_center_sk#5460L, cs_catalog_page_sk#5461L, cs_ship_mode_sk#5462L, cs_warehouse_sk#5463L, cs_item_sk#5464L, cs_promo_sk#5465L, cs_order_number#5466L, cs_quantity#5467, cs_wholesale_cost#5468, cs_list_price#5469, cs_sales_price#5470, cs_ext_discount_amt#5471, cs_ext_sales_price#5472, cs_ext_wholesale_cost#5473, ... 38 more fields]
            :     +- Filter (((outer(c_customer_sk#5297L) = cs_ship_customer_sk#5456L) AND (cs_sold_date_sk#5483L = d_date_sk#5484L)) AND ((d_year#5490 = 2002) AND ((d_moy#5492 >= 4) AND (d_moy#5492 <= (4 + 3)))))
            :        +- Join Inner
            :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#5450L,cs_ship_date_sk#5451L,cs_bill_customer_sk#5452L,cs_bill_cdemo_sk#5453L,cs_bill_hdemo_sk#5454L,cs_bill_addr_sk#5455L,cs_ship_customer_sk#5456L,cs_ship_cdemo_sk#5457L,cs_ship_hdemo_sk#5458L,cs_ship_addr_sk#5459L,cs_call_center_sk#5460L,cs_catalog_page_sk#5461L,cs_ship_mode_sk#5462L,cs_warehouse_sk#5463L,cs_item_sk#5464L,cs_promo_sk#5465L,cs_order_number#5466L,cs_quantity#5467,cs_wholesale_cost#5468,cs_list_price#5469,cs_sales_price#5470,cs_ext_discount_amt#5471,cs_ext_sales_price#5472,cs_ext_wholesale_cost#5473,... 10 more fields] orc
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5484L,d_date_id#5485,d_date#5486,d_month_seq#5487,d_week_seq#5488,d_quarter_seq#5489,d_year#5490,d_dow#5491,d_moy#5492,d_dom#5493,d_qoy#5494,d_fy_year#5495,d_fy_quarter_seq#5496,d_fy_week_seq#5497,d_day_name#5498,d_quarter_name#5499,d_holiday#5500,d_weekend#5501,d_following_holiday#5502,d_first_dom#5503,d_last_dom#5504,d_same_day_ly#5505,d_same_day_lq#5506,d_current_day#5507,... 4 more fields] orc
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias c
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5297L,c_customer_id#5298,c_current_cdemo_sk#5299L,c_current_hdemo_sk#5300L,c_current_addr_sk#5301L,c_first_shipto_date_sk#5302L,c_first_sales_date_sk#5303L,c_salutation#5304,c_first_name#5305,c_last_name#5306,c_preferred_cust_flag#5307,c_birth_day#5308,c_birth_month#5309,c_birth_year#5310,c_birth_country#5311,c_login#5312,c_email_address#5313,c_last_review_date#5314] orc
               :  +- SubqueryAlias ca
               :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#5315L,ca_address_id#5316,ca_street_number#5317,ca_street_name#5318,ca_street_type#5319,ca_suite_number#5320,ca_city#5321,ca_county#5322,ca_state#5323,ca_zip#5324,ca_country#5325,ca_gmt_offset#5326,ca_location_type#5327] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#5328L,cd_gender#5329,cd_marital_status#5330,cd_education_status#5331,cd_purchase_estimate#5332,cd_credit_rating#5333,cd_dep_count#5334,cd_dep_employed_count#5335,cd_dep_college_count#5336] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cd_gender#5329 ASC NULLS FIRST, cd_marital_status#5330 ASC NULLS FIRST, cd_education_status#5331 ASC NULLS FIRST, cd_purchase_estimate#5332 ASC NULLS FIRST, cd_credit_rating#5333 ASC NULLS FIRST, cd_dep_count#5334 ASC NULLS FIRST, cd_dep_employed_count#5335 ASC NULLS FIRST, cd_dep_college_count#5336 ASC NULLS FIRST], true
      +- Aggregate [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336], [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, count(1) AS cnt1#5282L, cd_purchase_estimate#5332, count(1) AS cnt2#5283L, cd_credit_rating#5333, count(1) AS cnt3#5284L, cd_dep_count#5334, count(1) AS cnt4#5285L, cd_dep_employed_count#5335, count(1) AS cnt5#5286L, cd_dep_college_count#5336, count(1) AS cnt6#5287L]
         +- Project [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336]
            +- Join Inner, (cd_demo_sk#5328L = c_current_cdemo_sk#5299L)
               :- Project [c_current_cdemo_sk#5299L]
               :  +- Join Inner, (c_current_addr_sk#5301L = ca_address_sk#5315L)
               :     :- Project [c_current_cdemo_sk#5299L, c_current_addr_sk#5301L]
               :     :  +- Filter (exists#5526 OR exists#5527)
               :     :     +- Join ExistenceJoin(exists#5527), (c_customer_sk#5297L = cs_ship_customer_sk#5456L)
               :     :        :- Join ExistenceJoin(exists#5526), (c_customer_sk#5297L = ws_bill_customer_sk#5391L)
               :     :        :  :- Join LeftSemi, (c_customer_sk#5297L = ss_customer_sk#5339L)
               :     :        :  :  :- Project [c_customer_sk#5297L, c_current_cdemo_sk#5299L, c_current_addr_sk#5301L]
               :     :        :  :  :  +- Filter (isnotnull(c_current_addr_sk#5301L) AND isnotnull(c_current_cdemo_sk#5299L))
               :     :        :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5297L,c_customer_id#5298,c_current_cdemo_sk#5299L,c_current_hdemo_sk#5300L,c_current_addr_sk#5301L,c_first_shipto_date_sk#5302L,c_first_sales_date_sk#5303L,c_salutation#5304,c_first_name#5305,c_last_name#5306,c_preferred_cust_flag#5307,c_birth_day#5308,c_birth_month#5309,c_birth_year#5310,c_birth_country#5311,c_login#5312,c_email_address#5313,c_last_review_date#5314] orc
               :     :        :  :  +- Project [ss_customer_sk#5339L]
               :     :        :  :     +- Join Inner, (ss_sold_date_sk#5359L = d_date_sk#5360L)
               :     :        :  :        :- Project [ss_customer_sk#5339L, ss_sold_date_sk#5359L]
               :     :        :  :        :  +- Filter (isnotnull(ss_sold_date_sk#5359L) AND dynamicpruning#5528 [ss_sold_date_sk#5359L])
               :     :        :  :        :     :  +- Project [d_date_sk#5360L]
               :     :        :  :        :     :     +- Filter (((isnotnull(d_year#5366) AND isnotnull(d_moy#5368)) AND (((d_year#5366 = 2002) AND (d_moy#5368 >= 4)) AND (d_moy#5368 <= 7))) AND isnotnull(d_date_sk#5360L))
               :     :        :  :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5360L,d_date_id#5361,d_date#5362,d_month_seq#5363,d_week_seq#5364,d_quarter_seq#5365,d_year#5366,d_dow#5367,d_moy#5368,d_dom#5369,d_qoy#5370,d_fy_year#5371,d_fy_quarter_seq#5372,d_fy_week_seq#5373,d_day_name#5374,d_quarter_name#5375,d_holiday#5376,d_weekend#5377,d_following_holiday#5378,d_first_dom#5379,d_last_dom#5380,d_same_day_ly#5381,d_same_day_lq#5382,d_current_day#5383,... 4 more fields] orc
               :     :        :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5337L,ss_item_sk#5338L,ss_customer_sk#5339L,ss_cdemo_sk#5340L,ss_hdemo_sk#5341L,ss_addr_sk#5342L,ss_store_sk#5343L,ss_promo_sk#5344L,ss_ticket_number#5345L,ss_quantity#5346,ss_wholesale_cost#5347,ss_list_price#5348,ss_sales_price#5349,ss_ext_discount_amt#5350,ss_ext_sales_price#5351,ss_ext_wholesale_cost#5352,ss_ext_list_price#5353,ss_ext_tax#5354,ss_coupon_amt#5355,ss_net_paid#5356,ss_net_paid_inc_tax#5357,ss_net_profit#5358,ss_sold_date_sk#5359L] orc
               :     :        :  :        +- Project [d_date_sk#5360L]
               :     :        :  :           +- Filter (((isnotnull(d_year#5366) AND isnotnull(d_moy#5368)) AND (((d_year#5366 = 2002) AND (d_moy#5368 >= 4)) AND (d_moy#5368 <= 7))) AND isnotnull(d_date_sk#5360L))
               :     :        :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5360L,d_date_id#5361,d_date#5362,d_month_seq#5363,d_week_seq#5364,d_quarter_seq#5365,d_year#5366,d_dow#5367,d_moy#5368,d_dom#5369,d_qoy#5370,d_fy_year#5371,d_fy_quarter_seq#5372,d_fy_week_seq#5373,d_day_name#5374,d_quarter_name#5375,d_holiday#5376,d_weekend#5377,d_following_holiday#5378,d_first_dom#5379,d_last_dom#5380,d_same_day_ly#5381,d_same_day_lq#5382,d_current_day#5383,... 4 more fields] orc
               :     :        :  +- Project [ws_bill_customer_sk#5391L]
               :     :        :     +- Join Inner, (ws_sold_date_sk#5421L = d_date_sk#5422L)
               :     :        :        :- Project [ws_bill_customer_sk#5391L, ws_sold_date_sk#5421L]
               :     :        :        :  +- Filter (isnotnull(ws_sold_date_sk#5421L) AND dynamicpruning#5529 [ws_sold_date_sk#5421L])
               :     :        :        :     :  +- Project [d_date_sk#5422L]
               :     :        :        :     :     +- Filter (((isnotnull(d_year#5428) AND isnotnull(d_moy#5430)) AND (((d_year#5428 = 2002) AND (d_moy#5430 >= 4)) AND (d_moy#5430 <= 7))) AND isnotnull(d_date_sk#5422L))
               :     :        :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5422L,d_date_id#5423,d_date#5424,d_month_seq#5425,d_week_seq#5426,d_quarter_seq#5427,d_year#5428,d_dow#5429,d_moy#5430,d_dom#5431,d_qoy#5432,d_fy_year#5433,d_fy_quarter_seq#5434,d_fy_week_seq#5435,d_day_name#5436,d_quarter_name#5437,d_holiday#5438,d_weekend#5439,d_following_holiday#5440,d_first_dom#5441,d_last_dom#5442,d_same_day_ly#5443,d_same_day_lq#5444,d_current_day#5445,... 4 more fields] orc
               :     :        :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#5388L,ws_ship_date_sk#5389L,ws_item_sk#5390L,ws_bill_customer_sk#5391L,ws_bill_cdemo_sk#5392L,ws_bill_hdemo_sk#5393L,ws_bill_addr_sk#5394L,ws_ship_customer_sk#5395L,ws_ship_cdemo_sk#5396L,ws_ship_hdemo_sk#5397L,ws_ship_addr_sk#5398L,ws_web_page_sk#5399L,ws_web_site_sk#5400L,ws_ship_mode_sk#5401L,ws_warehouse_sk#5402L,ws_promo_sk#5403L,ws_order_number#5404L,ws_quantity#5405,ws_wholesale_cost#5406,ws_list_price#5407,ws_sales_price#5408,ws_ext_discount_amt#5409,ws_ext_sales_price#5410,ws_ext_wholesale_cost#5411,... 10 more fields] orc
               :     :        :        +- Project [d_date_sk#5422L]
               :     :        :           +- Filter (((isnotnull(d_year#5428) AND isnotnull(d_moy#5430)) AND (((d_year#5428 = 2002) AND (d_moy#5430 >= 4)) AND (d_moy#5430 <= 7))) AND isnotnull(d_date_sk#5422L))
               :     :        :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5422L,d_date_id#5423,d_date#5424,d_month_seq#5425,d_week_seq#5426,d_quarter_seq#5427,d_year#5428,d_dow#5429,d_moy#5430,d_dom#5431,d_qoy#5432,d_fy_year#5433,d_fy_quarter_seq#5434,d_fy_week_seq#5435,d_day_name#5436,d_quarter_name#5437,d_holiday#5438,d_weekend#5439,d_following_holiday#5440,d_first_dom#5441,d_last_dom#5442,d_same_day_ly#5443,d_same_day_lq#5444,d_current_day#5445,... 4 more fields] orc
               :     :        +- Project [cs_ship_customer_sk#5456L]
               :     :           +- Join Inner, (cs_sold_date_sk#5483L = d_date_sk#5484L)
               :     :              :- Project [cs_ship_customer_sk#5456L, cs_sold_date_sk#5483L]
               :     :              :  +- Filter (isnotnull(cs_sold_date_sk#5483L) AND dynamicpruning#5530 [cs_sold_date_sk#5483L])
               :     :              :     :  +- Project [d_date_sk#5484L]
               :     :              :     :     +- Filter (((isnotnull(d_year#5490) AND isnotnull(d_moy#5492)) AND (((d_year#5490 = 2002) AND (d_moy#5492 >= 4)) AND (d_moy#5492 <= 7))) AND isnotnull(d_date_sk#5484L))
               :     :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5484L,d_date_id#5485,d_date#5486,d_month_seq#5487,d_week_seq#5488,d_quarter_seq#5489,d_year#5490,d_dow#5491,d_moy#5492,d_dom#5493,d_qoy#5494,d_fy_year#5495,d_fy_quarter_seq#5496,d_fy_week_seq#5497,d_day_name#5498,d_quarter_name#5499,d_holiday#5500,d_weekend#5501,d_following_holiday#5502,d_first_dom#5503,d_last_dom#5504,d_same_day_ly#5505,d_same_day_lq#5506,d_current_day#5507,... 4 more fields] orc
               :     :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#5450L,cs_ship_date_sk#5451L,cs_bill_customer_sk#5452L,cs_bill_cdemo_sk#5453L,cs_bill_hdemo_sk#5454L,cs_bill_addr_sk#5455L,cs_ship_customer_sk#5456L,cs_ship_cdemo_sk#5457L,cs_ship_hdemo_sk#5458L,cs_ship_addr_sk#5459L,cs_call_center_sk#5460L,cs_catalog_page_sk#5461L,cs_ship_mode_sk#5462L,cs_warehouse_sk#5463L,cs_item_sk#5464L,cs_promo_sk#5465L,cs_order_number#5466L,cs_quantity#5467,cs_wholesale_cost#5468,cs_list_price#5469,cs_sales_price#5470,cs_ext_discount_amt#5471,cs_ext_sales_price#5472,cs_ext_wholesale_cost#5473,... 10 more fields] orc
               :     :              +- Project [d_date_sk#5484L]
               :     :                 +- Filter (((isnotnull(d_year#5490) AND isnotnull(d_moy#5492)) AND (((d_year#5490 = 2002) AND (d_moy#5492 >= 4)) AND (d_moy#5492 <= 7))) AND isnotnull(d_date_sk#5484L))
               :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5484L,d_date_id#5485,d_date#5486,d_month_seq#5487,d_week_seq#5488,d_quarter_seq#5489,d_year#5490,d_dow#5491,d_moy#5492,d_dom#5493,d_qoy#5494,d_fy_year#5495,d_fy_quarter_seq#5496,d_fy_week_seq#5497,d_day_name#5498,d_quarter_name#5499,d_holiday#5500,d_weekend#5501,d_following_holiday#5502,d_first_dom#5503,d_last_dom#5504,d_same_day_ly#5505,d_same_day_lq#5506,d_current_day#5507,... 4 more fields] orc
               :     +- Project [ca_address_sk#5315L]
               :        +- Filter (ca_county#5322 IN (Walker County,Richland County,Gaines County,Douglas County,Dona Ana County) AND isnotnull(ca_address_sk#5315L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#5315L,ca_address_id#5316,ca_street_number#5317,ca_street_name#5318,ca_street_type#5319,ca_suite_number#5320,ca_city#5321,ca_county#5322,ca_state#5323,ca_zip#5324,ca_country#5325,ca_gmt_offset#5326,ca_location_type#5327] orc
               +- Filter isnotnull(cd_demo_sk#5328L)
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#5328L,cd_gender#5329,cd_marital_status#5330,cd_education_status#5331,cd_purchase_estimate#5332,cd_credit_rating#5333,cd_dep_count#5334,cd_dep_employed_count#5335,cd_dep_college_count#5336] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[cd_gender#5329 ASC NULLS FIRST,cd_marital_status#5330 ASC NULLS FIRST,cd_education_status#5331 ASC NULLS FIRST,cd_purchase_estimate#5332 ASC NULLS FIRST,cd_credit_rating#5333 ASC NULLS FIRST,cd_dep_count#5334 ASC NULLS FIRST,cd_dep_employed_count#5335 ASC NULLS FIRST,cd_dep_college_count#5336 ASC NULLS FIRST], output=[cd_gender#5329,cd_marital_status#5330,cd_education_status#5331,cnt1#5282L,cd_purchase_estimate#5332,cnt2#5283L,cd_credit_rating#5333,cnt3#5284L,cd_dep_count#5334,cnt4#5285L,cd_dep_employed_count#5335,cnt5#5286L,cd_dep_college_count#5336,cnt6#5287L])
   +- HashAggregate(keys=[cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336], functions=[count(1)], output=[cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cnt1#5282L, cd_purchase_estimate#5332, cnt2#5283L, cd_credit_rating#5333, cnt3#5284L, cd_dep_count#5334, cnt4#5285L, cd_dep_employed_count#5335, cnt5#5286L, cd_dep_college_count#5336, cnt6#5287L])
      +- Exchange hashpartitioning(cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336, 3000), ENSURE_REQUIREMENTS, [id=#3343]
         +- HashAggregate(keys=[cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336], functions=[partial_count(1)], output=[cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336, count#5532L])
            +- Project [cd_gender#5329, cd_marital_status#5330, cd_education_status#5331, cd_purchase_estimate#5332, cd_credit_rating#5333, cd_dep_count#5334, cd_dep_employed_count#5335, cd_dep_college_count#5336]
               +- SortMergeJoin [c_current_cdemo_sk#5299L], [cd_demo_sk#5328L], Inner
                  :- Sort [c_current_cdemo_sk#5299L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(c_current_cdemo_sk#5299L, 3000), ENSURE_REQUIREMENTS, [id=#3335]
                  :     +- Project [c_current_cdemo_sk#5299L]
                  :        +- BroadcastHashJoin [c_current_addr_sk#5301L], [ca_address_sk#5315L], Inner, BuildRight, false
                  :           :- Project [c_current_cdemo_sk#5299L, c_current_addr_sk#5301L]
                  :           :  +- Filter (exists#5526 OR exists#5527)
                  :           :     +- SortMergeJoin [c_customer_sk#5297L], [cs_ship_customer_sk#5456L], ExistenceJoin(exists#5527)
                  :           :        :- SortMergeJoin [c_customer_sk#5297L], [ws_bill_customer_sk#5391L], ExistenceJoin(exists#5526)
                  :           :        :  :- SortMergeJoin [c_customer_sk#5297L], [ss_customer_sk#5339L], LeftSemi
                  :           :        :  :  :- Sort [c_customer_sk#5297L ASC NULLS FIRST], false, 0
                  :           :        :  :  :  +- Exchange hashpartitioning(c_customer_sk#5297L, 3000), ENSURE_REQUIREMENTS, [id=#3306]
                  :           :        :  :  :     +- Filter (isnotnull(c_current_addr_sk#5301L) AND isnotnull(c_current_cdemo_sk#5299L))
                  :           :        :  :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5297L,c_current_cdemo_sk#5299L,c_current_addr_sk#5301L] Batched: true, DataFilters: [isnotnull(c_current_addr_sk#5301L), isnotnull(c_current_cdemo_sk#5299L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_addr_sk:bigint>
                  :           :        :  :  +- Sort [ss_customer_sk#5339L ASC NULLS FIRST], false, 0
                  :           :        :  :     +- Exchange hashpartitioning(ss_customer_sk#5339L, 3000), ENSURE_REQUIREMENTS, [id=#3307]
                  :           :        :  :        +- Project [ss_customer_sk#5339L]
                  :           :        :  :           +- BroadcastHashJoin [ss_sold_date_sk#5359L], [d_date_sk#5360L], Inner, BuildRight, false
                  :           :        :  :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#5339L,ss_sold_date_sk#5359L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#5359L), dynamicpruningexpression(ss_sold_date_sk#5359L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_customer_sk:bigint>
                  :           :        :  :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#5528, 0, true, Project [d_date_sk#5360L], [d_date_sk#5360L]
                  :           :        :  :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :        :  :              :           +- Project [d_date_sk#5360L]
                  :           :        :  :              :              +- Filter (((((isnotnull(d_year#5366) AND isnotnull(d_moy#5368)) AND (d_year#5366 = 2002)) AND (d_moy#5368 >= 4)) AND (d_moy#5368 <= 7)) AND isnotnull(d_date_sk#5360L))
                  :           :        :  :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5360L,d_year#5366,d_moy#5368] Batched: true, DataFilters: [isnotnull(d_year#5366), isnotnull(d_moy#5368), (d_year#5366 = 2002), (d_moy#5368 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :        :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#3301]
                  :           :        :  :                 +- Project [d_date_sk#5360L]
                  :           :        :  :                    +- Filter (((((isnotnull(d_year#5366) AND isnotnull(d_moy#5368)) AND (d_year#5366 = 2002)) AND (d_moy#5368 >= 4)) AND (d_moy#5368 <= 7)) AND isnotnull(d_date_sk#5360L))
                  :           :        :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5360L,d_year#5366,d_moy#5368] Batched: true, DataFilters: [isnotnull(d_year#5366), isnotnull(d_moy#5368), (d_year#5366 = 2002), (d_moy#5368 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :        :  +- Sort [ws_bill_customer_sk#5391L ASC NULLS FIRST], false, 0
                  :           :        :     +- Exchange hashpartitioning(ws_bill_customer_sk#5391L, 3000), ENSURE_REQUIREMENTS, [id=#3316]
                  :           :        :        +- Project [ws_bill_customer_sk#5391L]
                  :           :        :           +- BroadcastHashJoin [ws_sold_date_sk#5421L], [d_date_sk#5422L], Inner, BuildRight, false
                  :           :        :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#5391L,ws_sold_date_sk#5421L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#5421L), dynamicpruningexpression(ws_sold_date_sk#5421L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:bigint>
                  :           :        :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#5529, 0, true, Project [d_date_sk#5422L], [d_date_sk#5422L]
                  :           :        :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :        :              :           +- Project [d_date_sk#5422L]
                  :           :        :              :              +- Filter (((((isnotnull(d_year#5428) AND isnotnull(d_moy#5430)) AND (d_year#5428 = 2002)) AND (d_moy#5430 >= 4)) AND (d_moy#5430 <= 7)) AND isnotnull(d_date_sk#5422L))
                  :           :        :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5422L,d_year#5428,d_moy#5430] Batched: true, DataFilters: [isnotnull(d_year#5428), isnotnull(d_moy#5430), (d_year#5428 = 2002), (d_moy#5430 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :        :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#3311]
                  :           :        :                 +- Project [d_date_sk#5422L]
                  :           :        :                    +- Filter (((((isnotnull(d_year#5428) AND isnotnull(d_moy#5430)) AND (d_year#5428 = 2002)) AND (d_moy#5430 >= 4)) AND (d_moy#5430 <= 7)) AND isnotnull(d_date_sk#5422L))
                  :           :        :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5422L,d_year#5428,d_moy#5430] Batched: true, DataFilters: [isnotnull(d_year#5428), isnotnull(d_moy#5430), (d_year#5428 = 2002), (d_moy#5430 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :        +- Sort [cs_ship_customer_sk#5456L ASC NULLS FIRST], false, 0
                  :           :           +- Exchange hashpartitioning(cs_ship_customer_sk#5456L, 3000), ENSURE_REQUIREMENTS, [id=#3324]
                  :           :              +- Project [cs_ship_customer_sk#5456L]
                  :           :                 +- BroadcastHashJoin [cs_sold_date_sk#5483L], [d_date_sk#5484L], Inner, BuildRight, false
                  :           :                    :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_customer_sk#5456L,cs_sold_date_sk#5483L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#5483L), dynamicpruningexpression(cs_sold_date_sk#5483L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:bigint>
                  :           :                    :     +- SubqueryAdaptiveBroadcast dynamicpruning#5530, 0, true, Project [d_date_sk#5484L], [d_date_sk#5484L]
                  :           :                    :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :                    :           +- Project [d_date_sk#5484L]
                  :           :                    :              +- Filter (((((isnotnull(d_year#5490) AND isnotnull(d_moy#5492)) AND (d_year#5490 = 2002)) AND (d_moy#5492 >= 4)) AND (d_moy#5492 <= 7)) AND isnotnull(d_date_sk#5484L))
                  :           :                    :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5484L,d_year#5490,d_moy#5492] Batched: true, DataFilters: [isnotnull(d_year#5490), isnotnull(d_moy#5492), (d_year#5490 = 2002), (d_moy#5492 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#3319]
                  :           :                       +- Project [d_date_sk#5484L]
                  :           :                          +- Filter (((((isnotnull(d_year#5490) AND isnotnull(d_moy#5492)) AND (d_year#5490 = 2002)) AND (d_moy#5492 >= 4)) AND (d_moy#5492 <= 7)) AND isnotnull(d_date_sk#5484L))
                  :           :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5484L,d_year#5490,d_moy#5492] Batched: true, DataFilters: [isnotnull(d_year#5490), isnotnull(d_moy#5492), (d_year#5490 = 2002), (d_moy#5492 >= 4), (d_moy#5..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#3330]
                  :              +- Project [ca_address_sk#5315L]
                  :                 +- Filter (ca_county#5322 IN (Walker County,Richland County,Gaines County,Douglas County,Dona Ana County) AND isnotnull(ca_address_sk#5315L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#5315L,ca_county#5322] Batched: true, DataFilters: [ca_county#5322 IN (Walker County,Richland County,Gaines County,Douglas County,Dona Ana County), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(ca_county, [Dona Ana County,Douglas County,Gaines County,Richland County,Walker County]), IsN..., ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
                  +- Sort [cd_demo_sk#5328L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cd_demo_sk#5328L, 3000), ENSURE_REQUIREMENTS, [id=#3336]
                        +- Filter isnotnull(cd_demo_sk#5328L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#5328L,cd_gender#5329,cd_marital_status#5330,cd_education_status#5331,cd_purchase_estimate#5332,cd_credit_rating#5333,cd_dep_count#5334,cd_dep_employed_count#5335,cd_dep_college_count#5336] Batched: true, DataFilters: [isnotnull(cd_demo_sk#5328L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_education_status:string,cd_...

read query: spark_queries/q11.sql
explain query: q11
== Parsed Logical Plan ==
CTE [year_total]
:  +- 'SubqueryAlias year_total
:     +- 'Union false, false
:        :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'd_year, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#5533, 'c_first_name AS customer_first_name#5534, 'c_last_name AS customer_last_name#5535, 'c_preferred_cust_flag, 'c_birth_country AS customer_birth_country#5536, 'c_login AS customer_login#5537, 'c_email_address AS customer_email_address#5538, 'd_year AS dyear#5539, 'sum(('ss_ext_list_price - 'ss_ext_discount_amt)) AS year_total#5540, s AS sale_type#5541]
:        :  +- 'Filter (('c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk))
:        :     +- 'Join Inner
:        :        :- 'Join Inner
:        :        :  :- 'UnresolvedRelation [customer], [], false
:        :        :  +- 'UnresolvedRelation [store_sales], [], false
:        :        +- 'UnresolvedRelation [date_dim], [], false
:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#5542, 'c_first_name AS customer_first_name#5543, 'c_last_name AS customer_last_name#5544, 'c_preferred_cust_flag, 'c_birth_country AS customer_birth_country#5545, 'c_login AS customer_login#5546, 'c_email_address AS customer_email_address#5547, 'd_year AS dyear#5548, 'sum(('ws_ext_list_price - 'ws_ext_discount_amt)) AS year_total#5549, w AS sale_type#5550]
:           +- 'Filter (('c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk))
:              +- 'Join Inner
:                 :- 'Join Inner
:                 :  :- 'UnresolvedRelation [customer], [], false
:                 :  +- 'UnresolvedRelation [web_sales], [], false
:                 +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['t_s_secyear.c_preferred_cust_flag ASC NULLS FIRST], true
         +- 'Project ['t_s_secyear.c_preferred_cust_flag]
            +- 'Filter ((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) AND ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) AND (('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) AND ('t_s_firstyear.sale_type = s))) AND ((('t_w_firstyear.sale_type = w) AND ('t_s_secyear.sale_type = s)) AND ('t_w_secyear.sale_type = w))) AND (((('t_s_firstyear.dyear = 2001) AND ('t_s_secyear.dyear = (2001 + 1))) AND (('t_w_firstyear.dyear = 2001) AND ('t_w_secyear.dyear = (2001 + 1)))) AND ((('t_s_firstyear.year_total > 0) AND ('t_w_firstyear.year_total > 0)) AND (CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'SubqueryAlias t_s_firstyear
                  :  :  :  +- 'UnresolvedRelation [year_total], [], false
                  :  :  +- 'SubqueryAlias t_s_secyear
                  :  :     +- 'UnresolvedRelation [year_total], [], false
                  :  +- 'SubqueryAlias t_w_firstyear
                  :     +- 'UnresolvedRelation [year_total], [], false
                  +- 'SubqueryAlias t_w_secyear
                     +- 'UnresolvedRelation [year_total], [], false

== Analyzed Logical Plan ==
c_preferred_cust_flag: string
WithCTE
:- CTERelationDef 7
:  +- SubqueryAlias year_total
:     +- Union false, false
:        :- Aggregate [c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567, d_year#5598], [c_customer_id#5552 AS customer_id#5533, c_first_name#5559 AS customer_first_name#5534, c_last_name#5560 AS customer_last_name#5535, c_preferred_cust_flag#5561, c_birth_country#5565 AS customer_birth_country#5536, c_login#5566 AS customer_login#5537, c_email_address#5567 AS customer_email_address#5538, d_year#5598 AS dyear#5539, sum((ss_ext_list_price#5585 - ss_ext_discount_amt#5582)) AS year_total#5540, s AS sale_type#5541]
:        :  +- Filter ((c_customer_sk#5551L = ss_customer_sk#5571L) AND (ss_sold_date_sk#5591L = d_date_sk#5592L))
:        :     +- Join Inner
:        :        :- Join Inner
:        :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:        :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5551L,c_customer_id#5552,c_current_cdemo_sk#5553L,c_current_hdemo_sk#5554L,c_current_addr_sk#5555L,c_first_shipto_date_sk#5556L,c_first_sales_date_sk#5557L,c_salutation#5558,c_first_name#5559,c_last_name#5560,c_preferred_cust_flag#5561,c_birth_day#5562,c_birth_month#5563,c_birth_year#5564,c_birth_country#5565,c_login#5566,c_email_address#5567,c_last_review_date#5568] orc
:        :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:        :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5569L,ss_item_sk#5570L,ss_customer_sk#5571L,ss_cdemo_sk#5572L,ss_hdemo_sk#5573L,ss_addr_sk#5574L,ss_store_sk#5575L,ss_promo_sk#5576L,ss_ticket_number#5577L,ss_quantity#5578,ss_wholesale_cost#5579,ss_list_price#5580,ss_sales_price#5581,ss_ext_discount_amt#5582,ss_ext_sales_price#5583,ss_ext_wholesale_cost#5584,ss_ext_list_price#5585,ss_ext_tax#5586,ss_coupon_amt#5587,ss_net_paid#5588,ss_net_paid_inc_tax#5589,ss_net_profit#5590,ss_sold_date_sk#5591L] orc
:        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5592L,d_date_id#5593,d_date#5594,d_month_seq#5595,d_week_seq#5596,d_quarter_seq#5597,d_year#5598,d_dow#5599,d_moy#5600,d_dom#5601,d_qoy#5602,d_fy_year#5603,d_fy_quarter_seq#5604,d_fy_week_seq#5605,d_day_name#5606,d_quarter_name#5607,d_holiday#5608,d_weekend#5609,d_following_holiday#5610,d_first_dom#5611,d_last_dom#5612,d_same_day_ly#5613,d_same_day_lq#5614,d_current_day#5615,... 4 more fields] orc
:        +- Aggregate [c_customer_id#5621, c_first_name#5628, c_last_name#5629, c_preferred_cust_flag#5630, c_birth_country#5634, c_login#5635, c_email_address#5636, d_year#5678], [c_customer_id#5621 AS customer_id#5542, c_first_name#5628 AS customer_first_name#5543, c_last_name#5629 AS customer_last_name#5544, c_preferred_cust_flag#5630, c_birth_country#5634 AS customer_birth_country#5545, c_login#5635 AS customer_login#5546, c_email_address#5636 AS customer_email_address#5547, d_year#5678 AS dyear#5548, sum((ws_ext_list_price#5662 - ws_ext_discount_amt#5659)) AS year_total#5549, w AS sale_type#5550]
:           +- Filter ((c_customer_sk#5620L = ws_bill_customer_sk#5641L) AND (ws_sold_date_sk#5671L = d_date_sk#5672L))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5620L,c_customer_id#5621,c_current_cdemo_sk#5622L,c_current_hdemo_sk#5623L,c_current_addr_sk#5624L,c_first_shipto_date_sk#5625L,c_first_sales_date_sk#5626L,c_salutation#5627,c_first_name#5628,c_last_name#5629,c_preferred_cust_flag#5630,c_birth_day#5631,c_birth_month#5632,c_birth_year#5633,c_birth_country#5634,c_login#5635,c_email_address#5636,c_last_review_date#5637] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#5638L,ws_ship_date_sk#5639L,ws_item_sk#5640L,ws_bill_customer_sk#5641L,ws_bill_cdemo_sk#5642L,ws_bill_hdemo_sk#5643L,ws_bill_addr_sk#5644L,ws_ship_customer_sk#5645L,ws_ship_cdemo_sk#5646L,ws_ship_hdemo_sk#5647L,ws_ship_addr_sk#5648L,ws_web_page_sk#5649L,ws_web_site_sk#5650L,ws_ship_mode_sk#5651L,ws_warehouse_sk#5652L,ws_promo_sk#5653L,ws_order_number#5654L,ws_quantity#5655,ws_wholesale_cost#5656,ws_list_price#5657,ws_sales_price#5658,ws_ext_discount_amt#5659,ws_ext_sales_price#5660,ws_ext_wholesale_cost#5661,... 10 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5672L,d_date_id#5673,d_date#5674,d_month_seq#5675,d_week_seq#5676,d_quarter_seq#5677,d_year#5678,d_dow#5679,d_moy#5680,d_dom#5681,d_qoy#5682,d_fy_year#5683,d_fy_quarter_seq#5684,d_fy_week_seq#5685,d_day_name#5686,d_quarter_name#5687,d_holiday#5688,d_weekend#5689,d_following_holiday#5690,d_first_dom#5691,d_last_dom#5692,d_same_day_ly#5693,d_same_day_lq#5694,d_current_day#5695,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [c_preferred_cust_flag#5705 ASC NULLS FIRST], true
         +- Project [c_preferred_cust_flag#5705]
            +- Filter (((((customer_id#5702 = customer_id#5533) AND (customer_id#5533 = customer_id#5722)) AND ((customer_id#5533 = customer_id#5712) AND (sale_type#5541 = s))) AND (((sale_type#5721 = w) AND (sale_type#5711 = s)) AND (sale_type#5731 = w))) AND ((((dyear#5539 = 2001) AND (dyear#5709 = (2001 + 1))) AND ((dyear#5719 = 2001) AND (dyear#5729 = (2001 + 1)))) AND (((year_total#5540 > cast(0 as double)) AND (year_total#5720 > cast(0 as double))) AND (CASE WHEN (year_total#5720 > cast(0 as double)) THEN (year_total#5730 / year_total#5720) ELSE cast(null as double) END > CASE WHEN (year_total#5540 > cast(0 as double)) THEN (year_total#5710 / year_total#5540) ELSE cast(null as double) END))))
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- SubqueryAlias t_s_firstyear
                  :  :  :  +- SubqueryAlias year_total
                  :  :  :     +- CTERelationRef 7, true, [customer_id#5533, customer_first_name#5534, customer_last_name#5535, c_preferred_cust_flag#5561, customer_birth_country#5536, customer_login#5537, customer_email_address#5538, dyear#5539, year_total#5540, sale_type#5541]
                  :  :  +- SubqueryAlias t_s_secyear
                  :  :     +- SubqueryAlias year_total
                  :  :        +- CTERelationRef 7, true, [customer_id#5702, customer_first_name#5703, customer_last_name#5704, c_preferred_cust_flag#5705, customer_birth_country#5706, customer_login#5707, customer_email_address#5708, dyear#5709, year_total#5710, sale_type#5711]
                  :  +- SubqueryAlias t_w_firstyear
                  :     +- SubqueryAlias year_total
                  :        +- CTERelationRef 7, true, [customer_id#5712, customer_first_name#5713, customer_last_name#5714, c_preferred_cust_flag#5715, customer_birth_country#5716, customer_login#5717, customer_email_address#5718, dyear#5719, year_total#5720, sale_type#5721]
                  +- SubqueryAlias t_w_secyear
                     +- SubqueryAlias year_total
                        +- CTERelationRef 7, true, [customer_id#5722, customer_first_name#5723, customer_last_name#5724, c_preferred_cust_flag#5725, customer_birth_country#5726, customer_login#5727, customer_email_address#5728, dyear#5729, year_total#5730, sale_type#5731]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_preferred_cust_flag#5743 ASC NULLS FIRST], true
      +- Project [c_preferred_cust_flag#5743]
         +- Join Inner, ((customer_id#5533 = customer_id#5722) AND (CASE WHEN (year_total#6047 > 0.0) THEN (year_total#5730 / year_total#6047) END > CASE WHEN (year_total#5540 > 0.0) THEN (year_total#5710 / year_total#5540) END))
            :- Project [customer_id#5533, year_total#5540, c_preferred_cust_flag#5743, year_total#5710, year_total#6047]
            :  +- Join Inner, (customer_id#5533 = customer_id#6040)
            :     :- Project [customer_id#5533, year_total#5540, c_preferred_cust_flag#5743, year_total#5710]
            :     :  +- Join Inner, (customer_id#5702 = customer_id#5533)
            :     :     :- Filter (isnotnull(year_total#5540) AND (year_total#5540 > 0.0))
            :     :     :  +- Aggregate [c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567], [c_customer_id#5552 AS customer_id#5533, sum((ss_ext_list_price#5585 - ss_ext_discount_amt#5582)) AS year_total#5540]
            :     :     :     +- Project [c_customer_id#5552, c_first_name#5559, c_last_name#5560, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567, ss_ext_discount_amt#5582, ss_ext_list_price#5585, d_year#5598]
            :     :     :        +- Join Inner, (c_customer_sk#5551L = ss_customer_sk#5571L)
            :     :     :           :- Project [ss_customer_sk#5571L, ss_ext_discount_amt#5582, ss_ext_list_price#5585, d_year#5598]
            :     :     :           :  +- Join Inner, (ss_sold_date_sk#5591L = d_date_sk#5592L)
            :     :     :           :     :- Project [ss_customer_sk#5571L, ss_ext_discount_amt#5582, ss_ext_list_price#5585, ss_sold_date_sk#5591L]
            :     :     :           :     :  +- Filter ((isnotnull(ss_customer_sk#5571L) AND isnotnull(ss_sold_date_sk#5591L)) AND dynamicpruning#6237 [ss_sold_date_sk#5591L])
            :     :     :           :     :     :  +- Project [d_date_sk#5592L, d_year#5598]
            :     :     :           :     :     :     +- Filter ((isnotnull(d_year#5598) AND (d_year#5598 = 2001)) AND isnotnull(d_date_sk#5592L))
            :     :     :           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5592L,d_date_id#5593,d_date#5594,d_month_seq#5595,d_week_seq#5596,d_quarter_seq#5597,d_year#5598,d_dow#5599,d_moy#5600,d_dom#5601,d_qoy#5602,d_fy_year#5603,d_fy_quarter_seq#5604,d_fy_week_seq#5605,d_day_name#5606,d_quarter_name#5607,d_holiday#5608,d_weekend#5609,d_following_holiday#5610,d_first_dom#5611,d_last_dom#5612,d_same_day_ly#5613,d_same_day_lq#5614,d_current_day#5615,... 4 more fields] orc
            :     :     :           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5569L,ss_item_sk#5570L,ss_customer_sk#5571L,ss_cdemo_sk#5572L,ss_hdemo_sk#5573L,ss_addr_sk#5574L,ss_store_sk#5575L,ss_promo_sk#5576L,ss_ticket_number#5577L,ss_quantity#5578,ss_wholesale_cost#5579,ss_list_price#5580,ss_sales_price#5581,ss_ext_discount_amt#5582,ss_ext_sales_price#5583,ss_ext_wholesale_cost#5584,ss_ext_list_price#5585,ss_ext_tax#5586,ss_coupon_amt#5587,ss_net_paid#5588,ss_net_paid_inc_tax#5589,ss_net_profit#5590,ss_sold_date_sk#5591L] orc
            :     :     :           :     +- Project [d_date_sk#5592L, d_year#5598]
            :     :     :           :        +- Filter ((isnotnull(d_year#5598) AND (d_year#5598 = 2001)) AND isnotnull(d_date_sk#5592L))
            :     :     :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5592L,d_date_id#5593,d_date#5594,d_month_seq#5595,d_week_seq#5596,d_quarter_seq#5597,d_year#5598,d_dow#5599,d_moy#5600,d_dom#5601,d_qoy#5602,d_fy_year#5603,d_fy_quarter_seq#5604,d_fy_week_seq#5605,d_day_name#5606,d_quarter_name#5607,d_holiday#5608,d_weekend#5609,d_following_holiday#5610,d_first_dom#5611,d_last_dom#5612,d_same_day_ly#5613,d_same_day_lq#5614,d_current_day#5615,... 4 more fields] orc
            :     :     :           +- Project [c_customer_sk#5551L, c_customer_id#5552, c_first_name#5559, c_last_name#5560, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567]
            :     :     :              +- Filter (isnotnull(c_customer_sk#5551L) AND isnotnull(c_customer_id#5552))
            :     :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5551L,c_customer_id#5552,c_current_cdemo_sk#5553L,c_current_hdemo_sk#5554L,c_current_addr_sk#5555L,c_first_shipto_date_sk#5556L,c_first_sales_date_sk#5557L,c_salutation#5558,c_first_name#5559,c_last_name#5560,c_preferred_cust_flag#5561,c_birth_day#5562,c_birth_month#5563,c_birth_year#5564,c_birth_country#5565,c_login#5566,c_email_address#5567,c_last_review_date#5568] orc
            :     :     +- Aggregate [c_customer_id#5734, c_first_name#5741, c_last_name#5742, d_year#5780, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749], [c_customer_id#5734 AS customer_id#5702, c_preferred_cust_flag#5743, sum((ss_ext_list_price#5767 - ss_ext_discount_amt#5764)) AS year_total#5710]
            :     :        +- Project [c_customer_id#5734, c_first_name#5741, c_last_name#5742, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749, ss_ext_discount_amt#5764, ss_ext_list_price#5767, d_year#5780]
            :     :           +- Join Inner, (c_customer_sk#5733L = ss_customer_sk#5753L)
            :     :              :- Project [ss_customer_sk#5753L, ss_ext_discount_amt#5764, ss_ext_list_price#5767, d_year#5780]
            :     :              :  +- Join Inner, (ss_sold_date_sk#5773L = d_date_sk#5774L)
            :     :              :     :- Project [ss_customer_sk#5753L, ss_ext_discount_amt#5764, ss_ext_list_price#5767, ss_sold_date_sk#5773L]
            :     :              :     :  +- Filter ((isnotnull(ss_customer_sk#5753L) AND isnotnull(ss_sold_date_sk#5773L)) AND dynamicpruning#6238 [ss_sold_date_sk#5773L])
            :     :              :     :     :  +- Project [d_date_sk#5774L, d_year#5780]
            :     :              :     :     :     +- Filter ((isnotnull(d_year#5780) AND (d_year#5780 = 2002)) AND isnotnull(d_date_sk#5774L))
            :     :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5774L,d_date_id#5775,d_date#5776,d_month_seq#5777,d_week_seq#5778,d_quarter_seq#5779,d_year#5780,d_dow#5781,d_moy#5782,d_dom#5783,d_qoy#5784,d_fy_year#5785,d_fy_quarter_seq#5786,d_fy_week_seq#5787,d_day_name#5788,d_quarter_name#5789,d_holiday#5790,d_weekend#5791,d_following_holiday#5792,d_first_dom#5793,d_last_dom#5794,d_same_day_ly#5795,d_same_day_lq#5796,d_current_day#5797,... 4 more fields] orc
            :     :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#5751L,ss_item_sk#5752L,ss_customer_sk#5753L,ss_cdemo_sk#5754L,ss_hdemo_sk#5755L,ss_addr_sk#5756L,ss_store_sk#5757L,ss_promo_sk#5758L,ss_ticket_number#5759L,ss_quantity#5760,ss_wholesale_cost#5761,ss_list_price#5762,ss_sales_price#5763,ss_ext_discount_amt#5764,ss_ext_sales_price#5765,ss_ext_wholesale_cost#5766,ss_ext_list_price#5767,ss_ext_tax#5768,ss_coupon_amt#5769,ss_net_paid#5770,ss_net_paid_inc_tax#5771,ss_net_profit#5772,ss_sold_date_sk#5773L] orc
            :     :              :     +- Project [d_date_sk#5774L, d_year#5780]
            :     :              :        +- Filter ((isnotnull(d_year#5780) AND (d_year#5780 = 2002)) AND isnotnull(d_date_sk#5774L))
            :     :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5774L,d_date_id#5775,d_date#5776,d_month_seq#5777,d_week_seq#5778,d_quarter_seq#5779,d_year#5780,d_dow#5781,d_moy#5782,d_dom#5783,d_qoy#5784,d_fy_year#5785,d_fy_quarter_seq#5786,d_fy_week_seq#5787,d_day_name#5788,d_quarter_name#5789,d_holiday#5790,d_weekend#5791,d_following_holiday#5792,d_first_dom#5793,d_last_dom#5794,d_same_day_ly#5795,d_same_day_lq#5796,d_current_day#5797,... 4 more fields] orc
            :     :              +- Project [c_customer_sk#5733L, c_customer_id#5734, c_first_name#5741, c_last_name#5742, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749]
            :     :                 +- Filter (isnotnull(c_customer_sk#5733L) AND isnotnull(c_customer_id#5734))
            :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5733L,c_customer_id#5734,c_current_cdemo_sk#5735L,c_current_hdemo_sk#5736L,c_current_addr_sk#5737L,c_first_shipto_date_sk#5738L,c_first_sales_date_sk#5739L,c_salutation#5740,c_first_name#5741,c_last_name#5742,c_preferred_cust_flag#5743,c_birth_day#5744,c_birth_month#5745,c_birth_year#5746,c_birth_country#5747,c_login#5748,c_email_address#5749,c_last_review_date#5750] orc
            :     +- Project [customer_id#5542 AS customer_id#6040, year_total#5549 AS year_total#6047]
            :        +- Filter (isnotnull(year_total#5549) AND (year_total#5549 > 0.0))
            :           +- Aggregate [c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, d_year#6018], [c_customer_id#5961 AS customer_id#5542, sum((ws_ext_list_price#6002 - ws_ext_discount_amt#5999)) AS year_total#5549]
            :              +- Project [c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, ws_ext_discount_amt#5999, ws_ext_list_price#6002, d_year#6018]
            :                 +- Join Inner, (c_customer_sk#5960L = ws_bill_customer_sk#5981L)
            :                    :- Project [ws_bill_customer_sk#5981L, ws_ext_discount_amt#5999, ws_ext_list_price#6002, d_year#6018]
            :                    :  +- Join Inner, (ws_sold_date_sk#6011L = d_date_sk#6012L)
            :                    :     :- Project [ws_bill_customer_sk#5981L, ws_ext_discount_amt#5999, ws_ext_list_price#6002, ws_sold_date_sk#6011L]
            :                    :     :  +- Filter ((isnotnull(ws_bill_customer_sk#5981L) AND isnotnull(ws_sold_date_sk#6011L)) AND dynamicpruning#6239 [ws_sold_date_sk#6011L])
            :                    :     :     :  +- Project [d_date_sk#6012L, d_year#6018]
            :                    :     :     :     +- Filter ((isnotnull(d_year#6018) AND (d_year#6018 = 2001)) AND isnotnull(d_date_sk#6012L))
            :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6012L,d_date_id#6013,d_date#6014,d_month_seq#6015,d_week_seq#6016,d_quarter_seq#6017,d_year#6018,d_dow#6019,d_moy#6020,d_dom#6021,d_qoy#6022,d_fy_year#6023,d_fy_quarter_seq#6024,d_fy_week_seq#6025,d_day_name#6026,d_quarter_name#6027,d_holiday#6028,d_weekend#6029,d_following_holiday#6030,d_first_dom#6031,d_last_dom#6032,d_same_day_ly#6033,d_same_day_lq#6034,d_current_day#6035,... 4 more fields] orc
            :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#5978L,ws_ship_date_sk#5979L,ws_item_sk#5980L,ws_bill_customer_sk#5981L,ws_bill_cdemo_sk#5982L,ws_bill_hdemo_sk#5983L,ws_bill_addr_sk#5984L,ws_ship_customer_sk#5985L,ws_ship_cdemo_sk#5986L,ws_ship_hdemo_sk#5987L,ws_ship_addr_sk#5988L,ws_web_page_sk#5989L,ws_web_site_sk#5990L,ws_ship_mode_sk#5991L,ws_warehouse_sk#5992L,ws_promo_sk#5993L,ws_order_number#5994L,ws_quantity#5995,ws_wholesale_cost#5996,ws_list_price#5997,ws_sales_price#5998,ws_ext_discount_amt#5999,ws_ext_sales_price#6000,ws_ext_wholesale_cost#6001,... 10 more fields] orc
            :                    :     +- Project [d_date_sk#6012L, d_year#6018]
            :                    :        +- Filter ((isnotnull(d_year#6018) AND (d_year#6018 = 2001)) AND isnotnull(d_date_sk#6012L))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6012L,d_date_id#6013,d_date#6014,d_month_seq#6015,d_week_seq#6016,d_quarter_seq#6017,d_year#6018,d_dow#6019,d_moy#6020,d_dom#6021,d_qoy#6022,d_fy_year#6023,d_fy_quarter_seq#6024,d_fy_week_seq#6025,d_day_name#6026,d_quarter_name#6027,d_holiday#6028,d_weekend#6029,d_following_holiday#6030,d_first_dom#6031,d_last_dom#6032,d_same_day_ly#6033,d_same_day_lq#6034,d_current_day#6035,... 4 more fields] orc
            :                    +- Project [c_customer_sk#5960L, c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976]
            :                       +- Filter (isnotnull(c_customer_sk#5960L) AND isnotnull(c_customer_id#5961))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5960L,c_customer_id#5961,c_current_cdemo_sk#5962L,c_current_hdemo_sk#5963L,c_current_addr_sk#5964L,c_first_shipto_date_sk#5965L,c_first_sales_date_sk#5966L,c_salutation#5967,c_first_name#5968,c_last_name#5969,c_preferred_cust_flag#5970,c_birth_day#5971,c_birth_month#5972,c_birth_year#5973,c_birth_country#5974,c_login#5975,c_email_address#5976,c_last_review_date#5977] orc
            +- Aggregate [c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, d_year#6176], [c_customer_id#6119 AS customer_id#5722, sum((ws_ext_list_price#6160 - ws_ext_discount_amt#6157)) AS year_total#5730]
               +- Project [c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, ws_ext_discount_amt#6157, ws_ext_list_price#6160, d_year#6176]
                  +- Join Inner, (c_customer_sk#6118L = ws_bill_customer_sk#6139L)
                     :- Project [ws_bill_customer_sk#6139L, ws_ext_discount_amt#6157, ws_ext_list_price#6160, d_year#6176]
                     :  +- Join Inner, (ws_sold_date_sk#6169L = d_date_sk#6170L)
                     :     :- Project [ws_bill_customer_sk#6139L, ws_ext_discount_amt#6157, ws_ext_list_price#6160, ws_sold_date_sk#6169L]
                     :     :  +- Filter ((isnotnull(ws_bill_customer_sk#6139L) AND isnotnull(ws_sold_date_sk#6169L)) AND dynamicpruning#6240 [ws_sold_date_sk#6169L])
                     :     :     :  +- Project [d_date_sk#6170L, d_year#6176]
                     :     :     :     +- Filter ((isnotnull(d_year#6176) AND (d_year#6176 = 2002)) AND isnotnull(d_date_sk#6170L))
                     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6170L,d_date_id#6171,d_date#6172,d_month_seq#6173,d_week_seq#6174,d_quarter_seq#6175,d_year#6176,d_dow#6177,d_moy#6178,d_dom#6179,d_qoy#6180,d_fy_year#6181,d_fy_quarter_seq#6182,d_fy_week_seq#6183,d_day_name#6184,d_quarter_name#6185,d_holiday#6186,d_weekend#6187,d_following_holiday#6188,d_first_dom#6189,d_last_dom#6190,d_same_day_ly#6191,d_same_day_lq#6192,d_current_day#6193,... 4 more fields] orc
                     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6136L,ws_ship_date_sk#6137L,ws_item_sk#6138L,ws_bill_customer_sk#6139L,ws_bill_cdemo_sk#6140L,ws_bill_hdemo_sk#6141L,ws_bill_addr_sk#6142L,ws_ship_customer_sk#6143L,ws_ship_cdemo_sk#6144L,ws_ship_hdemo_sk#6145L,ws_ship_addr_sk#6146L,ws_web_page_sk#6147L,ws_web_site_sk#6148L,ws_ship_mode_sk#6149L,ws_warehouse_sk#6150L,ws_promo_sk#6151L,ws_order_number#6152L,ws_quantity#6153,ws_wholesale_cost#6154,ws_list_price#6155,ws_sales_price#6156,ws_ext_discount_amt#6157,ws_ext_sales_price#6158,ws_ext_wholesale_cost#6159,... 10 more fields] orc
                     :     +- Project [d_date_sk#6170L, d_year#6176]
                     :        +- Filter ((isnotnull(d_year#6176) AND (d_year#6176 = 2002)) AND isnotnull(d_date_sk#6170L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6170L,d_date_id#6171,d_date#6172,d_month_seq#6173,d_week_seq#6174,d_quarter_seq#6175,d_year#6176,d_dow#6177,d_moy#6178,d_dom#6179,d_qoy#6180,d_fy_year#6181,d_fy_quarter_seq#6182,d_fy_week_seq#6183,d_day_name#6184,d_quarter_name#6185,d_holiday#6186,d_weekend#6187,d_following_holiday#6188,d_first_dom#6189,d_last_dom#6190,d_same_day_ly#6191,d_same_day_lq#6192,d_current_day#6193,... 4 more fields] orc
                     +- Project [c_customer_sk#6118L, c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134]
                        +- Filter (isnotnull(c_customer_sk#6118L) AND isnotnull(c_customer_id#6119))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#6118L,c_customer_id#6119,c_current_cdemo_sk#6120L,c_current_hdemo_sk#6121L,c_current_addr_sk#6122L,c_first_shipto_date_sk#6123L,c_first_sales_date_sk#6124L,c_salutation#6125,c_first_name#6126,c_last_name#6127,c_preferred_cust_flag#6128,c_birth_day#6129,c_birth_month#6130,c_birth_year#6131,c_birth_country#6132,c_login#6133,c_email_address#6134,c_last_review_date#6135] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_preferred_cust_flag#5743 ASC NULLS FIRST], output=[c_preferred_cust_flag#5743])
   +- Project [c_preferred_cust_flag#5743]
      +- SortMergeJoin [customer_id#5533], [customer_id#5722], Inner, (CASE WHEN (year_total#6047 > 0.0) THEN (year_total#5730 / year_total#6047) END > CASE WHEN (year_total#5540 > 0.0) THEN (year_total#5710 / year_total#5540) END)
         :- Project [customer_id#5533, year_total#5540, c_preferred_cust_flag#5743, year_total#5710, year_total#6047]
         :  +- SortMergeJoin [customer_id#5533], [customer_id#6040], Inner
         :     :- Project [customer_id#5533, year_total#5540, c_preferred_cust_flag#5743, year_total#5710]
         :     :  +- SortMergeJoin [customer_id#5533], [customer_id#5702], Inner
         :     :     :- Sort [customer_id#5533 ASC NULLS FIRST], false, 0
         :     :     :  +- Exchange hashpartitioning(customer_id#5533, 3000), ENSURE_REQUIREMENTS, [id=#3710]
         :     :     :     +- Filter (isnotnull(year_total#5540) AND (year_total#5540 > 0.0))
         :     :     :        +- HashAggregate(keys=[c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567], functions=[sum((ss_ext_list_price#5585 - ss_ext_discount_amt#5582))], output=[customer_id#5533, year_total#5540])
         :     :     :           +- Exchange hashpartitioning(c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567, 3000), ENSURE_REQUIREMENTS, [id=#3690]
         :     :     :              +- HashAggregate(keys=[c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567], functions=[partial_sum((ss_ext_list_price#5585 - ss_ext_discount_amt#5582))], output=[c_customer_id#5552, c_first_name#5559, c_last_name#5560, d_year#5598, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567, sum#6242])
         :     :     :                 +- Project [c_customer_id#5552, c_first_name#5559, c_last_name#5560, c_preferred_cust_flag#5561, c_birth_country#5565, c_login#5566, c_email_address#5567, ss_ext_discount_amt#5582, ss_ext_list_price#5585, d_year#5598]
         :     :     :                    +- SortMergeJoin [ss_customer_sk#5571L], [c_customer_sk#5551L], Inner
         :     :     :                       :- Sort [ss_customer_sk#5571L ASC NULLS FIRST], false, 0
         :     :     :                       :  +- Exchange hashpartitioning(ss_customer_sk#5571L, 3000), ENSURE_REQUIREMENTS, [id=#3682]
         :     :     :                       :     +- Project [ss_customer_sk#5571L, ss_ext_discount_amt#5582, ss_ext_list_price#5585, d_year#5598]
         :     :     :                       :        +- BroadcastHashJoin [ss_sold_date_sk#5591L], [d_date_sk#5592L], Inner, BuildRight, false
         :     :     :                       :           :- Filter isnotnull(ss_customer_sk#5571L)
         :     :     :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#5571L,ss_ext_discount_amt#5582,ss_ext_list_price#5585,ss_sold_date_sk#5591L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#5571L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#5591L), dynamicpruningexpression(ss_sold_date_sk#5591L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_ext_discount_amt:double,ss_ext_list_price:double>
         :     :     :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#6237, 0, true, Project [d_date_sk#5592L, d_year#5598], [d_date_sk#5592L]
         :     :     :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :     :                       :           :              +- Filter ((isnotnull(d_year#5598) AND (d_year#5598 = 2001)) AND isnotnull(d_date_sk#5592L))
         :     :     :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5592L,d_year#5598] Batched: true, DataFilters: [isnotnull(d_year#5598), (d_year#5598 = 2001), isnotnull(d_date_sk#5592L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#3677]
         :     :     :                       :              +- Filter ((isnotnull(d_year#5598) AND (d_year#5598 = 2001)) AND isnotnull(d_date_sk#5592L))
         :     :     :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5592L,d_year#5598] Batched: true, DataFilters: [isnotnull(d_year#5598), (d_year#5598 = 2001), isnotnull(d_date_sk#5592L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :     :                       +- Sort [c_customer_sk#5551L ASC NULLS FIRST], false, 0
         :     :     :                          +- Exchange hashpartitioning(c_customer_sk#5551L, 3000), ENSURE_REQUIREMENTS, [id=#3683]
         :     :     :                             +- Filter (isnotnull(c_customer_sk#5551L) AND isnotnull(c_customer_id#5552))
         :     :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5551L,c_customer_id#5552,c_first_name#5559,c_last_name#5560,c_preferred_cust_flag#5561,c_birth_country#5565,c_login#5566,c_email_address#5567] Batched: true, DataFilters: [isnotnull(c_customer_sk#5551L), isnotnull(c_customer_id#5552)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     :     +- Sort [customer_id#5702 ASC NULLS FIRST], false, 0
         :     :        +- Exchange hashpartitioning(customer_id#5702, 3000), ENSURE_REQUIREMENTS, [id=#3711]
         :     :           +- HashAggregate(keys=[c_customer_id#5734, c_first_name#5741, c_last_name#5742, d_year#5780, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749], functions=[sum((ss_ext_list_price#5767 - ss_ext_discount_amt#5764))], output=[customer_id#5702, c_preferred_cust_flag#5743, year_total#5710])
         :     :              +- Exchange hashpartitioning(c_customer_id#5734, c_first_name#5741, c_last_name#5742, d_year#5780, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749, 3000), ENSURE_REQUIREMENTS, [id=#3706]
         :     :                 +- HashAggregate(keys=[c_customer_id#5734, c_first_name#5741, c_last_name#5742, d_year#5780, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749], functions=[partial_sum((ss_ext_list_price#5767 - ss_ext_discount_amt#5764))], output=[c_customer_id#5734, c_first_name#5741, c_last_name#5742, d_year#5780, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749, sum#6244])
         :     :                    +- Project [c_customer_id#5734, c_first_name#5741, c_last_name#5742, c_preferred_cust_flag#5743, c_birth_country#5747, c_login#5748, c_email_address#5749, ss_ext_discount_amt#5764, ss_ext_list_price#5767, d_year#5780]
         :     :                       +- SortMergeJoin [ss_customer_sk#5753L], [c_customer_sk#5733L], Inner
         :     :                          :- Sort [ss_customer_sk#5753L ASC NULLS FIRST], false, 0
         :     :                          :  +- Exchange hashpartitioning(ss_customer_sk#5753L, 3000), ENSURE_REQUIREMENTS, [id=#3698]
         :     :                          :     +- Project [ss_customer_sk#5753L, ss_ext_discount_amt#5764, ss_ext_list_price#5767, d_year#5780]
         :     :                          :        +- BroadcastHashJoin [ss_sold_date_sk#5773L], [d_date_sk#5774L], Inner, BuildRight, false
         :     :                          :           :- Filter isnotnull(ss_customer_sk#5753L)
         :     :                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#5753L,ss_ext_discount_amt#5764,ss_ext_list_price#5767,ss_sold_date_sk#5773L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#5753L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#5773L), dynamicpruningexpression(ss_sold_date_sk#5773L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_ext_discount_amt:double,ss_ext_list_price:double>
         :     :                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#6238, 0, true, Project [d_date_sk#5774L, d_year#5780], [d_date_sk#5774L]
         :     :                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                          :           :              +- Filter ((isnotnull(d_year#5780) AND (d_year#5780 = 2002)) AND isnotnull(d_date_sk#5774L))
         :     :                          :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5774L,d_year#5780] Batched: true, DataFilters: [isnotnull(d_year#5780), (d_year#5780 = 2002), isnotnull(d_date_sk#5774L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#3693]
         :     :                          :              +- Filter ((isnotnull(d_year#5780) AND (d_year#5780 = 2002)) AND isnotnull(d_date_sk#5774L))
         :     :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#5774L,d_year#5780] Batched: true, DataFilters: [isnotnull(d_year#5780), (d_year#5780 = 2002), isnotnull(d_date_sk#5774L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                          +- Sort [c_customer_sk#5733L ASC NULLS FIRST], false, 0
         :     :                             +- Exchange hashpartitioning(c_customer_sk#5733L, 3000), ENSURE_REQUIREMENTS, [id=#3699]
         :     :                                +- Filter (isnotnull(c_customer_sk#5733L) AND isnotnull(c_customer_id#5734))
         :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5733L,c_customer_id#5734,c_first_name#5741,c_last_name#5742,c_preferred_cust_flag#5743,c_birth_country#5747,c_login#5748,c_email_address#5749] Batched: true, DataFilters: [isnotnull(c_customer_sk#5733L), isnotnull(c_customer_id#5734)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         :     +- Sort [customer_id#6040 ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(customer_id#6040, 3000), ENSURE_REQUIREMENTS, [id=#3735]
         :           +- Project [customer_id#5542 AS customer_id#6040, year_total#5549 AS year_total#6047]
         :              +- Filter (isnotnull(year_total#5549) AND (year_total#5549 > 0.0))
         :                 +- HashAggregate(keys=[c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, d_year#6018], functions=[sum((ws_ext_list_price#6002 - ws_ext_discount_amt#5999))], output=[customer_id#5542, year_total#5549])
         :                    +- Exchange hashpartitioning(c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, d_year#6018, 3000), ENSURE_REQUIREMENTS, [id=#3729]
         :                       +- HashAggregate(keys=[c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, d_year#6018], functions=[partial_sum((ws_ext_list_price#6002 - ws_ext_discount_amt#5999))], output=[c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, d_year#6018, sum#6246])
         :                          +- Project [c_customer_id#5961, c_first_name#5968, c_last_name#5969, c_preferred_cust_flag#5970, c_birth_country#5974, c_login#5975, c_email_address#5976, ws_ext_discount_amt#5999, ws_ext_list_price#6002, d_year#6018]
         :                             +- SortMergeJoin [ws_bill_customer_sk#5981L], [c_customer_sk#5960L], Inner
         :                                :- Sort [ws_bill_customer_sk#5981L ASC NULLS FIRST], false, 0
         :                                :  +- Exchange hashpartitioning(ws_bill_customer_sk#5981L, 3000), ENSURE_REQUIREMENTS, [id=#3721]
         :                                :     +- Project [ws_bill_customer_sk#5981L, ws_ext_discount_amt#5999, ws_ext_list_price#6002, d_year#6018]
         :                                :        +- BroadcastHashJoin [ws_sold_date_sk#6011L], [d_date_sk#6012L], Inner, BuildRight, false
         :                                :           :- Filter isnotnull(ws_bill_customer_sk#5981L)
         :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#5981L,ws_ext_discount_amt#5999,ws_ext_list_price#6002,ws_sold_date_sk#6011L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#5981L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6011L), dynamicpruningexpression(ws_sold_date_sk#6011L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_ext_discount_amt:double,ws_ext_list_price:double>
         :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#6239, 0, true, Project [d_date_sk#6012L, d_year#6018], [d_date_sk#6012L]
         :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                :           :              +- Filter ((isnotnull(d_year#6018) AND (d_year#6018 = 2001)) AND isnotnull(d_date_sk#6012L))
         :                                :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6012L,d_year#6018] Batched: true, DataFilters: [isnotnull(d_year#6018), (d_year#6018 = 2001), isnotnull(d_date_sk#6012L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#3716]
         :                                :              +- Filter ((isnotnull(d_year#6018) AND (d_year#6018 = 2001)) AND isnotnull(d_date_sk#6012L))
         :                                :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6012L,d_year#6018] Batched: true, DataFilters: [isnotnull(d_year#6018), (d_year#6018 = 2001), isnotnull(d_date_sk#6012L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                +- Sort [c_customer_sk#5960L ASC NULLS FIRST], false, 0
         :                                   +- Exchange hashpartitioning(c_customer_sk#5960L, 3000), ENSURE_REQUIREMENTS, [id=#3722]
         :                                      +- Filter (isnotnull(c_customer_sk#5960L) AND isnotnull(c_customer_id#5961))
         :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#5960L,c_customer_id#5961,c_first_name#5968,c_last_name#5969,c_preferred_cust_flag#5970,c_birth_country#5974,c_login#5975,c_email_address#5976] Batched: true, DataFilters: [isnotnull(c_customer_sk#5960L), isnotnull(c_customer_id#5961)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...
         +- Sort [customer_id#5722 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(customer_id#5722, 3000), ENSURE_REQUIREMENTS, [id=#3756]
               +- HashAggregate(keys=[c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, d_year#6176], functions=[sum((ws_ext_list_price#6160 - ws_ext_discount_amt#6157))], output=[customer_id#5722, year_total#5730])
                  +- Exchange hashpartitioning(c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, d_year#6176, 3000), ENSURE_REQUIREMENTS, [id=#3752]
                     +- HashAggregate(keys=[c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, d_year#6176], functions=[partial_sum((ws_ext_list_price#6160 - ws_ext_discount_amt#6157))], output=[c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, d_year#6176, sum#6248])
                        +- Project [c_customer_id#6119, c_first_name#6126, c_last_name#6127, c_preferred_cust_flag#6128, c_birth_country#6132, c_login#6133, c_email_address#6134, ws_ext_discount_amt#6157, ws_ext_list_price#6160, d_year#6176]
                           +- SortMergeJoin [ws_bill_customer_sk#6139L], [c_customer_sk#6118L], Inner
                              :- Sort [ws_bill_customer_sk#6139L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_bill_customer_sk#6139L, 3000), ENSURE_REQUIREMENTS, [id=#3744]
                              :     +- Project [ws_bill_customer_sk#6139L, ws_ext_discount_amt#6157, ws_ext_list_price#6160, d_year#6176]
                              :        +- BroadcastHashJoin [ws_sold_date_sk#6169L], [d_date_sk#6170L], Inner, BuildRight, false
                              :           :- Filter isnotnull(ws_bill_customer_sk#6139L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#6139L,ws_ext_discount_amt#6157,ws_ext_list_price#6160,ws_sold_date_sk#6169L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#6139L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6169L), dynamicpruningexpression(ws_sold_date_sk#6169L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_ext_discount_amt:double,ws_ext_list_price:double>
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#6240, 0, true, Project [d_date_sk#6170L, d_year#6176], [d_date_sk#6170L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Filter ((isnotnull(d_year#6176) AND (d_year#6176 = 2002)) AND isnotnull(d_date_sk#6170L))
                              :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6170L,d_year#6176] Batched: true, DataFilters: [isnotnull(d_year#6176), (d_year#6176 = 2002), isnotnull(d_date_sk#6170L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#3739]
                              :              +- Filter ((isnotnull(d_year#6176) AND (d_year#6176 = 2002)) AND isnotnull(d_date_sk#6170L))
                              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6170L,d_year#6176] Batched: true, DataFilters: [isnotnull(d_year#6176), (d_year#6176 = 2002), isnotnull(d_date_sk#6170L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              +- Sort [c_customer_sk#6118L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(c_customer_sk#6118L, 3000), ENSURE_REQUIREMENTS, [id=#3745]
                                    +- Filter (isnotnull(c_customer_sk#6118L) AND isnotnull(c_customer_id#6119))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#6118L,c_customer_id#6119,c_first_name#6126,c_last_name#6127,c_preferred_cust_flag#6128,c_birth_country#6132,c_login#6133,c_email_address#6134] Batched: true, DataFilters: [isnotnull(c_customer_sk#6118L), isnotnull(c_customer_id#6119)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferr...

read query: spark_queries/q12.sql
explain query: q12
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('ws_ext_sales_price) AS itemrevenue#6249, (('sum('ws_ext_sales_price) * 100) / 'sum('sum('ws_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#6250]
         +- 'Filter ((('ws_item_sk = 'i_item_sk) AND 'i_category IN (Sports,Books,Home)) AND (('ws_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(2001-01-12 as date)) AND ('d_date <= (cast(2001-01-12 as date) + INTERVAL '30' DAY)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [web_sales], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
i_item_desc: string, i_category: string, i_class: string, i_current_price: double, itemrevenue: double, revenueratio: double
GlobalLimit 100
+- LocalLimit 100
   +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, revenueratio#6250]
      +- Sort [i_category#6297 ASC NULLS FIRST, i_class#6295 ASC NULLS FIRST, i_item_id#6286 ASC NULLS FIRST, i_item_desc#6289 ASC NULLS FIRST, revenueratio#6250 ASC NULLS FIRST], true
         +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, revenueratio#6250, i_item_id#6286]
            +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, _w0#6339, _w1#6340, _we0#6341, ((_w0#6339 * cast(100 as double)) / _we0#6341) AS revenueratio#6250, i_item_id#6286]
               +- Window [sum(_w1#6340) windowspecdefinition(i_class#6295, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#6341], [i_class#6295]
                  +- Aggregate [i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290], [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, sum(ws_ext_sales_price#6273) AS itemrevenue#6249, sum(ws_ext_sales_price#6273) AS _w0#6339, sum(ws_ext_sales_price#6273) AS _w1#6340, i_item_id#6286]
                     +- Filter (((ws_item_sk#6253L = i_item_sk#6285L) AND i_category#6297 IN (Sports,Books,Home)) AND ((ws_sold_date_sk#6284L = d_date_sk#6307L) AND ((d_date#6309 >= cast(2001-01-12 as date)) AND (d_date#6309 <= date_add(cast(2001-01-12 as date), extractansiintervaldays(INTERVAL '30' DAY))))))
                        +- Join Inner
                           :- Join Inner
                           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6251L,ws_ship_date_sk#6252L,ws_item_sk#6253L,ws_bill_customer_sk#6254L,ws_bill_cdemo_sk#6255L,ws_bill_hdemo_sk#6256L,ws_bill_addr_sk#6257L,ws_ship_customer_sk#6258L,ws_ship_cdemo_sk#6259L,ws_ship_hdemo_sk#6260L,ws_ship_addr_sk#6261L,ws_web_page_sk#6262L,ws_web_site_sk#6263L,ws_ship_mode_sk#6264L,ws_warehouse_sk#6265L,ws_promo_sk#6266L,ws_order_number#6267L,ws_quantity#6268,ws_wholesale_cost#6269,ws_list_price#6270,ws_sales_price#6271,ws_ext_discount_amt#6272,ws_ext_sales_price#6273,ws_ext_wholesale_cost#6274,... 10 more fields] orc
                           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6285L,i_item_id#6286,i_rec_start_date#6287,i_rec_end_date#6288,i_item_desc#6289,i_current_price#6290,i_wholesale_cost#6291,i_brand_id#6292,i_brand#6293,i_class_id#6294,i_class#6295,i_category_id#6296,i_category#6297,i_manufact_id#6298,i_manufact#6299,i_size#6300,i_formulation#6301,i_color#6302,i_units#6303,i_container#6304,i_manager_id#6305,i_product_name#6306] orc
                           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6307L,d_date_id#6308,d_date#6309,d_month_seq#6310,d_week_seq#6311,d_quarter_seq#6312,d_year#6313,d_dow#6314,d_moy#6315,d_dom#6316,d_qoy#6317,d_fy_year#6318,d_fy_quarter_seq#6319,d_fy_week_seq#6320,d_day_name#6321,d_quarter_name#6322,d_holiday#6323,d_weekend#6324,d_following_holiday#6325,d_first_dom#6326,d_last_dom#6327,d_same_day_ly#6328,d_same_day_lq#6329,d_current_day#6330,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, revenueratio#6250]
      +- Sort [i_category#6297 ASC NULLS FIRST, i_class#6295 ASC NULLS FIRST, i_item_id#6286 ASC NULLS FIRST, i_item_desc#6289 ASC NULLS FIRST, revenueratio#6250 ASC NULLS FIRST], true
         +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, ((_w0#6339 * 100.0) / _we0#6341) AS revenueratio#6250, i_item_id#6286]
            +- Window [sum(_w1#6340) windowspecdefinition(i_class#6295, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#6341], [i_class#6295]
               +- Aggregate [i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290], [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, sum(ws_ext_sales_price#6273) AS itemrevenue#6249, sum(ws_ext_sales_price#6273) AS _w0#6339, sum(ws_ext_sales_price#6273) AS _w1#6340, i_item_id#6286]
                  +- Project [ws_ext_sales_price#6273, i_item_id#6286, i_item_desc#6289, i_current_price#6290, i_class#6295, i_category#6297]
                     +- Join Inner, (ws_item_sk#6253L = i_item_sk#6285L)
                        :- Project [ws_item_sk#6253L, ws_ext_sales_price#6273]
                        :  +- Join Inner, (ws_sold_date_sk#6284L = d_date_sk#6307L)
                        :     :- Project [ws_item_sk#6253L, ws_ext_sales_price#6273, ws_sold_date_sk#6284L]
                        :     :  +- Filter ((isnotnull(ws_item_sk#6253L) AND isnotnull(ws_sold_date_sk#6284L)) AND dynamicpruning#6348 [ws_sold_date_sk#6284L])
                        :     :     :  +- Project [d_date_sk#6307L]
                        :     :     :     +- Filter ((isnotnull(d_date#6309) AND ((d_date#6309 >= 2001-01-12) AND (d_date#6309 <= 2001-02-11))) AND isnotnull(d_date_sk#6307L))
                        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6307L,d_date_id#6308,d_date#6309,d_month_seq#6310,d_week_seq#6311,d_quarter_seq#6312,d_year#6313,d_dow#6314,d_moy#6315,d_dom#6316,d_qoy#6317,d_fy_year#6318,d_fy_quarter_seq#6319,d_fy_week_seq#6320,d_day_name#6321,d_quarter_name#6322,d_holiday#6323,d_weekend#6324,d_following_holiday#6325,d_first_dom#6326,d_last_dom#6327,d_same_day_ly#6328,d_same_day_lq#6329,d_current_day#6330,... 4 more fields] orc
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6251L,ws_ship_date_sk#6252L,ws_item_sk#6253L,ws_bill_customer_sk#6254L,ws_bill_cdemo_sk#6255L,ws_bill_hdemo_sk#6256L,ws_bill_addr_sk#6257L,ws_ship_customer_sk#6258L,ws_ship_cdemo_sk#6259L,ws_ship_hdemo_sk#6260L,ws_ship_addr_sk#6261L,ws_web_page_sk#6262L,ws_web_site_sk#6263L,ws_ship_mode_sk#6264L,ws_warehouse_sk#6265L,ws_promo_sk#6266L,ws_order_number#6267L,ws_quantity#6268,ws_wholesale_cost#6269,ws_list_price#6270,ws_sales_price#6271,ws_ext_discount_amt#6272,ws_ext_sales_price#6273,ws_ext_wholesale_cost#6274,... 10 more fields] orc
                        :     +- Project [d_date_sk#6307L]
                        :        +- Filter ((isnotnull(d_date#6309) AND ((d_date#6309 >= 2001-01-12) AND (d_date#6309 <= 2001-02-11))) AND isnotnull(d_date_sk#6307L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6307L,d_date_id#6308,d_date#6309,d_month_seq#6310,d_week_seq#6311,d_quarter_seq#6312,d_year#6313,d_dow#6314,d_moy#6315,d_dom#6316,d_qoy#6317,d_fy_year#6318,d_fy_quarter_seq#6319,d_fy_week_seq#6320,d_day_name#6321,d_quarter_name#6322,d_holiday#6323,d_weekend#6324,d_following_holiday#6325,d_first_dom#6326,d_last_dom#6327,d_same_day_ly#6328,d_same_day_lq#6329,d_current_day#6330,... 4 more fields] orc
                        +- Project [i_item_sk#6285L, i_item_id#6286, i_item_desc#6289, i_current_price#6290, i_class#6295, i_category#6297]
                           +- Filter (i_category#6297 IN (Sports,Books,Home) AND isnotnull(i_item_sk#6285L))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6285L,i_item_id#6286,i_rec_start_date#6287,i_rec_end_date#6288,i_item_desc#6289,i_current_price#6290,i_wholesale_cost#6291,i_brand_id#6292,i_brand#6293,i_class_id#6294,i_class#6295,i_category_id#6296,i_category#6297,i_manufact_id#6298,i_manufact#6299,i_size#6300,i_formulation#6301,i_color#6302,i_units#6303,i_container#6304,i_manager_id#6305,i_product_name#6306] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_category#6297 ASC NULLS FIRST,i_class#6295 ASC NULLS FIRST,i_item_id#6286 ASC NULLS FIRST,i_item_desc#6289 ASC NULLS FIRST,revenueratio#6250 ASC NULLS FIRST], output=[i_item_desc#6289,i_category#6297,i_class#6295,i_current_price#6290,itemrevenue#6249,revenueratio#6250])
   +- Project [i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, ((_w0#6339 * 100.0) / _we0#6341) AS revenueratio#6250, i_item_id#6286]
      +- Window [sum(_w1#6340) windowspecdefinition(i_class#6295, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#6341], [i_class#6295]
         +- Sort [i_class#6295 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_class#6295, 3000), ENSURE_REQUIREMENTS, [id=#3862]
               +- HashAggregate(keys=[i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290], functions=[sum(ws_ext_sales_price#6273)], output=[i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, itemrevenue#6249, _w0#6339, _w1#6340, i_item_id#6286])
                  +- Exchange hashpartitioning(i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, 3000), ENSURE_REQUIREMENTS, [id=#3859]
                     +- HashAggregate(keys=[i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, knownfloatingpointnormalized(normalizenanandzero(i_current_price#6290)) AS i_current_price#6290], functions=[partial_sum(ws_ext_sales_price#6273)], output=[i_item_id#6286, i_item_desc#6289, i_category#6297, i_class#6295, i_current_price#6290, sum#6350])
                        +- Project [ws_ext_sales_price#6273, i_item_id#6286, i_item_desc#6289, i_current_price#6290, i_class#6295, i_category#6297]
                           +- SortMergeJoin [ws_item_sk#6253L], [i_item_sk#6285L], Inner
                              :- Sort [ws_item_sk#6253L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_item_sk#6253L, 3000), ENSURE_REQUIREMENTS, [id=#3851]
                              :     +- Project [ws_item_sk#6253L, ws_ext_sales_price#6273]
                              :        +- BroadcastHashJoin [ws_sold_date_sk#6284L], [d_date_sk#6307L], Inner, BuildRight, false
                              :           :- Filter isnotnull(ws_item_sk#6253L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6253L,ws_ext_sales_price#6273,ws_sold_date_sk#6284L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6253L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6284L), dynamicpruningexpression(ws_sold_date_sk#6284L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_ext_sales_price:double>
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#6348, 0, true, Project [d_date_sk#6307L], [d_date_sk#6307L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Project [d_date_sk#6307L]
                              :           :                 +- Filter (((isnotnull(d_date#6309) AND (d_date#6309 >= 2001-01-12)) AND (d_date#6309 <= 2001-02-11)) AND isnotnull(d_date_sk#6307L))
                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6307L,d_date#6309] Batched: true, DataFilters: [isnotnull(d_date#6309), (d_date#6309 >= 2001-01-12), (d_date#6309 <= 2001-02-11), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#3846]
                              :              +- Project [d_date_sk#6307L]
                              :                 +- Filter (((isnotnull(d_date#6309) AND (d_date#6309 >= 2001-01-12)) AND (d_date#6309 <= 2001-02-11)) AND isnotnull(d_date_sk#6307L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6307L,d_date#6309] Batched: true, DataFilters: [isnotnull(d_date#6309), (d_date#6309 >= 2001-01-12), (d_date#6309 <= 2001-02-11), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              +- Sort [i_item_sk#6285L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(i_item_sk#6285L, 3000), ENSURE_REQUIREMENTS, [id=#3852]
                                    +- Filter (i_category#6297 IN (Sports,Books,Home) AND isnotnull(i_item_sk#6285L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6285L,i_item_id#6286,i_item_desc#6289,i_current_price#6290,i_class#6295,i_category#6297] Batched: true, DataFilters: [i_category#6297 IN (Sports,Books,Home), isnotnull(i_item_sk#6285L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_category, [Books,Home,Sports]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string,i_current_price:double,i_class:string...

read query: spark_queries/q13.sql
explain query: q13
== Parsed Logical Plan ==
'Project [unresolvedalias('avg('ss_quantity), None), unresolvedalias('avg('ss_ext_sales_price), None), unresolvedalias('avg('ss_ext_wholesale_cost), None), unresolvedalias('sum('ss_ext_wholesale_cost), None)]
+- 'Filter (((('s_store_sk = 'ss_store_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('d_year = 2001)) AND ((((((('ss_hdemo_sk = 'hd_demo_sk) AND ('cd_demo_sk = 'ss_cdemo_sk)) AND ('cd_marital_status = M)) AND ((('cd_education_status = 4 yr Degree) AND (('ss_sales_price >= 100.00) AND ('ss_sales_price <= 150.00))) AND ('hd_dep_count = 3))) OR (((('ss_hdemo_sk = 'hd_demo_sk) AND ('cd_demo_sk = 'ss_cdemo_sk)) AND ('cd_marital_status = D)) AND ((('cd_education_status = Primary) AND (('ss_sales_price >= 50.00) AND ('ss_sales_price <= 100.00))) AND ('hd_dep_count = 1)))) OR (((('ss_hdemo_sk = 'hd_demo_sk) AND ('cd_demo_sk = 'ss_cdemo_sk)) AND ('cd_marital_status = U)) AND ((('cd_education_status = Advanced Degree) AND (('ss_sales_price >= 150.00) AND ('ss_sales_price <= 200.00))) AND ('hd_dep_count = 1)))) AND ((((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (KY,GA,NM) AND (('ss_net_profit >= 100) AND ('ss_net_profit <= 200)))) OR ((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (MT,OR,IN) AND (('ss_net_profit >= 150) AND ('ss_net_profit <= 300))))) OR ((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (WI,MO,WV) AND (('ss_net_profit >= 50) AND ('ss_net_profit <= 250)))))))
   +- 'Join Inner
      :- 'Join Inner
      :  :- 'Join Inner
      :  :  :- 'Join Inner
      :  :  :  :- 'Join Inner
      :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
      :  :  :  :  +- 'UnresolvedRelation [store], [], false
      :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
      :  :  +- 'UnresolvedRelation [household_demographics], [], false
      :  +- 'UnresolvedRelation [customer_address], [], false
      +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
avg(ss_quantity): double, avg(ss_ext_sales_price): double, avg(ss_ext_wholesale_cost): double, sum(ss_ext_wholesale_cost): double
Aggregate [avg(ss_quantity#6360) AS avg(ss_quantity)#6462, avg(ss_ext_sales_price#6365) AS avg(ss_ext_sales_price)#6463, avg(ss_ext_wholesale_cost#6366) AS avg(ss_ext_wholesale_cost)#6464, sum(ss_ext_wholesale_cost#6366) AS sum(ss_ext_wholesale_cost)#6465]
+- Filter ((((s_store_sk#6374L = ss_store_sk#6357L) AND (ss_sold_date_sk#6373L = d_date_sk#6430L)) AND (d_year#6436 = 2001)) AND (((((((ss_hdemo_sk#6355L = hd_demo_sk#6412L) AND (cd_demo_sk#6403L = ss_cdemo_sk#6354L)) AND (cd_marital_status#6405 = M)) AND (((cd_education_status#6406 = 4 yr Degree) AND ((ss_sales_price#6363 >= cast(100.00 as double)) AND (ss_sales_price#6363 <= cast(150.00 as double)))) AND (hd_dep_count#6415 = 3))) OR ((((ss_hdemo_sk#6355L = hd_demo_sk#6412L) AND (cd_demo_sk#6403L = ss_cdemo_sk#6354L)) AND (cd_marital_status#6405 = D)) AND (((cd_education_status#6406 = Primary) AND ((ss_sales_price#6363 >= cast(50.00 as double)) AND (ss_sales_price#6363 <= cast(100.00 as double)))) AND (hd_dep_count#6415 = 1)))) OR ((((ss_hdemo_sk#6355L = hd_demo_sk#6412L) AND (cd_demo_sk#6403L = ss_cdemo_sk#6354L)) AND (cd_marital_status#6405 = U)) AND (((cd_education_status#6406 = Advanced Degree) AND ((ss_sales_price#6363 >= cast(150.00 as double)) AND (ss_sales_price#6363 <= cast(200.00 as double)))) AND (hd_dep_count#6415 = 1)))) AND (((((ss_addr_sk#6356L = ca_address_sk#6417L) AND (ca_country#6427 = United States)) AND (ca_state#6425 IN (KY,GA,NM) AND ((ss_net_profit#6372 >= cast(100 as double)) AND (ss_net_profit#6372 <= cast(200 as double))))) OR (((ss_addr_sk#6356L = ca_address_sk#6417L) AND (ca_country#6427 = United States)) AND (ca_state#6425 IN (MT,OR,IN) AND ((ss_net_profit#6372 >= cast(150 as double)) AND (ss_net_profit#6372 <= cast(300 as double)))))) OR (((ss_addr_sk#6356L = ca_address_sk#6417L) AND (ca_country#6427 = United States)) AND (ca_state#6425 IN (WI,MO,WV) AND ((ss_net_profit#6372 >= cast(50 as double)) AND (ss_net_profit#6372 <= cast(250 as double))))))))
   +- Join Inner
      :- Join Inner
      :  :- Join Inner
      :  :  :- Join Inner
      :  :  :  :- Join Inner
      :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
      :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6351L,ss_item_sk#6352L,ss_customer_sk#6353L,ss_cdemo_sk#6354L,ss_hdemo_sk#6355L,ss_addr_sk#6356L,ss_store_sk#6357L,ss_promo_sk#6358L,ss_ticket_number#6359L,ss_quantity#6360,ss_wholesale_cost#6361,ss_list_price#6362,ss_sales_price#6363,ss_ext_discount_amt#6364,ss_ext_sales_price#6365,ss_ext_wholesale_cost#6366,ss_ext_list_price#6367,ss_ext_tax#6368,ss_coupon_amt#6369,ss_net_paid#6370,ss_net_paid_inc_tax#6371,ss_net_profit#6372,ss_sold_date_sk#6373L] orc
      :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
      :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#6374L,s_store_id#6375,s_rec_start_date#6376,s_rec_end_date#6377,s_closed_date_sk#6378L,s_store_name#6379,s_number_employees#6380,s_floor_space#6381,s_hours#6382,s_manager#6383,s_market_id#6384,s_geography_class#6385,s_market_desc#6386,s_market_manager#6387,s_division_id#6388,s_division_name#6389,s_company_id#6390,s_company_name#6391,s_street_number#6392,s_street_name#6393,s_street_type#6394,s_suite_number#6395,s_city#6396,s_county#6397,... 5 more fields] orc
      :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
      :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#6403L,cd_gender#6404,cd_marital_status#6405,cd_education_status#6406,cd_purchase_estimate#6407,cd_credit_rating#6408,cd_dep_count#6409,cd_dep_employed_count#6410,cd_dep_college_count#6411] orc
      :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
      :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#6412L,hd_income_band_sk#6413L,hd_buy_potential#6414,hd_dep_count#6415,hd_vehicle_count#6416] orc
      :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
      :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#6417L,ca_address_id#6418,ca_street_number#6419,ca_street_name#6420,ca_street_type#6421,ca_suite_number#6422,ca_city#6423,ca_county#6424,ca_state#6425,ca_zip#6426,ca_country#6427,ca_gmt_offset#6428,ca_location_type#6429] orc
      +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6430L,d_date_id#6431,d_date#6432,d_month_seq#6433,d_week_seq#6434,d_quarter_seq#6435,d_year#6436,d_dow#6437,d_moy#6438,d_dom#6439,d_qoy#6440,d_fy_year#6441,d_fy_quarter_seq#6442,d_fy_week_seq#6443,d_day_name#6444,d_quarter_name#6445,d_holiday#6446,d_weekend#6447,d_following_holiday#6448,d_first_dom#6449,d_last_dom#6450,d_same_day_ly#6451,d_same_day_lq#6452,d_current_day#6453,... 4 more fields] orc

== Optimized Logical Plan ==
Aggregate [avg(ss_quantity#6360) AS avg(ss_quantity)#6462, avg(ss_ext_sales_price#6365) AS avg(ss_ext_sales_price)#6463, avg(ss_ext_wholesale_cost#6366) AS avg(ss_ext_wholesale_cost)#6464, sum(ss_ext_wholesale_cost#6366) AS sum(ss_ext_wholesale_cost)#6465]
+- Project [ss_quantity#6360, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
   +- Join Inner, (s_store_sk#6374L = ss_store_sk#6357L)
      :- Project [ss_store_sk#6357L, ss_quantity#6360, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
      :  +- Join Inner, ((((((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) AND (ss_sales_price#6363 >= 100.0)) AND (ss_sales_price#6363 <= 150.0)) OR ((((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary)) AND (ss_sales_price#6363 >= 50.0)) AND (ss_sales_price#6363 <= 100.0))) OR ((((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree)) AND (ss_sales_price#6363 >= 150.0)) AND (ss_sales_price#6363 <= 200.0))) AND (cd_demo_sk#6403L = ss_cdemo_sk#6354L)) AND (((((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) AND (ss_sales_price#6363 >= 100.0)) AND (ss_sales_price#6363 <= 150.0)) AND (hd_dep_count#6415 = 3)) OR (((((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary)) AND (ss_sales_price#6363 >= 50.0)) AND (ss_sales_price#6363 <= 100.0)) AND (hd_dep_count#6415 = 1))) OR (((((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree)) AND (ss_sales_price#6363 >= 150.0)) AND (ss_sales_price#6363 <= 200.0)) AND (hd_dep_count#6415 = 1))))
      :     :- Project [ss_cdemo_sk#6354L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366, hd_dep_count#6415]
      :     :  +- Join Inner, (ss_hdemo_sk#6355L = hd_demo_sk#6412L)
      :     :     :- Project [ss_cdemo_sk#6354L, ss_hdemo_sk#6355L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
      :     :     :  +- Join Inner, (ss_sold_date_sk#6373L = d_date_sk#6430L)
      :     :     :     :- Project [ss_cdemo_sk#6354L, ss_hdemo_sk#6355L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366, ss_sold_date_sk#6373L]
      :     :     :     :  +- Join Inner, ((ss_addr_sk#6356L = ca_address_sk#6417L) AND ((((ca_state#6425 IN (KY,GA,NM) AND (ss_net_profit#6372 >= 100.0)) AND (ss_net_profit#6372 <= 200.0)) OR ((ca_state#6425 IN (MT,OR,IN) AND (ss_net_profit#6372 >= 150.0)) AND (ss_net_profit#6372 <= 300.0))) OR ((ca_state#6425 IN (WI,MO,WV) AND (ss_net_profit#6372 >= 50.0)) AND (ss_net_profit#6372 <= 250.0))))
      :     :     :     :     :- Project [ss_cdemo_sk#6354L, ss_hdemo_sk#6355L, ss_addr_sk#6356L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366, ss_net_profit#6372, ss_sold_date_sk#6373L]
      :     :     :     :     :  +- Filter (((((((isnotnull(ss_store_sk#6357L) AND isnotnull(ss_addr_sk#6356L)) AND isnotnull(ss_sold_date_sk#6373L)) AND isnotnull(ss_cdemo_sk#6354L)) AND isnotnull(ss_hdemo_sk#6355L)) AND ((((ss_net_profit#6372 >= 100.0) AND (ss_net_profit#6372 <= 200.0)) OR ((ss_net_profit#6372 >= 150.0) AND (ss_net_profit#6372 <= 300.0))) OR ((ss_net_profit#6372 >= 50.0) AND (ss_net_profit#6372 <= 250.0)))) AND ((((ss_sales_price#6363 >= 100.0) AND (ss_sales_price#6363 <= 150.0)) OR ((ss_sales_price#6363 >= 50.0) AND (ss_sales_price#6363 <= 100.0))) OR ((ss_sales_price#6363 >= 150.0) AND (ss_sales_price#6363 <= 200.0)))) AND dynamicpruning#6470 [ss_sold_date_sk#6373L])
      :     :     :     :     :     :  +- Project [d_date_sk#6430L]
      :     :     :     :     :     :     +- Filter ((isnotnull(d_year#6436) AND (d_year#6436 = 2001)) AND isnotnull(d_date_sk#6430L))
      :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6430L,d_date_id#6431,d_date#6432,d_month_seq#6433,d_week_seq#6434,d_quarter_seq#6435,d_year#6436,d_dow#6437,d_moy#6438,d_dom#6439,d_qoy#6440,d_fy_year#6441,d_fy_quarter_seq#6442,d_fy_week_seq#6443,d_day_name#6444,d_quarter_name#6445,d_holiday#6446,d_weekend#6447,d_following_holiday#6448,d_first_dom#6449,d_last_dom#6450,d_same_day_ly#6451,d_same_day_lq#6452,d_current_day#6453,... 4 more fields] orc
      :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6351L,ss_item_sk#6352L,ss_customer_sk#6353L,ss_cdemo_sk#6354L,ss_hdemo_sk#6355L,ss_addr_sk#6356L,ss_store_sk#6357L,ss_promo_sk#6358L,ss_ticket_number#6359L,ss_quantity#6360,ss_wholesale_cost#6361,ss_list_price#6362,ss_sales_price#6363,ss_ext_discount_amt#6364,ss_ext_sales_price#6365,ss_ext_wholesale_cost#6366,ss_ext_list_price#6367,ss_ext_tax#6368,ss_coupon_amt#6369,ss_net_paid#6370,ss_net_paid_inc_tax#6371,ss_net_profit#6372,ss_sold_date_sk#6373L] orc
      :     :     :     :     +- Project [ca_address_sk#6417L, ca_state#6425]
      :     :     :     :        +- Filter (((isnotnull(ca_country#6427) AND (ca_country#6427 = United States)) AND isnotnull(ca_address_sk#6417L)) AND ((ca_state#6425 IN (KY,GA,NM) OR ca_state#6425 IN (MT,OR,IN)) OR ca_state#6425 IN (WI,MO,WV)))
      :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#6417L,ca_address_id#6418,ca_street_number#6419,ca_street_name#6420,ca_street_type#6421,ca_suite_number#6422,ca_city#6423,ca_county#6424,ca_state#6425,ca_zip#6426,ca_country#6427,ca_gmt_offset#6428,ca_location_type#6429] orc
      :     :     :     +- Project [d_date_sk#6430L]
      :     :     :        +- Filter ((isnotnull(d_year#6436) AND (d_year#6436 = 2001)) AND isnotnull(d_date_sk#6430L))
      :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6430L,d_date_id#6431,d_date#6432,d_month_seq#6433,d_week_seq#6434,d_quarter_seq#6435,d_year#6436,d_dow#6437,d_moy#6438,d_dom#6439,d_qoy#6440,d_fy_year#6441,d_fy_quarter_seq#6442,d_fy_week_seq#6443,d_day_name#6444,d_quarter_name#6445,d_holiday#6446,d_weekend#6447,d_following_holiday#6448,d_first_dom#6449,d_last_dom#6450,d_same_day_ly#6451,d_same_day_lq#6452,d_current_day#6453,... 4 more fields] orc
      :     :     +- Project [hd_demo_sk#6412L, hd_dep_count#6415]
      :     :        +- Filter (isnotnull(hd_demo_sk#6412L) AND (((hd_dep_count#6415 = 3) OR (hd_dep_count#6415 = 1)) OR (hd_dep_count#6415 = 1)))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#6412L,hd_income_band_sk#6413L,hd_buy_potential#6414,hd_dep_count#6415,hd_vehicle_count#6416] orc
      :     +- Project [cd_demo_sk#6403L, cd_marital_status#6405, cd_education_status#6406]
      :        +- Filter (isnotnull(cd_demo_sk#6403L) AND ((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) OR ((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary))) OR ((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree))))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#6403L,cd_gender#6404,cd_marital_status#6405,cd_education_status#6406,cd_purchase_estimate#6407,cd_credit_rating#6408,cd_dep_count#6409,cd_dep_employed_count#6410,cd_dep_college_count#6411] orc
      +- Project [s_store_sk#6374L]
         +- Filter isnotnull(s_store_sk#6374L)
            +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#6374L,s_store_id#6375,s_rec_start_date#6376,s_rec_end_date#6377,s_closed_date_sk#6378L,s_store_name#6379,s_number_employees#6380,s_floor_space#6381,s_hours#6382,s_manager#6383,s_market_id#6384,s_geography_class#6385,s_market_desc#6386,s_market_manager#6387,s_division_id#6388,s_division_name#6389,s_company_id#6390,s_company_name#6391,s_street_number#6392,s_street_name#6393,s_street_type#6394,s_suite_number#6395,s_city#6396,s_county#6397,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[avg(ss_quantity#6360), avg(ss_ext_sales_price#6365), avg(ss_ext_wholesale_cost#6366), sum(ss_ext_wholesale_cost#6366)], output=[avg(ss_quantity)#6462, avg(ss_ext_sales_price)#6463, avg(ss_ext_wholesale_cost)#6464, sum(ss_ext_wholesale_cost)#6465])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#4020]
      +- HashAggregate(keys=[], functions=[partial_avg(ss_quantity#6360), partial_avg(ss_ext_sales_price#6365), partial_avg(ss_ext_wholesale_cost#6366), partial_sum(ss_ext_wholesale_cost#6366)], output=[sum#6478, count#6479L, sum#6480, count#6481L, sum#6482, count#6483L, sum#6484])
         +- Project [ss_quantity#6360, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
            +- BroadcastHashJoin [ss_store_sk#6357L], [s_store_sk#6374L], Inner, BuildRight, false
               :- Project [ss_store_sk#6357L, ss_quantity#6360, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
               :  +- BroadcastHashJoin [ss_cdemo_sk#6354L], [cd_demo_sk#6403L], Inner, BuildRight, (((((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) AND (ss_sales_price#6363 >= 100.0)) AND (ss_sales_price#6363 <= 150.0)) OR ((((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary)) AND (ss_sales_price#6363 >= 50.0)) AND (ss_sales_price#6363 <= 100.0))) OR ((((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree)) AND (ss_sales_price#6363 >= 150.0)) AND (ss_sales_price#6363 <= 200.0))) AND (((((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) AND (ss_sales_price#6363 >= 100.0)) AND (ss_sales_price#6363 <= 150.0)) AND (hd_dep_count#6415 = 3)) OR (((((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary)) AND (ss_sales_price#6363 >= 50.0)) AND (ss_sales_price#6363 <= 100.0)) AND (hd_dep_count#6415 = 1))) OR (((((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree)) AND (ss_sales_price#6363 >= 150.0)) AND (ss_sales_price#6363 <= 200.0)) AND (hd_dep_count#6415 = 1)))), false
               :     :- Project [ss_cdemo_sk#6354L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366, hd_dep_count#6415]
               :     :  +- BroadcastHashJoin [ss_hdemo_sk#6355L], [hd_demo_sk#6412L], Inner, BuildRight, false
               :     :     :- Project [ss_cdemo_sk#6354L, ss_hdemo_sk#6355L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366]
               :     :     :  +- BroadcastHashJoin [ss_sold_date_sk#6373L], [d_date_sk#6430L], Inner, BuildRight, false
               :     :     :     :- Project [ss_cdemo_sk#6354L, ss_hdemo_sk#6355L, ss_store_sk#6357L, ss_quantity#6360, ss_sales_price#6363, ss_ext_sales_price#6365, ss_ext_wholesale_cost#6366, ss_sold_date_sk#6373L]
               :     :     :     :  +- SortMergeJoin [ss_addr_sk#6356L], [ca_address_sk#6417L], Inner, ((((ca_state#6425 IN (KY,GA,NM) AND (ss_net_profit#6372 >= 100.0)) AND (ss_net_profit#6372 <= 200.0)) OR ((ca_state#6425 IN (MT,OR,IN) AND (ss_net_profit#6372 >= 150.0)) AND (ss_net_profit#6372 <= 300.0))) OR ((ca_state#6425 IN (WI,MO,WV) AND (ss_net_profit#6372 >= 50.0)) AND (ss_net_profit#6372 <= 250.0)))
               :     :     :     :     :- Sort [ss_addr_sk#6356L ASC NULLS FIRST], false, 0
               :     :     :     :     :  +- Exchange hashpartitioning(ss_addr_sk#6356L, 3000), ENSURE_REQUIREMENTS, [id=#3996]
               :     :     :     :     :     +- Filter (((((isnotnull(ss_store_sk#6357L) AND isnotnull(ss_addr_sk#6356L)) AND isnotnull(ss_cdemo_sk#6354L)) AND isnotnull(ss_hdemo_sk#6355L)) AND ((((ss_net_profit#6372 >= 100.0) AND (ss_net_profit#6372 <= 200.0)) OR ((ss_net_profit#6372 >= 150.0) AND (ss_net_profit#6372 <= 300.0))) OR ((ss_net_profit#6372 >= 50.0) AND (ss_net_profit#6372 <= 250.0)))) AND ((((ss_sales_price#6363 >= 100.0) AND (ss_sales_price#6363 <= 150.0)) OR ((ss_sales_price#6363 >= 50.0) AND (ss_sales_price#6363 <= 100.0))) OR ((ss_sales_price#6363 >= 150.0) AND (ss_sales_price#6363 <= 200.0))))
               :     :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_cdemo_sk#6354L,ss_hdemo_sk#6355L,ss_addr_sk#6356L,ss_store_sk#6357L,ss_quantity#6360,ss_sales_price#6363,ss_ext_sales_price#6365,ss_ext_wholesale_cost#6366,ss_net_profit#6372,ss_sold_date_sk#6373L] Batched: true, DataFilters: [isnotnull(ss_store_sk#6357L), isnotnull(ss_addr_sk#6356L), isnotnull(ss_cdemo_sk#6354L), isnotnu..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6373L), dynamicpruningexpression(ss_sold_date_sk#6373L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_cdemo_sk), IsNotNull(ss_hdemo_sk), O..., ReadSchema: struct<ss_cdemo_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:bigint,ss_store_sk:bigint,ss_quantity:int...
               :     :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#6470, 0, true, Project [d_date_sk#6430L], [d_date_sk#6430L]
               :     :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
               :     :     :     :     :                    +- Project [d_date_sk#6430L]
               :     :     :     :     :                       +- Filter ((isnotnull(d_year#6436) AND (d_year#6436 = 2001)) AND isnotnull(d_date_sk#6430L))
               :     :     :     :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6430L,d_year#6436] Batched: true, DataFilters: [isnotnull(d_year#6436), (d_year#6436 = 2001), isnotnull(d_date_sk#6430L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
               :     :     :     :     +- Sort [ca_address_sk#6417L ASC NULLS FIRST], false, 0
               :     :     :     :        +- Exchange hashpartitioning(ca_address_sk#6417L, 3000), ENSURE_REQUIREMENTS, [id=#3997]
               :     :     :     :           +- Project [ca_address_sk#6417L, ca_state#6425]
               :     :     :     :              +- Filter (((isnotnull(ca_country#6427) AND (ca_country#6427 = United States)) AND isnotnull(ca_address_sk#6417L)) AND ((ca_state#6425 IN (KY,GA,NM) OR ca_state#6425 IN (MT,OR,IN)) OR ca_state#6425 IN (WI,MO,WV)))
               :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#6417L,ca_state#6425,ca_country#6427] Batched: true, DataFilters: [isnotnull(ca_country#6427), (ca_country#6427 = United States), isnotnull(ca_address_sk#6417L), (..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk), Or(Or(In(ca_..., ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_country:string>
               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#4003]
               :     :     :        +- Project [d_date_sk#6430L]
               :     :     :           +- Filter ((isnotnull(d_year#6436) AND (d_year#6436 = 2001)) AND isnotnull(d_date_sk#6430L))
               :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6430L,d_year#6436] Batched: true, DataFilters: [isnotnull(d_year#6436), (d_year#6436 = 2001), isnotnull(d_date_sk#6430L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#4007]
               :     :        +- Filter (isnotnull(hd_demo_sk#6412L) AND (((hd_dep_count#6415 = 3) OR (hd_dep_count#6415 = 1)) OR (hd_dep_count#6415 = 1)))
               :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#6412L,hd_dep_count#6415] Batched: true, DataFilters: [isnotnull(hd_demo_sk#6412L), (((hd_dep_count#6415 = 3) OR (hd_dep_count#6415 = 1)) OR (hd_dep_co..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), Or(Or(EqualTo(hd_dep_count,3),EqualTo(hd_dep_count,1)),EqualTo(hd_dep_cou..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int>
               :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#4011]
               :        +- Filter (isnotnull(cd_demo_sk#6403L) AND ((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 yr Degree)) OR ((cd_marital_status#6405 = D) AND (cd_education_status#6406 = Primary))) OR ((cd_marital_status#6405 = U) AND (cd_education_status#6406 = Advanced Degree))))
               :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#6403L,cd_marital_status#6405,cd_education_status#6406] Batched: true, DataFilters: [isnotnull(cd_demo_sk#6403L), ((((cd_marital_status#6405 = M) AND (cd_education_status#6406 = 4 y..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), Or(Or(And(EqualTo(cd_marital_status,M),EqualTo(cd_education_status,4 yr D..., ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string,cd_education_status:string>
               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#4015]
                  +- Filter isnotnull(s_store_sk#6374L)
                     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#6374L] Batched: true, DataFilters: [isnotnull(s_store_sk#6374L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>

read query: spark_queries/q14a.sql
explain query: q14a
== Parsed Logical Plan ==
CTE [cross_items, avg_sales]
:  :- 'SubqueryAlias cross_items
:  :  +- 'Project ['i_item_sk AS ss_item_sk#6503]
:  :     +- 'Filter ((('i_brand_id = 'brand_id) AND ('i_class_id = 'class_id)) AND ('i_category_id = 'category_id))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [item], [], false
:  :           +- 'SubqueryAlias x
:  :              +- 'Intersect false
:  :                 :- 'Intersect false
:  :                 :  :- 'Project ['iss.i_brand_id AS brand_id#6500, 'iss.i_class_id AS class_id#6501, 'iss.i_category_id AS category_id#6502]
:  :                 :  :  +- 'Filter ((('ss_item_sk = 'iss.i_item_sk) AND ('ss_sold_date_sk = 'd1.d_date_sk)) AND (('d1.d_year >= 1999) AND ('d1.d_year <= (1999 + 2))))
:  :                 :  :     +- 'Join Inner
:  :                 :  :        :- 'Join Inner
:  :                 :  :        :  :- 'UnresolvedRelation [store_sales], [], false
:  :                 :  :        :  +- 'SubqueryAlias iss
:  :                 :  :        :     +- 'UnresolvedRelation [item], [], false
:  :                 :  :        +- 'SubqueryAlias d1
:  :                 :  :           +- 'UnresolvedRelation [date_dim], [], false
:  :                 :  +- 'Project ['ics.i_brand_id, 'ics.i_class_id, 'ics.i_category_id]
:  :                 :     +- 'Filter ((('cs_item_sk = 'ics.i_item_sk) AND ('cs_sold_date_sk = 'd2.d_date_sk)) AND (('d2.d_year >= 1999) AND ('d2.d_year <= (1999 + 2))))
:  :                 :        +- 'Join Inner
:  :                 :           :- 'Join Inner
:  :                 :           :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :                 :           :  +- 'SubqueryAlias ics
:  :                 :           :     +- 'UnresolvedRelation [item], [], false
:  :                 :           +- 'SubqueryAlias d2
:  :                 :              +- 'UnresolvedRelation [date_dim], [], false
:  :                 +- 'Project ['iws.i_brand_id, 'iws.i_class_id, 'iws.i_category_id]
:  :                    +- 'Filter ((('ws_item_sk = 'iws.i_item_sk) AND ('ws_sold_date_sk = 'd3.d_date_sk)) AND (('d3.d_year >= 1999) AND ('d3.d_year <= (1999 + 2))))
:  :                       +- 'Join Inner
:  :                          :- 'Join Inner
:  :                          :  :- 'UnresolvedRelation [web_sales], [], false
:  :                          :  +- 'SubqueryAlias iws
:  :                          :     +- 'UnresolvedRelation [item], [], false
:  :                          +- 'SubqueryAlias d3
:  :                             +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias avg_sales
:     +- 'Project ['avg(('quantity * 'list_price)) AS average_sales#6510]
:        +- 'SubqueryAlias x
:           +- 'Union false, false
:              :- 'Union false, false
:              :  :- 'Project ['ss_quantity AS quantity#6504, 'ss_list_price AS list_price#6505]
:              :  :  +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND (('d_year >= 1999) AND ('d_year <= 2001)))
:              :  :     +- 'Join Inner
:              :  :        :- 'UnresolvedRelation [store_sales], [], false
:              :  :        +- 'UnresolvedRelation [date_dim], [], false
:              :  +- 'Project ['cs_quantity AS quantity#6506, 'cs_list_price AS list_price#6507]
:              :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) AND (('d_year >= 1998) AND ('d_year <= (1998 + 2))))
:              :        +- 'Join Inner
:              :           :- 'UnresolvedRelation [catalog_sales], [], false
:              :           +- 'UnresolvedRelation [date_dim], [], false
:              +- 'Project ['ws_quantity AS quantity#6508, 'ws_list_price AS list_price#6509]
:                 +- 'Filter (('ws_sold_date_sk = 'd_date_sk) AND (('d_year >= 1998) AND ('d_year <= (1998 + 2))))
:                    +- 'Join Inner
:                       :- 'UnresolvedRelation [web_sales], [], false
:                       +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['channel ASC NULLS FIRST, 'i_brand_id ASC NULLS FIRST, 'i_class_id ASC NULLS FIRST, 'i_category_id ASC NULLS FIRST], true
         +- 'Aggregate [rollup(Vector(0), Vector(1), Vector(2), Vector(3), 'channel, 'i_brand_id, 'i_class_id, 'i_category_id)], ['channel, 'i_brand_id, 'i_class_id, 'i_category_id, unresolvedalias('sum('sales), None), unresolvedalias('sum('number_sales), None)]
            +- 'SubqueryAlias y
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#6489 [])
                  :  :  :  +- 'Project ['average_sales]
                  :  :  :     +- 'UnresolvedRelation [avg_sales], [], false
                  :  :  +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#6485, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#6486, 'count(1) AS number_sales#6487]
                  :  :     +- 'Filter ((('ss_item_sk IN (list#6488 []) AND ('ss_item_sk = 'i_item_sk)) AND ('ss_sold_date_sk = 'd_date_sk)) AND (('d_year = (1998 + 2)) AND ('d_moy = 11)))
                  :  :        :  +- 'Project ['ss_item_sk]
                  :  :        :     +- 'UnresolvedRelation [cross_items], [], false
                  :  :        +- 'Join Inner
                  :  :           :- 'Join Inner
                  :  :           :  :- 'UnresolvedRelation [store_sales], [], false
                  :  :           :  +- 'UnresolvedRelation [item], [], false
                  :  :           +- 'UnresolvedRelation [date_dim], [], false
                  :  +- 'UnresolvedHaving ('sum(('cs_quantity * 'cs_list_price)) > scalar-subquery#6494 [])
                  :     :  +- 'Project ['average_sales]
                  :     :     +- 'UnresolvedRelation [avg_sales], [], false
                  :     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [catalog AS channel#6490, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('cs_quantity * 'cs_list_price)) AS sales#6491, 'count(1) AS number_sales#6492]
                  :        +- 'Filter ((('cs_item_sk IN (list#6493 []) AND ('cs_item_sk = 'i_item_sk)) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('d_year = (1998 + 2)) AND ('d_moy = 11)))
                  :           :  +- 'Project ['ss_item_sk]
                  :           :     +- 'UnresolvedRelation [cross_items], [], false
                  :           +- 'Join Inner
                  :              :- 'Join Inner
                  :              :  :- 'UnresolvedRelation [catalog_sales], [], false
                  :              :  +- 'UnresolvedRelation [item], [], false
                  :              +- 'UnresolvedRelation [date_dim], [], false
                  +- 'UnresolvedHaving ('sum(('ws_quantity * 'ws_list_price)) > scalar-subquery#6499 [])
                     :  +- 'Project ['average_sales]
                     :     +- 'UnresolvedRelation [avg_sales], [], false
                     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [web AS channel#6495, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ws_quantity * 'ws_list_price)) AS sales#6496, 'count(1) AS number_sales#6497]
                        +- 'Filter ((('ws_item_sk IN (list#6498 []) AND ('ws_item_sk = 'i_item_sk)) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('d_year = (1998 + 2)) AND ('d_moy = 11)))
                           :  +- 'Project ['ss_item_sk]
                           :     +- 'UnresolvedRelation [cross_items], [], false
                           +- 'Join Inner
                              :- 'Join Inner
                              :  :- 'UnresolvedRelation [web_sales], [], false
                              :  +- 'UnresolvedRelation [item], [], false
                              +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
channel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sum(sales): double, sum(number_sales): bigint
WithCTE
:- CTERelationDef 8
:  +- SubqueryAlias cross_items
:     +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
:        +- Filter (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
:              +- SubqueryAlias x
:                 +- Intersect false
:                    :- Intersect false
:                    :  :- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
:                    :  :  +- Filter (((ss_item_sk#6537L = i_item_sk#6559L) AND (ss_sold_date_sk#6558L = d_date_sk#6581L)) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= (1999 + 2))))
:                    :  :     +- Join Inner
:                    :  :        :- Join Inner
:                    :  :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                    :  :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
:                    :  :        :  +- SubqueryAlias iss
:                    :  :        :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    :  :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
:                    :  :        +- SubqueryAlias d1
:                    :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
:                    :  +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
:                    :     +- Filter (((cs_item_sk#6623L = i_item_sk#6643L) AND (cs_sold_date_sk#6642L = d_date_sk#6665L)) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= (1999 + 2))))
:                    :        +- Join Inner
:                    :           :- Join Inner
:                    :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                    :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
:                    :           :  +- SubqueryAlias ics
:                    :           :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
:                    :           +- SubqueryAlias d2
:                    :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
:                    +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
:                       +- Filter (((ws_item_sk#6695L = i_item_sk#6727L) AND (ws_sold_date_sk#6726L = d_date_sk#6749L)) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= (1999 + 2))))
:                          +- Join Inner
:                             :- Join Inner
:                             :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                             :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
:                             :  +- SubqueryAlias iws
:                             :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                             :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
:                             +- SubqueryAlias d3
:                                +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                                   +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
:- CTERelationDef 9
:  +- SubqueryAlias avg_sales
:     +- Aggregate [avg((cast(quantity#6504 as double) * list_price#6505)) AS average_sales#6510]
:        +- SubqueryAlias x
:           +- Union false, false
:              :- Union false, false
:              :  :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
:              :  :  +- Filter ((ss_sold_date_sk#6799L = d_date_sk#6800L) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001)))
:              :  :     +- Join Inner
:              :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6777L,ss_item_sk#6778L,ss_customer_sk#6779L,ss_cdemo_sk#6780L,ss_hdemo_sk#6781L,ss_addr_sk#6782L,ss_store_sk#6783L,ss_promo_sk#6784L,ss_ticket_number#6785L,ss_quantity#6786,ss_wholesale_cost#6787,ss_list_price#6788,ss_sales_price#6789,ss_ext_discount_amt#6790,ss_ext_sales_price#6791,ss_ext_wholesale_cost#6792,ss_ext_list_price#6793,ss_ext_tax#6794,ss_coupon_amt#6795,ss_net_paid#6796,ss_net_paid_inc_tax#6797,ss_net_profit#6798,ss_sold_date_sk#6799L] orc
:              :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
:              :  +- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
:              :     +- Filter ((cs_sold_date_sk#6861L = d_date_sk#6862L) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= (1998 + 2))))
:              :        +- Join Inner
:              :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6828L,cs_ship_date_sk#6829L,cs_bill_customer_sk#6830L,cs_bill_cdemo_sk#6831L,cs_bill_hdemo_sk#6832L,cs_bill_addr_sk#6833L,cs_ship_customer_sk#6834L,cs_ship_cdemo_sk#6835L,cs_ship_hdemo_sk#6836L,cs_ship_addr_sk#6837L,cs_call_center_sk#6838L,cs_catalog_page_sk#6839L,cs_ship_mode_sk#6840L,cs_warehouse_sk#6841L,cs_item_sk#6842L,cs_promo_sk#6843L,cs_order_number#6844L,cs_quantity#6845,cs_wholesale_cost#6846,cs_list_price#6847,cs_sales_price#6848,cs_ext_discount_amt#6849,cs_ext_sales_price#6850,cs_ext_wholesale_cost#6851,... 10 more fields] orc
:              :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
:              +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
:                 +- Filter ((ws_sold_date_sk#6923L = d_date_sk#6924L) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= (1998 + 2))))
:                    +- Join Inner
:                       :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                       :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6890L,ws_ship_date_sk#6891L,ws_item_sk#6892L,ws_bill_customer_sk#6893L,ws_bill_cdemo_sk#6894L,ws_bill_hdemo_sk#6895L,ws_bill_addr_sk#6896L,ws_ship_customer_sk#6897L,ws_ship_cdemo_sk#6898L,ws_ship_hdemo_sk#6899L,ws_ship_addr_sk#6900L,ws_web_page_sk#6901L,ws_web_site_sk#6902L,ws_ship_mode_sk#6903L,ws_warehouse_sk#6904L,ws_promo_sk#6905L,ws_order_number#6906L,ws_quantity#6907,ws_wholesale_cost#6908,ws_list_price#6909,ws_sales_price#6910,ws_ext_discount_amt#6911,ws_ext_sales_price#6912,ws_ext_wholesale_cost#6913,... 10 more fields] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [channel#7218 ASC NULLS FIRST, i_brand_id#7219 ASC NULLS FIRST, i_class_id#7220 ASC NULLS FIRST, i_category_id#7221 ASC NULLS FIRST], true
         +- Aggregate [channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L], [channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, sum(sales#6486) AS sum(sales)#7208, sum(number_sales#6487L) AS sum(number_sales)#7209L]
            +- Expand [[channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#7213, i_brand_id#7214, i_class_id#7215, i_category_id#7216, 0], [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#7213, i_brand_id#7214, i_class_id#7215, null, 1], [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#7213, i_brand_id#7214, null, null, 3], [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#7213, null, null, null, 7], [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, null, null, null, null, 15]], [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L]
               +- Project [channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L, channel#6485 AS channel#7213, i_brand_id#6982 AS i_brand_id#7214, i_class_id#6984 AS i_class_id#7215, i_category_id#6986 AS i_category_id#7216]
                  +- SubqueryAlias y
                     +- Union false, false
                        :- Union false, false
                        :  :- Filter (sales#6486 > scalar-subquery#6489 [])
                        :  :  :  +- Project [average_sales#6510]
                        :  :  :     +- SubqueryAlias avg_sales
                        :  :  :        +- CTERelationRef 9, true, [average_sales#6510]
                        :  :  +- Aggregate [i_brand_id#6982, i_class_id#6984, i_category_id#6986], [store AS channel#6485, i_brand_id#6982, i_class_id#6984, i_category_id#6986, sum((cast(ss_quantity#6961 as double) * ss_list_price#6963)) AS sales#6486, count(1) AS number_sales#6487L]
                        :  :     +- Filter (((ss_item_sk#6953L IN (list#6488 []) AND (ss_item_sk#6953L = i_item_sk#6975L)) AND (ss_sold_date_sk#6974L = d_date_sk#6997L)) AND ((d_year#7003 = (1998 + 2)) AND (d_moy#7005 = 11)))
                        :  :        :  +- Project [ss_item_sk#6503L]
                        :  :        :     +- SubqueryAlias cross_items
                        :  :        :        +- CTERelationRef 8, true, [ss_item_sk#6503L]
                        :  :        +- Join Inner
                        :  :           :- Join Inner
                        :  :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                        :  :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6952L,ss_item_sk#6953L,ss_customer_sk#6954L,ss_cdemo_sk#6955L,ss_hdemo_sk#6956L,ss_addr_sk#6957L,ss_store_sk#6958L,ss_promo_sk#6959L,ss_ticket_number#6960L,ss_quantity#6961,ss_wholesale_cost#6962,ss_list_price#6963,ss_sales_price#6964,ss_ext_discount_amt#6965,ss_ext_sales_price#6966,ss_ext_wholesale_cost#6967,ss_ext_list_price#6968,ss_ext_tax#6969,ss_coupon_amt#6970,ss_net_paid#6971,ss_net_paid_inc_tax#6972,ss_net_profit#6973,ss_sold_date_sk#6974L] orc
                        :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6975L,i_item_id#6976,i_rec_start_date#6977,i_rec_end_date#6978,i_item_desc#6979,i_current_price#6980,i_wholesale_cost#6981,i_brand_id#6982,i_brand#6983,i_class_id#6984,i_class#6985,i_category_id#6986,i_category#6987,i_manufact_id#6988,i_manufact#6989,i_size#6990,i_formulation#6991,i_color#6992,i_units#6993,i_container#6994,i_manager_id#6995,i_product_name#6996] orc
                        :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6997L,d_date_id#6998,d_date#6999,d_month_seq#7000,d_week_seq#7001,d_quarter_seq#7002,d_year#7003,d_dow#7004,d_moy#7005,d_dom#7006,d_qoy#7007,d_fy_year#7008,d_fy_quarter_seq#7009,d_fy_week_seq#7010,d_day_name#7011,d_quarter_name#7012,d_holiday#7013,d_weekend#7014,d_following_holiday#7015,d_first_dom#7016,d_last_dom#7017,d_same_day_ly#7018,d_same_day_lq#7019,d_current_day#7020,... 4 more fields] orc
                        :  +- Filter (sales#6491 > scalar-subquery#6494 [])
                        :     :  +- Project [average_sales#6510]
                        :     :     +- SubqueryAlias avg_sales
                        :     :        +- CTERelationRef 9, true, [average_sales#6510]
                        :     +- Aggregate [i_brand_id#7066, i_class_id#7068, i_category_id#7070], [catalog AS channel#6490, i_brand_id#7066, i_class_id#7068, i_category_id#7070, sum((cast(cs_quantity#7042 as double) * cs_list_price#7044)) AS sales#6491, count(1) AS number_sales#6492L]
                        :        +- Filter (((cs_item_sk#7039L IN (list#6493 []) AND (cs_item_sk#7039L = i_item_sk#7059L)) AND (cs_sold_date_sk#7058L = d_date_sk#7081L)) AND ((d_year#7087 = (1998 + 2)) AND (d_moy#7089 = 11)))
                        :           :  +- Project [ss_item_sk#6503L]
                        :           :     +- SubqueryAlias cross_items
                        :           :        +- CTERelationRef 8, true, [ss_item_sk#6503L]
                        :           +- Join Inner
                        :              :- Join Inner
                        :              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                        :              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7025L,cs_ship_date_sk#7026L,cs_bill_customer_sk#7027L,cs_bill_cdemo_sk#7028L,cs_bill_hdemo_sk#7029L,cs_bill_addr_sk#7030L,cs_ship_customer_sk#7031L,cs_ship_cdemo_sk#7032L,cs_ship_hdemo_sk#7033L,cs_ship_addr_sk#7034L,cs_call_center_sk#7035L,cs_catalog_page_sk#7036L,cs_ship_mode_sk#7037L,cs_warehouse_sk#7038L,cs_item_sk#7039L,cs_promo_sk#7040L,cs_order_number#7041L,cs_quantity#7042,cs_wholesale_cost#7043,cs_list_price#7044,cs_sales_price#7045,cs_ext_discount_amt#7046,cs_ext_sales_price#7047,cs_ext_wholesale_cost#7048,... 10 more fields] orc
                        :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7059L,i_item_id#7060,i_rec_start_date#7061,i_rec_end_date#7062,i_item_desc#7063,i_current_price#7064,i_wholesale_cost#7065,i_brand_id#7066,i_brand#7067,i_class_id#7068,i_class#7069,i_category_id#7070,i_category#7071,i_manufact_id#7072,i_manufact#7073,i_size#7074,i_formulation#7075,i_color#7076,i_units#7077,i_container#7078,i_manager_id#7079,i_product_name#7080] orc
                        :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7081L,d_date_id#7082,d_date#7083,d_month_seq#7084,d_week_seq#7085,d_quarter_seq#7086,d_year#7087,d_dow#7088,d_moy#7089,d_dom#7090,d_qoy#7091,d_fy_year#7092,d_fy_quarter_seq#7093,d_fy_week_seq#7094,d_day_name#7095,d_quarter_name#7096,d_holiday#7097,d_weekend#7098,d_following_holiday#7099,d_first_dom#7100,d_last_dom#7101,d_same_day_ly#7102,d_same_day_lq#7103,d_current_day#7104,... 4 more fields] orc
                        +- Filter (sales#6496 > scalar-subquery#6499 [])
                           :  +- Project [average_sales#6510]
                           :     +- SubqueryAlias avg_sales
                           :        +- CTERelationRef 9, true, [average_sales#6510]
                           +- Aggregate [i_brand_id#7150, i_class_id#7152, i_category_id#7154], [web AS channel#6495, i_brand_id#7150, i_class_id#7152, i_category_id#7154, sum((cast(ws_quantity#7126 as double) * ws_list_price#7128)) AS sales#6496, count(1) AS number_sales#6497L]
                              +- Filter (((ws_item_sk#7111L IN (list#6498 []) AND (ws_item_sk#7111L = i_item_sk#7143L)) AND (ws_sold_date_sk#7142L = d_date_sk#7165L)) AND ((d_year#7171 = (1998 + 2)) AND (d_moy#7173 = 11)))
                                 :  +- Project [ss_item_sk#6503L]
                                 :     +- SubqueryAlias cross_items
                                 :        +- CTERelationRef 8, true, [ss_item_sk#6503L]
                                 +- Join Inner
                                    :- Join Inner
                                    :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                                    :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7109L,ws_ship_date_sk#7110L,ws_item_sk#7111L,ws_bill_customer_sk#7112L,ws_bill_cdemo_sk#7113L,ws_bill_hdemo_sk#7114L,ws_bill_addr_sk#7115L,ws_ship_customer_sk#7116L,ws_ship_cdemo_sk#7117L,ws_ship_hdemo_sk#7118L,ws_ship_addr_sk#7119L,ws_web_page_sk#7120L,ws_web_site_sk#7121L,ws_ship_mode_sk#7122L,ws_warehouse_sk#7123L,ws_promo_sk#7124L,ws_order_number#7125L,ws_quantity#7126,ws_wholesale_cost#7127,ws_list_price#7128,ws_sales_price#7129,ws_ext_discount_amt#7130,ws_ext_sales_price#7131,ws_ext_wholesale_cost#7132,... 10 more fields] orc
                                    :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7143L,i_item_id#7144,i_rec_start_date#7145,i_rec_end_date#7146,i_item_desc#7147,i_current_price#7148,i_wholesale_cost#7149,i_brand_id#7150,i_brand#7151,i_class_id#7152,i_class#7153,i_category_id#7154,i_category#7155,i_manufact_id#7156,i_manufact#7157,i_size#7158,i_formulation#7159,i_color#7160,i_units#7161,i_container#7162,i_manager_id#7163,i_product_name#7164] orc
                                    +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7165L,d_date_id#7166,d_date#7167,d_month_seq#7168,d_week_seq#7169,d_quarter_seq#7170,d_year#7171,d_dow#7172,d_moy#7173,d_dom#7174,d_qoy#7175,d_fy_year#7176,d_fy_quarter_seq#7177,d_fy_week_seq#7178,d_day_name#7179,d_quarter_name#7180,d_holiday#7181,d_weekend#7182,d_following_holiday#7183,d_first_dom#7184,d_last_dom#7185,d_same_day_ly#7186,d_same_day_lq#7187,d_current_day#7188,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#7218 ASC NULLS FIRST, i_brand_id#7219 ASC NULLS FIRST, i_class_id#7220 ASC NULLS FIRST, i_category_id#7221 ASC NULLS FIRST], true
      +- Aggregate [channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L], [channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, sum(sales#6486) AS sum(sales)#7208, sum(number_sales#6487L) AS sum(number_sales)#7209L]
         +- Expand [[sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, i_class_id#6984, i_category_id#6986, 0], [sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, i_class_id#6984, null, 1], [sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, null, null, 3], [sales#6486, number_sales#6487L, channel#7213, null, null, null, 7], [sales#6486, number_sales#6487L, null, null, null, null, 15]], [sales#6486, number_sales#6487L, channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L]
            +- Union false, false
               :- Project [sales#6486, number_sales#6487L, store AS channel#7213, i_brand_id#6982, i_class_id#6984, i_category_id#6986]
               :  +- Filter (isnotnull(sales#6486) AND (sales#6486 > scalar-subquery#6489 []))
               :     :  +- Aggregate [avg((cast(quantity#6504 as double) * list_price#6505)) AS average_sales#6510]
               :     :     +- Union false, false
               :     :        :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
               :     :        :  +- Join Inner, (ss_sold_date_sk#6799L = d_date_sk#6800L)
               :     :        :     :- Project [ss_quantity#6786, ss_list_price#6788, ss_sold_date_sk#6799L]
               :     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#6799L) AND dynamicpruning#7228 [ss_sold_date_sk#6799L])
               :     :        :     :     :  +- Project [d_date_sk#6800L]
               :     :        :     :     :     +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
               :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
               :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6777L,ss_item_sk#6778L,ss_customer_sk#6779L,ss_cdemo_sk#6780L,ss_hdemo_sk#6781L,ss_addr_sk#6782L,ss_store_sk#6783L,ss_promo_sk#6784L,ss_ticket_number#6785L,ss_quantity#6786,ss_wholesale_cost#6787,ss_list_price#6788,ss_sales_price#6789,ss_ext_discount_amt#6790,ss_ext_sales_price#6791,ss_ext_wholesale_cost#6792,ss_ext_list_price#6793,ss_ext_tax#6794,ss_coupon_amt#6795,ss_net_paid#6796,ss_net_paid_inc_tax#6797,ss_net_profit#6798,ss_sold_date_sk#6799L] orc
               :     :        :     +- Project [d_date_sk#6800L]
               :     :        :        +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
               :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
               :     :        :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
               :     :        :  +- Join Inner, (cs_sold_date_sk#6861L = d_date_sk#6862L)
               :     :        :     :- Project [cs_quantity#6845, cs_list_price#6847, cs_sold_date_sk#6861L]
               :     :        :     :  +- Filter (isnotnull(cs_sold_date_sk#6861L) AND dynamicpruning#7229 [cs_sold_date_sk#6861L])
               :     :        :     :     :  +- Project [d_date_sk#6862L]
               :     :        :     :     :     +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
               :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
               :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6828L,cs_ship_date_sk#6829L,cs_bill_customer_sk#6830L,cs_bill_cdemo_sk#6831L,cs_bill_hdemo_sk#6832L,cs_bill_addr_sk#6833L,cs_ship_customer_sk#6834L,cs_ship_cdemo_sk#6835L,cs_ship_hdemo_sk#6836L,cs_ship_addr_sk#6837L,cs_call_center_sk#6838L,cs_catalog_page_sk#6839L,cs_ship_mode_sk#6840L,cs_warehouse_sk#6841L,cs_item_sk#6842L,cs_promo_sk#6843L,cs_order_number#6844L,cs_quantity#6845,cs_wholesale_cost#6846,cs_list_price#6847,cs_sales_price#6848,cs_ext_discount_amt#6849,cs_ext_sales_price#6850,cs_ext_wholesale_cost#6851,... 10 more fields] orc
               :     :        :     +- Project [d_date_sk#6862L]
               :     :        :        +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
               :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
               :     :        +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
               :     :           +- Join Inner, (ws_sold_date_sk#6923L = d_date_sk#6924L)
               :     :              :- Project [ws_quantity#6907, ws_list_price#6909, ws_sold_date_sk#6923L]
               :     :              :  +- Filter (isnotnull(ws_sold_date_sk#6923L) AND dynamicpruning#7230 [ws_sold_date_sk#6923L])
               :     :              :     :  +- Project [d_date_sk#6924L]
               :     :              :     :     +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
               :     :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
               :     :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6890L,ws_ship_date_sk#6891L,ws_item_sk#6892L,ws_bill_customer_sk#6893L,ws_bill_cdemo_sk#6894L,ws_bill_hdemo_sk#6895L,ws_bill_addr_sk#6896L,ws_ship_customer_sk#6897L,ws_ship_cdemo_sk#6898L,ws_ship_hdemo_sk#6899L,ws_ship_addr_sk#6900L,ws_web_page_sk#6901L,ws_web_site_sk#6902L,ws_ship_mode_sk#6903L,ws_warehouse_sk#6904L,ws_promo_sk#6905L,ws_order_number#6906L,ws_quantity#6907,ws_wholesale_cost#6908,ws_list_price#6909,ws_sales_price#6910,ws_ext_discount_amt#6911,ws_ext_sales_price#6912,ws_ext_wholesale_cost#6913,... 10 more fields] orc
               :     :              +- Project [d_date_sk#6924L]
               :     :                 +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
               :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
               :     +- Aggregate [i_brand_id#6982, i_class_id#6984, i_category_id#6986], [i_brand_id#6982, i_class_id#6984, i_category_id#6986, sum((cast(ss_quantity#6961 as double) * ss_list_price#6963)) AS sales#6486, count(1) AS number_sales#6487L]
               :        +- Project [ss_quantity#6961, ss_list_price#6963, i_brand_id#6982, i_class_id#6984, i_category_id#6986]
               :           +- Join Inner, (ss_item_sk#6953L = i_item_sk#6975L)
               :              :- Project [ss_item_sk#6953L, ss_quantity#6961, ss_list_price#6963]
               :              :  +- Join Inner, (ss_sold_date_sk#6974L = d_date_sk#6997L)
               :              :     :- Join LeftSemi, (ss_item_sk#6953L = ss_item_sk#6503L)
               :              :     :  :- Project [ss_item_sk#6953L, ss_quantity#6961, ss_list_price#6963, ss_sold_date_sk#6974L]
               :              :     :  :  +- Filter ((isnotnull(ss_item_sk#6953L) AND isnotnull(ss_sold_date_sk#6974L)) AND dynamicpruning#7257 [ss_sold_date_sk#6974L])
               :              :     :  :     :  +- Project [d_date_sk#6997L]
               :              :     :  :     :     +- Filter (((isnotnull(d_year#7003) AND isnotnull(d_moy#7005)) AND ((d_year#7003 = 2000) AND (d_moy#7005 = 11))) AND isnotnull(d_date_sk#6997L))
               :              :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6997L,d_date_id#6998,d_date#6999,d_month_seq#7000,d_week_seq#7001,d_quarter_seq#7002,d_year#7003,d_dow#7004,d_moy#7005,d_dom#7006,d_qoy#7007,d_fy_year#7008,d_fy_quarter_seq#7009,d_fy_week_seq#7010,d_day_name#7011,d_quarter_name#7012,d_holiday#7013,d_weekend#7014,d_following_holiday#7015,d_first_dom#7016,d_last_dom#7017,d_same_day_ly#7018,d_same_day_lq#7019,d_current_day#7020,... 4 more fields] orc
               :              :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6952L,ss_item_sk#6953L,ss_customer_sk#6954L,ss_cdemo_sk#6955L,ss_hdemo_sk#6956L,ss_addr_sk#6957L,ss_store_sk#6958L,ss_promo_sk#6959L,ss_ticket_number#6960L,ss_quantity#6961,ss_wholesale_cost#6962,ss_list_price#6963,ss_sales_price#6964,ss_ext_discount_amt#6965,ss_ext_sales_price#6966,ss_ext_wholesale_cost#6967,ss_ext_list_price#6968,ss_ext_tax#6969,ss_coupon_amt#6970,ss_net_paid#6971,ss_net_paid_inc_tax#6972,ss_net_profit#6973,ss_sold_date_sk#6974L] orc
               :              :     :  +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
               :              :     :     +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
               :              :     :        :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
               :              :     :        :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
               :              :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
               :              :     :        +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :              :     :           +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
               :              :     :              :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :              :     :              :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
               :              :     :              :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
               :              :     :              :        :- Project [ss_item_sk#6537L]
               :              :     :              :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
               :              :     :              :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
               :              :     :              :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7231 [ss_sold_date_sk#6558L])
               :              :     :              :        :     :     :  +- Project [d_date_sk#6581L]
               :              :     :              :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :              :     :              :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :              :     :              :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
               :              :     :              :        :     +- Project [d_date_sk#6581L]
               :              :     :              :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :              :     :              :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :              :     :              :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
               :              :     :              :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
               :              :     :              :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
               :              :     :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
               :              :     :              :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :              :     :              :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
               :              :     :              :                 :- Project [cs_item_sk#6623L]
               :              :     :              :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
               :              :     :              :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
               :              :     :              :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7232 [cs_sold_date_sk#6642L])
               :              :     :              :                 :     :     :  +- Project [d_date_sk#6665L]
               :              :     :              :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :              :     :              :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :              :     :              :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
               :              :     :              :                 :     +- Project [d_date_sk#6665L]
               :              :     :              :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :              :     :              :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :              :     :              :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :              :     :              :                    +- Filter isnotnull(i_item_sk#6643L)
               :              :     :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
               :              :     :              +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :              :     :                 +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
               :              :     :                    :- Project [ws_item_sk#6695L]
               :              :     :                    :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
               :              :     :                    :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
               :              :     :                    :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7233 [ws_sold_date_sk#6726L])
               :              :     :                    :     :     :  +- Project [d_date_sk#6749L]
               :              :     :                    :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :              :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :              :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
               :              :     :                    :     +- Project [d_date_sk#6749L]
               :              :     :                    :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :              :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :              :     :                    +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :              :     :                       +- Filter isnotnull(i_item_sk#6727L)
               :              :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
               :              :     +- Project [d_date_sk#6997L]
               :              :        +- Filter (((isnotnull(d_year#7003) AND isnotnull(d_moy#7005)) AND ((d_year#7003 = 2000) AND (d_moy#7005 = 11))) AND isnotnull(d_date_sk#6997L))
               :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6997L,d_date_id#6998,d_date#6999,d_month_seq#7000,d_week_seq#7001,d_quarter_seq#7002,d_year#7003,d_dow#7004,d_moy#7005,d_dom#7006,d_qoy#7007,d_fy_year#7008,d_fy_quarter_seq#7009,d_fy_week_seq#7010,d_day_name#7011,d_quarter_name#7012,d_holiday#7013,d_weekend#7014,d_following_holiday#7015,d_first_dom#7016,d_last_dom#7017,d_same_day_ly#7018,d_same_day_lq#7019,d_current_day#7020,... 4 more fields] orc
               :              +- Join LeftSemi, (i_item_sk#6975L = ss_item_sk#6503L)
               :                 :- Project [i_item_sk#6975L, i_brand_id#6982, i_class_id#6984, i_category_id#6986]
               :                 :  +- Filter isnotnull(i_item_sk#6975L)
               :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6975L,i_item_id#6976,i_rec_start_date#6977,i_rec_end_date#6978,i_item_desc#6979,i_current_price#6980,i_wholesale_cost#6981,i_brand_id#6982,i_brand#6983,i_class_id#6984,i_class#6985,i_category_id#6986,i_category#6987,i_manufact_id#6988,i_manufact#6989,i_size#6990,i_formulation#6991,i_color#6992,i_units#6993,i_container#6994,i_manager_id#6995,i_product_name#6996] orc
               :                 +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
               :                    +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
               :                       :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
               :                       :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
               :                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
               :                       +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :                          +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
               :                             :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :                             :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
               :                             :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
               :                             :        :- Project [ss_item_sk#6537L]
               :                             :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
               :                             :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
               :                             :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7231 [ss_sold_date_sk#6558L])
               :                             :        :     :     :  +- Project [d_date_sk#6581L]
               :                             :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :                             :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :                             :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
               :                             :        :     +- Project [d_date_sk#6581L]
               :                             :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :                             :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :                             :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
               :                             :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
               :                             :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
               :                             :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
               :                             :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :                             :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
               :                             :                 :- Project [cs_item_sk#6623L]
               :                             :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
               :                             :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
               :                             :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7232 [cs_sold_date_sk#6642L])
               :                             :                 :     :     :  +- Project [d_date_sk#6665L]
               :                             :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :                             :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :                             :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
               :                             :                 :     +- Project [d_date_sk#6665L]
               :                             :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :                             :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :                             :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :                             :                    +- Filter isnotnull(i_item_sk#6643L)
               :                             :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
               :                             +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :                                +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
               :                                   :- Project [ws_item_sk#6695L]
               :                                   :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
               :                                   :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
               :                                   :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7233 [ws_sold_date_sk#6726L])
               :                                   :     :     :  +- Project [d_date_sk#6749L]
               :                                   :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :                                   :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :                                   :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
               :                                   :     +- Project [d_date_sk#6749L]
               :                                   :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :                                   :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :                                   +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :                                      +- Filter isnotnull(i_item_sk#6727L)
               :                                         +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
               :- Project [sales#6491, number_sales#6492L, catalog AS channel#7246, i_brand_id#7066, i_class_id#7068, i_category_id#7070]
               :  +- Filter (isnotnull(sales#6491) AND (sales#6491 > scalar-subquery#6494 []))
               :     :  +- Aggregate [avg((cast(quantity#6504 as double) * list_price#6505)) AS average_sales#6510]
               :     :     +- Union false, false
               :     :        :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
               :     :        :  +- Join Inner, (ss_sold_date_sk#6799L = d_date_sk#6800L)
               :     :        :     :- Project [ss_quantity#6786, ss_list_price#6788, ss_sold_date_sk#6799L]
               :     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#6799L) AND dynamicpruning#7234 [ss_sold_date_sk#6799L])
               :     :        :     :     :  +- Project [d_date_sk#6800L]
               :     :        :     :     :     +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
               :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
               :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6777L,ss_item_sk#6778L,ss_customer_sk#6779L,ss_cdemo_sk#6780L,ss_hdemo_sk#6781L,ss_addr_sk#6782L,ss_store_sk#6783L,ss_promo_sk#6784L,ss_ticket_number#6785L,ss_quantity#6786,ss_wholesale_cost#6787,ss_list_price#6788,ss_sales_price#6789,ss_ext_discount_amt#6790,ss_ext_sales_price#6791,ss_ext_wholesale_cost#6792,ss_ext_list_price#6793,ss_ext_tax#6794,ss_coupon_amt#6795,ss_net_paid#6796,ss_net_paid_inc_tax#6797,ss_net_profit#6798,ss_sold_date_sk#6799L] orc
               :     :        :     +- Project [d_date_sk#6800L]
               :     :        :        +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
               :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
               :     :        :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
               :     :        :  +- Join Inner, (cs_sold_date_sk#6861L = d_date_sk#6862L)
               :     :        :     :- Project [cs_quantity#6845, cs_list_price#6847, cs_sold_date_sk#6861L]
               :     :        :     :  +- Filter (isnotnull(cs_sold_date_sk#6861L) AND dynamicpruning#7235 [cs_sold_date_sk#6861L])
               :     :        :     :     :  +- Project [d_date_sk#6862L]
               :     :        :     :     :     +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
               :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
               :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6828L,cs_ship_date_sk#6829L,cs_bill_customer_sk#6830L,cs_bill_cdemo_sk#6831L,cs_bill_hdemo_sk#6832L,cs_bill_addr_sk#6833L,cs_ship_customer_sk#6834L,cs_ship_cdemo_sk#6835L,cs_ship_hdemo_sk#6836L,cs_ship_addr_sk#6837L,cs_call_center_sk#6838L,cs_catalog_page_sk#6839L,cs_ship_mode_sk#6840L,cs_warehouse_sk#6841L,cs_item_sk#6842L,cs_promo_sk#6843L,cs_order_number#6844L,cs_quantity#6845,cs_wholesale_cost#6846,cs_list_price#6847,cs_sales_price#6848,cs_ext_discount_amt#6849,cs_ext_sales_price#6850,cs_ext_wholesale_cost#6851,... 10 more fields] orc
               :     :        :     +- Project [d_date_sk#6862L]
               :     :        :        +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
               :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
               :     :        +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
               :     :           +- Join Inner, (ws_sold_date_sk#6923L = d_date_sk#6924L)
               :     :              :- Project [ws_quantity#6907, ws_list_price#6909, ws_sold_date_sk#6923L]
               :     :              :  +- Filter (isnotnull(ws_sold_date_sk#6923L) AND dynamicpruning#7236 [ws_sold_date_sk#6923L])
               :     :              :     :  +- Project [d_date_sk#6924L]
               :     :              :     :     +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
               :     :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
               :     :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6890L,ws_ship_date_sk#6891L,ws_item_sk#6892L,ws_bill_customer_sk#6893L,ws_bill_cdemo_sk#6894L,ws_bill_hdemo_sk#6895L,ws_bill_addr_sk#6896L,ws_ship_customer_sk#6897L,ws_ship_cdemo_sk#6898L,ws_ship_hdemo_sk#6899L,ws_ship_addr_sk#6900L,ws_web_page_sk#6901L,ws_web_site_sk#6902L,ws_ship_mode_sk#6903L,ws_warehouse_sk#6904L,ws_promo_sk#6905L,ws_order_number#6906L,ws_quantity#6907,ws_wholesale_cost#6908,ws_list_price#6909,ws_sales_price#6910,ws_ext_discount_amt#6911,ws_ext_sales_price#6912,ws_ext_wholesale_cost#6913,... 10 more fields] orc
               :     :              +- Project [d_date_sk#6924L]
               :     :                 +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
               :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
               :     +- Aggregate [i_brand_id#7066, i_class_id#7068, i_category_id#7070], [i_brand_id#7066, i_class_id#7068, i_category_id#7070, sum((cast(cs_quantity#7042 as double) * cs_list_price#7044)) AS sales#6491, count(1) AS number_sales#6492L]
               :        +- Project [cs_quantity#7042, cs_list_price#7044, i_brand_id#7066, i_class_id#7068, i_category_id#7070]
               :           +- Join Inner, (cs_item_sk#7039L = i_item_sk#7059L)
               :              :- Project [cs_item_sk#7039L, cs_quantity#7042, cs_list_price#7044]
               :              :  +- Join Inner, (cs_sold_date_sk#7058L = d_date_sk#7081L)
               :              :     :- Join LeftSemi, (cs_item_sk#7039L = ss_item_sk#6503L)
               :              :     :  :- Project [cs_item_sk#7039L, cs_quantity#7042, cs_list_price#7044, cs_sold_date_sk#7058L]
               :              :     :  :  +- Filter ((isnotnull(cs_item_sk#7039L) AND isnotnull(cs_sold_date_sk#7058L)) AND dynamicpruning#7264 [cs_sold_date_sk#7058L])
               :              :     :  :     :  +- Project [d_date_sk#7081L]
               :              :     :  :     :     +- Filter (((isnotnull(d_year#7087) AND isnotnull(d_moy#7089)) AND ((d_year#7087 = 2000) AND (d_moy#7089 = 11))) AND isnotnull(d_date_sk#7081L))
               :              :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7081L,d_date_id#7082,d_date#7083,d_month_seq#7084,d_week_seq#7085,d_quarter_seq#7086,d_year#7087,d_dow#7088,d_moy#7089,d_dom#7090,d_qoy#7091,d_fy_year#7092,d_fy_quarter_seq#7093,d_fy_week_seq#7094,d_day_name#7095,d_quarter_name#7096,d_holiday#7097,d_weekend#7098,d_following_holiday#7099,d_first_dom#7100,d_last_dom#7101,d_same_day_ly#7102,d_same_day_lq#7103,d_current_day#7104,... 4 more fields] orc
               :              :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7025L,cs_ship_date_sk#7026L,cs_bill_customer_sk#7027L,cs_bill_cdemo_sk#7028L,cs_bill_hdemo_sk#7029L,cs_bill_addr_sk#7030L,cs_ship_customer_sk#7031L,cs_ship_cdemo_sk#7032L,cs_ship_hdemo_sk#7033L,cs_ship_addr_sk#7034L,cs_call_center_sk#7035L,cs_catalog_page_sk#7036L,cs_ship_mode_sk#7037L,cs_warehouse_sk#7038L,cs_item_sk#7039L,cs_promo_sk#7040L,cs_order_number#7041L,cs_quantity#7042,cs_wholesale_cost#7043,cs_list_price#7044,cs_sales_price#7045,cs_ext_discount_amt#7046,cs_ext_sales_price#7047,cs_ext_wholesale_cost#7048,... 10 more fields] orc
               :              :     :  +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
               :              :     :     +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
               :              :     :        :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
               :              :     :        :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
               :              :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
               :              :     :        +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :              :     :           +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
               :              :     :              :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :              :     :              :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
               :              :     :              :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
               :              :     :              :        :- Project [ss_item_sk#6537L]
               :              :     :              :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
               :              :     :              :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
               :              :     :              :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7237 [ss_sold_date_sk#6558L])
               :              :     :              :        :     :     :  +- Project [d_date_sk#6581L]
               :              :     :              :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :              :     :              :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :              :     :              :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
               :              :     :              :        :     +- Project [d_date_sk#6581L]
               :              :     :              :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :              :     :              :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :              :     :              :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
               :              :     :              :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
               :              :     :              :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
               :              :     :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
               :              :     :              :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :              :     :              :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
               :              :     :              :                 :- Project [cs_item_sk#6623L]
               :              :     :              :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
               :              :     :              :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
               :              :     :              :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7238 [cs_sold_date_sk#6642L])
               :              :     :              :                 :     :     :  +- Project [d_date_sk#6665L]
               :              :     :              :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :              :     :              :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :              :     :              :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
               :              :     :              :                 :     +- Project [d_date_sk#6665L]
               :              :     :              :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :              :     :              :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :              :     :              :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :              :     :              :                    +- Filter isnotnull(i_item_sk#6643L)
               :              :     :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
               :              :     :              +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :              :     :                 +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
               :              :     :                    :- Project [ws_item_sk#6695L]
               :              :     :                    :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
               :              :     :                    :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
               :              :     :                    :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7239 [ws_sold_date_sk#6726L])
               :              :     :                    :     :     :  +- Project [d_date_sk#6749L]
               :              :     :                    :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :              :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :              :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
               :              :     :                    :     +- Project [d_date_sk#6749L]
               :              :     :                    :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :              :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :              :     :                    +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :              :     :                       +- Filter isnotnull(i_item_sk#6727L)
               :              :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
               :              :     +- Project [d_date_sk#7081L]
               :              :        +- Filter (((isnotnull(d_year#7087) AND isnotnull(d_moy#7089)) AND ((d_year#7087 = 2000) AND (d_moy#7089 = 11))) AND isnotnull(d_date_sk#7081L))
               :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7081L,d_date_id#7082,d_date#7083,d_month_seq#7084,d_week_seq#7085,d_quarter_seq#7086,d_year#7087,d_dow#7088,d_moy#7089,d_dom#7090,d_qoy#7091,d_fy_year#7092,d_fy_quarter_seq#7093,d_fy_week_seq#7094,d_day_name#7095,d_quarter_name#7096,d_holiday#7097,d_weekend#7098,d_following_holiday#7099,d_first_dom#7100,d_last_dom#7101,d_same_day_ly#7102,d_same_day_lq#7103,d_current_day#7104,... 4 more fields] orc
               :              +- Join LeftSemi, (i_item_sk#7059L = ss_item_sk#6503L)
               :                 :- Project [i_item_sk#7059L, i_brand_id#7066, i_class_id#7068, i_category_id#7070]
               :                 :  +- Filter isnotnull(i_item_sk#7059L)
               :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7059L,i_item_id#7060,i_rec_start_date#7061,i_rec_end_date#7062,i_item_desc#7063,i_current_price#7064,i_wholesale_cost#7065,i_brand_id#7066,i_brand#7067,i_class_id#7068,i_class#7069,i_category_id#7070,i_category#7071,i_manufact_id#7072,i_manufact#7073,i_size#7074,i_formulation#7075,i_color#7076,i_units#7077,i_container#7078,i_manager_id#7079,i_product_name#7080] orc
               :                 +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
               :                    +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
               :                       :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
               :                       :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
               :                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
               :                       +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :                          +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
               :                             :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
               :                             :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
               :                             :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
               :                             :        :- Project [ss_item_sk#6537L]
               :                             :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
               :                             :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
               :                             :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7237 [ss_sold_date_sk#6558L])
               :                             :        :     :     :  +- Project [d_date_sk#6581L]
               :                             :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :                             :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :                             :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
               :                             :        :     +- Project [d_date_sk#6581L]
               :                             :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
               :                             :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
               :                             :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
               :                             :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
               :                             :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
               :                             :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
               :                             :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :                             :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
               :                             :                 :- Project [cs_item_sk#6623L]
               :                             :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
               :                             :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
               :                             :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7238 [cs_sold_date_sk#6642L])
               :                             :                 :     :     :  +- Project [d_date_sk#6665L]
               :                             :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :                             :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :                             :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
               :                             :                 :     +- Project [d_date_sk#6665L]
               :                             :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
               :                             :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
               :                             :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
               :                             :                    +- Filter isnotnull(i_item_sk#6643L)
               :                             :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
               :                             +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :                                +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
               :                                   :- Project [ws_item_sk#6695L]
               :                                   :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
               :                                   :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
               :                                   :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7239 [ws_sold_date_sk#6726L])
               :                                   :     :     :  +- Project [d_date_sk#6749L]
               :                                   :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :                                   :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :                                   :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
               :                                   :     +- Project [d_date_sk#6749L]
               :                                   :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
               :                                   :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
               :                                   +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
               :                                      +- Filter isnotnull(i_item_sk#6727L)
               :                                         +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
               +- Project [sales#6496, number_sales#6497L, web AS channel#7250, i_brand_id#7150, i_class_id#7152, i_category_id#7154]
                  +- Filter (isnotnull(sales#6496) AND (sales#6496 > scalar-subquery#6499 []))
                     :  +- Aggregate [avg((cast(quantity#6504 as double) * list_price#6505)) AS average_sales#6510]
                     :     +- Union false, false
                     :        :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
                     :        :  +- Join Inner, (ss_sold_date_sk#6799L = d_date_sk#6800L)
                     :        :     :- Project [ss_quantity#6786, ss_list_price#6788, ss_sold_date_sk#6799L]
                     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#6799L) AND dynamicpruning#7240 [ss_sold_date_sk#6799L])
                     :        :     :     :  +- Project [d_date_sk#6800L]
                     :        :     :     :     +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
                     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
                     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6777L,ss_item_sk#6778L,ss_customer_sk#6779L,ss_cdemo_sk#6780L,ss_hdemo_sk#6781L,ss_addr_sk#6782L,ss_store_sk#6783L,ss_promo_sk#6784L,ss_ticket_number#6785L,ss_quantity#6786,ss_wholesale_cost#6787,ss_list_price#6788,ss_sales_price#6789,ss_ext_discount_amt#6790,ss_ext_sales_price#6791,ss_ext_wholesale_cost#6792,ss_ext_list_price#6793,ss_ext_tax#6794,ss_coupon_amt#6795,ss_net_paid#6796,ss_net_paid_inc_tax#6797,ss_net_profit#6798,ss_sold_date_sk#6799L] orc
                     :        :     +- Project [d_date_sk#6800L]
                     :        :        +- Filter ((isnotnull(d_year#6806) AND ((d_year#6806 >= 1999) AND (d_year#6806 <= 2001))) AND isnotnull(d_date_sk#6800L))
                     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_date_id#6801,d_date#6802,d_month_seq#6803,d_week_seq#6804,d_quarter_seq#6805,d_year#6806,d_dow#6807,d_moy#6808,d_dom#6809,d_qoy#6810,d_fy_year#6811,d_fy_quarter_seq#6812,d_fy_week_seq#6813,d_day_name#6814,d_quarter_name#6815,d_holiday#6816,d_weekend#6817,d_following_holiday#6818,d_first_dom#6819,d_last_dom#6820,d_same_day_ly#6821,d_same_day_lq#6822,d_current_day#6823,... 4 more fields] orc
                     :        :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
                     :        :  +- Join Inner, (cs_sold_date_sk#6861L = d_date_sk#6862L)
                     :        :     :- Project [cs_quantity#6845, cs_list_price#6847, cs_sold_date_sk#6861L]
                     :        :     :  +- Filter (isnotnull(cs_sold_date_sk#6861L) AND dynamicpruning#7241 [cs_sold_date_sk#6861L])
                     :        :     :     :  +- Project [d_date_sk#6862L]
                     :        :     :     :     +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
                     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
                     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6828L,cs_ship_date_sk#6829L,cs_bill_customer_sk#6830L,cs_bill_cdemo_sk#6831L,cs_bill_hdemo_sk#6832L,cs_bill_addr_sk#6833L,cs_ship_customer_sk#6834L,cs_ship_cdemo_sk#6835L,cs_ship_hdemo_sk#6836L,cs_ship_addr_sk#6837L,cs_call_center_sk#6838L,cs_catalog_page_sk#6839L,cs_ship_mode_sk#6840L,cs_warehouse_sk#6841L,cs_item_sk#6842L,cs_promo_sk#6843L,cs_order_number#6844L,cs_quantity#6845,cs_wholesale_cost#6846,cs_list_price#6847,cs_sales_price#6848,cs_ext_discount_amt#6849,cs_ext_sales_price#6850,cs_ext_wholesale_cost#6851,... 10 more fields] orc
                     :        :     +- Project [d_date_sk#6862L]
                     :        :        +- Filter ((isnotnull(d_year#6868) AND ((d_year#6868 >= 1998) AND (d_year#6868 <= 2000))) AND isnotnull(d_date_sk#6862L))
                     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_date_id#6863,d_date#6864,d_month_seq#6865,d_week_seq#6866,d_quarter_seq#6867,d_year#6868,d_dow#6869,d_moy#6870,d_dom#6871,d_qoy#6872,d_fy_year#6873,d_fy_quarter_seq#6874,d_fy_week_seq#6875,d_day_name#6876,d_quarter_name#6877,d_holiday#6878,d_weekend#6879,d_following_holiday#6880,d_first_dom#6881,d_last_dom#6882,d_same_day_ly#6883,d_same_day_lq#6884,d_current_day#6885,... 4 more fields] orc
                     :        +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
                     :           +- Join Inner, (ws_sold_date_sk#6923L = d_date_sk#6924L)
                     :              :- Project [ws_quantity#6907, ws_list_price#6909, ws_sold_date_sk#6923L]
                     :              :  +- Filter (isnotnull(ws_sold_date_sk#6923L) AND dynamicpruning#7242 [ws_sold_date_sk#6923L])
                     :              :     :  +- Project [d_date_sk#6924L]
                     :              :     :     +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
                     :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
                     :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6890L,ws_ship_date_sk#6891L,ws_item_sk#6892L,ws_bill_customer_sk#6893L,ws_bill_cdemo_sk#6894L,ws_bill_hdemo_sk#6895L,ws_bill_addr_sk#6896L,ws_ship_customer_sk#6897L,ws_ship_cdemo_sk#6898L,ws_ship_hdemo_sk#6899L,ws_ship_addr_sk#6900L,ws_web_page_sk#6901L,ws_web_site_sk#6902L,ws_ship_mode_sk#6903L,ws_warehouse_sk#6904L,ws_promo_sk#6905L,ws_order_number#6906L,ws_quantity#6907,ws_wholesale_cost#6908,ws_list_price#6909,ws_sales_price#6910,ws_ext_discount_amt#6911,ws_ext_sales_price#6912,ws_ext_wholesale_cost#6913,... 10 more fields] orc
                     :              +- Project [d_date_sk#6924L]
                     :                 +- Filter ((isnotnull(d_year#6930) AND ((d_year#6930 >= 1998) AND (d_year#6930 <= 2000))) AND isnotnull(d_date_sk#6924L))
                     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_date_id#6925,d_date#6926,d_month_seq#6927,d_week_seq#6928,d_quarter_seq#6929,d_year#6930,d_dow#6931,d_moy#6932,d_dom#6933,d_qoy#6934,d_fy_year#6935,d_fy_quarter_seq#6936,d_fy_week_seq#6937,d_day_name#6938,d_quarter_name#6939,d_holiday#6940,d_weekend#6941,d_following_holiday#6942,d_first_dom#6943,d_last_dom#6944,d_same_day_ly#6945,d_same_day_lq#6946,d_current_day#6947,... 4 more fields] orc
                     +- Aggregate [i_brand_id#7150, i_class_id#7152, i_category_id#7154], [i_brand_id#7150, i_class_id#7152, i_category_id#7154, sum((cast(ws_quantity#7126 as double) * ws_list_price#7128)) AS sales#6496, count(1) AS number_sales#6497L]
                        +- Project [ws_quantity#7126, ws_list_price#7128, i_brand_id#7150, i_class_id#7152, i_category_id#7154]
                           +- Join Inner, (ws_item_sk#7111L = i_item_sk#7143L)
                              :- Project [ws_item_sk#7111L, ws_quantity#7126, ws_list_price#7128]
                              :  +- Join Inner, (ws_sold_date_sk#7142L = d_date_sk#7165L)
                              :     :- Join LeftSemi, (ws_item_sk#7111L = ss_item_sk#6503L)
                              :     :  :- Project [ws_item_sk#7111L, ws_quantity#7126, ws_list_price#7128, ws_sold_date_sk#7142L]
                              :     :  :  +- Filter ((isnotnull(ws_item_sk#7111L) AND isnotnull(ws_sold_date_sk#7142L)) AND dynamicpruning#7271 [ws_sold_date_sk#7142L])
                              :     :  :     :  +- Project [d_date_sk#7165L]
                              :     :  :     :     +- Filter (((isnotnull(d_year#7171) AND isnotnull(d_moy#7173)) AND ((d_year#7171 = 2000) AND (d_moy#7173 = 11))) AND isnotnull(d_date_sk#7165L))
                              :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7165L,d_date_id#7166,d_date#7167,d_month_seq#7168,d_week_seq#7169,d_quarter_seq#7170,d_year#7171,d_dow#7172,d_moy#7173,d_dom#7174,d_qoy#7175,d_fy_year#7176,d_fy_quarter_seq#7177,d_fy_week_seq#7178,d_day_name#7179,d_quarter_name#7180,d_holiday#7181,d_weekend#7182,d_following_holiday#7183,d_first_dom#7184,d_last_dom#7185,d_same_day_ly#7186,d_same_day_lq#7187,d_current_day#7188,... 4 more fields] orc
                              :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7109L,ws_ship_date_sk#7110L,ws_item_sk#7111L,ws_bill_customer_sk#7112L,ws_bill_cdemo_sk#7113L,ws_bill_hdemo_sk#7114L,ws_bill_addr_sk#7115L,ws_ship_customer_sk#7116L,ws_ship_cdemo_sk#7117L,ws_ship_hdemo_sk#7118L,ws_ship_addr_sk#7119L,ws_web_page_sk#7120L,ws_web_site_sk#7121L,ws_ship_mode_sk#7122L,ws_warehouse_sk#7123L,ws_promo_sk#7124L,ws_order_number#7125L,ws_quantity#7126,ws_wholesale_cost#7127,ws_list_price#7128,ws_sales_price#7129,ws_ext_discount_amt#7130,ws_ext_sales_price#7131,ws_ext_wholesale_cost#7132,... 10 more fields] orc
                              :     :  +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                              :     :     +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
                              :     :        :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
                              :     :        :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                              :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
                              :     :        +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
                              :     :           +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
                              :     :              :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
                              :     :              :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                              :     :              :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
                              :     :              :        :- Project [ss_item_sk#6537L]
                              :     :              :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
                              :     :              :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
                              :     :              :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7243 [ss_sold_date_sk#6558L])
                              :     :              :        :     :     :  +- Project [d_date_sk#6581L]
                              :     :              :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
                              :     :              :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
                              :     :              :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
                              :     :              :        :     +- Project [d_date_sk#6581L]
                              :     :              :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
                              :     :              :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
                              :     :              :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
                              :     :              :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
                              :     :              :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
                              :     :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
                              :     :              :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                              :     :              :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
                              :     :              :                 :- Project [cs_item_sk#6623L]
                              :     :              :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
                              :     :              :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
                              :     :              :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7244 [cs_sold_date_sk#6642L])
                              :     :              :                 :     :     :  +- Project [d_date_sk#6665L]
                              :     :              :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
                              :     :              :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
                              :     :              :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
                              :     :              :                 :     +- Project [d_date_sk#6665L]
                              :     :              :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
                              :     :              :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
                              :     :              :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                              :     :              :                    +- Filter isnotnull(i_item_sk#6643L)
                              :     :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
                              :     :              +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                              :     :                 +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
                              :     :                    :- Project [ws_item_sk#6695L]
                              :     :                    :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
                              :     :                    :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
                              :     :                    :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7245 [ws_sold_date_sk#6726L])
                              :     :                    :     :     :  +- Project [d_date_sk#6749L]
                              :     :                    :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
                              :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
                              :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
                              :     :                    :     +- Project [d_date_sk#6749L]
                              :     :                    :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
                              :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
                              :     :                    +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                              :     :                       +- Filter isnotnull(i_item_sk#6727L)
                              :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc
                              :     +- Project [d_date_sk#7165L]
                              :        +- Filter (((isnotnull(d_year#7171) AND isnotnull(d_moy#7173)) AND ((d_year#7171 = 2000) AND (d_moy#7173 = 11))) AND isnotnull(d_date_sk#7165L))
                              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7165L,d_date_id#7166,d_date#7167,d_month_seq#7168,d_week_seq#7169,d_quarter_seq#7170,d_year#7171,d_dow#7172,d_moy#7173,d_dom#7174,d_qoy#7175,d_fy_year#7176,d_fy_quarter_seq#7177,d_fy_week_seq#7178,d_day_name#7179,d_quarter_name#7180,d_holiday#7181,d_weekend#7182,d_following_holiday#7183,d_first_dom#7184,d_last_dom#7185,d_same_day_ly#7186,d_same_day_lq#7187,d_current_day#7188,... 4 more fields] orc
                              +- Join LeftSemi, (i_item_sk#7143L = ss_item_sk#6503L)
                                 :- Project [i_item_sk#7143L, i_brand_id#7150, i_class_id#7152, i_category_id#7154]
                                 :  +- Filter isnotnull(i_item_sk#7143L)
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7143L,i_item_id#7144,i_rec_start_date#7145,i_rec_end_date#7146,i_item_desc#7147,i_current_price#7148,i_wholesale_cost#7149,i_brand_id#7150,i_brand#7151,i_class_id#7152,i_class#7153,i_category_id#7154,i_category#7155,i_manufact_id#7156,i_manufact#7157,i_size#7158,i_formulation#7159,i_color#7160,i_units#7161,i_container#7162,i_manager_id#7163,i_product_name#7164] orc
                                 +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                                    +- Join Inner, (((i_brand_id#6521 = brand_id#6500) AND (i_class_id#6523 = class_id#6501)) AND (i_category_id#6525 = category_id#6502))
                                       :- Project [i_item_sk#6514L, i_brand_id#6521, i_class_id#6523, i_category_id#6525]
                                       :  +- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_item_id#6515,i_rec_start_date#6516,i_rec_end_date#6517,i_item_desc#6518,i_current_price#6519,i_wholesale_cost#6520,i_brand_id#6521,i_brand#6522,i_class_id#6523,i_class#6524,i_category_id#6525,i_category#6526,i_manufact_id#6527,i_manufact#6528,i_size#6529,i_formulation#6530,i_color#6531,i_units#6532,i_container#6533,i_manager_id#6534,i_product_name#6535] orc
                                       +- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
                                          +- Join LeftSemi, (((brand_id#6500 <=> i_brand_id#6734) AND (class_id#6501 <=> i_class_id#6736)) AND (category_id#6502 <=> i_category_id#6738))
                                             :- Aggregate [brand_id#6500, class_id#6501, category_id#6502], [brand_id#6500, class_id#6501, category_id#6502]
                                             :  +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                                             :     +- Join Inner, (ss_item_sk#6537L = i_item_sk#6559L)
                                             :        :- Project [ss_item_sk#6537L]
                                             :        :  +- Join Inner, (ss_sold_date_sk#6558L = d_date_sk#6581L)
                                             :        :     :- Project [ss_item_sk#6537L, ss_sold_date_sk#6558L]
                                             :        :     :  +- Filter ((isnotnull(ss_item_sk#6537L) AND isnotnull(ss_sold_date_sk#6558L)) AND dynamicpruning#7243 [ss_sold_date_sk#6558L])
                                             :        :     :     :  +- Project [d_date_sk#6581L]
                                             :        :     :     :     +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
                                             :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
                                             :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#6536L,ss_item_sk#6537L,ss_customer_sk#6538L,ss_cdemo_sk#6539L,ss_hdemo_sk#6540L,ss_addr_sk#6541L,ss_store_sk#6542L,ss_promo_sk#6543L,ss_ticket_number#6544L,ss_quantity#6545,ss_wholesale_cost#6546,ss_list_price#6547,ss_sales_price#6548,ss_ext_discount_amt#6549,ss_ext_sales_price#6550,ss_ext_wholesale_cost#6551,ss_ext_list_price#6552,ss_ext_tax#6553,ss_coupon_amt#6554,ss_net_paid#6555,ss_net_paid_inc_tax#6556,ss_net_profit#6557,ss_sold_date_sk#6558L] orc
                                             :        :     +- Project [d_date_sk#6581L]
                                             :        :        +- Filter ((isnotnull(d_year#6587) AND ((d_year#6587 >= 1999) AND (d_year#6587 <= 2001))) AND isnotnull(d_date_sk#6581L))
                                             :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_date_id#6582,d_date#6583,d_month_seq#6584,d_week_seq#6585,d_quarter_seq#6586,d_year#6587,d_dow#6588,d_moy#6589,d_dom#6590,d_qoy#6591,d_fy_year#6592,d_fy_quarter_seq#6593,d_fy_week_seq#6594,d_day_name#6595,d_quarter_name#6596,d_holiday#6597,d_weekend#6598,d_following_holiday#6599,d_first_dom#6600,d_last_dom#6601,d_same_day_ly#6602,d_same_day_lq#6603,d_current_day#6604,... 4 more fields] orc
                                             :        +- Join LeftSemi, (((i_brand_id#6566 <=> i_brand_id#6650) AND (i_class_id#6568 <=> i_class_id#6652)) AND (i_category_id#6570 <=> i_category_id#6654))
                                             :           :- Project [i_item_sk#6559L, i_brand_id#6566, i_class_id#6568, i_category_id#6570]
                                             :           :  +- Filter (isnotnull(i_item_sk#6559L) AND ((isnotnull(i_brand_id#6566) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570)))
                                             :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_item_id#6560,i_rec_start_date#6561,i_rec_end_date#6562,i_item_desc#6563,i_current_price#6564,i_wholesale_cost#6565,i_brand_id#6566,i_brand#6567,i_class_id#6568,i_class#6569,i_category_id#6570,i_category#6571,i_manufact_id#6572,i_manufact#6573,i_size#6574,i_formulation#6575,i_color#6576,i_units#6577,i_container#6578,i_manager_id#6579,i_product_name#6580] orc
                                             :           +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                                             :              +- Join Inner, (cs_item_sk#6623L = i_item_sk#6643L)
                                             :                 :- Project [cs_item_sk#6623L]
                                             :                 :  +- Join Inner, (cs_sold_date_sk#6642L = d_date_sk#6665L)
                                             :                 :     :- Project [cs_item_sk#6623L, cs_sold_date_sk#6642L]
                                             :                 :     :  +- Filter ((isnotnull(cs_item_sk#6623L) AND isnotnull(cs_sold_date_sk#6642L)) AND dynamicpruning#7244 [cs_sold_date_sk#6642L])
                                             :                 :     :     :  +- Project [d_date_sk#6665L]
                                             :                 :     :     :     +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
                                             :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
                                             :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#6609L,cs_ship_date_sk#6610L,cs_bill_customer_sk#6611L,cs_bill_cdemo_sk#6612L,cs_bill_hdemo_sk#6613L,cs_bill_addr_sk#6614L,cs_ship_customer_sk#6615L,cs_ship_cdemo_sk#6616L,cs_ship_hdemo_sk#6617L,cs_ship_addr_sk#6618L,cs_call_center_sk#6619L,cs_catalog_page_sk#6620L,cs_ship_mode_sk#6621L,cs_warehouse_sk#6622L,cs_item_sk#6623L,cs_promo_sk#6624L,cs_order_number#6625L,cs_quantity#6626,cs_wholesale_cost#6627,cs_list_price#6628,cs_sales_price#6629,cs_ext_discount_amt#6630,cs_ext_sales_price#6631,cs_ext_wholesale_cost#6632,... 10 more fields] orc
                                             :                 :     +- Project [d_date_sk#6665L]
                                             :                 :        +- Filter ((isnotnull(d_year#6671) AND ((d_year#6671 >= 1999) AND (d_year#6671 <= 2001))) AND isnotnull(d_date_sk#6665L))
                                             :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_date_id#6666,d_date#6667,d_month_seq#6668,d_week_seq#6669,d_quarter_seq#6670,d_year#6671,d_dow#6672,d_moy#6673,d_dom#6674,d_qoy#6675,d_fy_year#6676,d_fy_quarter_seq#6677,d_fy_week_seq#6678,d_day_name#6679,d_quarter_name#6680,d_holiday#6681,d_weekend#6682,d_following_holiday#6683,d_first_dom#6684,d_last_dom#6685,d_same_day_ly#6686,d_same_day_lq#6687,d_current_day#6688,... 4 more fields] orc
                                             :                 +- Project [i_item_sk#6643L, i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                                             :                    +- Filter isnotnull(i_item_sk#6643L)
                                             :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_item_id#6644,i_rec_start_date#6645,i_rec_end_date#6646,i_item_desc#6647,i_current_price#6648,i_wholesale_cost#6649,i_brand_id#6650,i_brand#6651,i_class_id#6652,i_class#6653,i_category_id#6654,i_category#6655,i_manufact_id#6656,i_manufact#6657,i_size#6658,i_formulation#6659,i_color#6660,i_units#6661,i_container#6662,i_manager_id#6663,i_product_name#6664] orc
                                             +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                                                +- Join Inner, (ws_item_sk#6695L = i_item_sk#6727L)
                                                   :- Project [ws_item_sk#6695L]
                                                   :  +- Join Inner, (ws_sold_date_sk#6726L = d_date_sk#6749L)
                                                   :     :- Project [ws_item_sk#6695L, ws_sold_date_sk#6726L]
                                                   :     :  +- Filter ((isnotnull(ws_item_sk#6695L) AND isnotnull(ws_sold_date_sk#6726L)) AND dynamicpruning#7245 [ws_sold_date_sk#6726L])
                                                   :     :     :  +- Project [d_date_sk#6749L]
                                                   :     :     :     +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
                                                   :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
                                                   :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#6693L,ws_ship_date_sk#6694L,ws_item_sk#6695L,ws_bill_customer_sk#6696L,ws_bill_cdemo_sk#6697L,ws_bill_hdemo_sk#6698L,ws_bill_addr_sk#6699L,ws_ship_customer_sk#6700L,ws_ship_cdemo_sk#6701L,ws_ship_hdemo_sk#6702L,ws_ship_addr_sk#6703L,ws_web_page_sk#6704L,ws_web_site_sk#6705L,ws_ship_mode_sk#6706L,ws_warehouse_sk#6707L,ws_promo_sk#6708L,ws_order_number#6709L,ws_quantity#6710,ws_wholesale_cost#6711,ws_list_price#6712,ws_sales_price#6713,ws_ext_discount_amt#6714,ws_ext_sales_price#6715,ws_ext_wholesale_cost#6716,... 10 more fields] orc
                                                   :     +- Project [d_date_sk#6749L]
                                                   :        +- Filter ((isnotnull(d_year#6755) AND ((d_year#6755 >= 1999) AND (d_year#6755 <= 2001))) AND isnotnull(d_date_sk#6749L))
                                                   :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_date_id#6750,d_date#6751,d_month_seq#6752,d_week_seq#6753,d_quarter_seq#6754,d_year#6755,d_dow#6756,d_moy#6757,d_dom#6758,d_qoy#6759,d_fy_year#6760,d_fy_quarter_seq#6761,d_fy_week_seq#6762,d_day_name#6763,d_quarter_name#6764,d_holiday#6765,d_weekend#6766,d_following_holiday#6767,d_first_dom#6768,d_last_dom#6769,d_same_day_ly#6770,d_same_day_lq#6771,d_current_day#6772,... 4 more fields] orc
                                                   +- Project [i_item_sk#6727L, i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                                                      +- Filter isnotnull(i_item_sk#6727L)
                                                         +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_item_id#6728,i_rec_start_date#6729,i_rec_end_date#6730,i_item_desc#6731,i_current_price#6732,i_wholesale_cost#6733,i_brand_id#6734,i_brand#6735,i_class_id#6736,i_class#6737,i_category_id#6738,i_category#6739,i_manufact_id#6740,i_manufact#6741,i_size#6742,i_formulation#6743,i_color#6744,i_units#6745,i_container#6746,i_manager_id#6747,i_product_name#6748] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#7218 ASC NULLS FIRST,i_brand_id#7219 ASC NULLS FIRST,i_class_id#7220 ASC NULLS FIRST,i_category_id#7221 ASC NULLS FIRST], output=[channel#7218,i_brand_id#7219,i_class_id#7220,i_category_id#7221,sum(sales)#7208,sum(number_sales)#7209L])
   +- HashAggregate(keys=[channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L], functions=[sum(sales#6486), sum(number_sales#6487L)], output=[channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, sum(sales)#7208, sum(number_sales)#7209L])
      +- Exchange hashpartitioning(channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L, 3000), ENSURE_REQUIREMENTS, [id=#6349]
         +- HashAggregate(keys=[channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L], functions=[partial_sum(sales#6486), partial_sum(number_sales#6487L)], output=[channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L, sum#7277, sum#7278L])
            +- Expand [[sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, i_class_id#6984, i_category_id#6986, 0], [sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, i_class_id#6984, null, 1], [sales#6486, number_sales#6487L, channel#7213, i_brand_id#6982, null, null, 3], [sales#6486, number_sales#6487L, channel#7213, null, null, null, 7], [sales#6486, number_sales#6487L, null, null, null, null, 15]], [sales#6486, number_sales#6487L, channel#7218, i_brand_id#7219, i_class_id#7220, i_category_id#7221, spark_grouping_id#7217L]
               +- Union
                  :- Project [sales#6486, number_sales#6487L, store AS channel#7213, i_brand_id#6982, i_class_id#6984, i_category_id#6986]
                  :  +- Filter (isnotnull(sales#6486) AND (sales#6486 > Subquery subquery#6489, [id=#5270]))
                  :     :  +- Subquery subquery#6489, [id=#5270]
                  :     :     +- AdaptiveSparkPlan isFinalPlan=false
                  :     :        +- HashAggregate(keys=[], functions=[avg((cast(quantity#6504 as double) * list_price#6505))], output=[average_sales#6510])
                  :     :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#5268]
                  :     :              +- HashAggregate(keys=[], functions=[partial_avg((cast(quantity#6504 as double) * list_price#6505))], output=[sum#7293, count#7294L])
                  :     :                 +- Union
                  :     :                    :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
                  :     :                    :  +- BroadcastHashJoin [ss_sold_date_sk#6799L], [d_date_sk#6800L], Inner, BuildRight, false
                  :     :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#6786,ss_list_price#6788,ss_sold_date_sk#6799L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6799L), dynamicpruningexpression(ss_sold_date_sk#6799L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:double>
                  :     :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7228, 0, true, Project [d_date_sk#6800L], [d_date_sk#6800L]
                  :     :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                    :     :           +- Project [d_date_sk#6800L]
                  :     :                    :     :              +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                  :     :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5256]
                  :     :                    :        +- Project [d_date_sk#6800L]
                  :     :                    :           +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                  :     :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
                  :     :                    :  +- BroadcastHashJoin [cs_sold_date_sk#6861L], [d_date_sk#6862L], Inner, BuildRight, false
                  :     :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_quantity#6845,cs_list_price#6847,cs_sold_date_sk#6861L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6861L), dynamicpruningexpression(cs_sold_date_sk#6861L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:double>
                  :     :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7229, 0, true, Project [d_date_sk#6862L], [d_date_sk#6862L]
                  :     :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                    :     :           +- Project [d_date_sk#6862L]
                  :     :                    :     :              +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                  :     :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5259]
                  :     :                    :        +- Project [d_date_sk#6862L]
                  :     :                    :           +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                  :     :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
                  :     :                       +- BroadcastHashJoin [ws_sold_date_sk#6923L], [d_date_sk#6924L], Inner, BuildRight, false
                  :     :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_quantity#6907,ws_list_price#6909,ws_sold_date_sk#6923L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6923L), dynamicpruningexpression(ws_sold_date_sk#6923L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:double>
                  :     :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#7230, 0, true, Project [d_date_sk#6924L], [d_date_sk#6924L]
                  :     :                          :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                          :           +- Project [d_date_sk#6924L]
                  :     :                          :              +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                  :     :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5262]
                  :     :                             +- Project [d_date_sk#6924L]
                  :     :                                +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                  :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     +- HashAggregate(keys=[i_brand_id#6982, i_class_id#6984, i_category_id#6986], functions=[sum((cast(ss_quantity#6961 as double) * ss_list_price#6963)), count(1)], output=[i_brand_id#6982, i_class_id#6984, i_category_id#6986, sales#6486, number_sales#6487L])
                  :        +- Exchange hashpartitioning(i_brand_id#6982, i_class_id#6984, i_category_id#6986, 3000), ENSURE_REQUIREMENTS, [id=#6051]
                  :           +- HashAggregate(keys=[i_brand_id#6982, i_class_id#6984, i_category_id#6986], functions=[partial_sum((cast(ss_quantity#6961 as double) * ss_list_price#6963)), partial_count(1)], output=[i_brand_id#6982, i_class_id#6984, i_category_id#6986, sum#7281, count#7282L])
                  :              +- Project [ss_quantity#6961, ss_list_price#6963, i_brand_id#6982, i_class_id#6984, i_category_id#6986]
                  :                 +- SortMergeJoin [ss_item_sk#6953L], [i_item_sk#6975L], Inner
                  :                    :- Project [ss_item_sk#6953L, ss_quantity#6961, ss_list_price#6963]
                  :                    :  +- BroadcastHashJoin [ss_sold_date_sk#6974L], [d_date_sk#6997L], Inner, BuildRight, false
                  :                    :     :- SortMergeJoin [ss_item_sk#6953L], [ss_item_sk#6503L], LeftSemi
                  :                    :     :  :- Sort [ss_item_sk#6953L ASC NULLS FIRST], false, 0
                  :                    :     :  :  +- Exchange hashpartitioning(ss_item_sk#6953L, 3000), ENSURE_REQUIREMENTS, [id=#5971]
                  :                    :     :  :     +- Filter isnotnull(ss_item_sk#6953L)
                  :                    :     :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6953L,ss_quantity#6961,ss_list_price#6963,ss_sold_date_sk#6974L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6953L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6974L), dynamicpruningexpression(ss_sold_date_sk#6974L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_quantity:int,ss_list_price:double>
                  :                    :     :  :              +- SubqueryAdaptiveBroadcast dynamicpruning#7257, 0, true, Project [d_date_sk#6997L], [d_date_sk#6997L]
                  :                    :     :  :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :  :                    +- Project [d_date_sk#6997L]
                  :                    :     :  :                       +- Filter ((((isnotnull(d_year#7003) AND isnotnull(d_moy#7005)) AND (d_year#7003 = 2000)) AND (d_moy#7005 = 11)) AND isnotnull(d_date_sk#6997L))
                  :                    :     :  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6997L,d_year#7003,d_moy#7005] Batched: true, DataFilters: [isnotnull(d_year#7003), isnotnull(d_moy#7005), (d_year#7003 = 2000), (d_moy#7005 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                    :     :  +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                  :                    :     :     +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#5972]
                  :                    :     :        +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                  :                    :     :           +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                  :                    :     :              :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                  :                    :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#5966]
                  :                    :     :                 +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                    +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#5963]
                  :                    :     :                       +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                          +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                  :                    :     :                             :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                  :                    :     :                             :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#5956]
                  :                    :     :                             :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                             :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#5941]
                  :                    :     :                             :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                             :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                  :                    :     :                             :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                  :                    :     :                             :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#5933]
                  :                    :     :                             :                    :     +- Project [ss_item_sk#6537L]
                  :                    :     :                             :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                  :                    :     :                             :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                  :                    :     :                             :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                  :                    :     :                             :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7231, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                  :                    :     :                             :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                             :                    :           :              +- Project [d_date_sk#6581L]
                  :                    :     :                             :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                    :     :                             :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5910]
                  :                    :     :                             :                    :              +- Project [d_date_sk#6581L]
                  :                    :     :                             :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                    :     :                             :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#5934]
                  :                    :     :                             :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                  :                    :     :                             :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                  :                    :     :                             :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#5926]
                  :                    :     :                             :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                  :                    :     :                             :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :                             :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#5927]
                  :                    :     :                             :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                  :                    :     :                             :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                  :                    :     :                             :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#5918]
                  :                    :     :                             :                                         :     +- Project [cs_item_sk#6623L]
                  :                    :     :                             :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                  :                    :     :                             :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                  :                    :     :                             :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                  :                    :     :                             :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7232, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                  :                    :     :                             :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                             :                                         :           :              +- Project [d_date_sk#6665L]
                  :                    :     :                             :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                    :     :                             :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5913]
                  :                    :     :                             :                                         :              +- Project [d_date_sk#6665L]
                  :                    :     :                             :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                    :     :                             :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#5919]
                  :                    :     :                             :                                               +- Filter isnotnull(i_item_sk#6643L)
                  :                    :     :                             :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :                             +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                  :                    :     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#5957]
                  :                    :     :                                   +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                  :                    :     :                                      +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                  :                    :     :                                         :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                  :                    :     :                                         :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#5948]
                  :                    :     :                                         :     +- Project [ws_item_sk#6695L]
                  :                    :     :                                         :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                  :                    :     :                                         :           :- Filter isnotnull(ws_item_sk#6695L)
                  :                    :     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                  :                    :     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7233, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                  :                    :     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                                         :           :              +- Project [d_date_sk#6749L]
                  :                    :     :                                         :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                    :     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5943]
                  :                    :     :                                         :              +- Project [d_date_sk#6749L]
                  :                    :     :                                         :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                    :     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                                         +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                  :                    :     :                                            +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#5949]
                  :                    :     :                                               +- Filter isnotnull(i_item_sk#6727L)
                  :                    :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5977]
                  :                    :        +- Project [d_date_sk#6997L]
                  :                    :           +- Filter ((((isnotnull(d_year#7003) AND isnotnull(d_moy#7005)) AND (d_year#7003 = 2000)) AND (d_moy#7005 = 11)) AND isnotnull(d_date_sk#6997L))
                  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6997L,d_year#7003,d_moy#7005] Batched: true, DataFilters: [isnotnull(d_year#7003), isnotnull(d_moy#7005), (d_year#7003 = 2000), (d_moy#7005 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                    +- SortMergeJoin [i_item_sk#6975L], [ss_item_sk#6503L], LeftSemi
                  :                       :- Sort [i_item_sk#6975L ASC NULLS FIRST], false, 0
                  :                       :  +- Exchange hashpartitioning(i_item_sk#6975L, 3000), ENSURE_REQUIREMENTS, [id=#6041]
                  :                       :     +- Filter isnotnull(i_item_sk#6975L)
                  :                       :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6975L,i_brand_id#6982,i_class_id#6984,i_category_id#6986] Batched: true, DataFilters: [isnotnull(i_item_sk#6975L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                       +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                  :                          +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#6042]
                  :                             +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                  :                                +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                  :                                   :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                  :                                   :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#6036]
                  :                                      +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                         +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6033]
                  :                                            +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                               +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                  :                                                  :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                  :                                                  :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#6026]
                  :                                                  :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                                  :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6011]
                  :                                                  :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                                  :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                  :                                                  :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                  :                                                  :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                  :                                                  :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#6003]
                  :                                                  :                    :     +- Project [ss_item_sk#6537L]
                  :                                                  :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                  :                                                  :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                  :                                                  :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                  :                                                  :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7231, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                  :                                                  :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                  :                    :           :              +- Project [d_date_sk#6581L]
                  :                                                  :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                                                  :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5980]
                  :                                                  :                    :              +- Project [d_date_sk#6581L]
                  :                                                  :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                                                  :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                  :                                                  :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#6004]
                  :                                                  :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                  :                                                  :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                  :                                                  :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#5996]
                  :                                                  :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                  :                                                  :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                                  :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                  :                                                  :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#5997]
                  :                                                  :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                  :                                                  :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                  :                                                  :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                  :                                                  :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#5988]
                  :                                                  :                                         :     +- Project [cs_item_sk#6623L]
                  :                                                  :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                  :                                                  :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                  :                                                  :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                  :                                                  :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7232, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                  :                                                  :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                  :                                         :           :              +- Project [d_date_sk#6665L]
                  :                                                  :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                                                  :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5983]
                  :                                                  :                                         :              +- Project [d_date_sk#6665L]
                  :                                                  :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                                                  :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                  :                                                  :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#5989]
                  :                                                  :                                               +- Filter isnotnull(i_item_sk#6643L)
                  :                                                  :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                                  +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                  :                                                     +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#6027]
                  :                                                        +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                  :                                                           +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                  :                                                              :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                  :                                                              :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#6018]
                  :                                                              :     +- Project [ws_item_sk#6695L]
                  :                                                              :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                  :                                                              :           :- Filter isnotnull(ws_item_sk#6695L)
                  :                                                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                  :                                                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7233, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                  :                                                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                              :           :              +- Project [d_date_sk#6749L]
                  :                                                              :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                                                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6013]
                  :                                                              :              +- Project [d_date_sk#6749L]
                  :                                                              :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                                                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                              +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                  :                                                                 +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#6019]
                  :                                                                    +- Filter isnotnull(i_item_sk#6727L)
                  :                                                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :- Project [sales#6491, number_sales#6492L, catalog AS channel#7246, i_brand_id#7066, i_class_id#7068, i_category_id#7070]
                  :  +- Filter (isnotnull(sales#6491) AND (sales#6491 > Subquery subquery#6494, [id=#5389]))
                  :     :  +- Subquery subquery#6494, [id=#5389]
                  :     :     +- AdaptiveSparkPlan isFinalPlan=false
                  :     :        +- HashAggregate(keys=[], functions=[avg((cast(quantity#6504 as double) * list_price#6505))], output=[average_sales#6510])
                  :     :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#5387]
                  :     :              +- HashAggregate(keys=[], functions=[partial_avg((cast(quantity#6504 as double) * list_price#6505))], output=[sum#7293, count#7294L])
                  :     :                 +- Union
                  :     :                    :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
                  :     :                    :  +- BroadcastHashJoin [ss_sold_date_sk#6799L], [d_date_sk#6800L], Inner, BuildRight, false
                  :     :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#6786,ss_list_price#6788,ss_sold_date_sk#6799L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6799L), dynamicpruningexpression(ss_sold_date_sk#6799L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:double>
                  :     :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7234, 0, true, Project [d_date_sk#6800L], [d_date_sk#6800L]
                  :     :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                    :     :           +- Project [d_date_sk#6800L]
                  :     :                    :     :              +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                  :     :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5375]
                  :     :                    :        +- Project [d_date_sk#6800L]
                  :     :                    :           +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                  :     :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
                  :     :                    :  +- BroadcastHashJoin [cs_sold_date_sk#6861L], [d_date_sk#6862L], Inner, BuildRight, false
                  :     :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_quantity#6845,cs_list_price#6847,cs_sold_date_sk#6861L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6861L), dynamicpruningexpression(cs_sold_date_sk#6861L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:double>
                  :     :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7235, 0, true, Project [d_date_sk#6862L], [d_date_sk#6862L]
                  :     :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                    :     :           +- Project [d_date_sk#6862L]
                  :     :                    :     :              +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                  :     :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5378]
                  :     :                    :        +- Project [d_date_sk#6862L]
                  :     :                    :           +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                  :     :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                    +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
                  :     :                       +- BroadcastHashJoin [ws_sold_date_sk#6923L], [d_date_sk#6924L], Inner, BuildRight, false
                  :     :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_quantity#6907,ws_list_price#6909,ws_sold_date_sk#6923L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6923L), dynamicpruningexpression(ws_sold_date_sk#6923L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:double>
                  :     :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#7236, 0, true, Project [d_date_sk#6924L], [d_date_sk#6924L]
                  :     :                          :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                          :           +- Project [d_date_sk#6924L]
                  :     :                          :              +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                  :     :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5381]
                  :     :                             +- Project [d_date_sk#6924L]
                  :     :                                +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                  :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     +- HashAggregate(keys=[i_brand_id#7066, i_class_id#7068, i_category_id#7070], functions=[sum((cast(cs_quantity#7042 as double) * cs_list_price#7044)), count(1)], output=[i_brand_id#7066, i_class_id#7068, i_category_id#7070, sales#6491, number_sales#6492L])
                  :        +- Exchange hashpartitioning(i_brand_id#7066, i_class_id#7068, i_category_id#7070, 3000), ENSURE_REQUIREMENTS, [id=#6196]
                  :           +- HashAggregate(keys=[i_brand_id#7066, i_class_id#7068, i_category_id#7070], functions=[partial_sum((cast(cs_quantity#7042 as double) * cs_list_price#7044)), partial_count(1)], output=[i_brand_id#7066, i_class_id#7068, i_category_id#7070, sum#7285, count#7286L])
                  :              +- Project [cs_quantity#7042, cs_list_price#7044, i_brand_id#7066, i_class_id#7068, i_category_id#7070]
                  :                 +- SortMergeJoin [cs_item_sk#7039L], [i_item_sk#7059L], Inner
                  :                    :- Project [cs_item_sk#7039L, cs_quantity#7042, cs_list_price#7044]
                  :                    :  +- BroadcastHashJoin [cs_sold_date_sk#7058L], [d_date_sk#7081L], Inner, BuildRight, false
                  :                    :     :- SortMergeJoin [cs_item_sk#7039L], [ss_item_sk#6503L], LeftSemi
                  :                    :     :  :- Sort [cs_item_sk#7039L ASC NULLS FIRST], false, 0
                  :                    :     :  :  +- Exchange hashpartitioning(cs_item_sk#7039L, 3000), ENSURE_REQUIREMENTS, [id=#6116]
                  :                    :     :  :     +- Filter isnotnull(cs_item_sk#7039L)
                  :                    :     :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#7039L,cs_quantity#7042,cs_list_price#7044,cs_sold_date_sk#7058L] Batched: true, DataFilters: [isnotnull(cs_item_sk#7039L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7058L), dynamicpruningexpression(cs_sold_date_sk#7058L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_quantity:int,cs_list_price:double>
                  :                    :     :  :              +- SubqueryAdaptiveBroadcast dynamicpruning#7264, 0, true, Project [d_date_sk#7081L], [d_date_sk#7081L]
                  :                    :     :  :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :  :                    +- Project [d_date_sk#7081L]
                  :                    :     :  :                       +- Filter ((((isnotnull(d_year#7087) AND isnotnull(d_moy#7089)) AND (d_year#7087 = 2000)) AND (d_moy#7089 = 11)) AND isnotnull(d_date_sk#7081L))
                  :                    :     :  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7081L,d_year#7087,d_moy#7089] Batched: true, DataFilters: [isnotnull(d_year#7087), isnotnull(d_moy#7089), (d_year#7087 = 2000), (d_moy#7089 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                    :     :  +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                  :                    :     :     +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#6117]
                  :                    :     :        +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                  :                    :     :           +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                  :                    :     :              :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                  :                    :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#6111]
                  :                    :     :                 +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                    +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6108]
                  :                    :     :                       +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                          +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                  :                    :     :                             :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                  :                    :     :                             :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#6101]
                  :                    :     :                             :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                             :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6086]
                  :                    :     :                             :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                    :     :                             :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                  :                    :     :                             :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                  :                    :     :                             :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#6078]
                  :                    :     :                             :                    :     +- Project [ss_item_sk#6537L]
                  :                    :     :                             :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                  :                    :     :                             :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                  :                    :     :                             :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                  :                    :     :                             :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7237, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                  :                    :     :                             :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                             :                    :           :              +- Project [d_date_sk#6581L]
                  :                    :     :                             :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                    :     :                             :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6055]
                  :                    :     :                             :                    :              +- Project [d_date_sk#6581L]
                  :                    :     :                             :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                    :     :                             :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#6079]
                  :                    :     :                             :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                  :                    :     :                             :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                  :                    :     :                             :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#6071]
                  :                    :     :                             :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                  :                    :     :                             :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :                             :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#6072]
                  :                    :     :                             :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                  :                    :     :                             :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                  :                    :     :                             :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#6063]
                  :                    :     :                             :                                         :     +- Project [cs_item_sk#6623L]
                  :                    :     :                             :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                  :                    :     :                             :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                  :                    :     :                             :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                  :                    :     :                             :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7238, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                  :                    :     :                             :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                             :                                         :           :              +- Project [d_date_sk#6665L]
                  :                    :     :                             :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                    :     :                             :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6058]
                  :                    :     :                             :                                         :              +- Project [d_date_sk#6665L]
                  :                    :     :                             :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                    :     :                             :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                             :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                  :                    :     :                             :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#6064]
                  :                    :     :                             :                                               +- Filter isnotnull(i_item_sk#6643L)
                  :                    :     :                             :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     :                             +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                  :                    :     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#6102]
                  :                    :     :                                   +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                  :                    :     :                                      +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                  :                    :     :                                         :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                  :                    :     :                                         :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#6093]
                  :                    :     :                                         :     +- Project [ws_item_sk#6695L]
                  :                    :     :                                         :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                  :                    :     :                                         :           :- Filter isnotnull(ws_item_sk#6695L)
                  :                    :     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                  :                    :     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7239, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                  :                    :     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                    :     :                                         :           :              +- Project [d_date_sk#6749L]
                  :                    :     :                                         :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                    :     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6088]
                  :                    :     :                                         :              +- Project [d_date_sk#6749L]
                  :                    :     :                                         :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                    :     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                    :     :                                         +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                  :                    :     :                                            +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#6094]
                  :                    :     :                                               +- Filter isnotnull(i_item_sk#6727L)
                  :                    :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6122]
                  :                    :        +- Project [d_date_sk#7081L]
                  :                    :           +- Filter ((((isnotnull(d_year#7087) AND isnotnull(d_moy#7089)) AND (d_year#7087 = 2000)) AND (d_moy#7089 = 11)) AND isnotnull(d_date_sk#7081L))
                  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7081L,d_year#7087,d_moy#7089] Batched: true, DataFilters: [isnotnull(d_year#7087), isnotnull(d_moy#7089), (d_year#7087 = 2000), (d_moy#7089 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                    +- SortMergeJoin [i_item_sk#7059L], [ss_item_sk#6503L], LeftSemi
                  :                       :- Sort [i_item_sk#7059L ASC NULLS FIRST], false, 0
                  :                       :  +- Exchange hashpartitioning(i_item_sk#7059L, 3000), ENSURE_REQUIREMENTS, [id=#6186]
                  :                       :     +- Filter isnotnull(i_item_sk#7059L)
                  :                       :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7059L,i_brand_id#7066,i_class_id#7068,i_category_id#7070] Batched: true, DataFilters: [isnotnull(i_item_sk#7059L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                       +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                  :                          +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#6187]
                  :                             +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                  :                                +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                  :                                   :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                  :                                   :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#6181]
                  :                                      +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                         +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6178]
                  :                                            +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                               +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                  :                                                  :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                  :                                                  :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#6171]
                  :                                                  :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                                  :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6156]
                  :                                                  :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                  :                                                  :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                  :                                                  :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                  :                                                  :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                  :                                                  :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#6148]
                  :                                                  :                    :     +- Project [ss_item_sk#6537L]
                  :                                                  :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                  :                                                  :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                  :                                                  :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                  :                                                  :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7237, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                  :                                                  :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                  :                    :           :              +- Project [d_date_sk#6581L]
                  :                                                  :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                                                  :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6125]
                  :                                                  :                    :              +- Project [d_date_sk#6581L]
                  :                                                  :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                  :                                                  :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                  :                                                  :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#6149]
                  :                                                  :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                  :                                                  :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                  :                                                  :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#6141]
                  :                                                  :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                  :                                                  :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                                  :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                  :                                                  :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#6142]
                  :                                                  :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                  :                                                  :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                  :                                                  :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                  :                                                  :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#6133]
                  :                                                  :                                         :     +- Project [cs_item_sk#6623L]
                  :                                                  :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                  :                                                  :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                  :                                                  :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                  :                                                  :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7238, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                  :                                                  :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                  :                                         :           :              +- Project [d_date_sk#6665L]
                  :                                                  :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                                                  :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6128]
                  :                                                  :                                         :              +- Project [d_date_sk#6665L]
                  :                                                  :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                  :                                                  :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                  :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                  :                                                  :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#6134]
                  :                                                  :                                               +- Filter isnotnull(i_item_sk#6643L)
                  :                                                  :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  :                                                  +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                  :                                                     +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#6172]
                  :                                                        +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                  :                                                           +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                  :                                                              :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                  :                                                              :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#6163]
                  :                                                              :     +- Project [ws_item_sk#6695L]
                  :                                                              :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                  :                                                              :           :- Filter isnotnull(ws_item_sk#6695L)
                  :                                                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                  :                                                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7239, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                  :                                                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                                                              :           :              +- Project [d_date_sk#6749L]
                  :                                                              :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                                                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6158]
                  :                                                              :              +- Project [d_date_sk#6749L]
                  :                                                              :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                  :                                                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :                                                              +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                  :                                                                 +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#6164]
                  :                                                                    +- Filter isnotnull(i_item_sk#6727L)
                  :                                                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                  +- Project [sales#6496, number_sales#6497L, web AS channel#7250, i_brand_id#7150, i_class_id#7152, i_category_id#7154]
                     +- Filter (isnotnull(sales#6496) AND (sales#6496 > Subquery subquery#6499, [id=#5508]))
                        :  +- Subquery subquery#6499, [id=#5508]
                        :     +- AdaptiveSparkPlan isFinalPlan=false
                        :        +- HashAggregate(keys=[], functions=[avg((cast(quantity#6504 as double) * list_price#6505))], output=[average_sales#6510])
                        :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#5506]
                        :              +- HashAggregate(keys=[], functions=[partial_avg((cast(quantity#6504 as double) * list_price#6505))], output=[sum#7293, count#7294L])
                        :                 +- Union
                        :                    :- Project [ss_quantity#6786 AS quantity#6504, ss_list_price#6788 AS list_price#6505]
                        :                    :  +- BroadcastHashJoin [ss_sold_date_sk#6799L], [d_date_sk#6800L], Inner, BuildRight, false
                        :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#6786,ss_list_price#6788,ss_sold_date_sk#6799L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6799L), dynamicpruningexpression(ss_sold_date_sk#6799L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:double>
                        :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7240, 0, true, Project [d_date_sk#6800L], [d_date_sk#6800L]
                        :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                        :                    :     :           +- Project [d_date_sk#6800L]
                        :                    :     :              +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                        :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5494]
                        :                    :        +- Project [d_date_sk#6800L]
                        :                    :           +- Filter (((isnotnull(d_year#6806) AND (d_year#6806 >= 1999)) AND (d_year#6806 <= 2001)) AND isnotnull(d_date_sk#6800L))
                        :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6800L,d_year#6806] Batched: true, DataFilters: [isnotnull(d_year#6806), (d_year#6806 >= 1999), (d_year#6806 <= 2001), isnotnull(d_date_sk#6800L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        :                    :- Project [cs_quantity#6845 AS quantity#6506, cs_list_price#6847 AS list_price#6507]
                        :                    :  +- BroadcastHashJoin [cs_sold_date_sk#6861L], [d_date_sk#6862L], Inner, BuildRight, false
                        :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_quantity#6845,cs_list_price#6847,cs_sold_date_sk#6861L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6861L), dynamicpruningexpression(cs_sold_date_sk#6861L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:double>
                        :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7241, 0, true, Project [d_date_sk#6862L], [d_date_sk#6862L]
                        :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
                        :                    :     :           +- Project [d_date_sk#6862L]
                        :                    :     :              +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                        :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5497]
                        :                    :        +- Project [d_date_sk#6862L]
                        :                    :           +- Filter (((isnotnull(d_year#6868) AND (d_year#6868 >= 1998)) AND (d_year#6868 <= 2000)) AND isnotnull(d_date_sk#6862L))
                        :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6862L,d_year#6868] Batched: true, DataFilters: [isnotnull(d_year#6868), (d_year#6868 >= 1998), (d_year#6868 <= 2000), isnotnull(d_date_sk#6862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        :                    +- Project [ws_quantity#6907 AS quantity#6508, ws_list_price#6909 AS list_price#6509]
                        :                       +- BroadcastHashJoin [ws_sold_date_sk#6923L], [d_date_sk#6924L], Inner, BuildRight, false
                        :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_quantity#6907,ws_list_price#6909,ws_sold_date_sk#6923L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6923L), dynamicpruningexpression(ws_sold_date_sk#6923L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:double>
                        :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#7242, 0, true, Project [d_date_sk#6924L], [d_date_sk#6924L]
                        :                          :        +- AdaptiveSparkPlan isFinalPlan=false
                        :                          :           +- Project [d_date_sk#6924L]
                        :                          :              +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                        :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#5500]
                        :                             +- Project [d_date_sk#6924L]
                        :                                +- Filter (((isnotnull(d_year#6930) AND (d_year#6930 >= 1998)) AND (d_year#6930 <= 2000)) AND isnotnull(d_date_sk#6924L))
                        :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6924L,d_year#6930] Batched: true, DataFilters: [isnotnull(d_year#6930), (d_year#6930 >= 1998), (d_year#6930 <= 2000), isnotnull(d_date_sk#6924L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                        +- HashAggregate(keys=[i_brand_id#7150, i_class_id#7152, i_category_id#7154], functions=[sum((cast(ws_quantity#7126 as double) * ws_list_price#7128)), count(1)], output=[i_brand_id#7150, i_class_id#7152, i_category_id#7154, sales#6496, number_sales#6497L])
                           +- Exchange hashpartitioning(i_brand_id#7150, i_class_id#7152, i_category_id#7154, 3000), ENSURE_REQUIREMENTS, [id=#6341]
                              +- HashAggregate(keys=[i_brand_id#7150, i_class_id#7152, i_category_id#7154], functions=[partial_sum((cast(ws_quantity#7126 as double) * ws_list_price#7128)), partial_count(1)], output=[i_brand_id#7150, i_class_id#7152, i_category_id#7154, sum#7289, count#7290L])
                                 +- Project [ws_quantity#7126, ws_list_price#7128, i_brand_id#7150, i_class_id#7152, i_category_id#7154]
                                    +- SortMergeJoin [ws_item_sk#7111L], [i_item_sk#7143L], Inner
                                       :- Project [ws_item_sk#7111L, ws_quantity#7126, ws_list_price#7128]
                                       :  +- BroadcastHashJoin [ws_sold_date_sk#7142L], [d_date_sk#7165L], Inner, BuildRight, false
                                       :     :- SortMergeJoin [ws_item_sk#7111L], [ss_item_sk#6503L], LeftSemi
                                       :     :  :- Sort [ws_item_sk#7111L ASC NULLS FIRST], false, 0
                                       :     :  :  +- Exchange hashpartitioning(ws_item_sk#7111L, 3000), ENSURE_REQUIREMENTS, [id=#6261]
                                       :     :  :     +- Filter isnotnull(ws_item_sk#7111L)
                                       :     :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#7111L,ws_quantity#7126,ws_list_price#7128,ws_sold_date_sk#7142L] Batched: true, DataFilters: [isnotnull(ws_item_sk#7111L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7142L), dynamicpruningexpression(ws_sold_date_sk#7142L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_quantity:int,ws_list_price:double>
                                       :     :  :              +- SubqueryAdaptiveBroadcast dynamicpruning#7271, 0, true, Project [d_date_sk#7165L], [d_date_sk#7165L]
                                       :     :  :                 +- AdaptiveSparkPlan isFinalPlan=false
                                       :     :  :                    +- Project [d_date_sk#7165L]
                                       :     :  :                       +- Filter ((((isnotnull(d_year#7171) AND isnotnull(d_moy#7173)) AND (d_year#7171 = 2000)) AND (d_moy#7173 = 11)) AND isnotnull(d_date_sk#7165L))
                                       :     :  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7165L,d_year#7171,d_moy#7173] Batched: true, DataFilters: [isnotnull(d_year#7171), isnotnull(d_moy#7173), (d_year#7171 = 2000), (d_moy#7173 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                       :     :  +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                                       :     :     +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#6262]
                                       :     :        +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                                       :     :           +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                                       :     :              :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                                       :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                       :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#6256]
                                       :     :                 +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                       :     :                    +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6253]
                                       :     :                       +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                       :     :                          +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                                       :     :                             :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                                       :     :                             :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#6246]
                                       :     :                             :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                       :     :                             :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6231]
                                       :     :                             :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                       :     :                             :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                                       :     :                             :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                                       :     :                             :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                                       :     :                             :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#6223]
                                       :     :                             :                    :     +- Project [ss_item_sk#6537L]
                                       :     :                             :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                                       :     :                             :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                                       :     :                             :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                                       :     :                             :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7243, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                                       :     :                             :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :     :                             :                    :           :              +- Project [d_date_sk#6581L]
                                       :     :                             :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                                       :     :                             :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                             :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6200]
                                       :     :                             :                    :              +- Project [d_date_sk#6581L]
                                       :     :                             :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                                       :     :                             :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                             :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                                       :     :                             :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#6224]
                                       :     :                             :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                                       :     :                             :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                                       :     :                             :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#6216]
                                       :     :                             :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                                       :     :                             :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                       :     :                             :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                                       :     :                             :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#6217]
                                       :     :                             :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                                       :     :                             :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                                       :     :                             :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                                       :     :                             :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#6208]
                                       :     :                             :                                         :     +- Project [cs_item_sk#6623L]
                                       :     :                             :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                                       :     :                             :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                                       :     :                             :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                                       :     :                             :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7244, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                                       :     :                             :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :     :                             :                                         :           :              +- Project [d_date_sk#6665L]
                                       :     :                             :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                                       :     :                             :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                             :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6203]
                                       :     :                             :                                         :              +- Project [d_date_sk#6665L]
                                       :     :                             :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                                       :     :                             :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                             :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                                       :     :                             :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#6209]
                                       :     :                             :                                               +- Filter isnotnull(i_item_sk#6643L)
                                       :     :                             :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                       :     :                             +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                                       :     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#6247]
                                       :     :                                   +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                                       :     :                                      +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                                       :     :                                         :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                                       :     :                                         :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#6238]
                                       :     :                                         :     +- Project [ws_item_sk#6695L]
                                       :     :                                         :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                                       :     :                                         :           :- Filter isnotnull(ws_item_sk#6695L)
                                       :     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                                       :     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7245, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                                       :     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :     :                                         :           :              +- Project [d_date_sk#6749L]
                                       :     :                                         :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                                       :     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6233]
                                       :     :                                         :              +- Project [d_date_sk#6749L]
                                       :     :                                         :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                                       :     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :     :                                         +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                                       :     :                                            +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#6239]
                                       :     :                                               +- Filter isnotnull(i_item_sk#6727L)
                                       :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6267]
                                       :        +- Project [d_date_sk#7165L]
                                       :           +- Filter ((((isnotnull(d_year#7171) AND isnotnull(d_moy#7173)) AND (d_year#7171 = 2000)) AND (d_moy#7173 = 11)) AND isnotnull(d_date_sk#7165L))
                                       :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7165L,d_year#7171,d_moy#7173] Batched: true, DataFilters: [isnotnull(d_year#7171), isnotnull(d_moy#7173), (d_year#7171 = 2000), (d_moy#7173 = 11), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                       +- SortMergeJoin [i_item_sk#7143L], [ss_item_sk#6503L], LeftSemi
                                          :- Sort [i_item_sk#7143L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(i_item_sk#7143L, 3000), ENSURE_REQUIREMENTS, [id=#6331]
                                          :     +- Filter isnotnull(i_item_sk#7143L)
                                          :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7143L,i_brand_id#7150,i_class_id#7152,i_category_id#7154] Batched: true, DataFilters: [isnotnull(i_item_sk#7143L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                          +- Sort [ss_item_sk#6503L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(ss_item_sk#6503L, 3000), ENSURE_REQUIREMENTS, [id=#6332]
                                                +- Project [i_item_sk#6514L AS ss_item_sk#6503L]
                                                   +- BroadcastHashJoin [i_brand_id#6521, i_class_id#6523, i_category_id#6525], [brand_id#6500, class_id#6501, category_id#6502], Inner, BuildRight, false
                                                      :- Filter ((isnotnull(i_brand_id#6521) AND isnotnull(i_class_id#6523)) AND isnotnull(i_category_id#6525))
                                                      :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6514L,i_brand_id#6521,i_class_id#6523,i_category_id#6525] Batched: true, DataFilters: [isnotnull(i_brand_id#6521), isnotnull(i_class_id#6523), isnotnull(i_category_id#6525)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                                      +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#6326]
                                                         +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                                            +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6323]
                                                               +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                                                  +- SortMergeJoin [coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502)], [coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738)], LeftSemi
                                                                     :- Sort [coalesce(brand_id#6500, 0) ASC NULLS FIRST, isnull(brand_id#6500) ASC NULLS FIRST, coalesce(class_id#6501, 0) ASC NULLS FIRST, isnull(class_id#6501) ASC NULLS FIRST, coalesce(category_id#6502, 0) ASC NULLS FIRST, isnull(category_id#6502) ASC NULLS FIRST], false, 0
                                                                     :  +- Exchange hashpartitioning(coalesce(brand_id#6500, 0), isnull(brand_id#6500), coalesce(class_id#6501, 0), isnull(class_id#6501), coalesce(category_id#6502, 0), isnull(category_id#6502), 3000), ENSURE_REQUIREMENTS, [id=#6316]
                                                                     :     +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                                                     :        +- Exchange hashpartitioning(brand_id#6500, class_id#6501, category_id#6502, 3000), ENSURE_REQUIREMENTS, [id=#6301]
                                                                     :           +- HashAggregate(keys=[brand_id#6500, class_id#6501, category_id#6502], functions=[], output=[brand_id#6500, class_id#6501, category_id#6502])
                                                                     :              +- Project [i_brand_id#6566 AS brand_id#6500, i_class_id#6568 AS class_id#6501, i_category_id#6570 AS category_id#6502]
                                                                     :                 +- SortMergeJoin [ss_item_sk#6537L], [i_item_sk#6559L], Inner
                                                                     :                    :- Sort [ss_item_sk#6537L ASC NULLS FIRST], false, 0
                                                                     :                    :  +- Exchange hashpartitioning(ss_item_sk#6537L, 3000), ENSURE_REQUIREMENTS, [id=#6293]
                                                                     :                    :     +- Project [ss_item_sk#6537L]
                                                                     :                    :        +- BroadcastHashJoin [ss_sold_date_sk#6558L], [d_date_sk#6581L], Inner, BuildRight, false
                                                                     :                    :           :- Filter isnotnull(ss_item_sk#6537L)
                                                                     :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#6537L,ss_sold_date_sk#6558L] Batched: true, DataFilters: [isnotnull(ss_item_sk#6537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#6558L), dynamicpruningexpression(ss_sold_date_sk#6558L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                                                                     :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7243, 0, true, Project [d_date_sk#6581L], [d_date_sk#6581L]
                                                                     :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                                     :                    :           :              +- Project [d_date_sk#6581L]
                                                                     :                    :           :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                                                                     :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6270]
                                                                     :                    :              +- Project [d_date_sk#6581L]
                                                                     :                    :                 +- Filter (((isnotnull(d_year#6587) AND (d_year#6587 >= 1999)) AND (d_year#6587 <= 2001)) AND isnotnull(d_date_sk#6581L))
                                                                     :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6581L,d_year#6587] Batched: true, DataFilters: [isnotnull(d_year#6587), (d_year#6587 >= 1999), (d_year#6587 <= 2001), isnotnull(d_date_sk#6581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     :                    +- Sort [i_item_sk#6559L ASC NULLS FIRST], false, 0
                                                                     :                       +- Exchange hashpartitioning(i_item_sk#6559L, 3000), ENSURE_REQUIREMENTS, [id=#6294]
                                                                     :                          +- SortMergeJoin [coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570)], [coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654)], LeftSemi
                                                                     :                             :- Sort [coalesce(i_brand_id#6566, 0) ASC NULLS FIRST, isnull(i_brand_id#6566) ASC NULLS FIRST, coalesce(i_class_id#6568, 0) ASC NULLS FIRST, isnull(i_class_id#6568) ASC NULLS FIRST, coalesce(i_category_id#6570, 0) ASC NULLS FIRST, isnull(i_category_id#6570) ASC NULLS FIRST], false, 0
                                                                     :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#6566, 0), isnull(i_brand_id#6566), coalesce(i_class_id#6568, 0), isnull(i_class_id#6568), coalesce(i_category_id#6570, 0), isnull(i_category_id#6570), 3000), ENSURE_REQUIREMENTS, [id=#6286]
                                                                     :                             :     +- Filter (((isnotnull(i_item_sk#6559L) AND isnotnull(i_brand_id#6566)) AND isnotnull(i_class_id#6568)) AND isnotnull(i_category_id#6570))
                                                                     :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6559L,i_brand_id#6566,i_class_id#6568,i_category_id#6570] Batched: true, DataFilters: [isnotnull(i_item_sk#6559L), isnotnull(i_brand_id#6566), isnotnull(i_class_id#6568), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                                                     :                             +- Sort [coalesce(i_brand_id#6650, 0) ASC NULLS FIRST, isnull(i_brand_id#6650) ASC NULLS FIRST, coalesce(i_class_id#6652, 0) ASC NULLS FIRST, isnull(i_class_id#6652) ASC NULLS FIRST, coalesce(i_category_id#6654, 0) ASC NULLS FIRST, isnull(i_category_id#6654) ASC NULLS FIRST], false, 0
                                                                     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#6650, 0), isnull(i_brand_id#6650), coalesce(i_class_id#6652, 0), isnull(i_class_id#6652), coalesce(i_category_id#6654, 0), isnull(i_category_id#6654), 3000), ENSURE_REQUIREMENTS, [id=#6287]
                                                                     :                                   +- Project [i_brand_id#6650, i_class_id#6652, i_category_id#6654]
                                                                     :                                      +- SortMergeJoin [cs_item_sk#6623L], [i_item_sk#6643L], Inner
                                                                     :                                         :- Sort [cs_item_sk#6623L ASC NULLS FIRST], false, 0
                                                                     :                                         :  +- Exchange hashpartitioning(cs_item_sk#6623L, 3000), ENSURE_REQUIREMENTS, [id=#6278]
                                                                     :                                         :     +- Project [cs_item_sk#6623L]
                                                                     :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#6642L], [d_date_sk#6665L], Inner, BuildRight, false
                                                                     :                                         :           :- Filter isnotnull(cs_item_sk#6623L)
                                                                     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#6623L,cs_sold_date_sk#6642L] Batched: true, DataFilters: [isnotnull(cs_item_sk#6623L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#6642L), dynamicpruningexpression(cs_sold_date_sk#6642L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                                                                     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7244, 0, true, Project [d_date_sk#6665L], [d_date_sk#6665L]
                                                                     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                                     :                                         :           :              +- Project [d_date_sk#6665L]
                                                                     :                                         :           :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                                                                     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6273]
                                                                     :                                         :              +- Project [d_date_sk#6665L]
                                                                     :                                         :                 +- Filter (((isnotnull(d_year#6671) AND (d_year#6671 >= 1999)) AND (d_year#6671 <= 2001)) AND isnotnull(d_date_sk#6665L))
                                                                     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6665L,d_year#6671] Batched: true, DataFilters: [isnotnull(d_year#6671), (d_year#6671 >= 1999), (d_year#6671 <= 2001), isnotnull(d_date_sk#6665L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     :                                         +- Sort [i_item_sk#6643L ASC NULLS FIRST], false, 0
                                                                     :                                            +- Exchange hashpartitioning(i_item_sk#6643L, 3000), ENSURE_REQUIREMENTS, [id=#6279]
                                                                     :                                               +- Filter isnotnull(i_item_sk#6643L)
                                                                     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6643L,i_brand_id#6650,i_class_id#6652,i_category_id#6654] Batched: true, DataFilters: [isnotnull(i_item_sk#6643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                                                     +- Sort [coalesce(i_brand_id#6734, 0) ASC NULLS FIRST, isnull(i_brand_id#6734) ASC NULLS FIRST, coalesce(i_class_id#6736, 0) ASC NULLS FIRST, isnull(i_class_id#6736) ASC NULLS FIRST, coalesce(i_category_id#6738, 0) ASC NULLS FIRST, isnull(i_category_id#6738) ASC NULLS FIRST], false, 0
                                                                        +- Exchange hashpartitioning(coalesce(i_brand_id#6734, 0), isnull(i_brand_id#6734), coalesce(i_class_id#6736, 0), isnull(i_class_id#6736), coalesce(i_category_id#6738, 0), isnull(i_category_id#6738), 3000), ENSURE_REQUIREMENTS, [id=#6317]
                                                                           +- Project [i_brand_id#6734, i_class_id#6736, i_category_id#6738]
                                                                              +- SortMergeJoin [ws_item_sk#6695L], [i_item_sk#6727L], Inner
                                                                                 :- Sort [ws_item_sk#6695L ASC NULLS FIRST], false, 0
                                                                                 :  +- Exchange hashpartitioning(ws_item_sk#6695L, 3000), ENSURE_REQUIREMENTS, [id=#6308]
                                                                                 :     +- Project [ws_item_sk#6695L]
                                                                                 :        +- BroadcastHashJoin [ws_sold_date_sk#6726L], [d_date_sk#6749L], Inner, BuildRight, false
                                                                                 :           :- Filter isnotnull(ws_item_sk#6695L)
                                                                                 :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#6695L,ws_sold_date_sk#6726L] Batched: true, DataFilters: [isnotnull(ws_item_sk#6695L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#6726L), dynamicpruningexpression(ws_sold_date_sk#6726L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                                                                                 :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7245, 0, true, Project [d_date_sk#6749L], [d_date_sk#6749L]
                                                                                 :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                                                 :           :              +- Project [d_date_sk#6749L]
                                                                                 :           :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                                                                                 :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#6303]
                                                                                 :              +- Project [d_date_sk#6749L]
                                                                                 :                 +- Filter (((isnotnull(d_year#6755) AND (d_year#6755 >= 1999)) AND (d_year#6755 <= 2001)) AND isnotnull(d_date_sk#6749L))
                                                                                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#6749L,d_year#6755] Batched: true, DataFilters: [isnotnull(d_year#6755), (d_year#6755 >= 1999), (d_year#6755 <= 2001), isnotnull(d_date_sk#6749L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                                 +- Sort [i_item_sk#6727L ASC NULLS FIRST], false, 0
                                                                                    +- Exchange hashpartitioning(i_item_sk#6727L, 3000), ENSURE_REQUIREMENTS, [id=#6309]
                                                                                       +- Filter isnotnull(i_item_sk#6727L)
                                                                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#6727L,i_brand_id#6734,i_class_id#6736,i_category_id#6738] Batched: true, DataFilters: [isnotnull(i_item_sk#6727L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>

read query: spark_queries/q14b.sql
explain query: q14b
== Parsed Logical Plan ==
CTE [cross_items, avg_sales]
:  :- 'SubqueryAlias cross_items
:  :  +- 'Project ['i_item_sk AS ss_item_sk#7310]
:  :     +- 'Filter ((('i_brand_id = 'brand_id) AND ('i_class_id = 'class_id)) AND ('i_category_id = 'category_id))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [item], [], false
:  :           +- 'SubqueryAlias x
:  :              +- 'Intersect false
:  :                 :- 'Intersect false
:  :                 :  :- 'Project ['iss.i_brand_id AS brand_id#7307, 'iss.i_class_id AS class_id#7308, 'iss.i_category_id AS category_id#7309]
:  :                 :  :  +- 'Filter ((('ss_item_sk = 'iss.i_item_sk) AND ('ss_sold_date_sk = 'd1.d_date_sk)) AND (('d1.d_year >= 1999) AND ('d1.d_year <= (1999 + 2))))
:  :                 :  :     +- 'Join Inner
:  :                 :  :        :- 'Join Inner
:  :                 :  :        :  :- 'UnresolvedRelation [store_sales], [], false
:  :                 :  :        :  +- 'SubqueryAlias iss
:  :                 :  :        :     +- 'UnresolvedRelation [item], [], false
:  :                 :  :        +- 'SubqueryAlias d1
:  :                 :  :           +- 'UnresolvedRelation [date_dim], [], false
:  :                 :  +- 'Project ['ics.i_brand_id, 'ics.i_class_id, 'ics.i_category_id]
:  :                 :     +- 'Filter ((('cs_item_sk = 'ics.i_item_sk) AND ('cs_sold_date_sk = 'd2.d_date_sk)) AND (('d2.d_year >= 1999) AND ('d2.d_year <= (1999 + 2))))
:  :                 :        +- 'Join Inner
:  :                 :           :- 'Join Inner
:  :                 :           :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :                 :           :  +- 'SubqueryAlias ics
:  :                 :           :     +- 'UnresolvedRelation [item], [], false
:  :                 :           +- 'SubqueryAlias d2
:  :                 :              +- 'UnresolvedRelation [date_dim], [], false
:  :                 +- 'Project ['iws.i_brand_id, 'iws.i_class_id, 'iws.i_category_id]
:  :                    +- 'Filter ((('ws_item_sk = 'iws.i_item_sk) AND ('ws_sold_date_sk = 'd3.d_date_sk)) AND (('d3.d_year >= 1999) AND ('d3.d_year <= (1999 + 2))))
:  :                       +- 'Join Inner
:  :                          :- 'Join Inner
:  :                          :  :- 'UnresolvedRelation [web_sales], [], false
:  :                          :  +- 'SubqueryAlias iws
:  :                          :     +- 'UnresolvedRelation [item], [], false
:  :                          +- 'SubqueryAlias d3
:  :                             +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias avg_sales
:     +- 'Project ['avg(('quantity * 'list_price)) AS average_sales#7317]
:        +- 'SubqueryAlias x
:           +- 'Union false, false
:              :- 'Union false, false
:              :  :- 'Project ['ss_quantity AS quantity#7311, 'ss_list_price AS list_price#7312]
:              :  :  +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND (('d_year >= 1998) AND ('d_year <= (1998 + 2))))
:              :  :     +- 'Join Inner
:              :  :        :- 'UnresolvedRelation [store_sales], [], false
:              :  :        +- 'UnresolvedRelation [date_dim], [], false
:              :  +- 'Project ['cs_quantity AS quantity#7313, 'cs_list_price AS list_price#7314]
:              :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) AND (('d_year >= 1998) AND ('d_year <= (1998 + 2))))
:              :        +- 'Join Inner
:              :           :- 'UnresolvedRelation [catalog_sales], [], false
:              :           +- 'UnresolvedRelation [date_dim], [], false
:              +- 'Project ['ws_quantity AS quantity#7315, 'ws_list_price AS list_price#7316]
:                 +- 'Filter (('ws_sold_date_sk = 'd_date_sk) AND (('d_year >= 1998) AND ('d_year <= (1998 + 2))))
:                    +- 'Join Inner
:                       :- 'UnresolvedRelation [web_sales], [], false
:                       +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['this_year.channel ASC NULLS FIRST, 'this_year.i_brand_id ASC NULLS FIRST, 'this_year.i_class_id ASC NULLS FIRST, 'this_year.i_category_id ASC NULLS FIRST], true
         +- 'Project [*]
            +- 'Filter ((('this_year.i_brand_id = 'last_year.i_brand_id) AND ('this_year.i_class_id = 'last_year.i_class_id)) AND ('this_year.i_category_id = 'last_year.i_category_id))
               +- 'Join Inner
                  :- 'SubqueryAlias this_year
                  :  +- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#7300 [])
                  :     :  +- 'Project ['average_sales]
                  :     :     +- 'UnresolvedRelation [avg_sales], [], false
                  :     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#7295, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#7296, 'count(1) AS number_sales#7297]
                  :        +- 'Filter (('ss_item_sk IN (list#7298 []) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_sold_date_sk = 'd_date_sk) AND ('d_week_seq = scalar-subquery#7299 [])))
                  :           :  :- 'Project ['ss_item_sk]
                  :           :  :  +- 'UnresolvedRelation [cross_items], [], false
                  :           :  +- 'Project ['d_week_seq]
                  :           :     +- 'Filter ((('d_year = (1998 + 1)) AND ('d_moy = 12)) AND ('d_dom = 16))
                  :           :        +- 'UnresolvedRelation [date_dim], [], false
                  :           +- 'Join Inner
                  :              :- 'Join Inner
                  :              :  :- 'UnresolvedRelation [store_sales], [], false
                  :              :  +- 'UnresolvedRelation [item], [], false
                  :              +- 'UnresolvedRelation [date_dim], [], false
                  +- 'SubqueryAlias last_year
                     +- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#7306 [])
                        :  +- 'Project ['average_sales]
                        :     +- 'UnresolvedRelation [avg_sales], [], false
                        +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#7301, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#7302, 'count(1) AS number_sales#7303]
                           +- 'Filter (('ss_item_sk IN (list#7304 []) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_sold_date_sk = 'd_date_sk) AND ('d_week_seq = scalar-subquery#7305 [])))
                              :  :- 'Project ['ss_item_sk]
                              :  :  +- 'UnresolvedRelation [cross_items], [], false
                              :  +- 'Project ['d_week_seq]
                              :     +- 'Filter ((('d_year = 1998) AND ('d_moy = 12)) AND ('d_dom = 16))
                              :        +- 'UnresolvedRelation [date_dim], [], false
                              +- 'Join Inner
                                 :- 'Join Inner
                                 :  :- 'UnresolvedRelation [store_sales], [], false
                                 :  +- 'UnresolvedRelation [item], [], false
                                 +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
channel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sales: double, number_sales: bigint, channel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sales: double, number_sales: bigint
WithCTE
:- CTERelationDef 10
:  +- SubqueryAlias cross_items
:     +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
:        +- Filter (((i_brand_id#7327 = brand_id#7307) AND (i_class_id#7329 = class_id#7308)) AND (i_category_id#7331 = category_id#7309))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_item_id#7321,i_rec_start_date#7322,i_rec_end_date#7323,i_item_desc#7324,i_current_price#7325,i_wholesale_cost#7326,i_brand_id#7327,i_brand#7328,i_class_id#7329,i_class#7330,i_category_id#7331,i_category#7332,i_manufact_id#7333,i_manufact#7334,i_size#7335,i_formulation#7336,i_color#7337,i_units#7338,i_container#7339,i_manager_id#7340,i_product_name#7341] orc
:              +- SubqueryAlias x
:                 +- Intersect false
:                    :- Intersect false
:                    :  :- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
:                    :  :  +- Filter (((ss_item_sk#7343L = i_item_sk#7365L) AND (ss_sold_date_sk#7364L = d_date_sk#7387L)) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= (1999 + 2))))
:                    :  :     +- Join Inner
:                    :  :        :- Join Inner
:                    :  :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                    :  :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7342L,ss_item_sk#7343L,ss_customer_sk#7344L,ss_cdemo_sk#7345L,ss_hdemo_sk#7346L,ss_addr_sk#7347L,ss_store_sk#7348L,ss_promo_sk#7349L,ss_ticket_number#7350L,ss_quantity#7351,ss_wholesale_cost#7352,ss_list_price#7353,ss_sales_price#7354,ss_ext_discount_amt#7355,ss_ext_sales_price#7356,ss_ext_wholesale_cost#7357,ss_ext_list_price#7358,ss_ext_tax#7359,ss_coupon_amt#7360,ss_net_paid#7361,ss_net_paid_inc_tax#7362,ss_net_profit#7363,ss_sold_date_sk#7364L] orc
:                    :  :        :  +- SubqueryAlias iss
:                    :  :        :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    :  :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_item_id#7366,i_rec_start_date#7367,i_rec_end_date#7368,i_item_desc#7369,i_current_price#7370,i_wholesale_cost#7371,i_brand_id#7372,i_brand#7373,i_class_id#7374,i_class#7375,i_category_id#7376,i_category#7377,i_manufact_id#7378,i_manufact#7379,i_size#7380,i_formulation#7381,i_color#7382,i_units#7383,i_container#7384,i_manager_id#7385,i_product_name#7386] orc
:                    :  :        +- SubqueryAlias d1
:                    :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
:                    :  +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
:                    :     +- Filter (((cs_item_sk#7429L = i_item_sk#7449L) AND (cs_sold_date_sk#7448L = d_date_sk#7471L)) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= (1999 + 2))))
:                    :        +- Join Inner
:                    :           :- Join Inner
:                    :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                    :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7415L,cs_ship_date_sk#7416L,cs_bill_customer_sk#7417L,cs_bill_cdemo_sk#7418L,cs_bill_hdemo_sk#7419L,cs_bill_addr_sk#7420L,cs_ship_customer_sk#7421L,cs_ship_cdemo_sk#7422L,cs_ship_hdemo_sk#7423L,cs_ship_addr_sk#7424L,cs_call_center_sk#7425L,cs_catalog_page_sk#7426L,cs_ship_mode_sk#7427L,cs_warehouse_sk#7428L,cs_item_sk#7429L,cs_promo_sk#7430L,cs_order_number#7431L,cs_quantity#7432,cs_wholesale_cost#7433,cs_list_price#7434,cs_sales_price#7435,cs_ext_discount_amt#7436,cs_ext_sales_price#7437,cs_ext_wholesale_cost#7438,... 10 more fields] orc
:                    :           :  +- SubqueryAlias ics
:                    :           :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_item_id#7450,i_rec_start_date#7451,i_rec_end_date#7452,i_item_desc#7453,i_current_price#7454,i_wholesale_cost#7455,i_brand_id#7456,i_brand#7457,i_class_id#7458,i_class#7459,i_category_id#7460,i_category#7461,i_manufact_id#7462,i_manufact#7463,i_size#7464,i_formulation#7465,i_color#7466,i_units#7467,i_container#7468,i_manager_id#7469,i_product_name#7470] orc
:                    :           +- SubqueryAlias d2
:                    :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
:                    +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
:                       +- Filter (((ws_item_sk#7501L = i_item_sk#7533L) AND (ws_sold_date_sk#7532L = d_date_sk#7555L)) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= (1999 + 2))))
:                          +- Join Inner
:                             :- Join Inner
:                             :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                             :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7499L,ws_ship_date_sk#7500L,ws_item_sk#7501L,ws_bill_customer_sk#7502L,ws_bill_cdemo_sk#7503L,ws_bill_hdemo_sk#7504L,ws_bill_addr_sk#7505L,ws_ship_customer_sk#7506L,ws_ship_cdemo_sk#7507L,ws_ship_hdemo_sk#7508L,ws_ship_addr_sk#7509L,ws_web_page_sk#7510L,ws_web_site_sk#7511L,ws_ship_mode_sk#7512L,ws_warehouse_sk#7513L,ws_promo_sk#7514L,ws_order_number#7515L,ws_quantity#7516,ws_wholesale_cost#7517,ws_list_price#7518,ws_sales_price#7519,ws_ext_discount_amt#7520,ws_ext_sales_price#7521,ws_ext_wholesale_cost#7522,... 10 more fields] orc
:                             :  +- SubqueryAlias iws
:                             :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                             :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_item_id#7534,i_rec_start_date#7535,i_rec_end_date#7536,i_item_desc#7537,i_current_price#7538,i_wholesale_cost#7539,i_brand_id#7540,i_brand#7541,i_class_id#7542,i_class#7543,i_category_id#7544,i_category#7545,i_manufact_id#7546,i_manufact#7547,i_size#7548,i_formulation#7549,i_color#7550,i_units#7551,i_container#7552,i_manager_id#7553,i_product_name#7554] orc
:                             +- SubqueryAlias d3
:                                +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                                   +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
:- CTERelationDef 11
:  +- SubqueryAlias avg_sales
:     +- Aggregate [avg((cast(quantity#7311 as double) * list_price#7312)) AS average_sales#7317]
:        +- SubqueryAlias x
:           +- Union false, false
:              :- Union false, false
:              :  :- Project [ss_quantity#7592 AS quantity#7311, ss_list_price#7594 AS list_price#7312]
:              :  :  +- Filter ((ss_sold_date_sk#7605L = d_date_sk#7606L) AND ((d_year#7612 >= 1998) AND (d_year#7612 <= (1998 + 2))))
:              :  :     +- Join Inner
:              :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7583L,ss_item_sk#7584L,ss_customer_sk#7585L,ss_cdemo_sk#7586L,ss_hdemo_sk#7587L,ss_addr_sk#7588L,ss_store_sk#7589L,ss_promo_sk#7590L,ss_ticket_number#7591L,ss_quantity#7592,ss_wholesale_cost#7593,ss_list_price#7594,ss_sales_price#7595,ss_ext_discount_amt#7596,ss_ext_sales_price#7597,ss_ext_wholesale_cost#7598,ss_ext_list_price#7599,ss_ext_tax#7600,ss_coupon_amt#7601,ss_net_paid#7602,ss_net_paid_inc_tax#7603,ss_net_profit#7604,ss_sold_date_sk#7605L] orc
:              :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_date_id#7607,d_date#7608,d_month_seq#7609,d_week_seq#7610,d_quarter_seq#7611,d_year#7612,d_dow#7613,d_moy#7614,d_dom#7615,d_qoy#7616,d_fy_year#7617,d_fy_quarter_seq#7618,d_fy_week_seq#7619,d_day_name#7620,d_quarter_name#7621,d_holiday#7622,d_weekend#7623,d_following_holiday#7624,d_first_dom#7625,d_last_dom#7626,d_same_day_ly#7627,d_same_day_lq#7628,d_current_day#7629,... 4 more fields] orc
:              :  +- Project [cs_quantity#7651 AS quantity#7313, cs_list_price#7653 AS list_price#7314]
:              :     +- Filter ((cs_sold_date_sk#7667L = d_date_sk#7668L) AND ((d_year#7674 >= 1998) AND (d_year#7674 <= (1998 + 2))))
:              :        +- Join Inner
:              :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7634L,cs_ship_date_sk#7635L,cs_bill_customer_sk#7636L,cs_bill_cdemo_sk#7637L,cs_bill_hdemo_sk#7638L,cs_bill_addr_sk#7639L,cs_ship_customer_sk#7640L,cs_ship_cdemo_sk#7641L,cs_ship_hdemo_sk#7642L,cs_ship_addr_sk#7643L,cs_call_center_sk#7644L,cs_catalog_page_sk#7645L,cs_ship_mode_sk#7646L,cs_warehouse_sk#7647L,cs_item_sk#7648L,cs_promo_sk#7649L,cs_order_number#7650L,cs_quantity#7651,cs_wholesale_cost#7652,cs_list_price#7653,cs_sales_price#7654,cs_ext_discount_amt#7655,cs_ext_sales_price#7656,cs_ext_wholesale_cost#7657,... 10 more fields] orc
:              :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_date_id#7669,d_date#7670,d_month_seq#7671,d_week_seq#7672,d_quarter_seq#7673,d_year#7674,d_dow#7675,d_moy#7676,d_dom#7677,d_qoy#7678,d_fy_year#7679,d_fy_quarter_seq#7680,d_fy_week_seq#7681,d_day_name#7682,d_quarter_name#7683,d_holiday#7684,d_weekend#7685,d_following_holiday#7686,d_first_dom#7687,d_last_dom#7688,d_same_day_ly#7689,d_same_day_lq#7690,d_current_day#7691,... 4 more fields] orc
:              +- Project [ws_quantity#7713 AS quantity#7315, ws_list_price#7715 AS list_price#7316]
:                 +- Filter ((ws_sold_date_sk#7729L = d_date_sk#7730L) AND ((d_year#7736 >= 1998) AND (d_year#7736 <= (1998 + 2))))
:                    +- Join Inner
:                       :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                       :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7696L,ws_ship_date_sk#7697L,ws_item_sk#7698L,ws_bill_customer_sk#7699L,ws_bill_cdemo_sk#7700L,ws_bill_hdemo_sk#7701L,ws_bill_addr_sk#7702L,ws_ship_customer_sk#7703L,ws_ship_cdemo_sk#7704L,ws_ship_hdemo_sk#7705L,ws_ship_addr_sk#7706L,ws_web_page_sk#7707L,ws_web_site_sk#7708L,ws_ship_mode_sk#7709L,ws_warehouse_sk#7710L,ws_promo_sk#7711L,ws_order_number#7712L,ws_quantity#7713,ws_wholesale_cost#7714,ws_list_price#7715,ws_sales_price#7716,ws_ext_discount_amt#7717,ws_ext_sales_price#7718,ws_ext_wholesale_cost#7719,... 10 more fields] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_date_id#7731,d_date#7732,d_month_seq#7733,d_week_seq#7734,d_quarter_seq#7735,d_year#7736,d_dow#7737,d_moy#7738,d_dom#7739,d_qoy#7740,d_fy_year#7741,d_fy_quarter_seq#7742,d_fy_week_seq#7743,d_day_name#7744,d_quarter_name#7745,d_holiday#7746,d_weekend#7747,d_following_holiday#7748,d_first_dom#7749,d_last_dom#7750,d_same_day_ly#7751,d_same_day_lq#7752,d_current_day#7753,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [channel#7295 ASC NULLS FIRST, i_brand_id#7788 ASC NULLS FIRST, i_class_id#7790 ASC NULLS FIRST, i_category_id#7792 ASC NULLS FIRST], true
         +- Project [channel#7295, i_brand_id#7788, i_class_id#7790, i_category_id#7792, sales#7296, number_sales#7297L, channel#7301, i_brand_id#7861, i_class_id#7863, i_category_id#7865, sales#7302, number_sales#7303L]
            +- Filter (((i_brand_id#7788 = i_brand_id#7861) AND (i_class_id#7790 = i_class_id#7863)) AND (i_category_id#7792 = i_category_id#7865))
               +- Join Inner
                  :- SubqueryAlias this_year
                  :  +- Filter (sales#7296 > scalar-subquery#7300 [])
                  :     :  +- Project [average_sales#7317]
                  :     :     +- SubqueryAlias avg_sales
                  :     :        +- CTERelationRef 11, true, [average_sales#7317]
                  :     +- Aggregate [i_brand_id#7788, i_class_id#7790, i_category_id#7792], [store AS channel#7295, i_brand_id#7788, i_class_id#7790, i_category_id#7792, sum((cast(ss_quantity#7767 as double) * ss_list_price#7769)) AS sales#7296, count(1) AS number_sales#7297L]
                  :        +- Filter ((ss_item_sk#7759L IN (list#7298 []) AND (ss_item_sk#7759L = i_item_sk#7781L)) AND ((ss_sold_date_sk#7780L = d_date_sk#7803L) AND (d_week_seq#7807 = scalar-subquery#7299 [])))
                  :           :  :- Project [ss_item_sk#7310L]
                  :           :  :  +- SubqueryAlias cross_items
                  :           :  :     +- CTERelationRef 10, true, [ss_item_sk#7310L]
                  :           :  +- Project [d_week_seq#7908]
                  :           :     +- Filter (((d_year#7910 = (1998 + 1)) AND (d_moy#7912 = 12)) AND (d_dom#7913 = 16))
                  :           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7904L,d_date_id#7905,d_date#7906,d_month_seq#7907,d_week_seq#7908,d_quarter_seq#7909,d_year#7910,d_dow#7911,d_moy#7912,d_dom#7913,d_qoy#7914,d_fy_year#7915,d_fy_quarter_seq#7916,d_fy_week_seq#7917,d_day_name#7918,d_quarter_name#7919,d_holiday#7920,d_weekend#7921,d_following_holiday#7922,d_first_dom#7923,d_last_dom#7924,d_same_day_ly#7925,d_same_day_lq#7926,d_current_day#7927,... 4 more fields] orc
                  :           +- Join Inner
                  :              :- Join Inner
                  :              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                  :              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7758L,ss_item_sk#7759L,ss_customer_sk#7760L,ss_cdemo_sk#7761L,ss_hdemo_sk#7762L,ss_addr_sk#7763L,ss_store_sk#7764L,ss_promo_sk#7765L,ss_ticket_number#7766L,ss_quantity#7767,ss_wholesale_cost#7768,ss_list_price#7769,ss_sales_price#7770,ss_ext_discount_amt#7771,ss_ext_sales_price#7772,ss_ext_wholesale_cost#7773,ss_ext_list_price#7774,ss_ext_tax#7775,ss_coupon_amt#7776,ss_net_paid#7777,ss_net_paid_inc_tax#7778,ss_net_profit#7779,ss_sold_date_sk#7780L] orc
                  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7781L,i_item_id#7782,i_rec_start_date#7783,i_rec_end_date#7784,i_item_desc#7785,i_current_price#7786,i_wholesale_cost#7787,i_brand_id#7788,i_brand#7789,i_class_id#7790,i_class#7791,i_category_id#7792,i_category#7793,i_manufact_id#7794,i_manufact#7795,i_size#7796,i_formulation#7797,i_color#7798,i_units#7799,i_container#7800,i_manager_id#7801,i_product_name#7802] orc
                  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7803L,d_date_id#7804,d_date#7805,d_month_seq#7806,d_week_seq#7807,d_quarter_seq#7808,d_year#7809,d_dow#7810,d_moy#7811,d_dom#7812,d_qoy#7813,d_fy_year#7814,d_fy_quarter_seq#7815,d_fy_week_seq#7816,d_day_name#7817,d_quarter_name#7818,d_holiday#7819,d_weekend#7820,d_following_holiday#7821,d_first_dom#7822,d_last_dom#7823,d_same_day_ly#7824,d_same_day_lq#7825,d_current_day#7826,... 4 more fields] orc
                  +- SubqueryAlias last_year
                     +- Filter (sales#7302 > scalar-subquery#7306 [])
                        :  +- Project [average_sales#7317]
                        :     +- SubqueryAlias avg_sales
                        :        +- CTERelationRef 11, true, [average_sales#7317]
                        +- Aggregate [i_brand_id#7861, i_class_id#7863, i_category_id#7865], [store AS channel#7301, i_brand_id#7861, i_class_id#7863, i_category_id#7865, sum((cast(ss_quantity#7840 as double) * ss_list_price#7842)) AS sales#7302, count(1) AS number_sales#7303L]
                           +- Filter ((ss_item_sk#7832L IN (list#7304 []) AND (ss_item_sk#7832L = i_item_sk#7854L)) AND ((ss_sold_date_sk#7853L = d_date_sk#7876L) AND (d_week_seq#7880 = scalar-subquery#7305 [])))
                              :  :- Project [ss_item_sk#7310L]
                              :  :  +- SubqueryAlias cross_items
                              :  :     +- CTERelationRef 10, true, [ss_item_sk#7310L]
                              :  +- Project [d_week_seq#7936]
                              :     +- Filter (((d_year#7938 = 1998) AND (d_moy#7940 = 12)) AND (d_dom#7941 = 16))
                              :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7932L,d_date_id#7933,d_date#7934,d_month_seq#7935,d_week_seq#7936,d_quarter_seq#7937,d_year#7938,d_dow#7939,d_moy#7940,d_dom#7941,d_qoy#7942,d_fy_year#7943,d_fy_quarter_seq#7944,d_fy_week_seq#7945,d_day_name#7946,d_quarter_name#7947,d_holiday#7948,d_weekend#7949,d_following_holiday#7950,d_first_dom#7951,d_last_dom#7952,d_same_day_ly#7953,d_same_day_lq#7954,d_current_day#7955,... 4 more fields] orc
                              +- Join Inner
                                 :- Join Inner
                                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7831L,ss_item_sk#7832L,ss_customer_sk#7833L,ss_cdemo_sk#7834L,ss_hdemo_sk#7835L,ss_addr_sk#7836L,ss_store_sk#7837L,ss_promo_sk#7838L,ss_ticket_number#7839L,ss_quantity#7840,ss_wholesale_cost#7841,ss_list_price#7842,ss_sales_price#7843,ss_ext_discount_amt#7844,ss_ext_sales_price#7845,ss_ext_wholesale_cost#7846,ss_ext_list_price#7847,ss_ext_tax#7848,ss_coupon_amt#7849,ss_net_paid#7850,ss_net_paid_inc_tax#7851,ss_net_profit#7852,ss_sold_date_sk#7853L] orc
                                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7854L,i_item_id#7855,i_rec_start_date#7856,i_rec_end_date#7857,i_item_desc#7858,i_current_price#7859,i_wholesale_cost#7860,i_brand_id#7861,i_brand#7862,i_class_id#7863,i_class#7864,i_category_id#7865,i_category#7866,i_manufact_id#7867,i_manufact#7868,i_size#7869,i_formulation#7870,i_color#7871,i_units#7872,i_container#7873,i_manager_id#7874,i_product_name#7875] orc
                                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7876L,d_date_id#7877,d_date#7878,d_month_seq#7879,d_week_seq#7880,d_quarter_seq#7881,d_year#7882,d_dow#7883,d_moy#7884,d_dom#7885,d_qoy#7886,d_fy_year#7887,d_fy_quarter_seq#7888,d_fy_week_seq#7889,d_day_name#7890,d_quarter_name#7891,d_holiday#7892,d_weekend#7893,d_following_holiday#7894,d_first_dom#7895,d_last_dom#7896,d_same_day_ly#7897,d_same_day_lq#7898,d_current_day#7899,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_brand_id#7788 ASC NULLS FIRST, i_class_id#7790 ASC NULLS FIRST, i_category_id#7792 ASC NULLS FIRST], true
      +- Join Inner, (((i_brand_id#7788 = i_brand_id#7861) AND (i_class_id#7790 = i_class_id#7863)) AND (i_category_id#7792 = i_category_id#7865))
         :- Filter (isnotnull(sales#7296) AND (sales#7296 > scalar-subquery#7300 []))
         :  :  +- Aggregate [avg((cast(quantity#7311 as double) * list_price#7312)) AS average_sales#7317]
         :  :     +- Union false, false
         :  :        :- Project [ss_quantity#7592 AS quantity#7311, ss_list_price#7594 AS list_price#7312]
         :  :        :  +- Join Inner, (ss_sold_date_sk#7605L = d_date_sk#7606L)
         :  :        :     :- Project [ss_quantity#7592, ss_list_price#7594, ss_sold_date_sk#7605L]
         :  :        :     :  +- Filter (isnotnull(ss_sold_date_sk#7605L) AND dynamicpruning#7983 [ss_sold_date_sk#7605L])
         :  :        :     :     :  +- Project [d_date_sk#7606L]
         :  :        :     :     :     +- Filter ((isnotnull(d_year#7612) AND ((d_year#7612 >= 1998) AND (d_year#7612 <= 2000))) AND isnotnull(d_date_sk#7606L))
         :  :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_date_id#7607,d_date#7608,d_month_seq#7609,d_week_seq#7610,d_quarter_seq#7611,d_year#7612,d_dow#7613,d_moy#7614,d_dom#7615,d_qoy#7616,d_fy_year#7617,d_fy_quarter_seq#7618,d_fy_week_seq#7619,d_day_name#7620,d_quarter_name#7621,d_holiday#7622,d_weekend#7623,d_following_holiday#7624,d_first_dom#7625,d_last_dom#7626,d_same_day_ly#7627,d_same_day_lq#7628,d_current_day#7629,... 4 more fields] orc
         :  :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7583L,ss_item_sk#7584L,ss_customer_sk#7585L,ss_cdemo_sk#7586L,ss_hdemo_sk#7587L,ss_addr_sk#7588L,ss_store_sk#7589L,ss_promo_sk#7590L,ss_ticket_number#7591L,ss_quantity#7592,ss_wholesale_cost#7593,ss_list_price#7594,ss_sales_price#7595,ss_ext_discount_amt#7596,ss_ext_sales_price#7597,ss_ext_wholesale_cost#7598,ss_ext_list_price#7599,ss_ext_tax#7600,ss_coupon_amt#7601,ss_net_paid#7602,ss_net_paid_inc_tax#7603,ss_net_profit#7604,ss_sold_date_sk#7605L] orc
         :  :        :     +- Project [d_date_sk#7606L]
         :  :        :        +- Filter ((isnotnull(d_year#7612) AND ((d_year#7612 >= 1998) AND (d_year#7612 <= 2000))) AND isnotnull(d_date_sk#7606L))
         :  :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_date_id#7607,d_date#7608,d_month_seq#7609,d_week_seq#7610,d_quarter_seq#7611,d_year#7612,d_dow#7613,d_moy#7614,d_dom#7615,d_qoy#7616,d_fy_year#7617,d_fy_quarter_seq#7618,d_fy_week_seq#7619,d_day_name#7620,d_quarter_name#7621,d_holiday#7622,d_weekend#7623,d_following_holiday#7624,d_first_dom#7625,d_last_dom#7626,d_same_day_ly#7627,d_same_day_lq#7628,d_current_day#7629,... 4 more fields] orc
         :  :        :- Project [cs_quantity#7651 AS quantity#7313, cs_list_price#7653 AS list_price#7314]
         :  :        :  +- Join Inner, (cs_sold_date_sk#7667L = d_date_sk#7668L)
         :  :        :     :- Project [cs_quantity#7651, cs_list_price#7653, cs_sold_date_sk#7667L]
         :  :        :     :  +- Filter (isnotnull(cs_sold_date_sk#7667L) AND dynamicpruning#7984 [cs_sold_date_sk#7667L])
         :  :        :     :     :  +- Project [d_date_sk#7668L]
         :  :        :     :     :     +- Filter ((isnotnull(d_year#7674) AND ((d_year#7674 >= 1998) AND (d_year#7674 <= 2000))) AND isnotnull(d_date_sk#7668L))
         :  :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_date_id#7669,d_date#7670,d_month_seq#7671,d_week_seq#7672,d_quarter_seq#7673,d_year#7674,d_dow#7675,d_moy#7676,d_dom#7677,d_qoy#7678,d_fy_year#7679,d_fy_quarter_seq#7680,d_fy_week_seq#7681,d_day_name#7682,d_quarter_name#7683,d_holiday#7684,d_weekend#7685,d_following_holiday#7686,d_first_dom#7687,d_last_dom#7688,d_same_day_ly#7689,d_same_day_lq#7690,d_current_day#7691,... 4 more fields] orc
         :  :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7634L,cs_ship_date_sk#7635L,cs_bill_customer_sk#7636L,cs_bill_cdemo_sk#7637L,cs_bill_hdemo_sk#7638L,cs_bill_addr_sk#7639L,cs_ship_customer_sk#7640L,cs_ship_cdemo_sk#7641L,cs_ship_hdemo_sk#7642L,cs_ship_addr_sk#7643L,cs_call_center_sk#7644L,cs_catalog_page_sk#7645L,cs_ship_mode_sk#7646L,cs_warehouse_sk#7647L,cs_item_sk#7648L,cs_promo_sk#7649L,cs_order_number#7650L,cs_quantity#7651,cs_wholesale_cost#7652,cs_list_price#7653,cs_sales_price#7654,cs_ext_discount_amt#7655,cs_ext_sales_price#7656,cs_ext_wholesale_cost#7657,... 10 more fields] orc
         :  :        :     +- Project [d_date_sk#7668L]
         :  :        :        +- Filter ((isnotnull(d_year#7674) AND ((d_year#7674 >= 1998) AND (d_year#7674 <= 2000))) AND isnotnull(d_date_sk#7668L))
         :  :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_date_id#7669,d_date#7670,d_month_seq#7671,d_week_seq#7672,d_quarter_seq#7673,d_year#7674,d_dow#7675,d_moy#7676,d_dom#7677,d_qoy#7678,d_fy_year#7679,d_fy_quarter_seq#7680,d_fy_week_seq#7681,d_day_name#7682,d_quarter_name#7683,d_holiday#7684,d_weekend#7685,d_following_holiday#7686,d_first_dom#7687,d_last_dom#7688,d_same_day_ly#7689,d_same_day_lq#7690,d_current_day#7691,... 4 more fields] orc
         :  :        +- Project [ws_quantity#7713 AS quantity#7315, ws_list_price#7715 AS list_price#7316]
         :  :           +- Join Inner, (ws_sold_date_sk#7729L = d_date_sk#7730L)
         :  :              :- Project [ws_quantity#7713, ws_list_price#7715, ws_sold_date_sk#7729L]
         :  :              :  +- Filter (isnotnull(ws_sold_date_sk#7729L) AND dynamicpruning#7985 [ws_sold_date_sk#7729L])
         :  :              :     :  +- Project [d_date_sk#7730L]
         :  :              :     :     +- Filter ((isnotnull(d_year#7736) AND ((d_year#7736 >= 1998) AND (d_year#7736 <= 2000))) AND isnotnull(d_date_sk#7730L))
         :  :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_date_id#7731,d_date#7732,d_month_seq#7733,d_week_seq#7734,d_quarter_seq#7735,d_year#7736,d_dow#7737,d_moy#7738,d_dom#7739,d_qoy#7740,d_fy_year#7741,d_fy_quarter_seq#7742,d_fy_week_seq#7743,d_day_name#7744,d_quarter_name#7745,d_holiday#7746,d_weekend#7747,d_following_holiday#7748,d_first_dom#7749,d_last_dom#7750,d_same_day_ly#7751,d_same_day_lq#7752,d_current_day#7753,... 4 more fields] orc
         :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7696L,ws_ship_date_sk#7697L,ws_item_sk#7698L,ws_bill_customer_sk#7699L,ws_bill_cdemo_sk#7700L,ws_bill_hdemo_sk#7701L,ws_bill_addr_sk#7702L,ws_ship_customer_sk#7703L,ws_ship_cdemo_sk#7704L,ws_ship_hdemo_sk#7705L,ws_ship_addr_sk#7706L,ws_web_page_sk#7707L,ws_web_site_sk#7708L,ws_ship_mode_sk#7709L,ws_warehouse_sk#7710L,ws_promo_sk#7711L,ws_order_number#7712L,ws_quantity#7713,ws_wholesale_cost#7714,ws_list_price#7715,ws_sales_price#7716,ws_ext_discount_amt#7717,ws_ext_sales_price#7718,ws_ext_wholesale_cost#7719,... 10 more fields] orc
         :  :              +- Project [d_date_sk#7730L]
         :  :                 +- Filter ((isnotnull(d_year#7736) AND ((d_year#7736 >= 1998) AND (d_year#7736 <= 2000))) AND isnotnull(d_date_sk#7730L))
         :  :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_date_id#7731,d_date#7732,d_month_seq#7733,d_week_seq#7734,d_quarter_seq#7735,d_year#7736,d_dow#7737,d_moy#7738,d_dom#7739,d_qoy#7740,d_fy_year#7741,d_fy_quarter_seq#7742,d_fy_week_seq#7743,d_day_name#7744,d_quarter_name#7745,d_holiday#7746,d_weekend#7747,d_following_holiday#7748,d_first_dom#7749,d_last_dom#7750,d_same_day_ly#7751,d_same_day_lq#7752,d_current_day#7753,... 4 more fields] orc
         :  +- Aggregate [i_brand_id#7788, i_class_id#7790, i_category_id#7792], [store AS channel#7295, i_brand_id#7788, i_class_id#7790, i_category_id#7792, sum((cast(ss_quantity#7767 as double) * ss_list_price#7769)) AS sales#7296, count(1) AS number_sales#7297L]
         :     +- Project [ss_quantity#7767, ss_list_price#7769, i_brand_id#7788, i_class_id#7790, i_category_id#7792]
         :        +- Join Inner, (ss_item_sk#7759L = i_item_sk#7781L)
         :           :- Project [ss_item_sk#7759L, ss_quantity#7767, ss_list_price#7769]
         :           :  +- Join Inner, (ss_sold_date_sk#7780L = d_date_sk#7803L)
         :           :     :- Join LeftSemi, (ss_item_sk#7759L = ss_item_sk#7310L)
         :           :     :  :- Project [ss_item_sk#7759L, ss_quantity#7767, ss_list_price#7769, ss_sold_date_sk#7780L]
         :           :     :  :  +- Filter ((isnotnull(ss_item_sk#7759L) AND isnotnull(ss_sold_date_sk#7780L)) AND dynamicpruning#7998 [ss_sold_date_sk#7780L])
         :           :     :  :     :  +- Project [d_date_sk#7803L]
         :           :     :  :     :     +- Filter ((isnotnull(d_week_seq#7807) AND (d_week_seq#7807 = scalar-subquery#7299 [])) AND isnotnull(d_date_sk#7803L))
         :           :     :  :     :        :  +- Project [d_week_seq#7908]
         :           :     :  :     :        :     +- Filter (((isnotnull(d_year#7910) AND isnotnull(d_moy#7912)) AND isnotnull(d_dom#7913)) AND (((d_year#7910 = 1999) AND (d_moy#7912 = 12)) AND (d_dom#7913 = 16)))
         :           :     :  :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7904L,d_date_id#7905,d_date#7906,d_month_seq#7907,d_week_seq#7908,d_quarter_seq#7909,d_year#7910,d_dow#7911,d_moy#7912,d_dom#7913,d_qoy#7914,d_fy_year#7915,d_fy_quarter_seq#7916,d_fy_week_seq#7917,d_day_name#7918,d_quarter_name#7919,d_holiday#7920,d_weekend#7921,d_following_holiday#7922,d_first_dom#7923,d_last_dom#7924,d_same_day_ly#7925,d_same_day_lq#7926,d_current_day#7927,... 4 more fields] orc
         :           :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7803L,d_date_id#7804,d_date#7805,d_month_seq#7806,d_week_seq#7807,d_quarter_seq#7808,d_year#7809,d_dow#7810,d_moy#7811,d_dom#7812,d_qoy#7813,d_fy_year#7814,d_fy_quarter_seq#7815,d_fy_week_seq#7816,d_day_name#7817,d_quarter_name#7818,d_holiday#7819,d_weekend#7820,d_following_holiday#7821,d_first_dom#7822,d_last_dom#7823,d_same_day_ly#7824,d_same_day_lq#7825,d_current_day#7826,... 4 more fields] orc
         :           :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7758L,ss_item_sk#7759L,ss_customer_sk#7760L,ss_cdemo_sk#7761L,ss_hdemo_sk#7762L,ss_addr_sk#7763L,ss_store_sk#7764L,ss_promo_sk#7765L,ss_ticket_number#7766L,ss_quantity#7767,ss_wholesale_cost#7768,ss_list_price#7769,ss_sales_price#7770,ss_ext_discount_amt#7771,ss_ext_sales_price#7772,ss_ext_wholesale_cost#7773,ss_ext_list_price#7774,ss_ext_tax#7775,ss_coupon_amt#7776,ss_net_paid#7777,ss_net_paid_inc_tax#7778,ss_net_profit#7779,ss_sold_date_sk#7780L] orc
         :           :     :  +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
         :           :     :     +- Join Inner, (((i_brand_id#7327 = brand_id#7307) AND (i_class_id#7329 = class_id#7308)) AND (i_category_id#7331 = category_id#7309))
         :           :     :        :- Project [i_item_sk#7320L, i_brand_id#7327, i_class_id#7329, i_category_id#7331]
         :           :     :        :  +- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
         :           :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_item_id#7321,i_rec_start_date#7322,i_rec_end_date#7323,i_item_desc#7324,i_current_price#7325,i_wholesale_cost#7326,i_brand_id#7327,i_brand#7328,i_class_id#7329,i_class#7330,i_category_id#7331,i_category#7332,i_manufact_id#7333,i_manufact#7334,i_size#7335,i_formulation#7336,i_color#7337,i_units#7338,i_container#7339,i_manager_id#7340,i_product_name#7341] orc
         :           :     :        +- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
         :           :     :           +- Join LeftSemi, (((brand_id#7307 <=> i_brand_id#7540) AND (class_id#7308 <=> i_class_id#7542)) AND (category_id#7309 <=> i_category_id#7544))
         :           :     :              :- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
         :           :     :              :  +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
         :           :     :              :     +- Join Inner, (ss_item_sk#7343L = i_item_sk#7365L)
         :           :     :              :        :- Project [ss_item_sk#7343L]
         :           :     :              :        :  +- Join Inner, (ss_sold_date_sk#7364L = d_date_sk#7387L)
         :           :     :              :        :     :- Project [ss_item_sk#7343L, ss_sold_date_sk#7364L]
         :           :     :              :        :     :  +- Filter ((isnotnull(ss_item_sk#7343L) AND isnotnull(ss_sold_date_sk#7364L)) AND dynamicpruning#7986 [ss_sold_date_sk#7364L])
         :           :     :              :        :     :     :  +- Project [d_date_sk#7387L]
         :           :     :              :        :     :     :     +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
         :           :     :              :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
         :           :     :              :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7342L,ss_item_sk#7343L,ss_customer_sk#7344L,ss_cdemo_sk#7345L,ss_hdemo_sk#7346L,ss_addr_sk#7347L,ss_store_sk#7348L,ss_promo_sk#7349L,ss_ticket_number#7350L,ss_quantity#7351,ss_wholesale_cost#7352,ss_list_price#7353,ss_sales_price#7354,ss_ext_discount_amt#7355,ss_ext_sales_price#7356,ss_ext_wholesale_cost#7357,ss_ext_list_price#7358,ss_ext_tax#7359,ss_coupon_amt#7360,ss_net_paid#7361,ss_net_paid_inc_tax#7362,ss_net_profit#7363,ss_sold_date_sk#7364L] orc
         :           :     :              :        :     +- Project [d_date_sk#7387L]
         :           :     :              :        :        +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
         :           :     :              :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
         :           :     :              :        +- Join LeftSemi, (((i_brand_id#7372 <=> i_brand_id#7456) AND (i_class_id#7374 <=> i_class_id#7458)) AND (i_category_id#7376 <=> i_category_id#7460))
         :           :     :              :           :- Project [i_item_sk#7365L, i_brand_id#7372, i_class_id#7374, i_category_id#7376]
         :           :     :              :           :  +- Filter (isnotnull(i_item_sk#7365L) AND ((isnotnull(i_brand_id#7372) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376)))
         :           :     :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_item_id#7366,i_rec_start_date#7367,i_rec_end_date#7368,i_item_desc#7369,i_current_price#7370,i_wholesale_cost#7371,i_brand_id#7372,i_brand#7373,i_class_id#7374,i_class#7375,i_category_id#7376,i_category#7377,i_manufact_id#7378,i_manufact#7379,i_size#7380,i_formulation#7381,i_color#7382,i_units#7383,i_container#7384,i_manager_id#7385,i_product_name#7386] orc
         :           :     :              :           +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
         :           :     :              :              +- Join Inner, (cs_item_sk#7429L = i_item_sk#7449L)
         :           :     :              :                 :- Project [cs_item_sk#7429L]
         :           :     :              :                 :  +- Join Inner, (cs_sold_date_sk#7448L = d_date_sk#7471L)
         :           :     :              :                 :     :- Project [cs_item_sk#7429L, cs_sold_date_sk#7448L]
         :           :     :              :                 :     :  +- Filter ((isnotnull(cs_item_sk#7429L) AND isnotnull(cs_sold_date_sk#7448L)) AND dynamicpruning#7987 [cs_sold_date_sk#7448L])
         :           :     :              :                 :     :     :  +- Project [d_date_sk#7471L]
         :           :     :              :                 :     :     :     +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
         :           :     :              :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
         :           :     :              :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7415L,cs_ship_date_sk#7416L,cs_bill_customer_sk#7417L,cs_bill_cdemo_sk#7418L,cs_bill_hdemo_sk#7419L,cs_bill_addr_sk#7420L,cs_ship_customer_sk#7421L,cs_ship_cdemo_sk#7422L,cs_ship_hdemo_sk#7423L,cs_ship_addr_sk#7424L,cs_call_center_sk#7425L,cs_catalog_page_sk#7426L,cs_ship_mode_sk#7427L,cs_warehouse_sk#7428L,cs_item_sk#7429L,cs_promo_sk#7430L,cs_order_number#7431L,cs_quantity#7432,cs_wholesale_cost#7433,cs_list_price#7434,cs_sales_price#7435,cs_ext_discount_amt#7436,cs_ext_sales_price#7437,cs_ext_wholesale_cost#7438,... 10 more fields] orc
         :           :     :              :                 :     +- Project [d_date_sk#7471L]
         :           :     :              :                 :        +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
         :           :     :              :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
         :           :     :              :                 +- Project [i_item_sk#7449L, i_brand_id#7456, i_class_id#7458, i_category_id#7460]
         :           :     :              :                    +- Filter isnotnull(i_item_sk#7449L)
         :           :     :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_item_id#7450,i_rec_start_date#7451,i_rec_end_date#7452,i_item_desc#7453,i_current_price#7454,i_wholesale_cost#7455,i_brand_id#7456,i_brand#7457,i_class_id#7458,i_class#7459,i_category_id#7460,i_category#7461,i_manufact_id#7462,i_manufact#7463,i_size#7464,i_formulation#7465,i_color#7466,i_units#7467,i_container#7468,i_manager_id#7469,i_product_name#7470] orc
         :           :     :              +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
         :           :     :                 +- Join Inner, (ws_item_sk#7501L = i_item_sk#7533L)
         :           :     :                    :- Project [ws_item_sk#7501L]
         :           :     :                    :  +- Join Inner, (ws_sold_date_sk#7532L = d_date_sk#7555L)
         :           :     :                    :     :- Project [ws_item_sk#7501L, ws_sold_date_sk#7532L]
         :           :     :                    :     :  +- Filter ((isnotnull(ws_item_sk#7501L) AND isnotnull(ws_sold_date_sk#7532L)) AND dynamicpruning#7988 [ws_sold_date_sk#7532L])
         :           :     :                    :     :     :  +- Project [d_date_sk#7555L]
         :           :     :                    :     :     :     +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
         :           :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
         :           :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7499L,ws_ship_date_sk#7500L,ws_item_sk#7501L,ws_bill_customer_sk#7502L,ws_bill_cdemo_sk#7503L,ws_bill_hdemo_sk#7504L,ws_bill_addr_sk#7505L,ws_ship_customer_sk#7506L,ws_ship_cdemo_sk#7507L,ws_ship_hdemo_sk#7508L,ws_ship_addr_sk#7509L,ws_web_page_sk#7510L,ws_web_site_sk#7511L,ws_ship_mode_sk#7512L,ws_warehouse_sk#7513L,ws_promo_sk#7514L,ws_order_number#7515L,ws_quantity#7516,ws_wholesale_cost#7517,ws_list_price#7518,ws_sales_price#7519,ws_ext_discount_amt#7520,ws_ext_sales_price#7521,ws_ext_wholesale_cost#7522,... 10 more fields] orc
         :           :     :                    :     +- Project [d_date_sk#7555L]
         :           :     :                    :        +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
         :           :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
         :           :     :                    +- Project [i_item_sk#7533L, i_brand_id#7540, i_class_id#7542, i_category_id#7544]
         :           :     :                       +- Filter isnotnull(i_item_sk#7533L)
         :           :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_item_id#7534,i_rec_start_date#7535,i_rec_end_date#7536,i_item_desc#7537,i_current_price#7538,i_wholesale_cost#7539,i_brand_id#7540,i_brand#7541,i_class_id#7542,i_class#7543,i_category_id#7544,i_category#7545,i_manufact_id#7546,i_manufact#7547,i_size#7548,i_formulation#7549,i_color#7550,i_units#7551,i_container#7552,i_manager_id#7553,i_product_name#7554] orc
         :           :     +- Project [d_date_sk#7803L]
         :           :        +- Filter ((isnotnull(d_week_seq#7807) AND (d_week_seq#7807 = scalar-subquery#7299 [])) AND isnotnull(d_date_sk#7803L))
         :           :           :  +- Project [d_week_seq#7908]
         :           :           :     +- Filter (((isnotnull(d_year#7910) AND isnotnull(d_moy#7912)) AND isnotnull(d_dom#7913)) AND (((d_year#7910 = 1999) AND (d_moy#7912 = 12)) AND (d_dom#7913 = 16)))
         :           :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7904L,d_date_id#7905,d_date#7906,d_month_seq#7907,d_week_seq#7908,d_quarter_seq#7909,d_year#7910,d_dow#7911,d_moy#7912,d_dom#7913,d_qoy#7914,d_fy_year#7915,d_fy_quarter_seq#7916,d_fy_week_seq#7917,d_day_name#7918,d_quarter_name#7919,d_holiday#7920,d_weekend#7921,d_following_holiday#7922,d_first_dom#7923,d_last_dom#7924,d_same_day_ly#7925,d_same_day_lq#7926,d_current_day#7927,... 4 more fields] orc
         :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7803L,d_date_id#7804,d_date#7805,d_month_seq#7806,d_week_seq#7807,d_quarter_seq#7808,d_year#7809,d_dow#7810,d_moy#7811,d_dom#7812,d_qoy#7813,d_fy_year#7814,d_fy_quarter_seq#7815,d_fy_week_seq#7816,d_day_name#7817,d_quarter_name#7818,d_holiday#7819,d_weekend#7820,d_following_holiday#7821,d_first_dom#7822,d_last_dom#7823,d_same_day_ly#7824,d_same_day_lq#7825,d_current_day#7826,... 4 more fields] orc
         :           +- Join LeftSemi, (i_item_sk#7781L = ss_item_sk#7310L)
         :              :- Project [i_item_sk#7781L, i_brand_id#7788, i_class_id#7790, i_category_id#7792]
         :              :  +- Filter (((isnotnull(i_item_sk#7781L) AND isnotnull(i_brand_id#7788)) AND isnotnull(i_class_id#7790)) AND isnotnull(i_category_id#7792))
         :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7781L,i_item_id#7782,i_rec_start_date#7783,i_rec_end_date#7784,i_item_desc#7785,i_current_price#7786,i_wholesale_cost#7787,i_brand_id#7788,i_brand#7789,i_class_id#7790,i_class#7791,i_category_id#7792,i_category#7793,i_manufact_id#7794,i_manufact#7795,i_size#7796,i_formulation#7797,i_color#7798,i_units#7799,i_container#7800,i_manager_id#7801,i_product_name#7802] orc
         :              +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
         :                 +- Join Inner, (((i_brand_id#7327 = brand_id#7307) AND (i_class_id#7329 = class_id#7308)) AND (i_category_id#7331 = category_id#7309))
         :                    :- Project [i_item_sk#7320L, i_brand_id#7327, i_class_id#7329, i_category_id#7331]
         :                    :  +- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
         :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_item_id#7321,i_rec_start_date#7322,i_rec_end_date#7323,i_item_desc#7324,i_current_price#7325,i_wholesale_cost#7326,i_brand_id#7327,i_brand#7328,i_class_id#7329,i_class#7330,i_category_id#7331,i_category#7332,i_manufact_id#7333,i_manufact#7334,i_size#7335,i_formulation#7336,i_color#7337,i_units#7338,i_container#7339,i_manager_id#7340,i_product_name#7341] orc
         :                    +- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
         :                       +- Join LeftSemi, (((brand_id#7307 <=> i_brand_id#7540) AND (class_id#7308 <=> i_class_id#7542)) AND (category_id#7309 <=> i_category_id#7544))
         :                          :- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
         :                          :  +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
         :                          :     +- Join Inner, (ss_item_sk#7343L = i_item_sk#7365L)
         :                          :        :- Project [ss_item_sk#7343L]
         :                          :        :  +- Join Inner, (ss_sold_date_sk#7364L = d_date_sk#7387L)
         :                          :        :     :- Project [ss_item_sk#7343L, ss_sold_date_sk#7364L]
         :                          :        :     :  +- Filter ((isnotnull(ss_item_sk#7343L) AND isnotnull(ss_sold_date_sk#7364L)) AND dynamicpruning#7986 [ss_sold_date_sk#7364L])
         :                          :        :     :     :  +- Project [d_date_sk#7387L]
         :                          :        :     :     :     +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
         :                          :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
         :                          :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7342L,ss_item_sk#7343L,ss_customer_sk#7344L,ss_cdemo_sk#7345L,ss_hdemo_sk#7346L,ss_addr_sk#7347L,ss_store_sk#7348L,ss_promo_sk#7349L,ss_ticket_number#7350L,ss_quantity#7351,ss_wholesale_cost#7352,ss_list_price#7353,ss_sales_price#7354,ss_ext_discount_amt#7355,ss_ext_sales_price#7356,ss_ext_wholesale_cost#7357,ss_ext_list_price#7358,ss_ext_tax#7359,ss_coupon_amt#7360,ss_net_paid#7361,ss_net_paid_inc_tax#7362,ss_net_profit#7363,ss_sold_date_sk#7364L] orc
         :                          :        :     +- Project [d_date_sk#7387L]
         :                          :        :        +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
         :                          :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
         :                          :        +- Join LeftSemi, (((i_brand_id#7372 <=> i_brand_id#7456) AND (i_class_id#7374 <=> i_class_id#7458)) AND (i_category_id#7376 <=> i_category_id#7460))
         :                          :           :- Project [i_item_sk#7365L, i_brand_id#7372, i_class_id#7374, i_category_id#7376]
         :                          :           :  +- Filter (isnotnull(i_item_sk#7365L) AND ((isnotnull(i_brand_id#7372) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376)))
         :                          :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_item_id#7366,i_rec_start_date#7367,i_rec_end_date#7368,i_item_desc#7369,i_current_price#7370,i_wholesale_cost#7371,i_brand_id#7372,i_brand#7373,i_class_id#7374,i_class#7375,i_category_id#7376,i_category#7377,i_manufact_id#7378,i_manufact#7379,i_size#7380,i_formulation#7381,i_color#7382,i_units#7383,i_container#7384,i_manager_id#7385,i_product_name#7386] orc
         :                          :           +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
         :                          :              +- Join Inner, (cs_item_sk#7429L = i_item_sk#7449L)
         :                          :                 :- Project [cs_item_sk#7429L]
         :                          :                 :  +- Join Inner, (cs_sold_date_sk#7448L = d_date_sk#7471L)
         :                          :                 :     :- Project [cs_item_sk#7429L, cs_sold_date_sk#7448L]
         :                          :                 :     :  +- Filter ((isnotnull(cs_item_sk#7429L) AND isnotnull(cs_sold_date_sk#7448L)) AND dynamicpruning#7987 [cs_sold_date_sk#7448L])
         :                          :                 :     :     :  +- Project [d_date_sk#7471L]
         :                          :                 :     :     :     +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
         :                          :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
         :                          :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7415L,cs_ship_date_sk#7416L,cs_bill_customer_sk#7417L,cs_bill_cdemo_sk#7418L,cs_bill_hdemo_sk#7419L,cs_bill_addr_sk#7420L,cs_ship_customer_sk#7421L,cs_ship_cdemo_sk#7422L,cs_ship_hdemo_sk#7423L,cs_ship_addr_sk#7424L,cs_call_center_sk#7425L,cs_catalog_page_sk#7426L,cs_ship_mode_sk#7427L,cs_warehouse_sk#7428L,cs_item_sk#7429L,cs_promo_sk#7430L,cs_order_number#7431L,cs_quantity#7432,cs_wholesale_cost#7433,cs_list_price#7434,cs_sales_price#7435,cs_ext_discount_amt#7436,cs_ext_sales_price#7437,cs_ext_wholesale_cost#7438,... 10 more fields] orc
         :                          :                 :     +- Project [d_date_sk#7471L]
         :                          :                 :        +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
         :                          :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
         :                          :                 +- Project [i_item_sk#7449L, i_brand_id#7456, i_class_id#7458, i_category_id#7460]
         :                          :                    +- Filter isnotnull(i_item_sk#7449L)
         :                          :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_item_id#7450,i_rec_start_date#7451,i_rec_end_date#7452,i_item_desc#7453,i_current_price#7454,i_wholesale_cost#7455,i_brand_id#7456,i_brand#7457,i_class_id#7458,i_class#7459,i_category_id#7460,i_category#7461,i_manufact_id#7462,i_manufact#7463,i_size#7464,i_formulation#7465,i_color#7466,i_units#7467,i_container#7468,i_manager_id#7469,i_product_name#7470] orc
         :                          +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
         :                             +- Join Inner, (ws_item_sk#7501L = i_item_sk#7533L)
         :                                :- Project [ws_item_sk#7501L]
         :                                :  +- Join Inner, (ws_sold_date_sk#7532L = d_date_sk#7555L)
         :                                :     :- Project [ws_item_sk#7501L, ws_sold_date_sk#7532L]
         :                                :     :  +- Filter ((isnotnull(ws_item_sk#7501L) AND isnotnull(ws_sold_date_sk#7532L)) AND dynamicpruning#7988 [ws_sold_date_sk#7532L])
         :                                :     :     :  +- Project [d_date_sk#7555L]
         :                                :     :     :     +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
         :                                :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
         :                                :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7499L,ws_ship_date_sk#7500L,ws_item_sk#7501L,ws_bill_customer_sk#7502L,ws_bill_cdemo_sk#7503L,ws_bill_hdemo_sk#7504L,ws_bill_addr_sk#7505L,ws_ship_customer_sk#7506L,ws_ship_cdemo_sk#7507L,ws_ship_hdemo_sk#7508L,ws_ship_addr_sk#7509L,ws_web_page_sk#7510L,ws_web_site_sk#7511L,ws_ship_mode_sk#7512L,ws_warehouse_sk#7513L,ws_promo_sk#7514L,ws_order_number#7515L,ws_quantity#7516,ws_wholesale_cost#7517,ws_list_price#7518,ws_sales_price#7519,ws_ext_discount_amt#7520,ws_ext_sales_price#7521,ws_ext_wholesale_cost#7522,... 10 more fields] orc
         :                                :     +- Project [d_date_sk#7555L]
         :                                :        +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
         :                                :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
         :                                +- Project [i_item_sk#7533L, i_brand_id#7540, i_class_id#7542, i_category_id#7544]
         :                                   +- Filter isnotnull(i_item_sk#7533L)
         :                                      +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_item_id#7534,i_rec_start_date#7535,i_rec_end_date#7536,i_item_desc#7537,i_current_price#7538,i_wholesale_cost#7539,i_brand_id#7540,i_brand#7541,i_class_id#7542,i_class#7543,i_category_id#7544,i_category#7545,i_manufact_id#7546,i_manufact#7547,i_size#7548,i_formulation#7549,i_color#7550,i_units#7551,i_container#7552,i_manager_id#7553,i_product_name#7554] orc
         +- Filter (isnotnull(sales#7302) AND (sales#7302 > scalar-subquery#7306 []))
            :  +- Aggregate [avg((cast(quantity#7311 as double) * list_price#7312)) AS average_sales#7317]
            :     +- Union false, false
            :        :- Project [ss_quantity#7592 AS quantity#7311, ss_list_price#7594 AS list_price#7312]
            :        :  +- Join Inner, (ss_sold_date_sk#7605L = d_date_sk#7606L)
            :        :     :- Project [ss_quantity#7592, ss_list_price#7594, ss_sold_date_sk#7605L]
            :        :     :  +- Filter (isnotnull(ss_sold_date_sk#7605L) AND dynamicpruning#7989 [ss_sold_date_sk#7605L])
            :        :     :     :  +- Project [d_date_sk#7606L]
            :        :     :     :     +- Filter ((isnotnull(d_year#7612) AND ((d_year#7612 >= 1998) AND (d_year#7612 <= 2000))) AND isnotnull(d_date_sk#7606L))
            :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_date_id#7607,d_date#7608,d_month_seq#7609,d_week_seq#7610,d_quarter_seq#7611,d_year#7612,d_dow#7613,d_moy#7614,d_dom#7615,d_qoy#7616,d_fy_year#7617,d_fy_quarter_seq#7618,d_fy_week_seq#7619,d_day_name#7620,d_quarter_name#7621,d_holiday#7622,d_weekend#7623,d_following_holiday#7624,d_first_dom#7625,d_last_dom#7626,d_same_day_ly#7627,d_same_day_lq#7628,d_current_day#7629,... 4 more fields] orc
            :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7583L,ss_item_sk#7584L,ss_customer_sk#7585L,ss_cdemo_sk#7586L,ss_hdemo_sk#7587L,ss_addr_sk#7588L,ss_store_sk#7589L,ss_promo_sk#7590L,ss_ticket_number#7591L,ss_quantity#7592,ss_wholesale_cost#7593,ss_list_price#7594,ss_sales_price#7595,ss_ext_discount_amt#7596,ss_ext_sales_price#7597,ss_ext_wholesale_cost#7598,ss_ext_list_price#7599,ss_ext_tax#7600,ss_coupon_amt#7601,ss_net_paid#7602,ss_net_paid_inc_tax#7603,ss_net_profit#7604,ss_sold_date_sk#7605L] orc
            :        :     +- Project [d_date_sk#7606L]
            :        :        +- Filter ((isnotnull(d_year#7612) AND ((d_year#7612 >= 1998) AND (d_year#7612 <= 2000))) AND isnotnull(d_date_sk#7606L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_date_id#7607,d_date#7608,d_month_seq#7609,d_week_seq#7610,d_quarter_seq#7611,d_year#7612,d_dow#7613,d_moy#7614,d_dom#7615,d_qoy#7616,d_fy_year#7617,d_fy_quarter_seq#7618,d_fy_week_seq#7619,d_day_name#7620,d_quarter_name#7621,d_holiday#7622,d_weekend#7623,d_following_holiday#7624,d_first_dom#7625,d_last_dom#7626,d_same_day_ly#7627,d_same_day_lq#7628,d_current_day#7629,... 4 more fields] orc
            :        :- Project [cs_quantity#7651 AS quantity#7313, cs_list_price#7653 AS list_price#7314]
            :        :  +- Join Inner, (cs_sold_date_sk#7667L = d_date_sk#7668L)
            :        :     :- Project [cs_quantity#7651, cs_list_price#7653, cs_sold_date_sk#7667L]
            :        :     :  +- Filter (isnotnull(cs_sold_date_sk#7667L) AND dynamicpruning#7990 [cs_sold_date_sk#7667L])
            :        :     :     :  +- Project [d_date_sk#7668L]
            :        :     :     :     +- Filter ((isnotnull(d_year#7674) AND ((d_year#7674 >= 1998) AND (d_year#7674 <= 2000))) AND isnotnull(d_date_sk#7668L))
            :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_date_id#7669,d_date#7670,d_month_seq#7671,d_week_seq#7672,d_quarter_seq#7673,d_year#7674,d_dow#7675,d_moy#7676,d_dom#7677,d_qoy#7678,d_fy_year#7679,d_fy_quarter_seq#7680,d_fy_week_seq#7681,d_day_name#7682,d_quarter_name#7683,d_holiday#7684,d_weekend#7685,d_following_holiday#7686,d_first_dom#7687,d_last_dom#7688,d_same_day_ly#7689,d_same_day_lq#7690,d_current_day#7691,... 4 more fields] orc
            :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7634L,cs_ship_date_sk#7635L,cs_bill_customer_sk#7636L,cs_bill_cdemo_sk#7637L,cs_bill_hdemo_sk#7638L,cs_bill_addr_sk#7639L,cs_ship_customer_sk#7640L,cs_ship_cdemo_sk#7641L,cs_ship_hdemo_sk#7642L,cs_ship_addr_sk#7643L,cs_call_center_sk#7644L,cs_catalog_page_sk#7645L,cs_ship_mode_sk#7646L,cs_warehouse_sk#7647L,cs_item_sk#7648L,cs_promo_sk#7649L,cs_order_number#7650L,cs_quantity#7651,cs_wholesale_cost#7652,cs_list_price#7653,cs_sales_price#7654,cs_ext_discount_amt#7655,cs_ext_sales_price#7656,cs_ext_wholesale_cost#7657,... 10 more fields] orc
            :        :     +- Project [d_date_sk#7668L]
            :        :        +- Filter ((isnotnull(d_year#7674) AND ((d_year#7674 >= 1998) AND (d_year#7674 <= 2000))) AND isnotnull(d_date_sk#7668L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_date_id#7669,d_date#7670,d_month_seq#7671,d_week_seq#7672,d_quarter_seq#7673,d_year#7674,d_dow#7675,d_moy#7676,d_dom#7677,d_qoy#7678,d_fy_year#7679,d_fy_quarter_seq#7680,d_fy_week_seq#7681,d_day_name#7682,d_quarter_name#7683,d_holiday#7684,d_weekend#7685,d_following_holiday#7686,d_first_dom#7687,d_last_dom#7688,d_same_day_ly#7689,d_same_day_lq#7690,d_current_day#7691,... 4 more fields] orc
            :        +- Project [ws_quantity#7713 AS quantity#7315, ws_list_price#7715 AS list_price#7316]
            :           +- Join Inner, (ws_sold_date_sk#7729L = d_date_sk#7730L)
            :              :- Project [ws_quantity#7713, ws_list_price#7715, ws_sold_date_sk#7729L]
            :              :  +- Filter (isnotnull(ws_sold_date_sk#7729L) AND dynamicpruning#7991 [ws_sold_date_sk#7729L])
            :              :     :  +- Project [d_date_sk#7730L]
            :              :     :     +- Filter ((isnotnull(d_year#7736) AND ((d_year#7736 >= 1998) AND (d_year#7736 <= 2000))) AND isnotnull(d_date_sk#7730L))
            :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_date_id#7731,d_date#7732,d_month_seq#7733,d_week_seq#7734,d_quarter_seq#7735,d_year#7736,d_dow#7737,d_moy#7738,d_dom#7739,d_qoy#7740,d_fy_year#7741,d_fy_quarter_seq#7742,d_fy_week_seq#7743,d_day_name#7744,d_quarter_name#7745,d_holiday#7746,d_weekend#7747,d_following_holiday#7748,d_first_dom#7749,d_last_dom#7750,d_same_day_ly#7751,d_same_day_lq#7752,d_current_day#7753,... 4 more fields] orc
            :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7696L,ws_ship_date_sk#7697L,ws_item_sk#7698L,ws_bill_customer_sk#7699L,ws_bill_cdemo_sk#7700L,ws_bill_hdemo_sk#7701L,ws_bill_addr_sk#7702L,ws_ship_customer_sk#7703L,ws_ship_cdemo_sk#7704L,ws_ship_hdemo_sk#7705L,ws_ship_addr_sk#7706L,ws_web_page_sk#7707L,ws_web_site_sk#7708L,ws_ship_mode_sk#7709L,ws_warehouse_sk#7710L,ws_promo_sk#7711L,ws_order_number#7712L,ws_quantity#7713,ws_wholesale_cost#7714,ws_list_price#7715,ws_sales_price#7716,ws_ext_discount_amt#7717,ws_ext_sales_price#7718,ws_ext_wholesale_cost#7719,... 10 more fields] orc
            :              +- Project [d_date_sk#7730L]
            :                 +- Filter ((isnotnull(d_year#7736) AND ((d_year#7736 >= 1998) AND (d_year#7736 <= 2000))) AND isnotnull(d_date_sk#7730L))
            :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_date_id#7731,d_date#7732,d_month_seq#7733,d_week_seq#7734,d_quarter_seq#7735,d_year#7736,d_dow#7737,d_moy#7738,d_dom#7739,d_qoy#7740,d_fy_year#7741,d_fy_quarter_seq#7742,d_fy_week_seq#7743,d_day_name#7744,d_quarter_name#7745,d_holiday#7746,d_weekend#7747,d_following_holiday#7748,d_first_dom#7749,d_last_dom#7750,d_same_day_ly#7751,d_same_day_lq#7752,d_current_day#7753,... 4 more fields] orc
            +- Aggregate [i_brand_id#7861, i_class_id#7863, i_category_id#7865], [store AS channel#7301, i_brand_id#7861, i_class_id#7863, i_category_id#7865, sum((cast(ss_quantity#7840 as double) * ss_list_price#7842)) AS sales#7302, count(1) AS number_sales#7303L]
               +- Project [ss_quantity#7840, ss_list_price#7842, i_brand_id#7861, i_class_id#7863, i_category_id#7865]
                  +- Join Inner, (ss_item_sk#7832L = i_item_sk#7854L)
                     :- Project [ss_item_sk#7832L, ss_quantity#7840, ss_list_price#7842]
                     :  +- Join Inner, (ss_sold_date_sk#7853L = d_date_sk#7876L)
                     :     :- Join LeftSemi, (ss_item_sk#7832L = ss_item_sk#7310L)
                     :     :  :- Project [ss_item_sk#7832L, ss_quantity#7840, ss_list_price#7842, ss_sold_date_sk#7853L]
                     :     :  :  +- Filter ((isnotnull(ss_item_sk#7832L) AND isnotnull(ss_sold_date_sk#7853L)) AND dynamicpruning#8005 [ss_sold_date_sk#7853L])
                     :     :  :     :  +- Project [d_date_sk#7876L]
                     :     :  :     :     +- Filter ((isnotnull(d_week_seq#7880) AND (d_week_seq#7880 = scalar-subquery#7305 [])) AND isnotnull(d_date_sk#7876L))
                     :     :  :     :        :  +- Project [d_week_seq#7936]
                     :     :  :     :        :     +- Filter (((isnotnull(d_year#7938) AND isnotnull(d_moy#7940)) AND isnotnull(d_dom#7941)) AND (((d_year#7938 = 1998) AND (d_moy#7940 = 12)) AND (d_dom#7941 = 16)))
                     :     :  :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7932L,d_date_id#7933,d_date#7934,d_month_seq#7935,d_week_seq#7936,d_quarter_seq#7937,d_year#7938,d_dow#7939,d_moy#7940,d_dom#7941,d_qoy#7942,d_fy_year#7943,d_fy_quarter_seq#7944,d_fy_week_seq#7945,d_day_name#7946,d_quarter_name#7947,d_holiday#7948,d_weekend#7949,d_following_holiday#7950,d_first_dom#7951,d_last_dom#7952,d_same_day_ly#7953,d_same_day_lq#7954,d_current_day#7955,... 4 more fields] orc
                     :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7876L,d_date_id#7877,d_date#7878,d_month_seq#7879,d_week_seq#7880,d_quarter_seq#7881,d_year#7882,d_dow#7883,d_moy#7884,d_dom#7885,d_qoy#7886,d_fy_year#7887,d_fy_quarter_seq#7888,d_fy_week_seq#7889,d_day_name#7890,d_quarter_name#7891,d_holiday#7892,d_weekend#7893,d_following_holiday#7894,d_first_dom#7895,d_last_dom#7896,d_same_day_ly#7897,d_same_day_lq#7898,d_current_day#7899,... 4 more fields] orc
                     :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7831L,ss_item_sk#7832L,ss_customer_sk#7833L,ss_cdemo_sk#7834L,ss_hdemo_sk#7835L,ss_addr_sk#7836L,ss_store_sk#7837L,ss_promo_sk#7838L,ss_ticket_number#7839L,ss_quantity#7840,ss_wholesale_cost#7841,ss_list_price#7842,ss_sales_price#7843,ss_ext_discount_amt#7844,ss_ext_sales_price#7845,ss_ext_wholesale_cost#7846,ss_ext_list_price#7847,ss_ext_tax#7848,ss_coupon_amt#7849,ss_net_paid#7850,ss_net_paid_inc_tax#7851,ss_net_profit#7852,ss_sold_date_sk#7853L] orc
                     :     :  +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
                     :     :     +- Join Inner, (((i_brand_id#7327 = brand_id#7307) AND (i_class_id#7329 = class_id#7308)) AND (i_category_id#7331 = category_id#7309))
                     :     :        :- Project [i_item_sk#7320L, i_brand_id#7327, i_class_id#7329, i_category_id#7331]
                     :     :        :  +- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
                     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_item_id#7321,i_rec_start_date#7322,i_rec_end_date#7323,i_item_desc#7324,i_current_price#7325,i_wholesale_cost#7326,i_brand_id#7327,i_brand#7328,i_class_id#7329,i_class#7330,i_category_id#7331,i_category#7332,i_manufact_id#7333,i_manufact#7334,i_size#7335,i_formulation#7336,i_color#7337,i_units#7338,i_container#7339,i_manager_id#7340,i_product_name#7341] orc
                     :     :        +- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
                     :     :           +- Join LeftSemi, (((brand_id#7307 <=> i_brand_id#7540) AND (class_id#7308 <=> i_class_id#7542)) AND (category_id#7309 <=> i_category_id#7544))
                     :     :              :- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
                     :     :              :  +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
                     :     :              :     +- Join Inner, (ss_item_sk#7343L = i_item_sk#7365L)
                     :     :              :        :- Project [ss_item_sk#7343L]
                     :     :              :        :  +- Join Inner, (ss_sold_date_sk#7364L = d_date_sk#7387L)
                     :     :              :        :     :- Project [ss_item_sk#7343L, ss_sold_date_sk#7364L]
                     :     :              :        :     :  +- Filter ((isnotnull(ss_item_sk#7343L) AND isnotnull(ss_sold_date_sk#7364L)) AND dynamicpruning#7992 [ss_sold_date_sk#7364L])
                     :     :              :        :     :     :  +- Project [d_date_sk#7387L]
                     :     :              :        :     :     :     +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
                     :     :              :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
                     :     :              :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7342L,ss_item_sk#7343L,ss_customer_sk#7344L,ss_cdemo_sk#7345L,ss_hdemo_sk#7346L,ss_addr_sk#7347L,ss_store_sk#7348L,ss_promo_sk#7349L,ss_ticket_number#7350L,ss_quantity#7351,ss_wholesale_cost#7352,ss_list_price#7353,ss_sales_price#7354,ss_ext_discount_amt#7355,ss_ext_sales_price#7356,ss_ext_wholesale_cost#7357,ss_ext_list_price#7358,ss_ext_tax#7359,ss_coupon_amt#7360,ss_net_paid#7361,ss_net_paid_inc_tax#7362,ss_net_profit#7363,ss_sold_date_sk#7364L] orc
                     :     :              :        :     +- Project [d_date_sk#7387L]
                     :     :              :        :        +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
                     :     :              :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
                     :     :              :        +- Join LeftSemi, (((i_brand_id#7372 <=> i_brand_id#7456) AND (i_class_id#7374 <=> i_class_id#7458)) AND (i_category_id#7376 <=> i_category_id#7460))
                     :     :              :           :- Project [i_item_sk#7365L, i_brand_id#7372, i_class_id#7374, i_category_id#7376]
                     :     :              :           :  +- Filter (isnotnull(i_item_sk#7365L) AND ((isnotnull(i_brand_id#7372) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376)))
                     :     :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_item_id#7366,i_rec_start_date#7367,i_rec_end_date#7368,i_item_desc#7369,i_current_price#7370,i_wholesale_cost#7371,i_brand_id#7372,i_brand#7373,i_class_id#7374,i_class#7375,i_category_id#7376,i_category#7377,i_manufact_id#7378,i_manufact#7379,i_size#7380,i_formulation#7381,i_color#7382,i_units#7383,i_container#7384,i_manager_id#7385,i_product_name#7386] orc
                     :     :              :           +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                     :     :              :              +- Join Inner, (cs_item_sk#7429L = i_item_sk#7449L)
                     :     :              :                 :- Project [cs_item_sk#7429L]
                     :     :              :                 :  +- Join Inner, (cs_sold_date_sk#7448L = d_date_sk#7471L)
                     :     :              :                 :     :- Project [cs_item_sk#7429L, cs_sold_date_sk#7448L]
                     :     :              :                 :     :  +- Filter ((isnotnull(cs_item_sk#7429L) AND isnotnull(cs_sold_date_sk#7448L)) AND dynamicpruning#7993 [cs_sold_date_sk#7448L])
                     :     :              :                 :     :     :  +- Project [d_date_sk#7471L]
                     :     :              :                 :     :     :     +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
                     :     :              :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
                     :     :              :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7415L,cs_ship_date_sk#7416L,cs_bill_customer_sk#7417L,cs_bill_cdemo_sk#7418L,cs_bill_hdemo_sk#7419L,cs_bill_addr_sk#7420L,cs_ship_customer_sk#7421L,cs_ship_cdemo_sk#7422L,cs_ship_hdemo_sk#7423L,cs_ship_addr_sk#7424L,cs_call_center_sk#7425L,cs_catalog_page_sk#7426L,cs_ship_mode_sk#7427L,cs_warehouse_sk#7428L,cs_item_sk#7429L,cs_promo_sk#7430L,cs_order_number#7431L,cs_quantity#7432,cs_wholesale_cost#7433,cs_list_price#7434,cs_sales_price#7435,cs_ext_discount_amt#7436,cs_ext_sales_price#7437,cs_ext_wholesale_cost#7438,... 10 more fields] orc
                     :     :              :                 :     +- Project [d_date_sk#7471L]
                     :     :              :                 :        +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
                     :     :              :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
                     :     :              :                 +- Project [i_item_sk#7449L, i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                     :     :              :                    +- Filter isnotnull(i_item_sk#7449L)
                     :     :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_item_id#7450,i_rec_start_date#7451,i_rec_end_date#7452,i_item_desc#7453,i_current_price#7454,i_wholesale_cost#7455,i_brand_id#7456,i_brand#7457,i_class_id#7458,i_class#7459,i_category_id#7460,i_category#7461,i_manufact_id#7462,i_manufact#7463,i_size#7464,i_formulation#7465,i_color#7466,i_units#7467,i_container#7468,i_manager_id#7469,i_product_name#7470] orc
                     :     :              +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                     :     :                 +- Join Inner, (ws_item_sk#7501L = i_item_sk#7533L)
                     :     :                    :- Project [ws_item_sk#7501L]
                     :     :                    :  +- Join Inner, (ws_sold_date_sk#7532L = d_date_sk#7555L)
                     :     :                    :     :- Project [ws_item_sk#7501L, ws_sold_date_sk#7532L]
                     :     :                    :     :  +- Filter ((isnotnull(ws_item_sk#7501L) AND isnotnull(ws_sold_date_sk#7532L)) AND dynamicpruning#7994 [ws_sold_date_sk#7532L])
                     :     :                    :     :     :  +- Project [d_date_sk#7555L]
                     :     :                    :     :     :     +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
                     :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
                     :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7499L,ws_ship_date_sk#7500L,ws_item_sk#7501L,ws_bill_customer_sk#7502L,ws_bill_cdemo_sk#7503L,ws_bill_hdemo_sk#7504L,ws_bill_addr_sk#7505L,ws_ship_customer_sk#7506L,ws_ship_cdemo_sk#7507L,ws_ship_hdemo_sk#7508L,ws_ship_addr_sk#7509L,ws_web_page_sk#7510L,ws_web_site_sk#7511L,ws_ship_mode_sk#7512L,ws_warehouse_sk#7513L,ws_promo_sk#7514L,ws_order_number#7515L,ws_quantity#7516,ws_wholesale_cost#7517,ws_list_price#7518,ws_sales_price#7519,ws_ext_discount_amt#7520,ws_ext_sales_price#7521,ws_ext_wholesale_cost#7522,... 10 more fields] orc
                     :     :                    :     +- Project [d_date_sk#7555L]
                     :     :                    :        +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
                     :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
                     :     :                    +- Project [i_item_sk#7533L, i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                     :     :                       +- Filter isnotnull(i_item_sk#7533L)
                     :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_item_id#7534,i_rec_start_date#7535,i_rec_end_date#7536,i_item_desc#7537,i_current_price#7538,i_wholesale_cost#7539,i_brand_id#7540,i_brand#7541,i_class_id#7542,i_class#7543,i_category_id#7544,i_category#7545,i_manufact_id#7546,i_manufact#7547,i_size#7548,i_formulation#7549,i_color#7550,i_units#7551,i_container#7552,i_manager_id#7553,i_product_name#7554] orc
                     :     +- Project [d_date_sk#7876L]
                     :        +- Filter ((isnotnull(d_week_seq#7880) AND (d_week_seq#7880 = scalar-subquery#7305 [])) AND isnotnull(d_date_sk#7876L))
                     :           :  +- Project [d_week_seq#7936]
                     :           :     +- Filter (((isnotnull(d_year#7938) AND isnotnull(d_moy#7940)) AND isnotnull(d_dom#7941)) AND (((d_year#7938 = 1998) AND (d_moy#7940 = 12)) AND (d_dom#7941 = 16)))
                     :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7932L,d_date_id#7933,d_date#7934,d_month_seq#7935,d_week_seq#7936,d_quarter_seq#7937,d_year#7938,d_dow#7939,d_moy#7940,d_dom#7941,d_qoy#7942,d_fy_year#7943,d_fy_quarter_seq#7944,d_fy_week_seq#7945,d_day_name#7946,d_quarter_name#7947,d_holiday#7948,d_weekend#7949,d_following_holiday#7950,d_first_dom#7951,d_last_dom#7952,d_same_day_ly#7953,d_same_day_lq#7954,d_current_day#7955,... 4 more fields] orc
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7876L,d_date_id#7877,d_date#7878,d_month_seq#7879,d_week_seq#7880,d_quarter_seq#7881,d_year#7882,d_dow#7883,d_moy#7884,d_dom#7885,d_qoy#7886,d_fy_year#7887,d_fy_quarter_seq#7888,d_fy_week_seq#7889,d_day_name#7890,d_quarter_name#7891,d_holiday#7892,d_weekend#7893,d_following_holiday#7894,d_first_dom#7895,d_last_dom#7896,d_same_day_ly#7897,d_same_day_lq#7898,d_current_day#7899,... 4 more fields] orc
                     +- Join LeftSemi, (i_item_sk#7854L = ss_item_sk#7310L)
                        :- Project [i_item_sk#7854L, i_brand_id#7861, i_class_id#7863, i_category_id#7865]
                        :  +- Filter (((isnotnull(i_item_sk#7854L) AND isnotnull(i_brand_id#7861)) AND isnotnull(i_class_id#7863)) AND isnotnull(i_category_id#7865))
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7854L,i_item_id#7855,i_rec_start_date#7856,i_rec_end_date#7857,i_item_desc#7858,i_current_price#7859,i_wholesale_cost#7860,i_brand_id#7861,i_brand#7862,i_class_id#7863,i_class#7864,i_category_id#7865,i_category#7866,i_manufact_id#7867,i_manufact#7868,i_size#7869,i_formulation#7870,i_color#7871,i_units#7872,i_container#7873,i_manager_id#7874,i_product_name#7875] orc
                        +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
                           +- Join Inner, (((i_brand_id#7327 = brand_id#7307) AND (i_class_id#7329 = class_id#7308)) AND (i_category_id#7331 = category_id#7309))
                              :- Project [i_item_sk#7320L, i_brand_id#7327, i_class_id#7329, i_category_id#7331]
                              :  +- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
                              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_item_id#7321,i_rec_start_date#7322,i_rec_end_date#7323,i_item_desc#7324,i_current_price#7325,i_wholesale_cost#7326,i_brand_id#7327,i_brand#7328,i_class_id#7329,i_class#7330,i_category_id#7331,i_category#7332,i_manufact_id#7333,i_manufact#7334,i_size#7335,i_formulation#7336,i_color#7337,i_units#7338,i_container#7339,i_manager_id#7340,i_product_name#7341] orc
                              +- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
                                 +- Join LeftSemi, (((brand_id#7307 <=> i_brand_id#7540) AND (class_id#7308 <=> i_class_id#7542)) AND (category_id#7309 <=> i_category_id#7544))
                                    :- Aggregate [brand_id#7307, class_id#7308, category_id#7309], [brand_id#7307, class_id#7308, category_id#7309]
                                    :  +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
                                    :     +- Join Inner, (ss_item_sk#7343L = i_item_sk#7365L)
                                    :        :- Project [ss_item_sk#7343L]
                                    :        :  +- Join Inner, (ss_sold_date_sk#7364L = d_date_sk#7387L)
                                    :        :     :- Project [ss_item_sk#7343L, ss_sold_date_sk#7364L]
                                    :        :     :  +- Filter ((isnotnull(ss_item_sk#7343L) AND isnotnull(ss_sold_date_sk#7364L)) AND dynamicpruning#7992 [ss_sold_date_sk#7364L])
                                    :        :     :     :  +- Project [d_date_sk#7387L]
                                    :        :     :     :     +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
                                    :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
                                    :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#7342L,ss_item_sk#7343L,ss_customer_sk#7344L,ss_cdemo_sk#7345L,ss_hdemo_sk#7346L,ss_addr_sk#7347L,ss_store_sk#7348L,ss_promo_sk#7349L,ss_ticket_number#7350L,ss_quantity#7351,ss_wholesale_cost#7352,ss_list_price#7353,ss_sales_price#7354,ss_ext_discount_amt#7355,ss_ext_sales_price#7356,ss_ext_wholesale_cost#7357,ss_ext_list_price#7358,ss_ext_tax#7359,ss_coupon_amt#7360,ss_net_paid#7361,ss_net_paid_inc_tax#7362,ss_net_profit#7363,ss_sold_date_sk#7364L] orc
                                    :        :     +- Project [d_date_sk#7387L]
                                    :        :        +- Filter ((isnotnull(d_year#7393) AND ((d_year#7393 >= 1999) AND (d_year#7393 <= 2001))) AND isnotnull(d_date_sk#7387L))
                                    :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_date_id#7388,d_date#7389,d_month_seq#7390,d_week_seq#7391,d_quarter_seq#7392,d_year#7393,d_dow#7394,d_moy#7395,d_dom#7396,d_qoy#7397,d_fy_year#7398,d_fy_quarter_seq#7399,d_fy_week_seq#7400,d_day_name#7401,d_quarter_name#7402,d_holiday#7403,d_weekend#7404,d_following_holiday#7405,d_first_dom#7406,d_last_dom#7407,d_same_day_ly#7408,d_same_day_lq#7409,d_current_day#7410,... 4 more fields] orc
                                    :        +- Join LeftSemi, (((i_brand_id#7372 <=> i_brand_id#7456) AND (i_class_id#7374 <=> i_class_id#7458)) AND (i_category_id#7376 <=> i_category_id#7460))
                                    :           :- Project [i_item_sk#7365L, i_brand_id#7372, i_class_id#7374, i_category_id#7376]
                                    :           :  +- Filter (isnotnull(i_item_sk#7365L) AND ((isnotnull(i_brand_id#7372) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376)))
                                    :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_item_id#7366,i_rec_start_date#7367,i_rec_end_date#7368,i_item_desc#7369,i_current_price#7370,i_wholesale_cost#7371,i_brand_id#7372,i_brand#7373,i_class_id#7374,i_class#7375,i_category_id#7376,i_category#7377,i_manufact_id#7378,i_manufact#7379,i_size#7380,i_formulation#7381,i_color#7382,i_units#7383,i_container#7384,i_manager_id#7385,i_product_name#7386] orc
                                    :           +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                                    :              +- Join Inner, (cs_item_sk#7429L = i_item_sk#7449L)
                                    :                 :- Project [cs_item_sk#7429L]
                                    :                 :  +- Join Inner, (cs_sold_date_sk#7448L = d_date_sk#7471L)
                                    :                 :     :- Project [cs_item_sk#7429L, cs_sold_date_sk#7448L]
                                    :                 :     :  +- Filter ((isnotnull(cs_item_sk#7429L) AND isnotnull(cs_sold_date_sk#7448L)) AND dynamicpruning#7993 [cs_sold_date_sk#7448L])
                                    :                 :     :     :  +- Project [d_date_sk#7471L]
                                    :                 :     :     :     +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
                                    :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
                                    :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#7415L,cs_ship_date_sk#7416L,cs_bill_customer_sk#7417L,cs_bill_cdemo_sk#7418L,cs_bill_hdemo_sk#7419L,cs_bill_addr_sk#7420L,cs_ship_customer_sk#7421L,cs_ship_cdemo_sk#7422L,cs_ship_hdemo_sk#7423L,cs_ship_addr_sk#7424L,cs_call_center_sk#7425L,cs_catalog_page_sk#7426L,cs_ship_mode_sk#7427L,cs_warehouse_sk#7428L,cs_item_sk#7429L,cs_promo_sk#7430L,cs_order_number#7431L,cs_quantity#7432,cs_wholesale_cost#7433,cs_list_price#7434,cs_sales_price#7435,cs_ext_discount_amt#7436,cs_ext_sales_price#7437,cs_ext_wholesale_cost#7438,... 10 more fields] orc
                                    :                 :     +- Project [d_date_sk#7471L]
                                    :                 :        +- Filter ((isnotnull(d_year#7477) AND ((d_year#7477 >= 1999) AND (d_year#7477 <= 2001))) AND isnotnull(d_date_sk#7471L))
                                    :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_date_id#7472,d_date#7473,d_month_seq#7474,d_week_seq#7475,d_quarter_seq#7476,d_year#7477,d_dow#7478,d_moy#7479,d_dom#7480,d_qoy#7481,d_fy_year#7482,d_fy_quarter_seq#7483,d_fy_week_seq#7484,d_day_name#7485,d_quarter_name#7486,d_holiday#7487,d_weekend#7488,d_following_holiday#7489,d_first_dom#7490,d_last_dom#7491,d_same_day_ly#7492,d_same_day_lq#7493,d_current_day#7494,... 4 more fields] orc
                                    :                 +- Project [i_item_sk#7449L, i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                                    :                    +- Filter isnotnull(i_item_sk#7449L)
                                    :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_item_id#7450,i_rec_start_date#7451,i_rec_end_date#7452,i_item_desc#7453,i_current_price#7454,i_wholesale_cost#7455,i_brand_id#7456,i_brand#7457,i_class_id#7458,i_class#7459,i_category_id#7460,i_category#7461,i_manufact_id#7462,i_manufact#7463,i_size#7464,i_formulation#7465,i_color#7466,i_units#7467,i_container#7468,i_manager_id#7469,i_product_name#7470] orc
                                    +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                                       +- Join Inner, (ws_item_sk#7501L = i_item_sk#7533L)
                                          :- Project [ws_item_sk#7501L]
                                          :  +- Join Inner, (ws_sold_date_sk#7532L = d_date_sk#7555L)
                                          :     :- Project [ws_item_sk#7501L, ws_sold_date_sk#7532L]
                                          :     :  +- Filter ((isnotnull(ws_item_sk#7501L) AND isnotnull(ws_sold_date_sk#7532L)) AND dynamicpruning#7994 [ws_sold_date_sk#7532L])
                                          :     :     :  +- Project [d_date_sk#7555L]
                                          :     :     :     +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
                                          :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
                                          :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#7499L,ws_ship_date_sk#7500L,ws_item_sk#7501L,ws_bill_customer_sk#7502L,ws_bill_cdemo_sk#7503L,ws_bill_hdemo_sk#7504L,ws_bill_addr_sk#7505L,ws_ship_customer_sk#7506L,ws_ship_cdemo_sk#7507L,ws_ship_hdemo_sk#7508L,ws_ship_addr_sk#7509L,ws_web_page_sk#7510L,ws_web_site_sk#7511L,ws_ship_mode_sk#7512L,ws_warehouse_sk#7513L,ws_promo_sk#7514L,ws_order_number#7515L,ws_quantity#7516,ws_wholesale_cost#7517,ws_list_price#7518,ws_sales_price#7519,ws_ext_discount_amt#7520,ws_ext_sales_price#7521,ws_ext_wholesale_cost#7522,... 10 more fields] orc
                                          :     +- Project [d_date_sk#7555L]
                                          :        +- Filter ((isnotnull(d_year#7561) AND ((d_year#7561 >= 1999) AND (d_year#7561 <= 2001))) AND isnotnull(d_date_sk#7555L))
                                          :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_date_id#7556,d_date#7557,d_month_seq#7558,d_week_seq#7559,d_quarter_seq#7560,d_year#7561,d_dow#7562,d_moy#7563,d_dom#7564,d_qoy#7565,d_fy_year#7566,d_fy_quarter_seq#7567,d_fy_week_seq#7568,d_day_name#7569,d_quarter_name#7570,d_holiday#7571,d_weekend#7572,d_following_holiday#7573,d_first_dom#7574,d_last_dom#7575,d_same_day_ly#7576,d_same_day_lq#7577,d_current_day#7578,... 4 more fields] orc
                                          +- Project [i_item_sk#7533L, i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                                             +- Filter isnotnull(i_item_sk#7533L)
                                                +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_item_id#7534,i_rec_start_date#7535,i_rec_end_date#7536,i_item_desc#7537,i_current_price#7538,i_wholesale_cost#7539,i_brand_id#7540,i_brand#7541,i_class_id#7542,i_class#7543,i_category_id#7544,i_category#7545,i_manufact_id#7546,i_manufact#7547,i_size#7548,i_formulation#7549,i_color#7550,i_units#7551,i_container#7552,i_manager_id#7553,i_product_name#7554] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_brand_id#7788 ASC NULLS FIRST,i_class_id#7790 ASC NULLS FIRST,i_category_id#7792 ASC NULLS FIRST], output=[channel#7295,i_brand_id#7788,i_class_id#7790,i_category_id#7792,sales#7296,number_sales#7297L,channel#7301,i_brand_id#7861,i_class_id#7863,i_category_id#7865,sales#7302,number_sales#7303L])
   +- BroadcastHashJoin [i_brand_id#7788, i_class_id#7790, i_category_id#7792], [i_brand_id#7861, i_class_id#7863, i_category_id#7865], Inner, BuildRight, false
      :- Filter (isnotnull(sales#7296) AND (sales#7296 > Subquery subquery#7300, [id=#7202]))
      :  :  +- Subquery subquery#7300, [id=#7202]
      :  :     +- AdaptiveSparkPlan isFinalPlan=false
      :  :        +- HashAggregate(keys=[], functions=[avg((cast(quantity#7311 as double) * list_price#7312))], output=[average_sales#7317])
      :  :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#7200]
      :  :              +- HashAggregate(keys=[], functions=[partial_avg((cast(quantity#7311 as double) * list_price#7312))], output=[sum#8019, count#8020L])
      :  :                 +- Union
      :  :                    :- Project [ss_quantity#7592 AS quantity#7311, ss_list_price#7594 AS list_price#7312]
      :  :                    :  +- BroadcastHashJoin [ss_sold_date_sk#7605L], [d_date_sk#7606L], Inner, BuildRight, false
      :  :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#7592,ss_list_price#7594,ss_sold_date_sk#7605L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7605L), dynamicpruningexpression(ss_sold_date_sk#7605L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:double>
      :  :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7983, 0, true, Project [d_date_sk#7606L], [d_date_sk#7606L]
      :  :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
      :  :                    :     :           +- Project [d_date_sk#7606L]
      :  :                    :     :              +- Filter (((isnotnull(d_year#7612) AND (d_year#7612 >= 1998)) AND (d_year#7612 <= 2000)) AND isnotnull(d_date_sk#7606L))
      :  :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_year#7612] Batched: true, DataFilters: [isnotnull(d_year#7612), (d_year#7612 >= 1998), (d_year#7612 <= 2000), isnotnull(d_date_sk#7606L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7188]
      :  :                    :        +- Project [d_date_sk#7606L]
      :  :                    :           +- Filter (((isnotnull(d_year#7612) AND (d_year#7612 >= 1998)) AND (d_year#7612 <= 2000)) AND isnotnull(d_date_sk#7606L))
      :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_year#7612] Batched: true, DataFilters: [isnotnull(d_year#7612), (d_year#7612 >= 1998), (d_year#7612 <= 2000), isnotnull(d_date_sk#7606L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  :                    :- Project [cs_quantity#7651 AS quantity#7313, cs_list_price#7653 AS list_price#7314]
      :  :                    :  +- BroadcastHashJoin [cs_sold_date_sk#7667L], [d_date_sk#7668L], Inner, BuildRight, false
      :  :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_quantity#7651,cs_list_price#7653,cs_sold_date_sk#7667L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7667L), dynamicpruningexpression(cs_sold_date_sk#7667L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:double>
      :  :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7984, 0, true, Project [d_date_sk#7668L], [d_date_sk#7668L]
      :  :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
      :  :                    :     :           +- Project [d_date_sk#7668L]
      :  :                    :     :              +- Filter (((isnotnull(d_year#7674) AND (d_year#7674 >= 1998)) AND (d_year#7674 <= 2000)) AND isnotnull(d_date_sk#7668L))
      :  :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_year#7674] Batched: true, DataFilters: [isnotnull(d_year#7674), (d_year#7674 >= 1998), (d_year#7674 <= 2000), isnotnull(d_date_sk#7668L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7191]
      :  :                    :        +- Project [d_date_sk#7668L]
      :  :                    :           +- Filter (((isnotnull(d_year#7674) AND (d_year#7674 >= 1998)) AND (d_year#7674 <= 2000)) AND isnotnull(d_date_sk#7668L))
      :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_year#7674] Batched: true, DataFilters: [isnotnull(d_year#7674), (d_year#7674 >= 1998), (d_year#7674 <= 2000), isnotnull(d_date_sk#7668L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  :                    +- Project [ws_quantity#7713 AS quantity#7315, ws_list_price#7715 AS list_price#7316]
      :  :                       +- BroadcastHashJoin [ws_sold_date_sk#7729L], [d_date_sk#7730L], Inner, BuildRight, false
      :  :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_quantity#7713,ws_list_price#7715,ws_sold_date_sk#7729L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7729L), dynamicpruningexpression(ws_sold_date_sk#7729L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:double>
      :  :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#7985, 0, true, Project [d_date_sk#7730L], [d_date_sk#7730L]
      :  :                          :        +- AdaptiveSparkPlan isFinalPlan=false
      :  :                          :           +- Project [d_date_sk#7730L]
      :  :                          :              +- Filter (((isnotnull(d_year#7736) AND (d_year#7736 >= 1998)) AND (d_year#7736 <= 2000)) AND isnotnull(d_date_sk#7730L))
      :  :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_year#7736] Batched: true, DataFilters: [isnotnull(d_year#7736), (d_year#7736 >= 1998), (d_year#7736 <= 2000), isnotnull(d_date_sk#7730L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7194]
      :  :                             +- Project [d_date_sk#7730L]
      :  :                                +- Filter (((isnotnull(d_year#7736) AND (d_year#7736 >= 1998)) AND (d_year#7736 <= 2000)) AND isnotnull(d_date_sk#7730L))
      :  :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_year#7736] Batched: true, DataFilters: [isnotnull(d_year#7736), (d_year#7736 >= 1998), (d_year#7736 <= 2000), isnotnull(d_date_sk#7730L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :  +- HashAggregate(keys=[i_brand_id#7788, i_class_id#7790, i_category_id#7792], functions=[sum((cast(ss_quantity#7767 as double) * ss_list_price#7769)), count(1)], output=[channel#7295, i_brand_id#7788, i_class_id#7790, i_category_id#7792, sales#7296, number_sales#7297L])
      :     +- Exchange hashpartitioning(i_brand_id#7788, i_class_id#7790, i_category_id#7792, 3000), ENSURE_REQUIREMENTS, [id=#7764]
      :        +- HashAggregate(keys=[i_brand_id#7788, i_class_id#7790, i_category_id#7792], functions=[partial_sum((cast(ss_quantity#7767 as double) * ss_list_price#7769)), partial_count(1)], output=[i_brand_id#7788, i_class_id#7790, i_category_id#7792, sum#8011, count#8012L])
      :           +- Project [ss_quantity#7767, ss_list_price#7769, i_brand_id#7788, i_class_id#7790, i_category_id#7792]
      :              +- SortMergeJoin [ss_item_sk#7759L], [i_item_sk#7781L], Inner
      :                 :- Project [ss_item_sk#7759L, ss_quantity#7767, ss_list_price#7769]
      :                 :  +- BroadcastHashJoin [ss_sold_date_sk#7780L], [d_date_sk#7803L], Inner, BuildRight, false
      :                 :     :- SortMergeJoin [ss_item_sk#7759L], [ss_item_sk#7310L], LeftSemi
      :                 :     :  :- Sort [ss_item_sk#7759L ASC NULLS FIRST], false, 0
      :                 :     :  :  +- Exchange hashpartitioning(ss_item_sk#7759L, 3000), ENSURE_REQUIREMENTS, [id=#7684]
      :                 :     :  :     +- Filter isnotnull(ss_item_sk#7759L)
      :                 :     :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7759L,ss_quantity#7767,ss_list_price#7769,ss_sold_date_sk#7780L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7759L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7780L), dynamicpruningexpression(ss_sold_date_sk#7780L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_quantity:int,ss_list_price:double>
      :                 :     :  :              +- SubqueryAdaptiveBroadcast dynamicpruning#7998, 0, true, Project [d_date_sk#7803L], [d_date_sk#7803L]
      :                 :     :  :                 +- AdaptiveSparkPlan isFinalPlan=false
      :                 :     :  :                    +- Project [d_date_sk#7803L]
      :                 :     :  :                       +- Filter ((isnotnull(d_week_seq#7807) AND (d_week_seq#7807 = Subquery subquery#7299, [id=#7212])) AND isnotnull(d_date_sk#7803L))
      :                 :     :  :                          :  +- Subquery subquery#7299, [id=#7212]
      :                 :     :  :                          :     +- AdaptiveSparkPlan isFinalPlan=false
      :                 :     :  :                          :        +- Project [d_week_seq#7908]
      :                 :     :  :                          :           +- Filter (((((isnotnull(d_year#7910) AND isnotnull(d_moy#7912)) AND isnotnull(d_dom#7913)) AND (d_year#7910 = 1999)) AND (d_moy#7912 = 12)) AND (d_dom#7913 = 16))
      :                 :     :  :                          :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#7908,d_year#7910,d_moy#7912,d_dom#7913] Batched: true, DataFilters: [isnotnull(d_year#7910), isnotnull(d_moy#7912), isnotnull(d_dom#7913), (d_year#7910 = 1999), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1999), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>
      :                 :     :  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7803L,d_week_seq#7807] Batched: true, DataFilters: [isnotnull(d_week_seq#7807), isnotnull(d_date_sk#7803L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
      :                 :     :  +- Sort [ss_item_sk#7310L ASC NULLS FIRST], false, 0
      :                 :     :     +- Exchange hashpartitioning(ss_item_sk#7310L, 3000), ENSURE_REQUIREMENTS, [id=#7685]
      :                 :     :        +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
      :                 :     :           +- BroadcastHashJoin [i_brand_id#7327, i_class_id#7329, i_category_id#7331], [brand_id#7307, class_id#7308, category_id#7309], Inner, BuildRight, false
      :                 :     :              :- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
      :                 :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_brand_id#7327,i_class_id#7329,i_category_id#7331] Batched: true, DataFilters: [isnotnull(i_brand_id#7327), isnotnull(i_class_id#7329), isnotnull(i_category_id#7331)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                 :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#7679]
      :                 :     :                 +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                 :     :                    +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7676]
      :                 :     :                       +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                 :     :                          +- SortMergeJoin [coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309)], [coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544)], LeftSemi
      :                 :     :                             :- Sort [coalesce(brand_id#7307, 0) ASC NULLS FIRST, isnull(brand_id#7307) ASC NULLS FIRST, coalesce(class_id#7308, 0) ASC NULLS FIRST, isnull(class_id#7308) ASC NULLS FIRST, coalesce(category_id#7309, 0) ASC NULLS FIRST, isnull(category_id#7309) ASC NULLS FIRST], false, 0
      :                 :     :                             :  +- Exchange hashpartitioning(coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309), 3000), ENSURE_REQUIREMENTS, [id=#7669]
      :                 :     :                             :     +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                 :     :                             :        +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7654]
      :                 :     :                             :           +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                 :     :                             :              +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
      :                 :     :                             :                 +- SortMergeJoin [ss_item_sk#7343L], [i_item_sk#7365L], Inner
      :                 :     :                             :                    :- Sort [ss_item_sk#7343L ASC NULLS FIRST], false, 0
      :                 :     :                             :                    :  +- Exchange hashpartitioning(ss_item_sk#7343L, 3000), ENSURE_REQUIREMENTS, [id=#7646]
      :                 :     :                             :                    :     +- Project [ss_item_sk#7343L]
      :                 :     :                             :                    :        +- BroadcastHashJoin [ss_sold_date_sk#7364L], [d_date_sk#7387L], Inner, BuildRight, false
      :                 :     :                             :                    :           :- Filter isnotnull(ss_item_sk#7343L)
      :                 :     :                             :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7343L,ss_sold_date_sk#7364L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7343L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7364L), dynamicpruningexpression(ss_sold_date_sk#7364L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
      :                 :     :                             :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7986, 0, true, Project [d_date_sk#7387L], [d_date_sk#7387L]
      :                 :     :                             :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                 :     :                             :                    :           :              +- Project [d_date_sk#7387L]
      :                 :     :                             :                    :           :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
      :                 :     :                             :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                             :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7623]
      :                 :     :                             :                    :              +- Project [d_date_sk#7387L]
      :                 :     :                             :                    :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
      :                 :     :                             :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                             :                    +- Sort [i_item_sk#7365L ASC NULLS FIRST], false, 0
      :                 :     :                             :                       +- Exchange hashpartitioning(i_item_sk#7365L, 3000), ENSURE_REQUIREMENTS, [id=#7647]
      :                 :     :                             :                          +- SortMergeJoin [coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376)], [coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460)], LeftSemi
      :                 :     :                             :                             :- Sort [coalesce(i_brand_id#7372, 0) ASC NULLS FIRST, isnull(i_brand_id#7372) ASC NULLS FIRST, coalesce(i_class_id#7374, 0) ASC NULLS FIRST, isnull(i_class_id#7374) ASC NULLS FIRST, coalesce(i_category_id#7376, 0) ASC NULLS FIRST, isnull(i_category_id#7376) ASC NULLS FIRST], false, 0
      :                 :     :                             :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376), 3000), ENSURE_REQUIREMENTS, [id=#7639]
      :                 :     :                             :                             :     +- Filter (((isnotnull(i_item_sk#7365L) AND isnotnull(i_brand_id#7372)) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376))
      :                 :     :                             :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_brand_id#7372,i_class_id#7374,i_category_id#7376] Batched: true, DataFilters: [isnotnull(i_item_sk#7365L), isnotnull(i_brand_id#7372), isnotnull(i_class_id#7374), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                 :     :                             :                             +- Sort [coalesce(i_brand_id#7456, 0) ASC NULLS FIRST, isnull(i_brand_id#7456) ASC NULLS FIRST, coalesce(i_class_id#7458, 0) ASC NULLS FIRST, isnull(i_class_id#7458) ASC NULLS FIRST, coalesce(i_category_id#7460, 0) ASC NULLS FIRST, isnull(i_category_id#7460) ASC NULLS FIRST], false, 0
      :                 :     :                             :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460), 3000), ENSURE_REQUIREMENTS, [id=#7640]
      :                 :     :                             :                                   +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
      :                 :     :                             :                                      +- SortMergeJoin [cs_item_sk#7429L], [i_item_sk#7449L], Inner
      :                 :     :                             :                                         :- Sort [cs_item_sk#7429L ASC NULLS FIRST], false, 0
      :                 :     :                             :                                         :  +- Exchange hashpartitioning(cs_item_sk#7429L, 3000), ENSURE_REQUIREMENTS, [id=#7631]
      :                 :     :                             :                                         :     +- Project [cs_item_sk#7429L]
      :                 :     :                             :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#7448L], [d_date_sk#7471L], Inner, BuildRight, false
      :                 :     :                             :                                         :           :- Filter isnotnull(cs_item_sk#7429L)
      :                 :     :                             :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#7429L,cs_sold_date_sk#7448L] Batched: true, DataFilters: [isnotnull(cs_item_sk#7429L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7448L), dynamicpruningexpression(cs_sold_date_sk#7448L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
      :                 :     :                             :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7987, 0, true, Project [d_date_sk#7471L], [d_date_sk#7471L]
      :                 :     :                             :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                 :     :                             :                                         :           :              +- Project [d_date_sk#7471L]
      :                 :     :                             :                                         :           :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
      :                 :     :                             :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                             :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7626]
      :                 :     :                             :                                         :              +- Project [d_date_sk#7471L]
      :                 :     :                             :                                         :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
      :                 :     :                             :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                             :                                         +- Sort [i_item_sk#7449L ASC NULLS FIRST], false, 0
      :                 :     :                             :                                            +- Exchange hashpartitioning(i_item_sk#7449L, 3000), ENSURE_REQUIREMENTS, [id=#7632]
      :                 :     :                             :                                               +- Filter isnotnull(i_item_sk#7449L)
      :                 :     :                             :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_brand_id#7456,i_class_id#7458,i_category_id#7460] Batched: true, DataFilters: [isnotnull(i_item_sk#7449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                 :     :                             +- Sort [coalesce(i_brand_id#7540, 0) ASC NULLS FIRST, isnull(i_brand_id#7540) ASC NULLS FIRST, coalesce(i_class_id#7542, 0) ASC NULLS FIRST, isnull(i_class_id#7542) ASC NULLS FIRST, coalesce(i_category_id#7544, 0) ASC NULLS FIRST, isnull(i_category_id#7544) ASC NULLS FIRST], false, 0
      :                 :     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544), 3000), ENSURE_REQUIREMENTS, [id=#7670]
      :                 :     :                                   +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
      :                 :     :                                      +- SortMergeJoin [ws_item_sk#7501L], [i_item_sk#7533L], Inner
      :                 :     :                                         :- Sort [ws_item_sk#7501L ASC NULLS FIRST], false, 0
      :                 :     :                                         :  +- Exchange hashpartitioning(ws_item_sk#7501L, 3000), ENSURE_REQUIREMENTS, [id=#7661]
      :                 :     :                                         :     +- Project [ws_item_sk#7501L]
      :                 :     :                                         :        +- BroadcastHashJoin [ws_sold_date_sk#7532L], [d_date_sk#7555L], Inner, BuildRight, false
      :                 :     :                                         :           :- Filter isnotnull(ws_item_sk#7501L)
      :                 :     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#7501L,ws_sold_date_sk#7532L] Batched: true, DataFilters: [isnotnull(ws_item_sk#7501L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7532L), dynamicpruningexpression(ws_sold_date_sk#7532L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
      :                 :     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7988, 0, true, Project [d_date_sk#7555L], [d_date_sk#7555L]
      :                 :     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                 :     :                                         :           :              +- Project [d_date_sk#7555L]
      :                 :     :                                         :           :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
      :                 :     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7656]
      :                 :     :                                         :              +- Project [d_date_sk#7555L]
      :                 :     :                                         :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
      :                 :     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                 :     :                                         +- Sort [i_item_sk#7533L ASC NULLS FIRST], false, 0
      :                 :     :                                            +- Exchange hashpartitioning(i_item_sk#7533L, 3000), ENSURE_REQUIREMENTS, [id=#7662]
      :                 :     :                                               +- Filter isnotnull(i_item_sk#7533L)
      :                 :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_brand_id#7540,i_class_id#7542,i_category_id#7544] Batched: true, DataFilters: [isnotnull(i_item_sk#7533L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7690]
      :                 :        +- Project [d_date_sk#7803L]
      :                 :           +- Filter ((isnotnull(d_week_seq#7807) AND (d_week_seq#7807 = Subquery subquery#7299, [id=#7240])) AND isnotnull(d_date_sk#7803L))
      :                 :              :  +- Subquery subquery#7299, [id=#7240]
      :                 :              :     +- AdaptiveSparkPlan isFinalPlan=false
      :                 :              :        +- Project [d_week_seq#7908]
      :                 :              :           +- Filter (((((isnotnull(d_year#7910) AND isnotnull(d_moy#7912)) AND isnotnull(d_dom#7913)) AND (d_year#7910 = 1999)) AND (d_moy#7912 = 12)) AND (d_dom#7913 = 16))
      :                 :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#7908,d_year#7910,d_moy#7912,d_dom#7913] Batched: true, DataFilters: [isnotnull(d_year#7910), isnotnull(d_moy#7912), isnotnull(d_dom#7913), (d_year#7910 = 1999), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1999), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>
      :                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7803L,d_week_seq#7807] Batched: true, DataFilters: [isnotnull(d_week_seq#7807), isnotnull(d_date_sk#7803L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
      :                 +- SortMergeJoin [i_item_sk#7781L], [ss_item_sk#7310L], LeftSemi
      :                    :- Sort [i_item_sk#7781L ASC NULLS FIRST], false, 0
      :                    :  +- Exchange hashpartitioning(i_item_sk#7781L, 3000), ENSURE_REQUIREMENTS, [id=#7754]
      :                    :     +- Filter (((isnotnull(i_item_sk#7781L) AND isnotnull(i_brand_id#7788)) AND isnotnull(i_class_id#7790)) AND isnotnull(i_category_id#7792))
      :                    :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7781L,i_brand_id#7788,i_class_id#7790,i_category_id#7792] Batched: true, DataFilters: [isnotnull(i_item_sk#7781L), isnotnull(i_brand_id#7788), isnotnull(i_class_id#7790), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                    +- Sort [ss_item_sk#7310L ASC NULLS FIRST], false, 0
      :                       +- Exchange hashpartitioning(ss_item_sk#7310L, 3000), ENSURE_REQUIREMENTS, [id=#7755]
      :                          +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
      :                             +- BroadcastHashJoin [i_brand_id#7327, i_class_id#7329, i_category_id#7331], [brand_id#7307, class_id#7308, category_id#7309], Inner, BuildRight, false
      :                                :- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
      :                                :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_brand_id#7327,i_class_id#7329,i_category_id#7331] Batched: true, DataFilters: [isnotnull(i_brand_id#7327), isnotnull(i_class_id#7329), isnotnull(i_category_id#7331)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                                +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#7749]
      :                                   +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                                      +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7746]
      :                                         +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                                            +- SortMergeJoin [coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309)], [coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544)], LeftSemi
      :                                               :- Sort [coalesce(brand_id#7307, 0) ASC NULLS FIRST, isnull(brand_id#7307) ASC NULLS FIRST, coalesce(class_id#7308, 0) ASC NULLS FIRST, isnull(class_id#7308) ASC NULLS FIRST, coalesce(category_id#7309, 0) ASC NULLS FIRST, isnull(category_id#7309) ASC NULLS FIRST], false, 0
      :                                               :  +- Exchange hashpartitioning(coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309), 3000), ENSURE_REQUIREMENTS, [id=#7739]
      :                                               :     +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                                               :        +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7724]
      :                                               :           +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
      :                                               :              +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
      :                                               :                 +- SortMergeJoin [ss_item_sk#7343L], [i_item_sk#7365L], Inner
      :                                               :                    :- Sort [ss_item_sk#7343L ASC NULLS FIRST], false, 0
      :                                               :                    :  +- Exchange hashpartitioning(ss_item_sk#7343L, 3000), ENSURE_REQUIREMENTS, [id=#7716]
      :                                               :                    :     +- Project [ss_item_sk#7343L]
      :                                               :                    :        +- BroadcastHashJoin [ss_sold_date_sk#7364L], [d_date_sk#7387L], Inner, BuildRight, false
      :                                               :                    :           :- Filter isnotnull(ss_item_sk#7343L)
      :                                               :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7343L,ss_sold_date_sk#7364L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7343L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7364L), dynamicpruningexpression(ss_sold_date_sk#7364L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
      :                                               :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7986, 0, true, Project [d_date_sk#7387L], [d_date_sk#7387L]
      :                                               :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                                               :                    :           :              +- Project [d_date_sk#7387L]
      :                                               :                    :           :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
      :                                               :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                               :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7693]
      :                                               :                    :              +- Project [d_date_sk#7387L]
      :                                               :                    :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
      :                                               :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                               :                    +- Sort [i_item_sk#7365L ASC NULLS FIRST], false, 0
      :                                               :                       +- Exchange hashpartitioning(i_item_sk#7365L, 3000), ENSURE_REQUIREMENTS, [id=#7717]
      :                                               :                          +- SortMergeJoin [coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376)], [coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460)], LeftSemi
      :                                               :                             :- Sort [coalesce(i_brand_id#7372, 0) ASC NULLS FIRST, isnull(i_brand_id#7372) ASC NULLS FIRST, coalesce(i_class_id#7374, 0) ASC NULLS FIRST, isnull(i_class_id#7374) ASC NULLS FIRST, coalesce(i_category_id#7376, 0) ASC NULLS FIRST, isnull(i_category_id#7376) ASC NULLS FIRST], false, 0
      :                                               :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376), 3000), ENSURE_REQUIREMENTS, [id=#7709]
      :                                               :                             :     +- Filter (((isnotnull(i_item_sk#7365L) AND isnotnull(i_brand_id#7372)) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376))
      :                                               :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_brand_id#7372,i_class_id#7374,i_category_id#7376] Batched: true, DataFilters: [isnotnull(i_item_sk#7365L), isnotnull(i_brand_id#7372), isnotnull(i_class_id#7374), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                                               :                             +- Sort [coalesce(i_brand_id#7456, 0) ASC NULLS FIRST, isnull(i_brand_id#7456) ASC NULLS FIRST, coalesce(i_class_id#7458, 0) ASC NULLS FIRST, isnull(i_class_id#7458) ASC NULLS FIRST, coalesce(i_category_id#7460, 0) ASC NULLS FIRST, isnull(i_category_id#7460) ASC NULLS FIRST], false, 0
      :                                               :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460), 3000), ENSURE_REQUIREMENTS, [id=#7710]
      :                                               :                                   +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
      :                                               :                                      +- SortMergeJoin [cs_item_sk#7429L], [i_item_sk#7449L], Inner
      :                                               :                                         :- Sort [cs_item_sk#7429L ASC NULLS FIRST], false, 0
      :                                               :                                         :  +- Exchange hashpartitioning(cs_item_sk#7429L, 3000), ENSURE_REQUIREMENTS, [id=#7701]
      :                                               :                                         :     +- Project [cs_item_sk#7429L]
      :                                               :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#7448L], [d_date_sk#7471L], Inner, BuildRight, false
      :                                               :                                         :           :- Filter isnotnull(cs_item_sk#7429L)
      :                                               :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#7429L,cs_sold_date_sk#7448L] Batched: true, DataFilters: [isnotnull(cs_item_sk#7429L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7448L), dynamicpruningexpression(cs_sold_date_sk#7448L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
      :                                               :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7987, 0, true, Project [d_date_sk#7471L], [d_date_sk#7471L]
      :                                               :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                                               :                                         :           :              +- Project [d_date_sk#7471L]
      :                                               :                                         :           :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
      :                                               :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                               :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7696]
      :                                               :                                         :              +- Project [d_date_sk#7471L]
      :                                               :                                         :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
      :                                               :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                               :                                         +- Sort [i_item_sk#7449L ASC NULLS FIRST], false, 0
      :                                               :                                            +- Exchange hashpartitioning(i_item_sk#7449L, 3000), ENSURE_REQUIREMENTS, [id=#7702]
      :                                               :                                               +- Filter isnotnull(i_item_sk#7449L)
      :                                               :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_brand_id#7456,i_class_id#7458,i_category_id#7460] Batched: true, DataFilters: [isnotnull(i_item_sk#7449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      :                                               +- Sort [coalesce(i_brand_id#7540, 0) ASC NULLS FIRST, isnull(i_brand_id#7540) ASC NULLS FIRST, coalesce(i_class_id#7542, 0) ASC NULLS FIRST, isnull(i_class_id#7542) ASC NULLS FIRST, coalesce(i_category_id#7544, 0) ASC NULLS FIRST, isnull(i_category_id#7544) ASC NULLS FIRST], false, 0
      :                                                  +- Exchange hashpartitioning(coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544), 3000), ENSURE_REQUIREMENTS, [id=#7740]
      :                                                     +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
      :                                                        +- SortMergeJoin [ws_item_sk#7501L], [i_item_sk#7533L], Inner
      :                                                           :- Sort [ws_item_sk#7501L ASC NULLS FIRST], false, 0
      :                                                           :  +- Exchange hashpartitioning(ws_item_sk#7501L, 3000), ENSURE_REQUIREMENTS, [id=#7731]
      :                                                           :     +- Project [ws_item_sk#7501L]
      :                                                           :        +- BroadcastHashJoin [ws_sold_date_sk#7532L], [d_date_sk#7555L], Inner, BuildRight, false
      :                                                           :           :- Filter isnotnull(ws_item_sk#7501L)
      :                                                           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#7501L,ws_sold_date_sk#7532L] Batched: true, DataFilters: [isnotnull(ws_item_sk#7501L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7532L), dynamicpruningexpression(ws_sold_date_sk#7532L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
      :                                                           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7988, 0, true, Project [d_date_sk#7555L], [d_date_sk#7555L]
      :                                                           :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                                                           :           :              +- Project [d_date_sk#7555L]
      :                                                           :           :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
      :                                                           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                                           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7726]
      :                                                           :              +- Project [d_date_sk#7555L]
      :                                                           :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
      :                                                           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                                                           +- Sort [i_item_sk#7533L ASC NULLS FIRST], false, 0
      :                                                              +- Exchange hashpartitioning(i_item_sk#7533L, 3000), ENSURE_REQUIREMENTS, [id=#7732]
      :                                                                 +- Filter isnotnull(i_item_sk#7533L)
      :                                                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_brand_id#7540,i_class_id#7542,i_category_id#7544] Batched: true, DataFilters: [isnotnull(i_item_sk#7533L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
      +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, int, true], input[2, int, true], input[3, int, true]),false), [id=#7912]
         +- Filter (isnotnull(sales#7302) AND (sales#7302 > Subquery subquery#7306, [id=#7335]))
            :  +- Subquery subquery#7306, [id=#7335]
            :     +- AdaptiveSparkPlan isFinalPlan=false
            :        +- HashAggregate(keys=[], functions=[avg((cast(quantity#7311 as double) * list_price#7312))], output=[average_sales#7317])
            :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#7333]
            :              +- HashAggregate(keys=[], functions=[partial_avg((cast(quantity#7311 as double) * list_price#7312))], output=[sum#8019, count#8020L])
            :                 +- Union
            :                    :- Project [ss_quantity#7592 AS quantity#7311, ss_list_price#7594 AS list_price#7312]
            :                    :  +- BroadcastHashJoin [ss_sold_date_sk#7605L], [d_date_sk#7606L], Inner, BuildRight, false
            :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#7592,ss_list_price#7594,ss_sold_date_sk#7605L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7605L), dynamicpruningexpression(ss_sold_date_sk#7605L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:double>
            :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7989, 0, true, Project [d_date_sk#7606L], [d_date_sk#7606L]
            :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
            :                    :     :           +- Project [d_date_sk#7606L]
            :                    :     :              +- Filter (((isnotnull(d_year#7612) AND (d_year#7612 >= 1998)) AND (d_year#7612 <= 2000)) AND isnotnull(d_date_sk#7606L))
            :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_year#7612] Batched: true, DataFilters: [isnotnull(d_year#7612), (d_year#7612 >= 1998), (d_year#7612 <= 2000), isnotnull(d_date_sk#7606L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7321]
            :                    :        +- Project [d_date_sk#7606L]
            :                    :           +- Filter (((isnotnull(d_year#7612) AND (d_year#7612 >= 1998)) AND (d_year#7612 <= 2000)) AND isnotnull(d_date_sk#7606L))
            :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7606L,d_year#7612] Batched: true, DataFilters: [isnotnull(d_year#7612), (d_year#7612 >= 1998), (d_year#7612 <= 2000), isnotnull(d_date_sk#7606L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :- Project [cs_quantity#7651 AS quantity#7313, cs_list_price#7653 AS list_price#7314]
            :                    :  +- BroadcastHashJoin [cs_sold_date_sk#7667L], [d_date_sk#7668L], Inner, BuildRight, false
            :                    :     :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_quantity#7651,cs_list_price#7653,cs_sold_date_sk#7667L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7667L), dynamicpruningexpression(cs_sold_date_sk#7667L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:double>
            :                    :     :     +- SubqueryAdaptiveBroadcast dynamicpruning#7990, 0, true, Project [d_date_sk#7668L], [d_date_sk#7668L]
            :                    :     :        +- AdaptiveSparkPlan isFinalPlan=false
            :                    :     :           +- Project [d_date_sk#7668L]
            :                    :     :              +- Filter (((isnotnull(d_year#7674) AND (d_year#7674 >= 1998)) AND (d_year#7674 <= 2000)) AND isnotnull(d_date_sk#7668L))
            :                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_year#7674] Batched: true, DataFilters: [isnotnull(d_year#7674), (d_year#7674 >= 1998), (d_year#7674 <= 2000), isnotnull(d_date_sk#7668L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7324]
            :                    :        +- Project [d_date_sk#7668L]
            :                    :           +- Filter (((isnotnull(d_year#7674) AND (d_year#7674 >= 1998)) AND (d_year#7674 <= 2000)) AND isnotnull(d_date_sk#7668L))
            :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7668L,d_year#7674] Batched: true, DataFilters: [isnotnull(d_year#7674), (d_year#7674 >= 1998), (d_year#7674 <= 2000), isnotnull(d_date_sk#7668L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    +- Project [ws_quantity#7713 AS quantity#7315, ws_list_price#7715 AS list_price#7316]
            :                       +- BroadcastHashJoin [ws_sold_date_sk#7729L], [d_date_sk#7730L], Inner, BuildRight, false
            :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_quantity#7713,ws_list_price#7715,ws_sold_date_sk#7729L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7729L), dynamicpruningexpression(ws_sold_date_sk#7729L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:double>
            :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#7991, 0, true, Project [d_date_sk#7730L], [d_date_sk#7730L]
            :                          :        +- AdaptiveSparkPlan isFinalPlan=false
            :                          :           +- Project [d_date_sk#7730L]
            :                          :              +- Filter (((isnotnull(d_year#7736) AND (d_year#7736 >= 1998)) AND (d_year#7736 <= 2000)) AND isnotnull(d_date_sk#7730L))
            :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_year#7736] Batched: true, DataFilters: [isnotnull(d_year#7736), (d_year#7736 >= 1998), (d_year#7736 <= 2000), isnotnull(d_date_sk#7730L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7327]
            :                             +- Project [d_date_sk#7730L]
            :                                +- Filter (((isnotnull(d_year#7736) AND (d_year#7736 >= 1998)) AND (d_year#7736 <= 2000)) AND isnotnull(d_date_sk#7730L))
            :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7730L,d_year#7736] Batched: true, DataFilters: [isnotnull(d_year#7736), (d_year#7736 >= 1998), (d_year#7736 <= 2000), isnotnull(d_date_sk#7730L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1998), LessThanOrEqual(d_year,2000), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
            +- HashAggregate(keys=[i_brand_id#7861, i_class_id#7863, i_category_id#7865], functions=[sum((cast(ss_quantity#7840 as double) * ss_list_price#7842)), count(1)], output=[channel#7301, i_brand_id#7861, i_class_id#7863, i_category_id#7865, sales#7302, number_sales#7303L])
               +- Exchange hashpartitioning(i_brand_id#7861, i_class_id#7863, i_category_id#7865, 3000), ENSURE_REQUIREMENTS, [id=#7908]
                  +- HashAggregate(keys=[i_brand_id#7861, i_class_id#7863, i_category_id#7865], functions=[partial_sum((cast(ss_quantity#7840 as double) * ss_list_price#7842)), partial_count(1)], output=[i_brand_id#7861, i_class_id#7863, i_category_id#7865, sum#8015, count#8016L])
                     +- Project [ss_quantity#7840, ss_list_price#7842, i_brand_id#7861, i_class_id#7863, i_category_id#7865]
                        +- SortMergeJoin [ss_item_sk#7832L], [i_item_sk#7854L], Inner
                           :- Project [ss_item_sk#7832L, ss_quantity#7840, ss_list_price#7842]
                           :  +- BroadcastHashJoin [ss_sold_date_sk#7853L], [d_date_sk#7876L], Inner, BuildRight, false
                           :     :- SortMergeJoin [ss_item_sk#7832L], [ss_item_sk#7310L], LeftSemi
                           :     :  :- Sort [ss_item_sk#7832L ASC NULLS FIRST], false, 0
                           :     :  :  +- Exchange hashpartitioning(ss_item_sk#7832L, 3000), ENSURE_REQUIREMENTS, [id=#7828]
                           :     :  :     +- Filter isnotnull(ss_item_sk#7832L)
                           :     :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7832L,ss_quantity#7840,ss_list_price#7842,ss_sold_date_sk#7853L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7832L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7853L), dynamicpruningexpression(ss_sold_date_sk#7853L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_quantity:int,ss_list_price:double>
                           :     :  :              +- SubqueryAdaptiveBroadcast dynamicpruning#8005, 0, true, Project [d_date_sk#7876L], [d_date_sk#7876L]
                           :     :  :                 +- AdaptiveSparkPlan isFinalPlan=false
                           :     :  :                    +- Project [d_date_sk#7876L]
                           :     :  :                       +- Filter ((isnotnull(d_week_seq#7880) AND (d_week_seq#7880 = Subquery subquery#7305, [id=#7345])) AND isnotnull(d_date_sk#7876L))
                           :     :  :                          :  +- Subquery subquery#7305, [id=#7345]
                           :     :  :                          :     +- AdaptiveSparkPlan isFinalPlan=false
                           :     :  :                          :        +- Project [d_week_seq#7936]
                           :     :  :                          :           +- Filter (((((isnotnull(d_year#7938) AND isnotnull(d_moy#7940)) AND isnotnull(d_dom#7941)) AND (d_year#7938 = 1998)) AND (d_moy#7940 = 12)) AND (d_dom#7941 = 16))
                           :     :  :                          :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#7936,d_year#7938,d_moy#7940,d_dom#7941] Batched: true, DataFilters: [isnotnull(d_year#7938), isnotnull(d_moy#7940), isnotnull(d_dom#7941), (d_year#7938 = 1998), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1998), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>
                           :     :  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7876L,d_week_seq#7880] Batched: true, DataFilters: [isnotnull(d_week_seq#7880), isnotnull(d_date_sk#7876L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
                           :     :  +- Sort [ss_item_sk#7310L ASC NULLS FIRST], false, 0
                           :     :     +- Exchange hashpartitioning(ss_item_sk#7310L, 3000), ENSURE_REQUIREMENTS, [id=#7829]
                           :     :        +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
                           :     :           +- BroadcastHashJoin [i_brand_id#7327, i_class_id#7329, i_category_id#7331], [brand_id#7307, class_id#7308, category_id#7309], Inner, BuildRight, false
                           :     :              :- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
                           :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_brand_id#7327,i_class_id#7329,i_category_id#7331] Batched: true, DataFilters: [isnotnull(i_brand_id#7327), isnotnull(i_class_id#7329), isnotnull(i_category_id#7331)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                           :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#7823]
                           :     :                 +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                           :     :                    +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7820]
                           :     :                       +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                           :     :                          +- SortMergeJoin [coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309)], [coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544)], LeftSemi
                           :     :                             :- Sort [coalesce(brand_id#7307, 0) ASC NULLS FIRST, isnull(brand_id#7307) ASC NULLS FIRST, coalesce(class_id#7308, 0) ASC NULLS FIRST, isnull(class_id#7308) ASC NULLS FIRST, coalesce(category_id#7309, 0) ASC NULLS FIRST, isnull(category_id#7309) ASC NULLS FIRST], false, 0
                           :     :                             :  +- Exchange hashpartitioning(coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309), 3000), ENSURE_REQUIREMENTS, [id=#7813]
                           :     :                             :     +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                           :     :                             :        +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7798]
                           :     :                             :           +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                           :     :                             :              +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
                           :     :                             :                 +- SortMergeJoin [ss_item_sk#7343L], [i_item_sk#7365L], Inner
                           :     :                             :                    :- Sort [ss_item_sk#7343L ASC NULLS FIRST], false, 0
                           :     :                             :                    :  +- Exchange hashpartitioning(ss_item_sk#7343L, 3000), ENSURE_REQUIREMENTS, [id=#7790]
                           :     :                             :                    :     +- Project [ss_item_sk#7343L]
                           :     :                             :                    :        +- BroadcastHashJoin [ss_sold_date_sk#7364L], [d_date_sk#7387L], Inner, BuildRight, false
                           :     :                             :                    :           :- Filter isnotnull(ss_item_sk#7343L)
                           :     :                             :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7343L,ss_sold_date_sk#7364L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7343L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7364L), dynamicpruningexpression(ss_sold_date_sk#7364L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                           :     :                             :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7992, 0, true, Project [d_date_sk#7387L], [d_date_sk#7387L]
                           :     :                             :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                           :     :                             :                    :           :              +- Project [d_date_sk#7387L]
                           :     :                             :                    :           :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
                           :     :                             :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                             :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7767]
                           :     :                             :                    :              +- Project [d_date_sk#7387L]
                           :     :                             :                    :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
                           :     :                             :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                             :                    +- Sort [i_item_sk#7365L ASC NULLS FIRST], false, 0
                           :     :                             :                       +- Exchange hashpartitioning(i_item_sk#7365L, 3000), ENSURE_REQUIREMENTS, [id=#7791]
                           :     :                             :                          +- SortMergeJoin [coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376)], [coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460)], LeftSemi
                           :     :                             :                             :- Sort [coalesce(i_brand_id#7372, 0) ASC NULLS FIRST, isnull(i_brand_id#7372) ASC NULLS FIRST, coalesce(i_class_id#7374, 0) ASC NULLS FIRST, isnull(i_class_id#7374) ASC NULLS FIRST, coalesce(i_category_id#7376, 0) ASC NULLS FIRST, isnull(i_category_id#7376) ASC NULLS FIRST], false, 0
                           :     :                             :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376), 3000), ENSURE_REQUIREMENTS, [id=#7783]
                           :     :                             :                             :     +- Filter (((isnotnull(i_item_sk#7365L) AND isnotnull(i_brand_id#7372)) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376))
                           :     :                             :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_brand_id#7372,i_class_id#7374,i_category_id#7376] Batched: true, DataFilters: [isnotnull(i_item_sk#7365L), isnotnull(i_brand_id#7372), isnotnull(i_class_id#7374), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                           :     :                             :                             +- Sort [coalesce(i_brand_id#7456, 0) ASC NULLS FIRST, isnull(i_brand_id#7456) ASC NULLS FIRST, coalesce(i_class_id#7458, 0) ASC NULLS FIRST, isnull(i_class_id#7458) ASC NULLS FIRST, coalesce(i_category_id#7460, 0) ASC NULLS FIRST, isnull(i_category_id#7460) ASC NULLS FIRST], false, 0
                           :     :                             :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460), 3000), ENSURE_REQUIREMENTS, [id=#7784]
                           :     :                             :                                   +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                           :     :                             :                                      +- SortMergeJoin [cs_item_sk#7429L], [i_item_sk#7449L], Inner
                           :     :                             :                                         :- Sort [cs_item_sk#7429L ASC NULLS FIRST], false, 0
                           :     :                             :                                         :  +- Exchange hashpartitioning(cs_item_sk#7429L, 3000), ENSURE_REQUIREMENTS, [id=#7775]
                           :     :                             :                                         :     +- Project [cs_item_sk#7429L]
                           :     :                             :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#7448L], [d_date_sk#7471L], Inner, BuildRight, false
                           :     :                             :                                         :           :- Filter isnotnull(cs_item_sk#7429L)
                           :     :                             :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#7429L,cs_sold_date_sk#7448L] Batched: true, DataFilters: [isnotnull(cs_item_sk#7429L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7448L), dynamicpruningexpression(cs_sold_date_sk#7448L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                           :     :                             :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7993, 0, true, Project [d_date_sk#7471L], [d_date_sk#7471L]
                           :     :                             :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                           :     :                             :                                         :           :              +- Project [d_date_sk#7471L]
                           :     :                             :                                         :           :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
                           :     :                             :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                             :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7770]
                           :     :                             :                                         :              +- Project [d_date_sk#7471L]
                           :     :                             :                                         :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
                           :     :                             :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                             :                                         +- Sort [i_item_sk#7449L ASC NULLS FIRST], false, 0
                           :     :                             :                                            +- Exchange hashpartitioning(i_item_sk#7449L, 3000), ENSURE_REQUIREMENTS, [id=#7776]
                           :     :                             :                                               +- Filter isnotnull(i_item_sk#7449L)
                           :     :                             :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_brand_id#7456,i_class_id#7458,i_category_id#7460] Batched: true, DataFilters: [isnotnull(i_item_sk#7449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                           :     :                             +- Sort [coalesce(i_brand_id#7540, 0) ASC NULLS FIRST, isnull(i_brand_id#7540) ASC NULLS FIRST, coalesce(i_class_id#7542, 0) ASC NULLS FIRST, isnull(i_class_id#7542) ASC NULLS FIRST, coalesce(i_category_id#7544, 0) ASC NULLS FIRST, isnull(i_category_id#7544) ASC NULLS FIRST], false, 0
                           :     :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544), 3000), ENSURE_REQUIREMENTS, [id=#7814]
                           :     :                                   +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                           :     :                                      +- SortMergeJoin [ws_item_sk#7501L], [i_item_sk#7533L], Inner
                           :     :                                         :- Sort [ws_item_sk#7501L ASC NULLS FIRST], false, 0
                           :     :                                         :  +- Exchange hashpartitioning(ws_item_sk#7501L, 3000), ENSURE_REQUIREMENTS, [id=#7805]
                           :     :                                         :     +- Project [ws_item_sk#7501L]
                           :     :                                         :        +- BroadcastHashJoin [ws_sold_date_sk#7532L], [d_date_sk#7555L], Inner, BuildRight, false
                           :     :                                         :           :- Filter isnotnull(ws_item_sk#7501L)
                           :     :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#7501L,ws_sold_date_sk#7532L] Batched: true, DataFilters: [isnotnull(ws_item_sk#7501L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7532L), dynamicpruningexpression(ws_sold_date_sk#7532L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                           :     :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7994, 0, true, Project [d_date_sk#7555L], [d_date_sk#7555L]
                           :     :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                           :     :                                         :           :              +- Project [d_date_sk#7555L]
                           :     :                                         :           :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
                           :     :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7800]
                           :     :                                         :              +- Project [d_date_sk#7555L]
                           :     :                                         :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
                           :     :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                           :     :                                         +- Sort [i_item_sk#7533L ASC NULLS FIRST], false, 0
                           :     :                                            +- Exchange hashpartitioning(i_item_sk#7533L, 3000), ENSURE_REQUIREMENTS, [id=#7806]
                           :     :                                               +- Filter isnotnull(i_item_sk#7533L)
                           :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_brand_id#7540,i_class_id#7542,i_category_id#7544] Batched: true, DataFilters: [isnotnull(i_item_sk#7533L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7834]
                           :        +- Project [d_date_sk#7876L]
                           :           +- Filter ((isnotnull(d_week_seq#7880) AND (d_week_seq#7880 = Subquery subquery#7305, [id=#7373])) AND isnotnull(d_date_sk#7876L))
                           :              :  +- Subquery subquery#7305, [id=#7373]
                           :              :     +- AdaptiveSparkPlan isFinalPlan=false
                           :              :        +- Project [d_week_seq#7936]
                           :              :           +- Filter (((((isnotnull(d_year#7938) AND isnotnull(d_moy#7940)) AND isnotnull(d_dom#7941)) AND (d_year#7938 = 1998)) AND (d_moy#7940 = 12)) AND (d_dom#7941 = 16))
                           :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_week_seq#7936,d_year#7938,d_moy#7940,d_dom#7941] Batched: true, DataFilters: [isnotnull(d_year#7938), isnotnull(d_moy#7940), isnotnull(d_dom#7941), (d_year#7938 = 1998), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1998), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>
                           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7876L,d_week_seq#7880] Batched: true, DataFilters: [isnotnull(d_week_seq#7880), isnotnull(d_date_sk#7876L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
                           +- SortMergeJoin [i_item_sk#7854L], [ss_item_sk#7310L], LeftSemi
                              :- Sort [i_item_sk#7854L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(i_item_sk#7854L, 3000), ENSURE_REQUIREMENTS, [id=#7898]
                              :     +- Filter (((isnotnull(i_item_sk#7854L) AND isnotnull(i_brand_id#7861)) AND isnotnull(i_class_id#7863)) AND isnotnull(i_category_id#7865))
                              :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7854L,i_brand_id#7861,i_class_id#7863,i_category_id#7865] Batched: true, DataFilters: [isnotnull(i_item_sk#7854L), isnotnull(i_brand_id#7861), isnotnull(i_class_id#7863), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                              +- Sort [ss_item_sk#7310L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(ss_item_sk#7310L, 3000), ENSURE_REQUIREMENTS, [id=#7899]
                                    +- Project [i_item_sk#7320L AS ss_item_sk#7310L]
                                       +- BroadcastHashJoin [i_brand_id#7327, i_class_id#7329, i_category_id#7331], [brand_id#7307, class_id#7308, category_id#7309], Inner, BuildRight, false
                                          :- Filter ((isnotnull(i_brand_id#7327) AND isnotnull(i_class_id#7329)) AND isnotnull(i_category_id#7331))
                                          :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7320L,i_brand_id#7327,i_class_id#7329,i_category_id#7331] Batched: true, DataFilters: [isnotnull(i_brand_id#7327), isnotnull(i_class_id#7329), isnotnull(i_category_id#7331)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, int, true], input[2, int, true]),false), [id=#7893]
                                             +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                                                +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7890]
                                                   +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                                                      +- SortMergeJoin [coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309)], [coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544)], LeftSemi
                                                         :- Sort [coalesce(brand_id#7307, 0) ASC NULLS FIRST, isnull(brand_id#7307) ASC NULLS FIRST, coalesce(class_id#7308, 0) ASC NULLS FIRST, isnull(class_id#7308) ASC NULLS FIRST, coalesce(category_id#7309, 0) ASC NULLS FIRST, isnull(category_id#7309) ASC NULLS FIRST], false, 0
                                                         :  +- Exchange hashpartitioning(coalesce(brand_id#7307, 0), isnull(brand_id#7307), coalesce(class_id#7308, 0), isnull(class_id#7308), coalesce(category_id#7309, 0), isnull(category_id#7309), 3000), ENSURE_REQUIREMENTS, [id=#7883]
                                                         :     +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                                                         :        +- Exchange hashpartitioning(brand_id#7307, class_id#7308, category_id#7309, 3000), ENSURE_REQUIREMENTS, [id=#7868]
                                                         :           +- HashAggregate(keys=[brand_id#7307, class_id#7308, category_id#7309], functions=[], output=[brand_id#7307, class_id#7308, category_id#7309])
                                                         :              +- Project [i_brand_id#7372 AS brand_id#7307, i_class_id#7374 AS class_id#7308, i_category_id#7376 AS category_id#7309]
                                                         :                 +- SortMergeJoin [ss_item_sk#7343L], [i_item_sk#7365L], Inner
                                                         :                    :- Sort [ss_item_sk#7343L ASC NULLS FIRST], false, 0
                                                         :                    :  +- Exchange hashpartitioning(ss_item_sk#7343L, 3000), ENSURE_REQUIREMENTS, [id=#7860]
                                                         :                    :     +- Project [ss_item_sk#7343L]
                                                         :                    :        +- BroadcastHashJoin [ss_sold_date_sk#7364L], [d_date_sk#7387L], Inner, BuildRight, false
                                                         :                    :           :- Filter isnotnull(ss_item_sk#7343L)
                                                         :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#7343L,ss_sold_date_sk#7364L] Batched: true, DataFilters: [isnotnull(ss_item_sk#7343L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#7364L), dynamicpruningexpression(ss_sold_date_sk#7364L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                                                         :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7992, 0, true, Project [d_date_sk#7387L], [d_date_sk#7387L]
                                                         :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                         :                    :           :              +- Project [d_date_sk#7387L]
                                                         :                    :           :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
                                                         :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                         :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7837]
                                                         :                    :              +- Project [d_date_sk#7387L]
                                                         :                    :                 +- Filter (((isnotnull(d_year#7393) AND (d_year#7393 >= 1999)) AND (d_year#7393 <= 2001)) AND isnotnull(d_date_sk#7387L))
                                                         :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7387L,d_year#7393] Batched: true, DataFilters: [isnotnull(d_year#7393), (d_year#7393 >= 1999), (d_year#7393 <= 2001), isnotnull(d_date_sk#7387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                         :                    +- Sort [i_item_sk#7365L ASC NULLS FIRST], false, 0
                                                         :                       +- Exchange hashpartitioning(i_item_sk#7365L, 3000), ENSURE_REQUIREMENTS, [id=#7861]
                                                         :                          +- SortMergeJoin [coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376)], [coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460)], LeftSemi
                                                         :                             :- Sort [coalesce(i_brand_id#7372, 0) ASC NULLS FIRST, isnull(i_brand_id#7372) ASC NULLS FIRST, coalesce(i_class_id#7374, 0) ASC NULLS FIRST, isnull(i_class_id#7374) ASC NULLS FIRST, coalesce(i_category_id#7376, 0) ASC NULLS FIRST, isnull(i_category_id#7376) ASC NULLS FIRST], false, 0
                                                         :                             :  +- Exchange hashpartitioning(coalesce(i_brand_id#7372, 0), isnull(i_brand_id#7372), coalesce(i_class_id#7374, 0), isnull(i_class_id#7374), coalesce(i_category_id#7376, 0), isnull(i_category_id#7376), 3000), ENSURE_REQUIREMENTS, [id=#7853]
                                                         :                             :     +- Filter (((isnotnull(i_item_sk#7365L) AND isnotnull(i_brand_id#7372)) AND isnotnull(i_class_id#7374)) AND isnotnull(i_category_id#7376))
                                                         :                             :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7365L,i_brand_id#7372,i_class_id#7374,i_category_id#7376] Batched: true, DataFilters: [isnotnull(i_item_sk#7365L), isnotnull(i_brand_id#7372), isnotnull(i_class_id#7374), isnotnull(i_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand_id), IsNotNull(i_class_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                                         :                             +- Sort [coalesce(i_brand_id#7456, 0) ASC NULLS FIRST, isnull(i_brand_id#7456) ASC NULLS FIRST, coalesce(i_class_id#7458, 0) ASC NULLS FIRST, isnull(i_class_id#7458) ASC NULLS FIRST, coalesce(i_category_id#7460, 0) ASC NULLS FIRST, isnull(i_category_id#7460) ASC NULLS FIRST], false, 0
                                                         :                                +- Exchange hashpartitioning(coalesce(i_brand_id#7456, 0), isnull(i_brand_id#7456), coalesce(i_class_id#7458, 0), isnull(i_class_id#7458), coalesce(i_category_id#7460, 0), isnull(i_category_id#7460), 3000), ENSURE_REQUIREMENTS, [id=#7854]
                                                         :                                   +- Project [i_brand_id#7456, i_class_id#7458, i_category_id#7460]
                                                         :                                      +- SortMergeJoin [cs_item_sk#7429L], [i_item_sk#7449L], Inner
                                                         :                                         :- Sort [cs_item_sk#7429L ASC NULLS FIRST], false, 0
                                                         :                                         :  +- Exchange hashpartitioning(cs_item_sk#7429L, 3000), ENSURE_REQUIREMENTS, [id=#7845]
                                                         :                                         :     +- Project [cs_item_sk#7429L]
                                                         :                                         :        +- BroadcastHashJoin [cs_sold_date_sk#7448L], [d_date_sk#7471L], Inner, BuildRight, false
                                                         :                                         :           :- Filter isnotnull(cs_item_sk#7429L)
                                                         :                                         :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#7429L,cs_sold_date_sk#7448L] Batched: true, DataFilters: [isnotnull(cs_item_sk#7429L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#7448L), dynamicpruningexpression(cs_sold_date_sk#7448L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>
                                                         :                                         :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7993, 0, true, Project [d_date_sk#7471L], [d_date_sk#7471L]
                                                         :                                         :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                         :                                         :           :              +- Project [d_date_sk#7471L]
                                                         :                                         :           :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
                                                         :                                         :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                         :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7840]
                                                         :                                         :              +- Project [d_date_sk#7471L]
                                                         :                                         :                 +- Filter (((isnotnull(d_year#7477) AND (d_year#7477 >= 1999)) AND (d_year#7477 <= 2001)) AND isnotnull(d_date_sk#7471L))
                                                         :                                         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7471L,d_year#7477] Batched: true, DataFilters: [isnotnull(d_year#7477), (d_year#7477 >= 1999), (d_year#7477 <= 2001), isnotnull(d_date_sk#7471L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                         :                                         +- Sort [i_item_sk#7449L ASC NULLS FIRST], false, 0
                                                         :                                            +- Exchange hashpartitioning(i_item_sk#7449L, 3000), ENSURE_REQUIREMENTS, [id=#7846]
                                                         :                                               +- Filter isnotnull(i_item_sk#7449L)
                                                         :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7449L,i_brand_id#7456,i_class_id#7458,i_category_id#7460] Batched: true, DataFilters: [isnotnull(i_item_sk#7449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>
                                                         +- Sort [coalesce(i_brand_id#7540, 0) ASC NULLS FIRST, isnull(i_brand_id#7540) ASC NULLS FIRST, coalesce(i_class_id#7542, 0) ASC NULLS FIRST, isnull(i_class_id#7542) ASC NULLS FIRST, coalesce(i_category_id#7544, 0) ASC NULLS FIRST, isnull(i_category_id#7544) ASC NULLS FIRST], false, 0
                                                            +- Exchange hashpartitioning(coalesce(i_brand_id#7540, 0), isnull(i_brand_id#7540), coalesce(i_class_id#7542, 0), isnull(i_class_id#7542), coalesce(i_category_id#7544, 0), isnull(i_category_id#7544), 3000), ENSURE_REQUIREMENTS, [id=#7884]
                                                               +- Project [i_brand_id#7540, i_class_id#7542, i_category_id#7544]
                                                                  +- SortMergeJoin [ws_item_sk#7501L], [i_item_sk#7533L], Inner
                                                                     :- Sort [ws_item_sk#7501L ASC NULLS FIRST], false, 0
                                                                     :  +- Exchange hashpartitioning(ws_item_sk#7501L, 3000), ENSURE_REQUIREMENTS, [id=#7875]
                                                                     :     +- Project [ws_item_sk#7501L]
                                                                     :        +- BroadcastHashJoin [ws_sold_date_sk#7532L], [d_date_sk#7555L], Inner, BuildRight, false
                                                                     :           :- Filter isnotnull(ws_item_sk#7501L)
                                                                     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#7501L,ws_sold_date_sk#7532L] Batched: true, DataFilters: [isnotnull(ws_item_sk#7501L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#7532L), dynamicpruningexpression(ws_sold_date_sk#7532L IN dynamicpruni..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint>
                                                                     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#7994, 0, true, Project [d_date_sk#7555L], [d_date_sk#7555L]
                                                                     :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                                                     :           :              +- Project [d_date_sk#7555L]
                                                                     :           :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
                                                                     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#7870]
                                                                     :              +- Project [d_date_sk#7555L]
                                                                     :                 +- Filter (((isnotnull(d_year#7561) AND (d_year#7561 >= 1999)) AND (d_year#7561 <= 2001)) AND isnotnull(d_date_sk#7555L))
                                                                     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#7555L,d_year#7561] Batched: true, DataFilters: [isnotnull(d_year#7561), (d_year#7561 >= 1999), (d_year#7561 <= 2001), isnotnull(d_date_sk#7555L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                                                     +- Sort [i_item_sk#7533L ASC NULLS FIRST], false, 0
                                                                        +- Exchange hashpartitioning(i_item_sk#7533L, 3000), ENSURE_REQUIREMENTS, [id=#7876]
                                                                           +- Filter isnotnull(i_item_sk#7533L)
                                                                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#7533L,i_brand_id#7540,i_class_id#7542,i_category_id#7544] Batched: true, DataFilters: [isnotnull(i_item_sk#7533L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int>

read query: spark_queries/q15.sql
explain query: q15
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ca_zip ASC NULLS FIRST], true
      +- 'Aggregate ['ca_zip], ['ca_zip, unresolvedalias('sum('cs_sales_price), None)]
         +- 'Filter (((('cs_bill_customer_sk = 'c_customer_sk) AND ('c_current_addr_sk = 'ca_address_sk)) AND (('substr('ca_zip, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR 'ca_state IN (CA,WA,GA)) OR ('cs_sales_price > 500))) AND ((('cs_sold_date_sk = 'd_date_sk) AND ('d_qoy = 2)) AND ('d_year = 2000)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  +- 'UnresolvedRelation [customer], [], false
               :  +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
ca_zip: string, sum(cs_sales_price): double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_zip#8082 ASC NULLS FIRST], true
      +- Aggregate [ca_zip#8082], [ca_zip#8082, sum(cs_sales_price#8041) AS sum(cs_sales_price)#8115]
         +- Filter ((((cs_bill_customer_sk#8023L = c_customer_sk#8055L) AND (c_current_addr_sk#8059L = ca_address_sk#8073L)) AND ((substr(ca_zip#8082, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR ca_state#8081 IN (CA,WA,GA)) OR (cs_sales_price#8041 > cast(500 as double)))) AND (((cs_sold_date_sk#8054L = d_date_sk#8086L) AND (d_qoy#8096 = 2)) AND (d_year#8092 = 2000)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8021L,cs_ship_date_sk#8022L,cs_bill_customer_sk#8023L,cs_bill_cdemo_sk#8024L,cs_bill_hdemo_sk#8025L,cs_bill_addr_sk#8026L,cs_ship_customer_sk#8027L,cs_ship_cdemo_sk#8028L,cs_ship_hdemo_sk#8029L,cs_ship_addr_sk#8030L,cs_call_center_sk#8031L,cs_catalog_page_sk#8032L,cs_ship_mode_sk#8033L,cs_warehouse_sk#8034L,cs_item_sk#8035L,cs_promo_sk#8036L,cs_order_number#8037L,cs_quantity#8038,cs_wholesale_cost#8039,cs_list_price#8040,cs_sales_price#8041,cs_ext_discount_amt#8042,cs_ext_sales_price#8043,cs_ext_wholesale_cost#8044,... 10 more fields] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8055L,c_customer_id#8056,c_current_cdemo_sk#8057L,c_current_hdemo_sk#8058L,c_current_addr_sk#8059L,c_first_shipto_date_sk#8060L,c_first_sales_date_sk#8061L,c_salutation#8062,c_first_name#8063,c_last_name#8064,c_preferred_cust_flag#8065,c_birth_day#8066,c_birth_month#8067,c_birth_year#8068,c_birth_country#8069,c_login#8070,c_email_address#8071,c_last_review_date#8072] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8073L,ca_address_id#8074,ca_street_number#8075,ca_street_name#8076,ca_street_type#8077,ca_suite_number#8078,ca_city#8079,ca_county#8080,ca_state#8081,ca_zip#8082,ca_country#8083,ca_gmt_offset#8084,ca_location_type#8085] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8086L,d_date_id#8087,d_date#8088,d_month_seq#8089,d_week_seq#8090,d_quarter_seq#8091,d_year#8092,d_dow#8093,d_moy#8094,d_dom#8095,d_qoy#8096,d_fy_year#8097,d_fy_quarter_seq#8098,d_fy_week_seq#8099,d_day_name#8100,d_quarter_name#8101,d_holiday#8102,d_weekend#8103,d_following_holiday#8104,d_first_dom#8105,d_last_dom#8106,d_same_day_ly#8107,d_same_day_lq#8108,d_current_day#8109,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_zip#8082 ASC NULLS FIRST], true
      +- Aggregate [ca_zip#8082], [ca_zip#8082, sum(cs_sales_price#8041) AS sum(cs_sales_price)#8115]
         +- Project [cs_sales_price#8041, ca_zip#8082]
            +- Join Inner, ((cs_bill_customer_sk#8023L = c_customer_sk#8055L) AND ((substr(ca_zip#8082, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR ca_state#8081 IN (CA,WA,GA)) OR (cs_sales_price#8041 > 500.0)))
               :- Project [cs_bill_customer_sk#8023L, cs_sales_price#8041]
               :  +- Join Inner, (cs_sold_date_sk#8054L = d_date_sk#8086L)
               :     :- Project [cs_bill_customer_sk#8023L, cs_sales_price#8041, cs_sold_date_sk#8054L]
               :     :  +- Filter ((isnotnull(cs_bill_customer_sk#8023L) AND isnotnull(cs_sold_date_sk#8054L)) AND dynamicpruning#8118 [cs_sold_date_sk#8054L])
               :     :     :  +- Project [d_date_sk#8086L]
               :     :     :     +- Filter (((isnotnull(d_qoy#8096) AND isnotnull(d_year#8092)) AND ((d_qoy#8096 = 2) AND (d_year#8092 = 2000))) AND isnotnull(d_date_sk#8086L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8086L,d_date_id#8087,d_date#8088,d_month_seq#8089,d_week_seq#8090,d_quarter_seq#8091,d_year#8092,d_dow#8093,d_moy#8094,d_dom#8095,d_qoy#8096,d_fy_year#8097,d_fy_quarter_seq#8098,d_fy_week_seq#8099,d_day_name#8100,d_quarter_name#8101,d_holiday#8102,d_weekend#8103,d_following_holiday#8104,d_first_dom#8105,d_last_dom#8106,d_same_day_ly#8107,d_same_day_lq#8108,d_current_day#8109,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8021L,cs_ship_date_sk#8022L,cs_bill_customer_sk#8023L,cs_bill_cdemo_sk#8024L,cs_bill_hdemo_sk#8025L,cs_bill_addr_sk#8026L,cs_ship_customer_sk#8027L,cs_ship_cdemo_sk#8028L,cs_ship_hdemo_sk#8029L,cs_ship_addr_sk#8030L,cs_call_center_sk#8031L,cs_catalog_page_sk#8032L,cs_ship_mode_sk#8033L,cs_warehouse_sk#8034L,cs_item_sk#8035L,cs_promo_sk#8036L,cs_order_number#8037L,cs_quantity#8038,cs_wholesale_cost#8039,cs_list_price#8040,cs_sales_price#8041,cs_ext_discount_amt#8042,cs_ext_sales_price#8043,cs_ext_wholesale_cost#8044,... 10 more fields] orc
               :     +- Project [d_date_sk#8086L]
               :        +- Filter (((isnotnull(d_qoy#8096) AND isnotnull(d_year#8092)) AND ((d_qoy#8096 = 2) AND (d_year#8092 = 2000))) AND isnotnull(d_date_sk#8086L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8086L,d_date_id#8087,d_date#8088,d_month_seq#8089,d_week_seq#8090,d_quarter_seq#8091,d_year#8092,d_dow#8093,d_moy#8094,d_dom#8095,d_qoy#8096,d_fy_year#8097,d_fy_quarter_seq#8098,d_fy_week_seq#8099,d_day_name#8100,d_quarter_name#8101,d_holiday#8102,d_weekend#8103,d_following_holiday#8104,d_first_dom#8105,d_last_dom#8106,d_same_day_ly#8107,d_same_day_lq#8108,d_current_day#8109,... 4 more fields] orc
               +- Project [c_customer_sk#8055L, ca_state#8081, ca_zip#8082]
                  +- Join Inner, (c_current_addr_sk#8059L = ca_address_sk#8073L)
                     :- Project [c_customer_sk#8055L, c_current_addr_sk#8059L]
                     :  +- Filter (isnotnull(c_customer_sk#8055L) AND isnotnull(c_current_addr_sk#8059L))
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8055L,c_customer_id#8056,c_current_cdemo_sk#8057L,c_current_hdemo_sk#8058L,c_current_addr_sk#8059L,c_first_shipto_date_sk#8060L,c_first_sales_date_sk#8061L,c_salutation#8062,c_first_name#8063,c_last_name#8064,c_preferred_cust_flag#8065,c_birth_day#8066,c_birth_month#8067,c_birth_year#8068,c_birth_country#8069,c_login#8070,c_email_address#8071,c_last_review_date#8072] orc
                     +- Project [ca_address_sk#8073L, ca_state#8081, ca_zip#8082]
                        +- Filter isnotnull(ca_address_sk#8073L)
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8073L,ca_address_id#8074,ca_street_number#8075,ca_street_name#8076,ca_street_type#8077,ca_suite_number#8078,ca_city#8079,ca_county#8080,ca_state#8081,ca_zip#8082,ca_country#8083,ca_gmt_offset#8084,ca_location_type#8085] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ca_zip#8082 ASC NULLS FIRST], output=[ca_zip#8082,sum(cs_sales_price)#8115])
   +- HashAggregate(keys=[ca_zip#8082], functions=[sum(cs_sales_price#8041)], output=[ca_zip#8082, sum(cs_sales_price)#8115])
      +- Exchange hashpartitioning(ca_zip#8082, 3000), ENSURE_REQUIREMENTS, [id=#8026]
         +- HashAggregate(keys=[ca_zip#8082], functions=[partial_sum(cs_sales_price#8041)], output=[ca_zip#8082, sum#8120])
            +- Project [cs_sales_price#8041, ca_zip#8082]
               +- SortMergeJoin [cs_bill_customer_sk#8023L], [c_customer_sk#8055L], Inner, ((substr(ca_zip#8082, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR ca_state#8081 IN (CA,WA,GA)) OR (cs_sales_price#8041 > 500.0))
                  :- Sort [cs_bill_customer_sk#8023L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_bill_customer_sk#8023L, 3000), ENSURE_REQUIREMENTS, [id=#8018]
                  :     +- Project [cs_bill_customer_sk#8023L, cs_sales_price#8041]
                  :        +- BroadcastHashJoin [cs_sold_date_sk#8054L], [d_date_sk#8086L], Inner, BuildRight, false
                  :           :- Filter isnotnull(cs_bill_customer_sk#8023L)
                  :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#8023L,cs_sales_price#8041,cs_sold_date_sk#8054L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#8023L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#8054L), dynamicpruningexpression(cs_sold_date_sk#8054L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_sales_price:double>
                  :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#8118, 0, true, Project [d_date_sk#8086L], [d_date_sk#8086L]
                  :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :              +- Project [d_date_sk#8086L]
                  :           :                 +- Filter ((((isnotnull(d_qoy#8096) AND isnotnull(d_year#8092)) AND (d_qoy#8096 = 2)) AND (d_year#8092 = 2000)) AND isnotnull(d_date_sk#8086L))
                  :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8086L,d_year#8092,d_qoy#8096] Batched: true, DataFilters: [isnotnull(d_qoy#8096), isnotnull(d_year#8092), (d_qoy#8096 = 2), (d_year#8092 = 2000), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8006]
                  :              +- Project [d_date_sk#8086L]
                  :                 +- Filter ((((isnotnull(d_qoy#8096) AND isnotnull(d_year#8092)) AND (d_qoy#8096 = 2)) AND (d_year#8092 = 2000)) AND isnotnull(d_date_sk#8086L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8086L,d_year#8092,d_qoy#8096] Batched: true, DataFilters: [isnotnull(d_qoy#8096), isnotnull(d_year#8092), (d_qoy#8096 = 2), (d_year#8092 = 2000), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  +- Sort [c_customer_sk#8055L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(c_customer_sk#8055L, 3000), ENSURE_REQUIREMENTS, [id=#8019]
                        +- Project [c_customer_sk#8055L, ca_state#8081, ca_zip#8082]
                           +- SortMergeJoin [c_current_addr_sk#8059L], [ca_address_sk#8073L], Inner
                              :- Sort [c_current_addr_sk#8059L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(c_current_addr_sk#8059L, 3000), ENSURE_REQUIREMENTS, [id=#8010]
                              :     +- Filter (isnotnull(c_customer_sk#8055L) AND isnotnull(c_current_addr_sk#8059L))
                              :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8055L,c_current_addr_sk#8059L] Batched: true, DataFilters: [isnotnull(c_customer_sk#8055L), isnotnull(c_current_addr_sk#8059L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
                              +- Sort [ca_address_sk#8073L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(ca_address_sk#8073L, 3000), ENSURE_REQUIREMENTS, [id=#8011]
                                    +- Filter isnotnull(ca_address_sk#8073L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8073L,ca_state#8081,ca_zip#8082] Batched: true, DataFilters: [isnotnull(ca_address_sk#8073L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_zip:string>

read query: spark_queries/q16.sql
explain query: q16
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['count(distinct 'cs_order_number) ASC NULLS FIRST], true
      +- 'Project ['count(distinct 'cs_order_number) AS order count#8121, 'sum('cs_ext_ship_cost) AS total shipping cost#8122, 'sum('cs_net_profit) AS total net profit#8123]
         +- 'Filter ((((('d_date >= 2001-4-01) AND ('d_date <= (cast(2001-4-01 as date) + INTERVAL '60' DAY))) AND ('cs1.cs_ship_date_sk = 'd_date_sk)) AND (('cs1.cs_ship_addr_sk = 'ca_address_sk) AND ('ca_state = NY))) AND ((('cs1.cs_call_center_sk = 'cc_call_center_sk) AND 'cc_county IN (Ziebach County,Levy County,Huron County,Franklin Parish,Daviess County)) AND (exists#8124 [] AND NOT exists#8125 [])))
            :  :- 'Project [*]
            :  :  +- 'Filter (('cs1.cs_order_number = 'cs2.cs_order_number) AND NOT ('cs1.cs_warehouse_sk = 'cs2.cs_warehouse_sk))
            :  :     +- 'SubqueryAlias cs2
            :  :        +- 'UnresolvedRelation [catalog_sales], [], false
            :  +- 'Project [*]
            :     +- 'Filter ('cs1.cs_order_number = 'cr1.cr_order_number)
            :        +- 'SubqueryAlias cr1
            :           +- 'UnresolvedRelation [catalog_returns], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'SubqueryAlias cs1
               :  :  :  +- 'UnresolvedRelation [catalog_sales], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [call_center], [], false

== Analyzed Logical Plan ==
order count: bigint, total shipping cost: double, total net profit: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [order count#8121L ASC NULLS FIRST], true
      +- Aggregate [count(distinct cs_order_number#8142L) AS order count#8121L, sum(cs_ext_ship_cost#8153) AS total shipping cost#8122, sum(cs_net_profit#8158) AS total net profit#8123]
         +- Filter (((((d_date#8162 >= cast(2001-4-01 as date)) AND (d_date#8162 <= date_add(cast(2001-4-01 as date), extractansiintervaldays(INTERVAL '60' DAY)))) AND (cs_ship_date_sk#8127L = d_date_sk#8160L)) AND ((cs_ship_addr_sk#8135L = ca_address_sk#8188L) AND (ca_state#8196 = NY))) AND (((cs_call_center_sk#8136L = cc_call_center_sk#8201L) AND cc_county#8226 IN (Ziebach County,Levy County,Huron County,Franklin Parish,Daviess County)) AND (exists#8124 [cs_order_number#8142L && cs_warehouse_sk#8139L] AND NOT exists#8125 [cs_order_number#8142L])))
            :  :- Project [cs_sold_time_sk#8232L, cs_ship_date_sk#8233L, cs_bill_customer_sk#8234L, cs_bill_cdemo_sk#8235L, cs_bill_hdemo_sk#8236L, cs_bill_addr_sk#8237L, cs_ship_customer_sk#8238L, cs_ship_cdemo_sk#8239L, cs_ship_hdemo_sk#8240L, cs_ship_addr_sk#8241L, cs_call_center_sk#8242L, cs_catalog_page_sk#8243L, cs_ship_mode_sk#8244L, cs_warehouse_sk#8245L, cs_item_sk#8246L, cs_promo_sk#8247L, cs_order_number#8248L, cs_quantity#8249, cs_wholesale_cost#8250, cs_list_price#8251, cs_sales_price#8252, cs_ext_discount_amt#8253, cs_ext_sales_price#8254, cs_ext_wholesale_cost#8255, ... 10 more fields]
            :  :  +- Filter ((outer(cs_order_number#8142L) = cs_order_number#8248L) AND NOT (outer(cs_warehouse_sk#8139L) = cs_warehouse_sk#8245L))
            :  :     +- SubqueryAlias cs2
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8232L,cs_ship_date_sk#8233L,cs_bill_customer_sk#8234L,cs_bill_cdemo_sk#8235L,cs_bill_hdemo_sk#8236L,cs_bill_addr_sk#8237L,cs_ship_customer_sk#8238L,cs_ship_cdemo_sk#8239L,cs_ship_hdemo_sk#8240L,cs_ship_addr_sk#8241L,cs_call_center_sk#8242L,cs_catalog_page_sk#8243L,cs_ship_mode_sk#8244L,cs_warehouse_sk#8245L,cs_item_sk#8246L,cs_promo_sk#8247L,cs_order_number#8248L,cs_quantity#8249,cs_wholesale_cost#8250,cs_list_price#8251,cs_sales_price#8252,cs_ext_discount_amt#8253,cs_ext_sales_price#8254,cs_ext_wholesale_cost#8255,... 10 more fields] orc
            :  +- Project [cr_returned_time_sk#8266L, cr_item_sk#8267L, cr_refunded_customer_sk#8268L, cr_refunded_cdemo_sk#8269L, cr_refunded_hdemo_sk#8270L, cr_refunded_addr_sk#8271L, cr_returning_customer_sk#8272L, cr_returning_cdemo_sk#8273L, cr_returning_hdemo_sk#8274L, cr_returning_addr_sk#8275L, cr_call_center_sk#8276L, cr_catalog_page_sk#8277L, cr_ship_mode_sk#8278L, cr_warehouse_sk#8279L, cr_reason_sk#8280L, cr_order_number#8281L, cr_return_quantity#8282, cr_return_amount#8283, cr_return_tax#8284, cr_return_amt_inc_tax#8285, cr_fee#8286, cr_return_ship_cost#8287, cr_refunded_cash#8288, cr_reversed_charge#8289, ... 3 more fields]
            :     +- Filter (outer(cs_order_number#8142L) = cr_order_number#8281L)
            :        +- SubqueryAlias cr1
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#8266L,cr_item_sk#8267L,cr_refunded_customer_sk#8268L,cr_refunded_cdemo_sk#8269L,cr_refunded_hdemo_sk#8270L,cr_refunded_addr_sk#8271L,cr_returning_customer_sk#8272L,cr_returning_cdemo_sk#8273L,cr_returning_hdemo_sk#8274L,cr_returning_addr_sk#8275L,cr_call_center_sk#8276L,cr_catalog_page_sk#8277L,cr_ship_mode_sk#8278L,cr_warehouse_sk#8279L,cr_reason_sk#8280L,cr_order_number#8281L,cr_return_quantity#8282,cr_return_amount#8283,cr_return_tax#8284,cr_return_amt_inc_tax#8285,cr_fee#8286,cr_return_ship_cost#8287,cr_refunded_cash#8288,cr_reversed_charge#8289,... 3 more fields] orc
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias cs1
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8126L,cs_ship_date_sk#8127L,cs_bill_customer_sk#8128L,cs_bill_cdemo_sk#8129L,cs_bill_hdemo_sk#8130L,cs_bill_addr_sk#8131L,cs_ship_customer_sk#8132L,cs_ship_cdemo_sk#8133L,cs_ship_hdemo_sk#8134L,cs_ship_addr_sk#8135L,cs_call_center_sk#8136L,cs_catalog_page_sk#8137L,cs_ship_mode_sk#8138L,cs_warehouse_sk#8139L,cs_item_sk#8140L,cs_promo_sk#8141L,cs_order_number#8142L,cs_quantity#8143,cs_wholesale_cost#8144,cs_list_price#8145,cs_sales_price#8146,cs_ext_discount_amt#8147,cs_ext_sales_price#8148,cs_ext_wholesale_cost#8149,... 10 more fields] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8160L,d_date_id#8161,d_date#8162,d_month_seq#8163,d_week_seq#8164,d_quarter_seq#8165,d_year#8166,d_dow#8167,d_moy#8168,d_dom#8169,d_qoy#8170,d_fy_year#8171,d_fy_quarter_seq#8172,d_fy_week_seq#8173,d_day_name#8174,d_quarter_name#8175,d_holiday#8176,d_weekend#8177,d_following_holiday#8178,d_first_dom#8179,d_last_dom#8180,d_same_day_ly#8181,d_same_day_lq#8182,d_current_day#8183,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8188L,ca_address_id#8189,ca_street_number#8190,ca_street_name#8191,ca_street_type#8192,ca_suite_number#8193,ca_city#8194,ca_county#8195,ca_state#8196,ca_zip#8197,ca_country#8198,ca_gmt_offset#8199,ca_location_type#8200] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.call_center
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#8201L,cc_call_center_id#8202,cc_rec_start_date#8203,cc_rec_end_date#8204,cc_closed_date_sk#8205L,cc_open_date_sk#8206L,cc_name#8207,cc_class#8208,cc_employees#8209,cc_sq_ft#8210,cc_hours#8211,cc_manager#8212,cc_mkt_id#8213,cc_mkt_class#8214,cc_mkt_desc#8215,cc_market_manager#8216,cc_division#8217,cc_division_name#8218,cc_company#8219,cc_company_name#8220,cc_street_number#8221,cc_street_name#8222,cc_street_type#8223,cc_suite_number#8224,... 7 more fields] orc

== Optimized Logical Plan ==
Aggregate [count(distinct cs_order_number#8142L) AS order count#8121L, sum(cs_ext_ship_cost#8153) AS total shipping cost#8122, sum(cs_net_profit#8158) AS total net profit#8123]
+- Project [cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
   +- Join Inner, (cs_ship_date_sk#8127L = d_date_sk#8160L)
      :- Project [cs_ship_date_sk#8127L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
      :  +- Join Inner, (cs_call_center_sk#8136L = cc_call_center_sk#8201L)
      :     :- Project [cs_ship_date_sk#8127L, cs_call_center_sk#8136L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
      :     :  +- Join Inner, (cs_ship_addr_sk#8135L = ca_address_sk#8188L)
      :     :     :- Join LeftAnti, (cs_order_number#8142L = cr_order_number#8281L)
      :     :     :  :- Project [cs_ship_date_sk#8127L, cs_ship_addr_sk#8135L, cs_call_center_sk#8136L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
      :     :     :  :  +- Join LeftSemi, ((cs_order_number#8142L = cs_order_number#8248L) AND NOT (cs_warehouse_sk#8139L = cs_warehouse_sk#8245L))
      :     :     :  :     :- Project [cs_ship_date_sk#8127L, cs_ship_addr_sk#8135L, cs_call_center_sk#8136L, cs_warehouse_sk#8139L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
      :     :     :  :     :  +- Filter ((isnotnull(cs_ship_date_sk#8127L) AND isnotnull(cs_ship_addr_sk#8135L)) AND isnotnull(cs_call_center_sk#8136L))
      :     :     :  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8126L,cs_ship_date_sk#8127L,cs_bill_customer_sk#8128L,cs_bill_cdemo_sk#8129L,cs_bill_hdemo_sk#8130L,cs_bill_addr_sk#8131L,cs_ship_customer_sk#8132L,cs_ship_cdemo_sk#8133L,cs_ship_hdemo_sk#8134L,cs_ship_addr_sk#8135L,cs_call_center_sk#8136L,cs_catalog_page_sk#8137L,cs_ship_mode_sk#8138L,cs_warehouse_sk#8139L,cs_item_sk#8140L,cs_promo_sk#8141L,cs_order_number#8142L,cs_quantity#8143,cs_wholesale_cost#8144,cs_list_price#8145,cs_sales_price#8146,cs_ext_discount_amt#8147,cs_ext_sales_price#8148,cs_ext_wholesale_cost#8149,... 10 more fields] orc
      :     :     :  :     +- Project [cs_warehouse_sk#8245L, cs_order_number#8248L]
      :     :     :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8232L,cs_ship_date_sk#8233L,cs_bill_customer_sk#8234L,cs_bill_cdemo_sk#8235L,cs_bill_hdemo_sk#8236L,cs_bill_addr_sk#8237L,cs_ship_customer_sk#8238L,cs_ship_cdemo_sk#8239L,cs_ship_hdemo_sk#8240L,cs_ship_addr_sk#8241L,cs_call_center_sk#8242L,cs_catalog_page_sk#8243L,cs_ship_mode_sk#8244L,cs_warehouse_sk#8245L,cs_item_sk#8246L,cs_promo_sk#8247L,cs_order_number#8248L,cs_quantity#8249,cs_wholesale_cost#8250,cs_list_price#8251,cs_sales_price#8252,cs_ext_discount_amt#8253,cs_ext_sales_price#8254,cs_ext_wholesale_cost#8255,... 10 more fields] orc
      :     :     :  +- Project [cr_order_number#8281L]
      :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#8266L,cr_item_sk#8267L,cr_refunded_customer_sk#8268L,cr_refunded_cdemo_sk#8269L,cr_refunded_hdemo_sk#8270L,cr_refunded_addr_sk#8271L,cr_returning_customer_sk#8272L,cr_returning_cdemo_sk#8273L,cr_returning_hdemo_sk#8274L,cr_returning_addr_sk#8275L,cr_call_center_sk#8276L,cr_catalog_page_sk#8277L,cr_ship_mode_sk#8278L,cr_warehouse_sk#8279L,cr_reason_sk#8280L,cr_order_number#8281L,cr_return_quantity#8282,cr_return_amount#8283,cr_return_tax#8284,cr_return_amt_inc_tax#8285,cr_fee#8286,cr_return_ship_cost#8287,cr_refunded_cash#8288,cr_reversed_charge#8289,... 3 more fields] orc
      :     :     +- Project [ca_address_sk#8188L]
      :     :        +- Filter ((isnotnull(ca_state#8196) AND (ca_state#8196 = NY)) AND isnotnull(ca_address_sk#8188L))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8188L,ca_address_id#8189,ca_street_number#8190,ca_street_name#8191,ca_street_type#8192,ca_suite_number#8193,ca_city#8194,ca_county#8195,ca_state#8196,ca_zip#8197,ca_country#8198,ca_gmt_offset#8199,ca_location_type#8200] orc
      :     +- Project [cc_call_center_sk#8201L]
      :        +- Filter (cc_county#8226 IN (Ziebach County,Levy County,Huron County,Franklin Parish,Daviess County) AND isnotnull(cc_call_center_sk#8201L))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#8201L,cc_call_center_id#8202,cc_rec_start_date#8203,cc_rec_end_date#8204,cc_closed_date_sk#8205L,cc_open_date_sk#8206L,cc_name#8207,cc_class#8208,cc_employees#8209,cc_sq_ft#8210,cc_hours#8211,cc_manager#8212,cc_mkt_id#8213,cc_mkt_class#8214,cc_mkt_desc#8215,cc_market_manager#8216,cc_division#8217,cc_division_name#8218,cc_company#8219,cc_company_name#8220,cc_street_number#8221,cc_street_name#8222,cc_street_type#8223,cc_suite_number#8224,... 7 more fields] orc
      +- Project [d_date_sk#8160L]
         +- Filter ((isnotnull(d_date#8162) AND ((d_date#8162 >= 2001-04-01) AND (d_date#8162 <= 2001-05-31))) AND isnotnull(d_date_sk#8160L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8160L,d_date_id#8161,d_date#8162,d_month_seq#8163,d_week_seq#8164,d_quarter_seq#8165,d_year#8166,d_dow#8167,d_moy#8168,d_dom#8169,d_qoy#8170,d_fy_year#8171,d_fy_quarter_seq#8172,d_fy_week_seq#8173,d_day_name#8174,d_quarter_name#8175,d_holiday#8176,d_weekend#8177,d_following_holiday#8178,d_first_dom#8179,d_last_dom#8180,d_same_day_ly#8181,d_same_day_lq#8182,d_current_day#8183,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(cs_ext_ship_cost#8153), sum(cs_net_profit#8158), count(distinct cs_order_number#8142L)], output=[order count#8121L, total shipping cost#8122, total net profit#8123])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#8150]
      +- HashAggregate(keys=[], functions=[merge_sum(cs_ext_ship_cost#8153), merge_sum(cs_net_profit#8158), partial_count(distinct cs_order_number#8142L)], output=[sum#8301, sum#8303, count#8306L])
         +- HashAggregate(keys=[cs_order_number#8142L], functions=[merge_sum(cs_ext_ship_cost#8153), merge_sum(cs_net_profit#8158)], output=[cs_order_number#8142L, sum#8301, sum#8303])
            +- HashAggregate(keys=[cs_order_number#8142L], functions=[partial_sum(cs_ext_ship_cost#8153), partial_sum(cs_net_profit#8158)], output=[cs_order_number#8142L, sum#8301, sum#8303])
               +- Project [cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
                  +- BroadcastHashJoin [cs_ship_date_sk#8127L], [d_date_sk#8160L], Inner, BuildRight, false
                     :- Project [cs_ship_date_sk#8127L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
                     :  +- BroadcastHashJoin [cs_call_center_sk#8136L], [cc_call_center_sk#8201L], Inner, BuildRight, false
                     :     :- Project [cs_ship_date_sk#8127L, cs_call_center_sk#8136L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
                     :     :  +- BroadcastHashJoin [cs_ship_addr_sk#8135L], [ca_address_sk#8188L], Inner, BuildRight, false
                     :     :     :- SortMergeJoin [cs_order_number#8142L], [cr_order_number#8281L], LeftAnti
                     :     :     :  :- Project [cs_ship_date_sk#8127L, cs_ship_addr_sk#8135L, cs_call_center_sk#8136L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
                     :     :     :  :  +- SortMergeJoin [cs_order_number#8142L], [cs_order_number#8248L], LeftSemi, NOT (cs_warehouse_sk#8139L = cs_warehouse_sk#8245L)
                     :     :     :  :     :- Sort [cs_order_number#8142L ASC NULLS FIRST], false, 0
                     :     :     :  :     :  +- Exchange hashpartitioning(cs_order_number#8142L, 3000), ENSURE_REQUIREMENTS, [id=#8123]
                     :     :     :  :     :     +- Project [cs_ship_date_sk#8127L, cs_ship_addr_sk#8135L, cs_call_center_sk#8136L, cs_warehouse_sk#8139L, cs_order_number#8142L, cs_ext_ship_cost#8153, cs_net_profit#8158]
                     :     :     :  :     :        +- Filter ((isnotnull(cs_ship_date_sk#8127L) AND isnotnull(cs_ship_addr_sk#8135L)) AND isnotnull(cs_call_center_sk#8136L))
                     :     :     :  :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_date_sk#8127L,cs_ship_addr_sk#8135L,cs_call_center_sk#8136L,cs_warehouse_sk#8139L,cs_order_number#8142L,cs_ext_ship_cost#8153,cs_net_profit#8158,cs_sold_date_sk#8159L] Batched: true, DataFilters: [isnotnull(cs_ship_date_sk#8127L), isnotnull(cs_ship_addr_sk#8135L), isnotnull(cs_call_center_sk#..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_ship_date_sk), IsNotNull(cs_ship_addr_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_ship_date_sk:bigint,cs_ship_addr_sk:bigint,cs_call_center_sk:bigint,cs_warehouse_sk:big...
                     :     :     :  :     +- Sort [cs_order_number#8248L ASC NULLS FIRST], false, 0
                     :     :     :  :        +- Exchange hashpartitioning(cs_order_number#8248L, 3000), ENSURE_REQUIREMENTS, [id=#8124]
                     :     :     :  :           +- Project [cs_warehouse_sk#8245L, cs_order_number#8248L]
                     :     :     :  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_warehouse_sk#8245L,cs_order_number#8248L,cs_sold_date_sk#8265L] Batched: true, DataFilters: [], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cs_warehouse_sk:bigint,cs_order_number:bigint>
                     :     :     :  +- Sort [cr_order_number#8281L ASC NULLS FIRST], false, 0
                     :     :     :     +- Exchange hashpartitioning(cr_order_number#8281L, 3000), ENSURE_REQUIREMENTS, [id=#8131]
                     :     :     :        +- Project [cr_order_number#8281L]
                     :     :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_order_number#8281L,cr_returned_date_sk#8292L] Batched: true, DataFilters: [], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_order_number:bigint>
                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8135]
                     :     :        +- Project [ca_address_sk#8188L]
                     :     :           +- Filter ((isnotnull(ca_state#8196) AND (ca_state#8196 = NY)) AND isnotnull(ca_address_sk#8188L))
                     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8188L,ca_state#8196] Batched: true, DataFilters: [isnotnull(ca_state#8196), (ca_state#8196 = NY), isnotnull(ca_address_sk#8188L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,NY), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8139]
                     :        +- Project [cc_call_center_sk#8201L]
                     :           +- Filter (cc_county#8226 IN (Ziebach County,Levy County,Huron County,Franklin Parish,Daviess County) AND isnotnull(cc_call_center_sk#8201L))
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#8201L,cc_county#8226] Batched: true, DataFilters: [cc_county#8226 IN (Ziebach County,Levy County,Huron County,Franklin Parish,Daviess County), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(cc_county, [Daviess County,Franklin Parish,Huron County,Levy County,Ziebach County]), IsNotNu..., ReadSchema: struct<cc_call_center_sk:bigint,cc_county:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8143]
                        +- Project [d_date_sk#8160L]
                           +- Filter (((isnotnull(d_date#8162) AND (d_date#8162 >= 2001-04-01)) AND (d_date#8162 <= 2001-05-31)) AND isnotnull(d_date_sk#8160L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8160L,d_date#8162] Batched: true, DataFilters: [isnotnull(d_date#8162), (d_date#8162 >= 2001-04-01), (d_date#8162 <= 2001-05-31), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-04-01), LessThanOrEqual(d_date,2001-05-31), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>

read query: spark_queries/q17.sql
explain query: q17
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_state ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_state], ['i_item_id, 'i_item_desc, 's_state, 'count('ss_quantity) AS store_sales_quantitycount#8308, 'avg('ss_quantity) AS store_sales_quantityave#8309, 'stddev_samp('ss_quantity) AS store_sales_quantitystdev#8310, ('stddev_samp('ss_quantity) / 'avg('ss_quantity)) AS store_sales_quantitycov#8311, 'count('sr_return_quantity) AS as_store_returns_quantitycount#8312, 'avg('sr_return_quantity) AS as_store_returns_quantityave#8313, 'stddev_samp('sr_return_quantity) AS as_store_returns_quantitystdev#8314, ('stddev_samp('sr_return_quantity) / 'avg('sr_return_quantity)) AS store_returns_quantitycov#8315, 'count('cs_quantity) AS catalog_sales_quantitycount#8316, 'avg('cs_quantity) AS catalog_sales_quantityave#8317, ('stddev_samp('cs_quantity) / 'avg('cs_quantity)) AS catalog_sales_quantitystdev#8318, ('stddev_samp('cs_quantity) / 'avg('cs_quantity)) AS catalog_sales_quantitycov#8319]
         +- 'Filter ((((('d1.d_quarter_name = 2000Q1) AND ('d1.d_date_sk = 'ss_sold_date_sk)) AND (('i_item_sk = 'ss_item_sk) AND ('s_store_sk = 'ss_store_sk))) AND ((('ss_customer_sk = 'sr_customer_sk) AND ('ss_item_sk = 'sr_item_sk)) AND ('ss_ticket_number = 'sr_ticket_number))) AND (((('sr_returned_date_sk = 'd2.d_date_sk) AND 'd2.d_quarter_name IN (2000Q1,2000Q2,2000Q3)) AND ('sr_customer_sk = 'cs_bill_customer_sk)) AND ((('sr_item_sk = 'cs_item_sk) AND ('cs_sold_date_sk = 'd3.d_date_sk)) AND 'd3.d_quarter_name IN (2000Q1,2000Q2,2000Q3))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
               :  :  :  :  :  +- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  :  +- 'SubqueryAlias d1
               :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  :  +- 'SubqueryAlias d2
               :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  +- 'SubqueryAlias d3
               :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_item_id: string, i_item_desc: string, s_state: string, store_sales_quantitycount: bigint, store_sales_quantityave: double, store_sales_quantitystdev: double, store_sales_quantitycov: double, as_store_returns_quantitycount: bigint, as_store_returns_quantityave: double, as_store_returns_quantitystdev: double, store_returns_quantitycov: double, catalog_sales_quantitycount: bigint, catalog_sales_quantityave: double, catalog_sales_quantitystdev: double, catalog_sales_quantitycov: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#8511 ASC NULLS FIRST, i_item_desc#8514 ASC NULLS FIRST, s_state#8505 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#8511, i_item_desc#8514, s_state#8505], [i_item_id#8511, i_item_desc#8514, s_state#8505, count(ss_quantity#8329) AS store_sales_quantitycount#8308L, avg(ss_quantity#8329) AS store_sales_quantityave#8309, stddev_samp(cast(ss_quantity#8329 as double)) AS store_sales_quantitystdev#8310, (stddev_samp(cast(ss_quantity#8329 as double)) / avg(ss_quantity#8329)) AS store_sales_quantitycov#8311, count(sr_return_quantity#8352) AS as_store_returns_quantitycount#8312L, avg(sr_return_quantity#8352) AS as_store_returns_quantityave#8313, stddev_samp(cast(sr_return_quantity#8352 as double)) AS as_store_returns_quantitystdev#8314, (stddev_samp(cast(sr_return_quantity#8352 as double)) / avg(sr_return_quantity#8352)) AS store_returns_quantitycov#8315, count(cs_quantity#8380) AS catalog_sales_quantitycount#8316L, avg(cs_quantity#8380) AS catalog_sales_quantityave#8317, (stddev_samp(cast(cs_quantity#8380 as double)) / avg(cs_quantity#8380)) AS catalog_sales_quantitystdev#8318, (stddev_samp(cast(cs_quantity#8380 as double)) / avg(cs_quantity#8380)) AS catalog_sales_quantitycov#8319]
         +- Filter (((((d_quarter_name#8412 = 2000Q1) AND (d_date_sk#8397L = ss_sold_date_sk#8342L)) AND ((i_item_sk#8510L = ss_item_sk#8321L) AND (s_store_sk#8481L = ss_store_sk#8326L))) AND (((ss_customer_sk#8322L = sr_customer_sk#8345L) AND (ss_item_sk#8321L = sr_item_sk#8344L)) AND (ss_ticket_number#8328L = sr_ticket_number#8351L))) AND ((((sr_returned_date_sk#8362L = d_date_sk#8425L) AND d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3)) AND (sr_customer_sk#8345L = cs_bill_customer_sk#8365L)) AND (((sr_item_sk#8344L = cs_item_sk#8377L) AND (cs_sold_date_sk#8396L = d_date_sk#8453L)) AND d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- Join Inner
               :  :  :  :  :  :- Join Inner
               :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#8320L,ss_item_sk#8321L,ss_customer_sk#8322L,ss_cdemo_sk#8323L,ss_hdemo_sk#8324L,ss_addr_sk#8325L,ss_store_sk#8326L,ss_promo_sk#8327L,ss_ticket_number#8328L,ss_quantity#8329,ss_wholesale_cost#8330,ss_list_price#8331,ss_sales_price#8332,ss_ext_discount_amt#8333,ss_ext_sales_price#8334,ss_ext_wholesale_cost#8335,ss_ext_list_price#8336,ss_ext_tax#8337,ss_coupon_amt#8338,ss_net_paid#8339,ss_net_paid_inc_tax#8340,ss_net_profit#8341,ss_sold_date_sk#8342L] orc
               :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
               :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#8343L,sr_item_sk#8344L,sr_customer_sk#8345L,sr_cdemo_sk#8346L,sr_hdemo_sk#8347L,sr_addr_sk#8348L,sr_store_sk#8349L,sr_reason_sk#8350L,sr_ticket_number#8351L,sr_return_quantity#8352,sr_return_amt#8353,sr_return_tax#8354,sr_return_amt_inc_tax#8355,sr_fee#8356,sr_return_ship_cost#8357,sr_refunded_cash#8358,sr_reversed_charge#8359,sr_store_credit#8360,sr_net_loss#8361,sr_returned_date_sk#8362L] orc
               :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8363L,cs_ship_date_sk#8364L,cs_bill_customer_sk#8365L,cs_bill_cdemo_sk#8366L,cs_bill_hdemo_sk#8367L,cs_bill_addr_sk#8368L,cs_ship_customer_sk#8369L,cs_ship_cdemo_sk#8370L,cs_ship_hdemo_sk#8371L,cs_ship_addr_sk#8372L,cs_call_center_sk#8373L,cs_catalog_page_sk#8374L,cs_ship_mode_sk#8375L,cs_warehouse_sk#8376L,cs_item_sk#8377L,cs_promo_sk#8378L,cs_order_number#8379L,cs_quantity#8380,cs_wholesale_cost#8381,cs_list_price#8382,cs_sales_price#8383,cs_ext_discount_amt#8384,cs_ext_sales_price#8385,cs_ext_wholesale_cost#8386,... 10 more fields] orc
               :  :  :  :  +- SubqueryAlias d1
               :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8397L,d_date_id#8398,d_date#8399,d_month_seq#8400,d_week_seq#8401,d_quarter_seq#8402,d_year#8403,d_dow#8404,d_moy#8405,d_dom#8406,d_qoy#8407,d_fy_year#8408,d_fy_quarter_seq#8409,d_fy_week_seq#8410,d_day_name#8411,d_quarter_name#8412,d_holiday#8413,d_weekend#8414,d_following_holiday#8415,d_first_dom#8416,d_last_dom#8417,d_same_day_ly#8418,d_same_day_lq#8419,d_current_day#8420,... 4 more fields] orc
               :  :  :  +- SubqueryAlias d2
               :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8425L,d_date_id#8426,d_date#8427,d_month_seq#8428,d_week_seq#8429,d_quarter_seq#8430,d_year#8431,d_dow#8432,d_moy#8433,d_dom#8434,d_qoy#8435,d_fy_year#8436,d_fy_quarter_seq#8437,d_fy_week_seq#8438,d_day_name#8439,d_quarter_name#8440,d_holiday#8441,d_weekend#8442,d_following_holiday#8443,d_first_dom#8444,d_last_dom#8445,d_same_day_ly#8446,d_same_day_lq#8447,d_current_day#8448,... 4 more fields] orc
               :  :  +- SubqueryAlias d3
               :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8453L,d_date_id#8454,d_date#8455,d_month_seq#8456,d_week_seq#8457,d_quarter_seq#8458,d_year#8459,d_dow#8460,d_moy#8461,d_dom#8462,d_qoy#8463,d_fy_year#8464,d_fy_quarter_seq#8465,d_fy_week_seq#8466,d_day_name#8467,d_quarter_name#8468,d_holiday#8469,d_weekend#8470,d_following_holiday#8471,d_first_dom#8472,d_last_dom#8473,d_same_day_ly#8474,d_same_day_lq#8475,d_current_day#8476,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#8481L,s_store_id#8482,s_rec_start_date#8483,s_rec_end_date#8484,s_closed_date_sk#8485L,s_store_name#8486,s_number_employees#8487,s_floor_space#8488,s_hours#8489,s_manager#8490,s_market_id#8491,s_geography_class#8492,s_market_desc#8493,s_market_manager#8494,s_division_id#8495,s_division_name#8496,s_company_id#8497,s_company_name#8498,s_street_number#8499,s_street_name#8500,s_street_type#8501,s_suite_number#8502,s_city#8503,s_county#8504,... 5 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8510L,i_item_id#8511,i_rec_start_date#8512,i_rec_end_date#8513,i_item_desc#8514,i_current_price#8515,i_wholesale_cost#8516,i_brand_id#8517,i_brand#8518,i_class_id#8519,i_class#8520,i_category_id#8521,i_category#8522,i_manufact_id#8523,i_manufact#8524,i_size#8525,i_formulation#8526,i_color#8527,i_units#8528,i_container#8529,i_manager_id#8530,i_product_name#8531] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#8511 ASC NULLS FIRST, i_item_desc#8514 ASC NULLS FIRST, s_state#8505 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#8511, i_item_desc#8514, s_state#8505], [i_item_id#8511, i_item_desc#8514, s_state#8505, count(ss_quantity#8329) AS store_sales_quantitycount#8308L, avg(ss_quantity#8329) AS store_sales_quantityave#8309, stddev_samp(cast(ss_quantity#8329 as double)) AS store_sales_quantitystdev#8310, (stddev_samp(cast(ss_quantity#8329 as double)) / avg(ss_quantity#8329)) AS store_sales_quantitycov#8311, count(sr_return_quantity#8352) AS as_store_returns_quantitycount#8312L, avg(sr_return_quantity#8352) AS as_store_returns_quantityave#8313, stddev_samp(cast(sr_return_quantity#8352 as double)) AS as_store_returns_quantitystdev#8314, (stddev_samp(cast(sr_return_quantity#8352 as double)) / avg(sr_return_quantity#8352)) AS store_returns_quantitycov#8315, count(cs_quantity#8380) AS catalog_sales_quantitycount#8316L, avg(cs_quantity#8380) AS catalog_sales_quantityave#8317, (stddev_samp(cast(cs_quantity#8380 as double)) / avg(cs_quantity#8380)) AS catalog_sales_quantitystdev#8318, (stddev_samp(cast(cs_quantity#8380 as double)) / avg(cs_quantity#8380)) AS catalog_sales_quantitycov#8319]
         +- Project [ss_quantity#8329, sr_return_quantity#8352, cs_quantity#8380, s_state#8505, i_item_id#8511, i_item_desc#8514]
            +- Join Inner, ((sr_customer_sk#8345L = cs_bill_customer_sk#8365L) AND (sr_item_sk#8344L = cs_item_sk#8377L))
               :- Project [ss_quantity#8329, s_state#8505, i_item_id#8511, i_item_desc#8514, sr_item_sk#8344L, sr_customer_sk#8345L, sr_return_quantity#8352]
               :  +- Join Inner, (((ss_customer_sk#8322L = sr_customer_sk#8345L) AND (ss_item_sk#8321L = sr_item_sk#8344L)) AND (ss_ticket_number#8328L = sr_ticket_number#8351L))
               :     :- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_ticket_number#8328L, ss_quantity#8329, s_state#8505, i_item_id#8511, i_item_desc#8514]
               :     :  +- Join Inner, (i_item_sk#8510L = ss_item_sk#8321L)
               :     :     :- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_ticket_number#8328L, ss_quantity#8329, s_state#8505]
               :     :     :  +- Join Inner, (s_store_sk#8481L = ss_store_sk#8326L)
               :     :     :     :- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_store_sk#8326L, ss_ticket_number#8328L, ss_quantity#8329]
               :     :     :     :  +- Join Inner, (d_date_sk#8397L = ss_sold_date_sk#8342L)
               :     :     :     :     :- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_store_sk#8326L, ss_ticket_number#8328L, ss_quantity#8329, ss_sold_date_sk#8342L]
               :     :     :     :     :  +- Filter (((((isnotnull(ss_customer_sk#8322L) AND isnotnull(ss_item_sk#8321L)) AND isnotnull(ss_ticket_number#8328L)) AND isnotnull(ss_sold_date_sk#8342L)) AND isnotnull(ss_store_sk#8326L)) AND dynamicpruning#8755 [ss_sold_date_sk#8342L])
               :     :     :     :     :     :  +- Project [d_date_sk#8397L]
               :     :     :     :     :     :     +- Filter ((isnotnull(d_quarter_name#8412) AND (d_quarter_name#8412 = 2000Q1)) AND isnotnull(d_date_sk#8397L))
               :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8397L,d_date_id#8398,d_date#8399,d_month_seq#8400,d_week_seq#8401,d_quarter_seq#8402,d_year#8403,d_dow#8404,d_moy#8405,d_dom#8406,d_qoy#8407,d_fy_year#8408,d_fy_quarter_seq#8409,d_fy_week_seq#8410,d_day_name#8411,d_quarter_name#8412,d_holiday#8413,d_weekend#8414,d_following_holiday#8415,d_first_dom#8416,d_last_dom#8417,d_same_day_ly#8418,d_same_day_lq#8419,d_current_day#8420,... 4 more fields] orc
               :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#8320L,ss_item_sk#8321L,ss_customer_sk#8322L,ss_cdemo_sk#8323L,ss_hdemo_sk#8324L,ss_addr_sk#8325L,ss_store_sk#8326L,ss_promo_sk#8327L,ss_ticket_number#8328L,ss_quantity#8329,ss_wholesale_cost#8330,ss_list_price#8331,ss_sales_price#8332,ss_ext_discount_amt#8333,ss_ext_sales_price#8334,ss_ext_wholesale_cost#8335,ss_ext_list_price#8336,ss_ext_tax#8337,ss_coupon_amt#8338,ss_net_paid#8339,ss_net_paid_inc_tax#8340,ss_net_profit#8341,ss_sold_date_sk#8342L] orc
               :     :     :     :     +- Project [d_date_sk#8397L]
               :     :     :     :        +- Filter ((isnotnull(d_quarter_name#8412) AND (d_quarter_name#8412 = 2000Q1)) AND isnotnull(d_date_sk#8397L))
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8397L,d_date_id#8398,d_date#8399,d_month_seq#8400,d_week_seq#8401,d_quarter_seq#8402,d_year#8403,d_dow#8404,d_moy#8405,d_dom#8406,d_qoy#8407,d_fy_year#8408,d_fy_quarter_seq#8409,d_fy_week_seq#8410,d_day_name#8411,d_quarter_name#8412,d_holiday#8413,d_weekend#8414,d_following_holiday#8415,d_first_dom#8416,d_last_dom#8417,d_same_day_ly#8418,d_same_day_lq#8419,d_current_day#8420,... 4 more fields] orc
               :     :     :     +- Project [s_store_sk#8481L, s_state#8505]
               :     :     :        +- Filter isnotnull(s_store_sk#8481L)
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#8481L,s_store_id#8482,s_rec_start_date#8483,s_rec_end_date#8484,s_closed_date_sk#8485L,s_store_name#8486,s_number_employees#8487,s_floor_space#8488,s_hours#8489,s_manager#8490,s_market_id#8491,s_geography_class#8492,s_market_desc#8493,s_market_manager#8494,s_division_id#8495,s_division_name#8496,s_company_id#8497,s_company_name#8498,s_street_number#8499,s_street_name#8500,s_street_type#8501,s_suite_number#8502,s_city#8503,s_county#8504,... 5 more fields] orc
               :     :     +- Project [i_item_sk#8510L, i_item_id#8511, i_item_desc#8514]
               :     :        +- Filter isnotnull(i_item_sk#8510L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8510L,i_item_id#8511,i_rec_start_date#8512,i_rec_end_date#8513,i_item_desc#8514,i_current_price#8515,i_wholesale_cost#8516,i_brand_id#8517,i_brand#8518,i_class_id#8519,i_class#8520,i_category_id#8521,i_category#8522,i_manufact_id#8523,i_manufact#8524,i_size#8525,i_formulation#8526,i_color#8527,i_units#8528,i_container#8529,i_manager_id#8530,i_product_name#8531] orc
               :     +- Project [sr_item_sk#8344L, sr_customer_sk#8345L, sr_ticket_number#8351L, sr_return_quantity#8352]
               :        +- Join Inner, (sr_returned_date_sk#8362L = d_date_sk#8425L)
               :           :- Project [sr_item_sk#8344L, sr_customer_sk#8345L, sr_ticket_number#8351L, sr_return_quantity#8352, sr_returned_date_sk#8362L]
               :           :  +- Filter ((((isnotnull(sr_customer_sk#8345L) AND isnotnull(sr_item_sk#8344L)) AND isnotnull(sr_ticket_number#8351L)) AND isnotnull(sr_returned_date_sk#8362L)) AND dynamicpruning#8756 [sr_returned_date_sk#8362L])
               :           :     :  +- Project [d_date_sk#8425L]
               :           :     :     +- Filter (d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8425L))
               :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8425L,d_date_id#8426,d_date#8427,d_month_seq#8428,d_week_seq#8429,d_quarter_seq#8430,d_year#8431,d_dow#8432,d_moy#8433,d_dom#8434,d_qoy#8435,d_fy_year#8436,d_fy_quarter_seq#8437,d_fy_week_seq#8438,d_day_name#8439,d_quarter_name#8440,d_holiday#8441,d_weekend#8442,d_following_holiday#8443,d_first_dom#8444,d_last_dom#8445,d_same_day_ly#8446,d_same_day_lq#8447,d_current_day#8448,... 4 more fields] orc
               :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#8343L,sr_item_sk#8344L,sr_customer_sk#8345L,sr_cdemo_sk#8346L,sr_hdemo_sk#8347L,sr_addr_sk#8348L,sr_store_sk#8349L,sr_reason_sk#8350L,sr_ticket_number#8351L,sr_return_quantity#8352,sr_return_amt#8353,sr_return_tax#8354,sr_return_amt_inc_tax#8355,sr_fee#8356,sr_return_ship_cost#8357,sr_refunded_cash#8358,sr_reversed_charge#8359,sr_store_credit#8360,sr_net_loss#8361,sr_returned_date_sk#8362L] orc
               :           +- Project [d_date_sk#8425L]
               :              +- Filter (d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8425L))
               :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8425L,d_date_id#8426,d_date#8427,d_month_seq#8428,d_week_seq#8429,d_quarter_seq#8430,d_year#8431,d_dow#8432,d_moy#8433,d_dom#8434,d_qoy#8435,d_fy_year#8436,d_fy_quarter_seq#8437,d_fy_week_seq#8438,d_day_name#8439,d_quarter_name#8440,d_holiday#8441,d_weekend#8442,d_following_holiday#8443,d_first_dom#8444,d_last_dom#8445,d_same_day_ly#8446,d_same_day_lq#8447,d_current_day#8448,... 4 more fields] orc
               +- Project [cs_bill_customer_sk#8365L, cs_item_sk#8377L, cs_quantity#8380]
                  +- Join Inner, (cs_sold_date_sk#8396L = d_date_sk#8453L)
                     :- Project [cs_bill_customer_sk#8365L, cs_item_sk#8377L, cs_quantity#8380, cs_sold_date_sk#8396L]
                     :  +- Filter (((isnotnull(cs_bill_customer_sk#8365L) AND isnotnull(cs_item_sk#8377L)) AND isnotnull(cs_sold_date_sk#8396L)) AND dynamicpruning#8757 [cs_sold_date_sk#8396L])
                     :     :  +- Project [d_date_sk#8453L]
                     :     :     +- Filter (d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8453L))
                     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8453L,d_date_id#8454,d_date#8455,d_month_seq#8456,d_week_seq#8457,d_quarter_seq#8458,d_year#8459,d_dow#8460,d_moy#8461,d_dom#8462,d_qoy#8463,d_fy_year#8464,d_fy_quarter_seq#8465,d_fy_week_seq#8466,d_day_name#8467,d_quarter_name#8468,d_holiday#8469,d_weekend#8470,d_following_holiday#8471,d_first_dom#8472,d_last_dom#8473,d_same_day_ly#8474,d_same_day_lq#8475,d_current_day#8476,... 4 more fields] orc
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8363L,cs_ship_date_sk#8364L,cs_bill_customer_sk#8365L,cs_bill_cdemo_sk#8366L,cs_bill_hdemo_sk#8367L,cs_bill_addr_sk#8368L,cs_ship_customer_sk#8369L,cs_ship_cdemo_sk#8370L,cs_ship_hdemo_sk#8371L,cs_ship_addr_sk#8372L,cs_call_center_sk#8373L,cs_catalog_page_sk#8374L,cs_ship_mode_sk#8375L,cs_warehouse_sk#8376L,cs_item_sk#8377L,cs_promo_sk#8378L,cs_order_number#8379L,cs_quantity#8380,cs_wholesale_cost#8381,cs_list_price#8382,cs_sales_price#8383,cs_ext_discount_amt#8384,cs_ext_sales_price#8385,cs_ext_wholesale_cost#8386,... 10 more fields] orc
                     +- Project [d_date_sk#8453L]
                        +- Filter (d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8453L))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8453L,d_date_id#8454,d_date#8455,d_month_seq#8456,d_week_seq#8457,d_quarter_seq#8458,d_year#8459,d_dow#8460,d_moy#8461,d_dom#8462,d_qoy#8463,d_fy_year#8464,d_fy_quarter_seq#8465,d_fy_week_seq#8466,d_day_name#8467,d_quarter_name#8468,d_holiday#8469,d_weekend#8470,d_following_holiday#8471,d_first_dom#8472,d_last_dom#8473,d_same_day_ly#8474,d_same_day_lq#8475,d_current_day#8476,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#8511 ASC NULLS FIRST,i_item_desc#8514 ASC NULLS FIRST,s_state#8505 ASC NULLS FIRST], output=[i_item_id#8511,i_item_desc#8514,s_state#8505,store_sales_quantitycount#8308L,store_sales_quantityave#8309,store_sales_quantitystdev#8310,store_sales_quantitycov#8311,as_store_returns_quantitycount#8312L,as_store_returns_quantityave#8313,as_store_returns_quantitystdev#8314,store_returns_quantitycov#8315,catalog_sales_quantitycount#8316L,catalog_sales_quantityave#8317,catalog_sales_quantitystdev#8318,catalog_sales_quantitycov#8319])
   +- HashAggregate(keys=[i_item_id#8511, i_item_desc#8514, s_state#8505], functions=[count(ss_quantity#8329), avg(ss_quantity#8329), stddev_samp(cast(ss_quantity#8329 as double)), count(sr_return_quantity#8352), avg(sr_return_quantity#8352), stddev_samp(cast(sr_return_quantity#8352 as double)), count(cs_quantity#8380), avg(cs_quantity#8380), stddev_samp(cast(cs_quantity#8380 as double))], output=[i_item_id#8511, i_item_desc#8514, s_state#8505, store_sales_quantitycount#8308L, store_sales_quantityave#8309, store_sales_quantitystdev#8310, store_sales_quantitycov#8311, as_store_returns_quantitycount#8312L, as_store_returns_quantityave#8313, as_store_returns_quantitystdev#8314, store_returns_quantitycov#8315, catalog_sales_quantitycount#8316L, catalog_sales_quantityave#8317, catalog_sales_quantitystdev#8318, catalog_sales_quantitycov#8319])
      +- Exchange hashpartitioning(i_item_id#8511, i_item_desc#8514, s_state#8505, 3000), ENSURE_REQUIREMENTS, [id=#8382]
         +- HashAggregate(keys=[i_item_id#8511, i_item_desc#8514, s_state#8505], functions=[partial_count(ss_quantity#8329), partial_avg(ss_quantity#8329), partial_stddev_samp(cast(ss_quantity#8329 as double)), partial_count(sr_return_quantity#8352), partial_avg(sr_return_quantity#8352), partial_stddev_samp(cast(sr_return_quantity#8352 as double)), partial_count(cs_quantity#8380), partial_avg(cs_quantity#8380), partial_stddev_samp(cast(cs_quantity#8380 as double))], output=[i_item_id#8511, i_item_desc#8514, s_state#8505, count#8767L, sum#8768, count#8769L, n#8649, avg#8650, m2#8651, count#8770L, sum#8771, count#8772L, n#8665, avg#8666, m2#8667, count#8773L, sum#8774, count#8775L, n#8681, avg#8682, m2#8683])
            +- Project [ss_quantity#8329, sr_return_quantity#8352, cs_quantity#8380, s_state#8505, i_item_id#8511, i_item_desc#8514]
               +- SortMergeJoin [sr_customer_sk#8345L, sr_item_sk#8344L], [cs_bill_customer_sk#8365L, cs_item_sk#8377L], Inner
                  :- Sort [sr_customer_sk#8345L ASC NULLS FIRST, sr_item_sk#8344L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(sr_customer_sk#8345L, sr_item_sk#8344L, 3000), ENSURE_REQUIREMENTS, [id=#8374]
                  :     +- Project [ss_quantity#8329, s_state#8505, i_item_id#8511, i_item_desc#8514, sr_item_sk#8344L, sr_customer_sk#8345L, sr_return_quantity#8352]
                  :        +- SortMergeJoin [ss_customer_sk#8322L, ss_item_sk#8321L, ss_ticket_number#8328L], [sr_customer_sk#8345L, sr_item_sk#8344L, sr_ticket_number#8351L], Inner
                  :           :- Sort [ss_customer_sk#8322L ASC NULLS FIRST, ss_item_sk#8321L ASC NULLS FIRST, ss_ticket_number#8328L ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(ss_customer_sk#8322L, ss_item_sk#8321L, ss_ticket_number#8328L, 3000), ENSURE_REQUIREMENTS, [id=#8363]
                  :           :     +- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_ticket_number#8328L, ss_quantity#8329, s_state#8505, i_item_id#8511, i_item_desc#8514]
                  :           :        +- SortMergeJoin [ss_item_sk#8321L], [i_item_sk#8510L], Inner
                  :           :           :- Sort [ss_item_sk#8321L ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(ss_item_sk#8321L, 3000), ENSURE_REQUIREMENTS, [id=#8352]
                  :           :           :     +- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_ticket_number#8328L, ss_quantity#8329, s_state#8505]
                  :           :           :        +- BroadcastHashJoin [ss_store_sk#8326L], [s_store_sk#8481L], Inner, BuildRight, false
                  :           :           :           :- Project [ss_item_sk#8321L, ss_customer_sk#8322L, ss_store_sk#8326L, ss_ticket_number#8328L, ss_quantity#8329]
                  :           :           :           :  +- BroadcastHashJoin [ss_sold_date_sk#8342L], [d_date_sk#8397L], Inner, BuildRight, false
                  :           :           :           :     :- Filter (((isnotnull(ss_customer_sk#8322L) AND isnotnull(ss_item_sk#8321L)) AND isnotnull(ss_ticket_number#8328L)) AND isnotnull(ss_store_sk#8326L))
                  :           :           :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#8321L,ss_customer_sk#8322L,ss_store_sk#8326L,ss_ticket_number#8328L,ss_quantity#8329,ss_sold_date_sk#8342L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#8322L), isnotnull(ss_item_sk#8321L), isnotnull(ss_ticket_number#8328L),..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#8342L), dynamicpruningexpression(ss_sold_date_sk#8342L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint,ss_quan...
                  :           :           :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#8755, 0, true, Project [d_date_sk#8397L], [d_date_sk#8397L]
                  :           :           :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :           :           :     :              +- Project [d_date_sk#8397L]
                  :           :           :           :     :                 +- Filter ((isnotnull(d_quarter_name#8412) AND (d_quarter_name#8412 = 2000Q1)) AND isnotnull(d_date_sk#8397L))
                  :           :           :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8397L,d_quarter_name#8412] Batched: true, DataFilters: [isnotnull(d_quarter_name#8412), (d_quarter_name#8412 = 2000Q1), isnotnull(d_date_sk#8397L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_quarter_name), EqualTo(d_quarter_name,2000Q1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>
                  :           :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8343]
                  :           :           :           :        +- Project [d_date_sk#8397L]
                  :           :           :           :           +- Filter ((isnotnull(d_quarter_name#8412) AND (d_quarter_name#8412 = 2000Q1)) AND isnotnull(d_date_sk#8397L))
                  :           :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8397L,d_quarter_name#8412] Batched: true, DataFilters: [isnotnull(d_quarter_name#8412), (d_quarter_name#8412 = 2000Q1), isnotnull(d_date_sk#8397L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_quarter_name), EqualTo(d_quarter_name,2000Q1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>
                  :           :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#8347]
                  :           :           :              +- Filter isnotnull(s_store_sk#8481L)
                  :           :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#8481L,s_state#8505] Batched: true, DataFilters: [isnotnull(s_store_sk#8481L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_state:string>
                  :           :           +- Sort [i_item_sk#8510L ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(i_item_sk#8510L, 3000), ENSURE_REQUIREMENTS, [id=#8353]
                  :           :                 +- Filter isnotnull(i_item_sk#8510L)
                  :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8510L,i_item_id#8511,i_item_desc#8514] Batched: true, DataFilters: [isnotnull(i_item_sk#8510L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string>
                  :           +- Sort [sr_customer_sk#8345L ASC NULLS FIRST, sr_item_sk#8344L ASC NULLS FIRST, sr_ticket_number#8351L ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(sr_customer_sk#8345L, sr_item_sk#8344L, sr_ticket_number#8351L, 3000), ENSURE_REQUIREMENTS, [id=#8364]
                  :                 +- Project [sr_item_sk#8344L, sr_customer_sk#8345L, sr_ticket_number#8351L, sr_return_quantity#8352]
                  :                    +- BroadcastHashJoin [sr_returned_date_sk#8362L], [d_date_sk#8425L], Inner, BuildRight, false
                  :                       :- Filter ((isnotnull(sr_customer_sk#8345L) AND isnotnull(sr_item_sk#8344L)) AND isnotnull(sr_ticket_number#8351L))
                  :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#8344L,sr_customer_sk#8345L,sr_ticket_number#8351L,sr_return_quantity#8352,sr_returned_date_sk#8362L] Batched: true, DataFilters: [isnotnull(sr_customer_sk#8345L), isnotnull(sr_item_sk#8344L), isnotnull(sr_ticket_number#8351L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#8362L), dynamicpruningexpression(sr_returned_date_sk#8362L IN dyna..., PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_customer_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int>
                  :                       :        +- SubqueryAdaptiveBroadcast dynamicpruning#8756, 0, true, Project [d_date_sk#8425L], [d_date_sk#8425L]
                  :                       :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                       :              +- Project [d_date_sk#8425L]
                  :                       :                 +- Filter (d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8425L))
                  :                       :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8425L,d_quarter_name#8440] Batched: true, DataFilters: [d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3), isnotnull(d_date_sk#8425L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_quarter_name, [2000Q1,2000Q2,2000Q3]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>
                  :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8358]
                  :                          +- Project [d_date_sk#8425L]
                  :                             +- Filter (d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8425L))
                  :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8425L,d_quarter_name#8440] Batched: true, DataFilters: [d_quarter_name#8440 IN (2000Q1,2000Q2,2000Q3), isnotnull(d_date_sk#8425L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_quarter_name, [2000Q1,2000Q2,2000Q3]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>
                  +- Sort [cs_bill_customer_sk#8365L ASC NULLS FIRST, cs_item_sk#8377L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cs_bill_customer_sk#8365L, cs_item_sk#8377L, 3000), ENSURE_REQUIREMENTS, [id=#8375]
                        +- Project [cs_bill_customer_sk#8365L, cs_item_sk#8377L, cs_quantity#8380]
                           +- BroadcastHashJoin [cs_sold_date_sk#8396L], [d_date_sk#8453L], Inner, BuildRight, false
                              :- Filter (isnotnull(cs_bill_customer_sk#8365L) AND isnotnull(cs_item_sk#8377L))
                              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#8365L,cs_item_sk#8377L,cs_quantity#8380,cs_sold_date_sk#8396L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#8365L), isnotnull(cs_item_sk#8377L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#8396L), dynamicpruningexpression(cs_sold_date_sk#8396L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_quantity:int>
                              :        +- SubqueryAdaptiveBroadcast dynamicpruning#8757, 0, true, Project [d_date_sk#8453L], [d_date_sk#8453L]
                              :           +- AdaptiveSparkPlan isFinalPlan=false
                              :              +- Project [d_date_sk#8453L]
                              :                 +- Filter (d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8453L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8453L,d_quarter_name#8468] Batched: true, DataFilters: [d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3), isnotnull(d_date_sk#8453L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_quarter_name, [2000Q1,2000Q2,2000Q3]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8369]
                                 +- Project [d_date_sk#8453L]
                                    +- Filter (d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3) AND isnotnull(d_date_sk#8453L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8453L,d_quarter_name#8468] Batched: true, DataFilters: [d_quarter_name#8468 IN (2000Q1,2000Q2,2000Q3), isnotnull(d_date_sk#8453L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_quarter_name, [2000Q1,2000Q2,2000Q3]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_quarter_name:string>

read query: spark_queries/q18.sql
explain query: q18
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ca_country ASC NULLS FIRST, 'ca_state ASC NULLS FIRST, 'ca_county ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), Vector(2), Vector(3), 'i_item_id, 'ca_country, 'ca_state, 'ca_county)], ['i_item_id, 'ca_country, 'ca_state, 'ca_county, 'avg(cast('cs_quantity as decimal(12,2))) AS agg1#8776, 'avg(cast('cs_list_price as decimal(12,2))) AS agg2#8777, 'avg(cast('cs_coupon_amt as decimal(12,2))) AS agg3#8778, 'avg(cast('cs_sales_price as decimal(12,2))) AS agg4#8779, 'avg(cast('cs_net_profit as decimal(12,2))) AS agg5#8780, 'avg(cast('c_birth_year as decimal(12,2))) AS agg6#8781, 'avg(cast('cd1.cd_dep_count as decimal(12,2))) AS agg7#8782]
         +- 'Filter ((((('cs_sold_date_sk = 'd_date_sk) AND ('cs_item_sk = 'i_item_sk)) AND ('cs_bill_cdemo_sk = 'cd1.cd_demo_sk)) AND ((('cs_bill_customer_sk = 'c_customer_sk) AND ('cd1.cd_gender = M)) AND ('cd1.cd_education_status = College))) AND (((('c_current_cdemo_sk = 'cd2.cd_demo_sk) AND ('c_current_addr_sk = 'ca_address_sk)) AND 'c_birth_month IN (9,5,12,4,1,10)) AND (('d_year = 2001) AND 'ca_state IN (ND,WI,AL,NC,OK,MS,TN))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  :  :  +- 'SubqueryAlias cd1
               :  :  :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  :  :  +- 'SubqueryAlias cd2
               :  :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  :  +- 'UnresolvedRelation [customer], [], false
               :  :  +- 'UnresolvedRelation [customer_address], [], false
               :  +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_item_id: string, ca_country: string, ca_state: string, ca_county: string, agg1: decimal(16,6), agg2: decimal(16,6), agg3: decimal(16,6), agg4: decimal(16,6), agg5: decimal(16,6), agg6: decimal(16,6), agg7: decimal(16,6)
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_country#8929 ASC NULLS FIRST, ca_state#8930 ASC NULLS FIRST, ca_county#8931 ASC NULLS FIRST, i_item_id#8928 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L], [i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, avg(cast(cs_quantity#8800 as decimal(12,2))) AS agg1#8776, avg(cast(cs_list_price#8802 as decimal(12,2))) AS agg2#8777, avg(cast(cs_coupon_amt#8809 as decimal(12,2))) AS agg3#8778, avg(cast(cs_sales_price#8803 as decimal(12,2))) AS agg4#8779, avg(cast(cs_net_profit#8815 as decimal(12,2))) AS agg5#8780, avg(cast(c_birth_year#8848 as decimal(12,2))) AS agg6#8781, avg(cast(cd_dep_count#8823 as decimal(12,2))) AS agg7#8782]
         +- Expand [[cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields], [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields], [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields], [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields], [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields]], [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 114 more fields]
            +- Project [cs_sold_time_sk#8783L, cs_ship_date_sk#8784L, cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_bill_hdemo_sk#8787L, cs_bill_addr_sk#8788L, cs_ship_customer_sk#8789L, cs_ship_cdemo_sk#8790L, cs_ship_hdemo_sk#8791L, cs_ship_addr_sk#8792L, cs_call_center_sk#8793L, cs_catalog_page_sk#8794L, cs_ship_mode_sk#8795L, cs_warehouse_sk#8796L, cs_item_sk#8797L, cs_promo_sk#8798L, cs_order_number#8799L, cs_quantity#8800, cs_wholesale_cost#8801, cs_list_price#8802, cs_sales_price#8803, cs_ext_discount_amt#8804, cs_ext_sales_price#8805, cs_ext_wholesale_cost#8806, ... 113 more fields]
               +- Filter (((((cs_sold_date_sk#8816L = d_date_sk#8866L) AND (cs_item_sk#8797L = i_item_sk#8894L)) AND (cs_bill_cdemo_sk#8786L = cd_demo_sk#8817L)) AND (((cs_bill_customer_sk#8785L = c_customer_sk#8835L) AND (cd_gender#8818 = M)) AND (cd_education_status#8820 = College))) AND ((((c_current_cdemo_sk#8837L = cd_demo_sk#8826L) AND (c_current_addr_sk#8839L = ca_address_sk#8853L)) AND c_birth_month#8847 IN (9,5,12,4,1,10)) AND ((d_year#8872 = 2001) AND ca_state#8861 IN (ND,WI,AL,NC,OK,MS,TN))))
                  +- Join Inner
                     :- Join Inner
                     :  :- Join Inner
                     :  :  :- Join Inner
                     :  :  :  :- Join Inner
                     :  :  :  :  :- Join Inner
                     :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                     :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8783L,cs_ship_date_sk#8784L,cs_bill_customer_sk#8785L,cs_bill_cdemo_sk#8786L,cs_bill_hdemo_sk#8787L,cs_bill_addr_sk#8788L,cs_ship_customer_sk#8789L,cs_ship_cdemo_sk#8790L,cs_ship_hdemo_sk#8791L,cs_ship_addr_sk#8792L,cs_call_center_sk#8793L,cs_catalog_page_sk#8794L,cs_ship_mode_sk#8795L,cs_warehouse_sk#8796L,cs_item_sk#8797L,cs_promo_sk#8798L,cs_order_number#8799L,cs_quantity#8800,cs_wholesale_cost#8801,cs_list_price#8802,cs_sales_price#8803,cs_ext_discount_amt#8804,cs_ext_sales_price#8805,cs_ext_wholesale_cost#8806,... 10 more fields] orc
                     :  :  :  :  :  +- SubqueryAlias cd1
                     :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                     :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8817L,cd_gender#8818,cd_marital_status#8819,cd_education_status#8820,cd_purchase_estimate#8821,cd_credit_rating#8822,cd_dep_count#8823,cd_dep_employed_count#8824,cd_dep_college_count#8825] orc
                     :  :  :  :  +- SubqueryAlias cd2
                     :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                     :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8826L,cd_gender#8827,cd_marital_status#8828,cd_education_status#8829,cd_purchase_estimate#8830,cd_credit_rating#8831,cd_dep_count#8832,cd_dep_employed_count#8833,cd_dep_college_count#8834] orc
                     :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8835L,c_customer_id#8836,c_current_cdemo_sk#8837L,c_current_hdemo_sk#8838L,c_current_addr_sk#8839L,c_first_shipto_date_sk#8840L,c_first_sales_date_sk#8841L,c_salutation#8842,c_first_name#8843,c_last_name#8844,c_preferred_cust_flag#8845,c_birth_day#8846,c_birth_month#8847,c_birth_year#8848,c_birth_country#8849,c_login#8850,c_email_address#8851,c_last_review_date#8852] orc
                     :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8853L,ca_address_id#8854,ca_street_number#8855,ca_street_name#8856,ca_street_type#8857,ca_suite_number#8858,ca_city#8859,ca_county#8860,ca_state#8861,ca_zip#8862,ca_country#8863,ca_gmt_offset#8864,ca_location_type#8865] orc
                     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8866L,d_date_id#8867,d_date#8868,d_month_seq#8869,d_week_seq#8870,d_quarter_seq#8871,d_year#8872,d_dow#8873,d_moy#8874,d_dom#8875,d_qoy#8876,d_fy_year#8877,d_fy_quarter_seq#8878,d_fy_week_seq#8879,d_day_name#8880,d_quarter_name#8881,d_holiday#8882,d_weekend#8883,d_following_holiday#8884,d_first_dom#8885,d_last_dom#8886,d_same_day_ly#8887,d_same_day_lq#8888,d_current_day#8889,... 4 more fields] orc
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8894L,i_item_id#8895,i_rec_start_date#8896,i_rec_end_date#8897,i_item_desc#8898,i_current_price#8899,i_wholesale_cost#8900,i_brand_id#8901,i_brand#8902,i_class_id#8903,i_class#8904,i_category_id#8905,i_category#8906,i_manufact_id#8907,i_manufact#8908,i_size#8909,i_formulation#8910,i_color#8911,i_units#8912,i_container#8913,i_manager_id#8914,i_product_name#8915] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_country#8929 ASC NULLS FIRST, ca_state#8930 ASC NULLS FIRST, ca_county#8931 ASC NULLS FIRST, i_item_id#8928 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L], [i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, avg(cast(cs_quantity#8800 as decimal(12,2))) AS agg1#8776, avg(cast(cs_list_price#8802 as decimal(12,2))) AS agg2#8777, avg(cast(cs_coupon_amt#8809 as decimal(12,2))) AS agg3#8778, avg(cast(cs_sales_price#8803 as decimal(12,2))) AS agg4#8779, avg(cast(cs_net_profit#8815 as decimal(12,2))) AS agg5#8780, avg(cast(c_birth_year#8848 as decimal(12,2))) AS agg6#8781, avg(cast(cd_dep_count#8823 as decimal(12,2))) AS agg7#8782]
         +- Expand [[cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, ca_county#8860, 0], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, null, 1], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, null, null, 3], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, null, null, null, 7], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, null, null, null, null, 15]], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L]
            +- Project [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, ca_county#8860]
               +- Join Inner, (cs_bill_customer_sk#8785L = c_customer_sk#8835L)
                  :- Project [cs_bill_customer_sk#8785L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, i_item_id#8895]
                  :  +- Join Inner, (cs_item_sk#8797L = i_item_sk#8894L)
                  :     :- Project [cs_bill_customer_sk#8785L, cs_item_sk#8797L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823]
                  :     :  +- Join Inner, (cs_sold_date_sk#8816L = d_date_sk#8866L)
                  :     :     :- Project [cs_bill_customer_sk#8785L, cs_item_sk#8797L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cs_sold_date_sk#8816L, cd_dep_count#8823]
                  :     :     :  +- Join Inner, (cs_bill_cdemo_sk#8786L = cd_demo_sk#8817L)
                  :     :     :     :- Project [cs_bill_customer_sk#8785L, cs_bill_cdemo_sk#8786L, cs_item_sk#8797L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cs_sold_date_sk#8816L]
                  :     :     :     :  +- Filter ((((isnotnull(cs_bill_cdemo_sk#8786L) AND isnotnull(cs_bill_customer_sk#8785L)) AND isnotnull(cs_sold_date_sk#8816L)) AND isnotnull(cs_item_sk#8797L)) AND dynamicpruning#8943 [cs_sold_date_sk#8816L])
                  :     :     :     :     :  +- Project [d_date_sk#8866L]
                  :     :     :     :     :     +- Filter ((isnotnull(d_year#8872) AND (d_year#8872 = 2001)) AND isnotnull(d_date_sk#8866L))
                  :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8866L,d_date_id#8867,d_date#8868,d_month_seq#8869,d_week_seq#8870,d_quarter_seq#8871,d_year#8872,d_dow#8873,d_moy#8874,d_dom#8875,d_qoy#8876,d_fy_year#8877,d_fy_quarter_seq#8878,d_fy_week_seq#8879,d_day_name#8880,d_quarter_name#8881,d_holiday#8882,d_weekend#8883,d_following_holiday#8884,d_first_dom#8885,d_last_dom#8886,d_same_day_ly#8887,d_same_day_lq#8888,d_current_day#8889,... 4 more fields] orc
                  :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#8783L,cs_ship_date_sk#8784L,cs_bill_customer_sk#8785L,cs_bill_cdemo_sk#8786L,cs_bill_hdemo_sk#8787L,cs_bill_addr_sk#8788L,cs_ship_customer_sk#8789L,cs_ship_cdemo_sk#8790L,cs_ship_hdemo_sk#8791L,cs_ship_addr_sk#8792L,cs_call_center_sk#8793L,cs_catalog_page_sk#8794L,cs_ship_mode_sk#8795L,cs_warehouse_sk#8796L,cs_item_sk#8797L,cs_promo_sk#8798L,cs_order_number#8799L,cs_quantity#8800,cs_wholesale_cost#8801,cs_list_price#8802,cs_sales_price#8803,cs_ext_discount_amt#8804,cs_ext_sales_price#8805,cs_ext_wholesale_cost#8806,... 10 more fields] orc
                  :     :     :     +- Project [cd_demo_sk#8817L, cd_dep_count#8823]
                  :     :     :        +- Filter (((isnotnull(cd_gender#8818) AND isnotnull(cd_education_status#8820)) AND ((cd_gender#8818 = M) AND (cd_education_status#8820 = College))) AND isnotnull(cd_demo_sk#8817L))
                  :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8817L,cd_gender#8818,cd_marital_status#8819,cd_education_status#8820,cd_purchase_estimate#8821,cd_credit_rating#8822,cd_dep_count#8823,cd_dep_employed_count#8824,cd_dep_college_count#8825] orc
                  :     :     +- Project [d_date_sk#8866L]
                  :     :        +- Filter ((isnotnull(d_year#8872) AND (d_year#8872 = 2001)) AND isnotnull(d_date_sk#8866L))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8866L,d_date_id#8867,d_date#8868,d_month_seq#8869,d_week_seq#8870,d_quarter_seq#8871,d_year#8872,d_dow#8873,d_moy#8874,d_dom#8875,d_qoy#8876,d_fy_year#8877,d_fy_quarter_seq#8878,d_fy_week_seq#8879,d_day_name#8880,d_quarter_name#8881,d_holiday#8882,d_weekend#8883,d_following_holiday#8884,d_first_dom#8885,d_last_dom#8886,d_same_day_ly#8887,d_same_day_lq#8888,d_current_day#8889,... 4 more fields] orc
                  :     +- Project [i_item_sk#8894L, i_item_id#8895]
                  :        +- Filter isnotnull(i_item_sk#8894L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8894L,i_item_id#8895,i_rec_start_date#8896,i_rec_end_date#8897,i_item_desc#8898,i_current_price#8899,i_wholesale_cost#8900,i_brand_id#8901,i_brand#8902,i_class_id#8903,i_class#8904,i_category_id#8905,i_category#8906,i_manufact_id#8907,i_manufact#8908,i_size#8909,i_formulation#8910,i_color#8911,i_units#8912,i_container#8913,i_manager_id#8914,i_product_name#8915] orc
                  +- Project [c_customer_sk#8835L, c_birth_year#8848, ca_county#8860, ca_state#8861, ca_country#8863]
                     +- Join Inner, (c_current_cdemo_sk#8837L = cd_demo_sk#8826L)
                        :- Project [c_customer_sk#8835L, c_current_cdemo_sk#8837L, c_birth_year#8848, ca_county#8860, ca_state#8861, ca_country#8863]
                        :  +- Join Inner, (c_current_addr_sk#8839L = ca_address_sk#8853L)
                        :     :- Project [c_customer_sk#8835L, c_current_cdemo_sk#8837L, c_current_addr_sk#8839L, c_birth_year#8848]
                        :     :  +- Filter ((c_birth_month#8847 IN (9,5,12,4,1,10) AND isnotnull(c_customer_sk#8835L)) AND (isnotnull(c_current_cdemo_sk#8837L) AND isnotnull(c_current_addr_sk#8839L)))
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8835L,c_customer_id#8836,c_current_cdemo_sk#8837L,c_current_hdemo_sk#8838L,c_current_addr_sk#8839L,c_first_shipto_date_sk#8840L,c_first_sales_date_sk#8841L,c_salutation#8842,c_first_name#8843,c_last_name#8844,c_preferred_cust_flag#8845,c_birth_day#8846,c_birth_month#8847,c_birth_year#8848,c_birth_country#8849,c_login#8850,c_email_address#8851,c_last_review_date#8852] orc
                        :     +- Project [ca_address_sk#8853L, ca_county#8860, ca_state#8861, ca_country#8863]
                        :        +- Filter (ca_state#8861 IN (ND,WI,AL,NC,OK,MS,TN) AND isnotnull(ca_address_sk#8853L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8853L,ca_address_id#8854,ca_street_number#8855,ca_street_name#8856,ca_street_type#8857,ca_suite_number#8858,ca_city#8859,ca_county#8860,ca_state#8861,ca_zip#8862,ca_country#8863,ca_gmt_offset#8864,ca_location_type#8865] orc
                        +- Project [cd_demo_sk#8826L]
                           +- Filter isnotnull(cd_demo_sk#8826L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8826L,cd_gender#8827,cd_marital_status#8828,cd_education_status#8829,cd_purchase_estimate#8830,cd_credit_rating#8831,cd_dep_count#8832,cd_dep_employed_count#8833,cd_dep_college_count#8834] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ca_country#8929 ASC NULLS FIRST,ca_state#8930 ASC NULLS FIRST,ca_county#8931 ASC NULLS FIRST,i_item_id#8928 ASC NULLS FIRST], output=[i_item_id#8928,ca_country#8929,ca_state#8930,ca_county#8931,agg1#8776,agg2#8777,agg3#8778,agg4#8779,agg5#8780,agg6#8781,agg7#8782])
   +- HashAggregate(keys=[i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L], functions=[avg(cast(cs_quantity#8800 as decimal(12,2))), avg(cast(cs_list_price#8802 as decimal(12,2))), avg(cast(cs_coupon_amt#8809 as decimal(12,2))), avg(cast(cs_sales_price#8803 as decimal(12,2))), avg(cast(cs_net_profit#8815 as decimal(12,2))), avg(cast(c_birth_year#8848 as decimal(12,2))), avg(cast(cd_dep_count#8823 as decimal(12,2)))], output=[i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, agg1#8776, agg2#8777, agg3#8778, agg4#8779, agg5#8780, agg6#8781, agg7#8782])
      +- Exchange hashpartitioning(i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L, 3000), ENSURE_REQUIREMENTS, [id=#8581]
         +- HashAggregate(keys=[i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L], functions=[partial_avg(cast(cs_quantity#8800 as decimal(12,2))), partial_avg(cast(cs_list_price#8802 as decimal(12,2))), partial_avg(cast(cs_coupon_amt#8809 as decimal(12,2))), partial_avg(cast(cs_sales_price#8803 as decimal(12,2))), partial_avg(cast(cs_net_profit#8815 as decimal(12,2))), partial_avg(cast(c_birth_year#8848 as decimal(12,2))), partial_avg(cast(cd_dep_count#8823 as decimal(12,2)))], output=[i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L, sum#8958, count#8959L, sum#8960, count#8961L, sum#8962, count#8963L, sum#8964, count#8965L, sum#8966, count#8967L, sum#8968, count#8969L, sum#8970, count#8971L])
            +- Expand [[cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, ca_county#8860, 0], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, null, 1], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, null, null, 3], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, null, null, null, 7], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, null, null, null, null, 15]], [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8928, ca_country#8929, ca_state#8930, ca_county#8931, spark_grouping_id#8927L]
               +- Project [cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, c_birth_year#8848, i_item_id#8895, ca_country#8863, ca_state#8861, ca_county#8860]
                  +- SortMergeJoin [cs_bill_customer_sk#8785L], [c_customer_sk#8835L], Inner
                     :- Sort [cs_bill_customer_sk#8785L ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(cs_bill_customer_sk#8785L, 3000), ENSURE_REQUIREMENTS, [id=#8572]
                     :     +- Project [cs_bill_customer_sk#8785L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823, i_item_id#8895]
                     :        +- SortMergeJoin [cs_item_sk#8797L], [i_item_sk#8894L], Inner
                     :           :- Sort [cs_item_sk#8797L ASC NULLS FIRST], false, 0
                     :           :  +- Exchange hashpartitioning(cs_item_sk#8797L, 3000), ENSURE_REQUIREMENTS, [id=#8549]
                     :           :     +- Project [cs_bill_customer_sk#8785L, cs_item_sk#8797L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cd_dep_count#8823]
                     :           :        +- BroadcastHashJoin [cs_sold_date_sk#8816L], [d_date_sk#8866L], Inner, BuildRight, false
                     :           :           :- Project [cs_bill_customer_sk#8785L, cs_item_sk#8797L, cs_quantity#8800, cs_list_price#8802, cs_sales_price#8803, cs_coupon_amt#8809, cs_net_profit#8815, cs_sold_date_sk#8816L, cd_dep_count#8823]
                     :           :           :  +- BroadcastHashJoin [cs_bill_cdemo_sk#8786L], [cd_demo_sk#8817L], Inner, BuildRight, false
                     :           :           :     :- Filter ((isnotnull(cs_bill_cdemo_sk#8786L) AND isnotnull(cs_bill_customer_sk#8785L)) AND isnotnull(cs_item_sk#8797L))
                     :           :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#8785L,cs_bill_cdemo_sk#8786L,cs_item_sk#8797L,cs_quantity#8800,cs_list_price#8802,cs_sales_price#8803,cs_coupon_amt#8809,cs_net_profit#8815,cs_sold_date_sk#8816L] Batched: true, DataFilters: [isnotnull(cs_bill_cdemo_sk#8786L), isnotnull(cs_bill_customer_sk#8785L), isnotnull(cs_item_sk#87..., Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#8816L), dynamicpruningexpression(cs_sold_date_sk#8816L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_bill_customer_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_bill_cdemo_sk:bigint,cs_item_sk:bigint,cs_quantity:int,cs_li...
                     :           :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#8943, 0, true, Project [d_date_sk#8866L], [d_date_sk#8866L]
                     :           :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                     :           :           :     :              +- Project [d_date_sk#8866L]
                     :           :           :     :                 +- Filter ((isnotnull(d_year#8872) AND (d_year#8872 = 2001)) AND isnotnull(d_date_sk#8866L))
                     :           :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8866L,d_year#8872] Batched: true, DataFilters: [isnotnull(d_year#8872), (d_year#8872 = 2001), isnotnull(d_date_sk#8866L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8540]
                     :           :           :        +- Project [cd_demo_sk#8817L, cd_dep_count#8823]
                     :           :           :           +- Filter ((((isnotnull(cd_gender#8818) AND isnotnull(cd_education_status#8820)) AND (cd_gender#8818 = M)) AND (cd_education_status#8820 = College)) AND isnotnull(cd_demo_sk#8817L))
                     :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8817L,cd_gender#8818,cd_education_status#8820,cd_dep_count#8823] Batched: true, DataFilters: [isnotnull(cd_gender#8818), isnotnull(cd_education_status#8820), (cd_gender#8818 = M), (cd_educat..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_education_status), EqualTo(cd_gender,M), EqualTo(cd_education..., ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_education_status:string,cd_dep_count:int>
                     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8544]
                     :           :              +- Project [d_date_sk#8866L]
                     :           :                 +- Filter ((isnotnull(d_year#8872) AND (d_year#8872 = 2001)) AND isnotnull(d_date_sk#8866L))
                     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8866L,d_year#8872] Batched: true, DataFilters: [isnotnull(d_year#8872), (d_year#8872 = 2001), isnotnull(d_date_sk#8866L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :           +- Sort [i_item_sk#8894L ASC NULLS FIRST], false, 0
                     :              +- Exchange hashpartitioning(i_item_sk#8894L, 3000), ENSURE_REQUIREMENTS, [id=#8550]
                     :                 +- Filter isnotnull(i_item_sk#8894L)
                     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#8894L,i_item_id#8895] Batched: true, DataFilters: [isnotnull(i_item_sk#8894L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
                     +- Sort [c_customer_sk#8835L ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(c_customer_sk#8835L, 3000), ENSURE_REQUIREMENTS, [id=#8573]
                           +- Project [c_customer_sk#8835L, c_birth_year#8848, ca_county#8860, ca_state#8861, ca_country#8863]
                              +- SortMergeJoin [c_current_cdemo_sk#8837L], [cd_demo_sk#8826L], Inner
                                 :- Sort [c_current_cdemo_sk#8837L ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(c_current_cdemo_sk#8837L, 3000), ENSURE_REQUIREMENTS, [id=#8564]
                                 :     +- Project [c_customer_sk#8835L, c_current_cdemo_sk#8837L, c_birth_year#8848, ca_county#8860, ca_state#8861, ca_country#8863]
                                 :        +- SortMergeJoin [c_current_addr_sk#8839L], [ca_address_sk#8853L], Inner
                                 :           :- Sort [c_current_addr_sk#8839L ASC NULLS FIRST], false, 0
                                 :           :  +- Exchange hashpartitioning(c_current_addr_sk#8839L, 3000), ENSURE_REQUIREMENTS, [id=#8556]
                                 :           :     +- Project [c_customer_sk#8835L, c_current_cdemo_sk#8837L, c_current_addr_sk#8839L, c_birth_year#8848]
                                 :           :        +- Filter (((c_birth_month#8847 IN (9,5,12,4,1,10) AND isnotnull(c_customer_sk#8835L)) AND isnotnull(c_current_cdemo_sk#8837L)) AND isnotnull(c_current_addr_sk#8839L))
                                 :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#8835L,c_current_cdemo_sk#8837L,c_current_addr_sk#8839L,c_birth_month#8847,c_birth_year#8848] Batched: true, DataFilters: [c_birth_month#8847 IN (9,5,12,4,1,10), isnotnull(c_customer_sk#8835L), isnotnull(c_current_cdemo..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(c_birth_month, [1,10,12,4,5,9]), IsNotNull(c_customer_sk), IsNotNull(c_current_cdemo_sk), IsN..., ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_addr_sk:bigint,c_birth_month:int,...
                                 :           +- Sort [ca_address_sk#8853L ASC NULLS FIRST], false, 0
                                 :              +- Exchange hashpartitioning(ca_address_sk#8853L, 3000), ENSURE_REQUIREMENTS, [id=#8557]
                                 :                 +- Filter (ca_state#8861 IN (ND,WI,AL,NC,OK,MS,TN) AND isnotnull(ca_address_sk#8853L))
                                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#8853L,ca_county#8860,ca_state#8861,ca_country#8863] Batched: true, DataFilters: [ca_state#8861 IN (ND,WI,AL,NC,OK,MS,TN), isnotnull(ca_address_sk#8853L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(ca_state, [AL,MS,NC,ND,OK,TN,WI]), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string,ca_state:string,ca_country:string>
                                 +- Sort [cd_demo_sk#8826L ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(cd_demo_sk#8826L, 3000), ENSURE_REQUIREMENTS, [id=#8565]
                                       +- Filter isnotnull(cd_demo_sk#8826L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#8826L] Batched: true, DataFilters: [isnotnull(cd_demo_sk#8826L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint>

read query: spark_queries/q19.sql
explain query: q19
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ext_price DESC NULLS LAST, 'brand ASC NULLS FIRST, 'brand_id ASC NULLS FIRST, 'i_manufact_id ASC NULLS FIRST, 'i_manufact ASC NULLS FIRST], true
      +- 'Aggregate ['i_brand, 'i_brand_id, 'i_manufact_id, 'i_manufact], ['i_brand_id AS brand_id#8972, 'i_brand AS brand#8973, 'i_manufact_id, 'i_manufact, 'sum('ss_ext_sales_price) AS ext_price#8974]
         +- 'Filter ((((('d_date_sk = 'ss_sold_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND ('i_manager_id = 7)) AND (('d_moy = 11) AND ('d_year = 1999))) AND ((('ss_customer_sk = 'c_customer_sk) AND ('c_current_addr_sk = 'ca_address_sk)) AND (NOT ('substr('ca_zip, 1, 5) = 'substr('s_zip, 1, 5)) AND ('ss_store_sk = 's_store_sk))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'UnresolvedRelation [date_dim], [], false
               :  :  :  :  +- 'UnresolvedRelation [store_sales], [], false
               :  :  :  +- 'UnresolvedRelation [item], [], false
               :  :  +- 'UnresolvedRelation [customer], [], false
               :  +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
brand_id: int, brand: string, i_manufact_id: int, i_manufact: string, ext_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ext_price#8974 DESC NULLS LAST, brand#8973 ASC NULLS FIRST, brand_id#8972 ASC NULLS FIRST, i_manufact_id#9039 ASC NULLS FIRST, i_manufact#9040 ASC NULLS FIRST], true
      +- Aggregate [i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040], [i_brand_id#9033 AS brand_id#8972, i_brand#9034 AS brand#8973, i_manufact_id#9039, i_manufact#9040, sum(ss_ext_sales_price#9017) AS ext_price#8974]
         +- Filter (((((d_date_sk#8975L = ss_sold_date_sk#9025L) AND (ss_item_sk#9004L = i_item_sk#9026L)) AND (i_manager_id#9046 = 7)) AND ((d_moy#8983 = 11) AND (d_year#8981 = 1999))) AND (((ss_customer_sk#9005L = c_customer_sk#9048L) AND (c_current_addr_sk#9052L = ca_address_sk#9066L)) AND (NOT (substr(ca_zip#9075, 1, 5) = substr(s_zip#9104, 1, 5)) AND (ss_store_sk#9009L = s_store_sk#9079L))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8975L,d_date_id#8976,d_date#8977,d_month_seq#8978,d_week_seq#8979,d_quarter_seq#8980,d_year#8981,d_dow#8982,d_moy#8983,d_dom#8984,d_qoy#8985,d_fy_year#8986,d_fy_quarter_seq#8987,d_fy_week_seq#8988,d_day_name#8989,d_quarter_name#8990,d_holiday#8991,d_weekend#8992,d_following_holiday#8993,d_first_dom#8994,d_last_dom#8995,d_same_day_ly#8996,d_same_day_lq#8997,d_current_day#8998,... 4 more fields] orc
               :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9003L,ss_item_sk#9004L,ss_customer_sk#9005L,ss_cdemo_sk#9006L,ss_hdemo_sk#9007L,ss_addr_sk#9008L,ss_store_sk#9009L,ss_promo_sk#9010L,ss_ticket_number#9011L,ss_quantity#9012,ss_wholesale_cost#9013,ss_list_price#9014,ss_sales_price#9015,ss_ext_discount_amt#9016,ss_ext_sales_price#9017,ss_ext_wholesale_cost#9018,ss_ext_list_price#9019,ss_ext_tax#9020,ss_coupon_amt#9021,ss_net_paid#9022,ss_net_paid_inc_tax#9023,ss_net_profit#9024,ss_sold_date_sk#9025L] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9026L,i_item_id#9027,i_rec_start_date#9028,i_rec_end_date#9029,i_item_desc#9030,i_current_price#9031,i_wholesale_cost#9032,i_brand_id#9033,i_brand#9034,i_class_id#9035,i_class#9036,i_category_id#9037,i_category#9038,i_manufact_id#9039,i_manufact#9040,i_size#9041,i_formulation#9042,i_color#9043,i_units#9044,i_container#9045,i_manager_id#9046,i_product_name#9047] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9048L,c_customer_id#9049,c_current_cdemo_sk#9050L,c_current_hdemo_sk#9051L,c_current_addr_sk#9052L,c_first_shipto_date_sk#9053L,c_first_sales_date_sk#9054L,c_salutation#9055,c_first_name#9056,c_last_name#9057,c_preferred_cust_flag#9058,c_birth_day#9059,c_birth_month#9060,c_birth_year#9061,c_birth_country#9062,c_login#9063,c_email_address#9064,c_last_review_date#9065] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#9066L,ca_address_id#9067,ca_street_number#9068,ca_street_name#9069,ca_street_type#9070,ca_suite_number#9071,ca_city#9072,ca_county#9073,ca_state#9074,ca_zip#9075,ca_country#9076,ca_gmt_offset#9077,ca_location_type#9078] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#9079L,s_store_id#9080,s_rec_start_date#9081,s_rec_end_date#9082,s_closed_date_sk#9083L,s_store_name#9084,s_number_employees#9085,s_floor_space#9086,s_hours#9087,s_manager#9088,s_market_id#9089,s_geography_class#9090,s_market_desc#9091,s_market_manager#9092,s_division_id#9093,s_division_name#9094,s_company_id#9095,s_company_name#9096,s_street_number#9097,s_street_name#9098,s_street_type#9099,s_suite_number#9100,s_city#9101,s_county#9102,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ext_price#8974 DESC NULLS LAST, brand#8973 ASC NULLS FIRST, brand_id#8972 ASC NULLS FIRST, i_manufact_id#9039 ASC NULLS FIRST, i_manufact#9040 ASC NULLS FIRST], true
      +- Aggregate [i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040], [i_brand_id#9033 AS brand_id#8972, i_brand#9034 AS brand#8973, i_manufact_id#9039, i_manufact#9040, sum(ss_ext_sales_price#9017) AS ext_price#8974]
         +- Project [ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
            +- Join Inner, (NOT (substr(ca_zip#9075, 1, 5) = substr(s_zip#9104, 1, 5)) AND (ss_store_sk#9009L = s_store_sk#9079L))
               :- Project [ss_store_sk#9009L, ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040, ca_zip#9075]
               :  +- Join Inner, (ss_customer_sk#9005L = c_customer_sk#9048L)
               :     :- Project [ss_customer_sk#9005L, ss_store_sk#9009L, ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
               :     :  +- Join Inner, (d_date_sk#8975L = ss_sold_date_sk#9025L)
               :     :     :- Project [ss_customer_sk#9005L, ss_store_sk#9009L, ss_ext_sales_price#9017, ss_sold_date_sk#9025L, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
               :     :     :  +- Join Inner, (ss_item_sk#9004L = i_item_sk#9026L)
               :     :     :     :- Project [ss_item_sk#9004L, ss_customer_sk#9005L, ss_store_sk#9009L, ss_ext_sales_price#9017, ss_sold_date_sk#9025L]
               :     :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#9025L) AND isnotnull(ss_item_sk#9004L)) AND isnotnull(ss_customer_sk#9005L)) AND isnotnull(ss_store_sk#9009L)) AND dynamicpruning#9114 [ss_sold_date_sk#9025L])
               :     :     :     :     :  +- Project [d_date_sk#8975L]
               :     :     :     :     :     +- Filter (((isnotnull(d_moy#8983) AND isnotnull(d_year#8981)) AND ((d_moy#8983 = 11) AND (d_year#8981 = 1999))) AND isnotnull(d_date_sk#8975L))
               :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8975L,d_date_id#8976,d_date#8977,d_month_seq#8978,d_week_seq#8979,d_quarter_seq#8980,d_year#8981,d_dow#8982,d_moy#8983,d_dom#8984,d_qoy#8985,d_fy_year#8986,d_fy_quarter_seq#8987,d_fy_week_seq#8988,d_day_name#8989,d_quarter_name#8990,d_holiday#8991,d_weekend#8992,d_following_holiday#8993,d_first_dom#8994,d_last_dom#8995,d_same_day_ly#8996,d_same_day_lq#8997,d_current_day#8998,... 4 more fields] orc
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9003L,ss_item_sk#9004L,ss_customer_sk#9005L,ss_cdemo_sk#9006L,ss_hdemo_sk#9007L,ss_addr_sk#9008L,ss_store_sk#9009L,ss_promo_sk#9010L,ss_ticket_number#9011L,ss_quantity#9012,ss_wholesale_cost#9013,ss_list_price#9014,ss_sales_price#9015,ss_ext_discount_amt#9016,ss_ext_sales_price#9017,ss_ext_wholesale_cost#9018,ss_ext_list_price#9019,ss_ext_tax#9020,ss_coupon_amt#9021,ss_net_paid#9022,ss_net_paid_inc_tax#9023,ss_net_profit#9024,ss_sold_date_sk#9025L] orc
               :     :     :     +- Project [i_item_sk#9026L, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
               :     :     :        +- Filter ((isnotnull(i_manager_id#9046) AND (i_manager_id#9046 = 7)) AND isnotnull(i_item_sk#9026L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9026L,i_item_id#9027,i_rec_start_date#9028,i_rec_end_date#9029,i_item_desc#9030,i_current_price#9031,i_wholesale_cost#9032,i_brand_id#9033,i_brand#9034,i_class_id#9035,i_class#9036,i_category_id#9037,i_category#9038,i_manufact_id#9039,i_manufact#9040,i_size#9041,i_formulation#9042,i_color#9043,i_units#9044,i_container#9045,i_manager_id#9046,i_product_name#9047] orc
               :     :     +- Project [d_date_sk#8975L]
               :     :        +- Filter (((isnotnull(d_moy#8983) AND isnotnull(d_year#8981)) AND ((d_moy#8983 = 11) AND (d_year#8981 = 1999))) AND isnotnull(d_date_sk#8975L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8975L,d_date_id#8976,d_date#8977,d_month_seq#8978,d_week_seq#8979,d_quarter_seq#8980,d_year#8981,d_dow#8982,d_moy#8983,d_dom#8984,d_qoy#8985,d_fy_year#8986,d_fy_quarter_seq#8987,d_fy_week_seq#8988,d_day_name#8989,d_quarter_name#8990,d_holiday#8991,d_weekend#8992,d_following_holiday#8993,d_first_dom#8994,d_last_dom#8995,d_same_day_ly#8996,d_same_day_lq#8997,d_current_day#8998,... 4 more fields] orc
               :     +- Project [c_customer_sk#9048L, ca_zip#9075]
               :        +- Join Inner, (c_current_addr_sk#9052L = ca_address_sk#9066L)
               :           :- Project [c_customer_sk#9048L, c_current_addr_sk#9052L]
               :           :  +- Filter (isnotnull(c_customer_sk#9048L) AND isnotnull(c_current_addr_sk#9052L))
               :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9048L,c_customer_id#9049,c_current_cdemo_sk#9050L,c_current_hdemo_sk#9051L,c_current_addr_sk#9052L,c_first_shipto_date_sk#9053L,c_first_sales_date_sk#9054L,c_salutation#9055,c_first_name#9056,c_last_name#9057,c_preferred_cust_flag#9058,c_birth_day#9059,c_birth_month#9060,c_birth_year#9061,c_birth_country#9062,c_login#9063,c_email_address#9064,c_last_review_date#9065] orc
               :           +- Project [ca_address_sk#9066L, ca_zip#9075]
               :              +- Filter (isnotnull(ca_address_sk#9066L) AND isnotnull(ca_zip#9075))
               :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#9066L,ca_address_id#9067,ca_street_number#9068,ca_street_name#9069,ca_street_type#9070,ca_suite_number#9071,ca_city#9072,ca_county#9073,ca_state#9074,ca_zip#9075,ca_country#9076,ca_gmt_offset#9077,ca_location_type#9078] orc
               +- Project [s_store_sk#9079L, s_zip#9104]
                  +- Filter (isnotnull(s_zip#9104) AND isnotnull(s_store_sk#9079L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#9079L,s_store_id#9080,s_rec_start_date#9081,s_rec_end_date#9082,s_closed_date_sk#9083L,s_store_name#9084,s_number_employees#9085,s_floor_space#9086,s_hours#9087,s_manager#9088,s_market_id#9089,s_geography_class#9090,s_market_desc#9091,s_market_manager#9092,s_division_id#9093,s_division_name#9094,s_company_id#9095,s_company_name#9096,s_street_number#9097,s_street_name#9098,s_street_type#9099,s_suite_number#9100,s_city#9101,s_county#9102,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ext_price#8974 DESC NULLS LAST,brand#8973 ASC NULLS FIRST,brand_id#8972 ASC NULLS FIRST,i_manufact_id#9039 ASC NULLS FIRST,i_manufact#9040 ASC NULLS FIRST], output=[brand_id#8972,brand#8973,i_manufact_id#9039,i_manufact#9040,ext_price#8974])
   +- HashAggregate(keys=[i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040], functions=[sum(ss_ext_sales_price#9017)], output=[brand_id#8972, brand#8973, i_manufact_id#9039, i_manufact#9040, ext_price#8974])
      +- Exchange hashpartitioning(i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040, 3000), ENSURE_REQUIREMENTS, [id=#8743]
         +- HashAggregate(keys=[i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040], functions=[partial_sum(ss_ext_sales_price#9017)], output=[i_brand#9034, i_brand_id#9033, i_manufact_id#9039, i_manufact#9040, sum#9116])
            +- Project [ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
               +- BroadcastHashJoin [ss_store_sk#9009L], [s_store_sk#9079L], Inner, BuildRight, NOT (substr(ca_zip#9075, 1, 5) = substr(s_zip#9104, 1, 5)), false
                  :- Project [ss_store_sk#9009L, ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040, ca_zip#9075]
                  :  +- SortMergeJoin [ss_customer_sk#9005L], [c_customer_sk#9048L], Inner
                  :     :- Sort [ss_customer_sk#9005L ASC NULLS FIRST], false, 0
                  :     :  +- Exchange hashpartitioning(ss_customer_sk#9005L, 3000), ENSURE_REQUIREMENTS, [id=#8731]
                  :     :     +- Project [ss_customer_sk#9005L, ss_store_sk#9009L, ss_ext_sales_price#9017, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
                  :     :        +- BroadcastHashJoin [ss_sold_date_sk#9025L], [d_date_sk#8975L], Inner, BuildRight, false
                  :     :           :- Project [ss_customer_sk#9005L, ss_store_sk#9009L, ss_ext_sales_price#9017, ss_sold_date_sk#9025L, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
                  :     :           :  +- BroadcastHashJoin [ss_item_sk#9004L], [i_item_sk#9026L], Inner, BuildRight, false
                  :     :           :     :- Filter ((isnotnull(ss_item_sk#9004L) AND isnotnull(ss_customer_sk#9005L)) AND isnotnull(ss_store_sk#9009L))
                  :     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#9004L,ss_customer_sk#9005L,ss_store_sk#9009L,ss_ext_sales_price#9017,ss_sold_date_sk#9025L] Batched: true, DataFilters: [isnotnull(ss_item_sk#9004L), isnotnull(ss_customer_sk#9005L), isnotnull(ss_store_sk#9009L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9025L), dynamicpruningexpression(ss_sold_date_sk#9025L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ext_sales_price:double>
                  :     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#9114, 0, true, Project [d_date_sk#8975L], [d_date_sk#8975L]
                  :     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :           :     :              +- Project [d_date_sk#8975L]
                  :     :           :     :                 +- Filter ((((isnotnull(d_moy#8983) AND isnotnull(d_year#8981)) AND (d_moy#8983 = 11)) AND (d_year#8981 = 1999)) AND isnotnull(d_date_sk#8975L))
                  :     :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8975L,d_year#8981,d_moy#8983] Batched: true, DataFilters: [isnotnull(d_moy#8983), isnotnull(d_year#8981), (d_moy#8983 = 11), (d_year#8981 = 1999), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8715]
                  :     :           :        +- Project [i_item_sk#9026L, i_brand_id#9033, i_brand#9034, i_manufact_id#9039, i_manufact#9040]
                  :     :           :           +- Filter ((isnotnull(i_manager_id#9046) AND (i_manager_id#9046 = 7)) AND isnotnull(i_item_sk#9026L))
                  :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9026L,i_brand_id#9033,i_brand#9034,i_manufact_id#9039,i_manufact#9040,i_manager_id#9046] Batched: true, DataFilters: [isnotnull(i_manager_id#9046), (i_manager_id#9046 = 7), isnotnull(i_item_sk#9026L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,7), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_brand:string,i_manufact_id:int,i_manufact:string,i_manag...
                  :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8719]
                  :     :              +- Project [d_date_sk#8975L]
                  :     :                 +- Filter ((((isnotnull(d_moy#8983) AND isnotnull(d_year#8981)) AND (d_moy#8983 = 11)) AND (d_year#8981 = 1999)) AND isnotnull(d_date_sk#8975L))
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#8975L,d_year#8981,d_moy#8983] Batched: true, DataFilters: [isnotnull(d_moy#8983), isnotnull(d_year#8981), (d_moy#8983 = 11), (d_year#8981 = 1999), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     +- Sort [c_customer_sk#9048L ASC NULLS FIRST], false, 0
                  :        +- Exchange hashpartitioning(c_customer_sk#9048L, 3000), ENSURE_REQUIREMENTS, [id=#8732]
                  :           +- Project [c_customer_sk#9048L, ca_zip#9075]
                  :              +- SortMergeJoin [c_current_addr_sk#9052L], [ca_address_sk#9066L], Inner
                  :                 :- Sort [c_current_addr_sk#9052L ASC NULLS FIRST], false, 0
                  :                 :  +- Exchange hashpartitioning(c_current_addr_sk#9052L, 3000), ENSURE_REQUIREMENTS, [id=#8723]
                  :                 :     +- Filter (isnotnull(c_customer_sk#9048L) AND isnotnull(c_current_addr_sk#9052L))
                  :                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9048L,c_current_addr_sk#9052L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9048L), isnotnull(c_current_addr_sk#9052L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
                  :                 +- Sort [ca_address_sk#9066L ASC NULLS FIRST], false, 0
                  :                    +- Exchange hashpartitioning(ca_address_sk#9066L, 3000), ENSURE_REQUIREMENTS, [id=#8724]
                  :                       +- Filter (isnotnull(ca_address_sk#9066L) AND isnotnull(ca_zip#9075))
                  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#9066L,ca_zip#9075] Batched: true, DataFilters: [isnotnull(ca_address_sk#9066L), isnotnull(ca_zip#9075)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_zip)], ReadSchema: struct<ca_address_sk:bigint,ca_zip:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#8738]
                     +- Filter (isnotnull(s_zip#9104) AND isnotnull(s_store_sk#9079L))
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#9079L,s_zip#9104] Batched: true, DataFilters: [isnotnull(s_zip#9104), isnotnull(s_store_sk#9079L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_zip), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_zip:string>

read query: spark_queries/q20.sql
explain query: q20
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('cs_ext_sales_price) AS itemrevenue#9117, (('sum('cs_ext_sales_price) * 100) / 'sum('sum('cs_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#9118]
         +- 'Filter ((('cs_item_sk = 'i_item_sk) AND 'i_category IN (Jewelry,Sports,Books)) AND (('cs_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(2001-01-12 as date)) AND ('d_date <= (cast(2001-01-12 as date) + INTERVAL '30' DAY)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
i_item_desc: string, i_category: string, i_class: string, i_current_price: double, itemrevenue: double, revenueratio: double
GlobalLimit 100
+- LocalLimit 100
   +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, revenueratio#9118]
      +- Sort [i_category#9165 ASC NULLS FIRST, i_class#9163 ASC NULLS FIRST, i_item_id#9154 ASC NULLS FIRST, i_item_desc#9157 ASC NULLS FIRST, revenueratio#9118 ASC NULLS FIRST], true
         +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, revenueratio#9118, i_item_id#9154]
            +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, _w0#9207, _w1#9208, _we0#9209, ((_w0#9207 * cast(100 as double)) / _we0#9209) AS revenueratio#9118, i_item_id#9154]
               +- Window [sum(_w1#9208) windowspecdefinition(i_class#9163, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#9209], [i_class#9163]
                  +- Aggregate [i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158], [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, sum(cs_ext_sales_price#9141) AS itemrevenue#9117, sum(cs_ext_sales_price#9141) AS _w0#9207, sum(cs_ext_sales_price#9141) AS _w1#9208, i_item_id#9154]
                     +- Filter (((cs_item_sk#9133L = i_item_sk#9153L) AND i_category#9165 IN (Jewelry,Sports,Books)) AND ((cs_sold_date_sk#9152L = d_date_sk#9175L) AND ((d_date#9177 >= cast(2001-01-12 as date)) AND (d_date#9177 <= date_add(cast(2001-01-12 as date), extractansiintervaldays(INTERVAL '30' DAY))))))
                        +- Join Inner
                           :- Join Inner
                           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9119L,cs_ship_date_sk#9120L,cs_bill_customer_sk#9121L,cs_bill_cdemo_sk#9122L,cs_bill_hdemo_sk#9123L,cs_bill_addr_sk#9124L,cs_ship_customer_sk#9125L,cs_ship_cdemo_sk#9126L,cs_ship_hdemo_sk#9127L,cs_ship_addr_sk#9128L,cs_call_center_sk#9129L,cs_catalog_page_sk#9130L,cs_ship_mode_sk#9131L,cs_warehouse_sk#9132L,cs_item_sk#9133L,cs_promo_sk#9134L,cs_order_number#9135L,cs_quantity#9136,cs_wholesale_cost#9137,cs_list_price#9138,cs_sales_price#9139,cs_ext_discount_amt#9140,cs_ext_sales_price#9141,cs_ext_wholesale_cost#9142,... 10 more fields] orc
                           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9153L,i_item_id#9154,i_rec_start_date#9155,i_rec_end_date#9156,i_item_desc#9157,i_current_price#9158,i_wholesale_cost#9159,i_brand_id#9160,i_brand#9161,i_class_id#9162,i_class#9163,i_category_id#9164,i_category#9165,i_manufact_id#9166,i_manufact#9167,i_size#9168,i_formulation#9169,i_color#9170,i_units#9171,i_container#9172,i_manager_id#9173,i_product_name#9174] orc
                           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9175L,d_date_id#9176,d_date#9177,d_month_seq#9178,d_week_seq#9179,d_quarter_seq#9180,d_year#9181,d_dow#9182,d_moy#9183,d_dom#9184,d_qoy#9185,d_fy_year#9186,d_fy_quarter_seq#9187,d_fy_week_seq#9188,d_day_name#9189,d_quarter_name#9190,d_holiday#9191,d_weekend#9192,d_following_holiday#9193,d_first_dom#9194,d_last_dom#9195,d_same_day_ly#9196,d_same_day_lq#9197,d_current_day#9198,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, revenueratio#9118]
      +- Sort [i_category#9165 ASC NULLS FIRST, i_class#9163 ASC NULLS FIRST, i_item_id#9154 ASC NULLS FIRST, i_item_desc#9157 ASC NULLS FIRST, revenueratio#9118 ASC NULLS FIRST], true
         +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, ((_w0#9207 * 100.0) / _we0#9209) AS revenueratio#9118, i_item_id#9154]
            +- Window [sum(_w1#9208) windowspecdefinition(i_class#9163, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#9209], [i_class#9163]
               +- Aggregate [i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158], [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, sum(cs_ext_sales_price#9141) AS itemrevenue#9117, sum(cs_ext_sales_price#9141) AS _w0#9207, sum(cs_ext_sales_price#9141) AS _w1#9208, i_item_id#9154]
                  +- Project [cs_ext_sales_price#9141, i_item_id#9154, i_item_desc#9157, i_current_price#9158, i_class#9163, i_category#9165]
                     +- Join Inner, (cs_item_sk#9133L = i_item_sk#9153L)
                        :- Project [cs_item_sk#9133L, cs_ext_sales_price#9141]
                        :  +- Join Inner, (cs_sold_date_sk#9152L = d_date_sk#9175L)
                        :     :- Project [cs_item_sk#9133L, cs_ext_sales_price#9141, cs_sold_date_sk#9152L]
                        :     :  +- Filter ((isnotnull(cs_item_sk#9133L) AND isnotnull(cs_sold_date_sk#9152L)) AND dynamicpruning#9216 [cs_sold_date_sk#9152L])
                        :     :     :  +- Project [d_date_sk#9175L]
                        :     :     :     +- Filter ((isnotnull(d_date#9177) AND ((d_date#9177 >= 2001-01-12) AND (d_date#9177 <= 2001-02-11))) AND isnotnull(d_date_sk#9175L))
                        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9175L,d_date_id#9176,d_date#9177,d_month_seq#9178,d_week_seq#9179,d_quarter_seq#9180,d_year#9181,d_dow#9182,d_moy#9183,d_dom#9184,d_qoy#9185,d_fy_year#9186,d_fy_quarter_seq#9187,d_fy_week_seq#9188,d_day_name#9189,d_quarter_name#9190,d_holiday#9191,d_weekend#9192,d_following_holiday#9193,d_first_dom#9194,d_last_dom#9195,d_same_day_ly#9196,d_same_day_lq#9197,d_current_day#9198,... 4 more fields] orc
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9119L,cs_ship_date_sk#9120L,cs_bill_customer_sk#9121L,cs_bill_cdemo_sk#9122L,cs_bill_hdemo_sk#9123L,cs_bill_addr_sk#9124L,cs_ship_customer_sk#9125L,cs_ship_cdemo_sk#9126L,cs_ship_hdemo_sk#9127L,cs_ship_addr_sk#9128L,cs_call_center_sk#9129L,cs_catalog_page_sk#9130L,cs_ship_mode_sk#9131L,cs_warehouse_sk#9132L,cs_item_sk#9133L,cs_promo_sk#9134L,cs_order_number#9135L,cs_quantity#9136,cs_wholesale_cost#9137,cs_list_price#9138,cs_sales_price#9139,cs_ext_discount_amt#9140,cs_ext_sales_price#9141,cs_ext_wholesale_cost#9142,... 10 more fields] orc
                        :     +- Project [d_date_sk#9175L]
                        :        +- Filter ((isnotnull(d_date#9177) AND ((d_date#9177 >= 2001-01-12) AND (d_date#9177 <= 2001-02-11))) AND isnotnull(d_date_sk#9175L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9175L,d_date_id#9176,d_date#9177,d_month_seq#9178,d_week_seq#9179,d_quarter_seq#9180,d_year#9181,d_dow#9182,d_moy#9183,d_dom#9184,d_qoy#9185,d_fy_year#9186,d_fy_quarter_seq#9187,d_fy_week_seq#9188,d_day_name#9189,d_quarter_name#9190,d_holiday#9191,d_weekend#9192,d_following_holiday#9193,d_first_dom#9194,d_last_dom#9195,d_same_day_ly#9196,d_same_day_lq#9197,d_current_day#9198,... 4 more fields] orc
                        +- Project [i_item_sk#9153L, i_item_id#9154, i_item_desc#9157, i_current_price#9158, i_class#9163, i_category#9165]
                           +- Filter (i_category#9165 IN (Jewelry,Sports,Books) AND isnotnull(i_item_sk#9153L))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9153L,i_item_id#9154,i_rec_start_date#9155,i_rec_end_date#9156,i_item_desc#9157,i_current_price#9158,i_wholesale_cost#9159,i_brand_id#9160,i_brand#9161,i_class_id#9162,i_class#9163,i_category_id#9164,i_category#9165,i_manufact_id#9166,i_manufact#9167,i_size#9168,i_formulation#9169,i_color#9170,i_units#9171,i_container#9172,i_manager_id#9173,i_product_name#9174] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_category#9165 ASC NULLS FIRST,i_class#9163 ASC NULLS FIRST,i_item_id#9154 ASC NULLS FIRST,i_item_desc#9157 ASC NULLS FIRST,revenueratio#9118 ASC NULLS FIRST], output=[i_item_desc#9157,i_category#9165,i_class#9163,i_current_price#9158,itemrevenue#9117,revenueratio#9118])
   +- Project [i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, ((_w0#9207 * 100.0) / _we0#9209) AS revenueratio#9118, i_item_id#9154]
      +- Window [sum(_w1#9208) windowspecdefinition(i_class#9163, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#9209], [i_class#9163]
         +- Sort [i_class#9163 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_class#9163, 3000), ENSURE_REQUIREMENTS, [id=#8847]
               +- HashAggregate(keys=[i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158], functions=[sum(cs_ext_sales_price#9141)], output=[i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, itemrevenue#9117, _w0#9207, _w1#9208, i_item_id#9154])
                  +- Exchange hashpartitioning(i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, 3000), ENSURE_REQUIREMENTS, [id=#8844]
                     +- HashAggregate(keys=[i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, knownfloatingpointnormalized(normalizenanandzero(i_current_price#9158)) AS i_current_price#9158], functions=[partial_sum(cs_ext_sales_price#9141)], output=[i_item_id#9154, i_item_desc#9157, i_category#9165, i_class#9163, i_current_price#9158, sum#9218])
                        +- Project [cs_ext_sales_price#9141, i_item_id#9154, i_item_desc#9157, i_current_price#9158, i_class#9163, i_category#9165]
                           +- SortMergeJoin [cs_item_sk#9133L], [i_item_sk#9153L], Inner
                              :- Sort [cs_item_sk#9133L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(cs_item_sk#9133L, 3000), ENSURE_REQUIREMENTS, [id=#8836]
                              :     +- Project [cs_item_sk#9133L, cs_ext_sales_price#9141]
                              :        +- BroadcastHashJoin [cs_sold_date_sk#9152L], [d_date_sk#9175L], Inner, BuildRight, false
                              :           :- Filter isnotnull(cs_item_sk#9133L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#9133L,cs_ext_sales_price#9141,cs_sold_date_sk#9152L] Batched: true, DataFilters: [isnotnull(cs_item_sk#9133L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#9152L), dynamicpruningexpression(cs_sold_date_sk#9152L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_ext_sales_price:double>
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#9216, 0, true, Project [d_date_sk#9175L], [d_date_sk#9175L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Project [d_date_sk#9175L]
                              :           :                 +- Filter (((isnotnull(d_date#9177) AND (d_date#9177 >= 2001-01-12)) AND (d_date#9177 <= 2001-02-11)) AND isnotnull(d_date_sk#9175L))
                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9175L,d_date#9177] Batched: true, DataFilters: [isnotnull(d_date#9177), (d_date#9177 >= 2001-01-12), (d_date#9177 <= 2001-02-11), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8831]
                              :              +- Project [d_date_sk#9175L]
                              :                 +- Filter (((isnotnull(d_date#9177) AND (d_date#9177 >= 2001-01-12)) AND (d_date#9177 <= 2001-02-11)) AND isnotnull(d_date_sk#9175L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9175L,d_date#9177] Batched: true, DataFilters: [isnotnull(d_date#9177), (d_date#9177 >= 2001-01-12), (d_date#9177 <= 2001-02-11), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              +- Sort [i_item_sk#9153L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(i_item_sk#9153L, 3000), ENSURE_REQUIREMENTS, [id=#8837]
                                    +- Filter (i_category#9165 IN (Jewelry,Sports,Books) AND isnotnull(i_item_sk#9153L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9153L,i_item_id#9154,i_item_desc#9157,i_current_price#9158,i_class#9163,i_category#9165] Batched: true, DataFilters: [i_category#9165 IN (Jewelry,Sports,Books), isnotnull(i_item_sk#9153L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_category, [Books,Jewelry,Sports]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string,i_current_price:double,i_class:string...

read query: spark_queries/q21.sql
explain query: q21
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['w_warehouse_name ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true
      +- 'Project [*]
         +- 'Filter ((CASE WHEN ('inv_before > 0) THEN ('inv_after / 'inv_before) ELSE null END >= (2.0 / 3.0)) AND (CASE WHEN ('inv_before > 0) THEN ('inv_after / 'inv_before) ELSE null END <= (3.0 / 2.0)))
            +- 'SubqueryAlias x
               +- 'Aggregate ['w_warehouse_name, 'i_item_id], ['w_warehouse_name, 'i_item_id, 'sum(CASE WHEN (cast('d_date as date) < cast(1998-04-08 as date)) THEN 'inv_quantity_on_hand ELSE 0 END) AS inv_before#9219, 'sum(CASE WHEN (cast('d_date as date) >= cast(1998-04-08 as date)) THEN 'inv_quantity_on_hand ELSE 0 END) AS inv_after#9220]
                  +- 'Filter ((((('i_current_price >= 0.99) AND ('i_current_price <= 1.49)) AND ('i_item_sk = 'inv_item_sk)) AND ('inv_warehouse_sk = 'w_warehouse_sk)) AND (('inv_date_sk = 'd_date_sk) AND (('d_date >= (cast(1998-04-08 as date) - INTERVAL '30' DAY)) AND ('d_date <= (cast(1998-04-08 as date) + INTERVAL '30' DAY)))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'UnresolvedRelation [inventory], [], false
                        :  :  +- 'UnresolvedRelation [warehouse], [], false
                        :  +- 'UnresolvedRelation [item], [], false
                        +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
w_warehouse_name: string, i_item_id: string, inv_before: bigint, inv_after: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_warehouse_name#9227 ASC NULLS FIRST, i_item_id#9240 ASC NULLS FIRST], true
      +- Project [w_warehouse_name#9227, i_item_id#9240, inv_before#9219L, inv_after#9220L]
         +- Filter ((CASE WHEN (inv_before#9219L > cast(0 as bigint)) THEN (cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) ELSE cast(null as double) END >= cast(CheckOverflow((promote_precision(cast(2.0 as decimal(2,1))) / promote_precision(cast(3.0 as decimal(2,1)))), DecimalType(8,6), true) as double)) AND (CASE WHEN (inv_before#9219L > cast(0 as bigint)) THEN (cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) ELSE cast(null as double) END <= cast(CheckOverflow((promote_precision(cast(3.0 as decimal(2,1))) / promote_precision(cast(2.0 as decimal(2,1)))), DecimalType(8,6), true) as double)))
            +- SubqueryAlias x
               +- Aggregate [w_warehouse_name#9227, i_item_id#9240], [w_warehouse_name#9227, i_item_id#9240, sum(CASE WHEN (cast(d_date#9263 as date) < cast(1998-04-08 as date)) THEN inv_quantity_on_hand#9224 ELSE 0 END) AS inv_before#9219L, sum(CASE WHEN (cast(d_date#9263 as date) >= cast(1998-04-08 as date)) THEN inv_quantity_on_hand#9224 ELSE 0 END) AS inv_after#9220L]
                  +- Filter (((((i_current_price#9244 >= cast(0.99 as double)) AND (i_current_price#9244 <= cast(1.49 as double))) AND (i_item_sk#9239L = inv_item_sk#9222L)) AND (inv_warehouse_sk#9223L = w_warehouse_sk#9225L)) AND ((inv_date_sk#9221L = d_date_sk#9261L) AND ((d_date#9263 >= date_add(cast(1998-04-08 as date), -extractansiintervaldays(INTERVAL '30' DAY))) AND (d_date#9263 <= date_add(cast(1998-04-08 as date), extractansiintervaldays(INTERVAL '30' DAY))))))
                     +- Join Inner
                        :- Join Inner
                        :  :- Join Inner
                        :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
                        :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9221L,inv_item_sk#9222L,inv_warehouse_sk#9223L,inv_quantity_on_hand#9224] orc
                        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
                        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9225L,w_warehouse_id#9226,w_warehouse_name#9227,w_warehouse_sq_ft#9228,w_street_number#9229,w_street_name#9230,w_street_type#9231,w_suite_number#9232,w_city#9233,w_county#9234,w_state#9235,w_zip#9236,w_country#9237,w_gmt_offset#9238] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9239L,i_item_id#9240,i_rec_start_date#9241,i_rec_end_date#9242,i_item_desc#9243,i_current_price#9244,i_wholesale_cost#9245,i_brand_id#9246,i_brand#9247,i_class_id#9248,i_class#9249,i_category_id#9250,i_category#9251,i_manufact_id#9252,i_manufact#9253,i_size#9254,i_formulation#9255,i_color#9256,i_units#9257,i_container#9258,i_manager_id#9259,i_product_name#9260] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9261L,d_date_id#9262,d_date#9263,d_month_seq#9264,d_week_seq#9265,d_quarter_seq#9266,d_year#9267,d_dow#9268,d_moy#9269,d_dom#9270,d_qoy#9271,d_fy_year#9272,d_fy_quarter_seq#9273,d_fy_week_seq#9274,d_day_name#9275,d_quarter_name#9276,d_holiday#9277,d_weekend#9278,d_following_holiday#9279,d_first_dom#9280,d_last_dom#9281,d_same_day_ly#9282,d_same_day_lq#9283,d_current_day#9284,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_warehouse_name#9227 ASC NULLS FIRST, i_item_id#9240 ASC NULLS FIRST], true
      +- Filter ((isnotnull(inv_before#9219L) AND isnotnull(inv_after#9220L)) AND (((inv_before#9219L > 0) AND ((cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) >= 0.666667)) AND ((cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) <= 1.5)))
         +- Aggregate [w_warehouse_name#9227, i_item_id#9240], [w_warehouse_name#9227, i_item_id#9240, sum(CASE WHEN (d_date#9263 < 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END) AS inv_before#9219L, sum(CASE WHEN (d_date#9263 >= 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END) AS inv_after#9220L]
            +- Project [inv_quantity_on_hand#9224, w_warehouse_name#9227, i_item_id#9240, d_date#9263]
               +- Join Inner, (inv_warehouse_sk#9223L = w_warehouse_sk#9225L)
                  :- Project [inv_warehouse_sk#9223L, inv_quantity_on_hand#9224, i_item_id#9240, d_date#9263]
                  :  +- Join Inner, (inv_date_sk#9221L = d_date_sk#9261L)
                  :     :- Project [inv_date_sk#9221L, inv_warehouse_sk#9223L, inv_quantity_on_hand#9224, i_item_id#9240]
                  :     :  +- Join Inner, (i_item_sk#9239L = inv_item_sk#9222L)
                  :     :     :- Filter (isnotnull(inv_warehouse_sk#9223L) AND (isnotnull(inv_item_sk#9222L) AND isnotnull(inv_date_sk#9221L)))
                  :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9221L,inv_item_sk#9222L,inv_warehouse_sk#9223L,inv_quantity_on_hand#9224] orc
                  :     :     +- Project [i_item_sk#9239L, i_item_id#9240]
                  :     :        +- Filter ((isnotnull(i_current_price#9244) AND ((i_current_price#9244 >= 0.99) AND (i_current_price#9244 <= 1.49))) AND isnotnull(i_item_sk#9239L))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9239L,i_item_id#9240,i_rec_start_date#9241,i_rec_end_date#9242,i_item_desc#9243,i_current_price#9244,i_wholesale_cost#9245,i_brand_id#9246,i_brand#9247,i_class_id#9248,i_class#9249,i_category_id#9250,i_category#9251,i_manufact_id#9252,i_manufact#9253,i_size#9254,i_formulation#9255,i_color#9256,i_units#9257,i_container#9258,i_manager_id#9259,i_product_name#9260] orc
                  :     +- Project [d_date_sk#9261L, d_date#9263]
                  :        +- Filter ((isnotnull(d_date#9263) AND ((d_date#9263 >= 1998-03-09) AND (d_date#9263 <= 1998-05-08))) AND isnotnull(d_date_sk#9261L))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9261L,d_date_id#9262,d_date#9263,d_month_seq#9264,d_week_seq#9265,d_quarter_seq#9266,d_year#9267,d_dow#9268,d_moy#9269,d_dom#9270,d_qoy#9271,d_fy_year#9272,d_fy_quarter_seq#9273,d_fy_week_seq#9274,d_day_name#9275,d_quarter_name#9276,d_holiday#9277,d_weekend#9278,d_following_holiday#9279,d_first_dom#9280,d_last_dom#9281,d_same_day_ly#9282,d_same_day_lq#9283,d_current_day#9284,... 4 more fields] orc
                  +- Project [w_warehouse_sk#9225L, w_warehouse_name#9227]
                     +- Filter isnotnull(w_warehouse_sk#9225L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9225L,w_warehouse_id#9226,w_warehouse_name#9227,w_warehouse_sq_ft#9228,w_street_number#9229,w_street_name#9230,w_street_type#9231,w_suite_number#9232,w_city#9233,w_county#9234,w_state#9235,w_zip#9236,w_country#9237,w_gmt_offset#9238] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[w_warehouse_name#9227 ASC NULLS FIRST,i_item_id#9240 ASC NULLS FIRST], output=[w_warehouse_name#9227,i_item_id#9240,inv_before#9219L,inv_after#9220L])
   +- Filter ((isnotnull(inv_before#9219L) AND isnotnull(inv_after#9220L)) AND (((inv_before#9219L > 0) AND ((cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) >= 0.666667)) AND ((cast(inv_after#9220L as double) / cast(inv_before#9219L as double)) <= 1.5)))
      +- HashAggregate(keys=[w_warehouse_name#9227, i_item_id#9240], functions=[sum(CASE WHEN (d_date#9263 < 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END), sum(CASE WHEN (d_date#9263 >= 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END)], output=[w_warehouse_name#9227, i_item_id#9240, inv_before#9219L, inv_after#9220L])
         +- Exchange hashpartitioning(w_warehouse_name#9227, i_item_id#9240, 3000), ENSURE_REQUIREMENTS, [id=#8945]
            +- HashAggregate(keys=[w_warehouse_name#9227, i_item_id#9240], functions=[partial_sum(CASE WHEN (d_date#9263 < 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END), partial_sum(CASE WHEN (d_date#9263 >= 1998-04-08) THEN inv_quantity_on_hand#9224 ELSE 0 END)], output=[w_warehouse_name#9227, i_item_id#9240, sum#9297L, sum#9298L])
               +- Project [inv_quantity_on_hand#9224, w_warehouse_name#9227, i_item_id#9240, d_date#9263]
                  +- BroadcastHashJoin [inv_warehouse_sk#9223L], [w_warehouse_sk#9225L], Inner, BuildRight, false
                     :- Project [inv_warehouse_sk#9223L, inv_quantity_on_hand#9224, i_item_id#9240, d_date#9263]
                     :  +- BroadcastHashJoin [inv_date_sk#9221L], [d_date_sk#9261L], Inner, BuildRight, false
                     :     :- Project [inv_date_sk#9221L, inv_warehouse_sk#9223L, inv_quantity_on_hand#9224, i_item_id#9240]
                     :     :  +- BroadcastHashJoin [inv_item_sk#9222L], [i_item_sk#9239L], Inner, BuildRight, false
                     :     :     :- Filter ((isnotnull(inv_warehouse_sk#9223L) AND isnotnull(inv_item_sk#9222L)) AND isnotnull(inv_date_sk#9221L))
                     :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9221L,inv_item_sk#9222L,inv_warehouse_sk#9223L,inv_quantity_on_hand#9224] Batched: true, DataFilters: [isnotnull(inv_warehouse_sk#9223L), isnotnull(inv_item_sk#9222L), isnotnull(inv_date_sk#9221L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_warehouse_sk), IsNotNull(inv_item_sk), IsNotNull(inv_date_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#8932]
                     :     :        +- Project [i_item_sk#9239L, i_item_id#9240]
                     :     :           +- Filter (((isnotnull(i_current_price#9244) AND (i_current_price#9244 >= 0.99)) AND (i_current_price#9244 <= 1.49)) AND isnotnull(i_item_sk#9239L))
                     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9239L,i_item_id#9240,i_current_price#9244] Batched: true, DataFilters: [isnotnull(i_current_price#9244), (i_current_price#9244 >= 0.99), (i_current_price#9244 <= 1.49),..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_current_price:double>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#8936]
                     :        +- Filter (((isnotnull(d_date#9263) AND (d_date#9263 >= 1998-03-09)) AND (d_date#9263 <= 1998-05-08)) AND isnotnull(d_date_sk#9261L))
                     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9261L,d_date#9263] Batched: true, DataFilters: [isnotnull(d_date#9263), (d_date#9263 >= 1998-03-09), (d_date#9263 <= 1998-05-08), isnotnull(d_da..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-09), LessThanOrEqual(d_date,1998-05-08), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#8940]
                        +- Filter isnotnull(w_warehouse_sk#9225L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9225L,w_warehouse_name#9227] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#9225L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>

read query: spark_queries/q22.sql
explain query: q22
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['qoh ASC NULLS FIRST, 'i_product_name ASC NULLS FIRST, 'i_brand ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_category ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), Vector(2), Vector(3), 'i_product_name, 'i_brand, 'i_class, 'i_category)], ['i_product_name, 'i_brand, 'i_class, 'i_category, 'avg('inv_quantity_on_hand) AS qoh#9299]
         +- 'Filter ((('inv_date_sk = 'd_date_sk) AND ('inv_item_sk = 'i_item_sk)) AND (('inv_warehouse_sk = 'w_warehouse_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [inventory], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [warehouse], [], false

== Analyzed Logical Plan ==
i_product_name: string, i_brand: string, i_class: string, i_category: string, qoh: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [qoh#9299 ASC NULLS FIRST, i_product_name#9374 ASC NULLS FIRST, i_brand#9375 ASC NULLS FIRST, i_class#9376 ASC NULLS FIRST, i_category#9377 ASC NULLS FIRST], true
      +- Aggregate [i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L], [i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, avg(inv_quantity_on_hand#9303) AS qoh#9299]
         +- Expand [[inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields], [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields], [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields], [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields], [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields]], [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 49 more fields]
            +- Project [inv_date_sk#9300L, inv_item_sk#9301L, inv_warehouse_sk#9302L, inv_quantity_on_hand#9303, d_date_sk#9304L, d_date_id#9305, d_date#9306, d_month_seq#9307, d_week_seq#9308, d_quarter_seq#9309, d_year#9310, d_dow#9311, d_moy#9312, d_dom#9313, d_qoy#9314, d_fy_year#9315, d_fy_quarter_seq#9316, d_fy_week_seq#9317, d_day_name#9318, d_quarter_name#9319, d_holiday#9320, d_weekend#9321, d_following_holiday#9322, d_first_dom#9323, ... 48 more fields]
               +- Filter (((inv_date_sk#9300L = d_date_sk#9304L) AND (inv_item_sk#9301L = i_item_sk#9332L)) AND ((inv_warehouse_sk#9302L = w_warehouse_sk#9354L) AND ((d_month_seq#9307 >= 1212) AND (d_month_seq#9307 <= (1212 + 11)))))
                  +- Join Inner
                     :- Join Inner
                     :  :- Join Inner
                     :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
                     :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9300L,inv_item_sk#9301L,inv_warehouse_sk#9302L,inv_quantity_on_hand#9303] orc
                     :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9304L,d_date_id#9305,d_date#9306,d_month_seq#9307,d_week_seq#9308,d_quarter_seq#9309,d_year#9310,d_dow#9311,d_moy#9312,d_dom#9313,d_qoy#9314,d_fy_year#9315,d_fy_quarter_seq#9316,d_fy_week_seq#9317,d_day_name#9318,d_quarter_name#9319,d_holiday#9320,d_weekend#9321,d_following_holiday#9322,d_first_dom#9323,d_last_dom#9324,d_same_day_ly#9325,d_same_day_lq#9326,d_current_day#9327,... 4 more fields] orc
                     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9332L,i_item_id#9333,i_rec_start_date#9334,i_rec_end_date#9335,i_item_desc#9336,i_current_price#9337,i_wholesale_cost#9338,i_brand_id#9339,i_brand#9340,i_class_id#9341,i_class#9342,i_category_id#9343,i_category#9344,i_manufact_id#9345,i_manufact#9346,i_size#9347,i_formulation#9348,i_color#9349,i_units#9350,i_container#9351,i_manager_id#9352,i_product_name#9353] orc
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9354L,w_warehouse_id#9355,w_warehouse_name#9356,w_warehouse_sq_ft#9357,w_street_number#9358,w_street_name#9359,w_street_type#9360,w_suite_number#9361,w_city#9362,w_county#9363,w_state#9364,w_zip#9365,w_country#9366,w_gmt_offset#9367] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [qoh#9299 ASC NULLS FIRST, i_product_name#9374 ASC NULLS FIRST, i_brand#9375 ASC NULLS FIRST, i_class#9376 ASC NULLS FIRST, i_category#9377 ASC NULLS FIRST], true
      +- Aggregate [i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L], [i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, avg(inv_quantity_on_hand#9303) AS qoh#9299]
         +- Expand [[inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, i_category#9344, 0], [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, null, 1], [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, null, null, 3], [inv_quantity_on_hand#9303, i_product_name#9353, null, null, null, 7], [inv_quantity_on_hand#9303, null, null, null, null, 15]], [inv_quantity_on_hand#9303, i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L]
            +- Project [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, i_category#9344]
               +- Join Inner, (inv_item_sk#9301L = i_item_sk#9332L)
                  :- Project [inv_item_sk#9301L, inv_quantity_on_hand#9303]
                  :  +- Join Inner, (inv_date_sk#9300L = d_date_sk#9304L)
                  :     :- Project [inv_date_sk#9300L, inv_item_sk#9301L, inv_quantity_on_hand#9303]
                  :     :  +- Join Inner, (inv_warehouse_sk#9302L = w_warehouse_sk#9354L)
                  :     :     :- Filter (isnotnull(inv_date_sk#9300L) AND (isnotnull(inv_item_sk#9301L) AND isnotnull(inv_warehouse_sk#9302L)))
                  :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9300L,inv_item_sk#9301L,inv_warehouse_sk#9302L,inv_quantity_on_hand#9303] orc
                  :     :     +- Project [w_warehouse_sk#9354L]
                  :     :        +- Filter isnotnull(w_warehouse_sk#9354L)
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9354L,w_warehouse_id#9355,w_warehouse_name#9356,w_warehouse_sq_ft#9357,w_street_number#9358,w_street_name#9359,w_street_type#9360,w_suite_number#9361,w_city#9362,w_county#9363,w_state#9364,w_zip#9365,w_country#9366,w_gmt_offset#9367] orc
                  :     +- Project [d_date_sk#9304L]
                  :        +- Filter ((isnotnull(d_month_seq#9307) AND ((d_month_seq#9307 >= 1212) AND (d_month_seq#9307 <= 1223))) AND isnotnull(d_date_sk#9304L))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9304L,d_date_id#9305,d_date#9306,d_month_seq#9307,d_week_seq#9308,d_quarter_seq#9309,d_year#9310,d_dow#9311,d_moy#9312,d_dom#9313,d_qoy#9314,d_fy_year#9315,d_fy_quarter_seq#9316,d_fy_week_seq#9317,d_day_name#9318,d_quarter_name#9319,d_holiday#9320,d_weekend#9321,d_following_holiday#9322,d_first_dom#9323,d_last_dom#9324,d_same_day_ly#9325,d_same_day_lq#9326,d_current_day#9327,... 4 more fields] orc
                  +- Project [i_item_sk#9332L, i_brand#9340, i_class#9342, i_category#9344, i_product_name#9353]
                     +- Filter isnotnull(i_item_sk#9332L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9332L,i_item_id#9333,i_rec_start_date#9334,i_rec_end_date#9335,i_item_desc#9336,i_current_price#9337,i_wholesale_cost#9338,i_brand_id#9339,i_brand#9340,i_class_id#9341,i_class#9342,i_category_id#9343,i_category#9344,i_manufact_id#9345,i_manufact#9346,i_size#9347,i_formulation#9348,i_color#9349,i_units#9350,i_container#9351,i_manager_id#9352,i_product_name#9353] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[qoh#9299 ASC NULLS FIRST,i_product_name#9374 ASC NULLS FIRST,i_brand#9375 ASC NULLS FIRST,i_class#9376 ASC NULLS FIRST,i_category#9377 ASC NULLS FIRST], output=[i_product_name#9374,i_brand#9375,i_class#9376,i_category#9377,qoh#9299])
   +- HashAggregate(keys=[i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L], functions=[avg(inv_quantity_on_hand#9303)], output=[i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, qoh#9299])
      +- Exchange hashpartitioning(i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L, 3000), ENSURE_REQUIREMENTS, [id=#9047]
         +- HashAggregate(keys=[i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L], functions=[partial_avg(inv_quantity_on_hand#9303)], output=[i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L, sum#9385, count#9386L])
            +- Expand [[inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, i_category#9344, 0], [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, null, 1], [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, null, null, 3], [inv_quantity_on_hand#9303, i_product_name#9353, null, null, null, 7], [inv_quantity_on_hand#9303, null, null, null, null, 15]], [inv_quantity_on_hand#9303, i_product_name#9374, i_brand#9375, i_class#9376, i_category#9377, spark_grouping_id#9373L]
               +- Project [inv_quantity_on_hand#9303, i_product_name#9353, i_brand#9340, i_class#9342, i_category#9344]
                  +- SortMergeJoin [inv_item_sk#9301L], [i_item_sk#9332L], Inner
                     :- Sort [inv_item_sk#9301L ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(inv_item_sk#9301L, 3000), ENSURE_REQUIREMENTS, [id=#9038]
                     :     +- Project [inv_item_sk#9301L, inv_quantity_on_hand#9303]
                     :        +- BroadcastHashJoin [inv_date_sk#9300L], [d_date_sk#9304L], Inner, BuildRight, false
                     :           :- Project [inv_date_sk#9300L, inv_item_sk#9301L, inv_quantity_on_hand#9303]
                     :           :  +- BroadcastHashJoin [inv_warehouse_sk#9302L], [w_warehouse_sk#9354L], Inner, BuildRight, false
                     :           :     :- Filter ((isnotnull(inv_date_sk#9300L) AND isnotnull(inv_item_sk#9301L)) AND isnotnull(inv_warehouse_sk#9302L))
                     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#9300L,inv_item_sk#9301L,inv_warehouse_sk#9302L,inv_quantity_on_hand#9303] Batched: true, DataFilters: [isnotnull(inv_date_sk#9300L), isnotnull(inv_item_sk#9301L), isnotnull(inv_warehouse_sk#9302L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_date_sk), IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#9029]
                     :           :        +- Filter isnotnull(w_warehouse_sk#9354L)
                     :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#9354L] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#9354L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint>
                     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9033]
                     :              +- Project [d_date_sk#9304L]
                     :                 +- Filter (((isnotnull(d_month_seq#9307) AND (d_month_seq#9307 >= 1212)) AND (d_month_seq#9307 <= 1223)) AND isnotnull(d_date_sk#9304L))
                     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9304L,d_month_seq#9307] Batched: true, DataFilters: [isnotnull(d_month_seq#9307), (d_month_seq#9307 >= 1212), (d_month_seq#9307 <= 1223), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                     +- Sort [i_item_sk#9332L ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_item_sk#9332L, 3000), ENSURE_REQUIREMENTS, [id=#9039]
                           +- Filter isnotnull(i_item_sk#9332L)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9332L,i_brand#9340,i_class#9342,i_category#9344,i_product_name#9353] Batched: true, DataFilters: [isnotnull(i_item_sk#9332L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_class:string,i_category:string,i_product_name:string>

read query: spark_queries/q23a.sql
explain query: q23a
== Parsed Logical Plan ==
CTE [frequent_ss_items, max_store_sales, best_ss_customer]
:  :- 'SubqueryAlias frequent_ss_items
:  :  +- 'UnresolvedHaving ('count(1) > 4)
:  :     +- 'Aggregate ['substr('i_item_desc, 1, 30), 'i_item_sk, 'd_date], ['substr('i_item_desc, 1, 30) AS itemdesc#9393, 'i_item_sk AS item_sk#9394, 'd_date AS solddate#9395, 'count(1) AS cnt#9396]
:  :        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND 'd_year IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:  :           +- 'Join Inner
:  :              :- 'Join Inner
:  :              :  :- 'UnresolvedRelation [store_sales], [], false
:  :              :  +- 'UnresolvedRelation [date_dim], [], false
:  :              +- 'UnresolvedRelation [item], [], false
:  :- 'SubqueryAlias max_store_sales
:  :  +- 'Project ['max('csales) AS tpcds_cmax#9398]
:  :     +- 'SubqueryAlias x
:  :        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS csales#9397]
:  :           +- 'Filter ((('ss_customer_sk = 'c_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND 'd_year IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:  :              +- 'Join Inner
:  :                 :- 'Join Inner
:  :                 :  :- 'UnresolvedRelation [store_sales], [], false
:  :                 :  +- 'UnresolvedRelation [customer], [], false
:  :                 +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias best_ss_customer
:     +- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_sales_price)) > ((95 / 100.0) * scalar-subquery#9400 []))
:        :  +- 'Project [*]
:        :     +- 'UnresolvedRelation [max_store_sales], [], false
:        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS ssales#9399]
:           +- 'Filter ('ss_customer_sk = 'c_customer_sk)
:              +- 'Join Inner
:                 :- 'UnresolvedRelation [store_sales], [], false
:                 +- 'UnresolvedRelation [customer], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Project [unresolvedalias('sum('sales), None)]
         +- 'SubqueryAlias y
            +- 'Union false, false
               :- 'Project [('cs_quantity * 'cs_list_price) AS sales#9387]
               :  +- 'Filter (((('d_year = 1999) AND ('d_moy = 1)) AND ('cs_sold_date_sk = 'd_date_sk)) AND ('cs_item_sk IN (list#9388 []) AND 'cs_bill_customer_sk IN (list#9389 [])))
               :     :  :- 'Project ['item_sk]
               :     :  :  +- 'UnresolvedRelation [frequent_ss_items], [], false
               :     :  +- 'Project ['c_customer_sk]
               :     :     +- 'UnresolvedRelation [best_ss_customer], [], false
               :     +- 'Join Inner
               :        :- 'UnresolvedRelation [catalog_sales], [], false
               :        +- 'UnresolvedRelation [date_dim], [], false
               +- 'Project [('ws_quantity * 'ws_list_price) AS sales#9390]
                  +- 'Filter (((('d_year = 1999) AND ('d_moy = 1)) AND ('ws_sold_date_sk = 'd_date_sk)) AND ('ws_item_sk IN (list#9391 []) AND 'ws_bill_customer_sk IN (list#9392 [])))
                     :  :- 'Project ['item_sk]
                     :  :  +- 'UnresolvedRelation [frequent_ss_items], [], false
                     :  +- 'Project ['c_customer_sk]
                     :     +- 'UnresolvedRelation [best_ss_customer], [], false
                     +- 'Join Inner
                        :- 'UnresolvedRelation [web_sales], [], false
                        +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
sum(sales): double
WithCTE
:- CTERelationDef 12
:  +- SubqueryAlias frequent_ss_items
:     +- Filter (cnt#9396L > cast(4 as bigint))
:        +- Aggregate [substr(i_item_desc#9458, 1, 30), i_item_sk#9454L, d_date#9428], [substr(i_item_desc#9458, 1, 30) AS itemdesc#9393, i_item_sk#9454L AS item_sk#9394L, d_date#9428 AS solddate#9395, count(1) AS cnt#9396L]
:           +- Filter (((ss_sold_date_sk#9425L = d_date_sk#9426L) AND (ss_item_sk#9404L = i_item_sk#9454L)) AND d_year#9432 IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9403L,ss_item_sk#9404L,ss_customer_sk#9405L,ss_cdemo_sk#9406L,ss_hdemo_sk#9407L,ss_addr_sk#9408L,ss_store_sk#9409L,ss_promo_sk#9410L,ss_ticket_number#9411L,ss_quantity#9412,ss_wholesale_cost#9413,ss_list_price#9414,ss_sales_price#9415,ss_ext_discount_amt#9416,ss_ext_sales_price#9417,ss_ext_wholesale_cost#9418,ss_ext_list_price#9419,ss_ext_tax#9420,ss_coupon_amt#9421,ss_net_paid#9422,ss_net_paid_inc_tax#9423,ss_net_profit#9424,ss_sold_date_sk#9425L] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date_id#9427,d_date#9428,d_month_seq#9429,d_week_seq#9430,d_quarter_seq#9431,d_year#9432,d_dow#9433,d_moy#9434,d_dom#9435,d_qoy#9436,d_fy_year#9437,d_fy_quarter_seq#9438,d_fy_week_seq#9439,d_day_name#9440,d_quarter_name#9441,d_holiday#9442,d_weekend#9443,d_following_holiday#9444,d_first_dom#9445,d_last_dom#9446,d_same_day_ly#9447,d_same_day_lq#9448,d_current_day#9449,... 4 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9454L,i_item_id#9455,i_rec_start_date#9456,i_rec_end_date#9457,i_item_desc#9458,i_current_price#9459,i_wholesale_cost#9460,i_brand_id#9461,i_brand#9462,i_class_id#9463,i_class#9464,i_category_id#9465,i_category#9466,i_manufact_id#9467,i_manufact#9468,i_size#9469,i_formulation#9470,i_color#9471,i_units#9472,i_container#9473,i_manager_id#9474,i_product_name#9475] orc
:- CTERelationDef 13
:  +- SubqueryAlias max_store_sales
:     +- Aggregate [max(csales#9397) AS tpcds_cmax#9398]
:        +- SubqueryAlias x
:           +- Aggregate [c_customer_sk#9499L], [c_customer_sk#9499L, sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488)) AS csales#9397]
:              +- Filter (((ss_customer_sk#9478L = c_customer_sk#9499L) AND (ss_sold_date_sk#9498L = d_date_sk#9517L)) AND d_year#9523 IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:                 +- Join Inner
:                    :- Join Inner
:                    :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                    :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9476L,ss_item_sk#9477L,ss_customer_sk#9478L,ss_cdemo_sk#9479L,ss_hdemo_sk#9480L,ss_addr_sk#9481L,ss_store_sk#9482L,ss_promo_sk#9483L,ss_ticket_number#9484L,ss_quantity#9485,ss_wholesale_cost#9486,ss_list_price#9487,ss_sales_price#9488,ss_ext_discount_amt#9489,ss_ext_sales_price#9490,ss_ext_wholesale_cost#9491,ss_ext_list_price#9492,ss_ext_tax#9493,ss_coupon_amt#9494,ss_net_paid#9495,ss_net_paid_inc_tax#9496,ss_net_profit#9497,ss_sold_date_sk#9498L] orc
:                    :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9499L,c_customer_id#9500,c_current_cdemo_sk#9501L,c_current_hdemo_sk#9502L,c_current_addr_sk#9503L,c_first_shipto_date_sk#9504L,c_first_sales_date_sk#9505L,c_salutation#9506,c_first_name#9507,c_last_name#9508,c_preferred_cust_flag#9509,c_birth_day#9510,c_birth_month#9511,c_birth_year#9512,c_birth_country#9513,c_login#9514,c_email_address#9515,c_last_review_date#9516] orc
:                    +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_date_id#9518,d_date#9519,d_month_seq#9520,d_week_seq#9521,d_quarter_seq#9522,d_year#9523,d_dow#9524,d_moy#9525,d_dom#9526,d_qoy#9527,d_fy_year#9528,d_fy_quarter_seq#9529,d_fy_week_seq#9530,d_day_name#9531,d_quarter_name#9532,d_holiday#9533,d_weekend#9534,d_following_holiday#9535,d_first_dom#9536,d_last_dom#9537,d_same_day_ly#9538,d_same_day_lq#9539,d_current_day#9540,... 4 more fields] orc
:- CTERelationDef 14
:  +- SubqueryAlias best_ss_customer
:     +- Filter (ssales#9399 > (cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6), true) as double) * scalar-subquery#9400 []))
:        :  +- Project [tpcds_cmax#9398]
:        :     +- SubqueryAlias max_store_sales
:        :        +- CTERelationRef 13, true, [tpcds_cmax#9398]
:        +- Aggregate [c_customer_sk#9568L], [c_customer_sk#9568L, sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557)) AS ssales#9399]
:           +- Filter (ss_customer_sk#9547L = c_customer_sk#9568L)
:              +- Join Inner
:                 :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9545L,ss_item_sk#9546L,ss_customer_sk#9547L,ss_cdemo_sk#9548L,ss_hdemo_sk#9549L,ss_addr_sk#9550L,ss_store_sk#9551L,ss_promo_sk#9552L,ss_ticket_number#9553L,ss_quantity#9554,ss_wholesale_cost#9555,ss_list_price#9556,ss_sales_price#9557,ss_ext_discount_amt#9558,ss_ext_sales_price#9559,ss_ext_wholesale_cost#9560,ss_ext_list_price#9561,ss_ext_tax#9562,ss_coupon_amt#9563,ss_net_paid#9564,ss_net_paid_inc_tax#9565,ss_net_profit#9566,ss_sold_date_sk#9567L] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9568L,c_customer_id#9569,c_current_cdemo_sk#9570L,c_current_hdemo_sk#9571L,c_current_addr_sk#9572L,c_first_shipto_date_sk#9573L,c_first_sales_date_sk#9574L,c_salutation#9575,c_first_name#9576,c_last_name#9577,c_preferred_cust_flag#9578,c_birth_day#9579,c_birth_month#9580,c_birth_year#9581,c_birth_country#9582,c_login#9583,c_email_address#9584,c_last_review_date#9585] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Aggregate [sum(sales#9387) AS sum(sales)#9720]
         +- SubqueryAlias y
            +- Union false, false
               :- Project [(cast(cs_quantity#9603 as double) * cs_list_price#9605) AS sales#9387]
               :  +- Filter ((((d_year#9626 = 1999) AND (d_moy#9628 = 1)) AND (cs_sold_date_sk#9619L = d_date_sk#9620L)) AND (cs_item_sk#9600L IN (list#9388 []) AND cs_bill_customer_sk#9588L IN (list#9389 [])))
               :     :  :- Project [item_sk#9394L]
               :     :  :  +- SubqueryAlias frequent_ss_items
               :     :  :     +- CTERelationRef 12, true, [itemdesc#9393, item_sk#9394L, solddate#9395, cnt#9396L]
               :     :  +- Project [c_customer_sk#9568L]
               :     :     +- SubqueryAlias best_ss_customer
               :     :        +- CTERelationRef 14, true, [c_customer_sk#9568L, ssales#9399]
               :     +- Join Inner
               :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9586L,cs_ship_date_sk#9587L,cs_bill_customer_sk#9588L,cs_bill_cdemo_sk#9589L,cs_bill_hdemo_sk#9590L,cs_bill_addr_sk#9591L,cs_ship_customer_sk#9592L,cs_ship_cdemo_sk#9593L,cs_ship_hdemo_sk#9594L,cs_ship_addr_sk#9595L,cs_call_center_sk#9596L,cs_catalog_page_sk#9597L,cs_ship_mode_sk#9598L,cs_warehouse_sk#9599L,cs_item_sk#9600L,cs_promo_sk#9601L,cs_order_number#9602L,cs_quantity#9603,cs_wholesale_cost#9604,cs_list_price#9605,cs_sales_price#9606,cs_ext_discount_amt#9607,cs_ext_sales_price#9608,cs_ext_wholesale_cost#9609,... 10 more fields] orc
               :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9620L,d_date_id#9621,d_date#9622,d_month_seq#9623,d_week_seq#9624,d_quarter_seq#9625,d_year#9626,d_dow#9627,d_moy#9628,d_dom#9629,d_qoy#9630,d_fy_year#9631,d_fy_quarter_seq#9632,d_fy_week_seq#9633,d_day_name#9634,d_quarter_name#9635,d_holiday#9636,d_weekend#9637,d_following_holiday#9638,d_first_dom#9639,d_last_dom#9640,d_same_day_ly#9641,d_same_day_lq#9642,d_current_day#9643,... 4 more fields] orc
               +- Project [(cast(ws_quantity#9665 as double) * ws_list_price#9667) AS sales#9390]
                  +- Filter ((((d_year#9688 = 1999) AND (d_moy#9690 = 1)) AND (ws_sold_date_sk#9681L = d_date_sk#9682L)) AND (ws_item_sk#9650L IN (list#9391 []) AND ws_bill_customer_sk#9651L IN (list#9392 [])))
                     :  :- Project [item_sk#9394L]
                     :  :  +- SubqueryAlias frequent_ss_items
                     :  :     +- CTERelationRef 12, true, [itemdesc#9393, item_sk#9394L, solddate#9395, cnt#9396L]
                     :  +- Project [c_customer_sk#9568L]
                     :     +- SubqueryAlias best_ss_customer
                     :        +- CTERelationRef 14, true, [c_customer_sk#9568L, ssales#9399]
                     +- Join Inner
                        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#9648L,ws_ship_date_sk#9649L,ws_item_sk#9650L,ws_bill_customer_sk#9651L,ws_bill_cdemo_sk#9652L,ws_bill_hdemo_sk#9653L,ws_bill_addr_sk#9654L,ws_ship_customer_sk#9655L,ws_ship_cdemo_sk#9656L,ws_ship_hdemo_sk#9657L,ws_ship_addr_sk#9658L,ws_web_page_sk#9659L,ws_web_site_sk#9660L,ws_ship_mode_sk#9661L,ws_warehouse_sk#9662L,ws_promo_sk#9663L,ws_order_number#9664L,ws_quantity#9665,ws_wholesale_cost#9666,ws_list_price#9667,ws_sales_price#9668,ws_ext_discount_amt#9669,ws_ext_sales_price#9670,ws_ext_wholesale_cost#9671,... 10 more fields] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9682L,d_date_id#9683,d_date#9684,d_month_seq#9685,d_week_seq#9686,d_quarter_seq#9687,d_year#9688,d_dow#9689,d_moy#9690,d_dom#9691,d_qoy#9692,d_fy_year#9693,d_fy_quarter_seq#9694,d_fy_week_seq#9695,d_day_name#9696,d_quarter_name#9697,d_holiday#9698,d_weekend#9699,d_following_holiday#9700,d_first_dom#9701,d_last_dom#9702,d_same_day_ly#9703,d_same_day_lq#9704,d_current_day#9705,... 4 more fields] orc

== Optimized Logical Plan ==
Aggregate [sum(sales#9387) AS sum(sales)#9720]
+- Union false, false
   :- Project [(cast(cs_quantity#9603 as double) * cs_list_price#9605) AS sales#9387]
   :  +- Join Inner, (cs_sold_date_sk#9619L = d_date_sk#9620L)
   :     :- Project [cs_quantity#9603, cs_list_price#9605, cs_sold_date_sk#9619L]
   :     :  +- Join LeftSemi, (cs_bill_customer_sk#9588L = c_customer_sk#9568L)
   :     :     :- Project [cs_bill_customer_sk#9588L, cs_quantity#9603, cs_list_price#9605, cs_sold_date_sk#9619L]
   :     :     :  +- Join LeftSemi, (cs_item_sk#9600L = item_sk#9394L)
   :     :     :     :- Project [cs_bill_customer_sk#9588L, cs_item_sk#9600L, cs_quantity#9603, cs_list_price#9605, cs_sold_date_sk#9619L]
   :     :     :     :  +- Filter (isnotnull(cs_sold_date_sk#9619L) AND dynamicpruning#9729 [cs_sold_date_sk#9619L])
   :     :     :     :     :  +- Project [d_date_sk#9620L]
   :     :     :     :     :     +- Filter (((isnotnull(d_year#9626) AND isnotnull(d_moy#9628)) AND ((d_year#9626 = 1999) AND (d_moy#9628 = 1))) AND isnotnull(d_date_sk#9620L))
   :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9620L,d_date_id#9621,d_date#9622,d_month_seq#9623,d_week_seq#9624,d_quarter_seq#9625,d_year#9626,d_dow#9627,d_moy#9628,d_dom#9629,d_qoy#9630,d_fy_year#9631,d_fy_quarter_seq#9632,d_fy_week_seq#9633,d_day_name#9634,d_quarter_name#9635,d_holiday#9636,d_weekend#9637,d_following_holiday#9638,d_first_dom#9639,d_last_dom#9640,d_same_day_ly#9641,d_same_day_lq#9642,d_current_day#9643,... 4 more fields] orc
   :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9586L,cs_ship_date_sk#9587L,cs_bill_customer_sk#9588L,cs_bill_cdemo_sk#9589L,cs_bill_hdemo_sk#9590L,cs_bill_addr_sk#9591L,cs_ship_customer_sk#9592L,cs_ship_cdemo_sk#9593L,cs_ship_hdemo_sk#9594L,cs_ship_addr_sk#9595L,cs_call_center_sk#9596L,cs_catalog_page_sk#9597L,cs_ship_mode_sk#9598L,cs_warehouse_sk#9599L,cs_item_sk#9600L,cs_promo_sk#9601L,cs_order_number#9602L,cs_quantity#9603,cs_wholesale_cost#9604,cs_list_price#9605,cs_sales_price#9606,cs_ext_discount_amt#9607,cs_ext_sales_price#9608,cs_ext_wholesale_cost#9609,... 10 more fields] orc
   :     :     :     +- Project [item_sk#9394L]
   :     :     :        +- Filter (cnt#9396L > 4)
   :     :     :           +- Aggregate [_groupingexpression#9722, i_item_sk#9454L, d_date#9428], [i_item_sk#9454L AS item_sk#9394L, count(1) AS cnt#9396L]
   :     :     :              +- Project [d_date#9428, i_item_sk#9454L, substr(i_item_desc#9458, 1, 30) AS _groupingexpression#9722]
   :     :     :                 +- Join Inner, (ss_item_sk#9404L = i_item_sk#9454L)
   :     :     :                    :- Project [ss_item_sk#9404L, d_date#9428]
   :     :     :                    :  +- Join Inner, (ss_sold_date_sk#9425L = d_date_sk#9426L)
   :     :     :                    :     :- Project [ss_item_sk#9404L, ss_sold_date_sk#9425L]
   :     :     :                    :     :  +- Filter ((isnotnull(ss_sold_date_sk#9425L) AND isnotnull(ss_item_sk#9404L)) AND dynamicpruning#9723 [ss_sold_date_sk#9425L])
   :     :     :                    :     :     :  +- Project [d_date_sk#9426L, d_date#9428]
   :     :     :                    :     :     :     +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
   :     :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date_id#9427,d_date#9428,d_month_seq#9429,d_week_seq#9430,d_quarter_seq#9431,d_year#9432,d_dow#9433,d_moy#9434,d_dom#9435,d_qoy#9436,d_fy_year#9437,d_fy_quarter_seq#9438,d_fy_week_seq#9439,d_day_name#9440,d_quarter_name#9441,d_holiday#9442,d_weekend#9443,d_following_holiday#9444,d_first_dom#9445,d_last_dom#9446,d_same_day_ly#9447,d_same_day_lq#9448,d_current_day#9449,... 4 more fields] orc
   :     :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9403L,ss_item_sk#9404L,ss_customer_sk#9405L,ss_cdemo_sk#9406L,ss_hdemo_sk#9407L,ss_addr_sk#9408L,ss_store_sk#9409L,ss_promo_sk#9410L,ss_ticket_number#9411L,ss_quantity#9412,ss_wholesale_cost#9413,ss_list_price#9414,ss_sales_price#9415,ss_ext_discount_amt#9416,ss_ext_sales_price#9417,ss_ext_wholesale_cost#9418,ss_ext_list_price#9419,ss_ext_tax#9420,ss_coupon_amt#9421,ss_net_paid#9422,ss_net_paid_inc_tax#9423,ss_net_profit#9424,ss_sold_date_sk#9425L] orc
   :     :     :                    :     +- Project [d_date_sk#9426L, d_date#9428]
   :     :     :                    :        +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
   :     :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date_id#9427,d_date#9428,d_month_seq#9429,d_week_seq#9430,d_quarter_seq#9431,d_year#9432,d_dow#9433,d_moy#9434,d_dom#9435,d_qoy#9436,d_fy_year#9437,d_fy_quarter_seq#9438,d_fy_week_seq#9439,d_day_name#9440,d_quarter_name#9441,d_holiday#9442,d_weekend#9443,d_following_holiday#9444,d_first_dom#9445,d_last_dom#9446,d_same_day_ly#9447,d_same_day_lq#9448,d_current_day#9449,... 4 more fields] orc
   :     :     :                    +- Project [i_item_sk#9454L, i_item_desc#9458]
   :     :     :                       +- Filter isnotnull(i_item_sk#9454L)
   :     :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9454L,i_item_id#9455,i_rec_start_date#9456,i_rec_end_date#9457,i_item_desc#9458,i_current_price#9459,i_wholesale_cost#9460,i_brand_id#9461,i_brand#9462,i_class_id#9463,i_class#9464,i_category_id#9465,i_category#9466,i_manufact_id#9467,i_manufact#9468,i_size#9469,i_formulation#9470,i_color#9471,i_units#9472,i_container#9473,i_manager_id#9474,i_product_name#9475] orc
   :     :     +- Project [c_customer_sk#9568L]
   :     :        +- Filter (isnotnull(ssales#9399) AND (ssales#9399 > (0.95 * scalar-subquery#9400 [])))
   :     :           :  +- Aggregate [max(csales#9397) AS tpcds_cmax#9398]
   :     :           :     +- Aggregate [c_customer_sk#9499L], [sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488)) AS csales#9397]
   :     :           :        +- Project [ss_quantity#9485, ss_sales_price#9488, c_customer_sk#9499L]
   :     :           :           +- Join Inner, (ss_customer_sk#9478L = c_customer_sk#9499L)
   :     :           :              :- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488]
   :     :           :              :  +- Join Inner, (ss_sold_date_sk#9498L = d_date_sk#9517L)
   :     :           :              :     :- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488, ss_sold_date_sk#9498L]
   :     :           :              :     :  +- Filter ((isnotnull(ss_customer_sk#9478L) AND isnotnull(ss_sold_date_sk#9498L)) AND dynamicpruning#9724 [ss_sold_date_sk#9498L])
   :     :           :              :     :     :  +- Project [d_date_sk#9517L]
   :     :           :              :     :     :     +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
   :     :           :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_date_id#9518,d_date#9519,d_month_seq#9520,d_week_seq#9521,d_quarter_seq#9522,d_year#9523,d_dow#9524,d_moy#9525,d_dom#9526,d_qoy#9527,d_fy_year#9528,d_fy_quarter_seq#9529,d_fy_week_seq#9530,d_day_name#9531,d_quarter_name#9532,d_holiday#9533,d_weekend#9534,d_following_holiday#9535,d_first_dom#9536,d_last_dom#9537,d_same_day_ly#9538,d_same_day_lq#9539,d_current_day#9540,... 4 more fields] orc
   :     :           :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9476L,ss_item_sk#9477L,ss_customer_sk#9478L,ss_cdemo_sk#9479L,ss_hdemo_sk#9480L,ss_addr_sk#9481L,ss_store_sk#9482L,ss_promo_sk#9483L,ss_ticket_number#9484L,ss_quantity#9485,ss_wholesale_cost#9486,ss_list_price#9487,ss_sales_price#9488,ss_ext_discount_amt#9489,ss_ext_sales_price#9490,ss_ext_wholesale_cost#9491,ss_ext_list_price#9492,ss_ext_tax#9493,ss_coupon_amt#9494,ss_net_paid#9495,ss_net_paid_inc_tax#9496,ss_net_profit#9497,ss_sold_date_sk#9498L] orc
   :     :           :              :     +- Project [d_date_sk#9517L]
   :     :           :              :        +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
   :     :           :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_date_id#9518,d_date#9519,d_month_seq#9520,d_week_seq#9521,d_quarter_seq#9522,d_year#9523,d_dow#9524,d_moy#9525,d_dom#9526,d_qoy#9527,d_fy_year#9528,d_fy_quarter_seq#9529,d_fy_week_seq#9530,d_day_name#9531,d_quarter_name#9532,d_holiday#9533,d_weekend#9534,d_following_holiday#9535,d_first_dom#9536,d_last_dom#9537,d_same_day_ly#9538,d_same_day_lq#9539,d_current_day#9540,... 4 more fields] orc
   :     :           :              +- Project [c_customer_sk#9499L]
   :     :           :                 +- Filter isnotnull(c_customer_sk#9499L)
   :     :           :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9499L,c_customer_id#9500,c_current_cdemo_sk#9501L,c_current_hdemo_sk#9502L,c_current_addr_sk#9503L,c_first_shipto_date_sk#9504L,c_first_sales_date_sk#9505L,c_salutation#9506,c_first_name#9507,c_last_name#9508,c_preferred_cust_flag#9509,c_birth_day#9510,c_birth_month#9511,c_birth_year#9512,c_birth_country#9513,c_login#9514,c_email_address#9515,c_last_review_date#9516] orc
   :     :           +- Aggregate [c_customer_sk#9568L], [c_customer_sk#9568L, sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557)) AS ssales#9399]
   :     :              +- Project [ss_quantity#9554, ss_sales_price#9557, c_customer_sk#9568L]
   :     :                 +- Join Inner, (ss_customer_sk#9547L = c_customer_sk#9568L)
   :     :                    :- Project [ss_customer_sk#9547L, ss_quantity#9554, ss_sales_price#9557]
   :     :                    :  +- Filter isnotnull(ss_customer_sk#9547L)
   :     :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9545L,ss_item_sk#9546L,ss_customer_sk#9547L,ss_cdemo_sk#9548L,ss_hdemo_sk#9549L,ss_addr_sk#9550L,ss_store_sk#9551L,ss_promo_sk#9552L,ss_ticket_number#9553L,ss_quantity#9554,ss_wholesale_cost#9555,ss_list_price#9556,ss_sales_price#9557,ss_ext_discount_amt#9558,ss_ext_sales_price#9559,ss_ext_wholesale_cost#9560,ss_ext_list_price#9561,ss_ext_tax#9562,ss_coupon_amt#9563,ss_net_paid#9564,ss_net_paid_inc_tax#9565,ss_net_profit#9566,ss_sold_date_sk#9567L] orc
   :     :                    +- Project [c_customer_sk#9568L]
   :     :                       +- Filter isnotnull(c_customer_sk#9568L)
   :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9568L,c_customer_id#9569,c_current_cdemo_sk#9570L,c_current_hdemo_sk#9571L,c_current_addr_sk#9572L,c_first_shipto_date_sk#9573L,c_first_sales_date_sk#9574L,c_salutation#9575,c_first_name#9576,c_last_name#9577,c_preferred_cust_flag#9578,c_birth_day#9579,c_birth_month#9580,c_birth_year#9581,c_birth_country#9582,c_login#9583,c_email_address#9584,c_last_review_date#9585] orc
   :     +- Project [d_date_sk#9620L]
   :        +- Filter (((isnotnull(d_year#9626) AND isnotnull(d_moy#9628)) AND ((d_year#9626 = 1999) AND (d_moy#9628 = 1))) AND isnotnull(d_date_sk#9620L))
   :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9620L,d_date_id#9621,d_date#9622,d_month_seq#9623,d_week_seq#9624,d_quarter_seq#9625,d_year#9626,d_dow#9627,d_moy#9628,d_dom#9629,d_qoy#9630,d_fy_year#9631,d_fy_quarter_seq#9632,d_fy_week_seq#9633,d_day_name#9634,d_quarter_name#9635,d_holiday#9636,d_weekend#9637,d_following_holiday#9638,d_first_dom#9639,d_last_dom#9640,d_same_day_ly#9641,d_same_day_lq#9642,d_current_day#9643,... 4 more fields] orc
   +- Project [(cast(ws_quantity#9665 as double) * ws_list_price#9667) AS sales#9390]
      +- Join Inner, (ws_sold_date_sk#9681L = d_date_sk#9682L)
         :- Project [ws_quantity#9665, ws_list_price#9667, ws_sold_date_sk#9681L]
         :  +- Join LeftSemi, (ws_bill_customer_sk#9651L = c_customer_sk#9568L)
         :     :- Project [ws_bill_customer_sk#9651L, ws_quantity#9665, ws_list_price#9667, ws_sold_date_sk#9681L]
         :     :  +- Join LeftSemi, (ws_item_sk#9650L = item_sk#9394L)
         :     :     :- Project [ws_item_sk#9650L, ws_bill_customer_sk#9651L, ws_quantity#9665, ws_list_price#9667, ws_sold_date_sk#9681L]
         :     :     :  +- Filter (isnotnull(ws_sold_date_sk#9681L) AND dynamicpruning#9731 [ws_sold_date_sk#9681L])
         :     :     :     :  +- Project [d_date_sk#9682L]
         :     :     :     :     +- Filter (((isnotnull(d_year#9688) AND isnotnull(d_moy#9690)) AND ((d_year#9688 = 1999) AND (d_moy#9690 = 1))) AND isnotnull(d_date_sk#9682L))
         :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9682L,d_date_id#9683,d_date#9684,d_month_seq#9685,d_week_seq#9686,d_quarter_seq#9687,d_year#9688,d_dow#9689,d_moy#9690,d_dom#9691,d_qoy#9692,d_fy_year#9693,d_fy_quarter_seq#9694,d_fy_week_seq#9695,d_day_name#9696,d_quarter_name#9697,d_holiday#9698,d_weekend#9699,d_following_holiday#9700,d_first_dom#9701,d_last_dom#9702,d_same_day_ly#9703,d_same_day_lq#9704,d_current_day#9705,... 4 more fields] orc
         :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#9648L,ws_ship_date_sk#9649L,ws_item_sk#9650L,ws_bill_customer_sk#9651L,ws_bill_cdemo_sk#9652L,ws_bill_hdemo_sk#9653L,ws_bill_addr_sk#9654L,ws_ship_customer_sk#9655L,ws_ship_cdemo_sk#9656L,ws_ship_hdemo_sk#9657L,ws_ship_addr_sk#9658L,ws_web_page_sk#9659L,ws_web_site_sk#9660L,ws_ship_mode_sk#9661L,ws_warehouse_sk#9662L,ws_promo_sk#9663L,ws_order_number#9664L,ws_quantity#9665,ws_wholesale_cost#9666,ws_list_price#9667,ws_sales_price#9668,ws_ext_discount_amt#9669,ws_ext_sales_price#9670,ws_ext_wholesale_cost#9671,... 10 more fields] orc
         :     :     +- Project [item_sk#9394L]
         :     :        +- Filter (cnt#9396L > 4)
         :     :           +- Aggregate [_groupingexpression#9725, i_item_sk#9454L, d_date#9428], [i_item_sk#9454L AS item_sk#9394L, count(1) AS cnt#9396L]
         :     :              +- Project [d_date#9428, i_item_sk#9454L, substr(i_item_desc#9458, 1, 30) AS _groupingexpression#9725]
         :     :                 +- Join Inner, (ss_item_sk#9404L = i_item_sk#9454L)
         :     :                    :- Project [ss_item_sk#9404L, d_date#9428]
         :     :                    :  +- Join Inner, (ss_sold_date_sk#9425L = d_date_sk#9426L)
         :     :                    :     :- Project [ss_item_sk#9404L, ss_sold_date_sk#9425L]
         :     :                    :     :  +- Filter ((isnotnull(ss_sold_date_sk#9425L) AND isnotnull(ss_item_sk#9404L)) AND dynamicpruning#9726 [ss_sold_date_sk#9425L])
         :     :                    :     :     :  +- Project [d_date_sk#9426L, d_date#9428]
         :     :                    :     :     :     +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
         :     :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date_id#9427,d_date#9428,d_month_seq#9429,d_week_seq#9430,d_quarter_seq#9431,d_year#9432,d_dow#9433,d_moy#9434,d_dom#9435,d_qoy#9436,d_fy_year#9437,d_fy_quarter_seq#9438,d_fy_week_seq#9439,d_day_name#9440,d_quarter_name#9441,d_holiday#9442,d_weekend#9443,d_following_holiday#9444,d_first_dom#9445,d_last_dom#9446,d_same_day_ly#9447,d_same_day_lq#9448,d_current_day#9449,... 4 more fields] orc
         :     :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9403L,ss_item_sk#9404L,ss_customer_sk#9405L,ss_cdemo_sk#9406L,ss_hdemo_sk#9407L,ss_addr_sk#9408L,ss_store_sk#9409L,ss_promo_sk#9410L,ss_ticket_number#9411L,ss_quantity#9412,ss_wholesale_cost#9413,ss_list_price#9414,ss_sales_price#9415,ss_ext_discount_amt#9416,ss_ext_sales_price#9417,ss_ext_wholesale_cost#9418,ss_ext_list_price#9419,ss_ext_tax#9420,ss_coupon_amt#9421,ss_net_paid#9422,ss_net_paid_inc_tax#9423,ss_net_profit#9424,ss_sold_date_sk#9425L] orc
         :     :                    :     +- Project [d_date_sk#9426L, d_date#9428]
         :     :                    :        +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
         :     :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date_id#9427,d_date#9428,d_month_seq#9429,d_week_seq#9430,d_quarter_seq#9431,d_year#9432,d_dow#9433,d_moy#9434,d_dom#9435,d_qoy#9436,d_fy_year#9437,d_fy_quarter_seq#9438,d_fy_week_seq#9439,d_day_name#9440,d_quarter_name#9441,d_holiday#9442,d_weekend#9443,d_following_holiday#9444,d_first_dom#9445,d_last_dom#9446,d_same_day_ly#9447,d_same_day_lq#9448,d_current_day#9449,... 4 more fields] orc
         :     :                    +- Project [i_item_sk#9454L, i_item_desc#9458]
         :     :                       +- Filter isnotnull(i_item_sk#9454L)
         :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9454L,i_item_id#9455,i_rec_start_date#9456,i_rec_end_date#9457,i_item_desc#9458,i_current_price#9459,i_wholesale_cost#9460,i_brand_id#9461,i_brand#9462,i_class_id#9463,i_class#9464,i_category_id#9465,i_category#9466,i_manufact_id#9467,i_manufact#9468,i_size#9469,i_formulation#9470,i_color#9471,i_units#9472,i_container#9473,i_manager_id#9474,i_product_name#9475] orc
         :     +- Project [c_customer_sk#9568L]
         :        +- Filter (isnotnull(ssales#9399) AND (ssales#9399 > (0.95 * scalar-subquery#9400 [])))
         :           :  +- Aggregate [max(csales#9397) AS tpcds_cmax#9398]
         :           :     +- Aggregate [c_customer_sk#9499L], [sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488)) AS csales#9397]
         :           :        +- Project [ss_quantity#9485, ss_sales_price#9488, c_customer_sk#9499L]
         :           :           +- Join Inner, (ss_customer_sk#9478L = c_customer_sk#9499L)
         :           :              :- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488]
         :           :              :  +- Join Inner, (ss_sold_date_sk#9498L = d_date_sk#9517L)
         :           :              :     :- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488, ss_sold_date_sk#9498L]
         :           :              :     :  +- Filter ((isnotnull(ss_customer_sk#9478L) AND isnotnull(ss_sold_date_sk#9498L)) AND dynamicpruning#9727 [ss_sold_date_sk#9498L])
         :           :              :     :     :  +- Project [d_date_sk#9517L]
         :           :              :     :     :     +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
         :           :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_date_id#9518,d_date#9519,d_month_seq#9520,d_week_seq#9521,d_quarter_seq#9522,d_year#9523,d_dow#9524,d_moy#9525,d_dom#9526,d_qoy#9527,d_fy_year#9528,d_fy_quarter_seq#9529,d_fy_week_seq#9530,d_day_name#9531,d_quarter_name#9532,d_holiday#9533,d_weekend#9534,d_following_holiday#9535,d_first_dom#9536,d_last_dom#9537,d_same_day_ly#9538,d_same_day_lq#9539,d_current_day#9540,... 4 more fields] orc
         :           :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9476L,ss_item_sk#9477L,ss_customer_sk#9478L,ss_cdemo_sk#9479L,ss_hdemo_sk#9480L,ss_addr_sk#9481L,ss_store_sk#9482L,ss_promo_sk#9483L,ss_ticket_number#9484L,ss_quantity#9485,ss_wholesale_cost#9486,ss_list_price#9487,ss_sales_price#9488,ss_ext_discount_amt#9489,ss_ext_sales_price#9490,ss_ext_wholesale_cost#9491,ss_ext_list_price#9492,ss_ext_tax#9493,ss_coupon_amt#9494,ss_net_paid#9495,ss_net_paid_inc_tax#9496,ss_net_profit#9497,ss_sold_date_sk#9498L] orc
         :           :              :     +- Project [d_date_sk#9517L]
         :           :              :        +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
         :           :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_date_id#9518,d_date#9519,d_month_seq#9520,d_week_seq#9521,d_quarter_seq#9522,d_year#9523,d_dow#9524,d_moy#9525,d_dom#9526,d_qoy#9527,d_fy_year#9528,d_fy_quarter_seq#9529,d_fy_week_seq#9530,d_day_name#9531,d_quarter_name#9532,d_holiday#9533,d_weekend#9534,d_following_holiday#9535,d_first_dom#9536,d_last_dom#9537,d_same_day_ly#9538,d_same_day_lq#9539,d_current_day#9540,... 4 more fields] orc
         :           :              +- Project [c_customer_sk#9499L]
         :           :                 +- Filter isnotnull(c_customer_sk#9499L)
         :           :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9499L,c_customer_id#9500,c_current_cdemo_sk#9501L,c_current_hdemo_sk#9502L,c_current_addr_sk#9503L,c_first_shipto_date_sk#9504L,c_first_sales_date_sk#9505L,c_salutation#9506,c_first_name#9507,c_last_name#9508,c_preferred_cust_flag#9509,c_birth_day#9510,c_birth_month#9511,c_birth_year#9512,c_birth_country#9513,c_login#9514,c_email_address#9515,c_last_review_date#9516] orc
         :           +- Aggregate [c_customer_sk#9568L], [c_customer_sk#9568L, sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557)) AS ssales#9399]
         :              +- Project [ss_quantity#9554, ss_sales_price#9557, c_customer_sk#9568L]
         :                 +- Join Inner, (ss_customer_sk#9547L = c_customer_sk#9568L)
         :                    :- Project [ss_customer_sk#9547L, ss_quantity#9554, ss_sales_price#9557]
         :                    :  +- Filter isnotnull(ss_customer_sk#9547L)
         :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9545L,ss_item_sk#9546L,ss_customer_sk#9547L,ss_cdemo_sk#9548L,ss_hdemo_sk#9549L,ss_addr_sk#9550L,ss_store_sk#9551L,ss_promo_sk#9552L,ss_ticket_number#9553L,ss_quantity#9554,ss_wholesale_cost#9555,ss_list_price#9556,ss_sales_price#9557,ss_ext_discount_amt#9558,ss_ext_sales_price#9559,ss_ext_wholesale_cost#9560,ss_ext_list_price#9561,ss_ext_tax#9562,ss_coupon_amt#9563,ss_net_paid#9564,ss_net_paid_inc_tax#9565,ss_net_profit#9566,ss_sold_date_sk#9567L] orc
         :                    +- Project [c_customer_sk#9568L]
         :                       +- Filter isnotnull(c_customer_sk#9568L)
         :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9568L,c_customer_id#9569,c_current_cdemo_sk#9570L,c_current_hdemo_sk#9571L,c_current_addr_sk#9572L,c_first_shipto_date_sk#9573L,c_first_sales_date_sk#9574L,c_salutation#9575,c_first_name#9576,c_last_name#9577,c_preferred_cust_flag#9578,c_birth_day#9579,c_birth_month#9580,c_birth_year#9581,c_birth_country#9582,c_login#9583,c_email_address#9584,c_last_review_date#9585] orc
         +- Project [d_date_sk#9682L]
            +- Filter (((isnotnull(d_year#9688) AND isnotnull(d_moy#9690)) AND ((d_year#9688 = 1999) AND (d_moy#9690 = 1))) AND isnotnull(d_date_sk#9682L))
               +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9682L,d_date_id#9683,d_date#9684,d_month_seq#9685,d_week_seq#9686,d_quarter_seq#9687,d_year#9688,d_dow#9689,d_moy#9690,d_dom#9691,d_qoy#9692,d_fy_year#9693,d_fy_quarter_seq#9694,d_fy_week_seq#9695,d_day_name#9696,d_quarter_name#9697,d_holiday#9698,d_weekend#9699,d_following_holiday#9700,d_first_dom#9701,d_last_dom#9702,d_same_day_ly#9703,d_same_day_lq#9704,d_current_day#9705,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(sales#9387)], output=[sum(sales)#9720])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#9602]
      +- HashAggregate(keys=[], functions=[partial_sum(sales#9387)], output=[sum#9733])
         +- Union
            :- Project [(cast(cs_quantity#9603 as double) * cs_list_price#9605) AS sales#9387]
            :  +- BroadcastHashJoin [cs_sold_date_sk#9619L], [d_date_sk#9620L], Inner, BuildRight, false
            :     :- Project [cs_quantity#9603, cs_list_price#9605, cs_sold_date_sk#9619L]
            :     :  +- SortMergeJoin [cs_bill_customer_sk#9588L], [c_customer_sk#9568L], LeftSemi
            :     :     :- Sort [cs_bill_customer_sk#9588L ASC NULLS FIRST], false, 0
            :     :     :  +- Exchange hashpartitioning(cs_bill_customer_sk#9588L, 3000), ENSURE_REQUIREMENTS, [id=#9546]
            :     :     :     +- Project [cs_bill_customer_sk#9588L, cs_quantity#9603, cs_list_price#9605, cs_sold_date_sk#9619L]
            :     :     :        +- SortMergeJoin [cs_item_sk#9600L], [item_sk#9394L], LeftSemi
            :     :     :           :- Sort [cs_item_sk#9600L ASC NULLS FIRST], false, 0
            :     :     :           :  +- Exchange hashpartitioning(cs_item_sk#9600L, 3000), ENSURE_REQUIREMENTS, [id=#9528]
            :     :     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#9588L,cs_item_sk#9600L,cs_quantity#9603,cs_list_price#9605,cs_sold_date_sk#9619L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#9619L), dynamicpruningexpression(cs_sold_date_sk#9619L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_quantity:int,cs_list_price:double>
            :     :     :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#9729, 0, true, Project [d_date_sk#9620L], [d_date_sk#9620L]
            :     :     :           :              +- AdaptiveSparkPlan isFinalPlan=false
            :     :     :           :                 +- Project [d_date_sk#9620L]
            :     :     :           :                    +- Filter ((((isnotnull(d_year#9626) AND isnotnull(d_moy#9628)) AND (d_year#9626 = 1999)) AND (d_moy#9628 = 1)) AND isnotnull(d_date_sk#9620L))
            :     :     :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9620L,d_year#9626,d_moy#9628] Batched: true, DataFilters: [isnotnull(d_year#9626), isnotnull(d_moy#9628), (d_year#9626 = 1999), (d_moy#9628 = 1), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
            :     :     :           +- Sort [item_sk#9394L ASC NULLS FIRST], false, 0
            :     :     :              +- Project [item_sk#9394L]
            :     :     :                 +- Filter (cnt#9396L > 4)
            :     :     :                    +- HashAggregate(keys=[_groupingexpression#9722, i_item_sk#9454L, d_date#9428], functions=[count(1)], output=[item_sk#9394L, cnt#9396L])
            :     :     :                       +- HashAggregate(keys=[_groupingexpression#9722, i_item_sk#9454L, d_date#9428], functions=[partial_count(1)], output=[_groupingexpression#9722, i_item_sk#9454L, d_date#9428, count#9735L])
            :     :     :                          +- Project [d_date#9428, i_item_sk#9454L, substr(i_item_desc#9458, 1, 30) AS _groupingexpression#9722]
            :     :     :                             +- SortMergeJoin [ss_item_sk#9404L], [i_item_sk#9454L], Inner
            :     :     :                                :- Sort [ss_item_sk#9404L ASC NULLS FIRST], false, 0
            :     :     :                                :  +- Exchange hashpartitioning(ss_item_sk#9404L, 3000), ENSURE_REQUIREMENTS, [id=#9516]
            :     :     :                                :     +- Project [ss_item_sk#9404L, d_date#9428]
            :     :     :                                :        +- BroadcastHashJoin [ss_sold_date_sk#9425L], [d_date_sk#9426L], Inner, BuildRight, false
            :     :     :                                :           :- Filter isnotnull(ss_item_sk#9404L)
            :     :     :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#9404L,ss_sold_date_sk#9425L] Batched: true, DataFilters: [isnotnull(ss_item_sk#9404L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9425L), dynamicpruningexpression(ss_sold_date_sk#9425L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
            :     :     :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#9723, 0, true, Project [d_date_sk#9426L, d_date#9428], [d_date_sk#9426L]
            :     :     :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
            :     :     :                                :           :              +- Project [d_date_sk#9426L, d_date#9428]
            :     :     :                                :           :                 +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
            :     :     :                                :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date#9428,d_year#9432] Batched: true, DataFilters: [d_year#9432 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9426L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
            :     :     :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9511]
            :     :     :                                :              +- Project [d_date_sk#9426L, d_date#9428]
            :     :     :                                :                 +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
            :     :     :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date#9428,d_year#9432] Batched: true, DataFilters: [d_year#9432 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9426L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
            :     :     :                                +- Sort [i_item_sk#9454L ASC NULLS FIRST], false, 0
            :     :     :                                   +- Exchange hashpartitioning(i_item_sk#9454L, 3000), ENSURE_REQUIREMENTS, [id=#9517]
            :     :     :                                      +- Filter isnotnull(i_item_sk#9454L)
            :     :     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9454L,i_item_desc#9458] Batched: true, DataFilters: [isnotnull(i_item_sk#9454L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string>
            :     :     +- Sort [c_customer_sk#9568L ASC NULLS FIRST], false, 0
            :     :        +- Project [c_customer_sk#9568L]
            :     :           +- Filter (isnotnull(ssales#9399) AND (ssales#9399 > (0.95 * Subquery subquery#9400, [id=#9411])))
            :     :              :  +- Subquery subquery#9400, [id=#9411]
            :     :              :     +- AdaptiveSparkPlan isFinalPlan=false
            :     :              :        +- HashAggregate(keys=[], functions=[max(csales#9397)], output=[tpcds_cmax#9398])
            :     :              :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#9409]
            :     :              :              +- HashAggregate(keys=[], functions=[partial_max(csales#9397)], output=[max#9739])
            :     :              :                 +- HashAggregate(keys=[c_customer_sk#9499L], functions=[sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488))], output=[csales#9397])
            :     :              :                    +- HashAggregate(keys=[c_customer_sk#9499L], functions=[partial_sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488))], output=[c_customer_sk#9499L, sum#9741])
            :     :              :                       +- Project [ss_quantity#9485, ss_sales_price#9488, c_customer_sk#9499L]
            :     :              :                          +- SortMergeJoin [ss_customer_sk#9478L], [c_customer_sk#9499L], Inner
            :     :              :                             :- Sort [ss_customer_sk#9478L ASC NULLS FIRST], false, 0
            :     :              :                             :  +- Exchange hashpartitioning(ss_customer_sk#9478L, 3000), ENSURE_REQUIREMENTS, [id=#9399]
            :     :              :                             :     +- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488]
            :     :              :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9498L], [d_date_sk#9517L], Inner, BuildRight, false
            :     :              :                             :           :- Filter isnotnull(ss_customer_sk#9478L)
            :     :              :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9478L,ss_quantity#9485,ss_sales_price#9488,ss_sold_date_sk#9498L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9478L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9498L), dynamicpruningexpression(ss_sold_date_sk#9498L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
            :     :              :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#9724, 0, true, Project [d_date_sk#9517L], [d_date_sk#9517L]
            :     :              :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
            :     :              :                             :           :              +- Project [d_date_sk#9517L]
            :     :              :                             :           :                 +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
            :     :              :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_year#9523] Batched: true, DataFilters: [d_year#9523 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9517L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :     :              :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9394]
            :     :              :                             :              +- Project [d_date_sk#9517L]
            :     :              :                             :                 +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
            :     :              :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_year#9523] Batched: true, DataFilters: [d_year#9523 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9517L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :     :              :                             +- Sort [c_customer_sk#9499L ASC NULLS FIRST], false, 0
            :     :              :                                +- Exchange hashpartitioning(c_customer_sk#9499L, 3000), ENSURE_REQUIREMENTS, [id=#9400]
            :     :              :                                   +- Filter isnotnull(c_customer_sk#9499L)
            :     :              :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9499L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9499L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
            :     :              +- HashAggregate(keys=[c_customer_sk#9568L], functions=[sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557))], output=[c_customer_sk#9568L, ssales#9399])
            :     :                 +- HashAggregate(keys=[c_customer_sk#9568L], functions=[partial_sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557))], output=[c_customer_sk#9568L, sum#9737])
            :     :                    +- Project [ss_quantity#9554, ss_sales_price#9557, c_customer_sk#9568L]
            :     :                       +- SortMergeJoin [ss_customer_sk#9547L], [c_customer_sk#9568L], Inner
            :     :                          :- Sort [ss_customer_sk#9547L ASC NULLS FIRST], false, 0
            :     :                          :  +- Exchange hashpartitioning(ss_customer_sk#9547L, 3000), ENSURE_REQUIREMENTS, [id=#9534]
            :     :                          :     +- Project [ss_customer_sk#9547L, ss_quantity#9554, ss_sales_price#9557]
            :     :                          :        +- Filter isnotnull(ss_customer_sk#9547L)
            :     :                          :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9547L,ss_quantity#9554,ss_sales_price#9557,ss_sold_date_sk#9567L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9547L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
            :     :                          +- Sort [c_customer_sk#9568L ASC NULLS FIRST], false, 0
            :     :                             +- Exchange hashpartitioning(c_customer_sk#9568L, 3000), ENSURE_REQUIREMENTS, [id=#9535]
            :     :                                +- Filter isnotnull(c_customer_sk#9568L)
            :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9568L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9568L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
            :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9552]
            :        +- Project [d_date_sk#9620L]
            :           +- Filter ((((isnotnull(d_year#9626) AND isnotnull(d_moy#9628)) AND (d_year#9626 = 1999)) AND (d_moy#9628 = 1)) AND isnotnull(d_date_sk#9620L))
            :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9620L,d_year#9626,d_moy#9628] Batched: true, DataFilters: [isnotnull(d_year#9626), isnotnull(d_moy#9628), (d_year#9626 = 1999), (d_moy#9628 = 1), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
            +- Project [(cast(ws_quantity#9665 as double) * ws_list_price#9667) AS sales#9390]
               +- BroadcastHashJoin [ws_sold_date_sk#9681L], [d_date_sk#9682L], Inner, BuildRight, false
                  :- Project [ws_quantity#9665, ws_list_price#9667, ws_sold_date_sk#9681L]
                  :  +- SortMergeJoin [ws_bill_customer_sk#9651L], [c_customer_sk#9568L], LeftSemi
                  :     :- Sort [ws_bill_customer_sk#9651L ASC NULLS FIRST], false, 0
                  :     :  +- Exchange hashpartitioning(ws_bill_customer_sk#9651L, 3000), ENSURE_REQUIREMENTS, [id=#9590]
                  :     :     +- Project [ws_bill_customer_sk#9651L, ws_quantity#9665, ws_list_price#9667, ws_sold_date_sk#9681L]
                  :     :        +- SortMergeJoin [ws_item_sk#9650L], [item_sk#9394L], LeftSemi
                  :     :           :- Sort [ws_item_sk#9650L ASC NULLS FIRST], false, 0
                  :     :           :  +- Exchange hashpartitioning(ws_item_sk#9650L, 3000), ENSURE_REQUIREMENTS, [id=#9572]
                  :     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#9650L,ws_bill_customer_sk#9651L,ws_quantity#9665,ws_list_price#9667,ws_sold_date_sk#9681L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#9681L), dynamicpruningexpression(ws_sold_date_sk#9681L IN dynamicpruni..., PushedFilters: [], ReadSchema: struct<ws_item_sk:bigint,ws_bill_customer_sk:bigint,ws_quantity:int,ws_list_price:double>
                  :     :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#9731, 0, true, Project [d_date_sk#9682L], [d_date_sk#9682L]
                  :     :           :              +- AdaptiveSparkPlan isFinalPlan=false
                  :     :           :                 +- Project [d_date_sk#9682L]
                  :     :           :                    +- Filter ((((isnotnull(d_year#9688) AND isnotnull(d_moy#9690)) AND (d_year#9688 = 1999)) AND (d_moy#9690 = 1)) AND isnotnull(d_date_sk#9682L))
                  :     :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9682L,d_year#9688,d_moy#9690] Batched: true, DataFilters: [isnotnull(d_year#9688), isnotnull(d_moy#9690), (d_year#9688 = 1999), (d_moy#9690 = 1), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     :           +- Sort [item_sk#9394L ASC NULLS FIRST], false, 0
                  :     :              +- Project [item_sk#9394L]
                  :     :                 +- Filter (cnt#9396L > 4)
                  :     :                    +- HashAggregate(keys=[_groupingexpression#9725, i_item_sk#9454L, d_date#9428], functions=[count(1)], output=[item_sk#9394L, cnt#9396L])
                  :     :                       +- HashAggregate(keys=[_groupingexpression#9725, i_item_sk#9454L, d_date#9428], functions=[partial_count(1)], output=[_groupingexpression#9725, i_item_sk#9454L, d_date#9428, count#9735L])
                  :     :                          +- Project [d_date#9428, i_item_sk#9454L, substr(i_item_desc#9458, 1, 30) AS _groupingexpression#9725]
                  :     :                             +- SortMergeJoin [ss_item_sk#9404L], [i_item_sk#9454L], Inner
                  :     :                                :- Sort [ss_item_sk#9404L ASC NULLS FIRST], false, 0
                  :     :                                :  +- Exchange hashpartitioning(ss_item_sk#9404L, 3000), ENSURE_REQUIREMENTS, [id=#9560]
                  :     :                                :     +- Project [ss_item_sk#9404L, d_date#9428]
                  :     :                                :        +- BroadcastHashJoin [ss_sold_date_sk#9425L], [d_date_sk#9426L], Inner, BuildRight, false
                  :     :                                :           :- Filter isnotnull(ss_item_sk#9404L)
                  :     :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#9404L,ss_sold_date_sk#9425L] Batched: true, DataFilters: [isnotnull(ss_item_sk#9404L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9425L), dynamicpruningexpression(ss_sold_date_sk#9425L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                  :     :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#9726, 0, true, Project [d_date_sk#9426L, d_date#9428], [d_date_sk#9426L]
                  :     :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :                                :           :              +- Project [d_date_sk#9426L, d_date#9428]
                  :     :                                :           :                 +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
                  :     :                                :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date#9428,d_year#9432] Batched: true, DataFilters: [d_year#9432 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9426L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
                  :     :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9555]
                  :     :                                :              +- Project [d_date_sk#9426L, d_date#9428]
                  :     :                                :                 +- Filter (d_year#9432 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9426L))
                  :     :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9426L,d_date#9428,d_year#9432] Batched: true, DataFilters: [d_year#9432 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9426L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
                  :     :                                +- Sort [i_item_sk#9454L ASC NULLS FIRST], false, 0
                  :     :                                   +- Exchange hashpartitioning(i_item_sk#9454L, 3000), ENSURE_REQUIREMENTS, [id=#9561]
                  :     :                                      +- Filter isnotnull(i_item_sk#9454L)
                  :     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9454L,i_item_desc#9458] Batched: true, DataFilters: [isnotnull(i_item_sk#9454L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string>
                  :     +- Sort [c_customer_sk#9568L ASC NULLS FIRST], false, 0
                  :        +- Project [c_customer_sk#9568L]
                  :           +- Filter (isnotnull(ssales#9399) AND (ssales#9399 > (0.95 * Subquery subquery#9400, [id=#9411])))
                  :              :  +- Subquery subquery#9400, [id=#9411]
                  :              :     +- AdaptiveSparkPlan isFinalPlan=false
                  :              :        +- HashAggregate(keys=[], functions=[max(csales#9397)], output=[tpcds_cmax#9398])
                  :              :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#9409]
                  :              :              +- HashAggregate(keys=[], functions=[partial_max(csales#9397)], output=[max#9739])
                  :              :                 +- HashAggregate(keys=[c_customer_sk#9499L], functions=[sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488))], output=[csales#9397])
                  :              :                    +- HashAggregate(keys=[c_customer_sk#9499L], functions=[partial_sum((cast(ss_quantity#9485 as double) * ss_sales_price#9488))], output=[c_customer_sk#9499L, sum#9741])
                  :              :                       +- Project [ss_quantity#9485, ss_sales_price#9488, c_customer_sk#9499L]
                  :              :                          +- SortMergeJoin [ss_customer_sk#9478L], [c_customer_sk#9499L], Inner
                  :              :                             :- Sort [ss_customer_sk#9478L ASC NULLS FIRST], false, 0
                  :              :                             :  +- Exchange hashpartitioning(ss_customer_sk#9478L, 3000), ENSURE_REQUIREMENTS, [id=#9399]
                  :              :                             :     +- Project [ss_customer_sk#9478L, ss_quantity#9485, ss_sales_price#9488]
                  :              :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9498L], [d_date_sk#9517L], Inner, BuildRight, false
                  :              :                             :           :- Filter isnotnull(ss_customer_sk#9478L)
                  :              :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9478L,ss_quantity#9485,ss_sales_price#9488,ss_sold_date_sk#9498L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9478L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9498L), dynamicpruningexpression(ss_sold_date_sk#9498L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                  :              :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#9724, 0, true, Project [d_date_sk#9517L], [d_date_sk#9517L]
                  :              :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :              :                             :           :              +- Project [d_date_sk#9517L]
                  :              :                             :           :                 +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
                  :              :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_year#9523] Batched: true, DataFilters: [d_year#9523 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9517L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :              :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9394]
                  :              :                             :              +- Project [d_date_sk#9517L]
                  :              :                             :                 +- Filter (d_year#9523 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9517L))
                  :              :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9517L,d_year#9523] Batched: true, DataFilters: [d_year#9523 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9517L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :              :                             +- Sort [c_customer_sk#9499L ASC NULLS FIRST], false, 0
                  :              :                                +- Exchange hashpartitioning(c_customer_sk#9499L, 3000), ENSURE_REQUIREMENTS, [id=#9400]
                  :              :                                   +- Filter isnotnull(c_customer_sk#9499L)
                  :              :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9499L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9499L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
                  :              +- HashAggregate(keys=[c_customer_sk#9568L], functions=[sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557))], output=[c_customer_sk#9568L, ssales#9399])
                  :                 +- HashAggregate(keys=[c_customer_sk#9568L], functions=[partial_sum((cast(ss_quantity#9554 as double) * ss_sales_price#9557))], output=[c_customer_sk#9568L, sum#9737])
                  :                    +- Project [ss_quantity#9554, ss_sales_price#9557, c_customer_sk#9568L]
                  :                       +- SortMergeJoin [ss_customer_sk#9547L], [c_customer_sk#9568L], Inner
                  :                          :- Sort [ss_customer_sk#9547L ASC NULLS FIRST], false, 0
                  :                          :  +- Exchange hashpartitioning(ss_customer_sk#9547L, 3000), ENSURE_REQUIREMENTS, [id=#9578]
                  :                          :     +- Project [ss_customer_sk#9547L, ss_quantity#9554, ss_sales_price#9557]
                  :                          :        +- Filter isnotnull(ss_customer_sk#9547L)
                  :                          :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9547L,ss_quantity#9554,ss_sales_price#9557,ss_sold_date_sk#9567L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9547L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                  :                          +- Sort [c_customer_sk#9568L ASC NULLS FIRST], false, 0
                  :                             +- Exchange hashpartitioning(c_customer_sk#9568L, 3000), ENSURE_REQUIREMENTS, [id=#9579]
                  :                                +- Filter isnotnull(c_customer_sk#9568L)
                  :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9568L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9568L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#9596]
                     +- Project [d_date_sk#9682L]
                        +- Filter ((((isnotnull(d_year#9688) AND isnotnull(d_moy#9690)) AND (d_year#9688 = 1999)) AND (d_moy#9690 = 1)) AND isnotnull(d_date_sk#9682L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9682L,d_year#9688,d_moy#9690] Batched: true, DataFilters: [isnotnull(d_year#9688), isnotnull(d_moy#9690), (d_year#9688 = 1999), (d_moy#9690 = 1), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q23b.sql
explain query: q23b
== Parsed Logical Plan ==
CTE [frequent_ss_items, max_store_sales, best_ss_customer]
:  :- 'SubqueryAlias frequent_ss_items
:  :  +- 'UnresolvedHaving ('count(1) > 4)
:  :     +- 'Aggregate ['substr('i_item_desc, 1, 30), 'i_item_sk, 'd_date], ['substr('i_item_desc, 1, 30) AS itemdesc#9748, 'i_item_sk AS item_sk#9749, 'd_date AS solddate#9750, 'count(1) AS cnt#9751]
:  :        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND 'd_year IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:  :           +- 'Join Inner
:  :              :- 'Join Inner
:  :              :  :- 'UnresolvedRelation [store_sales], [], false
:  :              :  +- 'UnresolvedRelation [date_dim], [], false
:  :              +- 'UnresolvedRelation [item], [], false
:  :- 'SubqueryAlias max_store_sales
:  :  +- 'Project ['max('csales) AS tpcds_cmax#9753]
:  :     +- 'SubqueryAlias x
:  :        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS csales#9752]
:  :           +- 'Filter ((('ss_customer_sk = 'c_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND 'd_year IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:  :              +- 'Join Inner
:  :                 :- 'Join Inner
:  :                 :  :- 'UnresolvedRelation [store_sales], [], false
:  :                 :  +- 'UnresolvedRelation [customer], [], false
:  :                 +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias best_ss_customer
:     +- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_sales_price)) > ((95 / 100.0) * scalar-subquery#9755 []))
:        :  +- 'Project [*]
:        :     +- 'UnresolvedRelation [max_store_sales], [], false
:        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS ssales#9754]
:           +- 'Filter ('ss_customer_sk = 'c_customer_sk)
:              +- 'Join Inner
:                 :- 'UnresolvedRelation [store_sales], [], false
:                 +- 'UnresolvedRelation [customer], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'sales ASC NULLS FIRST], true
         +- 'Project ['c_last_name, 'c_first_name, 'sales]
            +- 'SubqueryAlias y
               +- 'Union false, false
                  :- 'Aggregate ['c_last_name, 'c_first_name], ['c_last_name, 'c_first_name, 'sum(('cs_quantity * 'cs_list_price)) AS sales#9742]
                  :  +- 'Filter (((('d_year = 1999) AND ('d_moy = 1)) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('cs_item_sk IN (list#9743 []) AND 'cs_bill_customer_sk IN (list#9744 [])) AND ('cs_bill_customer_sk = 'c_customer_sk)))
                  :     :  :- 'Project ['item_sk]
                  :     :  :  +- 'UnresolvedRelation [frequent_ss_items], [], false
                  :     :  +- 'Project ['c_customer_sk]
                  :     :     +- 'UnresolvedRelation [best_ss_customer], [], false
                  :     +- 'Join Inner
                  :        :- 'Join Inner
                  :        :  :- 'UnresolvedRelation [catalog_sales], [], false
                  :        :  +- 'UnresolvedRelation [customer], [], false
                  :        +- 'UnresolvedRelation [date_dim], [], false
                  +- 'Aggregate ['c_last_name, 'c_first_name], ['c_last_name, 'c_first_name, 'sum(('ws_quantity * 'ws_list_price)) AS sales#9745]
                     +- 'Filter (((('d_year = 1999) AND ('d_moy = 1)) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('ws_item_sk IN (list#9746 []) AND 'ws_bill_customer_sk IN (list#9747 [])) AND ('ws_bill_customer_sk = 'c_customer_sk)))
                        :  :- 'Project ['item_sk]
                        :  :  +- 'UnresolvedRelation [frequent_ss_items], [], false
                        :  +- 'Project ['c_customer_sk]
                        :     +- 'UnresolvedRelation [best_ss_customer], [], false
                        +- 'Join Inner
                           :- 'Join Inner
                           :  :- 'UnresolvedRelation [web_sales], [], false
                           :  +- 'UnresolvedRelation [customer], [], false
                           +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, sales: double
WithCTE
:- CTERelationDef 15
:  +- SubqueryAlias frequent_ss_items
:     +- Filter (cnt#9751L > cast(4 as bigint))
:        +- Aggregate [substr(i_item_desc#9813, 1, 30), i_item_sk#9809L, d_date#9783], [substr(i_item_desc#9813, 1, 30) AS itemdesc#9748, i_item_sk#9809L AS item_sk#9749L, d_date#9783 AS solddate#9750, count(1) AS cnt#9751L]
:           +- Filter (((ss_sold_date_sk#9780L = d_date_sk#9781L) AND (ss_item_sk#9759L = i_item_sk#9809L)) AND d_year#9787 IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9758L,ss_item_sk#9759L,ss_customer_sk#9760L,ss_cdemo_sk#9761L,ss_hdemo_sk#9762L,ss_addr_sk#9763L,ss_store_sk#9764L,ss_promo_sk#9765L,ss_ticket_number#9766L,ss_quantity#9767,ss_wholesale_cost#9768,ss_list_price#9769,ss_sales_price#9770,ss_ext_discount_amt#9771,ss_ext_sales_price#9772,ss_ext_wholesale_cost#9773,ss_ext_list_price#9774,ss_ext_tax#9775,ss_coupon_amt#9776,ss_net_paid#9777,ss_net_paid_inc_tax#9778,ss_net_profit#9779,ss_sold_date_sk#9780L] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date_id#9782,d_date#9783,d_month_seq#9784,d_week_seq#9785,d_quarter_seq#9786,d_year#9787,d_dow#9788,d_moy#9789,d_dom#9790,d_qoy#9791,d_fy_year#9792,d_fy_quarter_seq#9793,d_fy_week_seq#9794,d_day_name#9795,d_quarter_name#9796,d_holiday#9797,d_weekend#9798,d_following_holiday#9799,d_first_dom#9800,d_last_dom#9801,d_same_day_ly#9802,d_same_day_lq#9803,d_current_day#9804,... 4 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9809L,i_item_id#9810,i_rec_start_date#9811,i_rec_end_date#9812,i_item_desc#9813,i_current_price#9814,i_wholesale_cost#9815,i_brand_id#9816,i_brand#9817,i_class_id#9818,i_class#9819,i_category_id#9820,i_category#9821,i_manufact_id#9822,i_manufact#9823,i_size#9824,i_formulation#9825,i_color#9826,i_units#9827,i_container#9828,i_manager_id#9829,i_product_name#9830] orc
:- CTERelationDef 16
:  +- SubqueryAlias max_store_sales
:     +- Aggregate [max(csales#9752) AS tpcds_cmax#9753]
:        +- SubqueryAlias x
:           +- Aggregate [c_customer_sk#9854L], [c_customer_sk#9854L, sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843)) AS csales#9752]
:              +- Filter (((ss_customer_sk#9833L = c_customer_sk#9854L) AND (ss_sold_date_sk#9853L = d_date_sk#9872L)) AND d_year#9878 IN (1999,(1999 + 1),(1999 + 2),(1999 + 3)))
:                 +- Join Inner
:                    :- Join Inner
:                    :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                    :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9831L,ss_item_sk#9832L,ss_customer_sk#9833L,ss_cdemo_sk#9834L,ss_hdemo_sk#9835L,ss_addr_sk#9836L,ss_store_sk#9837L,ss_promo_sk#9838L,ss_ticket_number#9839L,ss_quantity#9840,ss_wholesale_cost#9841,ss_list_price#9842,ss_sales_price#9843,ss_ext_discount_amt#9844,ss_ext_sales_price#9845,ss_ext_wholesale_cost#9846,ss_ext_list_price#9847,ss_ext_tax#9848,ss_coupon_amt#9849,ss_net_paid#9850,ss_net_paid_inc_tax#9851,ss_net_profit#9852,ss_sold_date_sk#9853L] orc
:                    :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L,c_customer_id#9855,c_current_cdemo_sk#9856L,c_current_hdemo_sk#9857L,c_current_addr_sk#9858L,c_first_shipto_date_sk#9859L,c_first_sales_date_sk#9860L,c_salutation#9861,c_first_name#9862,c_last_name#9863,c_preferred_cust_flag#9864,c_birth_day#9865,c_birth_month#9866,c_birth_year#9867,c_birth_country#9868,c_login#9869,c_email_address#9870,c_last_review_date#9871] orc
:                    +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
:- CTERelationDef 17
:  +- SubqueryAlias best_ss_customer
:     +- Filter (ssales#9754 > (cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6), true) as double) * scalar-subquery#9755 []))
:        :  +- Project [tpcds_cmax#9753]
:        :     +- SubqueryAlias max_store_sales
:        :        +- CTERelationRef 16, true, [tpcds_cmax#9753]
:        +- Aggregate [c_customer_sk#9923L], [c_customer_sk#9923L, sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912)) AS ssales#9754]
:           +- Filter (ss_customer_sk#9902L = c_customer_sk#9923L)
:              +- Join Inner
:                 :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9900L,ss_item_sk#9901L,ss_customer_sk#9902L,ss_cdemo_sk#9903L,ss_hdemo_sk#9904L,ss_addr_sk#9905L,ss_store_sk#9906L,ss_promo_sk#9907L,ss_ticket_number#9908L,ss_quantity#9909,ss_wholesale_cost#9910,ss_list_price#9911,ss_sales_price#9912,ss_ext_discount_amt#9913,ss_ext_sales_price#9914,ss_ext_wholesale_cost#9915,ss_ext_list_price#9916,ss_ext_tax#9917,ss_coupon_amt#9918,ss_net_paid#9919,ss_net_paid_inc_tax#9920,ss_net_profit#9921,ss_sold_date_sk#9922L] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L,c_customer_id#9924,c_current_cdemo_sk#9925L,c_current_hdemo_sk#9926L,c_current_addr_sk#9927L,c_first_shipto_date_sk#9928L,c_first_sales_date_sk#9929L,c_salutation#9930,c_first_name#9931,c_last_name#9932,c_preferred_cust_flag#9933,c_birth_day#9934,c_birth_month#9935,c_birth_year#9936,c_birth_country#9937,c_login#9938,c_email_address#9939,c_last_review_date#9940] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [c_last_name#9984 ASC NULLS FIRST, c_first_name#9983 ASC NULLS FIRST, sales#9742 ASC NULLS FIRST], true
         +- Project [c_last_name#9984, c_first_name#9983, sales#9742]
            +- SubqueryAlias y
               +- Union false, false
                  :- Aggregate [c_last_name#9984, c_first_name#9983], [c_last_name#9984, c_first_name#9983, sum((cast(cs_quantity#9958 as double) * cs_list_price#9960)) AS sales#9742]
                  :  +- Filter ((((d_year#9999 = 1999) AND (d_moy#10001 = 1)) AND (cs_sold_date_sk#9974L = d_date_sk#9993L)) AND ((cs_item_sk#9955L IN (list#9743 []) AND cs_bill_customer_sk#9943L IN (list#9744 [])) AND (cs_bill_customer_sk#9943L = c_customer_sk#9975L)))
                  :     :  :- Project [item_sk#9749L]
                  :     :  :  +- SubqueryAlias frequent_ss_items
                  :     :  :     +- CTERelationRef 15, true, [itemdesc#9748, item_sk#9749L, solddate#9750, cnt#9751L]
                  :     :  +- Project [c_customer_sk#9923L]
                  :     :     +- SubqueryAlias best_ss_customer
                  :     :        +- CTERelationRef 17, true, [c_customer_sk#9923L, ssales#9754]
                  :     +- Join Inner
                  :        :- Join Inner
                  :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                  :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9941L,cs_ship_date_sk#9942L,cs_bill_customer_sk#9943L,cs_bill_cdemo_sk#9944L,cs_bill_hdemo_sk#9945L,cs_bill_addr_sk#9946L,cs_ship_customer_sk#9947L,cs_ship_cdemo_sk#9948L,cs_ship_hdemo_sk#9949L,cs_ship_addr_sk#9950L,cs_call_center_sk#9951L,cs_catalog_page_sk#9952L,cs_ship_mode_sk#9953L,cs_warehouse_sk#9954L,cs_item_sk#9955L,cs_promo_sk#9956L,cs_order_number#9957L,cs_quantity#9958,cs_wholesale_cost#9959,cs_list_price#9960,cs_sales_price#9961,cs_ext_discount_amt#9962,cs_ext_sales_price#9963,cs_ext_wholesale_cost#9964,... 10 more fields] orc
                  :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9975L,c_customer_id#9976,c_current_cdemo_sk#9977L,c_current_hdemo_sk#9978L,c_current_addr_sk#9979L,c_first_shipto_date_sk#9980L,c_first_sales_date_sk#9981L,c_salutation#9982,c_first_name#9983,c_last_name#9984,c_preferred_cust_flag#9985,c_birth_day#9986,c_birth_month#9987,c_birth_year#9988,c_birth_country#9989,c_login#9990,c_email_address#9991,c_last_review_date#9992] orc
                  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9993L,d_date_id#9994,d_date#9995,d_month_seq#9996,d_week_seq#9997,d_quarter_seq#9998,d_year#9999,d_dow#10000,d_moy#10001,d_dom#10002,d_qoy#10003,d_fy_year#10004,d_fy_quarter_seq#10005,d_fy_week_seq#10006,d_day_name#10007,d_quarter_name#10008,d_holiday#10009,d_weekend#10010,d_following_holiday#10011,d_first_dom#10012,d_last_dom#10013,d_same_day_ly#10014,d_same_day_lq#10015,d_current_day#10016,... 4 more fields] orc
                  +- Aggregate [c_last_name#10064, c_first_name#10063], [c_last_name#10064, c_first_name#10063, sum((cast(ws_quantity#10038 as double) * ws_list_price#10040)) AS sales#9745]
                     +- Filter ((((d_year#10079 = 1999) AND (d_moy#10081 = 1)) AND (ws_sold_date_sk#10054L = d_date_sk#10073L)) AND ((ws_item_sk#10023L IN (list#9746 []) AND ws_bill_customer_sk#10024L IN (list#9747 [])) AND (ws_bill_customer_sk#10024L = c_customer_sk#10055L)))
                        :  :- Project [item_sk#9749L]
                        :  :  +- SubqueryAlias frequent_ss_items
                        :  :     +- CTERelationRef 15, true, [itemdesc#9748, item_sk#9749L, solddate#9750, cnt#9751L]
                        :  +- Project [c_customer_sk#9923L]
                        :     +- SubqueryAlias best_ss_customer
                        :        +- CTERelationRef 17, true, [c_customer_sk#9923L, ssales#9754]
                        +- Join Inner
                           :- Join Inner
                           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#10021L,ws_ship_date_sk#10022L,ws_item_sk#10023L,ws_bill_customer_sk#10024L,ws_bill_cdemo_sk#10025L,ws_bill_hdemo_sk#10026L,ws_bill_addr_sk#10027L,ws_ship_customer_sk#10028L,ws_ship_cdemo_sk#10029L,ws_ship_hdemo_sk#10030L,ws_ship_addr_sk#10031L,ws_web_page_sk#10032L,ws_web_site_sk#10033L,ws_ship_mode_sk#10034L,ws_warehouse_sk#10035L,ws_promo_sk#10036L,ws_order_number#10037L,ws_quantity#10038,ws_wholesale_cost#10039,ws_list_price#10040,ws_sales_price#10041,ws_ext_discount_amt#10042,ws_ext_sales_price#10043,ws_ext_wholesale_cost#10044,... 10 more fields] orc
                           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10055L,c_customer_id#10056,c_current_cdemo_sk#10057L,c_current_hdemo_sk#10058L,c_current_addr_sk#10059L,c_first_shipto_date_sk#10060L,c_first_sales_date_sk#10061L,c_salutation#10062,c_first_name#10063,c_last_name#10064,c_preferred_cust_flag#10065,c_birth_day#10066,c_birth_month#10067,c_birth_year#10068,c_birth_country#10069,c_login#10070,c_email_address#10071,c_last_review_date#10072] orc
                           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10073L,d_date_id#10074,d_date#10075,d_month_seq#10076,d_week_seq#10077,d_quarter_seq#10078,d_year#10079,d_dow#10080,d_moy#10081,d_dom#10082,d_qoy#10083,d_fy_year#10084,d_fy_quarter_seq#10085,d_fy_week_seq#10086,d_day_name#10087,d_quarter_name#10088,d_holiday#10089,d_weekend#10090,d_following_holiday#10091,d_first_dom#10092,d_last_dom#10093,d_same_day_ly#10094,d_same_day_lq#10095,d_current_day#10096,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_last_name#9984 ASC NULLS FIRST, c_first_name#9983 ASC NULLS FIRST, sales#9742 ASC NULLS FIRST], true
      +- Union false, false
         :- Aggregate [c_last_name#9984, c_first_name#9983], [c_last_name#9984, c_first_name#9983, sum((cast(cs_quantity#9958 as double) * cs_list_price#9960)) AS sales#9742]
         :  +- Project [cs_quantity#9958, cs_list_price#9960, c_first_name#9983, c_last_name#9984]
         :     +- Join Inner, (cs_bill_customer_sk#9943L = c_customer_sk#9975L)
         :        :- Project [cs_bill_customer_sk#9943L, cs_quantity#9958, cs_list_price#9960]
         :        :  +- Join Inner, (cs_sold_date_sk#9974L = d_date_sk#9993L)
         :        :     :- Join LeftSemi, (cs_bill_customer_sk#9943L = c_customer_sk#9923L)
         :        :     :  :- Project [cs_bill_customer_sk#9943L, cs_quantity#9958, cs_list_price#9960, cs_sold_date_sk#9974L]
         :        :     :  :  +- Join LeftSemi, (cs_item_sk#9955L = item_sk#9749L)
         :        :     :  :     :- Project [cs_bill_customer_sk#9943L, cs_item_sk#9955L, cs_quantity#9958, cs_list_price#9960, cs_sold_date_sk#9974L]
         :        :     :  :     :  +- Filter ((isnotnull(cs_bill_customer_sk#9943L) AND isnotnull(cs_sold_date_sk#9974L)) AND dynamicpruning#10122 [cs_sold_date_sk#9974L])
         :        :     :  :     :     :  +- Project [d_date_sk#9993L]
         :        :     :  :     :     :     +- Filter (((isnotnull(d_year#9999) AND isnotnull(d_moy#10001)) AND ((d_year#9999 = 1999) AND (d_moy#10001 = 1))) AND isnotnull(d_date_sk#9993L))
         :        :     :  :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9993L,d_date_id#9994,d_date#9995,d_month_seq#9996,d_week_seq#9997,d_quarter_seq#9998,d_year#9999,d_dow#10000,d_moy#10001,d_dom#10002,d_qoy#10003,d_fy_year#10004,d_fy_quarter_seq#10005,d_fy_week_seq#10006,d_day_name#10007,d_quarter_name#10008,d_holiday#10009,d_weekend#10010,d_following_holiday#10011,d_first_dom#10012,d_last_dom#10013,d_same_day_ly#10014,d_same_day_lq#10015,d_current_day#10016,... 4 more fields] orc
         :        :     :  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#9941L,cs_ship_date_sk#9942L,cs_bill_customer_sk#9943L,cs_bill_cdemo_sk#9944L,cs_bill_hdemo_sk#9945L,cs_bill_addr_sk#9946L,cs_ship_customer_sk#9947L,cs_ship_cdemo_sk#9948L,cs_ship_hdemo_sk#9949L,cs_ship_addr_sk#9950L,cs_call_center_sk#9951L,cs_catalog_page_sk#9952L,cs_ship_mode_sk#9953L,cs_warehouse_sk#9954L,cs_item_sk#9955L,cs_promo_sk#9956L,cs_order_number#9957L,cs_quantity#9958,cs_wholesale_cost#9959,cs_list_price#9960,cs_sales_price#9961,cs_ext_discount_amt#9962,cs_ext_sales_price#9963,cs_ext_wholesale_cost#9964,... 10 more fields] orc
         :        :     :  :     +- Project [item_sk#9749L]
         :        :     :  :        +- Filter (cnt#9751L > 4)
         :        :     :  :           +- Aggregate [_groupingexpression#10115, i_item_sk#9809L, d_date#9783], [i_item_sk#9809L AS item_sk#9749L, count(1) AS cnt#9751L]
         :        :     :  :              +- Project [d_date#9783, i_item_sk#9809L, substr(i_item_desc#9813, 1, 30) AS _groupingexpression#10115]
         :        :     :  :                 +- Join Inner, (ss_item_sk#9759L = i_item_sk#9809L)
         :        :     :  :                    :- Project [ss_item_sk#9759L, d_date#9783]
         :        :     :  :                    :  +- Join Inner, (ss_sold_date_sk#9780L = d_date_sk#9781L)
         :        :     :  :                    :     :- Project [ss_item_sk#9759L, ss_sold_date_sk#9780L]
         :        :     :  :                    :     :  +- Filter ((isnotnull(ss_sold_date_sk#9780L) AND isnotnull(ss_item_sk#9759L)) AND dynamicpruning#10116 [ss_sold_date_sk#9780L])
         :        :     :  :                    :     :     :  +- Project [d_date_sk#9781L, d_date#9783]
         :        :     :  :                    :     :     :     +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
         :        :     :  :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date_id#9782,d_date#9783,d_month_seq#9784,d_week_seq#9785,d_quarter_seq#9786,d_year#9787,d_dow#9788,d_moy#9789,d_dom#9790,d_qoy#9791,d_fy_year#9792,d_fy_quarter_seq#9793,d_fy_week_seq#9794,d_day_name#9795,d_quarter_name#9796,d_holiday#9797,d_weekend#9798,d_following_holiday#9799,d_first_dom#9800,d_last_dom#9801,d_same_day_ly#9802,d_same_day_lq#9803,d_current_day#9804,... 4 more fields] orc
         :        :     :  :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9758L,ss_item_sk#9759L,ss_customer_sk#9760L,ss_cdemo_sk#9761L,ss_hdemo_sk#9762L,ss_addr_sk#9763L,ss_store_sk#9764L,ss_promo_sk#9765L,ss_ticket_number#9766L,ss_quantity#9767,ss_wholesale_cost#9768,ss_list_price#9769,ss_sales_price#9770,ss_ext_discount_amt#9771,ss_ext_sales_price#9772,ss_ext_wholesale_cost#9773,ss_ext_list_price#9774,ss_ext_tax#9775,ss_coupon_amt#9776,ss_net_paid#9777,ss_net_paid_inc_tax#9778,ss_net_profit#9779,ss_sold_date_sk#9780L] orc
         :        :     :  :                    :     +- Project [d_date_sk#9781L, d_date#9783]
         :        :     :  :                    :        +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
         :        :     :  :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date_id#9782,d_date#9783,d_month_seq#9784,d_week_seq#9785,d_quarter_seq#9786,d_year#9787,d_dow#9788,d_moy#9789,d_dom#9790,d_qoy#9791,d_fy_year#9792,d_fy_quarter_seq#9793,d_fy_week_seq#9794,d_day_name#9795,d_quarter_name#9796,d_holiday#9797,d_weekend#9798,d_following_holiday#9799,d_first_dom#9800,d_last_dom#9801,d_same_day_ly#9802,d_same_day_lq#9803,d_current_day#9804,... 4 more fields] orc
         :        :     :  :                    +- Project [i_item_sk#9809L, i_item_desc#9813]
         :        :     :  :                       +- Filter isnotnull(i_item_sk#9809L)
         :        :     :  :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9809L,i_item_id#9810,i_rec_start_date#9811,i_rec_end_date#9812,i_item_desc#9813,i_current_price#9814,i_wholesale_cost#9815,i_brand_id#9816,i_brand#9817,i_class_id#9818,i_class#9819,i_category_id#9820,i_category#9821,i_manufact_id#9822,i_manufact#9823,i_size#9824,i_formulation#9825,i_color#9826,i_units#9827,i_container#9828,i_manager_id#9829,i_product_name#9830] orc
         :        :     :  +- Project [c_customer_sk#9923L]
         :        :     :     +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * scalar-subquery#9755 [])))
         :        :     :        :  +- Aggregate [max(csales#9752) AS tpcds_cmax#9753]
         :        :     :        :     +- Aggregate [c_customer_sk#9854L], [sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843)) AS csales#9752]
         :        :     :        :        +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
         :        :     :        :           +- Join Inner, (ss_customer_sk#9833L = c_customer_sk#9854L)
         :        :     :        :              :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
         :        :     :        :              :  +- Join Inner, (ss_sold_date_sk#9853L = d_date_sk#9872L)
         :        :     :        :              :     :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843, ss_sold_date_sk#9853L]
         :        :     :        :              :     :  +- Filter ((isnotnull(ss_customer_sk#9833L) AND isnotnull(ss_sold_date_sk#9853L)) AND dynamicpruning#10117 [ss_sold_date_sk#9853L])
         :        :     :        :              :     :     :  +- Project [d_date_sk#9872L]
         :        :     :        :              :     :     :     +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
         :        :     :        :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
         :        :     :        :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9831L,ss_item_sk#9832L,ss_customer_sk#9833L,ss_cdemo_sk#9834L,ss_hdemo_sk#9835L,ss_addr_sk#9836L,ss_store_sk#9837L,ss_promo_sk#9838L,ss_ticket_number#9839L,ss_quantity#9840,ss_wholesale_cost#9841,ss_list_price#9842,ss_sales_price#9843,ss_ext_discount_amt#9844,ss_ext_sales_price#9845,ss_ext_wholesale_cost#9846,ss_ext_list_price#9847,ss_ext_tax#9848,ss_coupon_amt#9849,ss_net_paid#9850,ss_net_paid_inc_tax#9851,ss_net_profit#9852,ss_sold_date_sk#9853L] orc
         :        :     :        :              :     +- Project [d_date_sk#9872L]
         :        :     :        :              :        +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
         :        :     :        :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
         :        :     :        :              +- Project [c_customer_sk#9854L]
         :        :     :        :                 +- Filter isnotnull(c_customer_sk#9854L)
         :        :     :        :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L,c_customer_id#9855,c_current_cdemo_sk#9856L,c_current_hdemo_sk#9857L,c_current_addr_sk#9858L,c_first_shipto_date_sk#9859L,c_first_sales_date_sk#9860L,c_salutation#9861,c_first_name#9862,c_last_name#9863,c_preferred_cust_flag#9864,c_birth_day#9865,c_birth_month#9866,c_birth_year#9867,c_birth_country#9868,c_login#9869,c_email_address#9870,c_last_review_date#9871] orc
         :        :     :        +- Aggregate [c_customer_sk#9923L], [c_customer_sk#9923L, sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912)) AS ssales#9754]
         :        :     :           +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
         :        :     :              +- Join Inner, (ss_customer_sk#9902L = c_customer_sk#9923L)
         :        :     :                 :- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
         :        :     :                 :  +- Filter isnotnull(ss_customer_sk#9902L)
         :        :     :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9900L,ss_item_sk#9901L,ss_customer_sk#9902L,ss_cdemo_sk#9903L,ss_hdemo_sk#9904L,ss_addr_sk#9905L,ss_store_sk#9906L,ss_promo_sk#9907L,ss_ticket_number#9908L,ss_quantity#9909,ss_wholesale_cost#9910,ss_list_price#9911,ss_sales_price#9912,ss_ext_discount_amt#9913,ss_ext_sales_price#9914,ss_ext_wholesale_cost#9915,ss_ext_list_price#9916,ss_ext_tax#9917,ss_coupon_amt#9918,ss_net_paid#9919,ss_net_paid_inc_tax#9920,ss_net_profit#9921,ss_sold_date_sk#9922L] orc
         :        :     :                 +- Project [c_customer_sk#9923L]
         :        :     :                    +- Filter isnotnull(c_customer_sk#9923L)
         :        :     :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L,c_customer_id#9924,c_current_cdemo_sk#9925L,c_current_hdemo_sk#9926L,c_current_addr_sk#9927L,c_first_shipto_date_sk#9928L,c_first_sales_date_sk#9929L,c_salutation#9930,c_first_name#9931,c_last_name#9932,c_preferred_cust_flag#9933,c_birth_day#9934,c_birth_month#9935,c_birth_year#9936,c_birth_country#9937,c_login#9938,c_email_address#9939,c_last_review_date#9940] orc
         :        :     +- Project [d_date_sk#9993L]
         :        :        +- Filter (((isnotnull(d_year#9999) AND isnotnull(d_moy#10001)) AND ((d_year#9999 = 1999) AND (d_moy#10001 = 1))) AND isnotnull(d_date_sk#9993L))
         :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9993L,d_date_id#9994,d_date#9995,d_month_seq#9996,d_week_seq#9997,d_quarter_seq#9998,d_year#9999,d_dow#10000,d_moy#10001,d_dom#10002,d_qoy#10003,d_fy_year#10004,d_fy_quarter_seq#10005,d_fy_week_seq#10006,d_day_name#10007,d_quarter_name#10008,d_holiday#10009,d_weekend#10010,d_following_holiday#10011,d_first_dom#10012,d_last_dom#10013,d_same_day_ly#10014,d_same_day_lq#10015,d_current_day#10016,... 4 more fields] orc
         :        +- Join LeftSemi, (c_customer_sk#9975L = c_customer_sk#9923L)
         :           :- Project [c_customer_sk#9975L, c_first_name#9983, c_last_name#9984]
         :           :  +- Filter isnotnull(c_customer_sk#9975L)
         :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9975L,c_customer_id#9976,c_current_cdemo_sk#9977L,c_current_hdemo_sk#9978L,c_current_addr_sk#9979L,c_first_shipto_date_sk#9980L,c_first_sales_date_sk#9981L,c_salutation#9982,c_first_name#9983,c_last_name#9984,c_preferred_cust_flag#9985,c_birth_day#9986,c_birth_month#9987,c_birth_year#9988,c_birth_country#9989,c_login#9990,c_email_address#9991,c_last_review_date#9992] orc
         :           +- Project [c_customer_sk#9923L]
         :              +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * scalar-subquery#9755 [])))
         :                 :  +- Aggregate [max(csales#9752) AS tpcds_cmax#9753]
         :                 :     +- Aggregate [c_customer_sk#9854L], [sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843)) AS csales#9752]
         :                 :        +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
         :                 :           +- Join Inner, (ss_customer_sk#9833L = c_customer_sk#9854L)
         :                 :              :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
         :                 :              :  +- Join Inner, (ss_sold_date_sk#9853L = d_date_sk#9872L)
         :                 :              :     :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843, ss_sold_date_sk#9853L]
         :                 :              :     :  +- Filter ((isnotnull(ss_customer_sk#9833L) AND isnotnull(ss_sold_date_sk#9853L)) AND dynamicpruning#10117 [ss_sold_date_sk#9853L])
         :                 :              :     :     :  +- Project [d_date_sk#9872L]
         :                 :              :     :     :     +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
         :                 :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
         :                 :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9831L,ss_item_sk#9832L,ss_customer_sk#9833L,ss_cdemo_sk#9834L,ss_hdemo_sk#9835L,ss_addr_sk#9836L,ss_store_sk#9837L,ss_promo_sk#9838L,ss_ticket_number#9839L,ss_quantity#9840,ss_wholesale_cost#9841,ss_list_price#9842,ss_sales_price#9843,ss_ext_discount_amt#9844,ss_ext_sales_price#9845,ss_ext_wholesale_cost#9846,ss_ext_list_price#9847,ss_ext_tax#9848,ss_coupon_amt#9849,ss_net_paid#9850,ss_net_paid_inc_tax#9851,ss_net_profit#9852,ss_sold_date_sk#9853L] orc
         :                 :              :     +- Project [d_date_sk#9872L]
         :                 :              :        +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
         :                 :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
         :                 :              +- Project [c_customer_sk#9854L]
         :                 :                 +- Filter isnotnull(c_customer_sk#9854L)
         :                 :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L,c_customer_id#9855,c_current_cdemo_sk#9856L,c_current_hdemo_sk#9857L,c_current_addr_sk#9858L,c_first_shipto_date_sk#9859L,c_first_sales_date_sk#9860L,c_salutation#9861,c_first_name#9862,c_last_name#9863,c_preferred_cust_flag#9864,c_birth_day#9865,c_birth_month#9866,c_birth_year#9867,c_birth_country#9868,c_login#9869,c_email_address#9870,c_last_review_date#9871] orc
         :                 +- Aggregate [c_customer_sk#9923L], [c_customer_sk#9923L, sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912)) AS ssales#9754]
         :                    +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
         :                       +- Join Inner, (ss_customer_sk#9902L = c_customer_sk#9923L)
         :                          :- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
         :                          :  +- Filter isnotnull(ss_customer_sk#9902L)
         :                          :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9900L,ss_item_sk#9901L,ss_customer_sk#9902L,ss_cdemo_sk#9903L,ss_hdemo_sk#9904L,ss_addr_sk#9905L,ss_store_sk#9906L,ss_promo_sk#9907L,ss_ticket_number#9908L,ss_quantity#9909,ss_wholesale_cost#9910,ss_list_price#9911,ss_sales_price#9912,ss_ext_discount_amt#9913,ss_ext_sales_price#9914,ss_ext_wholesale_cost#9915,ss_ext_list_price#9916,ss_ext_tax#9917,ss_coupon_amt#9918,ss_net_paid#9919,ss_net_paid_inc_tax#9920,ss_net_profit#9921,ss_sold_date_sk#9922L] orc
         :                          +- Project [c_customer_sk#9923L]
         :                             +- Filter isnotnull(c_customer_sk#9923L)
         :                                +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L,c_customer_id#9924,c_current_cdemo_sk#9925L,c_current_hdemo_sk#9926L,c_current_addr_sk#9927L,c_first_shipto_date_sk#9928L,c_first_sales_date_sk#9929L,c_salutation#9930,c_first_name#9931,c_last_name#9932,c_preferred_cust_flag#9933,c_birth_day#9934,c_birth_month#9935,c_birth_year#9936,c_birth_country#9937,c_login#9938,c_email_address#9939,c_last_review_date#9940] orc
         +- Aggregate [c_last_name#10064, c_first_name#10063], [c_last_name#10064, c_first_name#10063, sum((cast(ws_quantity#10038 as double) * ws_list_price#10040)) AS sales#9745]
            +- Project [ws_quantity#10038, ws_list_price#10040, c_first_name#10063, c_last_name#10064]
               +- Join Inner, (ws_bill_customer_sk#10024L = c_customer_sk#10055L)
                  :- Project [ws_bill_customer_sk#10024L, ws_quantity#10038, ws_list_price#10040]
                  :  +- Join Inner, (ws_sold_date_sk#10054L = d_date_sk#10073L)
                  :     :- Join LeftSemi, (ws_bill_customer_sk#10024L = c_customer_sk#9923L)
                  :     :  :- Project [ws_bill_customer_sk#10024L, ws_quantity#10038, ws_list_price#10040, ws_sold_date_sk#10054L]
                  :     :  :  +- Join LeftSemi, (ws_item_sk#10023L = item_sk#9749L)
                  :     :  :     :- Project [ws_item_sk#10023L, ws_bill_customer_sk#10024L, ws_quantity#10038, ws_list_price#10040, ws_sold_date_sk#10054L]
                  :     :  :     :  +- Filter ((isnotnull(ws_bill_customer_sk#10024L) AND isnotnull(ws_sold_date_sk#10054L)) AND dynamicpruning#10124 [ws_sold_date_sk#10054L])
                  :     :  :     :     :  +- Project [d_date_sk#10073L]
                  :     :  :     :     :     +- Filter (((isnotnull(d_year#10079) AND isnotnull(d_moy#10081)) AND ((d_year#10079 = 1999) AND (d_moy#10081 = 1))) AND isnotnull(d_date_sk#10073L))
                  :     :  :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10073L,d_date_id#10074,d_date#10075,d_month_seq#10076,d_week_seq#10077,d_quarter_seq#10078,d_year#10079,d_dow#10080,d_moy#10081,d_dom#10082,d_qoy#10083,d_fy_year#10084,d_fy_quarter_seq#10085,d_fy_week_seq#10086,d_day_name#10087,d_quarter_name#10088,d_holiday#10089,d_weekend#10090,d_following_holiday#10091,d_first_dom#10092,d_last_dom#10093,d_same_day_ly#10094,d_same_day_lq#10095,d_current_day#10096,... 4 more fields] orc
                  :     :  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#10021L,ws_ship_date_sk#10022L,ws_item_sk#10023L,ws_bill_customer_sk#10024L,ws_bill_cdemo_sk#10025L,ws_bill_hdemo_sk#10026L,ws_bill_addr_sk#10027L,ws_ship_customer_sk#10028L,ws_ship_cdemo_sk#10029L,ws_ship_hdemo_sk#10030L,ws_ship_addr_sk#10031L,ws_web_page_sk#10032L,ws_web_site_sk#10033L,ws_ship_mode_sk#10034L,ws_warehouse_sk#10035L,ws_promo_sk#10036L,ws_order_number#10037L,ws_quantity#10038,ws_wholesale_cost#10039,ws_list_price#10040,ws_sales_price#10041,ws_ext_discount_amt#10042,ws_ext_sales_price#10043,ws_ext_wholesale_cost#10044,... 10 more fields] orc
                  :     :  :     +- Project [item_sk#9749L]
                  :     :  :        +- Filter (cnt#9751L > 4)
                  :     :  :           +- Aggregate [_groupingexpression#10118, i_item_sk#9809L, d_date#9783], [i_item_sk#9809L AS item_sk#9749L, count(1) AS cnt#9751L]
                  :     :  :              +- Project [d_date#9783, i_item_sk#9809L, substr(i_item_desc#9813, 1, 30) AS _groupingexpression#10118]
                  :     :  :                 +- Join Inner, (ss_item_sk#9759L = i_item_sk#9809L)
                  :     :  :                    :- Project [ss_item_sk#9759L, d_date#9783]
                  :     :  :                    :  +- Join Inner, (ss_sold_date_sk#9780L = d_date_sk#9781L)
                  :     :  :                    :     :- Project [ss_item_sk#9759L, ss_sold_date_sk#9780L]
                  :     :  :                    :     :  +- Filter ((isnotnull(ss_sold_date_sk#9780L) AND isnotnull(ss_item_sk#9759L)) AND dynamicpruning#10119 [ss_sold_date_sk#9780L])
                  :     :  :                    :     :     :  +- Project [d_date_sk#9781L, d_date#9783]
                  :     :  :                    :     :     :     +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
                  :     :  :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date_id#9782,d_date#9783,d_month_seq#9784,d_week_seq#9785,d_quarter_seq#9786,d_year#9787,d_dow#9788,d_moy#9789,d_dom#9790,d_qoy#9791,d_fy_year#9792,d_fy_quarter_seq#9793,d_fy_week_seq#9794,d_day_name#9795,d_quarter_name#9796,d_holiday#9797,d_weekend#9798,d_following_holiday#9799,d_first_dom#9800,d_last_dom#9801,d_same_day_ly#9802,d_same_day_lq#9803,d_current_day#9804,... 4 more fields] orc
                  :     :  :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9758L,ss_item_sk#9759L,ss_customer_sk#9760L,ss_cdemo_sk#9761L,ss_hdemo_sk#9762L,ss_addr_sk#9763L,ss_store_sk#9764L,ss_promo_sk#9765L,ss_ticket_number#9766L,ss_quantity#9767,ss_wholesale_cost#9768,ss_list_price#9769,ss_sales_price#9770,ss_ext_discount_amt#9771,ss_ext_sales_price#9772,ss_ext_wholesale_cost#9773,ss_ext_list_price#9774,ss_ext_tax#9775,ss_coupon_amt#9776,ss_net_paid#9777,ss_net_paid_inc_tax#9778,ss_net_profit#9779,ss_sold_date_sk#9780L] orc
                  :     :  :                    :     +- Project [d_date_sk#9781L, d_date#9783]
                  :     :  :                    :        +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
                  :     :  :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date_id#9782,d_date#9783,d_month_seq#9784,d_week_seq#9785,d_quarter_seq#9786,d_year#9787,d_dow#9788,d_moy#9789,d_dom#9790,d_qoy#9791,d_fy_year#9792,d_fy_quarter_seq#9793,d_fy_week_seq#9794,d_day_name#9795,d_quarter_name#9796,d_holiday#9797,d_weekend#9798,d_following_holiday#9799,d_first_dom#9800,d_last_dom#9801,d_same_day_ly#9802,d_same_day_lq#9803,d_current_day#9804,... 4 more fields] orc
                  :     :  :                    +- Project [i_item_sk#9809L, i_item_desc#9813]
                  :     :  :                       +- Filter isnotnull(i_item_sk#9809L)
                  :     :  :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9809L,i_item_id#9810,i_rec_start_date#9811,i_rec_end_date#9812,i_item_desc#9813,i_current_price#9814,i_wholesale_cost#9815,i_brand_id#9816,i_brand#9817,i_class_id#9818,i_class#9819,i_category_id#9820,i_category#9821,i_manufact_id#9822,i_manufact#9823,i_size#9824,i_formulation#9825,i_color#9826,i_units#9827,i_container#9828,i_manager_id#9829,i_product_name#9830] orc
                  :     :  +- Project [c_customer_sk#9923L]
                  :     :     +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * scalar-subquery#9755 [])))
                  :     :        :  +- Aggregate [max(csales#9752) AS tpcds_cmax#9753]
                  :     :        :     +- Aggregate [c_customer_sk#9854L], [sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843)) AS csales#9752]
                  :     :        :        +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
                  :     :        :           +- Join Inner, (ss_customer_sk#9833L = c_customer_sk#9854L)
                  :     :        :              :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
                  :     :        :              :  +- Join Inner, (ss_sold_date_sk#9853L = d_date_sk#9872L)
                  :     :        :              :     :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843, ss_sold_date_sk#9853L]
                  :     :        :              :     :  +- Filter ((isnotnull(ss_customer_sk#9833L) AND isnotnull(ss_sold_date_sk#9853L)) AND dynamicpruning#10120 [ss_sold_date_sk#9853L])
                  :     :        :              :     :     :  +- Project [d_date_sk#9872L]
                  :     :        :              :     :     :     +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                  :     :        :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
                  :     :        :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9831L,ss_item_sk#9832L,ss_customer_sk#9833L,ss_cdemo_sk#9834L,ss_hdemo_sk#9835L,ss_addr_sk#9836L,ss_store_sk#9837L,ss_promo_sk#9838L,ss_ticket_number#9839L,ss_quantity#9840,ss_wholesale_cost#9841,ss_list_price#9842,ss_sales_price#9843,ss_ext_discount_amt#9844,ss_ext_sales_price#9845,ss_ext_wholesale_cost#9846,ss_ext_list_price#9847,ss_ext_tax#9848,ss_coupon_amt#9849,ss_net_paid#9850,ss_net_paid_inc_tax#9851,ss_net_profit#9852,ss_sold_date_sk#9853L] orc
                  :     :        :              :     +- Project [d_date_sk#9872L]
                  :     :        :              :        +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                  :     :        :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
                  :     :        :              +- Project [c_customer_sk#9854L]
                  :     :        :                 +- Filter isnotnull(c_customer_sk#9854L)
                  :     :        :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L,c_customer_id#9855,c_current_cdemo_sk#9856L,c_current_hdemo_sk#9857L,c_current_addr_sk#9858L,c_first_shipto_date_sk#9859L,c_first_sales_date_sk#9860L,c_salutation#9861,c_first_name#9862,c_last_name#9863,c_preferred_cust_flag#9864,c_birth_day#9865,c_birth_month#9866,c_birth_year#9867,c_birth_country#9868,c_login#9869,c_email_address#9870,c_last_review_date#9871] orc
                  :     :        +- Aggregate [c_customer_sk#9923L], [c_customer_sk#9923L, sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912)) AS ssales#9754]
                  :     :           +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
                  :     :              +- Join Inner, (ss_customer_sk#9902L = c_customer_sk#9923L)
                  :     :                 :- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
                  :     :                 :  +- Filter isnotnull(ss_customer_sk#9902L)
                  :     :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9900L,ss_item_sk#9901L,ss_customer_sk#9902L,ss_cdemo_sk#9903L,ss_hdemo_sk#9904L,ss_addr_sk#9905L,ss_store_sk#9906L,ss_promo_sk#9907L,ss_ticket_number#9908L,ss_quantity#9909,ss_wholesale_cost#9910,ss_list_price#9911,ss_sales_price#9912,ss_ext_discount_amt#9913,ss_ext_sales_price#9914,ss_ext_wholesale_cost#9915,ss_ext_list_price#9916,ss_ext_tax#9917,ss_coupon_amt#9918,ss_net_paid#9919,ss_net_paid_inc_tax#9920,ss_net_profit#9921,ss_sold_date_sk#9922L] orc
                  :     :                 +- Project [c_customer_sk#9923L]
                  :     :                    +- Filter isnotnull(c_customer_sk#9923L)
                  :     :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L,c_customer_id#9924,c_current_cdemo_sk#9925L,c_current_hdemo_sk#9926L,c_current_addr_sk#9927L,c_first_shipto_date_sk#9928L,c_first_sales_date_sk#9929L,c_salutation#9930,c_first_name#9931,c_last_name#9932,c_preferred_cust_flag#9933,c_birth_day#9934,c_birth_month#9935,c_birth_year#9936,c_birth_country#9937,c_login#9938,c_email_address#9939,c_last_review_date#9940] orc
                  :     +- Project [d_date_sk#10073L]
                  :        +- Filter (((isnotnull(d_year#10079) AND isnotnull(d_moy#10081)) AND ((d_year#10079 = 1999) AND (d_moy#10081 = 1))) AND isnotnull(d_date_sk#10073L))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10073L,d_date_id#10074,d_date#10075,d_month_seq#10076,d_week_seq#10077,d_quarter_seq#10078,d_year#10079,d_dow#10080,d_moy#10081,d_dom#10082,d_qoy#10083,d_fy_year#10084,d_fy_quarter_seq#10085,d_fy_week_seq#10086,d_day_name#10087,d_quarter_name#10088,d_holiday#10089,d_weekend#10090,d_following_holiday#10091,d_first_dom#10092,d_last_dom#10093,d_same_day_ly#10094,d_same_day_lq#10095,d_current_day#10096,... 4 more fields] orc
                  +- Join LeftSemi, (c_customer_sk#10055L = c_customer_sk#9923L)
                     :- Project [c_customer_sk#10055L, c_first_name#10063, c_last_name#10064]
                     :  +- Filter isnotnull(c_customer_sk#10055L)
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10055L,c_customer_id#10056,c_current_cdemo_sk#10057L,c_current_hdemo_sk#10058L,c_current_addr_sk#10059L,c_first_shipto_date_sk#10060L,c_first_sales_date_sk#10061L,c_salutation#10062,c_first_name#10063,c_last_name#10064,c_preferred_cust_flag#10065,c_birth_day#10066,c_birth_month#10067,c_birth_year#10068,c_birth_country#10069,c_login#10070,c_email_address#10071,c_last_review_date#10072] orc
                     +- Project [c_customer_sk#9923L]
                        +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * scalar-subquery#9755 [])))
                           :  +- Aggregate [max(csales#9752) AS tpcds_cmax#9753]
                           :     +- Aggregate [c_customer_sk#9854L], [sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843)) AS csales#9752]
                           :        +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
                           :           +- Join Inner, (ss_customer_sk#9833L = c_customer_sk#9854L)
                           :              :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
                           :              :  +- Join Inner, (ss_sold_date_sk#9853L = d_date_sk#9872L)
                           :              :     :- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843, ss_sold_date_sk#9853L]
                           :              :     :  +- Filter ((isnotnull(ss_customer_sk#9833L) AND isnotnull(ss_sold_date_sk#9853L)) AND dynamicpruning#10120 [ss_sold_date_sk#9853L])
                           :              :     :     :  +- Project [d_date_sk#9872L]
                           :              :     :     :     +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                           :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
                           :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9831L,ss_item_sk#9832L,ss_customer_sk#9833L,ss_cdemo_sk#9834L,ss_hdemo_sk#9835L,ss_addr_sk#9836L,ss_store_sk#9837L,ss_promo_sk#9838L,ss_ticket_number#9839L,ss_quantity#9840,ss_wholesale_cost#9841,ss_list_price#9842,ss_sales_price#9843,ss_ext_discount_amt#9844,ss_ext_sales_price#9845,ss_ext_wholesale_cost#9846,ss_ext_list_price#9847,ss_ext_tax#9848,ss_coupon_amt#9849,ss_net_paid#9850,ss_net_paid_inc_tax#9851,ss_net_profit#9852,ss_sold_date_sk#9853L] orc
                           :              :     +- Project [d_date_sk#9872L]
                           :              :        +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                           :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_date_id#9873,d_date#9874,d_month_seq#9875,d_week_seq#9876,d_quarter_seq#9877,d_year#9878,d_dow#9879,d_moy#9880,d_dom#9881,d_qoy#9882,d_fy_year#9883,d_fy_quarter_seq#9884,d_fy_week_seq#9885,d_day_name#9886,d_quarter_name#9887,d_holiday#9888,d_weekend#9889,d_following_holiday#9890,d_first_dom#9891,d_last_dom#9892,d_same_day_ly#9893,d_same_day_lq#9894,d_current_day#9895,... 4 more fields] orc
                           :              +- Project [c_customer_sk#9854L]
                           :                 +- Filter isnotnull(c_customer_sk#9854L)
                           :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L,c_customer_id#9855,c_current_cdemo_sk#9856L,c_current_hdemo_sk#9857L,c_current_addr_sk#9858L,c_first_shipto_date_sk#9859L,c_first_sales_date_sk#9860L,c_salutation#9861,c_first_name#9862,c_last_name#9863,c_preferred_cust_flag#9864,c_birth_day#9865,c_birth_month#9866,c_birth_year#9867,c_birth_country#9868,c_login#9869,c_email_address#9870,c_last_review_date#9871] orc
                           +- Aggregate [c_customer_sk#9923L], [c_customer_sk#9923L, sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912)) AS ssales#9754]
                              +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
                                 +- Join Inner, (ss_customer_sk#9902L = c_customer_sk#9923L)
                                    :- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
                                    :  +- Filter isnotnull(ss_customer_sk#9902L)
                                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#9900L,ss_item_sk#9901L,ss_customer_sk#9902L,ss_cdemo_sk#9903L,ss_hdemo_sk#9904L,ss_addr_sk#9905L,ss_store_sk#9906L,ss_promo_sk#9907L,ss_ticket_number#9908L,ss_quantity#9909,ss_wholesale_cost#9910,ss_list_price#9911,ss_sales_price#9912,ss_ext_discount_amt#9913,ss_ext_sales_price#9914,ss_ext_wholesale_cost#9915,ss_ext_list_price#9916,ss_ext_tax#9917,ss_coupon_amt#9918,ss_net_paid#9919,ss_net_paid_inc_tax#9920,ss_net_profit#9921,ss_sold_date_sk#9922L] orc
                                    +- Project [c_customer_sk#9923L]
                                       +- Filter isnotnull(c_customer_sk#9923L)
                                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L,c_customer_id#9924,c_current_cdemo_sk#9925L,c_current_hdemo_sk#9926L,c_current_addr_sk#9927L,c_first_shipto_date_sk#9928L,c_first_sales_date_sk#9929L,c_salutation#9930,c_first_name#9931,c_last_name#9932,c_preferred_cust_flag#9933,c_birth_day#9934,c_birth_month#9935,c_birth_year#9936,c_birth_country#9937,c_login#9938,c_email_address#9939,c_last_review_date#9940] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_last_name#9984 ASC NULLS FIRST,c_first_name#9983 ASC NULLS FIRST,sales#9742 ASC NULLS FIRST], output=[c_last_name#9984,c_first_name#9983,sales#9742])
   +- Union
      :- HashAggregate(keys=[c_last_name#9984, c_first_name#9983], functions=[sum((cast(cs_quantity#9958 as double) * cs_list_price#9960))], output=[c_last_name#9984, c_first_name#9983, sales#9742])
      :  +- Exchange hashpartitioning(c_last_name#9984, c_first_name#9983, 3000), ENSURE_REQUIREMENTS, [id=#10292]
      :     +- HashAggregate(keys=[c_last_name#9984, c_first_name#9983], functions=[partial_sum((cast(cs_quantity#9958 as double) * cs_list_price#9960))], output=[c_last_name#9984, c_first_name#9983, sum#10126])
      :        +- Project [cs_quantity#9958, cs_list_price#9960, c_first_name#9983, c_last_name#9984]
      :           +- SortMergeJoin [cs_bill_customer_sk#9943L], [c_customer_sk#9975L], Inner
      :              :- Project [cs_bill_customer_sk#9943L, cs_quantity#9958, cs_list_price#9960]
      :              :  +- BroadcastHashJoin [cs_sold_date_sk#9974L], [d_date_sk#9993L], Inner, BuildRight, false
      :              :     :- SortMergeJoin [cs_bill_customer_sk#9943L], [c_customer_sk#9923L], LeftSemi
      :              :     :  :- Sort [cs_bill_customer_sk#9943L ASC NULLS FIRST], false, 0
      :              :     :  :  +- Exchange hashpartitioning(cs_bill_customer_sk#9943L, 3000), ENSURE_REQUIREMENTS, [id=#10262]
      :              :     :  :     +- Project [cs_bill_customer_sk#9943L, cs_quantity#9958, cs_list_price#9960, cs_sold_date_sk#9974L]
      :              :     :  :        +- SortMergeJoin [cs_item_sk#9955L], [item_sk#9749L], LeftSemi
      :              :     :  :           :- Sort [cs_item_sk#9955L ASC NULLS FIRST], false, 0
      :              :     :  :           :  +- Exchange hashpartitioning(cs_item_sk#9955L, 3000), ENSURE_REQUIREMENTS, [id=#10244]
      :              :     :  :           :     +- Filter isnotnull(cs_bill_customer_sk#9943L)
      :              :     :  :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#9943L,cs_item_sk#9955L,cs_quantity#9958,cs_list_price#9960,cs_sold_date_sk#9974L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#9943L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#9974L), dynamicpruningexpression(cs_sold_date_sk#9974L IN dynamicpruni..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_quantity:int,cs_list_price:double>
      :              :     :  :           :              +- SubqueryAdaptiveBroadcast dynamicpruning#10122, 0, true, Project [d_date_sk#9993L], [d_date_sk#9993L]
      :              :     :  :           :                 +- AdaptiveSparkPlan isFinalPlan=false
      :              :     :  :           :                    +- Project [d_date_sk#9993L]
      :              :     :  :           :                       +- Filter ((((isnotnull(d_year#9999) AND isnotnull(d_moy#10001)) AND (d_year#9999 = 1999)) AND (d_moy#10001 = 1)) AND isnotnull(d_date_sk#9993L))
      :              :     :  :           :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9993L,d_year#9999,d_moy#10001] Batched: true, DataFilters: [isnotnull(d_year#9999), isnotnull(d_moy#10001), (d_year#9999 = 1999), (d_moy#10001 = 1), isnotnu..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
      :              :     :  :           +- Sort [item_sk#9749L ASC NULLS FIRST], false, 0
      :              :     :  :              +- Project [item_sk#9749L]
      :              :     :  :                 +- Filter (cnt#9751L > 4)
      :              :     :  :                    +- HashAggregate(keys=[_groupingexpression#10115, i_item_sk#9809L, d_date#9783], functions=[count(1)], output=[item_sk#9749L, cnt#9751L])
      :              :     :  :                       +- HashAggregate(keys=[_groupingexpression#10115, i_item_sk#9809L, d_date#9783], functions=[partial_count(1)], output=[_groupingexpression#10115, i_item_sk#9809L, d_date#9783, count#10128L])
      :              :     :  :                          +- Project [d_date#9783, i_item_sk#9809L, substr(i_item_desc#9813, 1, 30) AS _groupingexpression#10115]
      :              :     :  :                             +- SortMergeJoin [ss_item_sk#9759L], [i_item_sk#9809L], Inner
      :              :     :  :                                :- Sort [ss_item_sk#9759L ASC NULLS FIRST], false, 0
      :              :     :  :                                :  +- Exchange hashpartitioning(ss_item_sk#9759L, 3000), ENSURE_REQUIREMENTS, [id=#10232]
      :              :     :  :                                :     +- Project [ss_item_sk#9759L, d_date#9783]
      :              :     :  :                                :        +- BroadcastHashJoin [ss_sold_date_sk#9780L], [d_date_sk#9781L], Inner, BuildRight, false
      :              :     :  :                                :           :- Filter isnotnull(ss_item_sk#9759L)
      :              :     :  :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#9759L,ss_sold_date_sk#9780L] Batched: true, DataFilters: [isnotnull(ss_item_sk#9759L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9780L), dynamicpruningexpression(ss_sold_date_sk#9780L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
      :              :     :  :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10116, 0, true, Project [d_date_sk#9781L, d_date#9783], [d_date_sk#9781L]
      :              :     :  :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :              :     :  :                                :           :              +- Project [d_date_sk#9781L, d_date#9783]
      :              :     :  :                                :           :                 +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
      :              :     :  :                                :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date#9783,d_year#9787] Batched: true, DataFilters: [d_year#9787 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9781L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
      :              :     :  :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10227]
      :              :     :  :                                :              +- Project [d_date_sk#9781L, d_date#9783]
      :              :     :  :                                :                 +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
      :              :     :  :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date#9783,d_year#9787] Batched: true, DataFilters: [d_year#9787 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9781L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
      :              :     :  :                                +- Sort [i_item_sk#9809L ASC NULLS FIRST], false, 0
      :              :     :  :                                   +- Exchange hashpartitioning(i_item_sk#9809L, 3000), ENSURE_REQUIREMENTS, [id=#10233]
      :              :     :  :                                      +- Filter isnotnull(i_item_sk#9809L)
      :              :     :  :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9809L,i_item_desc#9813] Batched: true, DataFilters: [isnotnull(i_item_sk#9809L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string>
      :              :     :  +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
      :              :     :     +- Project [c_customer_sk#9923L]
      :              :     :        +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * Subquery subquery#9755, [id=#10093])))
      :              :     :           :  +- Subquery subquery#9755, [id=#10093]
      :              :     :           :     +- AdaptiveSparkPlan isFinalPlan=false
      :              :     :           :        +- HashAggregate(keys=[], functions=[max(csales#9752)], output=[tpcds_cmax#9753])
      :              :     :           :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#10091]
      :              :     :           :              +- HashAggregate(keys=[], functions=[partial_max(csales#9752)], output=[max#10134])
      :              :     :           :                 +- HashAggregate(keys=[c_customer_sk#9854L], functions=[sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[csales#9752])
      :              :     :           :                    +- HashAggregate(keys=[c_customer_sk#9854L], functions=[partial_sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[c_customer_sk#9854L, sum#10136])
      :              :     :           :                       +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
      :              :     :           :                          +- SortMergeJoin [ss_customer_sk#9833L], [c_customer_sk#9854L], Inner
      :              :     :           :                             :- Sort [ss_customer_sk#9833L ASC NULLS FIRST], false, 0
      :              :     :           :                             :  +- Exchange hashpartitioning(ss_customer_sk#9833L, 3000), ENSURE_REQUIREMENTS, [id=#10081]
      :              :     :           :                             :     +- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
      :              :     :           :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9853L], [d_date_sk#9872L], Inner, BuildRight, false
      :              :     :           :                             :           :- Filter isnotnull(ss_customer_sk#9833L)
      :              :     :           :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9833L,ss_quantity#9840,ss_sales_price#9843,ss_sold_date_sk#9853L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9833L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9853L), dynamicpruningexpression(ss_sold_date_sk#9853L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
      :              :     :           :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10117, 0, true, Project [d_date_sk#9872L], [d_date_sk#9872L]
      :              :     :           :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :              :     :           :                             :           :              +- Project [d_date_sk#9872L]
      :              :     :           :                             :           :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
      :              :     :           :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :              :     :           :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10076]
      :              :     :           :                             :              +- Project [d_date_sk#9872L]
      :              :     :           :                             :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
      :              :     :           :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :              :     :           :                             +- Sort [c_customer_sk#9854L ASC NULLS FIRST], false, 0
      :              :     :           :                                +- Exchange hashpartitioning(c_customer_sk#9854L, 3000), ENSURE_REQUIREMENTS, [id=#10082]
      :              :     :           :                                   +- Filter isnotnull(c_customer_sk#9854L)
      :              :     :           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9854L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
      :              :     :           +- HashAggregate(keys=[c_customer_sk#9923L], functions=[sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, ssales#9754])
      :              :     :              +- HashAggregate(keys=[c_customer_sk#9923L], functions=[partial_sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, sum#10130])
      :              :     :                 +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
      :              :     :                    +- SortMergeJoin [ss_customer_sk#9902L], [c_customer_sk#9923L], Inner
      :              :     :                       :- Sort [ss_customer_sk#9902L ASC NULLS FIRST], false, 0
      :              :     :                       :  +- Exchange hashpartitioning(ss_customer_sk#9902L, 3000), ENSURE_REQUIREMENTS, [id=#10250]
      :              :     :                       :     +- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
      :              :     :                       :        +- Filter isnotnull(ss_customer_sk#9902L)
      :              :     :                       :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9902L,ss_quantity#9909,ss_sales_price#9912,ss_sold_date_sk#9922L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9902L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
      :              :     :                       +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
      :              :     :                          +- Exchange hashpartitioning(c_customer_sk#9923L, 3000), ENSURE_REQUIREMENTS, [id=#10251]
      :              :     :                             +- Filter isnotnull(c_customer_sk#9923L)
      :              :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9923L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10267]
      :              :        +- Project [d_date_sk#9993L]
      :              :           +- Filter ((((isnotnull(d_year#9999) AND isnotnull(d_moy#10001)) AND (d_year#9999 = 1999)) AND (d_moy#10001 = 1)) AND isnotnull(d_date_sk#9993L))
      :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9993L,d_year#9999,d_moy#10001] Batched: true, DataFilters: [isnotnull(d_year#9999), isnotnull(d_moy#10001), (d_year#9999 = 1999), (d_moy#10001 = 1), isnotnu..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
      :              +- SortMergeJoin [c_customer_sk#9975L], [c_customer_sk#9923L], LeftSemi
      :                 :- Sort [c_customer_sk#9975L ASC NULLS FIRST], false, 0
      :                 :  +- Exchange hashpartitioning(c_customer_sk#9975L, 3000), ENSURE_REQUIREMENTS, [id=#10283]
      :                 :     +- Filter isnotnull(c_customer_sk#9975L)
      :                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9975L,c_first_name#9983,c_last_name#9984] Batched: true, DataFilters: [isnotnull(c_customer_sk#9975L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
      :                 +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
      :                    +- Project [c_customer_sk#9923L]
      :                       +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * Subquery subquery#9755, [id=#10093])))
      :                          :  +- Subquery subquery#9755, [id=#10093]
      :                          :     +- AdaptiveSparkPlan isFinalPlan=false
      :                          :        +- HashAggregate(keys=[], functions=[max(csales#9752)], output=[tpcds_cmax#9753])
      :                          :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#10091]
      :                          :              +- HashAggregate(keys=[], functions=[partial_max(csales#9752)], output=[max#10134])
      :                          :                 +- HashAggregate(keys=[c_customer_sk#9854L], functions=[sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[csales#9752])
      :                          :                    +- HashAggregate(keys=[c_customer_sk#9854L], functions=[partial_sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[c_customer_sk#9854L, sum#10136])
      :                          :                       +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
      :                          :                          +- SortMergeJoin [ss_customer_sk#9833L], [c_customer_sk#9854L], Inner
      :                          :                             :- Sort [ss_customer_sk#9833L ASC NULLS FIRST], false, 0
      :                          :                             :  +- Exchange hashpartitioning(ss_customer_sk#9833L, 3000), ENSURE_REQUIREMENTS, [id=#10081]
      :                          :                             :     +- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
      :                          :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9853L], [d_date_sk#9872L], Inner, BuildRight, false
      :                          :                             :           :- Filter isnotnull(ss_customer_sk#9833L)
      :                          :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9833L,ss_quantity#9840,ss_sales_price#9843,ss_sold_date_sk#9853L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9833L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9853L), dynamicpruningexpression(ss_sold_date_sk#9853L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
      :                          :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10117, 0, true, Project [d_date_sk#9872L], [d_date_sk#9872L]
      :                          :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :                          :                             :           :              +- Project [d_date_sk#9872L]
      :                          :                             :           :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
      :                          :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                          :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10076]
      :                          :                             :              +- Project [d_date_sk#9872L]
      :                          :                             :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
      :                          :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
      :                          :                             +- Sort [c_customer_sk#9854L ASC NULLS FIRST], false, 0
      :                          :                                +- Exchange hashpartitioning(c_customer_sk#9854L, 3000), ENSURE_REQUIREMENTS, [id=#10082]
      :                          :                                   +- Filter isnotnull(c_customer_sk#9854L)
      :                          :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9854L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
      :                          +- HashAggregate(keys=[c_customer_sk#9923L], functions=[sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, ssales#9754])
      :                             +- HashAggregate(keys=[c_customer_sk#9923L], functions=[partial_sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, sum#10130])
      :                                +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
      :                                   +- SortMergeJoin [ss_customer_sk#9902L], [c_customer_sk#9923L], Inner
      :                                      :- Sort [ss_customer_sk#9902L ASC NULLS FIRST], false, 0
      :                                      :  +- Exchange hashpartitioning(ss_customer_sk#9902L, 3000), ENSURE_REQUIREMENTS, [id=#10271]
      :                                      :     +- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
      :                                      :        +- Filter isnotnull(ss_customer_sk#9902L)
      :                                      :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9902L,ss_quantity#9909,ss_sales_price#9912,ss_sold_date_sk#9922L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9902L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
      :                                      +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
      :                                         +- Exchange hashpartitioning(c_customer_sk#9923L, 3000), ENSURE_REQUIREMENTS, [id=#10272]
      :                                            +- Filter isnotnull(c_customer_sk#9923L)
      :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9923L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
      +- HashAggregate(keys=[c_last_name#10064, c_first_name#10063], functions=[sum((cast(ws_quantity#10038 as double) * ws_list_price#10040))], output=[c_last_name#10064, c_first_name#10063, sales#9745])
         +- Exchange hashpartitioning(c_last_name#10064, c_first_name#10063, 3000), ENSURE_REQUIREMENTS, [id=#10359]
            +- HashAggregate(keys=[c_last_name#10064, c_first_name#10063], functions=[partial_sum((cast(ws_quantity#10038 as double) * ws_list_price#10040))], output=[c_last_name#10064, c_first_name#10063, sum#10132])
               +- Project [ws_quantity#10038, ws_list_price#10040, c_first_name#10063, c_last_name#10064]
                  +- SortMergeJoin [ws_bill_customer_sk#10024L], [c_customer_sk#10055L], Inner
                     :- Project [ws_bill_customer_sk#10024L, ws_quantity#10038, ws_list_price#10040]
                     :  +- BroadcastHashJoin [ws_sold_date_sk#10054L], [d_date_sk#10073L], Inner, BuildRight, false
                     :     :- SortMergeJoin [ws_bill_customer_sk#10024L], [c_customer_sk#9923L], LeftSemi
                     :     :  :- Sort [ws_bill_customer_sk#10024L ASC NULLS FIRST], false, 0
                     :     :  :  +- Exchange hashpartitioning(ws_bill_customer_sk#10024L, 3000), ENSURE_REQUIREMENTS, [id=#10329]
                     :     :  :     +- Project [ws_bill_customer_sk#10024L, ws_quantity#10038, ws_list_price#10040, ws_sold_date_sk#10054L]
                     :     :  :        +- SortMergeJoin [ws_item_sk#10023L], [item_sk#9749L], LeftSemi
                     :     :  :           :- Sort [ws_item_sk#10023L ASC NULLS FIRST], false, 0
                     :     :  :           :  +- Exchange hashpartitioning(ws_item_sk#10023L, 3000), ENSURE_REQUIREMENTS, [id=#10311]
                     :     :  :           :     +- Filter isnotnull(ws_bill_customer_sk#10024L)
                     :     :  :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#10023L,ws_bill_customer_sk#10024L,ws_quantity#10038,ws_list_price#10040,ws_sold_date_sk#10054L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#10024L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#10054L), dynamicpruningexpression(ws_sold_date_sk#10054L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_customer_sk:bigint,ws_quantity:int,ws_list_price:double>
                     :     :  :           :              +- SubqueryAdaptiveBroadcast dynamicpruning#10124, 0, true, Project [d_date_sk#10073L], [d_date_sk#10073L]
                     :     :  :           :                 +- AdaptiveSparkPlan isFinalPlan=false
                     :     :  :           :                    +- Project [d_date_sk#10073L]
                     :     :  :           :                       +- Filter ((((isnotnull(d_year#10079) AND isnotnull(d_moy#10081)) AND (d_year#10079 = 1999)) AND (d_moy#10081 = 1)) AND isnotnull(d_date_sk#10073L))
                     :     :  :           :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10073L,d_year#10079,d_moy#10081] Batched: true, DataFilters: [isnotnull(d_year#10079), isnotnull(d_moy#10081), (d_year#10079 = 1999), (d_moy#10081 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :     :  :           +- Sort [item_sk#9749L ASC NULLS FIRST], false, 0
                     :     :  :              +- Project [item_sk#9749L]
                     :     :  :                 +- Filter (cnt#9751L > 4)
                     :     :  :                    +- HashAggregate(keys=[_groupingexpression#10118, i_item_sk#9809L, d_date#9783], functions=[count(1)], output=[item_sk#9749L, cnt#9751L])
                     :     :  :                       +- HashAggregate(keys=[_groupingexpression#10118, i_item_sk#9809L, d_date#9783], functions=[partial_count(1)], output=[_groupingexpression#10118, i_item_sk#9809L, d_date#9783, count#10128L])
                     :     :  :                          +- Project [d_date#9783, i_item_sk#9809L, substr(i_item_desc#9813, 1, 30) AS _groupingexpression#10118]
                     :     :  :                             +- SortMergeJoin [ss_item_sk#9759L], [i_item_sk#9809L], Inner
                     :     :  :                                :- Sort [ss_item_sk#9759L ASC NULLS FIRST], false, 0
                     :     :  :                                :  +- Exchange hashpartitioning(ss_item_sk#9759L, 3000), ENSURE_REQUIREMENTS, [id=#10299]
                     :     :  :                                :     +- Project [ss_item_sk#9759L, d_date#9783]
                     :     :  :                                :        +- BroadcastHashJoin [ss_sold_date_sk#9780L], [d_date_sk#9781L], Inner, BuildRight, false
                     :     :  :                                :           :- Filter isnotnull(ss_item_sk#9759L)
                     :     :  :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#9759L,ss_sold_date_sk#9780L] Batched: true, DataFilters: [isnotnull(ss_item_sk#9759L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9780L), dynamicpruningexpression(ss_sold_date_sk#9780L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>
                     :     :  :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10119, 0, true, Project [d_date_sk#9781L, d_date#9783], [d_date_sk#9781L]
                     :     :  :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :     :  :                                :           :              +- Project [d_date_sk#9781L, d_date#9783]
                     :     :  :                                :           :                 +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
                     :     :  :                                :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date#9783,d_year#9787] Batched: true, DataFilters: [d_year#9787 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9781L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
                     :     :  :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10294]
                     :     :  :                                :              +- Project [d_date_sk#9781L, d_date#9783]
                     :     :  :                                :                 +- Filter (d_year#9787 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9781L))
                     :     :  :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9781L,d_date#9783,d_year#9787] Batched: true, DataFilters: [d_year#9787 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9781L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date,d_year:int>
                     :     :  :                                +- Sort [i_item_sk#9809L ASC NULLS FIRST], false, 0
                     :     :  :                                   +- Exchange hashpartitioning(i_item_sk#9809L, 3000), ENSURE_REQUIREMENTS, [id=#10300]
                     :     :  :                                      +- Filter isnotnull(i_item_sk#9809L)
                     :     :  :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#9809L,i_item_desc#9813] Batched: true, DataFilters: [isnotnull(i_item_sk#9809L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string>
                     :     :  +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
                     :     :     +- Project [c_customer_sk#9923L]
                     :     :        +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * Subquery subquery#9755, [id=#10093])))
                     :     :           :  +- Subquery subquery#9755, [id=#10093]
                     :     :           :     +- AdaptiveSparkPlan isFinalPlan=false
                     :     :           :        +- HashAggregate(keys=[], functions=[max(csales#9752)], output=[tpcds_cmax#9753])
                     :     :           :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#10091]
                     :     :           :              +- HashAggregate(keys=[], functions=[partial_max(csales#9752)], output=[max#10134])
                     :     :           :                 +- HashAggregate(keys=[c_customer_sk#9854L], functions=[sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[csales#9752])
                     :     :           :                    +- HashAggregate(keys=[c_customer_sk#9854L], functions=[partial_sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[c_customer_sk#9854L, sum#10136])
                     :     :           :                       +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
                     :     :           :                          +- SortMergeJoin [ss_customer_sk#9833L], [c_customer_sk#9854L], Inner
                     :     :           :                             :- Sort [ss_customer_sk#9833L ASC NULLS FIRST], false, 0
                     :     :           :                             :  +- Exchange hashpartitioning(ss_customer_sk#9833L, 3000), ENSURE_REQUIREMENTS, [id=#10081]
                     :     :           :                             :     +- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
                     :     :           :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9853L], [d_date_sk#9872L], Inner, BuildRight, false
                     :     :           :                             :           :- Filter isnotnull(ss_customer_sk#9833L)
                     :     :           :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9833L,ss_quantity#9840,ss_sales_price#9843,ss_sold_date_sk#9853L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9833L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9853L), dynamicpruningexpression(ss_sold_date_sk#9853L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                     :     :           :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10117, 0, true, Project [d_date_sk#9872L], [d_date_sk#9872L]
                     :     :           :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :     :           :                             :           :              +- Project [d_date_sk#9872L]
                     :     :           :                             :           :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                     :     :           :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :     :           :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10076]
                     :     :           :                             :              +- Project [d_date_sk#9872L]
                     :     :           :                             :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                     :     :           :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :     :           :                             +- Sort [c_customer_sk#9854L ASC NULLS FIRST], false, 0
                     :     :           :                                +- Exchange hashpartitioning(c_customer_sk#9854L, 3000), ENSURE_REQUIREMENTS, [id=#10082]
                     :     :           :                                   +- Filter isnotnull(c_customer_sk#9854L)
                     :     :           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9854L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
                     :     :           +- HashAggregate(keys=[c_customer_sk#9923L], functions=[sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, ssales#9754])
                     :     :              +- HashAggregate(keys=[c_customer_sk#9923L], functions=[partial_sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, sum#10130])
                     :     :                 +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
                     :     :                    +- SortMergeJoin [ss_customer_sk#9902L], [c_customer_sk#9923L], Inner
                     :     :                       :- Sort [ss_customer_sk#9902L ASC NULLS FIRST], false, 0
                     :     :                       :  +- Exchange hashpartitioning(ss_customer_sk#9902L, 3000), ENSURE_REQUIREMENTS, [id=#10317]
                     :     :                       :     +- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
                     :     :                       :        +- Filter isnotnull(ss_customer_sk#9902L)
                     :     :                       :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9902L,ss_quantity#9909,ss_sales_price#9912,ss_sold_date_sk#9922L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9902L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                     :     :                       +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
                     :     :                          +- Exchange hashpartitioning(c_customer_sk#9923L, 3000), ENSURE_REQUIREMENTS, [id=#10318]
                     :     :                             +- Filter isnotnull(c_customer_sk#9923L)
                     :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9923L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10334]
                     :        +- Project [d_date_sk#10073L]
                     :           +- Filter ((((isnotnull(d_year#10079) AND isnotnull(d_moy#10081)) AND (d_year#10079 = 1999)) AND (d_moy#10081 = 1)) AND isnotnull(d_date_sk#10073L))
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10073L,d_year#10079,d_moy#10081] Batched: true, DataFilters: [isnotnull(d_year#10079), isnotnull(d_moy#10081), (d_year#10079 = 1999), (d_moy#10081 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     +- SortMergeJoin [c_customer_sk#10055L], [c_customer_sk#9923L], LeftSemi
                        :- Sort [c_customer_sk#10055L ASC NULLS FIRST], false, 0
                        :  +- Exchange hashpartitioning(c_customer_sk#10055L, 3000), ENSURE_REQUIREMENTS, [id=#10350]
                        :     +- Filter isnotnull(c_customer_sk#10055L)
                        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10055L,c_first_name#10063,c_last_name#10064] Batched: true, DataFilters: [isnotnull(c_customer_sk#10055L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
                        +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
                           +- Project [c_customer_sk#9923L]
                              +- Filter (isnotnull(ssales#9754) AND (ssales#9754 > (0.95 * Subquery subquery#9755, [id=#10093])))
                                 :  +- Subquery subquery#9755, [id=#10093]
                                 :     +- AdaptiveSparkPlan isFinalPlan=false
                                 :        +- HashAggregate(keys=[], functions=[max(csales#9752)], output=[tpcds_cmax#9753])
                                 :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#10091]
                                 :              +- HashAggregate(keys=[], functions=[partial_max(csales#9752)], output=[max#10134])
                                 :                 +- HashAggregate(keys=[c_customer_sk#9854L], functions=[sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[csales#9752])
                                 :                    +- HashAggregate(keys=[c_customer_sk#9854L], functions=[partial_sum((cast(ss_quantity#9840 as double) * ss_sales_price#9843))], output=[c_customer_sk#9854L, sum#10136])
                                 :                       +- Project [ss_quantity#9840, ss_sales_price#9843, c_customer_sk#9854L]
                                 :                          +- SortMergeJoin [ss_customer_sk#9833L], [c_customer_sk#9854L], Inner
                                 :                             :- Sort [ss_customer_sk#9833L ASC NULLS FIRST], false, 0
                                 :                             :  +- Exchange hashpartitioning(ss_customer_sk#9833L, 3000), ENSURE_REQUIREMENTS, [id=#10081]
                                 :                             :     +- Project [ss_customer_sk#9833L, ss_quantity#9840, ss_sales_price#9843]
                                 :                             :        +- BroadcastHashJoin [ss_sold_date_sk#9853L], [d_date_sk#9872L], Inner, BuildRight, false
                                 :                             :           :- Filter isnotnull(ss_customer_sk#9833L)
                                 :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9833L,ss_quantity#9840,ss_sales_price#9843,ss_sold_date_sk#9853L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9833L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#9853L), dynamicpruningexpression(ss_sold_date_sk#9853L IN dynamicpruni..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                                 :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#10117, 0, true, Project [d_date_sk#9872L], [d_date_sk#9872L]
                                 :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                 :                             :           :              +- Project [d_date_sk#9872L]
                                 :                             :           :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                                 :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10076]
                                 :                             :              +- Project [d_date_sk#9872L]
                                 :                             :                 +- Filter (d_year#9878 IN (1999,2000,2001,2002) AND isnotnull(d_date_sk#9872L))
                                 :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#9872L,d_year#9878] Batched: true, DataFilters: [d_year#9878 IN (1999,2000,2001,2002), isnotnull(d_date_sk#9872L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :                             +- Sort [c_customer_sk#9854L ASC NULLS FIRST], false, 0
                                 :                                +- Exchange hashpartitioning(c_customer_sk#9854L, 3000), ENSURE_REQUIREMENTS, [id=#10082]
                                 :                                   +- Filter isnotnull(c_customer_sk#9854L)
                                 :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9854L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9854L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>
                                 +- HashAggregate(keys=[c_customer_sk#9923L], functions=[sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, ssales#9754])
                                    +- HashAggregate(keys=[c_customer_sk#9923L], functions=[partial_sum((cast(ss_quantity#9909 as double) * ss_sales_price#9912))], output=[c_customer_sk#9923L, sum#10130])
                                       +- Project [ss_quantity#9909, ss_sales_price#9912, c_customer_sk#9923L]
                                          +- SortMergeJoin [ss_customer_sk#9902L], [c_customer_sk#9923L], Inner
                                             :- Sort [ss_customer_sk#9902L ASC NULLS FIRST], false, 0
                                             :  +- Exchange hashpartitioning(ss_customer_sk#9902L, 3000), ENSURE_REQUIREMENTS, [id=#10338]
                                             :     +- Project [ss_customer_sk#9902L, ss_quantity#9909, ss_sales_price#9912]
                                             :        +- Filter isnotnull(ss_customer_sk#9902L)
                                             :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#9902L,ss_quantity#9909,ss_sales_price#9912,ss_sold_date_sk#9922L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#9902L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_quantity:int,ss_sales_price:double>
                                             +- Sort [c_customer_sk#9923L ASC NULLS FIRST], false, 0
                                                +- Exchange hashpartitioning(c_customer_sk#9923L, 3000), ENSURE_REQUIREMENTS, [id=#10339]
                                                   +- Filter isnotnull(c_customer_sk#9923L)
                                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#9923L] Batched: true, DataFilters: [isnotnull(c_customer_sk#9923L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint>

read query: spark_queries/q24.sql
explain query: q24
== Parsed Logical Plan ==
CTE [ssales]
:  +- 'SubqueryAlias ssales
:     +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size], ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size, 'sum('ss_sales_price) AS netpaid#10139]
:        +- 'Filter ((((('ss_ticket_number = 'sr_ticket_number) AND ('ss_item_sk = 'sr_item_sk)) AND ('ss_customer_sk = 'c_customer_sk)) AND (('ss_item_sk = 'i_item_sk) AND ('ss_store_sk = 's_store_sk))) AND ((('c_current_addr_sk = 'ca_address_sk) AND NOT ('c_birth_country = 'upper('ca_country))) AND (('s_zip = 'ca_zip) AND ('s_market_id = 7))))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'Join Inner
:              :  :  :  :- 'Join Inner
:              :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
:              :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
:              :  :  :  +- 'UnresolvedRelation [store], [], false
:              :  :  +- 'UnresolvedRelation [item], [], false
:              :  +- 'UnresolvedRelation [customer], [], false
:              +- 'UnresolvedRelation [customer_address], [], false
+- 'UnresolvedHaving ('sum('netpaid) > scalar-subquery#10138 [])
   :  +- 'Project [unresolvedalias((0.05 * 'avg('netpaid)), None)]
   :     +- 'UnresolvedRelation [ssales], [], false
   +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name], ['c_last_name, 'c_first_name, 's_store_name, 'sum('netpaid) AS paid#10137]
      +- 'Filter ('i_color = orchid)
         +- 'UnresolvedRelation [ssales], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, s_store_name: string, paid: double
WithCTE
:- CTERelationDef 18
:  +- SubqueryAlias ssales
:     +- Aggregate [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, sum(ss_sales_price#10152) AS netpaid#10139]
:        +- Filter (((((ss_ticket_number#10148L = sr_ticket_number#10171L) AND (ss_item_sk#10141L = sr_item_sk#10164L)) AND (ss_customer_sk#10142L = c_customer_sk#10234L)) AND ((ss_item_sk#10141L = i_item_sk#10212L) AND (ss_store_sk#10146L = s_store_sk#10183L))) AND (((c_current_addr_sk#10238L = ca_address_sk#10252L) AND NOT (c_birth_country#10248 = upper(ca_country#10262))) AND ((s_zip#10208 = ca_zip#10261) AND (s_market_id#10193 = 7))))
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- Join Inner
:              :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10140L,ss_item_sk#10141L,ss_customer_sk#10142L,ss_cdemo_sk#10143L,ss_hdemo_sk#10144L,ss_addr_sk#10145L,ss_store_sk#10146L,ss_promo_sk#10147L,ss_ticket_number#10148L,ss_quantity#10149,ss_wholesale_cost#10150,ss_list_price#10151,ss_sales_price#10152,ss_ext_discount_amt#10153,ss_ext_sales_price#10154,ss_ext_wholesale_cost#10155,ss_ext_list_price#10156,ss_ext_tax#10157,ss_coupon_amt#10158,ss_net_paid#10159,ss_net_paid_inc_tax#10160,ss_net_profit#10161,ss_sold_date_sk#10162L] orc
:              :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#10163L,sr_item_sk#10164L,sr_customer_sk#10165L,sr_cdemo_sk#10166L,sr_hdemo_sk#10167L,sr_addr_sk#10168L,sr_store_sk#10169L,sr_reason_sk#10170L,sr_ticket_number#10171L,sr_return_quantity#10172,sr_return_amt#10173,sr_return_tax#10174,sr_return_amt_inc_tax#10175,sr_fee#10176,sr_return_ship_cost#10177,sr_refunded_cash#10178,sr_reversed_charge#10179,sr_store_credit#10180,sr_net_loss#10181,sr_returned_date_sk#10182L] orc
:              :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:              :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10183L,s_store_id#10184,s_rec_start_date#10185,s_rec_end_date#10186,s_closed_date_sk#10187L,s_store_name#10188,s_number_employees#10189,s_floor_space#10190,s_hours#10191,s_manager#10192,s_market_id#10193,s_geography_class#10194,s_market_desc#10195,s_market_manager#10196,s_division_id#10197,s_division_name#10198,s_company_id#10199,s_company_name#10200,s_street_number#10201,s_street_name#10202,s_street_type#10203,s_suite_number#10204,s_city#10205,s_county#10206,... 5 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10212L,i_item_id#10213,i_rec_start_date#10214,i_rec_end_date#10215,i_item_desc#10216,i_current_price#10217,i_wholesale_cost#10218,i_brand_id#10219,i_brand#10220,i_class_id#10221,i_class#10222,i_category_id#10223,i_category#10224,i_manufact_id#10225,i_manufact#10226,i_size#10227,i_formulation#10228,i_color#10229,i_units#10230,i_container#10231,i_manager_id#10232,i_product_name#10233] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10234L,c_customer_id#10235,c_current_cdemo_sk#10236L,c_current_hdemo_sk#10237L,c_current_addr_sk#10238L,c_first_shipto_date_sk#10239L,c_first_sales_date_sk#10240L,c_salutation#10241,c_first_name#10242,c_last_name#10243,c_preferred_cust_flag#10244,c_birth_day#10245,c_birth_month#10246,c_birth_year#10247,c_birth_country#10248,c_login#10249,c_email_address#10250,c_last_review_date#10251] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#10252L,ca_address_id#10253,ca_street_number#10254,ca_street_name#10255,ca_street_type#10256,ca_suite_number#10257,ca_city#10258,ca_county#10259,ca_state#10260,ca_zip#10261,ca_country#10262,ca_gmt_offset#10263,ca_location_type#10264] orc
+- Filter (paid#10137 > scalar-subquery#10138 [])
   :  +- Aggregate [(cast(0.05 as double) * avg(netpaid#10139)) AS (0.05 * avg(netpaid))#10268]
   :     +- SubqueryAlias ssales
   :        +- CTERelationRef 18, true, [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, netpaid#10139]
   +- Aggregate [c_last_name#10243, c_first_name#10242, s_store_name#10188], [c_last_name#10243, c_first_name#10242, s_store_name#10188, sum(netpaid#10139) AS paid#10137]
      +- Filter (i_color#10229 = orchid)
         +- SubqueryAlias ssales
            +- CTERelationRef 18, true, [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, netpaid#10139]

== Optimized Logical Plan ==
Filter (isnotnull(paid#10137) AND (paid#10137 > scalar-subquery#10138 []))
:  +- Aggregate [(0.05 * avg(netpaid#10139)) AS (0.05 * avg(netpaid))#10268]
:     +- Aggregate [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], [sum(ss_sales_price#10152) AS netpaid#10139]
:        +- Project [ss_sales_price#10152, s_store_name#10188, s_state#10207, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232, c_first_name#10242, c_last_name#10243, ca_state#10260]
:           +- Join Inner, ((ss_ticket_number#10148L = sr_ticket_number#10171L) AND (ss_item_sk#10141L = sr_item_sk#10164L))
:              :- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
:              :  +- Join Inner, (ss_item_sk#10141L = i_item_sk#10212L)
:              :     :- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152]
:              :     :  +- Join Inner, ((ss_store_sk#10146L = s_store_sk#10183L) AND (ss_customer_sk#10142L = c_customer_sk#10234L))
:              :     :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_state#10260, c_customer_sk#10234L, c_first_name#10242, c_last_name#10243]
:              :     :     :  +- Join Inner, ((c_current_addr_sk#10238L = ca_address_sk#10252L) AND NOT (c_birth_country#10248 = upper(ca_country#10262)))
:              :     :     :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_address_sk#10252L, ca_state#10260, ca_country#10262]
:              :     :     :     :  +- Join Inner, (s_zip#10208 = ca_zip#10261)
:              :     :     :     :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, s_zip#10208]
:              :     :     :     :     :  +- Filter (((isnotnull(s_market_id#10193) AND (s_market_id#10193 = 7)) AND isnotnull(s_store_sk#10183L)) AND isnotnull(s_zip#10208))
:              :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10183L,s_store_id#10184,s_rec_start_date#10185,s_rec_end_date#10186,s_closed_date_sk#10187L,s_store_name#10188,s_number_employees#10189,s_floor_space#10190,s_hours#10191,s_manager#10192,s_market_id#10193,s_geography_class#10194,s_market_desc#10195,s_market_manager#10196,s_division_id#10197,s_division_name#10198,s_company_id#10199,s_company_name#10200,s_street_number#10201,s_street_name#10202,s_street_type#10203,s_suite_number#10204,s_city#10205,s_county#10206,... 5 more fields] orc
:              :     :     :     :     +- Project [ca_address_sk#10252L, ca_state#10260, ca_zip#10261, ca_country#10262]
:              :     :     :     :        +- Filter ((isnotnull(ca_address_sk#10252L) AND isnotnull(ca_country#10262)) AND isnotnull(ca_zip#10261))
:              :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#10252L,ca_address_id#10253,ca_street_number#10254,ca_street_name#10255,ca_street_type#10256,ca_suite_number#10257,ca_city#10258,ca_county#10259,ca_state#10260,ca_zip#10261,ca_country#10262,ca_gmt_offset#10263,ca_location_type#10264] orc
:              :     :     :     +- Project [c_customer_sk#10234L, c_current_addr_sk#10238L, c_first_name#10242, c_last_name#10243, c_birth_country#10248]
:              :     :     :        +- Filter (isnotnull(c_customer_sk#10234L) AND (isnotnull(c_current_addr_sk#10238L) AND isnotnull(c_birth_country#10248)))
:              :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10234L,c_customer_id#10235,c_current_cdemo_sk#10236L,c_current_hdemo_sk#10237L,c_current_addr_sk#10238L,c_first_shipto_date_sk#10239L,c_first_sales_date_sk#10240L,c_salutation#10241,c_first_name#10242,c_last_name#10243,c_preferred_cust_flag#10244,c_birth_day#10245,c_birth_month#10246,c_birth_year#10247,c_birth_country#10248,c_login#10249,c_email_address#10250,c_last_review_date#10251] orc
:              :     :     +- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152]
:              :     :        +- Filter (((isnotnull(ss_ticket_number#10148L) AND isnotnull(ss_item_sk#10141L)) AND isnotnull(ss_store_sk#10146L)) AND isnotnull(ss_customer_sk#10142L))
:              :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10140L,ss_item_sk#10141L,ss_customer_sk#10142L,ss_cdemo_sk#10143L,ss_hdemo_sk#10144L,ss_addr_sk#10145L,ss_store_sk#10146L,ss_promo_sk#10147L,ss_ticket_number#10148L,ss_quantity#10149,ss_wholesale_cost#10150,ss_list_price#10151,ss_sales_price#10152,ss_ext_discount_amt#10153,ss_ext_sales_price#10154,ss_ext_wholesale_cost#10155,ss_ext_list_price#10156,ss_ext_tax#10157,ss_coupon_amt#10158,ss_net_paid#10159,ss_net_paid_inc_tax#10160,ss_net_profit#10161,ss_sold_date_sk#10162L] orc
:              :     +- Project [i_item_sk#10212L, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
:              :        +- Filter isnotnull(i_item_sk#10212L)
:              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10212L,i_item_id#10213,i_rec_start_date#10214,i_rec_end_date#10215,i_item_desc#10216,i_current_price#10217,i_wholesale_cost#10218,i_brand_id#10219,i_brand#10220,i_class_id#10221,i_class#10222,i_category_id#10223,i_category#10224,i_manufact_id#10225,i_manufact#10226,i_size#10227,i_formulation#10228,i_color#10229,i_units#10230,i_container#10231,i_manager_id#10232,i_product_name#10233] orc
:              +- Project [sr_item_sk#10164L, sr_ticket_number#10171L]
:                 +- Filter (isnotnull(sr_ticket_number#10171L) AND isnotnull(sr_item_sk#10164L))
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#10163L,sr_item_sk#10164L,sr_customer_sk#10165L,sr_cdemo_sk#10166L,sr_hdemo_sk#10167L,sr_addr_sk#10168L,sr_store_sk#10169L,sr_reason_sk#10170L,sr_ticket_number#10171L,sr_return_quantity#10172,sr_return_amt#10173,sr_return_tax#10174,sr_return_amt_inc_tax#10175,sr_fee#10176,sr_return_ship_cost#10177,sr_refunded_cash#10178,sr_reversed_charge#10179,sr_store_credit#10180,sr_net_loss#10181,sr_returned_date_sk#10182L] orc
+- Aggregate [c_last_name#10243, c_first_name#10242, s_store_name#10188], [c_last_name#10243, c_first_name#10242, s_store_name#10188, sum(netpaid#10139) AS paid#10137]
   +- Aggregate [c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], [c_last_name#10243, c_first_name#10242, s_store_name#10188, sum(ss_sales_price#10152) AS netpaid#10139]
      +- Project [ss_sales_price#10152, s_store_name#10188, s_state#10207, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232, c_first_name#10242, c_last_name#10243, ca_state#10260]
         +- Join Inner, ((ss_ticket_number#10148L = sr_ticket_number#10171L) AND (ss_item_sk#10141L = sr_item_sk#10164L))
            :- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
            :  +- Join Inner, ((ss_store_sk#10146L = s_store_sk#10183L) AND (ss_customer_sk#10142L = c_customer_sk#10234L))
            :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_state#10260, c_customer_sk#10234L, c_first_name#10242, c_last_name#10243]
            :     :  +- Join Inner, ((c_current_addr_sk#10238L = ca_address_sk#10252L) AND NOT (c_birth_country#10248 = upper(ca_country#10262)))
            :     :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_address_sk#10252L, ca_state#10260, ca_country#10262]
            :     :     :  +- Join Inner, (s_zip#10208 = ca_zip#10261)
            :     :     :     :- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, s_zip#10208]
            :     :     :     :  +- Filter (((isnotnull(s_market_id#10193) AND (s_market_id#10193 = 7)) AND isnotnull(s_store_sk#10183L)) AND isnotnull(s_zip#10208))
            :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10183L,s_store_id#10184,s_rec_start_date#10185,s_rec_end_date#10186,s_closed_date_sk#10187L,s_store_name#10188,s_number_employees#10189,s_floor_space#10190,s_hours#10191,s_manager#10192,s_market_id#10193,s_geography_class#10194,s_market_desc#10195,s_market_manager#10196,s_division_id#10197,s_division_name#10198,s_company_id#10199,s_company_name#10200,s_street_number#10201,s_street_name#10202,s_street_type#10203,s_suite_number#10204,s_city#10205,s_county#10206,... 5 more fields] orc
            :     :     :     +- Project [ca_address_sk#10252L, ca_state#10260, ca_zip#10261, ca_country#10262]
            :     :     :        +- Filter ((isnotnull(ca_address_sk#10252L) AND isnotnull(ca_country#10262)) AND isnotnull(ca_zip#10261))
            :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#10252L,ca_address_id#10253,ca_street_number#10254,ca_street_name#10255,ca_street_type#10256,ca_suite_number#10257,ca_city#10258,ca_county#10259,ca_state#10260,ca_zip#10261,ca_country#10262,ca_gmt_offset#10263,ca_location_type#10264] orc
            :     :     +- Project [c_customer_sk#10234L, c_current_addr_sk#10238L, c_first_name#10242, c_last_name#10243, c_birth_country#10248]
            :     :        +- Filter (isnotnull(c_customer_sk#10234L) AND (isnotnull(c_current_addr_sk#10238L) AND isnotnull(c_birth_country#10248)))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10234L,c_customer_id#10235,c_current_cdemo_sk#10236L,c_current_hdemo_sk#10237L,c_current_addr_sk#10238L,c_first_shipto_date_sk#10239L,c_first_sales_date_sk#10240L,c_salutation#10241,c_first_name#10242,c_last_name#10243,c_preferred_cust_flag#10244,c_birth_day#10245,c_birth_month#10246,c_birth_year#10247,c_birth_country#10248,c_login#10249,c_email_address#10250,c_last_review_date#10251] orc
            :     +- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
            :        +- Join Inner, (ss_item_sk#10141L = i_item_sk#10212L)
            :           :- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152]
            :           :  +- Filter (((isnotnull(ss_ticket_number#10148L) AND isnotnull(ss_item_sk#10141L)) AND isnotnull(ss_store_sk#10146L)) AND isnotnull(ss_customer_sk#10142L))
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10140L,ss_item_sk#10141L,ss_customer_sk#10142L,ss_cdemo_sk#10143L,ss_hdemo_sk#10144L,ss_addr_sk#10145L,ss_store_sk#10146L,ss_promo_sk#10147L,ss_ticket_number#10148L,ss_quantity#10149,ss_wholesale_cost#10150,ss_list_price#10151,ss_sales_price#10152,ss_ext_discount_amt#10153,ss_ext_sales_price#10154,ss_ext_wholesale_cost#10155,ss_ext_list_price#10156,ss_ext_tax#10157,ss_coupon_amt#10158,ss_net_paid#10159,ss_net_paid_inc_tax#10160,ss_net_profit#10161,ss_sold_date_sk#10162L] orc
            :           +- Project [i_item_sk#10212L, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
            :              +- Filter ((isnotnull(i_color#10229) AND (i_color#10229 = orchid)) AND isnotnull(i_item_sk#10212L))
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10212L,i_item_id#10213,i_rec_start_date#10214,i_rec_end_date#10215,i_item_desc#10216,i_current_price#10217,i_wholesale_cost#10218,i_brand_id#10219,i_brand#10220,i_class_id#10221,i_class#10222,i_category_id#10223,i_category#10224,i_manufact_id#10225,i_manufact#10226,i_size#10227,i_formulation#10228,i_color#10229,i_units#10230,i_container#10231,i_manager_id#10232,i_product_name#10233] orc
            +- Project [sr_item_sk#10164L, sr_ticket_number#10171L]
               +- Filter (isnotnull(sr_ticket_number#10171L) AND isnotnull(sr_item_sk#10164L))
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#10163L,sr_item_sk#10164L,sr_customer_sk#10165L,sr_cdemo_sk#10166L,sr_hdemo_sk#10167L,sr_addr_sk#10168L,sr_store_sk#10169L,sr_reason_sk#10170L,sr_ticket_number#10171L,sr_return_quantity#10172,sr_return_amt#10173,sr_return_tax#10174,sr_return_amt_inc_tax#10175,sr_fee#10176,sr_return_ship_cost#10177,sr_refunded_cash#10178,sr_reversed_charge#10179,sr_store_credit#10180,sr_net_loss#10181,sr_returned_date_sk#10182L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Filter (isnotnull(paid#10137) AND (paid#10137 > Subquery subquery#10138, [id=#10595]))
   :  +- Subquery subquery#10138, [id=#10595]
   :     +- AdaptiveSparkPlan isFinalPlan=false
   :        +- HashAggregate(keys=[], functions=[avg(netpaid#10139)], output=[(0.05 * avg(netpaid))#10268])
   :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#10593]
   :              +- HashAggregate(keys=[], functions=[partial_avg(netpaid#10139)], output=[sum#10283, count#10284L])
   :                 +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], functions=[sum(ss_sales_price#10152)], output=[netpaid#10139])
   :                    +- Exchange hashpartitioning(c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, 3000), ENSURE_REQUIREMENTS, [id=#10589]
   :                       +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, knownfloatingpointnormalized(normalizenanandzero(i_current_price#10217)) AS i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], functions=[partial_sum(ss_sales_price#10152)], output=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, sum#10280])
   :                          +- Project [ss_sales_price#10152, s_store_name#10188, s_state#10207, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232, c_first_name#10242, c_last_name#10243, ca_state#10260]
   :                             +- SortMergeJoin [ss_ticket_number#10148L, ss_item_sk#10141L], [sr_ticket_number#10171L, sr_item_sk#10164L], Inner
   :                                :- Sort [ss_ticket_number#10148L ASC NULLS FIRST, ss_item_sk#10141L ASC NULLS FIRST], false, 0
   :                                :  +- Exchange hashpartitioning(ss_ticket_number#10148L, ss_item_sk#10141L, 3000), ENSURE_REQUIREMENTS, [id=#10581]
   :                                :     +- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
   :                                :        +- SortMergeJoin [ss_item_sk#10141L], [i_item_sk#10212L], Inner
   :                                :           :- Sort [ss_item_sk#10141L ASC NULLS FIRST], false, 0
   :                                :           :  +- Exchange hashpartitioning(ss_item_sk#10141L, 3000), ENSURE_REQUIREMENTS, [id=#10573]
   :                                :           :     +- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152]
   :                                :           :        +- SortMergeJoin [s_store_sk#10183L, c_customer_sk#10234L], [ss_store_sk#10146L, ss_customer_sk#10142L], Inner
   :                                :           :           :- Sort [s_store_sk#10183L ASC NULLS FIRST, c_customer_sk#10234L ASC NULLS FIRST], false, 0
   :                                :           :           :  +- Exchange hashpartitioning(s_store_sk#10183L, c_customer_sk#10234L, 3000), ENSURE_REQUIREMENTS, [id=#10565]
   :                                :           :           :     +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_state#10260, c_customer_sk#10234L, c_first_name#10242, c_last_name#10243]
   :                                :           :           :        +- SortMergeJoin [ca_address_sk#10252L], [c_current_addr_sk#10238L], Inner, NOT (c_birth_country#10248 = upper(ca_country#10262))
   :                                :           :           :           :- Sort [ca_address_sk#10252L ASC NULLS FIRST], false, 0
   :                                :           :           :           :  +- Exchange hashpartitioning(ca_address_sk#10252L, 3000), ENSURE_REQUIREMENTS, [id=#10557]
   :                                :           :           :           :     +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_address_sk#10252L, ca_state#10260, ca_country#10262]
   :                                :           :           :           :        +- BroadcastHashJoin [s_zip#10208], [ca_zip#10261], Inner, BuildLeft, false
   :                                :           :           :           :           :- BroadcastExchange HashedRelationBroadcastMode(List(input[3, string, true]),false), [id=#10552]
   :                                :           :           :           :           :  +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, s_zip#10208]
   :                                :           :           :           :           :     +- Filter (((isnotnull(s_market_id#10193) AND (s_market_id#10193 = 7)) AND isnotnull(s_store_sk#10183L)) AND isnotnull(s_zip#10208))
   :                                :           :           :           :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10183L,s_store_name#10188,s_market_id#10193,s_state#10207,s_zip#10208] Batched: true, DataFilters: [isnotnull(s_market_id#10193), (s_market_id#10193 = 7), isnotnull(s_store_sk#10183L), isnotnull(s..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,7), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>
   :                                :           :           :           :           +- Filter ((isnotnull(ca_address_sk#10252L) AND isnotnull(ca_country#10262)) AND isnotnull(ca_zip#10261))
   :                                :           :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#10252L,ca_state#10260,ca_zip#10261,ca_country#10262] Batched: true, DataFilters: [isnotnull(ca_address_sk#10252L), isnotnull(ca_country#10262), isnotnull(ca_zip#10261)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_country), IsNotNull(ca_zip)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_zip:string,ca_country:string>
   :                                :           :           :           +- Sort [c_current_addr_sk#10238L ASC NULLS FIRST], false, 0
   :                                :           :           :              +- Exchange hashpartitioning(c_current_addr_sk#10238L, 3000), ENSURE_REQUIREMENTS, [id=#10558]
   :                                :           :           :                 +- Filter ((isnotnull(c_customer_sk#10234L) AND isnotnull(c_current_addr_sk#10238L)) AND isnotnull(c_birth_country#10248))
   :                                :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10234L,c_current_addr_sk#10238L,c_first_name#10242,c_last_name#10243,c_birth_country#10248] Batched: true, DataFilters: [isnotnull(c_customer_sk#10234L), isnotnull(c_current_addr_sk#10238L), isnotnull(c_birth_country#..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint,c_first_name:string,c_last_name:string,c_bir...
   :                                :           :           +- Sort [ss_store_sk#10146L ASC NULLS FIRST, ss_customer_sk#10142L ASC NULLS FIRST], false, 0
   :                                :           :              +- Exchange hashpartitioning(ss_store_sk#10146L, ss_customer_sk#10142L, 3000), ENSURE_REQUIREMENTS, [id=#10566]
   :                                :           :                 +- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152]
   :                                :           :                    +- Filter (((isnotnull(ss_ticket_number#10148L) AND isnotnull(ss_item_sk#10141L)) AND isnotnull(ss_store_sk#10146L)) AND isnotnull(ss_customer_sk#10142L))
   :                                :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#10141L,ss_customer_sk#10142L,ss_store_sk#10146L,ss_ticket_number#10148L,ss_sales_price#10152,ss_sold_date_sk#10162L] Batched: true, DataFilters: [isnotnull(ss_ticket_number#10148L), isnotnull(ss_item_sk#10141L), isnotnull(ss_store_sk#10146L),..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_ticket_number), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint,ss_sale...
   :                                :           +- Sort [i_item_sk#10212L ASC NULLS FIRST], false, 0
   :                                :              +- Exchange hashpartitioning(i_item_sk#10212L, 3000), ENSURE_REQUIREMENTS, [id=#10574]
   :                                :                 +- Filter isnotnull(i_item_sk#10212L)
   :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10212L,i_current_price#10217,i_size#10227,i_color#10229,i_units#10230,i_manager_id#10232] Batched: true, DataFilters: [isnotnull(i_item_sk#10212L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double,i_size:string,i_color:string,i_units:string,i_mana...
   :                                +- Sort [sr_ticket_number#10171L ASC NULLS FIRST, sr_item_sk#10164L ASC NULLS FIRST], false, 0
   :                                   +- Exchange hashpartitioning(sr_ticket_number#10171L, sr_item_sk#10164L, 3000), ENSURE_REQUIREMENTS, [id=#10582]
   :                                      +- Project [sr_item_sk#10164L, sr_ticket_number#10171L]
   :                                         +- Filter (isnotnull(sr_ticket_number#10171L) AND isnotnull(sr_item_sk#10164L))
   :                                            +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#10164L,sr_ticket_number#10171L,sr_returned_date_sk#10182L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#10171L), isnotnull(sr_item_sk#10164L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint>
   +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188], functions=[sum(netpaid#10139)], output=[c_last_name#10243, c_first_name#10242, s_store_name#10188, paid#10137])
      +- Exchange hashpartitioning(c_last_name#10243, c_first_name#10242, s_store_name#10188, 3000), ENSURE_REQUIREMENTS, [id=#10649]
         +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188], functions=[partial_sum(netpaid#10139)], output=[c_last_name#10243, c_first_name#10242, s_store_name#10188, sum#10278])
            +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], functions=[sum(ss_sales_price#10152)], output=[c_last_name#10243, c_first_name#10242, s_store_name#10188, netpaid#10139])
               +- Exchange hashpartitioning(c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, 3000), ENSURE_REQUIREMENTS, [id=#10645]
                  +- HashAggregate(keys=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, knownfloatingpointnormalized(normalizenanandzero(i_current_price#10217)) AS i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227], functions=[partial_sum(ss_sales_price#10152)], output=[c_last_name#10243, c_first_name#10242, s_store_name#10188, ca_state#10260, s_state#10207, i_color#10229, i_current_price#10217, i_manager_id#10232, i_units#10230, i_size#10227, sum#10280])
                     +- Project [ss_sales_price#10152, s_store_name#10188, s_state#10207, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232, c_first_name#10242, c_last_name#10243, ca_state#10260]
                        +- SortMergeJoin [ss_ticket_number#10148L, ss_item_sk#10141L], [sr_ticket_number#10171L, sr_item_sk#10164L], Inner
                           :- Sort [ss_ticket_number#10148L ASC NULLS FIRST, ss_item_sk#10141L ASC NULLS FIRST], false, 0
                           :  +- Exchange hashpartitioning(ss_ticket_number#10148L, ss_item_sk#10141L, 3000), ENSURE_REQUIREMENTS, [id=#10637]
                           :     +- Project [s_store_name#10188, s_state#10207, ca_state#10260, c_first_name#10242, c_last_name#10243, ss_item_sk#10141L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
                           :        +- SortMergeJoin [s_store_sk#10183L, c_customer_sk#10234L], [ss_store_sk#10146L, ss_customer_sk#10142L], Inner
                           :           :- Sort [s_store_sk#10183L ASC NULLS FIRST, c_customer_sk#10234L ASC NULLS FIRST], false, 0
                           :           :  +- Exchange hashpartitioning(s_store_sk#10183L, c_customer_sk#10234L, 3000), ENSURE_REQUIREMENTS, [id=#10629]
                           :           :     +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_state#10260, c_customer_sk#10234L, c_first_name#10242, c_last_name#10243]
                           :           :        +- SortMergeJoin [ca_address_sk#10252L], [c_current_addr_sk#10238L], Inner, NOT (c_birth_country#10248 = upper(ca_country#10262))
                           :           :           :- Sort [ca_address_sk#10252L ASC NULLS FIRST], false, 0
                           :           :           :  +- Exchange hashpartitioning(ca_address_sk#10252L, 3000), ENSURE_REQUIREMENTS, [id=#10618]
                           :           :           :     +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, ca_address_sk#10252L, ca_state#10260, ca_country#10262]
                           :           :           :        +- BroadcastHashJoin [s_zip#10208], [ca_zip#10261], Inner, BuildLeft, false
                           :           :           :           :- BroadcastExchange HashedRelationBroadcastMode(List(input[3, string, true]),false), [id=#10613]
                           :           :           :           :  +- Project [s_store_sk#10183L, s_store_name#10188, s_state#10207, s_zip#10208]
                           :           :           :           :     +- Filter (((isnotnull(s_market_id#10193) AND (s_market_id#10193 = 7)) AND isnotnull(s_store_sk#10183L)) AND isnotnull(s_zip#10208))
                           :           :           :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10183L,s_store_name#10188,s_market_id#10193,s_state#10207,s_zip#10208] Batched: true, DataFilters: [isnotnull(s_market_id#10193), (s_market_id#10193 = 7), isnotnull(s_store_sk#10183L), isnotnull(s..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,7), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>
                           :           :           :           +- Filter ((isnotnull(ca_address_sk#10252L) AND isnotnull(ca_country#10262)) AND isnotnull(ca_zip#10261))
                           :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#10252L,ca_state#10260,ca_zip#10261,ca_country#10262] Batched: true, DataFilters: [isnotnull(ca_address_sk#10252L), isnotnull(ca_country#10262), isnotnull(ca_zip#10261)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_country), IsNotNull(ca_zip)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_zip:string,ca_country:string>
                           :           :           +- Sort [c_current_addr_sk#10238L ASC NULLS FIRST], false, 0
                           :           :              +- Exchange hashpartitioning(c_current_addr_sk#10238L, 3000), ENSURE_REQUIREMENTS, [id=#10619]
                           :           :                 +- Filter ((isnotnull(c_customer_sk#10234L) AND isnotnull(c_current_addr_sk#10238L)) AND isnotnull(c_birth_country#10248))
                           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#10234L,c_current_addr_sk#10238L,c_first_name#10242,c_last_name#10243,c_birth_country#10248] Batched: true, DataFilters: [isnotnull(c_customer_sk#10234L), isnotnull(c_current_addr_sk#10238L), isnotnull(c_birth_country#..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint,c_first_name:string,c_last_name:string,c_bir...
                           :           +- Sort [ss_store_sk#10146L ASC NULLS FIRST, ss_customer_sk#10142L ASC NULLS FIRST], false, 0
                           :              +- Exchange hashpartitioning(ss_store_sk#10146L, ss_customer_sk#10142L, 3000), ENSURE_REQUIREMENTS, [id=#10630]
                           :                 +- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152, i_current_price#10217, i_size#10227, i_color#10229, i_units#10230, i_manager_id#10232]
                           :                    +- BroadcastHashJoin [ss_item_sk#10141L], [i_item_sk#10212L], Inner, BuildRight, false
                           :                       :- Project [ss_item_sk#10141L, ss_customer_sk#10142L, ss_store_sk#10146L, ss_ticket_number#10148L, ss_sales_price#10152]
                           :                       :  +- Filter (((isnotnull(ss_ticket_number#10148L) AND isnotnull(ss_item_sk#10141L)) AND isnotnull(ss_store_sk#10146L)) AND isnotnull(ss_customer_sk#10142L))
                           :                       :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#10141L,ss_customer_sk#10142L,ss_store_sk#10146L,ss_ticket_number#10148L,ss_sales_price#10152,ss_sold_date_sk#10162L] Batched: true, DataFilters: [isnotnull(ss_ticket_number#10148L), isnotnull(ss_item_sk#10141L), isnotnull(ss_store_sk#10146L),..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_ticket_number), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint,ss_sale...
                           :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#10624]
                           :                          +- Filter ((isnotnull(i_color#10229) AND (i_color#10229 = orchid)) AND isnotnull(i_item_sk#10212L))
                           :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10212L,i_current_price#10217,i_size#10227,i_color#10229,i_units#10230,i_manager_id#10232] Batched: true, DataFilters: [isnotnull(i_color#10229), (i_color#10229 = orchid), isnotnull(i_item_sk#10212L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_color), EqualTo(i_color,orchid), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double,i_size:string,i_color:string,i_units:string,i_mana...
                           +- Sort [sr_ticket_number#10171L ASC NULLS FIRST, sr_item_sk#10164L ASC NULLS FIRST], false, 0
                              +- Exchange hashpartitioning(sr_ticket_number#10171L, sr_item_sk#10164L, 3000), ENSURE_REQUIREMENTS, [id=#10638]
                                 +- Project [sr_item_sk#10164L, sr_ticket_number#10171L]
                                    +- Filter (isnotnull(sr_ticket_number#10171L) AND isnotnull(sr_item_sk#10164L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#10164L,sr_ticket_number#10171L,sr_returned_date_sk#10182L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#10171L), isnotnull(sr_item_sk#10164L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint>

read query: spark_queries/q25.sql
explain query: q25
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name], ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name, 'sum('ss_net_profit) AS store_sales_profit#10285, 'sum('sr_net_loss) AS store_returns_loss#10286, 'sum('cs_net_profit) AS catalog_sales_profit#10287]
         +- 'Filter ((((('d1.d_moy = 4) AND ('d1.d_year = 2000)) AND (('d1.d_date_sk = 'ss_sold_date_sk) AND ('i_item_sk = 'ss_item_sk))) AND ((('s_store_sk = 'ss_store_sk) AND ('ss_customer_sk = 'sr_customer_sk)) AND (('ss_item_sk = 'sr_item_sk) AND ('ss_ticket_number = 'sr_ticket_number)))) AND (((('sr_returned_date_sk = 'd2.d_date_sk) AND (('d2.d_moy >= 4) AND ('d2.d_moy <= 10))) AND (('d2.d_year = 2000) AND ('sr_customer_sk = 'cs_bill_customer_sk))) AND ((('sr_item_sk = 'cs_item_sk) AND ('cs_sold_date_sk = 'd3.d_date_sk)) AND ((('d3.d_moy >= 4) AND ('d3.d_moy <= 10)) AND ('d3.d_year = 2000)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
               :  :  :  :  :  +- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  :  +- 'SubqueryAlias d1
               :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  :  +- 'SubqueryAlias d2
               :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  +- 'SubqueryAlias d3
               :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_item_id: string, i_item_desc: string, s_store_id: string, s_store_name: string, store_sales_profit: double, store_returns_loss: double, catalog_sales_profit: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10479 ASC NULLS FIRST, i_item_desc#10482 ASC NULLS FIRST, s_store_id#10450 ASC NULLS FIRST, s_store_name#10454 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454], [i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454, sum(ss_net_profit#10309) AS store_sales_profit#10285, sum(sr_net_loss#10329) AS store_returns_loss#10286, sum(cs_net_profit#10363) AS catalog_sales_profit#10287]
         +- Filter (((((d_moy#10373 = 4) AND (d_year#10371 = 2000)) AND ((d_date_sk#10365L = ss_sold_date_sk#10310L) AND (i_item_sk#10478L = ss_item_sk#10289L))) AND (((s_store_sk#10449L = ss_store_sk#10294L) AND (ss_customer_sk#10290L = sr_customer_sk#10313L)) AND ((ss_item_sk#10289L = sr_item_sk#10312L) AND (ss_ticket_number#10296L = sr_ticket_number#10319L)))) AND ((((sr_returned_date_sk#10330L = d_date_sk#10393L) AND ((d_moy#10401 >= 4) AND (d_moy#10401 <= 10))) AND ((d_year#10399 = 2000) AND (sr_customer_sk#10313L = cs_bill_customer_sk#10333L))) AND (((sr_item_sk#10312L = cs_item_sk#10345L) AND (cs_sold_date_sk#10364L = d_date_sk#10421L)) AND (((d_moy#10429 >= 4) AND (d_moy#10429 <= 10)) AND (d_year#10427 = 2000)))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- Join Inner
               :  :  :  :  :  :- Join Inner
               :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10288L,ss_item_sk#10289L,ss_customer_sk#10290L,ss_cdemo_sk#10291L,ss_hdemo_sk#10292L,ss_addr_sk#10293L,ss_store_sk#10294L,ss_promo_sk#10295L,ss_ticket_number#10296L,ss_quantity#10297,ss_wholesale_cost#10298,ss_list_price#10299,ss_sales_price#10300,ss_ext_discount_amt#10301,ss_ext_sales_price#10302,ss_ext_wholesale_cost#10303,ss_ext_list_price#10304,ss_ext_tax#10305,ss_coupon_amt#10306,ss_net_paid#10307,ss_net_paid_inc_tax#10308,ss_net_profit#10309,ss_sold_date_sk#10310L] orc
               :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
               :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#10311L,sr_item_sk#10312L,sr_customer_sk#10313L,sr_cdemo_sk#10314L,sr_hdemo_sk#10315L,sr_addr_sk#10316L,sr_store_sk#10317L,sr_reason_sk#10318L,sr_ticket_number#10319L,sr_return_quantity#10320,sr_return_amt#10321,sr_return_tax#10322,sr_return_amt_inc_tax#10323,sr_fee#10324,sr_return_ship_cost#10325,sr_refunded_cash#10326,sr_reversed_charge#10327,sr_store_credit#10328,sr_net_loss#10329,sr_returned_date_sk#10330L] orc
               :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#10331L,cs_ship_date_sk#10332L,cs_bill_customer_sk#10333L,cs_bill_cdemo_sk#10334L,cs_bill_hdemo_sk#10335L,cs_bill_addr_sk#10336L,cs_ship_customer_sk#10337L,cs_ship_cdemo_sk#10338L,cs_ship_hdemo_sk#10339L,cs_ship_addr_sk#10340L,cs_call_center_sk#10341L,cs_catalog_page_sk#10342L,cs_ship_mode_sk#10343L,cs_warehouse_sk#10344L,cs_item_sk#10345L,cs_promo_sk#10346L,cs_order_number#10347L,cs_quantity#10348,cs_wholesale_cost#10349,cs_list_price#10350,cs_sales_price#10351,cs_ext_discount_amt#10352,cs_ext_sales_price#10353,cs_ext_wholesale_cost#10354,... 10 more fields] orc
               :  :  :  :  +- SubqueryAlias d1
               :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10365L,d_date_id#10366,d_date#10367,d_month_seq#10368,d_week_seq#10369,d_quarter_seq#10370,d_year#10371,d_dow#10372,d_moy#10373,d_dom#10374,d_qoy#10375,d_fy_year#10376,d_fy_quarter_seq#10377,d_fy_week_seq#10378,d_day_name#10379,d_quarter_name#10380,d_holiday#10381,d_weekend#10382,d_following_holiday#10383,d_first_dom#10384,d_last_dom#10385,d_same_day_ly#10386,d_same_day_lq#10387,d_current_day#10388,... 4 more fields] orc
               :  :  :  +- SubqueryAlias d2
               :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10393L,d_date_id#10394,d_date#10395,d_month_seq#10396,d_week_seq#10397,d_quarter_seq#10398,d_year#10399,d_dow#10400,d_moy#10401,d_dom#10402,d_qoy#10403,d_fy_year#10404,d_fy_quarter_seq#10405,d_fy_week_seq#10406,d_day_name#10407,d_quarter_name#10408,d_holiday#10409,d_weekend#10410,d_following_holiday#10411,d_first_dom#10412,d_last_dom#10413,d_same_day_ly#10414,d_same_day_lq#10415,d_current_day#10416,... 4 more fields] orc
               :  :  +- SubqueryAlias d3
               :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10421L,d_date_id#10422,d_date#10423,d_month_seq#10424,d_week_seq#10425,d_quarter_seq#10426,d_year#10427,d_dow#10428,d_moy#10429,d_dom#10430,d_qoy#10431,d_fy_year#10432,d_fy_quarter_seq#10433,d_fy_week_seq#10434,d_day_name#10435,d_quarter_name#10436,d_holiday#10437,d_weekend#10438,d_following_holiday#10439,d_first_dom#10440,d_last_dom#10441,d_same_day_ly#10442,d_same_day_lq#10443,d_current_day#10444,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10449L,s_store_id#10450,s_rec_start_date#10451,s_rec_end_date#10452,s_closed_date_sk#10453L,s_store_name#10454,s_number_employees#10455,s_floor_space#10456,s_hours#10457,s_manager#10458,s_market_id#10459,s_geography_class#10460,s_market_desc#10461,s_market_manager#10462,s_division_id#10463,s_division_name#10464,s_company_id#10465,s_company_name#10466,s_street_number#10467,s_street_name#10468,s_street_type#10469,s_suite_number#10470,s_city#10471,s_county#10472,... 5 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10478L,i_item_id#10479,i_rec_start_date#10480,i_rec_end_date#10481,i_item_desc#10482,i_current_price#10483,i_wholesale_cost#10484,i_brand_id#10485,i_brand#10486,i_class_id#10487,i_class#10488,i_category_id#10489,i_category#10490,i_manufact_id#10491,i_manufact#10492,i_size#10493,i_formulation#10494,i_color#10495,i_units#10496,i_container#10497,i_manager_id#10498,i_product_name#10499] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10479 ASC NULLS FIRST, i_item_desc#10482 ASC NULLS FIRST, s_store_id#10450 ASC NULLS FIRST, s_store_name#10454 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454], [i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454, sum(ss_net_profit#10309) AS store_sales_profit#10285, sum(sr_net_loss#10329) AS store_returns_loss#10286, sum(cs_net_profit#10363) AS catalog_sales_profit#10287]
         +- Project [ss_net_profit#10309, sr_net_loss#10329, cs_net_profit#10363, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482]
            +- Join Inner, ((sr_customer_sk#10313L = cs_bill_customer_sk#10333L) AND (sr_item_sk#10312L = cs_item_sk#10345L))
               :- Project [ss_net_profit#10309, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482, sr_item_sk#10312L, sr_customer_sk#10313L, sr_net_loss#10329]
               :  +- Join Inner, (((ss_customer_sk#10290L = sr_customer_sk#10313L) AND (ss_item_sk#10289L = sr_item_sk#10312L)) AND (ss_ticket_number#10296L = sr_ticket_number#10319L))
               :     :- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_ticket_number#10296L, ss_net_profit#10309, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482]
               :     :  +- Join Inner, (i_item_sk#10478L = ss_item_sk#10289L)
               :     :     :- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_ticket_number#10296L, ss_net_profit#10309, s_store_id#10450, s_store_name#10454]
               :     :     :  +- Join Inner, (s_store_sk#10449L = ss_store_sk#10294L)
               :     :     :     :- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_store_sk#10294L, ss_ticket_number#10296L, ss_net_profit#10309]
               :     :     :     :  +- Join Inner, (d_date_sk#10365L = ss_sold_date_sk#10310L)
               :     :     :     :     :- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_store_sk#10294L, ss_ticket_number#10296L, ss_net_profit#10309, ss_sold_date_sk#10310L]
               :     :     :     :     :  +- Filter (((((isnotnull(ss_customer_sk#10290L) AND isnotnull(ss_item_sk#10289L)) AND isnotnull(ss_ticket_number#10296L)) AND isnotnull(ss_sold_date_sk#10310L)) AND isnotnull(ss_store_sk#10294L)) AND dynamicpruning#10510 [ss_sold_date_sk#10310L])
               :     :     :     :     :     :  +- Project [d_date_sk#10365L]
               :     :     :     :     :     :     +- Filter (((isnotnull(d_moy#10373) AND isnotnull(d_year#10371)) AND ((d_moy#10373 = 4) AND (d_year#10371 = 2000))) AND isnotnull(d_date_sk#10365L))
               :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10365L,d_date_id#10366,d_date#10367,d_month_seq#10368,d_week_seq#10369,d_quarter_seq#10370,d_year#10371,d_dow#10372,d_moy#10373,d_dom#10374,d_qoy#10375,d_fy_year#10376,d_fy_quarter_seq#10377,d_fy_week_seq#10378,d_day_name#10379,d_quarter_name#10380,d_holiday#10381,d_weekend#10382,d_following_holiday#10383,d_first_dom#10384,d_last_dom#10385,d_same_day_ly#10386,d_same_day_lq#10387,d_current_day#10388,... 4 more fields] orc
               :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10288L,ss_item_sk#10289L,ss_customer_sk#10290L,ss_cdemo_sk#10291L,ss_hdemo_sk#10292L,ss_addr_sk#10293L,ss_store_sk#10294L,ss_promo_sk#10295L,ss_ticket_number#10296L,ss_quantity#10297,ss_wholesale_cost#10298,ss_list_price#10299,ss_sales_price#10300,ss_ext_discount_amt#10301,ss_ext_sales_price#10302,ss_ext_wholesale_cost#10303,ss_ext_list_price#10304,ss_ext_tax#10305,ss_coupon_amt#10306,ss_net_paid#10307,ss_net_paid_inc_tax#10308,ss_net_profit#10309,ss_sold_date_sk#10310L] orc
               :     :     :     :     +- Project [d_date_sk#10365L]
               :     :     :     :        +- Filter (((isnotnull(d_moy#10373) AND isnotnull(d_year#10371)) AND ((d_moy#10373 = 4) AND (d_year#10371 = 2000))) AND isnotnull(d_date_sk#10365L))
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10365L,d_date_id#10366,d_date#10367,d_month_seq#10368,d_week_seq#10369,d_quarter_seq#10370,d_year#10371,d_dow#10372,d_moy#10373,d_dom#10374,d_qoy#10375,d_fy_year#10376,d_fy_quarter_seq#10377,d_fy_week_seq#10378,d_day_name#10379,d_quarter_name#10380,d_holiday#10381,d_weekend#10382,d_following_holiday#10383,d_first_dom#10384,d_last_dom#10385,d_same_day_ly#10386,d_same_day_lq#10387,d_current_day#10388,... 4 more fields] orc
               :     :     :     +- Project [s_store_sk#10449L, s_store_id#10450, s_store_name#10454]
               :     :     :        +- Filter isnotnull(s_store_sk#10449L)
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10449L,s_store_id#10450,s_rec_start_date#10451,s_rec_end_date#10452,s_closed_date_sk#10453L,s_store_name#10454,s_number_employees#10455,s_floor_space#10456,s_hours#10457,s_manager#10458,s_market_id#10459,s_geography_class#10460,s_market_desc#10461,s_market_manager#10462,s_division_id#10463,s_division_name#10464,s_company_id#10465,s_company_name#10466,s_street_number#10467,s_street_name#10468,s_street_type#10469,s_suite_number#10470,s_city#10471,s_county#10472,... 5 more fields] orc
               :     :     +- Project [i_item_sk#10478L, i_item_id#10479, i_item_desc#10482]
               :     :        +- Filter isnotnull(i_item_sk#10478L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10478L,i_item_id#10479,i_rec_start_date#10480,i_rec_end_date#10481,i_item_desc#10482,i_current_price#10483,i_wholesale_cost#10484,i_brand_id#10485,i_brand#10486,i_class_id#10487,i_class#10488,i_category_id#10489,i_category#10490,i_manufact_id#10491,i_manufact#10492,i_size#10493,i_formulation#10494,i_color#10495,i_units#10496,i_container#10497,i_manager_id#10498,i_product_name#10499] orc
               :     +- Project [sr_item_sk#10312L, sr_customer_sk#10313L, sr_ticket_number#10319L, sr_net_loss#10329]
               :        +- Join Inner, (sr_returned_date_sk#10330L = d_date_sk#10393L)
               :           :- Project [sr_item_sk#10312L, sr_customer_sk#10313L, sr_ticket_number#10319L, sr_net_loss#10329, sr_returned_date_sk#10330L]
               :           :  +- Filter ((((isnotnull(sr_customer_sk#10313L) AND isnotnull(sr_item_sk#10312L)) AND isnotnull(sr_ticket_number#10319L)) AND isnotnull(sr_returned_date_sk#10330L)) AND dynamicpruning#10511 [sr_returned_date_sk#10330L])
               :           :     :  +- Project [d_date_sk#10393L]
               :           :     :     +- Filter (((isnotnull(d_moy#10401) AND isnotnull(d_year#10399)) AND (((d_moy#10401 >= 4) AND (d_moy#10401 <= 10)) AND (d_year#10399 = 2000))) AND isnotnull(d_date_sk#10393L))
               :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10393L,d_date_id#10394,d_date#10395,d_month_seq#10396,d_week_seq#10397,d_quarter_seq#10398,d_year#10399,d_dow#10400,d_moy#10401,d_dom#10402,d_qoy#10403,d_fy_year#10404,d_fy_quarter_seq#10405,d_fy_week_seq#10406,d_day_name#10407,d_quarter_name#10408,d_holiday#10409,d_weekend#10410,d_following_holiday#10411,d_first_dom#10412,d_last_dom#10413,d_same_day_ly#10414,d_same_day_lq#10415,d_current_day#10416,... 4 more fields] orc
               :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#10311L,sr_item_sk#10312L,sr_customer_sk#10313L,sr_cdemo_sk#10314L,sr_hdemo_sk#10315L,sr_addr_sk#10316L,sr_store_sk#10317L,sr_reason_sk#10318L,sr_ticket_number#10319L,sr_return_quantity#10320,sr_return_amt#10321,sr_return_tax#10322,sr_return_amt_inc_tax#10323,sr_fee#10324,sr_return_ship_cost#10325,sr_refunded_cash#10326,sr_reversed_charge#10327,sr_store_credit#10328,sr_net_loss#10329,sr_returned_date_sk#10330L] orc
               :           +- Project [d_date_sk#10393L]
               :              +- Filter (((isnotnull(d_moy#10401) AND isnotnull(d_year#10399)) AND (((d_moy#10401 >= 4) AND (d_moy#10401 <= 10)) AND (d_year#10399 = 2000))) AND isnotnull(d_date_sk#10393L))
               :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10393L,d_date_id#10394,d_date#10395,d_month_seq#10396,d_week_seq#10397,d_quarter_seq#10398,d_year#10399,d_dow#10400,d_moy#10401,d_dom#10402,d_qoy#10403,d_fy_year#10404,d_fy_quarter_seq#10405,d_fy_week_seq#10406,d_day_name#10407,d_quarter_name#10408,d_holiday#10409,d_weekend#10410,d_following_holiday#10411,d_first_dom#10412,d_last_dom#10413,d_same_day_ly#10414,d_same_day_lq#10415,d_current_day#10416,... 4 more fields] orc
               +- Project [cs_bill_customer_sk#10333L, cs_item_sk#10345L, cs_net_profit#10363]
                  +- Join Inner, (cs_sold_date_sk#10364L = d_date_sk#10421L)
                     :- Project [cs_bill_customer_sk#10333L, cs_item_sk#10345L, cs_net_profit#10363, cs_sold_date_sk#10364L]
                     :  +- Filter (((isnotnull(cs_bill_customer_sk#10333L) AND isnotnull(cs_item_sk#10345L)) AND isnotnull(cs_sold_date_sk#10364L)) AND dynamicpruning#10512 [cs_sold_date_sk#10364L])
                     :     :  +- Project [d_date_sk#10421L]
                     :     :     +- Filter (((isnotnull(d_moy#10429) AND isnotnull(d_year#10427)) AND (((d_moy#10429 >= 4) AND (d_moy#10429 <= 10)) AND (d_year#10427 = 2000))) AND isnotnull(d_date_sk#10421L))
                     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10421L,d_date_id#10422,d_date#10423,d_month_seq#10424,d_week_seq#10425,d_quarter_seq#10426,d_year#10427,d_dow#10428,d_moy#10429,d_dom#10430,d_qoy#10431,d_fy_year#10432,d_fy_quarter_seq#10433,d_fy_week_seq#10434,d_day_name#10435,d_quarter_name#10436,d_holiday#10437,d_weekend#10438,d_following_holiday#10439,d_first_dom#10440,d_last_dom#10441,d_same_day_ly#10442,d_same_day_lq#10443,d_current_day#10444,... 4 more fields] orc
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#10331L,cs_ship_date_sk#10332L,cs_bill_customer_sk#10333L,cs_bill_cdemo_sk#10334L,cs_bill_hdemo_sk#10335L,cs_bill_addr_sk#10336L,cs_ship_customer_sk#10337L,cs_ship_cdemo_sk#10338L,cs_ship_hdemo_sk#10339L,cs_ship_addr_sk#10340L,cs_call_center_sk#10341L,cs_catalog_page_sk#10342L,cs_ship_mode_sk#10343L,cs_warehouse_sk#10344L,cs_item_sk#10345L,cs_promo_sk#10346L,cs_order_number#10347L,cs_quantity#10348,cs_wholesale_cost#10349,cs_list_price#10350,cs_sales_price#10351,cs_ext_discount_amt#10352,cs_ext_sales_price#10353,cs_ext_wholesale_cost#10354,... 10 more fields] orc
                     +- Project [d_date_sk#10421L]
                        +- Filter (((isnotnull(d_moy#10429) AND isnotnull(d_year#10427)) AND (((d_moy#10429 >= 4) AND (d_moy#10429 <= 10)) AND (d_year#10427 = 2000))) AND isnotnull(d_date_sk#10421L))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10421L,d_date_id#10422,d_date#10423,d_month_seq#10424,d_week_seq#10425,d_quarter_seq#10426,d_year#10427,d_dow#10428,d_moy#10429,d_dom#10430,d_qoy#10431,d_fy_year#10432,d_fy_quarter_seq#10433,d_fy_week_seq#10434,d_day_name#10435,d_quarter_name#10436,d_holiday#10437,d_weekend#10438,d_following_holiday#10439,d_first_dom#10440,d_last_dom#10441,d_same_day_ly#10442,d_same_day_lq#10443,d_current_day#10444,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#10479 ASC NULLS FIRST,i_item_desc#10482 ASC NULLS FIRST,s_store_id#10450 ASC NULLS FIRST,s_store_name#10454 ASC NULLS FIRST], output=[i_item_id#10479,i_item_desc#10482,s_store_id#10450,s_store_name#10454,store_sales_profit#10285,store_returns_loss#10286,catalog_sales_profit#10287])
   +- HashAggregate(keys=[i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454], functions=[sum(ss_net_profit#10309), sum(sr_net_loss#10329), sum(cs_net_profit#10363)], output=[i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454, store_sales_profit#10285, store_returns_loss#10286, catalog_sales_profit#10287])
      +- Exchange hashpartitioning(i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454, 3000), ENSURE_REQUIREMENTS, [id=#10882]
         +- HashAggregate(keys=[i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454], functions=[partial_sum(ss_net_profit#10309), partial_sum(sr_net_loss#10329), partial_sum(cs_net_profit#10363)], output=[i_item_id#10479, i_item_desc#10482, s_store_id#10450, s_store_name#10454, sum#10516, sum#10517, sum#10518])
            +- Project [ss_net_profit#10309, sr_net_loss#10329, cs_net_profit#10363, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482]
               +- SortMergeJoin [sr_customer_sk#10313L, sr_item_sk#10312L], [cs_bill_customer_sk#10333L, cs_item_sk#10345L], Inner
                  :- Sort [sr_customer_sk#10313L ASC NULLS FIRST, sr_item_sk#10312L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(sr_customer_sk#10313L, sr_item_sk#10312L, 3000), ENSURE_REQUIREMENTS, [id=#10874]
                  :     +- Project [ss_net_profit#10309, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482, sr_item_sk#10312L, sr_customer_sk#10313L, sr_net_loss#10329]
                  :        +- SortMergeJoin [ss_customer_sk#10290L, ss_item_sk#10289L, ss_ticket_number#10296L], [sr_customer_sk#10313L, sr_item_sk#10312L, sr_ticket_number#10319L], Inner
                  :           :- Sort [ss_customer_sk#10290L ASC NULLS FIRST, ss_item_sk#10289L ASC NULLS FIRST, ss_ticket_number#10296L ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(ss_customer_sk#10290L, ss_item_sk#10289L, ss_ticket_number#10296L, 3000), ENSURE_REQUIREMENTS, [id=#10863]
                  :           :     +- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_ticket_number#10296L, ss_net_profit#10309, s_store_id#10450, s_store_name#10454, i_item_id#10479, i_item_desc#10482]
                  :           :        +- SortMergeJoin [ss_item_sk#10289L], [i_item_sk#10478L], Inner
                  :           :           :- Sort [ss_item_sk#10289L ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(ss_item_sk#10289L, 3000), ENSURE_REQUIREMENTS, [id=#10852]
                  :           :           :     +- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_ticket_number#10296L, ss_net_profit#10309, s_store_id#10450, s_store_name#10454]
                  :           :           :        +- BroadcastHashJoin [ss_store_sk#10294L], [s_store_sk#10449L], Inner, BuildRight, false
                  :           :           :           :- Project [ss_item_sk#10289L, ss_customer_sk#10290L, ss_store_sk#10294L, ss_ticket_number#10296L, ss_net_profit#10309]
                  :           :           :           :  +- BroadcastHashJoin [ss_sold_date_sk#10310L], [d_date_sk#10365L], Inner, BuildRight, false
                  :           :           :           :     :- Filter (((isnotnull(ss_customer_sk#10290L) AND isnotnull(ss_item_sk#10289L)) AND isnotnull(ss_ticket_number#10296L)) AND isnotnull(ss_store_sk#10294L))
                  :           :           :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#10289L,ss_customer_sk#10290L,ss_store_sk#10294L,ss_ticket_number#10296L,ss_net_profit#10309,ss_sold_date_sk#10310L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#10290L), isnotnull(ss_item_sk#10289L), isnotnull(ss_ticket_number#10296..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#10310L), dynamicpruningexpression(ss_sold_date_sk#10310L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint,ss_net_...
                  :           :           :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#10510, 0, true, Project [d_date_sk#10365L], [d_date_sk#10365L]
                  :           :           :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :           :           :     :              +- Project [d_date_sk#10365L]
                  :           :           :           :     :                 +- Filter ((((isnotnull(d_moy#10373) AND isnotnull(d_year#10371)) AND (d_moy#10373 = 4)) AND (d_year#10371 = 2000)) AND isnotnull(d_date_sk#10365L))
                  :           :           :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10365L,d_year#10371,d_moy#10373] Batched: true, DataFilters: [isnotnull(d_moy#10373), isnotnull(d_year#10371), (d_moy#10373 = 4), (d_year#10371 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,4), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10843]
                  :           :           :           :        +- Project [d_date_sk#10365L]
                  :           :           :           :           +- Filter ((((isnotnull(d_moy#10373) AND isnotnull(d_year#10371)) AND (d_moy#10373 = 4)) AND (d_year#10371 = 2000)) AND isnotnull(d_date_sk#10365L))
                  :           :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10365L,d_year#10371,d_moy#10373] Batched: true, DataFilters: [isnotnull(d_moy#10373), isnotnull(d_year#10371), (d_moy#10373 = 4), (d_year#10371 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,4), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#10847]
                  :           :           :              +- Filter isnotnull(s_store_sk#10449L)
                  :           :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10449L,s_store_id#10450,s_store_name#10454] Batched: true, DataFilters: [isnotnull(s_store_sk#10449L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string,s_store_name:string>
                  :           :           +- Sort [i_item_sk#10478L ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(i_item_sk#10478L, 3000), ENSURE_REQUIREMENTS, [id=#10853]
                  :           :                 +- Filter isnotnull(i_item_sk#10478L)
                  :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10478L,i_item_id#10479,i_item_desc#10482] Batched: true, DataFilters: [isnotnull(i_item_sk#10478L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string>
                  :           +- Sort [sr_customer_sk#10313L ASC NULLS FIRST, sr_item_sk#10312L ASC NULLS FIRST, sr_ticket_number#10319L ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(sr_customer_sk#10313L, sr_item_sk#10312L, sr_ticket_number#10319L, 3000), ENSURE_REQUIREMENTS, [id=#10864]
                  :                 +- Project [sr_item_sk#10312L, sr_customer_sk#10313L, sr_ticket_number#10319L, sr_net_loss#10329]
                  :                    +- BroadcastHashJoin [sr_returned_date_sk#10330L], [d_date_sk#10393L], Inner, BuildRight, false
                  :                       :- Filter ((isnotnull(sr_customer_sk#10313L) AND isnotnull(sr_item_sk#10312L)) AND isnotnull(sr_ticket_number#10319L))
                  :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#10312L,sr_customer_sk#10313L,sr_ticket_number#10319L,sr_net_loss#10329,sr_returned_date_sk#10330L] Batched: true, DataFilters: [isnotnull(sr_customer_sk#10313L), isnotnull(sr_item_sk#10312L), isnotnull(sr_ticket_number#10319L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#10330L), dynamicpruningexpression(sr_returned_date_sk#10330L IN dy..., PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_customer_sk:bigint,sr_ticket_number:bigint,sr_net_loss:double>
                  :                       :        +- SubqueryAdaptiveBroadcast dynamicpruning#10511, 0, true, Project [d_date_sk#10393L], [d_date_sk#10393L]
                  :                       :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                       :              +- Project [d_date_sk#10393L]
                  :                       :                 +- Filter (((((isnotnull(d_moy#10401) AND isnotnull(d_year#10399)) AND (d_moy#10401 >= 4)) AND (d_moy#10401 <= 10)) AND (d_year#10399 = 2000)) AND isnotnull(d_date_sk#10393L))
                  :                       :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10393L,d_year#10399,d_moy#10401] Batched: true, DataFilters: [isnotnull(d_moy#10401), isnotnull(d_year#10399), (d_moy#10401 >= 4), (d_moy#10401 <= 10), (d_yea..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,10), Equ..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10858]
                  :                          +- Project [d_date_sk#10393L]
                  :                             +- Filter (((((isnotnull(d_moy#10401) AND isnotnull(d_year#10399)) AND (d_moy#10401 >= 4)) AND (d_moy#10401 <= 10)) AND (d_year#10399 = 2000)) AND isnotnull(d_date_sk#10393L))
                  :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10393L,d_year#10399,d_moy#10401] Batched: true, DataFilters: [isnotnull(d_moy#10401), isnotnull(d_year#10399), (d_moy#10401 >= 4), (d_moy#10401 <= 10), (d_yea..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,10), Equ..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  +- Sort [cs_bill_customer_sk#10333L ASC NULLS FIRST, cs_item_sk#10345L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cs_bill_customer_sk#10333L, cs_item_sk#10345L, 3000), ENSURE_REQUIREMENTS, [id=#10875]
                        +- Project [cs_bill_customer_sk#10333L, cs_item_sk#10345L, cs_net_profit#10363]
                           +- BroadcastHashJoin [cs_sold_date_sk#10364L], [d_date_sk#10421L], Inner, BuildRight, false
                              :- Filter (isnotnull(cs_bill_customer_sk#10333L) AND isnotnull(cs_item_sk#10345L))
                              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#10333L,cs_item_sk#10345L,cs_net_profit#10363,cs_sold_date_sk#10364L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#10333L), isnotnull(cs_item_sk#10345L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#10364L), dynamicpruningexpression(cs_sold_date_sk#10364L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_net_profit:double>
                              :        +- SubqueryAdaptiveBroadcast dynamicpruning#10512, 0, true, Project [d_date_sk#10421L], [d_date_sk#10421L]
                              :           +- AdaptiveSparkPlan isFinalPlan=false
                              :              +- Project [d_date_sk#10421L]
                              :                 +- Filter (((((isnotnull(d_moy#10429) AND isnotnull(d_year#10427)) AND (d_moy#10429 >= 4)) AND (d_moy#10429 <= 10)) AND (d_year#10427 = 2000)) AND isnotnull(d_date_sk#10421L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10421L,d_year#10427,d_moy#10429] Batched: true, DataFilters: [isnotnull(d_moy#10429), isnotnull(d_year#10427), (d_moy#10429 >= 4), (d_moy#10429 <= 10), (d_yea..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,10), Equ..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10869]
                                 +- Project [d_date_sk#10421L]
                                    +- Filter (((((isnotnull(d_moy#10429) AND isnotnull(d_year#10427)) AND (d_moy#10429 >= 4)) AND (d_moy#10429 <= 10)) AND (d_year#10427 = 2000)) AND isnotnull(d_date_sk#10421L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10421L,d_year#10427,d_moy#10429] Batched: true, DataFilters: [isnotnull(d_moy#10429), isnotnull(d_year#10427), (d_moy#10429 >= 4), (d_moy#10429 <= 10), (d_yea..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,10), Equ..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q26.sql
explain query: q26
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id], ['i_item_id, 'avg('cs_quantity) AS agg1#10519, 'avg('cs_list_price) AS agg2#10520, 'avg('cs_coupon_amt) AS agg3#10521, 'avg('cs_sales_price) AS agg4#10522]
         +- 'Filter ((((('cs_sold_date_sk = 'd_date_sk) AND ('cs_item_sk = 'i_item_sk)) AND ('cs_bill_cdemo_sk = 'cd_demo_sk)) AND (('cs_promo_sk = 'p_promo_sk) AND ('cd_gender = F))) AND ((('cd_marital_status = W) AND ('cd_education_status = Primary)) AND ((('p_channel_email = N) OR ('p_channel_event = N)) AND ('d_year = 1998))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [promotion], [], false

== Analyzed Logical Plan ==
i_item_id: string, agg1: double, agg2: double, agg3: double, agg4: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10595 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10595], [i_item_id#10595, avg(cs_quantity#10540) AS agg1#10519, avg(cs_list_price#10542) AS agg2#10520, avg(cs_coupon_amt#10549) AS agg3#10521, avg(cs_sales_price#10543) AS agg4#10522]
         +- Filter (((((cs_sold_date_sk#10556L = d_date_sk#10566L) AND (cs_item_sk#10537L = i_item_sk#10594L)) AND (cs_bill_cdemo_sk#10526L = cd_demo_sk#10557L)) AND ((cs_promo_sk#10538L = p_promo_sk#10616L) AND (cd_gender#10558 = F))) AND (((cd_marital_status#10559 = W) AND (cd_education_status#10560 = Primary)) AND (((p_channel_email#10625 = N) OR (p_channel_event#10630 = N)) AND (d_year#10572 = 1998))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#10523L,cs_ship_date_sk#10524L,cs_bill_customer_sk#10525L,cs_bill_cdemo_sk#10526L,cs_bill_hdemo_sk#10527L,cs_bill_addr_sk#10528L,cs_ship_customer_sk#10529L,cs_ship_cdemo_sk#10530L,cs_ship_hdemo_sk#10531L,cs_ship_addr_sk#10532L,cs_call_center_sk#10533L,cs_catalog_page_sk#10534L,cs_ship_mode_sk#10535L,cs_warehouse_sk#10536L,cs_item_sk#10537L,cs_promo_sk#10538L,cs_order_number#10539L,cs_quantity#10540,cs_wholesale_cost#10541,cs_list_price#10542,cs_sales_price#10543,cs_ext_discount_amt#10544,cs_ext_sales_price#10545,cs_ext_wholesale_cost#10546,... 10 more fields] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10557L,cd_gender#10558,cd_marital_status#10559,cd_education_status#10560,cd_purchase_estimate#10561,cd_credit_rating#10562,cd_dep_count#10563,cd_dep_employed_count#10564,cd_dep_college_count#10565] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10566L,d_date_id#10567,d_date#10568,d_month_seq#10569,d_week_seq#10570,d_quarter_seq#10571,d_year#10572,d_dow#10573,d_moy#10574,d_dom#10575,d_qoy#10576,d_fy_year#10577,d_fy_quarter_seq#10578,d_fy_week_seq#10579,d_day_name#10580,d_quarter_name#10581,d_holiday#10582,d_weekend#10583,d_following_holiday#10584,d_first_dom#10585,d_last_dom#10586,d_same_day_ly#10587,d_same_day_lq#10588,d_current_day#10589,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10594L,i_item_id#10595,i_rec_start_date#10596,i_rec_end_date#10597,i_item_desc#10598,i_current_price#10599,i_wholesale_cost#10600,i_brand_id#10601,i_brand#10602,i_class_id#10603,i_class#10604,i_category_id#10605,i_category#10606,i_manufact_id#10607,i_manufact#10608,i_size#10609,i_formulation#10610,i_color#10611,i_units#10612,i_container#10613,i_manager_id#10614,i_product_name#10615] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#10616L,p_promo_id#10617,p_start_date_sk#10618L,p_end_date_sk#10619L,p_item_sk#10620L,p_cost#10621,p_response_target#10622,p_promo_name#10623,p_channel_dmail#10624,p_channel_email#10625,p_channel_catalog#10626,p_channel_tv#10627,p_channel_radio#10628,p_channel_press#10629,p_channel_event#10630,p_channel_demo#10631,p_channel_details#10632,p_purpose#10633,p_discount_active#10634] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10595 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10595], [i_item_id#10595, avg(cs_quantity#10540) AS agg1#10519, avg(cs_list_price#10542) AS agg2#10520, avg(cs_coupon_amt#10549) AS agg3#10521, avg(cs_sales_price#10543) AS agg4#10522]
         +- Project [cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549, i_item_id#10595]
            +- Join Inner, (cs_item_sk#10537L = i_item_sk#10594L)
               :- Project [cs_item_sk#10537L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549]
               :  +- Join Inner, (cs_promo_sk#10538L = p_promo_sk#10616L)
               :     :- Project [cs_item_sk#10537L, cs_promo_sk#10538L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549]
               :     :  +- Join Inner, (cs_sold_date_sk#10556L = d_date_sk#10566L)
               :     :     :- Project [cs_item_sk#10537L, cs_promo_sk#10538L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549, cs_sold_date_sk#10556L]
               :     :     :  +- Join Inner, (cs_bill_cdemo_sk#10526L = cd_demo_sk#10557L)
               :     :     :     :- Project [cs_bill_cdemo_sk#10526L, cs_item_sk#10537L, cs_promo_sk#10538L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549, cs_sold_date_sk#10556L]
               :     :     :     :  +- Filter ((((isnotnull(cs_bill_cdemo_sk#10526L) AND isnotnull(cs_sold_date_sk#10556L)) AND isnotnull(cs_item_sk#10537L)) AND isnotnull(cs_promo_sk#10538L)) AND dynamicpruning#10644 [cs_sold_date_sk#10556L])
               :     :     :     :     :  +- Project [d_date_sk#10566L]
               :     :     :     :     :     +- Filter ((isnotnull(d_year#10572) AND (d_year#10572 = 1998)) AND isnotnull(d_date_sk#10566L))
               :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10566L,d_date_id#10567,d_date#10568,d_month_seq#10569,d_week_seq#10570,d_quarter_seq#10571,d_year#10572,d_dow#10573,d_moy#10574,d_dom#10575,d_qoy#10576,d_fy_year#10577,d_fy_quarter_seq#10578,d_fy_week_seq#10579,d_day_name#10580,d_quarter_name#10581,d_holiday#10582,d_weekend#10583,d_following_holiday#10584,d_first_dom#10585,d_last_dom#10586,d_same_day_ly#10587,d_same_day_lq#10588,d_current_day#10589,... 4 more fields] orc
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#10523L,cs_ship_date_sk#10524L,cs_bill_customer_sk#10525L,cs_bill_cdemo_sk#10526L,cs_bill_hdemo_sk#10527L,cs_bill_addr_sk#10528L,cs_ship_customer_sk#10529L,cs_ship_cdemo_sk#10530L,cs_ship_hdemo_sk#10531L,cs_ship_addr_sk#10532L,cs_call_center_sk#10533L,cs_catalog_page_sk#10534L,cs_ship_mode_sk#10535L,cs_warehouse_sk#10536L,cs_item_sk#10537L,cs_promo_sk#10538L,cs_order_number#10539L,cs_quantity#10540,cs_wholesale_cost#10541,cs_list_price#10542,cs_sales_price#10543,cs_ext_discount_amt#10544,cs_ext_sales_price#10545,cs_ext_wholesale_cost#10546,... 10 more fields] orc
               :     :     :     +- Project [cd_demo_sk#10557L]
               :     :     :        +- Filter ((((isnotnull(cd_gender#10558) AND isnotnull(cd_marital_status#10559)) AND isnotnull(cd_education_status#10560)) AND (((cd_gender#10558 = F) AND (cd_marital_status#10559 = W)) AND (cd_education_status#10560 = Primary))) AND isnotnull(cd_demo_sk#10557L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10557L,cd_gender#10558,cd_marital_status#10559,cd_education_status#10560,cd_purchase_estimate#10561,cd_credit_rating#10562,cd_dep_count#10563,cd_dep_employed_count#10564,cd_dep_college_count#10565] orc
               :     :     +- Project [d_date_sk#10566L]
               :     :        +- Filter ((isnotnull(d_year#10572) AND (d_year#10572 = 1998)) AND isnotnull(d_date_sk#10566L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10566L,d_date_id#10567,d_date#10568,d_month_seq#10569,d_week_seq#10570,d_quarter_seq#10571,d_year#10572,d_dow#10573,d_moy#10574,d_dom#10575,d_qoy#10576,d_fy_year#10577,d_fy_quarter_seq#10578,d_fy_week_seq#10579,d_day_name#10580,d_quarter_name#10581,d_holiday#10582,d_weekend#10583,d_following_holiday#10584,d_first_dom#10585,d_last_dom#10586,d_same_day_ly#10587,d_same_day_lq#10588,d_current_day#10589,... 4 more fields] orc
               :     +- Project [p_promo_sk#10616L]
               :        +- Filter (((p_channel_email#10625 = N) OR (p_channel_event#10630 = N)) AND isnotnull(p_promo_sk#10616L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#10616L,p_promo_id#10617,p_start_date_sk#10618L,p_end_date_sk#10619L,p_item_sk#10620L,p_cost#10621,p_response_target#10622,p_promo_name#10623,p_channel_dmail#10624,p_channel_email#10625,p_channel_catalog#10626,p_channel_tv#10627,p_channel_radio#10628,p_channel_press#10629,p_channel_event#10630,p_channel_demo#10631,p_channel_details#10632,p_purpose#10633,p_discount_active#10634] orc
               +- Project [i_item_sk#10594L, i_item_id#10595]
                  +- Filter isnotnull(i_item_sk#10594L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10594L,i_item_id#10595,i_rec_start_date#10596,i_rec_end_date#10597,i_item_desc#10598,i_current_price#10599,i_wholesale_cost#10600,i_brand_id#10601,i_brand#10602,i_class_id#10603,i_class#10604,i_category_id#10605,i_category#10606,i_manufact_id#10607,i_manufact#10608,i_size#10609,i_formulation#10610,i_color#10611,i_units#10612,i_container#10613,i_manager_id#10614,i_product_name#10615] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#10595 ASC NULLS FIRST], output=[i_item_id#10595,agg1#10519,agg2#10520,agg3#10521,agg4#10522])
   +- HashAggregate(keys=[i_item_id#10595], functions=[avg(cs_quantity#10540), avg(cs_list_price#10542), avg(cs_coupon_amt#10549), avg(cs_sales_price#10543)], output=[i_item_id#10595, agg1#10519, agg2#10520, agg3#10521, agg4#10522])
      +- Exchange hashpartitioning(i_item_id#10595, 3000), ENSURE_REQUIREMENTS, [id=#11019]
         +- HashAggregate(keys=[i_item_id#10595], functions=[partial_avg(cs_quantity#10540), partial_avg(cs_list_price#10542), partial_avg(cs_coupon_amt#10549), partial_avg(cs_sales_price#10543)], output=[i_item_id#10595, sum#10653, count#10654L, sum#10655, count#10656L, sum#10657, count#10658L, sum#10659, count#10660L])
            +- Project [cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549, i_item_id#10595]
               +- SortMergeJoin [cs_item_sk#10537L], [i_item_sk#10594L], Inner
                  :- Sort [cs_item_sk#10537L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_item_sk#10537L, 3000), ENSURE_REQUIREMENTS, [id=#11011]
                  :     +- Project [cs_item_sk#10537L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549]
                  :        +- BroadcastHashJoin [cs_promo_sk#10538L], [p_promo_sk#10616L], Inner, BuildRight, false
                  :           :- Project [cs_item_sk#10537L, cs_promo_sk#10538L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549]
                  :           :  +- BroadcastHashJoin [cs_sold_date_sk#10556L], [d_date_sk#10566L], Inner, BuildRight, false
                  :           :     :- Project [cs_item_sk#10537L, cs_promo_sk#10538L, cs_quantity#10540, cs_list_price#10542, cs_sales_price#10543, cs_coupon_amt#10549, cs_sold_date_sk#10556L]
                  :           :     :  +- BroadcastHashJoin [cs_bill_cdemo_sk#10526L], [cd_demo_sk#10557L], Inner, BuildRight, false
                  :           :     :     :- Filter ((isnotnull(cs_bill_cdemo_sk#10526L) AND isnotnull(cs_item_sk#10537L)) AND isnotnull(cs_promo_sk#10538L))
                  :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_cdemo_sk#10526L,cs_item_sk#10537L,cs_promo_sk#10538L,cs_quantity#10540,cs_list_price#10542,cs_sales_price#10543,cs_coupon_amt#10549,cs_sold_date_sk#10556L] Batched: true, DataFilters: [isnotnull(cs_bill_cdemo_sk#10526L), isnotnull(cs_item_sk#10537L), isnotnull(cs_promo_sk#10538L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#10556L), dynamicpruningexpression(cs_sold_date_sk#10556L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_item_sk), IsNotNull(cs_promo_sk)], ReadSchema: struct<cs_bill_cdemo_sk:bigint,cs_item_sk:bigint,cs_promo_sk:bigint,cs_quantity:int,cs_list_price...
                  :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#10644, 0, true, Project [d_date_sk#10566L], [d_date_sk#10566L]
                  :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :     :     :              +- Project [d_date_sk#10566L]
                  :           :     :     :                 +- Filter ((isnotnull(d_year#10572) AND (d_year#10572 = 1998)) AND isnotnull(d_date_sk#10566L))
                  :           :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10566L,d_year#10572] Batched: true, DataFilters: [isnotnull(d_year#10572), (d_year#10572 = 1998), isnotnull(d_date_sk#10566L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#10998]
                  :           :     :        +- Project [cd_demo_sk#10557L]
                  :           :     :           +- Filter ((((((isnotnull(cd_gender#10558) AND isnotnull(cd_marital_status#10559)) AND isnotnull(cd_education_status#10560)) AND (cd_gender#10558 = F)) AND (cd_marital_status#10559 = W)) AND (cd_education_status#10560 = Primary)) AND isnotnull(cd_demo_sk#10557L))
                  :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10557L,cd_gender#10558,cd_marital_status#10559,cd_education_status#10560] Batched: true, DataFilters: [isnotnull(cd_gender#10558), isnotnull(cd_marital_status#10559), isnotnull(cd_education_status#10..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_marital_status), IsNotNull(cd_education_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_education_status:string>
                  :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11002]
                  :           :        +- Project [d_date_sk#10566L]
                  :           :           +- Filter ((isnotnull(d_year#10572) AND (d_year#10572 = 1998)) AND isnotnull(d_date_sk#10566L))
                  :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10566L,d_year#10572] Batched: true, DataFilters: [isnotnull(d_year#10572), (d_year#10572 = 1998), isnotnull(d_date_sk#10566L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11006]
                  :              +- Project [p_promo_sk#10616L]
                  :                 +- Filter (((p_channel_email#10625 = N) OR (p_channel_event#10630 = N)) AND isnotnull(p_promo_sk#10616L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#10616L,p_channel_email#10625,p_channel_event#10630] Batched: true, DataFilters: [((p_channel_email#10625 = N) OR (p_channel_event#10630 = N)), isnotnull(p_promo_sk#10616L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(p_channel_email,N),EqualTo(p_channel_event,N)), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint,p_channel_email:string,p_channel_event:string>
                  +- Sort [i_item_sk#10594L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(i_item_sk#10594L, 3000), ENSURE_REQUIREMENTS, [id=#11012]
                        +- Filter isnotnull(i_item_sk#10594L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10594L,i_item_id#10595] Batched: true, DataFilters: [isnotnull(i_item_sk#10594L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q27.sql
explain query: q27
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST, 's_state ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), 'i_item_id, 's_state)], ['i_item_id, 's_state, 'grouping('s_state) AS g_state#10661, 'avg('ss_quantity) AS agg1#10662, 'avg('ss_list_price) AS agg2#10663, 'avg('ss_coupon_amt) AS agg3#10664, 'avg('ss_sales_price) AS agg4#10665]
         +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND ('ss_store_sk = 's_store_sk)) AND (('ss_cdemo_sk = 'cd_demo_sk) AND ('cd_gender = M))) AND ((('cd_marital_status = U) AND ('cd_education_status = 2 yr Degree)) AND (('d_year = 2001) AND 's_state IN (SD,FL,MI,LA,MO,SC))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_item_id: string, s_state: string, g_state: tinyint, agg1: double, agg2: double, agg3: double, agg4: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10784 ASC NULLS FIRST, s_state#10785 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10784, s_state#10785, spark_grouping_id#10783L], [i_item_id#10784, s_state#10785, cast((shiftright(spark_grouping_id#10783L, 0) & 1) as tinyint) AS g_state#10661, avg(ss_quantity#10675) AS agg1#10662, avg(ss_list_price#10677) AS agg2#10663, avg(ss_coupon_amt#10684) AS agg3#10664, avg(ss_sales_price#10678) AS agg4#10665]
         +- Expand [[ss_sold_time_sk#10666L, ss_item_sk#10667L, ss_customer_sk#10668L, ss_cdemo_sk#10669L, ss_hdemo_sk#10670L, ss_addr_sk#10671L, ss_store_sk#10672L, ss_promo_sk#10673L, ss_ticket_number#10674L, ss_quantity#10675, ss_wholesale_cost#10676, ss_list_price#10677, ss_sales_price#10678, ss_ext_discount_amt#10679, ss_ext_sales_price#10680, ss_ext_wholesale_cost#10681, ss_ext_list_price#10682, ss_ext_tax#10683, ss_coupon_amt#10684, ss_net_paid#10685, ss_net_paid_inc_tax#10686, ss_net_profit#10687, ss_sold_date_sk#10688L, cd_demo_sk#10689L, ... 90 more fields], [ss_sold_time_sk#10666L, ss_item_sk#10667L, ss_customer_sk#10668L, ss_cdemo_sk#10669L, ss_hdemo_sk#10670L, ss_addr_sk#10671L, ss_store_sk#10672L, ss_promo_sk#10673L, ss_ticket_number#10674L, ss_quantity#10675, ss_wholesale_cost#10676, ss_list_price#10677, ss_sales_price#10678, ss_ext_discount_amt#10679, ss_ext_sales_price#10680, ss_ext_wholesale_cost#10681, ss_ext_list_price#10682, ss_ext_tax#10683, ss_coupon_amt#10684, ss_net_paid#10685, ss_net_paid_inc_tax#10686, ss_net_profit#10687, ss_sold_date_sk#10688L, cd_demo_sk#10689L, ... 90 more fields], [ss_sold_time_sk#10666L, ss_item_sk#10667L, ss_customer_sk#10668L, ss_cdemo_sk#10669L, ss_hdemo_sk#10670L, ss_addr_sk#10671L, ss_store_sk#10672L, ss_promo_sk#10673L, ss_ticket_number#10674L, ss_quantity#10675, ss_wholesale_cost#10676, ss_list_price#10677, ss_sales_price#10678, ss_ext_discount_amt#10679, ss_ext_sales_price#10680, ss_ext_wholesale_cost#10681, ss_ext_list_price#10682, ss_ext_tax#10683, ss_coupon_amt#10684, ss_net_paid#10685, ss_net_paid_inc_tax#10686, ss_net_profit#10687, ss_sold_date_sk#10688L, cd_demo_sk#10689L, ... 90 more fields]], [ss_sold_time_sk#10666L, ss_item_sk#10667L, ss_customer_sk#10668L, ss_cdemo_sk#10669L, ss_hdemo_sk#10670L, ss_addr_sk#10671L, ss_store_sk#10672L, ss_promo_sk#10673L, ss_ticket_number#10674L, ss_quantity#10675, ss_wholesale_cost#10676, ss_list_price#10677, ss_sales_price#10678, ss_ext_discount_amt#10679, ss_ext_sales_price#10680, ss_ext_wholesale_cost#10681, ss_ext_list_price#10682, ss_ext_tax#10683, ss_coupon_amt#10684, ss_net_paid#10685, ss_net_paid_inc_tax#10686, ss_net_profit#10687, ss_sold_date_sk#10688L, cd_demo_sk#10689L, ... 90 more fields]
            +- Project [ss_sold_time_sk#10666L, ss_item_sk#10667L, ss_customer_sk#10668L, ss_cdemo_sk#10669L, ss_hdemo_sk#10670L, ss_addr_sk#10671L, ss_store_sk#10672L, ss_promo_sk#10673L, ss_ticket_number#10674L, ss_quantity#10675, ss_wholesale_cost#10676, ss_list_price#10677, ss_sales_price#10678, ss_ext_discount_amt#10679, ss_ext_sales_price#10680, ss_ext_wholesale_cost#10681, ss_ext_list_price#10682, ss_ext_tax#10683, ss_coupon_amt#10684, ss_net_paid#10685, ss_net_paid_inc_tax#10686, ss_net_profit#10687, ss_sold_date_sk#10688L, cd_demo_sk#10689L, ... 89 more fields]
               +- Filter (((((ss_sold_date_sk#10688L = d_date_sk#10698L) AND (ss_item_sk#10667L = i_item_sk#10755L)) AND (ss_store_sk#10672L = s_store_sk#10726L)) AND ((ss_cdemo_sk#10669L = cd_demo_sk#10689L) AND (cd_gender#10690 = M))) AND (((cd_marital_status#10691 = U) AND (cd_education_status#10692 = 2 yr Degree)) AND ((d_year#10704 = 2001) AND s_state#10750 IN (SD,FL,MI,LA,MO,SC))))
                  +- Join Inner
                     :- Join Inner
                     :  :- Join Inner
                     :  :  :- Join Inner
                     :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                     :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10666L,ss_item_sk#10667L,ss_customer_sk#10668L,ss_cdemo_sk#10669L,ss_hdemo_sk#10670L,ss_addr_sk#10671L,ss_store_sk#10672L,ss_promo_sk#10673L,ss_ticket_number#10674L,ss_quantity#10675,ss_wholesale_cost#10676,ss_list_price#10677,ss_sales_price#10678,ss_ext_discount_amt#10679,ss_ext_sales_price#10680,ss_ext_wholesale_cost#10681,ss_ext_list_price#10682,ss_ext_tax#10683,ss_coupon_amt#10684,ss_net_paid#10685,ss_net_paid_inc_tax#10686,ss_net_profit#10687,ss_sold_date_sk#10688L] orc
                     :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                     :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10689L,cd_gender#10690,cd_marital_status#10691,cd_education_status#10692,cd_purchase_estimate#10693,cd_credit_rating#10694,cd_dep_count#10695,cd_dep_employed_count#10696,cd_dep_college_count#10697] orc
                     :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10698L,d_date_id#10699,d_date#10700,d_month_seq#10701,d_week_seq#10702,d_quarter_seq#10703,d_year#10704,d_dow#10705,d_moy#10706,d_dom#10707,d_qoy#10708,d_fy_year#10709,d_fy_quarter_seq#10710,d_fy_week_seq#10711,d_day_name#10712,d_quarter_name#10713,d_holiday#10714,d_weekend#10715,d_following_holiday#10716,d_first_dom#10717,d_last_dom#10718,d_same_day_ly#10719,d_same_day_lq#10720,d_current_day#10721,... 4 more fields] orc
                     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10726L,s_store_id#10727,s_rec_start_date#10728,s_rec_end_date#10729,s_closed_date_sk#10730L,s_store_name#10731,s_number_employees#10732,s_floor_space#10733,s_hours#10734,s_manager#10735,s_market_id#10736,s_geography_class#10737,s_market_desc#10738,s_market_manager#10739,s_division_id#10740,s_division_name#10741,s_company_id#10742,s_company_name#10743,s_street_number#10744,s_street_name#10745,s_street_type#10746,s_suite_number#10747,s_city#10748,s_county#10749,... 5 more fields] orc
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10755L,i_item_id#10756,i_rec_start_date#10757,i_rec_end_date#10758,i_item_desc#10759,i_current_price#10760,i_wholesale_cost#10761,i_brand_id#10762,i_brand#10763,i_class_id#10764,i_class#10765,i_category_id#10766,i_category#10767,i_manufact_id#10768,i_manufact#10769,i_size#10770,i_formulation#10771,i_color#10772,i_units#10773,i_container#10774,i_manager_id#10775,i_product_name#10776] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#10784 ASC NULLS FIRST, s_state#10785 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#10784, s_state#10785, spark_grouping_id#10783L], [i_item_id#10784, s_state#10785, cast((shiftright(spark_grouping_id#10783L, 0) & 1) as tinyint) AS g_state#10661, avg(ss_quantity#10675) AS agg1#10662, avg(ss_list_price#10677) AS agg2#10663, avg(ss_coupon_amt#10684) AS agg3#10664, avg(ss_sales_price#10678) AS agg4#10665]
         +- Expand [[ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, s_state#10750, 0], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, null, 1], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, null, null, 3]], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10784, s_state#10785, spark_grouping_id#10783L]
            +- Project [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, s_state#10750]
               +- Join Inner, (ss_item_sk#10667L = i_item_sk#10755L)
                  :- Project [ss_item_sk#10667L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, s_state#10750]
                  :  +- Join Inner, (ss_store_sk#10672L = s_store_sk#10726L)
                  :     :- Project [ss_item_sk#10667L, ss_store_sk#10672L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684]
                  :     :  +- Join Inner, (ss_sold_date_sk#10688L = d_date_sk#10698L)
                  :     :     :- Project [ss_item_sk#10667L, ss_store_sk#10672L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, ss_sold_date_sk#10688L]
                  :     :     :  +- Join Inner, (ss_cdemo_sk#10669L = cd_demo_sk#10689L)
                  :     :     :     :- Project [ss_item_sk#10667L, ss_cdemo_sk#10669L, ss_store_sk#10672L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, ss_sold_date_sk#10688L]
                  :     :     :     :  +- Filter ((((isnotnull(ss_cdemo_sk#10669L) AND isnotnull(ss_sold_date_sk#10688L)) AND isnotnull(ss_store_sk#10672L)) AND isnotnull(ss_item_sk#10667L)) AND dynamicpruning#10794 [ss_sold_date_sk#10688L])
                  :     :     :     :     :  +- Project [d_date_sk#10698L]
                  :     :     :     :     :     +- Filter ((isnotnull(d_year#10704) AND (d_year#10704 = 2001)) AND isnotnull(d_date_sk#10698L))
                  :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10698L,d_date_id#10699,d_date#10700,d_month_seq#10701,d_week_seq#10702,d_quarter_seq#10703,d_year#10704,d_dow#10705,d_moy#10706,d_dom#10707,d_qoy#10708,d_fy_year#10709,d_fy_quarter_seq#10710,d_fy_week_seq#10711,d_day_name#10712,d_quarter_name#10713,d_holiday#10714,d_weekend#10715,d_following_holiday#10716,d_first_dom#10717,d_last_dom#10718,d_same_day_ly#10719,d_same_day_lq#10720,d_current_day#10721,... 4 more fields] orc
                  :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10666L,ss_item_sk#10667L,ss_customer_sk#10668L,ss_cdemo_sk#10669L,ss_hdemo_sk#10670L,ss_addr_sk#10671L,ss_store_sk#10672L,ss_promo_sk#10673L,ss_ticket_number#10674L,ss_quantity#10675,ss_wholesale_cost#10676,ss_list_price#10677,ss_sales_price#10678,ss_ext_discount_amt#10679,ss_ext_sales_price#10680,ss_ext_wholesale_cost#10681,ss_ext_list_price#10682,ss_ext_tax#10683,ss_coupon_amt#10684,ss_net_paid#10685,ss_net_paid_inc_tax#10686,ss_net_profit#10687,ss_sold_date_sk#10688L] orc
                  :     :     :     +- Project [cd_demo_sk#10689L]
                  :     :     :        +- Filter ((((isnotnull(cd_gender#10690) AND isnotnull(cd_marital_status#10691)) AND isnotnull(cd_education_status#10692)) AND (((cd_gender#10690 = M) AND (cd_marital_status#10691 = U)) AND (cd_education_status#10692 = 2 yr Degree))) AND isnotnull(cd_demo_sk#10689L))
                  :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10689L,cd_gender#10690,cd_marital_status#10691,cd_education_status#10692,cd_purchase_estimate#10693,cd_credit_rating#10694,cd_dep_count#10695,cd_dep_employed_count#10696,cd_dep_college_count#10697] orc
                  :     :     +- Project [d_date_sk#10698L]
                  :     :        +- Filter ((isnotnull(d_year#10704) AND (d_year#10704 = 2001)) AND isnotnull(d_date_sk#10698L))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10698L,d_date_id#10699,d_date#10700,d_month_seq#10701,d_week_seq#10702,d_quarter_seq#10703,d_year#10704,d_dow#10705,d_moy#10706,d_dom#10707,d_qoy#10708,d_fy_year#10709,d_fy_quarter_seq#10710,d_fy_week_seq#10711,d_day_name#10712,d_quarter_name#10713,d_holiday#10714,d_weekend#10715,d_following_holiday#10716,d_first_dom#10717,d_last_dom#10718,d_same_day_ly#10719,d_same_day_lq#10720,d_current_day#10721,... 4 more fields] orc
                  :     +- Project [s_store_sk#10726L, s_state#10750]
                  :        +- Filter (s_state#10750 IN (SD,FL,MI,LA,MO,SC) AND isnotnull(s_store_sk#10726L))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10726L,s_store_id#10727,s_rec_start_date#10728,s_rec_end_date#10729,s_closed_date_sk#10730L,s_store_name#10731,s_number_employees#10732,s_floor_space#10733,s_hours#10734,s_manager#10735,s_market_id#10736,s_geography_class#10737,s_market_desc#10738,s_market_manager#10739,s_division_id#10740,s_division_name#10741,s_company_id#10742,s_company_name#10743,s_street_number#10744,s_street_name#10745,s_street_type#10746,s_suite_number#10747,s_city#10748,s_county#10749,... 5 more fields] orc
                  +- Project [i_item_sk#10755L, i_item_id#10756]
                     +- Filter isnotnull(i_item_sk#10755L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10755L,i_item_id#10756,i_rec_start_date#10757,i_rec_end_date#10758,i_item_desc#10759,i_current_price#10760,i_wholesale_cost#10761,i_brand_id#10762,i_brand#10763,i_class_id#10764,i_class#10765,i_category_id#10766,i_category#10767,i_manufact_id#10768,i_manufact#10769,i_size#10770,i_formulation#10771,i_color#10772,i_units#10773,i_container#10774,i_manager_id#10775,i_product_name#10776] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#10784 ASC NULLS FIRST,s_state#10785 ASC NULLS FIRST], output=[i_item_id#10784,s_state#10785,g_state#10661,agg1#10662,agg2#10663,agg3#10664,agg4#10665])
   +- HashAggregate(keys=[i_item_id#10784, s_state#10785, spark_grouping_id#10783L], functions=[avg(ss_quantity#10675), avg(ss_list_price#10677), avg(ss_coupon_amt#10684), avg(ss_sales_price#10678)], output=[i_item_id#10784, s_state#10785, g_state#10661, agg1#10662, agg2#10663, agg3#10664, agg4#10665])
      +- Exchange hashpartitioning(i_item_id#10784, s_state#10785, spark_grouping_id#10783L, 3000), ENSURE_REQUIREMENTS, [id=#11163]
         +- HashAggregate(keys=[i_item_id#10784, s_state#10785, spark_grouping_id#10783L], functions=[partial_avg(ss_quantity#10675), partial_avg(ss_list_price#10677), partial_avg(ss_coupon_amt#10684), partial_avg(ss_sales_price#10678)], output=[i_item_id#10784, s_state#10785, spark_grouping_id#10783L, sum#10803, count#10804L, sum#10805, count#10806L, sum#10807, count#10808L, sum#10809, count#10810L])
            +- Expand [[ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, s_state#10750, 0], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, null, 1], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, null, null, 3]], [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10784, s_state#10785, spark_grouping_id#10783L]
               +- Project [ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, i_item_id#10756, s_state#10750]
                  +- SortMergeJoin [ss_item_sk#10667L], [i_item_sk#10755L], Inner
                     :- Sort [ss_item_sk#10667L ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(ss_item_sk#10667L, 3000), ENSURE_REQUIREMENTS, [id=#11154]
                     :     +- Project [ss_item_sk#10667L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, s_state#10750]
                     :        +- BroadcastHashJoin [ss_store_sk#10672L], [s_store_sk#10726L], Inner, BuildRight, false
                     :           :- Project [ss_item_sk#10667L, ss_store_sk#10672L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684]
                     :           :  +- BroadcastHashJoin [ss_sold_date_sk#10688L], [d_date_sk#10698L], Inner, BuildRight, false
                     :           :     :- Project [ss_item_sk#10667L, ss_store_sk#10672L, ss_quantity#10675, ss_list_price#10677, ss_sales_price#10678, ss_coupon_amt#10684, ss_sold_date_sk#10688L]
                     :           :     :  +- BroadcastHashJoin [ss_cdemo_sk#10669L], [cd_demo_sk#10689L], Inner, BuildRight, false
                     :           :     :     :- Filter ((isnotnull(ss_cdemo_sk#10669L) AND isnotnull(ss_store_sk#10672L)) AND isnotnull(ss_item_sk#10667L))
                     :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#10667L,ss_cdemo_sk#10669L,ss_store_sk#10672L,ss_quantity#10675,ss_list_price#10677,ss_sales_price#10678,ss_coupon_amt#10684,ss_sold_date_sk#10688L] Batched: true, DataFilters: [isnotnull(ss_cdemo_sk#10669L), isnotnull(ss_store_sk#10672L), isnotnull(ss_item_sk#10667L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#10688L), dynamicpruningexpression(ss_sold_date_sk#10688L IN dynamicpru..., PushedFilters: [IsNotNull(ss_cdemo_sk), IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_cdemo_sk:bigint,ss_store_sk:bigint,ss_quantity:int,ss_list_price:doub...
                     :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#10794, 0, true, Project [d_date_sk#10698L], [d_date_sk#10698L]
                     :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                     :           :     :     :              +- Project [d_date_sk#10698L]
                     :           :     :     :                 +- Filter ((isnotnull(d_year#10704) AND (d_year#10704 = 2001)) AND isnotnull(d_date_sk#10698L))
                     :           :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10698L,d_year#10704] Batched: true, DataFilters: [isnotnull(d_year#10704), (d_year#10704 = 2001), isnotnull(d_date_sk#10698L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11141]
                     :           :     :        +- Project [cd_demo_sk#10689L]
                     :           :     :           +- Filter ((((((isnotnull(cd_gender#10690) AND isnotnull(cd_marital_status#10691)) AND isnotnull(cd_education_status#10692)) AND (cd_gender#10690 = M)) AND (cd_marital_status#10691 = U)) AND (cd_education_status#10692 = 2 yr Degree)) AND isnotnull(cd_demo_sk#10689L))
                     :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#10689L,cd_gender#10690,cd_marital_status#10691,cd_education_status#10692] Batched: true, DataFilters: [isnotnull(cd_gender#10690), isnotnull(cd_marital_status#10691), isnotnull(cd_education_status#10..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_marital_status), IsNotNull(cd_education_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_education_status:string>
                     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11145]
                     :           :        +- Project [d_date_sk#10698L]
                     :           :           +- Filter ((isnotnull(d_year#10704) AND (d_year#10704 = 2001)) AND isnotnull(d_date_sk#10698L))
                     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#10698L,d_year#10704] Batched: true, DataFilters: [isnotnull(d_year#10704), (d_year#10704 = 2001), isnotnull(d_date_sk#10698L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#11149]
                     :              +- Filter (s_state#10750 IN (SD,FL,MI,LA,MO,SC) AND isnotnull(s_store_sk#10726L))
                     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#10726L,s_state#10750] Batched: true, DataFilters: [s_state#10750 IN (SD,FL,MI,LA,MO,SC), isnotnull(s_store_sk#10726L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_state, [FL,LA,MI,MO,SC,SD]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_state:string>
                     +- Sort [i_item_sk#10755L ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_item_sk#10755L, 3000), ENSURE_REQUIREMENTS, [id=#11155]
                           +- Filter isnotnull(i_item_sk#10755L)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#10755L,i_item_id#10756] Batched: true, DataFilters: [isnotnull(i_item_sk#10755L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q28.sql
explain query: q28
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Project [*]
      +- 'Join Inner
         :- 'Join Inner
         :  :- 'Join Inner
         :  :  :- 'Join Inner
         :  :  :  :- 'Join Inner
         :  :  :  :  :- 'SubqueryAlias B1
         :  :  :  :  :  +- 'Project ['avg('ss_list_price) AS B1_LP#10811, 'count('ss_list_price) AS B1_CNT#10812, 'count(distinct 'ss_list_price) AS B1_CNTD#10813]
         :  :  :  :  :     +- 'Filter ((('ss_quantity >= 0) AND ('ss_quantity <= 5)) AND (((('ss_list_price >= 11) AND ('ss_list_price <= (11 + 10))) OR (('ss_coupon_amt >= 460) AND ('ss_coupon_amt <= (460 + 1000)))) OR (('ss_wholesale_cost >= 14) AND ('ss_wholesale_cost <= (14 + 20)))))
         :  :  :  :  :        +- 'UnresolvedRelation [store_sales], [], false
         :  :  :  :  +- 'SubqueryAlias B2
         :  :  :  :     +- 'Project ['avg('ss_list_price) AS B2_LP#10814, 'count('ss_list_price) AS B2_CNT#10815, 'count(distinct 'ss_list_price) AS B2_CNTD#10816]
         :  :  :  :        +- 'Filter ((('ss_quantity >= 6) AND ('ss_quantity <= 10)) AND (((('ss_list_price >= 91) AND ('ss_list_price <= (91 + 10))) OR (('ss_coupon_amt >= 1430) AND ('ss_coupon_amt <= (1430 + 1000)))) OR (('ss_wholesale_cost >= 32) AND ('ss_wholesale_cost <= (32 + 20)))))
         :  :  :  :           +- 'UnresolvedRelation [store_sales], [], false
         :  :  :  +- 'SubqueryAlias B3
         :  :  :     +- 'Project ['avg('ss_list_price) AS B3_LP#10817, 'count('ss_list_price) AS B3_CNT#10818, 'count(distinct 'ss_list_price) AS B3_CNTD#10819]
         :  :  :        +- 'Filter ((('ss_quantity >= 11) AND ('ss_quantity <= 15)) AND (((('ss_list_price >= 66) AND ('ss_list_price <= (66 + 10))) OR (('ss_coupon_amt >= 920) AND ('ss_coupon_amt <= (920 + 1000)))) OR (('ss_wholesale_cost >= 4) AND ('ss_wholesale_cost <= (4 + 20)))))
         :  :  :           +- 'UnresolvedRelation [store_sales], [], false
         :  :  +- 'SubqueryAlias B4
         :  :     +- 'Project ['avg('ss_list_price) AS B4_LP#10820, 'count('ss_list_price) AS B4_CNT#10821, 'count(distinct 'ss_list_price) AS B4_CNTD#10822]
         :  :        +- 'Filter ((('ss_quantity >= 16) AND ('ss_quantity <= 20)) AND (((('ss_list_price >= 142) AND ('ss_list_price <= (142 + 10))) OR (('ss_coupon_amt >= 3054) AND ('ss_coupon_amt <= (3054 + 1000)))) OR (('ss_wholesale_cost >= 80) AND ('ss_wholesale_cost <= (80 + 20)))))
         :  :           +- 'UnresolvedRelation [store_sales], [], false
         :  +- 'SubqueryAlias B5
         :     +- 'Project ['avg('ss_list_price) AS B5_LP#10823, 'count('ss_list_price) AS B5_CNT#10824, 'count(distinct 'ss_list_price) AS B5_CNTD#10825]
         :        +- 'Filter ((('ss_quantity >= 21) AND ('ss_quantity <= 25)) AND (((('ss_list_price >= 135) AND ('ss_list_price <= (135 + 10))) OR (('ss_coupon_amt >= 14180) AND ('ss_coupon_amt <= (14180 + 1000)))) OR (('ss_wholesale_cost >= 38) AND ('ss_wholesale_cost <= (38 + 20)))))
         :           +- 'UnresolvedRelation [store_sales], [], false
         +- 'SubqueryAlias B6
            +- 'Project ['avg('ss_list_price) AS B6_LP#10826, 'count('ss_list_price) AS B6_CNT#10827, 'count(distinct 'ss_list_price) AS B6_CNTD#10828]
               +- 'Filter ((('ss_quantity >= 26) AND ('ss_quantity <= 30)) AND (((('ss_list_price >= 28) AND ('ss_list_price <= (28 + 10))) OR (('ss_coupon_amt >= 2513) AND ('ss_coupon_amt <= (2513 + 1000)))) OR (('ss_wholesale_cost >= 42) AND ('ss_wholesale_cost <= (42 + 20)))))
                  +- 'UnresolvedRelation [store_sales], [], false

== Analyzed Logical Plan ==
B1_LP: double, B1_CNT: bigint, B1_CNTD: bigint, B2_LP: double, B2_CNT: bigint, B2_CNTD: bigint, B3_LP: double, B3_CNT: bigint, B3_CNTD: bigint, B4_LP: double, B4_CNT: bigint, B4_CNTD: bigint, B5_LP: double, B5_CNT: bigint, B5_CNTD: bigint, B6_LP: double, B6_CNT: bigint, B6_CNTD: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Project [B1_LP#10811, B1_CNT#10812L, B1_CNTD#10813L, B2_LP#10814, B2_CNT#10815L, B2_CNTD#10816L, B3_LP#10817, B3_CNT#10818L, B3_CNTD#10819L, B4_LP#10820, B4_CNT#10821L, B4_CNTD#10822L, B5_LP#10823, B5_CNT#10824L, B5_CNTD#10825L, B6_LP#10826, B6_CNT#10827L, B6_CNTD#10828L]
      +- Join Inner
         :- Join Inner
         :  :- Join Inner
         :  :  :- Join Inner
         :  :  :  :- Join Inner
         :  :  :  :  :- SubqueryAlias B1
         :  :  :  :  :  +- Aggregate [avg(ss_list_price#10840) AS B1_LP#10811, count(ss_list_price#10840) AS B1_CNT#10812L, count(distinct ss_list_price#10840) AS B1_CNTD#10813L]
         :  :  :  :  :     +- Filter (((ss_quantity#10838 >= 0) AND (ss_quantity#10838 <= 5)) AND ((((ss_list_price#10840 >= cast(11 as double)) AND (ss_list_price#10840 <= cast((11 + 10) as double))) OR ((ss_coupon_amt#10847 >= cast(460 as double)) AND (ss_coupon_amt#10847 <= cast((460 + 1000) as double)))) OR ((ss_wholesale_cost#10839 >= cast(14 as double)) AND (ss_wholesale_cost#10839 <= cast((14 + 20) as double)))))
         :  :  :  :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :  :  :  :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10829L,ss_item_sk#10830L,ss_customer_sk#10831L,ss_cdemo_sk#10832L,ss_hdemo_sk#10833L,ss_addr_sk#10834L,ss_store_sk#10835L,ss_promo_sk#10836L,ss_ticket_number#10837L,ss_quantity#10838,ss_wholesale_cost#10839,ss_list_price#10840,ss_sales_price#10841,ss_ext_discount_amt#10842,ss_ext_sales_price#10843,ss_ext_wholesale_cost#10844,ss_ext_list_price#10845,ss_ext_tax#10846,ss_coupon_amt#10847,ss_net_paid#10848,ss_net_paid_inc_tax#10849,ss_net_profit#10850,ss_sold_date_sk#10851L] orc
         :  :  :  :  +- SubqueryAlias B2
         :  :  :  :     +- Aggregate [avg(ss_list_price#10863) AS B2_LP#10814, count(ss_list_price#10863) AS B2_CNT#10815L, count(distinct ss_list_price#10863) AS B2_CNTD#10816L]
         :  :  :  :        +- Filter (((ss_quantity#10861 >= 6) AND (ss_quantity#10861 <= 10)) AND ((((ss_list_price#10863 >= cast(91 as double)) AND (ss_list_price#10863 <= cast((91 + 10) as double))) OR ((ss_coupon_amt#10870 >= cast(1430 as double)) AND (ss_coupon_amt#10870 <= cast((1430 + 1000) as double)))) OR ((ss_wholesale_cost#10862 >= cast(32 as double)) AND (ss_wholesale_cost#10862 <= cast((32 + 20) as double)))))
         :  :  :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :  :  :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10852L,ss_item_sk#10853L,ss_customer_sk#10854L,ss_cdemo_sk#10855L,ss_hdemo_sk#10856L,ss_addr_sk#10857L,ss_store_sk#10858L,ss_promo_sk#10859L,ss_ticket_number#10860L,ss_quantity#10861,ss_wholesale_cost#10862,ss_list_price#10863,ss_sales_price#10864,ss_ext_discount_amt#10865,ss_ext_sales_price#10866,ss_ext_wholesale_cost#10867,ss_ext_list_price#10868,ss_ext_tax#10869,ss_coupon_amt#10870,ss_net_paid#10871,ss_net_paid_inc_tax#10872,ss_net_profit#10873,ss_sold_date_sk#10874L] orc
         :  :  :  +- SubqueryAlias B3
         :  :  :     +- Aggregate [avg(ss_list_price#10886) AS B3_LP#10817, count(ss_list_price#10886) AS B3_CNT#10818L, count(distinct ss_list_price#10886) AS B3_CNTD#10819L]
         :  :  :        +- Filter (((ss_quantity#10884 >= 11) AND (ss_quantity#10884 <= 15)) AND ((((ss_list_price#10886 >= cast(66 as double)) AND (ss_list_price#10886 <= cast((66 + 10) as double))) OR ((ss_coupon_amt#10893 >= cast(920 as double)) AND (ss_coupon_amt#10893 <= cast((920 + 1000) as double)))) OR ((ss_wholesale_cost#10885 >= cast(4 as double)) AND (ss_wholesale_cost#10885 <= cast((4 + 20) as double)))))
         :  :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :  :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10875L,ss_item_sk#10876L,ss_customer_sk#10877L,ss_cdemo_sk#10878L,ss_hdemo_sk#10879L,ss_addr_sk#10880L,ss_store_sk#10881L,ss_promo_sk#10882L,ss_ticket_number#10883L,ss_quantity#10884,ss_wholesale_cost#10885,ss_list_price#10886,ss_sales_price#10887,ss_ext_discount_amt#10888,ss_ext_sales_price#10889,ss_ext_wholesale_cost#10890,ss_ext_list_price#10891,ss_ext_tax#10892,ss_coupon_amt#10893,ss_net_paid#10894,ss_net_paid_inc_tax#10895,ss_net_profit#10896,ss_sold_date_sk#10897L] orc
         :  :  +- SubqueryAlias B4
         :  :     +- Aggregate [avg(ss_list_price#10909) AS B4_LP#10820, count(ss_list_price#10909) AS B4_CNT#10821L, count(distinct ss_list_price#10909) AS B4_CNTD#10822L]
         :  :        +- Filter (((ss_quantity#10907 >= 16) AND (ss_quantity#10907 <= 20)) AND ((((ss_list_price#10909 >= cast(142 as double)) AND (ss_list_price#10909 <= cast((142 + 10) as double))) OR ((ss_coupon_amt#10916 >= cast(3054 as double)) AND (ss_coupon_amt#10916 <= cast((3054 + 1000) as double)))) OR ((ss_wholesale_cost#10908 >= cast(80 as double)) AND (ss_wholesale_cost#10908 <= cast((80 + 20) as double)))))
         :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10898L,ss_item_sk#10899L,ss_customer_sk#10900L,ss_cdemo_sk#10901L,ss_hdemo_sk#10902L,ss_addr_sk#10903L,ss_store_sk#10904L,ss_promo_sk#10905L,ss_ticket_number#10906L,ss_quantity#10907,ss_wholesale_cost#10908,ss_list_price#10909,ss_sales_price#10910,ss_ext_discount_amt#10911,ss_ext_sales_price#10912,ss_ext_wholesale_cost#10913,ss_ext_list_price#10914,ss_ext_tax#10915,ss_coupon_amt#10916,ss_net_paid#10917,ss_net_paid_inc_tax#10918,ss_net_profit#10919,ss_sold_date_sk#10920L] orc
         :  +- SubqueryAlias B5
         :     +- Aggregate [avg(ss_list_price#10932) AS B5_LP#10823, count(ss_list_price#10932) AS B5_CNT#10824L, count(distinct ss_list_price#10932) AS B5_CNTD#10825L]
         :        +- Filter (((ss_quantity#10930 >= 21) AND (ss_quantity#10930 <= 25)) AND ((((ss_list_price#10932 >= cast(135 as double)) AND (ss_list_price#10932 <= cast((135 + 10) as double))) OR ((ss_coupon_amt#10939 >= cast(14180 as double)) AND (ss_coupon_amt#10939 <= cast((14180 + 1000) as double)))) OR ((ss_wholesale_cost#10931 >= cast(38 as double)) AND (ss_wholesale_cost#10931 <= cast((38 + 20) as double)))))
         :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10921L,ss_item_sk#10922L,ss_customer_sk#10923L,ss_cdemo_sk#10924L,ss_hdemo_sk#10925L,ss_addr_sk#10926L,ss_store_sk#10927L,ss_promo_sk#10928L,ss_ticket_number#10929L,ss_quantity#10930,ss_wholesale_cost#10931,ss_list_price#10932,ss_sales_price#10933,ss_ext_discount_amt#10934,ss_ext_sales_price#10935,ss_ext_wholesale_cost#10936,ss_ext_list_price#10937,ss_ext_tax#10938,ss_coupon_amt#10939,ss_net_paid#10940,ss_net_paid_inc_tax#10941,ss_net_profit#10942,ss_sold_date_sk#10943L] orc
         +- SubqueryAlias B6
            +- Aggregate [avg(ss_list_price#10955) AS B6_LP#10826, count(ss_list_price#10955) AS B6_CNT#10827L, count(distinct ss_list_price#10955) AS B6_CNTD#10828L]
               +- Filter (((ss_quantity#10953 >= 26) AND (ss_quantity#10953 <= 30)) AND ((((ss_list_price#10955 >= cast(28 as double)) AND (ss_list_price#10955 <= cast((28 + 10) as double))) OR ((ss_coupon_amt#10962 >= cast(2513 as double)) AND (ss_coupon_amt#10962 <= cast((2513 + 1000) as double)))) OR ((ss_wholesale_cost#10954 >= cast(42 as double)) AND (ss_wholesale_cost#10954 <= cast((42 + 20) as double)))))
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10944L,ss_item_sk#10945L,ss_customer_sk#10946L,ss_cdemo_sk#10947L,ss_hdemo_sk#10948L,ss_addr_sk#10949L,ss_store_sk#10950L,ss_promo_sk#10951L,ss_ticket_number#10952L,ss_quantity#10953,ss_wholesale_cost#10954,ss_list_price#10955,ss_sales_price#10956,ss_ext_discount_amt#10957,ss_ext_sales_price#10958,ss_ext_wholesale_cost#10959,ss_ext_list_price#10960,ss_ext_tax#10961,ss_coupon_amt#10962,ss_net_paid#10963,ss_net_paid_inc_tax#10964,ss_net_profit#10965,ss_sold_date_sk#10966L] orc

== Optimized Logical Plan ==
Join Inner
:- Join Inner
:  :- Join Inner
:  :  :- Join Inner
:  :  :  :- Join Inner
:  :  :  :  :- Aggregate [avg(ss_list_price#10840) AS B1_LP#10811, count(ss_list_price#10840) AS B1_CNT#10812L, count(distinct ss_list_price#10840) AS B1_CNTD#10813L]
:  :  :  :  :  +- Project [ss_list_price#10840]
:  :  :  :  :     +- Filter (isnotnull(ss_quantity#10838) AND (((ss_quantity#10838 >= 0) AND (ss_quantity#10838 <= 5)) AND ((((ss_list_price#10840 >= 11.0) AND (ss_list_price#10840 <= 21.0)) OR ((ss_coupon_amt#10847 >= 460.0) AND (ss_coupon_amt#10847 <= 1460.0))) OR ((ss_wholesale_cost#10839 >= 14.0) AND (ss_wholesale_cost#10839 <= 34.0)))))
:  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10829L,ss_item_sk#10830L,ss_customer_sk#10831L,ss_cdemo_sk#10832L,ss_hdemo_sk#10833L,ss_addr_sk#10834L,ss_store_sk#10835L,ss_promo_sk#10836L,ss_ticket_number#10837L,ss_quantity#10838,ss_wholesale_cost#10839,ss_list_price#10840,ss_sales_price#10841,ss_ext_discount_amt#10842,ss_ext_sales_price#10843,ss_ext_wholesale_cost#10844,ss_ext_list_price#10845,ss_ext_tax#10846,ss_coupon_amt#10847,ss_net_paid#10848,ss_net_paid_inc_tax#10849,ss_net_profit#10850,ss_sold_date_sk#10851L] orc
:  :  :  :  +- Aggregate [avg(ss_list_price#10863) AS B2_LP#10814, count(ss_list_price#10863) AS B2_CNT#10815L, count(distinct ss_list_price#10863) AS B2_CNTD#10816L]
:  :  :  :     +- Project [ss_list_price#10863]
:  :  :  :        +- Filter (isnotnull(ss_quantity#10861) AND (((ss_quantity#10861 >= 6) AND (ss_quantity#10861 <= 10)) AND ((((ss_list_price#10863 >= 91.0) AND (ss_list_price#10863 <= 101.0)) OR ((ss_coupon_amt#10870 >= 1430.0) AND (ss_coupon_amt#10870 <= 2430.0))) OR ((ss_wholesale_cost#10862 >= 32.0) AND (ss_wholesale_cost#10862 <= 52.0)))))
:  :  :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10852L,ss_item_sk#10853L,ss_customer_sk#10854L,ss_cdemo_sk#10855L,ss_hdemo_sk#10856L,ss_addr_sk#10857L,ss_store_sk#10858L,ss_promo_sk#10859L,ss_ticket_number#10860L,ss_quantity#10861,ss_wholesale_cost#10862,ss_list_price#10863,ss_sales_price#10864,ss_ext_discount_amt#10865,ss_ext_sales_price#10866,ss_ext_wholesale_cost#10867,ss_ext_list_price#10868,ss_ext_tax#10869,ss_coupon_amt#10870,ss_net_paid#10871,ss_net_paid_inc_tax#10872,ss_net_profit#10873,ss_sold_date_sk#10874L] orc
:  :  :  +- Aggregate [avg(ss_list_price#10886) AS B3_LP#10817, count(ss_list_price#10886) AS B3_CNT#10818L, count(distinct ss_list_price#10886) AS B3_CNTD#10819L]
:  :  :     +- Project [ss_list_price#10886]
:  :  :        +- Filter (isnotnull(ss_quantity#10884) AND (((ss_quantity#10884 >= 11) AND (ss_quantity#10884 <= 15)) AND ((((ss_list_price#10886 >= 66.0) AND (ss_list_price#10886 <= 76.0)) OR ((ss_coupon_amt#10893 >= 920.0) AND (ss_coupon_amt#10893 <= 1920.0))) OR ((ss_wholesale_cost#10885 >= 4.0) AND (ss_wholesale_cost#10885 <= 24.0)))))
:  :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10875L,ss_item_sk#10876L,ss_customer_sk#10877L,ss_cdemo_sk#10878L,ss_hdemo_sk#10879L,ss_addr_sk#10880L,ss_store_sk#10881L,ss_promo_sk#10882L,ss_ticket_number#10883L,ss_quantity#10884,ss_wholesale_cost#10885,ss_list_price#10886,ss_sales_price#10887,ss_ext_discount_amt#10888,ss_ext_sales_price#10889,ss_ext_wholesale_cost#10890,ss_ext_list_price#10891,ss_ext_tax#10892,ss_coupon_amt#10893,ss_net_paid#10894,ss_net_paid_inc_tax#10895,ss_net_profit#10896,ss_sold_date_sk#10897L] orc
:  :  +- Aggregate [avg(ss_list_price#10909) AS B4_LP#10820, count(ss_list_price#10909) AS B4_CNT#10821L, count(distinct ss_list_price#10909) AS B4_CNTD#10822L]
:  :     +- Project [ss_list_price#10909]
:  :        +- Filter (isnotnull(ss_quantity#10907) AND (((ss_quantity#10907 >= 16) AND (ss_quantity#10907 <= 20)) AND ((((ss_list_price#10909 >= 142.0) AND (ss_list_price#10909 <= 152.0)) OR ((ss_coupon_amt#10916 >= 3054.0) AND (ss_coupon_amt#10916 <= 4054.0))) OR ((ss_wholesale_cost#10908 >= 80.0) AND (ss_wholesale_cost#10908 <= 100.0)))))
:  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10898L,ss_item_sk#10899L,ss_customer_sk#10900L,ss_cdemo_sk#10901L,ss_hdemo_sk#10902L,ss_addr_sk#10903L,ss_store_sk#10904L,ss_promo_sk#10905L,ss_ticket_number#10906L,ss_quantity#10907,ss_wholesale_cost#10908,ss_list_price#10909,ss_sales_price#10910,ss_ext_discount_amt#10911,ss_ext_sales_price#10912,ss_ext_wholesale_cost#10913,ss_ext_list_price#10914,ss_ext_tax#10915,ss_coupon_amt#10916,ss_net_paid#10917,ss_net_paid_inc_tax#10918,ss_net_profit#10919,ss_sold_date_sk#10920L] orc
:  +- Aggregate [avg(ss_list_price#10932) AS B5_LP#10823, count(ss_list_price#10932) AS B5_CNT#10824L, count(distinct ss_list_price#10932) AS B5_CNTD#10825L]
:     +- Project [ss_list_price#10932]
:        +- Filter (isnotnull(ss_quantity#10930) AND (((ss_quantity#10930 >= 21) AND (ss_quantity#10930 <= 25)) AND ((((ss_list_price#10932 >= 135.0) AND (ss_list_price#10932 <= 145.0)) OR ((ss_coupon_amt#10939 >= 14180.0) AND (ss_coupon_amt#10939 <= 15180.0))) OR ((ss_wholesale_cost#10931 >= 38.0) AND (ss_wholesale_cost#10931 <= 58.0)))))
:           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10921L,ss_item_sk#10922L,ss_customer_sk#10923L,ss_cdemo_sk#10924L,ss_hdemo_sk#10925L,ss_addr_sk#10926L,ss_store_sk#10927L,ss_promo_sk#10928L,ss_ticket_number#10929L,ss_quantity#10930,ss_wholesale_cost#10931,ss_list_price#10932,ss_sales_price#10933,ss_ext_discount_amt#10934,ss_ext_sales_price#10935,ss_ext_wholesale_cost#10936,ss_ext_list_price#10937,ss_ext_tax#10938,ss_coupon_amt#10939,ss_net_paid#10940,ss_net_paid_inc_tax#10941,ss_net_profit#10942,ss_sold_date_sk#10943L] orc
+- Aggregate [avg(ss_list_price#10955) AS B6_LP#10826, count(ss_list_price#10955) AS B6_CNT#10827L, count(distinct ss_list_price#10955) AS B6_CNTD#10828L]
   +- Project [ss_list_price#10955]
      +- Filter (isnotnull(ss_quantity#10953) AND (((ss_quantity#10953 >= 26) AND (ss_quantity#10953 <= 30)) AND ((((ss_list_price#10955 >= 28.0) AND (ss_list_price#10955 <= 38.0)) OR ((ss_coupon_amt#10962 >= 2513.0) AND (ss_coupon_amt#10962 <= 3513.0))) OR ((ss_wholesale_cost#10954 >= 42.0) AND (ss_wholesale_cost#10954 <= 62.0)))))
         +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#10944L,ss_item_sk#10945L,ss_customer_sk#10946L,ss_cdemo_sk#10947L,ss_hdemo_sk#10948L,ss_addr_sk#10949L,ss_store_sk#10950L,ss_promo_sk#10951L,ss_ticket_number#10952L,ss_quantity#10953,ss_wholesale_cost#10954,ss_list_price#10955,ss_sales_price#10956,ss_ext_discount_amt#10957,ss_ext_sales_price#10958,ss_ext_wholesale_cost#10959,ss_ext_list_price#10960,ss_ext_tax#10961,ss_coupon_amt#10962,ss_net_paid#10963,ss_net_paid_inc_tax#10964,ss_net_profit#10965,ss_sold_date_sk#10966L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- BroadcastNestedLoopJoin BuildRight, Inner
   :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :  :- HashAggregate(keys=[], functions=[avg(ss_list_price#10840), count(ss_list_price#10840), count(distinct ss_list_price#11003)], output=[B1_LP#10811, B1_CNT#10812L, B1_CNTD#10813L])
   :  :  :  :  :  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11316]
   :  :  :  :  :     +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10840), merge_count(ss_list_price#10840), partial_count(distinct ss_list_price#11003)], output=[sum#11006, count#11007L, count#11009L, count#11012L])
   :  :  :  :  :        +- HashAggregate(keys=[ss_list_price#11003], functions=[merge_avg(ss_list_price#10840), merge_count(ss_list_price#10840)], output=[ss_list_price#11003, sum#11006, count#11007L, count#11009L])
   :  :  :  :  :           +- Exchange hashpartitioning(ss_list_price#11003, 3000), ENSURE_REQUIREMENTS, [id=#11312]
   :  :  :  :  :              +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10840)) AS ss_list_price#11003], functions=[partial_avg(ss_list_price#10840), partial_count(ss_list_price#10840)], output=[ss_list_price#11003, sum#11006, count#11007L, count#11009L])
   :  :  :  :  :                 +- Project [ss_list_price#10840]
   :  :  :  :  :                    +- Filter (((isnotnull(ss_quantity#10838) AND (ss_quantity#10838 >= 0)) AND (ss_quantity#10838 <= 5)) AND ((((ss_list_price#10840 >= 11.0) AND (ss_list_price#10840 <= 21.0)) OR ((ss_coupon_amt#10847 >= 460.0) AND (ss_coupon_amt#10847 <= 1460.0))) OR ((ss_wholesale_cost#10839 >= 14.0) AND (ss_wholesale_cost#10839 <= 34.0))))
   :  :  :  :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10838,ss_wholesale_cost#10839,ss_list_price#10840,ss_coupon_amt#10847,ss_sold_date_sk#10851L] Batched: true, DataFilters: [isnotnull(ss_quantity#10838), (ss_quantity#10838 >= 0), (ss_quantity#10838 <= 5), ((((ss_list_pr..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,0), LessThanOrEqual(ss_quantity,5), Or(Or..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>
   :  :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#11325]
   :  :  :  :     +- HashAggregate(keys=[], functions=[avg(ss_list_price#10863), count(ss_list_price#10863), count(distinct ss_list_price#11014)], output=[B2_LP#10814, B2_CNT#10815L, B2_CNTD#10816L])
   :  :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11322]
   :  :  :  :           +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10863), merge_count(ss_list_price#10863), partial_count(distinct ss_list_price#11014)], output=[sum#11017, count#11018L, count#11020L, count#11023L])
   :  :  :  :              +- HashAggregate(keys=[ss_list_price#11014], functions=[merge_avg(ss_list_price#10863), merge_count(ss_list_price#10863)], output=[ss_list_price#11014, sum#11017, count#11018L, count#11020L])
   :  :  :  :                 +- Exchange hashpartitioning(ss_list_price#11014, 3000), ENSURE_REQUIREMENTS, [id=#11318]
   :  :  :  :                    +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10863)) AS ss_list_price#11014], functions=[partial_avg(ss_list_price#10863), partial_count(ss_list_price#10863)], output=[ss_list_price#11014, sum#11017, count#11018L, count#11020L])
   :  :  :  :                       +- Project [ss_list_price#10863]
   :  :  :  :                          +- Filter (((isnotnull(ss_quantity#10861) AND (ss_quantity#10861 >= 6)) AND (ss_quantity#10861 <= 10)) AND ((((ss_list_price#10863 >= 91.0) AND (ss_list_price#10863 <= 101.0)) OR ((ss_coupon_amt#10870 >= 1430.0) AND (ss_coupon_amt#10870 <= 2430.0))) OR ((ss_wholesale_cost#10862 >= 32.0) AND (ss_wholesale_cost#10862 <= 52.0))))
   :  :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10861,ss_wholesale_cost#10862,ss_list_price#10863,ss_coupon_amt#10870,ss_sold_date_sk#10874L] Batched: true, DataFilters: [isnotnull(ss_quantity#10861), (ss_quantity#10861 >= 6), (ss_quantity#10861 <= 10), ((((ss_list_p..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,6), LessThanOrEqual(ss_quantity,10), Or(O..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>
   :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#11334]
   :  :  :     +- HashAggregate(keys=[], functions=[avg(ss_list_price#10886), count(ss_list_price#10886), count(distinct ss_list_price#11025)], output=[B3_LP#10817, B3_CNT#10818L, B3_CNTD#10819L])
   :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11331]
   :  :  :           +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10886), merge_count(ss_list_price#10886), partial_count(distinct ss_list_price#11025)], output=[sum#11028, count#11029L, count#11031L, count#11034L])
   :  :  :              +- HashAggregate(keys=[ss_list_price#11025], functions=[merge_avg(ss_list_price#10886), merge_count(ss_list_price#10886)], output=[ss_list_price#11025, sum#11028, count#11029L, count#11031L])
   :  :  :                 +- Exchange hashpartitioning(ss_list_price#11025, 3000), ENSURE_REQUIREMENTS, [id=#11327]
   :  :  :                    +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10886)) AS ss_list_price#11025], functions=[partial_avg(ss_list_price#10886), partial_count(ss_list_price#10886)], output=[ss_list_price#11025, sum#11028, count#11029L, count#11031L])
   :  :  :                       +- Project [ss_list_price#10886]
   :  :  :                          +- Filter (((isnotnull(ss_quantity#10884) AND (ss_quantity#10884 >= 11)) AND (ss_quantity#10884 <= 15)) AND ((((ss_list_price#10886 >= 66.0) AND (ss_list_price#10886 <= 76.0)) OR ((ss_coupon_amt#10893 >= 920.0) AND (ss_coupon_amt#10893 <= 1920.0))) OR ((ss_wholesale_cost#10885 >= 4.0) AND (ss_wholesale_cost#10885 <= 24.0))))
   :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10884,ss_wholesale_cost#10885,ss_list_price#10886,ss_coupon_amt#10893,ss_sold_date_sk#10897L] Batched: true, DataFilters: [isnotnull(ss_quantity#10884), (ss_quantity#10884 >= 11), (ss_quantity#10884 <= 15), ((((ss_list_..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,11), LessThanOrEqual(ss_quantity,15), Or(..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>
   :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#11343]
   :  :     +- HashAggregate(keys=[], functions=[avg(ss_list_price#10909), count(ss_list_price#10909), count(distinct ss_list_price#11036)], output=[B4_LP#10820, B4_CNT#10821L, B4_CNTD#10822L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11340]
   :  :           +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10909), merge_count(ss_list_price#10909), partial_count(distinct ss_list_price#11036)], output=[sum#11039, count#11040L, count#11042L, count#11045L])
   :  :              +- HashAggregate(keys=[ss_list_price#11036], functions=[merge_avg(ss_list_price#10909), merge_count(ss_list_price#10909)], output=[ss_list_price#11036, sum#11039, count#11040L, count#11042L])
   :  :                 +- Exchange hashpartitioning(ss_list_price#11036, 3000), ENSURE_REQUIREMENTS, [id=#11336]
   :  :                    +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10909)) AS ss_list_price#11036], functions=[partial_avg(ss_list_price#10909), partial_count(ss_list_price#10909)], output=[ss_list_price#11036, sum#11039, count#11040L, count#11042L])
   :  :                       +- Project [ss_list_price#10909]
   :  :                          +- Filter (((isnotnull(ss_quantity#10907) AND (ss_quantity#10907 >= 16)) AND (ss_quantity#10907 <= 20)) AND ((((ss_list_price#10909 >= 142.0) AND (ss_list_price#10909 <= 152.0)) OR ((ss_coupon_amt#10916 >= 3054.0) AND (ss_coupon_amt#10916 <= 4054.0))) OR ((ss_wholesale_cost#10908 >= 80.0) AND (ss_wholesale_cost#10908 <= 100.0))))
   :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10907,ss_wholesale_cost#10908,ss_list_price#10909,ss_coupon_amt#10916,ss_sold_date_sk#10920L] Batched: true, DataFilters: [isnotnull(ss_quantity#10907), (ss_quantity#10907 >= 16), (ss_quantity#10907 <= 20), ((((ss_list_..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,16), LessThanOrEqual(ss_quantity,20), Or(..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>
   :  +- BroadcastExchange IdentityBroadcastMode, [id=#11352]
   :     +- HashAggregate(keys=[], functions=[avg(ss_list_price#10932), count(ss_list_price#10932), count(distinct ss_list_price#11047)], output=[B5_LP#10823, B5_CNT#10824L, B5_CNTD#10825L])
   :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11349]
   :           +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10932), merge_count(ss_list_price#10932), partial_count(distinct ss_list_price#11047)], output=[sum#11050, count#11051L, count#11053L, count#11056L])
   :              +- HashAggregate(keys=[ss_list_price#11047], functions=[merge_avg(ss_list_price#10932), merge_count(ss_list_price#10932)], output=[ss_list_price#11047, sum#11050, count#11051L, count#11053L])
   :                 +- Exchange hashpartitioning(ss_list_price#11047, 3000), ENSURE_REQUIREMENTS, [id=#11345]
   :                    +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10932)) AS ss_list_price#11047], functions=[partial_avg(ss_list_price#10932), partial_count(ss_list_price#10932)], output=[ss_list_price#11047, sum#11050, count#11051L, count#11053L])
   :                       +- Project [ss_list_price#10932]
   :                          +- Filter (((isnotnull(ss_quantity#10930) AND (ss_quantity#10930 >= 21)) AND (ss_quantity#10930 <= 25)) AND ((((ss_list_price#10932 >= 135.0) AND (ss_list_price#10932 <= 145.0)) OR ((ss_coupon_amt#10939 >= 14180.0) AND (ss_coupon_amt#10939 <= 15180.0))) OR ((ss_wholesale_cost#10931 >= 38.0) AND (ss_wholesale_cost#10931 <= 58.0))))
   :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10930,ss_wholesale_cost#10931,ss_list_price#10932,ss_coupon_amt#10939,ss_sold_date_sk#10943L] Batched: true, DataFilters: [isnotnull(ss_quantity#10930), (ss_quantity#10930 >= 21), (ss_quantity#10930 <= 25), ((((ss_list_..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,25), Or(..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>
   +- BroadcastExchange IdentityBroadcastMode, [id=#11361]
      +- HashAggregate(keys=[], functions=[avg(ss_list_price#10955), count(ss_list_price#10955), count(distinct ss_list_price#11058)], output=[B6_LP#10826, B6_CNT#10827L, B6_CNTD#10828L])
         +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#11358]
            +- HashAggregate(keys=[], functions=[merge_avg(ss_list_price#10955), merge_count(ss_list_price#10955), partial_count(distinct ss_list_price#11058)], output=[sum#11061, count#11062L, count#11064L, count#11067L])
               +- HashAggregate(keys=[ss_list_price#11058], functions=[merge_avg(ss_list_price#10955), merge_count(ss_list_price#10955)], output=[ss_list_price#11058, sum#11061, count#11062L, count#11064L])
                  +- Exchange hashpartitioning(ss_list_price#11058, 3000), ENSURE_REQUIREMENTS, [id=#11354]
                     +- HashAggregate(keys=[knownfloatingpointnormalized(normalizenanandzero(ss_list_price#10955)) AS ss_list_price#11058], functions=[partial_avg(ss_list_price#10955), partial_count(ss_list_price#10955)], output=[ss_list_price#11058, sum#11061, count#11062L, count#11064L])
                        +- Project [ss_list_price#10955]
                           +- Filter (((isnotnull(ss_quantity#10953) AND (ss_quantity#10953 >= 26)) AND (ss_quantity#10953 <= 30)) AND ((((ss_list_price#10955 >= 28.0) AND (ss_list_price#10955 <= 38.0)) OR ((ss_coupon_amt#10962 >= 2513.0) AND (ss_coupon_amt#10962 <= 3513.0))) OR ((ss_wholesale_cost#10954 >= 42.0) AND (ss_wholesale_cost#10954 <= 62.0))))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_quantity#10953,ss_wholesale_cost#10954,ss_list_price#10955,ss_coupon_amt#10962,ss_sold_date_sk#10966L] Batched: true, DataFilters: [isnotnull(ss_quantity#10953), (ss_quantity#10953 >= 26), (ss_quantity#10953 <= 30), ((((ss_list_..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,26), LessThanOrEqual(ss_quantity,30), Or(..., ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:double,ss_list_price:double,ss_coupon_amt:double>

read query: spark_queries/q29.sql
explain query: q29
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name], ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name, 'sum('ss_quantity) AS store_sales_quantity#11069, 'sum('sr_return_quantity) AS store_returns_quantity#11070, 'sum('cs_quantity) AS catalog_sales_quantity#11071]
         +- 'Filter ((((('d1.d_moy = 4) AND ('d1.d_year = 1999)) AND (('d1.d_date_sk = 'ss_sold_date_sk) AND ('i_item_sk = 'ss_item_sk))) AND ((('s_store_sk = 'ss_store_sk) AND ('ss_customer_sk = 'sr_customer_sk)) AND (('ss_item_sk = 'sr_item_sk) AND ('ss_ticket_number = 'sr_ticket_number)))) AND (((('sr_returned_date_sk = 'd2.d_date_sk) AND (('d2.d_moy >= 4) AND ('d2.d_moy <= (4 + 3)))) AND (('d2.d_year = 1999) AND ('sr_customer_sk = 'cs_bill_customer_sk))) AND ((('sr_item_sk = 'cs_item_sk) AND ('cs_sold_date_sk = 'd3.d_date_sk)) AND 'd3.d_year IN (1999,(1999 + 1),(1999 + 2)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
               :  :  :  :  :  +- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  :  +- 'SubqueryAlias d1
               :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  :  +- 'SubqueryAlias d2
               :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  +- 'SubqueryAlias d3
               :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_item_id: string, i_item_desc: string, s_store_id: string, s_store_name: string, store_sales_quantity: bigint, store_returns_quantity: bigint, catalog_sales_quantity: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#11263 ASC NULLS FIRST, i_item_desc#11266 ASC NULLS FIRST, s_store_id#11234 ASC NULLS FIRST, s_store_name#11238 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238], [i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238, sum(ss_quantity#11081) AS store_sales_quantity#11069L, sum(sr_return_quantity#11104) AS store_returns_quantity#11070L, sum(cs_quantity#11132) AS catalog_sales_quantity#11071L]
         +- Filter (((((d_moy#11157 = 4) AND (d_year#11155 = 1999)) AND ((d_date_sk#11149L = ss_sold_date_sk#11094L) AND (i_item_sk#11262L = ss_item_sk#11073L))) AND (((s_store_sk#11233L = ss_store_sk#11078L) AND (ss_customer_sk#11074L = sr_customer_sk#11097L)) AND ((ss_item_sk#11073L = sr_item_sk#11096L) AND (ss_ticket_number#11080L = sr_ticket_number#11103L)))) AND ((((sr_returned_date_sk#11114L = d_date_sk#11177L) AND ((d_moy#11185 >= 4) AND (d_moy#11185 <= (4 + 3)))) AND ((d_year#11183 = 1999) AND (sr_customer_sk#11097L = cs_bill_customer_sk#11117L))) AND (((sr_item_sk#11096L = cs_item_sk#11129L) AND (cs_sold_date_sk#11148L = d_date_sk#11205L)) AND d_year#11211 IN (1999,(1999 + 1),(1999 + 2)))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- Join Inner
               :  :  :  :  :  :- Join Inner
               :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11072L,ss_item_sk#11073L,ss_customer_sk#11074L,ss_cdemo_sk#11075L,ss_hdemo_sk#11076L,ss_addr_sk#11077L,ss_store_sk#11078L,ss_promo_sk#11079L,ss_ticket_number#11080L,ss_quantity#11081,ss_wholesale_cost#11082,ss_list_price#11083,ss_sales_price#11084,ss_ext_discount_amt#11085,ss_ext_sales_price#11086,ss_ext_wholesale_cost#11087,ss_ext_list_price#11088,ss_ext_tax#11089,ss_coupon_amt#11090,ss_net_paid#11091,ss_net_paid_inc_tax#11092,ss_net_profit#11093,ss_sold_date_sk#11094L] orc
               :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
               :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#11095L,sr_item_sk#11096L,sr_customer_sk#11097L,sr_cdemo_sk#11098L,sr_hdemo_sk#11099L,sr_addr_sk#11100L,sr_store_sk#11101L,sr_reason_sk#11102L,sr_ticket_number#11103L,sr_return_quantity#11104,sr_return_amt#11105,sr_return_tax#11106,sr_return_amt_inc_tax#11107,sr_fee#11108,sr_return_ship_cost#11109,sr_refunded_cash#11110,sr_reversed_charge#11111,sr_store_credit#11112,sr_net_loss#11113,sr_returned_date_sk#11114L] orc
               :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11115L,cs_ship_date_sk#11116L,cs_bill_customer_sk#11117L,cs_bill_cdemo_sk#11118L,cs_bill_hdemo_sk#11119L,cs_bill_addr_sk#11120L,cs_ship_customer_sk#11121L,cs_ship_cdemo_sk#11122L,cs_ship_hdemo_sk#11123L,cs_ship_addr_sk#11124L,cs_call_center_sk#11125L,cs_catalog_page_sk#11126L,cs_ship_mode_sk#11127L,cs_warehouse_sk#11128L,cs_item_sk#11129L,cs_promo_sk#11130L,cs_order_number#11131L,cs_quantity#11132,cs_wholesale_cost#11133,cs_list_price#11134,cs_sales_price#11135,cs_ext_discount_amt#11136,cs_ext_sales_price#11137,cs_ext_wholesale_cost#11138,... 10 more fields] orc
               :  :  :  :  +- SubqueryAlias d1
               :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11149L,d_date_id#11150,d_date#11151,d_month_seq#11152,d_week_seq#11153,d_quarter_seq#11154,d_year#11155,d_dow#11156,d_moy#11157,d_dom#11158,d_qoy#11159,d_fy_year#11160,d_fy_quarter_seq#11161,d_fy_week_seq#11162,d_day_name#11163,d_quarter_name#11164,d_holiday#11165,d_weekend#11166,d_following_holiday#11167,d_first_dom#11168,d_last_dom#11169,d_same_day_ly#11170,d_same_day_lq#11171,d_current_day#11172,... 4 more fields] orc
               :  :  :  +- SubqueryAlias d2
               :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11177L,d_date_id#11178,d_date#11179,d_month_seq#11180,d_week_seq#11181,d_quarter_seq#11182,d_year#11183,d_dow#11184,d_moy#11185,d_dom#11186,d_qoy#11187,d_fy_year#11188,d_fy_quarter_seq#11189,d_fy_week_seq#11190,d_day_name#11191,d_quarter_name#11192,d_holiday#11193,d_weekend#11194,d_following_holiday#11195,d_first_dom#11196,d_last_dom#11197,d_same_day_ly#11198,d_same_day_lq#11199,d_current_day#11200,... 4 more fields] orc
               :  :  +- SubqueryAlias d3
               :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11205L,d_date_id#11206,d_date#11207,d_month_seq#11208,d_week_seq#11209,d_quarter_seq#11210,d_year#11211,d_dow#11212,d_moy#11213,d_dom#11214,d_qoy#11215,d_fy_year#11216,d_fy_quarter_seq#11217,d_fy_week_seq#11218,d_day_name#11219,d_quarter_name#11220,d_holiday#11221,d_weekend#11222,d_following_holiday#11223,d_first_dom#11224,d_last_dom#11225,d_same_day_ly#11226,d_same_day_lq#11227,d_current_day#11228,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#11233L,s_store_id#11234,s_rec_start_date#11235,s_rec_end_date#11236,s_closed_date_sk#11237L,s_store_name#11238,s_number_employees#11239,s_floor_space#11240,s_hours#11241,s_manager#11242,s_market_id#11243,s_geography_class#11244,s_market_desc#11245,s_market_manager#11246,s_division_id#11247,s_division_name#11248,s_company_id#11249,s_company_name#11250,s_street_number#11251,s_street_name#11252,s_street_type#11253,s_suite_number#11254,s_city#11255,s_county#11256,... 5 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11262L,i_item_id#11263,i_rec_start_date#11264,i_rec_end_date#11265,i_item_desc#11266,i_current_price#11267,i_wholesale_cost#11268,i_brand_id#11269,i_brand#11270,i_class_id#11271,i_class#11272,i_category_id#11273,i_category#11274,i_manufact_id#11275,i_manufact#11276,i_size#11277,i_formulation#11278,i_color#11279,i_units#11280,i_container#11281,i_manager_id#11282,i_product_name#11283] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#11263 ASC NULLS FIRST, i_item_desc#11266 ASC NULLS FIRST, s_store_id#11234 ASC NULLS FIRST, s_store_name#11238 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238], [i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238, sum(ss_quantity#11081) AS store_sales_quantity#11069L, sum(sr_return_quantity#11104) AS store_returns_quantity#11070L, sum(cs_quantity#11132) AS catalog_sales_quantity#11071L]
         +- Project [ss_quantity#11081, sr_return_quantity#11104, cs_quantity#11132, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266]
            +- Join Inner, ((sr_customer_sk#11097L = cs_bill_customer_sk#11117L) AND (sr_item_sk#11096L = cs_item_sk#11129L))
               :- Project [ss_quantity#11081, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266, sr_item_sk#11096L, sr_customer_sk#11097L, sr_return_quantity#11104]
               :  +- Join Inner, (((ss_customer_sk#11074L = sr_customer_sk#11097L) AND (ss_item_sk#11073L = sr_item_sk#11096L)) AND (ss_ticket_number#11080L = sr_ticket_number#11103L))
               :     :- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_ticket_number#11080L, ss_quantity#11081, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266]
               :     :  +- Join Inner, (i_item_sk#11262L = ss_item_sk#11073L)
               :     :     :- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_ticket_number#11080L, ss_quantity#11081, s_store_id#11234, s_store_name#11238]
               :     :     :  +- Join Inner, (s_store_sk#11233L = ss_store_sk#11078L)
               :     :     :     :- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_store_sk#11078L, ss_ticket_number#11080L, ss_quantity#11081]
               :     :     :     :  +- Join Inner, (d_date_sk#11149L = ss_sold_date_sk#11094L)
               :     :     :     :     :- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_store_sk#11078L, ss_ticket_number#11080L, ss_quantity#11081, ss_sold_date_sk#11094L]
               :     :     :     :     :  +- Filter (((((isnotnull(ss_customer_sk#11074L) AND isnotnull(ss_item_sk#11073L)) AND isnotnull(ss_ticket_number#11080L)) AND isnotnull(ss_sold_date_sk#11094L)) AND isnotnull(ss_store_sk#11078L)) AND dynamicpruning#11294 [ss_sold_date_sk#11094L])
               :     :     :     :     :     :  +- Project [d_date_sk#11149L]
               :     :     :     :     :     :     +- Filter (((isnotnull(d_moy#11157) AND isnotnull(d_year#11155)) AND ((d_moy#11157 = 4) AND (d_year#11155 = 1999))) AND isnotnull(d_date_sk#11149L))
               :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11149L,d_date_id#11150,d_date#11151,d_month_seq#11152,d_week_seq#11153,d_quarter_seq#11154,d_year#11155,d_dow#11156,d_moy#11157,d_dom#11158,d_qoy#11159,d_fy_year#11160,d_fy_quarter_seq#11161,d_fy_week_seq#11162,d_day_name#11163,d_quarter_name#11164,d_holiday#11165,d_weekend#11166,d_following_holiday#11167,d_first_dom#11168,d_last_dom#11169,d_same_day_ly#11170,d_same_day_lq#11171,d_current_day#11172,... 4 more fields] orc
               :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11072L,ss_item_sk#11073L,ss_customer_sk#11074L,ss_cdemo_sk#11075L,ss_hdemo_sk#11076L,ss_addr_sk#11077L,ss_store_sk#11078L,ss_promo_sk#11079L,ss_ticket_number#11080L,ss_quantity#11081,ss_wholesale_cost#11082,ss_list_price#11083,ss_sales_price#11084,ss_ext_discount_amt#11085,ss_ext_sales_price#11086,ss_ext_wholesale_cost#11087,ss_ext_list_price#11088,ss_ext_tax#11089,ss_coupon_amt#11090,ss_net_paid#11091,ss_net_paid_inc_tax#11092,ss_net_profit#11093,ss_sold_date_sk#11094L] orc
               :     :     :     :     +- Project [d_date_sk#11149L]
               :     :     :     :        +- Filter (((isnotnull(d_moy#11157) AND isnotnull(d_year#11155)) AND ((d_moy#11157 = 4) AND (d_year#11155 = 1999))) AND isnotnull(d_date_sk#11149L))
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11149L,d_date_id#11150,d_date#11151,d_month_seq#11152,d_week_seq#11153,d_quarter_seq#11154,d_year#11155,d_dow#11156,d_moy#11157,d_dom#11158,d_qoy#11159,d_fy_year#11160,d_fy_quarter_seq#11161,d_fy_week_seq#11162,d_day_name#11163,d_quarter_name#11164,d_holiday#11165,d_weekend#11166,d_following_holiday#11167,d_first_dom#11168,d_last_dom#11169,d_same_day_ly#11170,d_same_day_lq#11171,d_current_day#11172,... 4 more fields] orc
               :     :     :     +- Project [s_store_sk#11233L, s_store_id#11234, s_store_name#11238]
               :     :     :        +- Filter isnotnull(s_store_sk#11233L)
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#11233L,s_store_id#11234,s_rec_start_date#11235,s_rec_end_date#11236,s_closed_date_sk#11237L,s_store_name#11238,s_number_employees#11239,s_floor_space#11240,s_hours#11241,s_manager#11242,s_market_id#11243,s_geography_class#11244,s_market_desc#11245,s_market_manager#11246,s_division_id#11247,s_division_name#11248,s_company_id#11249,s_company_name#11250,s_street_number#11251,s_street_name#11252,s_street_type#11253,s_suite_number#11254,s_city#11255,s_county#11256,... 5 more fields] orc
               :     :     +- Project [i_item_sk#11262L, i_item_id#11263, i_item_desc#11266]
               :     :        +- Filter isnotnull(i_item_sk#11262L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11262L,i_item_id#11263,i_rec_start_date#11264,i_rec_end_date#11265,i_item_desc#11266,i_current_price#11267,i_wholesale_cost#11268,i_brand_id#11269,i_brand#11270,i_class_id#11271,i_class#11272,i_category_id#11273,i_category#11274,i_manufact_id#11275,i_manufact#11276,i_size#11277,i_formulation#11278,i_color#11279,i_units#11280,i_container#11281,i_manager_id#11282,i_product_name#11283] orc
               :     +- Project [sr_item_sk#11096L, sr_customer_sk#11097L, sr_ticket_number#11103L, sr_return_quantity#11104]
               :        +- Join Inner, (sr_returned_date_sk#11114L = d_date_sk#11177L)
               :           :- Project [sr_item_sk#11096L, sr_customer_sk#11097L, sr_ticket_number#11103L, sr_return_quantity#11104, sr_returned_date_sk#11114L]
               :           :  +- Filter ((((isnotnull(sr_customer_sk#11097L) AND isnotnull(sr_item_sk#11096L)) AND isnotnull(sr_ticket_number#11103L)) AND isnotnull(sr_returned_date_sk#11114L)) AND dynamicpruning#11295 [sr_returned_date_sk#11114L])
               :           :     :  +- Project [d_date_sk#11177L]
               :           :     :     +- Filter (((isnotnull(d_moy#11185) AND isnotnull(d_year#11183)) AND (((d_moy#11185 >= 4) AND (d_moy#11185 <= 7)) AND (d_year#11183 = 1999))) AND isnotnull(d_date_sk#11177L))
               :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11177L,d_date_id#11178,d_date#11179,d_month_seq#11180,d_week_seq#11181,d_quarter_seq#11182,d_year#11183,d_dow#11184,d_moy#11185,d_dom#11186,d_qoy#11187,d_fy_year#11188,d_fy_quarter_seq#11189,d_fy_week_seq#11190,d_day_name#11191,d_quarter_name#11192,d_holiday#11193,d_weekend#11194,d_following_holiday#11195,d_first_dom#11196,d_last_dom#11197,d_same_day_ly#11198,d_same_day_lq#11199,d_current_day#11200,... 4 more fields] orc
               :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#11095L,sr_item_sk#11096L,sr_customer_sk#11097L,sr_cdemo_sk#11098L,sr_hdemo_sk#11099L,sr_addr_sk#11100L,sr_store_sk#11101L,sr_reason_sk#11102L,sr_ticket_number#11103L,sr_return_quantity#11104,sr_return_amt#11105,sr_return_tax#11106,sr_return_amt_inc_tax#11107,sr_fee#11108,sr_return_ship_cost#11109,sr_refunded_cash#11110,sr_reversed_charge#11111,sr_store_credit#11112,sr_net_loss#11113,sr_returned_date_sk#11114L] orc
               :           +- Project [d_date_sk#11177L]
               :              +- Filter (((isnotnull(d_moy#11185) AND isnotnull(d_year#11183)) AND (((d_moy#11185 >= 4) AND (d_moy#11185 <= 7)) AND (d_year#11183 = 1999))) AND isnotnull(d_date_sk#11177L))
               :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11177L,d_date_id#11178,d_date#11179,d_month_seq#11180,d_week_seq#11181,d_quarter_seq#11182,d_year#11183,d_dow#11184,d_moy#11185,d_dom#11186,d_qoy#11187,d_fy_year#11188,d_fy_quarter_seq#11189,d_fy_week_seq#11190,d_day_name#11191,d_quarter_name#11192,d_holiday#11193,d_weekend#11194,d_following_holiday#11195,d_first_dom#11196,d_last_dom#11197,d_same_day_ly#11198,d_same_day_lq#11199,d_current_day#11200,... 4 more fields] orc
               +- Project [cs_bill_customer_sk#11117L, cs_item_sk#11129L, cs_quantity#11132]
                  +- Join Inner, (cs_sold_date_sk#11148L = d_date_sk#11205L)
                     :- Project [cs_bill_customer_sk#11117L, cs_item_sk#11129L, cs_quantity#11132, cs_sold_date_sk#11148L]
                     :  +- Filter (((isnotnull(cs_bill_customer_sk#11117L) AND isnotnull(cs_item_sk#11129L)) AND isnotnull(cs_sold_date_sk#11148L)) AND dynamicpruning#11296 [cs_sold_date_sk#11148L])
                     :     :  +- Project [d_date_sk#11205L]
                     :     :     +- Filter (d_year#11211 IN (1999,2000,2001) AND isnotnull(d_date_sk#11205L))
                     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11205L,d_date_id#11206,d_date#11207,d_month_seq#11208,d_week_seq#11209,d_quarter_seq#11210,d_year#11211,d_dow#11212,d_moy#11213,d_dom#11214,d_qoy#11215,d_fy_year#11216,d_fy_quarter_seq#11217,d_fy_week_seq#11218,d_day_name#11219,d_quarter_name#11220,d_holiday#11221,d_weekend#11222,d_following_holiday#11223,d_first_dom#11224,d_last_dom#11225,d_same_day_ly#11226,d_same_day_lq#11227,d_current_day#11228,... 4 more fields] orc
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11115L,cs_ship_date_sk#11116L,cs_bill_customer_sk#11117L,cs_bill_cdemo_sk#11118L,cs_bill_hdemo_sk#11119L,cs_bill_addr_sk#11120L,cs_ship_customer_sk#11121L,cs_ship_cdemo_sk#11122L,cs_ship_hdemo_sk#11123L,cs_ship_addr_sk#11124L,cs_call_center_sk#11125L,cs_catalog_page_sk#11126L,cs_ship_mode_sk#11127L,cs_warehouse_sk#11128L,cs_item_sk#11129L,cs_promo_sk#11130L,cs_order_number#11131L,cs_quantity#11132,cs_wholesale_cost#11133,cs_list_price#11134,cs_sales_price#11135,cs_ext_discount_amt#11136,cs_ext_sales_price#11137,cs_ext_wholesale_cost#11138,... 10 more fields] orc
                     +- Project [d_date_sk#11205L]
                        +- Filter (d_year#11211 IN (1999,2000,2001) AND isnotnull(d_date_sk#11205L))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11205L,d_date_id#11206,d_date#11207,d_month_seq#11208,d_week_seq#11209,d_quarter_seq#11210,d_year#11211,d_dow#11212,d_moy#11213,d_dom#11214,d_qoy#11215,d_fy_year#11216,d_fy_quarter_seq#11217,d_fy_week_seq#11218,d_day_name#11219,d_quarter_name#11220,d_holiday#11221,d_weekend#11222,d_following_holiday#11223,d_first_dom#11224,d_last_dom#11225,d_same_day_ly#11226,d_same_day_lq#11227,d_current_day#11228,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#11263 ASC NULLS FIRST,i_item_desc#11266 ASC NULLS FIRST,s_store_id#11234 ASC NULLS FIRST,s_store_name#11238 ASC NULLS FIRST], output=[i_item_id#11263,i_item_desc#11266,s_store_id#11234,s_store_name#11238,store_sales_quantity#11069L,store_returns_quantity#11070L,catalog_sales_quantity#11071L])
   +- HashAggregate(keys=[i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238], functions=[sum(ss_quantity#11081), sum(sr_return_quantity#11104), sum(cs_quantity#11132)], output=[i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238, store_sales_quantity#11069L, store_returns_quantity#11070L, catalog_sales_quantity#11071L])
      +- Exchange hashpartitioning(i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238, 3000), ENSURE_REQUIREMENTS, [id=#11593]
         +- HashAggregate(keys=[i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238], functions=[partial_sum(ss_quantity#11081), partial_sum(sr_return_quantity#11104), partial_sum(cs_quantity#11132)], output=[i_item_id#11263, i_item_desc#11266, s_store_id#11234, s_store_name#11238, sum#11300L, sum#11301L, sum#11302L])
            +- Project [ss_quantity#11081, sr_return_quantity#11104, cs_quantity#11132, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266]
               +- SortMergeJoin [sr_customer_sk#11097L, sr_item_sk#11096L], [cs_bill_customer_sk#11117L, cs_item_sk#11129L], Inner
                  :- Sort [sr_customer_sk#11097L ASC NULLS FIRST, sr_item_sk#11096L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(sr_customer_sk#11097L, sr_item_sk#11096L, 3000), ENSURE_REQUIREMENTS, [id=#11585]
                  :     +- Project [ss_quantity#11081, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266, sr_item_sk#11096L, sr_customer_sk#11097L, sr_return_quantity#11104]
                  :        +- SortMergeJoin [ss_customer_sk#11074L, ss_item_sk#11073L, ss_ticket_number#11080L], [sr_customer_sk#11097L, sr_item_sk#11096L, sr_ticket_number#11103L], Inner
                  :           :- Sort [ss_customer_sk#11074L ASC NULLS FIRST, ss_item_sk#11073L ASC NULLS FIRST, ss_ticket_number#11080L ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(ss_customer_sk#11074L, ss_item_sk#11073L, ss_ticket_number#11080L, 3000), ENSURE_REQUIREMENTS, [id=#11574]
                  :           :     +- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_ticket_number#11080L, ss_quantity#11081, s_store_id#11234, s_store_name#11238, i_item_id#11263, i_item_desc#11266]
                  :           :        +- SortMergeJoin [ss_item_sk#11073L], [i_item_sk#11262L], Inner
                  :           :           :- Sort [ss_item_sk#11073L ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(ss_item_sk#11073L, 3000), ENSURE_REQUIREMENTS, [id=#11563]
                  :           :           :     +- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_ticket_number#11080L, ss_quantity#11081, s_store_id#11234, s_store_name#11238]
                  :           :           :        +- BroadcastHashJoin [ss_store_sk#11078L], [s_store_sk#11233L], Inner, BuildRight, false
                  :           :           :           :- Project [ss_item_sk#11073L, ss_customer_sk#11074L, ss_store_sk#11078L, ss_ticket_number#11080L, ss_quantity#11081]
                  :           :           :           :  +- BroadcastHashJoin [ss_sold_date_sk#11094L], [d_date_sk#11149L], Inner, BuildRight, false
                  :           :           :           :     :- Filter (((isnotnull(ss_customer_sk#11074L) AND isnotnull(ss_item_sk#11073L)) AND isnotnull(ss_ticket_number#11080L)) AND isnotnull(ss_store_sk#11078L))
                  :           :           :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#11073L,ss_customer_sk#11074L,ss_store_sk#11078L,ss_ticket_number#11080L,ss_quantity#11081,ss_sold_date_sk#11094L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#11074L), isnotnull(ss_item_sk#11073L), isnotnull(ss_ticket_number#11080..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#11094L), dynamicpruningexpression(ss_sold_date_sk#11094L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint,ss_quan...
                  :           :           :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#11294, 0, true, Project [d_date_sk#11149L], [d_date_sk#11149L]
                  :           :           :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :           :           :     :              +- Project [d_date_sk#11149L]
                  :           :           :           :     :                 +- Filter ((((isnotnull(d_moy#11157) AND isnotnull(d_year#11155)) AND (d_moy#11157 = 4)) AND (d_year#11155 = 1999)) AND isnotnull(d_date_sk#11149L))
                  :           :           :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11149L,d_year#11155,d_moy#11157] Batched: true, DataFilters: [isnotnull(d_moy#11157), isnotnull(d_year#11155), (d_moy#11157 = 4), (d_year#11155 = 1999), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,4), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11554]
                  :           :           :           :        +- Project [d_date_sk#11149L]
                  :           :           :           :           +- Filter ((((isnotnull(d_moy#11157) AND isnotnull(d_year#11155)) AND (d_moy#11157 = 4)) AND (d_year#11155 = 1999)) AND isnotnull(d_date_sk#11149L))
                  :           :           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11149L,d_year#11155,d_moy#11157] Batched: true, DataFilters: [isnotnull(d_moy#11157), isnotnull(d_year#11155), (d_moy#11157 = 4), (d_year#11155 = 1999), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,4), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#11558]
                  :           :           :              +- Filter isnotnull(s_store_sk#11233L)
                  :           :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#11233L,s_store_id#11234,s_store_name#11238] Batched: true, DataFilters: [isnotnull(s_store_sk#11233L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string,s_store_name:string>
                  :           :           +- Sort [i_item_sk#11262L ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(i_item_sk#11262L, 3000), ENSURE_REQUIREMENTS, [id=#11564]
                  :           :                 +- Filter isnotnull(i_item_sk#11262L)
                  :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11262L,i_item_id#11263,i_item_desc#11266] Batched: true, DataFilters: [isnotnull(i_item_sk#11262L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string>
                  :           +- Sort [sr_customer_sk#11097L ASC NULLS FIRST, sr_item_sk#11096L ASC NULLS FIRST, sr_ticket_number#11103L ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(sr_customer_sk#11097L, sr_item_sk#11096L, sr_ticket_number#11103L, 3000), ENSURE_REQUIREMENTS, [id=#11575]
                  :                 +- Project [sr_item_sk#11096L, sr_customer_sk#11097L, sr_ticket_number#11103L, sr_return_quantity#11104]
                  :                    +- BroadcastHashJoin [sr_returned_date_sk#11114L], [d_date_sk#11177L], Inner, BuildRight, false
                  :                       :- Filter ((isnotnull(sr_customer_sk#11097L) AND isnotnull(sr_item_sk#11096L)) AND isnotnull(sr_ticket_number#11103L))
                  :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#11096L,sr_customer_sk#11097L,sr_ticket_number#11103L,sr_return_quantity#11104,sr_returned_date_sk#11114L] Batched: true, DataFilters: [isnotnull(sr_customer_sk#11097L), isnotnull(sr_item_sk#11096L), isnotnull(sr_ticket_number#11103L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#11114L), dynamicpruningexpression(sr_returned_date_sk#11114L IN dy..., PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_customer_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int>
                  :                       :        +- SubqueryAdaptiveBroadcast dynamicpruning#11295, 0, true, Project [d_date_sk#11177L], [d_date_sk#11177L]
                  :                       :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                       :              +- Project [d_date_sk#11177L]
                  :                       :                 +- Filter (((((isnotnull(d_moy#11185) AND isnotnull(d_year#11183)) AND (d_moy#11185 >= 4)) AND (d_moy#11185 <= 7)) AND (d_year#11183 = 1999)) AND isnotnull(d_date_sk#11177L))
                  :                       :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11177L,d_year#11183,d_moy#11185] Batched: true, DataFilters: [isnotnull(d_moy#11185), isnotnull(d_year#11183), (d_moy#11185 >= 4), (d_moy#11185 <= 7), (d_year..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,7), Equa..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11569]
                  :                          +- Project [d_date_sk#11177L]
                  :                             +- Filter (((((isnotnull(d_moy#11185) AND isnotnull(d_year#11183)) AND (d_moy#11185 >= 4)) AND (d_moy#11185 <= 7)) AND (d_year#11183 = 1999)) AND isnotnull(d_date_sk#11177L))
                  :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11177L,d_year#11183,d_moy#11185] Batched: true, DataFilters: [isnotnull(d_moy#11185), isnotnull(d_year#11183), (d_moy#11185 >= 4), (d_moy#11185 <= 7), (d_year..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,7), Equa..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  +- Sort [cs_bill_customer_sk#11117L ASC NULLS FIRST, cs_item_sk#11129L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cs_bill_customer_sk#11117L, cs_item_sk#11129L, 3000), ENSURE_REQUIREMENTS, [id=#11586]
                        +- Project [cs_bill_customer_sk#11117L, cs_item_sk#11129L, cs_quantity#11132]
                           +- BroadcastHashJoin [cs_sold_date_sk#11148L], [d_date_sk#11205L], Inner, BuildRight, false
                              :- Filter (isnotnull(cs_bill_customer_sk#11117L) AND isnotnull(cs_item_sk#11129L))
                              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#11117L,cs_item_sk#11129L,cs_quantity#11132,cs_sold_date_sk#11148L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#11117L), isnotnull(cs_item_sk#11129L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#11148L), dynamicpruningexpression(cs_sold_date_sk#11148L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_quantity:int>
                              :        +- SubqueryAdaptiveBroadcast dynamicpruning#11296, 0, true, Project [d_date_sk#11205L], [d_date_sk#11205L]
                              :           +- AdaptiveSparkPlan isFinalPlan=false
                              :              +- Project [d_date_sk#11205L]
                              :                 +- Filter (d_year#11211 IN (1999,2000,2001) AND isnotnull(d_date_sk#11205L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11205L,d_year#11211] Batched: true, DataFilters: [d_year#11211 IN (1999,2000,2001), isnotnull(d_date_sk#11205L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11580]
                                 +- Project [d_date_sk#11205L]
                                    +- Filter (d_year#11211 IN (1999,2000,2001) AND isnotnull(d_date_sk#11205L))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11205L,d_year#11211] Batched: true, DataFilters: [d_year#11211 IN (1999,2000,2001), isnotnull(d_date_sk#11205L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>

read query: spark_queries/q30.sql
explain query: q30
== Parsed Logical Plan ==
CTE [customer_total_return]
:  +- 'SubqueryAlias customer_total_return
:     +- 'Aggregate ['wr_returning_customer_sk, 'ca_state], ['wr_returning_customer_sk AS ctr_customer_sk#11304, 'ca_state AS ctr_state#11305, 'sum('wr_return_amt) AS ctr_total_return#11306]
:        +- 'Filter ((('wr_returned_date_sk = 'd_date_sk) AND ('d_year = 2002)) AND ('wr_returning_addr_sk = 'ca_address_sk))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_returns], [], false
:              :  +- 'UnresolvedRelation [date_dim], [], false
:              +- 'UnresolvedRelation [customer_address], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['c_customer_id ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_last_name ASC NULLS FIRST, 'c_preferred_cust_flag ASC NULLS FIRST, 'c_birth_day ASC NULLS FIRST, 'c_birth_month ASC NULLS FIRST, 'c_birth_year ASC NULLS FIRST, 'c_birth_country ASC NULLS FIRST, 'c_login ASC NULLS FIRST, 'c_email_address ASC NULLS FIRST, 'c_last_review_date ASC NULLS FIRST, 'ctr_total_return ASC NULLS FIRST], true
         +- 'Project ['c_customer_id, 'c_salutation, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_day, 'c_birth_month, 'c_birth_year, 'c_birth_country, 'c_login, 'c_email_address, 'c_last_review_date, 'ctr_total_return]
            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#11303 []) AND ('ca_address_sk = 'c_current_addr_sk)) AND (('ca_state = IL) AND ('ctr1.ctr_customer_sk = 'c_customer_sk)))
               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]
               :     +- 'Filter ('ctr1.ctr_state = 'ctr2.ctr_state)
               :        +- 'SubqueryAlias ctr2
               :           +- 'UnresolvedRelation [customer_total_return], [], false
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'SubqueryAlias ctr1
                  :  :  +- 'UnresolvedRelation [customer_total_return], [], false
                  :  +- 'UnresolvedRelation [customer_address], [], false
                  +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_customer_id: string, c_salutation: string, c_first_name: string, c_last_name: string, c_preferred_cust_flag: string, c_birth_day: int, c_birth_month: int, c_birth_year: int, c_birth_country: string, c_login: string, c_email_address: string, c_last_review_date: string, ctr_total_return: double
WithCTE
:- CTERelationDef 19
:  +- SubqueryAlias customer_total_return
:     +- Aggregate [wr_returning_customer_sk#11313L, ca_state#11367], [wr_returning_customer_sk#11313L AS ctr_customer_sk#11304L, ca_state#11367 AS ctr_state#11305, sum(wr_return_amt#11321) AS ctr_total_return#11306]
:        +- Filter (((wr_returned_date_sk#11330L = d_date_sk#11331L) AND (d_year#11337 = 2002)) AND (wr_returning_addr_sk#11316L = ca_address_sk#11359L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#11307L,wr_item_sk#11308L,wr_refunded_customer_sk#11309L,wr_refunded_cdemo_sk#11310L,wr_refunded_hdemo_sk#11311L,wr_refunded_addr_sk#11312L,wr_returning_customer_sk#11313L,wr_returning_cdemo_sk#11314L,wr_returning_hdemo_sk#11315L,wr_returning_addr_sk#11316L,wr_web_page_sk#11317L,wr_reason_sk#11318L,wr_order_number#11319L,wr_return_quantity#11320,wr_return_amt#11321,wr_return_tax#11322,wr_return_amt_inc_tax#11323,wr_fee#11324,wr_return_ship_cost#11325,wr_refunded_cash#11326,wr_reversed_charge#11327,wr_account_credit#11328,wr_net_loss#11329,wr_returned_date_sk#11330L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_date_id#11332,d_date#11333,d_month_seq#11334,d_week_seq#11335,d_quarter_seq#11336,d_year#11337,d_dow#11338,d_moy#11339,d_dom#11340,d_qoy#11341,d_fy_year#11342,d_fy_quarter_seq#11343,d_fy_week_seq#11344,d_day_name#11345,d_quarter_name#11346,d_holiday#11347,d_weekend#11348,d_following_holiday#11349,d_first_dom#11350,d_last_dom#11351,d_same_day_ly#11352,d_same_day_lq#11353,d_current_day#11354,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11359L,ca_address_id#11360,ca_street_number#11361,ca_street_name#11362,ca_street_type#11363,ca_suite_number#11364,ca_city#11365,ca_county#11366,ca_state#11367,ca_zip#11368,ca_country#11369,ca_gmt_offset#11370,ca_location_type#11371] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [c_customer_id#11386 ASC NULLS FIRST, c_salutation#11392 ASC NULLS FIRST, c_first_name#11393 ASC NULLS FIRST, c_last_name#11394 ASC NULLS FIRST, c_preferred_cust_flag#11395 ASC NULLS FIRST, c_birth_day#11396 ASC NULLS FIRST, c_birth_month#11397 ASC NULLS FIRST, c_birth_year#11398 ASC NULLS FIRST, c_birth_country#11399 ASC NULLS FIRST, c_login#11400 ASC NULLS FIRST, c_email_address#11401 ASC NULLS FIRST, c_last_review_date#11402 ASC NULLS FIRST, ctr_total_return#11306 ASC NULLS FIRST], true
         +- Project [c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402, ctr_total_return#11306]
            +- Filter (((ctr_total_return#11306 > scalar-subquery#11303 [ctr_state#11305]) AND (ca_address_sk#11372L = c_current_addr_sk#11389L)) AND ((ca_state#11380 = IL) AND (ctr_customer_sk#11304L = c_customer_sk#11385L)))
               :  +- Aggregate [(avg(ctr_total_return#11306) * cast(1.2 as double)) AS (avg(ctr_total_return) * 1.2)#11405]
               :     +- Filter (outer(ctr_state#11305) = ctr_state#11305)
               :        +- SubqueryAlias ctr2
               :           +- SubqueryAlias customer_total_return
               :              +- CTERelationRef 19, true, [ctr_customer_sk#11304L, ctr_state#11305, ctr_total_return#11306]
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias ctr1
                  :  :  +- SubqueryAlias customer_total_return
                  :  :     +- CTERelationRef 19, true, [ctr_customer_sk#11304L, ctr_state#11305, ctr_total_return#11306]
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11372L,ca_address_id#11373,ca_street_number#11374,ca_street_name#11375,ca_street_type#11376,ca_suite_number#11377,ca_city#11378,ca_county#11379,ca_state#11380,ca_zip#11381,ca_country#11382,ca_gmt_offset#11383,ca_location_type#11384] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#11385L,c_customer_id#11386,c_current_cdemo_sk#11387L,c_current_hdemo_sk#11388L,c_current_addr_sk#11389L,c_first_shipto_date_sk#11390L,c_first_sales_date_sk#11391L,c_salutation#11392,c_first_name#11393,c_last_name#11394,c_preferred_cust_flag#11395,c_birth_day#11396,c_birth_month#11397,c_birth_year#11398,c_birth_country#11399,c_login#11400,c_email_address#11401,c_last_review_date#11402] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_customer_id#11386 ASC NULLS FIRST, c_salutation#11392 ASC NULLS FIRST, c_first_name#11393 ASC NULLS FIRST, c_last_name#11394 ASC NULLS FIRST, c_preferred_cust_flag#11395 ASC NULLS FIRST, c_birth_day#11396 ASC NULLS FIRST, c_birth_month#11397 ASC NULLS FIRST, c_birth_year#11398 ASC NULLS FIRST, c_birth_country#11399 ASC NULLS FIRST, c_login#11400 ASC NULLS FIRST, c_email_address#11401 ASC NULLS FIRST, c_last_review_date#11402 ASC NULLS FIRST, ctr_total_return#11306 ASC NULLS FIRST], true
      +- Project [c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402, ctr_total_return#11306]
         +- Join Inner, ((ctr_total_return#11306 > (avg(ctr_total_return) * 1.2)#11405) AND (ctr_state#11305 = ctr_state#11305#11419))
            :- Project [c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402, ctr_state#11305, ctr_total_return#11306]
            :  +- Join Inner, (ctr_customer_sk#11304L = c_customer_sk#11385L)
            :     :- Project [c_customer_sk#11385L, c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402]
            :     :  +- Join Inner, (ca_address_sk#11372L = c_current_addr_sk#11389L)
            :     :     :- Project [c_customer_sk#11385L, c_customer_id#11386, c_current_addr_sk#11389L, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402]
            :     :     :  +- Filter (isnotnull(c_customer_sk#11385L) AND isnotnull(c_current_addr_sk#11389L))
            :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#11385L,c_customer_id#11386,c_current_cdemo_sk#11387L,c_current_hdemo_sk#11388L,c_current_addr_sk#11389L,c_first_shipto_date_sk#11390L,c_first_sales_date_sk#11391L,c_salutation#11392,c_first_name#11393,c_last_name#11394,c_preferred_cust_flag#11395,c_birth_day#11396,c_birth_month#11397,c_birth_year#11398,c_birth_country#11399,c_login#11400,c_email_address#11401,c_last_review_date#11402] orc
            :     :     +- Project [ca_address_sk#11372L]
            :     :        +- Filter ((isnotnull(ca_state#11380) AND (ca_state#11380 = IL)) AND isnotnull(ca_address_sk#11372L))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11372L,ca_address_id#11373,ca_street_number#11374,ca_street_name#11375,ca_street_type#11376,ca_suite_number#11377,ca_city#11378,ca_county#11379,ca_state#11380,ca_zip#11381,ca_country#11382,ca_gmt_offset#11383,ca_location_type#11384] orc
            :     +- Filter isnotnull(ctr_total_return#11306)
            :        +- Aggregate [wr_returning_customer_sk#11313L, ca_state#11367], [wr_returning_customer_sk#11313L AS ctr_customer_sk#11304L, ca_state#11367 AS ctr_state#11305, sum(wr_return_amt#11321) AS ctr_total_return#11306]
            :           +- Project [wr_returning_customer_sk#11313L, wr_return_amt#11321, ca_state#11367]
            :              +- Join Inner, (wr_returning_addr_sk#11316L = ca_address_sk#11359L)
            :                 :- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321]
            :                 :  +- Join Inner, (wr_returned_date_sk#11330L = d_date_sk#11331L)
            :                 :     :- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321, wr_returned_date_sk#11330L]
            :                 :     :  +- Filter (((isnotnull(wr_returned_date_sk#11330L) AND isnotnull(wr_returning_addr_sk#11316L)) AND isnotnull(wr_returning_customer_sk#11313L)) AND dynamicpruning#11420 [wr_returned_date_sk#11330L])
            :                 :     :     :  +- Project [d_date_sk#11331L]
            :                 :     :     :     +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
            :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_date_id#11332,d_date#11333,d_month_seq#11334,d_week_seq#11335,d_quarter_seq#11336,d_year#11337,d_dow#11338,d_moy#11339,d_dom#11340,d_qoy#11341,d_fy_year#11342,d_fy_quarter_seq#11343,d_fy_week_seq#11344,d_day_name#11345,d_quarter_name#11346,d_holiday#11347,d_weekend#11348,d_following_holiday#11349,d_first_dom#11350,d_last_dom#11351,d_same_day_ly#11352,d_same_day_lq#11353,d_current_day#11354,... 4 more fields] orc
            :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#11307L,wr_item_sk#11308L,wr_refunded_customer_sk#11309L,wr_refunded_cdemo_sk#11310L,wr_refunded_hdemo_sk#11311L,wr_refunded_addr_sk#11312L,wr_returning_customer_sk#11313L,wr_returning_cdemo_sk#11314L,wr_returning_hdemo_sk#11315L,wr_returning_addr_sk#11316L,wr_web_page_sk#11317L,wr_reason_sk#11318L,wr_order_number#11319L,wr_return_quantity#11320,wr_return_amt#11321,wr_return_tax#11322,wr_return_amt_inc_tax#11323,wr_fee#11324,wr_return_ship_cost#11325,wr_refunded_cash#11326,wr_reversed_charge#11327,wr_account_credit#11328,wr_net_loss#11329,wr_returned_date_sk#11330L] orc
            :                 :     +- Project [d_date_sk#11331L]
            :                 :        +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
            :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_date_id#11332,d_date#11333,d_month_seq#11334,d_week_seq#11335,d_quarter_seq#11336,d_year#11337,d_dow#11338,d_moy#11339,d_dom#11340,d_qoy#11341,d_fy_year#11342,d_fy_quarter_seq#11343,d_fy_week_seq#11344,d_day_name#11345,d_quarter_name#11346,d_holiday#11347,d_weekend#11348,d_following_holiday#11349,d_first_dom#11350,d_last_dom#11351,d_same_day_ly#11352,d_same_day_lq#11353,d_current_day#11354,... 4 more fields] orc
            :                 +- Project [ca_address_sk#11359L, ca_state#11367]
            :                    +- Filter (isnotnull(ca_address_sk#11359L) AND isnotnull(ca_state#11367))
            :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11359L,ca_address_id#11360,ca_street_number#11361,ca_street_name#11362,ca_street_type#11363,ca_suite_number#11364,ca_city#11365,ca_county#11366,ca_state#11367,ca_zip#11368,ca_country#11369,ca_gmt_offset#11370,ca_location_type#11371] orc
            +- Filter isnotnull((avg(ctr_total_return) * 1.2)#11405)
               +- Aggregate [ctr_state#11305], [(avg(ctr_total_return#11306) * 1.2) AS (avg(ctr_total_return) * 1.2)#11405, ctr_state#11305 AS ctr_state#11305#11419]
                  +- Aggregate [wr_returning_customer_sk#11313L, ca_state#11367], [ca_state#11367 AS ctr_state#11305, sum(wr_return_amt#11321) AS ctr_total_return#11306]
                     +- Project [wr_returning_customer_sk#11313L, wr_return_amt#11321, ca_state#11367]
                        +- Join Inner, (wr_returning_addr_sk#11316L = ca_address_sk#11359L)
                           :- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321]
                           :  +- Join Inner, (wr_returned_date_sk#11330L = d_date_sk#11331L)
                           :     :- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321, wr_returned_date_sk#11330L]
                           :     :  +- Filter ((isnotnull(wr_returned_date_sk#11330L) AND isnotnull(wr_returning_addr_sk#11316L)) AND dynamicpruning#11421 [wr_returned_date_sk#11330L])
                           :     :     :  +- Project [d_date_sk#11331L]
                           :     :     :     +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
                           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_date_id#11332,d_date#11333,d_month_seq#11334,d_week_seq#11335,d_quarter_seq#11336,d_year#11337,d_dow#11338,d_moy#11339,d_dom#11340,d_qoy#11341,d_fy_year#11342,d_fy_quarter_seq#11343,d_fy_week_seq#11344,d_day_name#11345,d_quarter_name#11346,d_holiday#11347,d_weekend#11348,d_following_holiday#11349,d_first_dom#11350,d_last_dom#11351,d_same_day_ly#11352,d_same_day_lq#11353,d_current_day#11354,... 4 more fields] orc
                           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#11307L,wr_item_sk#11308L,wr_refunded_customer_sk#11309L,wr_refunded_cdemo_sk#11310L,wr_refunded_hdemo_sk#11311L,wr_refunded_addr_sk#11312L,wr_returning_customer_sk#11313L,wr_returning_cdemo_sk#11314L,wr_returning_hdemo_sk#11315L,wr_returning_addr_sk#11316L,wr_web_page_sk#11317L,wr_reason_sk#11318L,wr_order_number#11319L,wr_return_quantity#11320,wr_return_amt#11321,wr_return_tax#11322,wr_return_amt_inc_tax#11323,wr_fee#11324,wr_return_ship_cost#11325,wr_refunded_cash#11326,wr_reversed_charge#11327,wr_account_credit#11328,wr_net_loss#11329,wr_returned_date_sk#11330L] orc
                           :     +- Project [d_date_sk#11331L]
                           :        +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
                           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_date_id#11332,d_date#11333,d_month_seq#11334,d_week_seq#11335,d_quarter_seq#11336,d_year#11337,d_dow#11338,d_moy#11339,d_dom#11340,d_qoy#11341,d_fy_year#11342,d_fy_quarter_seq#11343,d_fy_week_seq#11344,d_day_name#11345,d_quarter_name#11346,d_holiday#11347,d_weekend#11348,d_following_holiday#11349,d_first_dom#11350,d_last_dom#11351,d_same_day_ly#11352,d_same_day_lq#11353,d_current_day#11354,... 4 more fields] orc
                           +- Project [ca_address_sk#11359L, ca_state#11367]
                              +- Filter (isnotnull(ca_address_sk#11359L) AND isnotnull(ca_state#11367))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11359L,ca_address_id#11360,ca_street_number#11361,ca_street_name#11362,ca_street_type#11363,ca_suite_number#11364,ca_city#11365,ca_county#11366,ca_state#11367,ca_zip#11368,ca_country#11369,ca_gmt_offset#11370,ca_location_type#11371] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_customer_id#11386 ASC NULLS FIRST,c_salutation#11392 ASC NULLS FIRST,c_first_name#11393 ASC NULLS FIRST,c_last_name#11394 ASC NULLS FIRST,c_preferred_cust_flag#11395 ASC NULLS FIRST,c_birth_day#11396 ASC NULLS FIRST,c_birth_month#11397 ASC NULLS FIRST,c_birth_year#11398 ASC NULLS FIRST,c_birth_country#11399 ASC NULLS FIRST,c_login#11400 ASC NULLS FIRST,c_email_address#11401 ASC NULLS FIRST,c_last_review_date#11402 ASC NULLS FIRST,ctr_total_return#11306 ASC NULLS FIRST], output=[c_customer_id#11386,c_salutation#11392,c_first_name#11393,c_last_name#11394,c_preferred_cust_flag#11395,c_birth_day#11396,c_birth_month#11397,c_birth_year#11398,c_birth_country#11399,c_login#11400,c_email_address#11401,c_last_review_date#11402,ctr_total_return#11306])
   +- Project [c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402, ctr_total_return#11306]
      +- BroadcastHashJoin [ctr_state#11305], [ctr_state#11305#11419], Inner, BuildRight, (ctr_total_return#11306 > (avg(ctr_total_return) * 1.2)#11405), false
         :- Project [c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402, ctr_state#11305, ctr_total_return#11306]
         :  +- SortMergeJoin [c_customer_sk#11385L], [ctr_customer_sk#11304L], Inner
         :     :- Sort [c_customer_sk#11385L ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(c_customer_sk#11385L, 3000), ENSURE_REQUIREMENTS, [id=#11831]
         :     :     +- Project [c_customer_sk#11385L, c_customer_id#11386, c_salutation#11392, c_first_name#11393, c_last_name#11394, c_preferred_cust_flag#11395, c_birth_day#11396, c_birth_month#11397, c_birth_year#11398, c_birth_country#11399, c_login#11400, c_email_address#11401, c_last_review_date#11402]
         :     :        +- BroadcastHashJoin [c_current_addr_sk#11389L], [ca_address_sk#11372L], Inner, BuildRight, false
         :     :           :- Filter (isnotnull(c_customer_sk#11385L) AND isnotnull(c_current_addr_sk#11389L))
         :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#11385L,c_customer_id#11386,c_current_addr_sk#11389L,c_salutation#11392,c_first_name#11393,c_last_name#11394,c_preferred_cust_flag#11395,c_birth_day#11396,c_birth_month#11397,c_birth_year#11398,c_birth_country#11399,c_login#11400,c_email_address#11401,c_last_review_date#11402] Batched: true, DataFilters: [isnotnull(c_customer_sk#11385L), isnotnull(c_current_addr_sk#11389L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_current_addr_sk:bigint,c_salutation:string,c_f...
         :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11810]
         :     :              +- Project [ca_address_sk#11372L]
         :     :                 +- Filter ((isnotnull(ca_state#11380) AND (ca_state#11380 = IL)) AND isnotnull(ca_address_sk#11372L))
         :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11372L,ca_state#11380] Batched: true, DataFilters: [isnotnull(ca_state#11380), (ca_state#11380 = IL), isnotnull(ca_address_sk#11372L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,IL), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
         :     +- Sort [ctr_customer_sk#11304L ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(ctr_customer_sk#11304L, 3000), ENSURE_REQUIREMENTS, [id=#11832]
         :           +- Filter isnotnull(ctr_total_return#11306)
         :              +- HashAggregate(keys=[wr_returning_customer_sk#11313L, ca_state#11367], functions=[sum(wr_return_amt#11321)], output=[ctr_customer_sk#11304L, ctr_state#11305, ctr_total_return#11306])
         :                 +- Exchange hashpartitioning(wr_returning_customer_sk#11313L, ca_state#11367, 3000), ENSURE_REQUIREMENTS, [id=#11826]
         :                    +- HashAggregate(keys=[wr_returning_customer_sk#11313L, ca_state#11367], functions=[partial_sum(wr_return_amt#11321)], output=[wr_returning_customer_sk#11313L, ca_state#11367, sum#11423])
         :                       +- Project [wr_returning_customer_sk#11313L, wr_return_amt#11321, ca_state#11367]
         :                          +- SortMergeJoin [wr_returning_addr_sk#11316L], [ca_address_sk#11359L], Inner
         :                             :- Sort [wr_returning_addr_sk#11316L ASC NULLS FIRST], false, 0
         :                             :  +- Exchange hashpartitioning(wr_returning_addr_sk#11316L, 3000), ENSURE_REQUIREMENTS, [id=#11818]
         :                             :     +- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321]
         :                             :        +- BroadcastHashJoin [wr_returned_date_sk#11330L], [d_date_sk#11331L], Inner, BuildRight, false
         :                             :           :- Filter (isnotnull(wr_returning_addr_sk#11316L) AND isnotnull(wr_returning_customer_sk#11313L))
         :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returning_customer_sk#11313L,wr_returning_addr_sk#11316L,wr_return_amt#11321,wr_returned_date_sk#11330L] Batched: true, DataFilters: [isnotnull(wr_returning_addr_sk#11316L), isnotnull(wr_returning_customer_sk#11313L)], Format: ORC, Location: InMemoryFileIndex(2184 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(wr_returned_date_sk#11330L), dynamicpruningexpression(wr_returned_date_sk#11330L IN dy..., PushedFilters: [IsNotNull(wr_returning_addr_sk), IsNotNull(wr_returning_customer_sk)], ReadSchema: struct<wr_returning_customer_sk:bigint,wr_returning_addr_sk:bigint,wr_return_amt:double>
         :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11420, 0, true, Project [d_date_sk#11331L], [d_date_sk#11331L]
         :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                             :           :              +- Project [d_date_sk#11331L]
         :                             :           :                 +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
         :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_year#11337] Batched: true, DataFilters: [isnotnull(d_year#11337), (d_year#11337 = 2002), isnotnull(d_date_sk#11331L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11813]
         :                             :              +- Project [d_date_sk#11331L]
         :                             :                 +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
         :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_year#11337] Batched: true, DataFilters: [isnotnull(d_year#11337), (d_year#11337 = 2002), isnotnull(d_date_sk#11331L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                             +- Sort [ca_address_sk#11359L ASC NULLS FIRST], false, 0
         :                                +- Exchange hashpartitioning(ca_address_sk#11359L, 3000), ENSURE_REQUIREMENTS, [id=#11819]
         :                                   +- Filter (isnotnull(ca_address_sk#11359L) AND isnotnull(ca_state#11367))
         :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11359L,ca_state#11367] Batched: true, DataFilters: [isnotnull(ca_address_sk#11359L), isnotnull(ca_state#11367)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
         +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, string, true]),false), [id=#11858]
            +- Filter isnotnull((avg(ctr_total_return) * 1.2)#11405)
               +- HashAggregate(keys=[ctr_state#11305], functions=[avg(ctr_total_return#11306)], output=[(avg(ctr_total_return) * 1.2)#11405, ctr_state#11305#11419])
                  +- Exchange hashpartitioning(ctr_state#11305, 3000), ENSURE_REQUIREMENTS, [id=#11854]
                     +- HashAggregate(keys=[ctr_state#11305], functions=[partial_avg(ctr_total_return#11306)], output=[ctr_state#11305, sum#11426, count#11427L])
                        +- HashAggregate(keys=[wr_returning_customer_sk#11313L, ca_state#11367], functions=[sum(wr_return_amt#11321)], output=[ctr_state#11305, ctr_total_return#11306])
                           +- Exchange hashpartitioning(wr_returning_customer_sk#11313L, ca_state#11367, 3000), ENSURE_REQUIREMENTS, [id=#11850]
                              +- HashAggregate(keys=[wr_returning_customer_sk#11313L, ca_state#11367], functions=[partial_sum(wr_return_amt#11321)], output=[wr_returning_customer_sk#11313L, ca_state#11367, sum#11423])
                                 +- Project [wr_returning_customer_sk#11313L, wr_return_amt#11321, ca_state#11367]
                                    +- SortMergeJoin [wr_returning_addr_sk#11316L], [ca_address_sk#11359L], Inner
                                       :- Sort [wr_returning_addr_sk#11316L ASC NULLS FIRST], false, 0
                                       :  +- Exchange hashpartitioning(wr_returning_addr_sk#11316L, 3000), ENSURE_REQUIREMENTS, [id=#11842]
                                       :     +- Project [wr_returning_customer_sk#11313L, wr_returning_addr_sk#11316L, wr_return_amt#11321]
                                       :        +- BroadcastHashJoin [wr_returned_date_sk#11330L], [d_date_sk#11331L], Inner, BuildRight, false
                                       :           :- Filter isnotnull(wr_returning_addr_sk#11316L)
                                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returning_customer_sk#11313L,wr_returning_addr_sk#11316L,wr_return_amt#11321,wr_returned_date_sk#11330L] Batched: true, DataFilters: [isnotnull(wr_returning_addr_sk#11316L)], Format: ORC, Location: InMemoryFileIndex(2184 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(wr_returned_date_sk#11330L), dynamicpruningexpression(wr_returned_date_sk#11330L IN dy..., PushedFilters: [IsNotNull(wr_returning_addr_sk)], ReadSchema: struct<wr_returning_customer_sk:bigint,wr_returning_addr_sk:bigint,wr_return_amt:double>
                                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11421, 0, true, Project [d_date_sk#11331L], [d_date_sk#11331L]
                                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :           :              +- Project [d_date_sk#11331L]
                                       :           :                 +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
                                       :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_year#11337] Batched: true, DataFilters: [isnotnull(d_year#11337), (d_year#11337 = 2002), isnotnull(d_date_sk#11331L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#11837]
                                       :              +- Project [d_date_sk#11331L]
                                       :                 +- Filter ((isnotnull(d_year#11337) AND (d_year#11337 = 2002)) AND isnotnull(d_date_sk#11331L))
                                       :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11331L,d_year#11337] Batched: true, DataFilters: [isnotnull(d_year#11337), (d_year#11337 = 2002), isnotnull(d_date_sk#11331L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       +- Sort [ca_address_sk#11359L ASC NULLS FIRST], false, 0
                                          +- Exchange hashpartitioning(ca_address_sk#11359L, 3000), ENSURE_REQUIREMENTS, [id=#11843]
                                             +- Filter (isnotnull(ca_address_sk#11359L) AND isnotnull(ca_state#11367))
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11359L,ca_state#11367] Batched: true, DataFilters: [isnotnull(ca_address_sk#11359L), isnotnull(ca_state#11367)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>

read query: spark_queries/q31.sql
explain query: q31
== Parsed Logical Plan ==
CTE [ss, ws]
:  :- 'SubqueryAlias ss
:  :  +- 'Aggregate ['ca_county, 'd_qoy, 'd_year], ['ca_county, 'd_qoy, 'd_year, 'sum('ss_ext_sales_price) AS store_sales#11432]
:  :     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND ('ss_addr_sk = 'ca_address_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [customer_address], [], false
:  +- 'SubqueryAlias ws
:     +- 'Aggregate ['ca_county, 'd_qoy, 'd_year], ['ca_county, 'd_qoy, 'd_year, 'sum('ws_ext_sales_price) AS web_sales#11433]
:        +- 'Filter (('ws_sold_date_sk = 'd_date_sk) AND ('ws_bill_addr_sk = 'ca_address_sk))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_sales], [], false
:              :  +- 'UnresolvedRelation [date_dim], [], false
:              +- 'UnresolvedRelation [customer_address], [], false
+- 'Sort ['ss1.d_year ASC NULLS FIRST], true
   +- 'Project ['ss1.ca_county, 'ss1.d_year, ('ws2.web_sales / 'ws1.web_sales) AS web_q1_q2_increase#11428, ('ss2.store_sales / 'ss1.store_sales) AS store_q1_q2_increase#11429, ('ws3.web_sales / 'ws2.web_sales) AS web_q2_q3_increase#11430, ('ss3.store_sales / 'ss2.store_sales) AS store_q2_q3_increase#11431]
      +- 'Filter (((((('ss1.d_qoy = 1) AND ('ss1.d_year = 2000)) AND ('ss1.ca_county = 'ss2.ca_county)) AND (('ss2.d_qoy = 2) AND ('ss2.d_year = 2000))) AND (((('ss2.ca_county = 'ss3.ca_county) AND ('ss3.d_qoy = 3)) AND ('ss3.d_year = 2000)) AND (('ss1.ca_county = 'ws1.ca_county) AND ('ws1.d_qoy = 1)))) AND ((((('ws1.d_year = 2000) AND ('ws1.ca_county = 'ws2.ca_county)) AND ('ws2.d_qoy = 2)) AND (('ws2.d_year = 2000) AND ('ws1.ca_county = 'ws3.ca_county))) AND ((('ws3.d_qoy = 3) AND ('ws3.d_year = 2000)) AND ((CASE WHEN ('ws1.web_sales > 0) THEN ('ws2.web_sales / 'ws1.web_sales) ELSE null END > CASE WHEN ('ss1.store_sales > 0) THEN ('ss2.store_sales / 'ss1.store_sales) ELSE null END) AND (CASE WHEN ('ws2.web_sales > 0) THEN ('ws3.web_sales / 'ws2.web_sales) ELSE null END > CASE WHEN ('ss2.store_sales > 0) THEN ('ss3.store_sales / 'ss2.store_sales) ELSE null END)))))
         +- 'Join Inner
            :- 'Join Inner
            :  :- 'Join Inner
            :  :  :- 'Join Inner
            :  :  :  :- 'Join Inner
            :  :  :  :  :- 'SubqueryAlias ss1
            :  :  :  :  :  +- 'UnresolvedRelation [ss], [], false
            :  :  :  :  +- 'SubqueryAlias ss2
            :  :  :  :     +- 'UnresolvedRelation [ss], [], false
            :  :  :  +- 'SubqueryAlias ss3
            :  :  :     +- 'UnresolvedRelation [ss], [], false
            :  :  +- 'SubqueryAlias ws1
            :  :     +- 'UnresolvedRelation [ws], [], false
            :  +- 'SubqueryAlias ws2
            :     +- 'UnresolvedRelation [ws], [], false
            +- 'SubqueryAlias ws3
               +- 'UnresolvedRelation [ws], [], false

== Analyzed Logical Plan ==
ca_county: string, d_year: int, web_q1_q2_increase: double, store_q1_q2_increase: double, web_q2_q3_increase: double, store_q2_q3_increase: double
WithCTE
:- CTERelationDef 20
:  +- SubqueryAlias ss
:     +- Aggregate [ca_county#11492, d_qoy#11467, d_year#11463], [ca_county#11492, d_qoy#11467, d_year#11463, sum(ss_ext_sales_price#11448) AS store_sales#11432]
:        +- Filter ((ss_sold_date_sk#11456L = d_date_sk#11457L) AND (ss_addr_sk#11439L = ca_address_sk#11485L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11434L,ss_item_sk#11435L,ss_customer_sk#11436L,ss_cdemo_sk#11437L,ss_hdemo_sk#11438L,ss_addr_sk#11439L,ss_store_sk#11440L,ss_promo_sk#11441L,ss_ticket_number#11442L,ss_quantity#11443,ss_wholesale_cost#11444,ss_list_price#11445,ss_sales_price#11446,ss_ext_discount_amt#11447,ss_ext_sales_price#11448,ss_ext_wholesale_cost#11449,ss_ext_list_price#11450,ss_ext_tax#11451,ss_coupon_amt#11452,ss_net_paid#11453,ss_net_paid_inc_tax#11454,ss_net_profit#11455,ss_sold_date_sk#11456L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11457L,d_date_id#11458,d_date#11459,d_month_seq#11460,d_week_seq#11461,d_quarter_seq#11462,d_year#11463,d_dow#11464,d_moy#11465,d_dom#11466,d_qoy#11467,d_fy_year#11468,d_fy_quarter_seq#11469,d_fy_week_seq#11470,d_day_name#11471,d_quarter_name#11472,d_holiday#11473,d_weekend#11474,d_following_holiday#11475,d_first_dom#11476,d_last_dom#11477,d_same_day_ly#11478,d_same_day_lq#11479,d_current_day#11480,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11485L,ca_address_id#11486,ca_street_number#11487,ca_street_name#11488,ca_street_type#11489,ca_suite_number#11490,ca_city#11491,ca_county#11492,ca_state#11493,ca_zip#11494,ca_country#11495,ca_gmt_offset#11496,ca_location_type#11497] orc
:- CTERelationDef 21
:  +- SubqueryAlias ws
:     +- Aggregate [ca_county#11567, d_qoy#11542, d_year#11538], [ca_county#11567, d_qoy#11542, d_year#11538, sum(ws_ext_sales_price#11520) AS web_sales#11433]
:        +- Filter ((ws_sold_date_sk#11531L = d_date_sk#11532L) AND (ws_bill_addr_sk#11504L = ca_address_sk#11560L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#11498L,ws_ship_date_sk#11499L,ws_item_sk#11500L,ws_bill_customer_sk#11501L,ws_bill_cdemo_sk#11502L,ws_bill_hdemo_sk#11503L,ws_bill_addr_sk#11504L,ws_ship_customer_sk#11505L,ws_ship_cdemo_sk#11506L,ws_ship_hdemo_sk#11507L,ws_ship_addr_sk#11508L,ws_web_page_sk#11509L,ws_web_site_sk#11510L,ws_ship_mode_sk#11511L,ws_warehouse_sk#11512L,ws_promo_sk#11513L,ws_order_number#11514L,ws_quantity#11515,ws_wholesale_cost#11516,ws_list_price#11517,ws_sales_price#11518,ws_ext_discount_amt#11519,ws_ext_sales_price#11520,ws_ext_wholesale_cost#11521,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11532L,d_date_id#11533,d_date#11534,d_month_seq#11535,d_week_seq#11536,d_quarter_seq#11537,d_year#11538,d_dow#11539,d_moy#11540,d_dom#11541,d_qoy#11542,d_fy_year#11543,d_fy_quarter_seq#11544,d_fy_week_seq#11545,d_day_name#11546,d_quarter_name#11547,d_holiday#11548,d_weekend#11549,d_following_holiday#11550,d_first_dom#11551,d_last_dom#11552,d_same_day_ly#11553,d_same_day_lq#11554,d_current_day#11555,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11560L,ca_address_id#11561,ca_street_number#11562,ca_street_name#11563,ca_street_type#11564,ca_suite_number#11565,ca_city#11566,ca_county#11567,ca_state#11568,ca_zip#11569,ca_country#11570,ca_gmt_offset#11571,ca_location_type#11572] orc
+- Sort [d_year#11463 ASC NULLS FIRST], true
   +- Project [ca_county#11492, d_year#11463, (web_sales#11586 / web_sales#11433) AS web_q1_q2_increase#11428, (store_sales#11578 / store_sales#11432) AS store_q1_q2_increase#11429, (web_sales#11590 / web_sales#11586) AS web_q2_q3_increase#11430, (store_sales#11582 / store_sales#11578) AS store_q2_q3_increase#11431]
      +- Filter ((((((d_qoy#11467 = 1) AND (d_year#11463 = 2000)) AND (ca_county#11492 = ca_county#11575)) AND ((d_qoy#11576 = 2) AND (d_year#11577 = 2000))) AND ((((ca_county#11575 = ca_county#11579) AND (d_qoy#11580 = 3)) AND (d_year#11581 = 2000)) AND ((ca_county#11492 = ca_county#11567) AND (d_qoy#11542 = 1)))) AND (((((d_year#11538 = 2000) AND (ca_county#11567 = ca_county#11583)) AND (d_qoy#11584 = 2)) AND ((d_year#11585 = 2000) AND (ca_county#11567 = ca_county#11587))) AND (((d_qoy#11588 = 3) AND (d_year#11589 = 2000)) AND ((CASE WHEN (web_sales#11433 > cast(0 as double)) THEN (web_sales#11586 / web_sales#11433) ELSE cast(null as double) END > CASE WHEN (store_sales#11432 > cast(0 as double)) THEN (store_sales#11578 / store_sales#11432) ELSE cast(null as double) END) AND (CASE WHEN (web_sales#11586 > cast(0 as double)) THEN (web_sales#11590 / web_sales#11586) ELSE cast(null as double) END > CASE WHEN (store_sales#11578 > cast(0 as double)) THEN (store_sales#11582 / store_sales#11578) ELSE cast(null as double) END)))))
         +- Join Inner
            :- Join Inner
            :  :- Join Inner
            :  :  :- Join Inner
            :  :  :  :- Join Inner
            :  :  :  :  :- SubqueryAlias ss1
            :  :  :  :  :  +- SubqueryAlias ss
            :  :  :  :  :     +- CTERelationRef 20, true, [ca_county#11492, d_qoy#11467, d_year#11463, store_sales#11432]
            :  :  :  :  +- SubqueryAlias ss2
            :  :  :  :     +- SubqueryAlias ss
            :  :  :  :        +- CTERelationRef 20, true, [ca_county#11575, d_qoy#11576, d_year#11577, store_sales#11578]
            :  :  :  +- SubqueryAlias ss3
            :  :  :     +- SubqueryAlias ss
            :  :  :        +- CTERelationRef 20, true, [ca_county#11579, d_qoy#11580, d_year#11581, store_sales#11582]
            :  :  +- SubqueryAlias ws1
            :  :     +- SubqueryAlias ws
            :  :        +- CTERelationRef 21, true, [ca_county#11567, d_qoy#11542, d_year#11538, web_sales#11433]
            :  +- SubqueryAlias ws2
            :     +- SubqueryAlias ws
            :        +- CTERelationRef 21, true, [ca_county#11583, d_qoy#11584, d_year#11585, web_sales#11586]
            +- SubqueryAlias ws3
               +- SubqueryAlias ws
                  +- CTERelationRef 21, true, [ca_county#11587, d_qoy#11588, d_year#11589, web_sales#11590]

== Optimized Logical Plan ==
Sort [d_year#11463 ASC NULLS FIRST], true
+- Project [ca_county#11492, d_year#11463, (web_sales#11586 / web_sales#11433) AS web_q1_q2_increase#11428, (store_sales#11578 / store_sales#11432) AS store_q1_q2_increase#11429, (web_sales#11590 / web_sales#11586) AS web_q2_q3_increase#11430, (store_sales#11582 / store_sales#11578) AS store_q2_q3_increase#11431]
   +- Join Inner, (((ca_county#11492 = ca_county#11567) AND (CASE WHEN (web_sales#11433 > 0.0) THEN (web_sales#11586 / web_sales#11433) END > CASE WHEN (store_sales#11432 > 0.0) THEN (store_sales#11578 / store_sales#11432) END)) AND (CASE WHEN (web_sales#11586 > 0.0) THEN (web_sales#11590 / web_sales#11586) END > CASE WHEN (store_sales#11578 > 0.0) THEN (store_sales#11582 / store_sales#11578) END))
      :- Project [store_sales#11578, store_sales#11582, ca_county#11492, d_year#11463, store_sales#11432]
      :  +- Join Inner, (ca_county#11492 = ca_county#11655)
      :     :- Project [ca_county#11655, store_sales#11578, store_sales#11582]
      :     :  +- Join Inner, (ca_county#11655 = ca_county#11720)
      :     :     :- Aggregate [ca_county#11655, d_qoy#11630, d_year#11626], [ca_county#11655, sum(ss_ext_sales_price#11611) AS store_sales#11578]
      :     :     :  +- Project [ss_ext_sales_price#11611, d_year#11626, d_qoy#11630, ca_county#11655]
      :     :     :     +- Join Inner, (ss_addr_sk#11602L = ca_address_sk#11648L)
      :     :     :        :- Project [ss_addr_sk#11602L, ss_ext_sales_price#11611, d_year#11626, d_qoy#11630]
      :     :     :        :  +- Join Inner, (ss_sold_date_sk#11619L = d_date_sk#11620L)
      :     :     :        :     :- Project [ss_addr_sk#11602L, ss_ext_sales_price#11611, ss_sold_date_sk#11619L]
      :     :     :        :     :  +- Filter ((isnotnull(ss_sold_date_sk#11619L) AND isnotnull(ss_addr_sk#11602L)) AND dynamicpruning#11879 [ss_sold_date_sk#11619L])
      :     :     :        :     :     :  +- Project [d_date_sk#11620L, d_year#11626, d_qoy#11630]
      :     :     :        :     :     :     +- Filter (((isnotnull(d_qoy#11630) AND isnotnull(d_year#11626)) AND ((d_qoy#11630 = 2) AND (d_year#11626 = 2000))) AND isnotnull(d_date_sk#11620L))
      :     :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11620L,d_date_id#11621,d_date#11622,d_month_seq#11623,d_week_seq#11624,d_quarter_seq#11625,d_year#11626,d_dow#11627,d_moy#11628,d_dom#11629,d_qoy#11630,d_fy_year#11631,d_fy_quarter_seq#11632,d_fy_week_seq#11633,d_day_name#11634,d_quarter_name#11635,d_holiday#11636,d_weekend#11637,d_following_holiday#11638,d_first_dom#11639,d_last_dom#11640,d_same_day_ly#11641,d_same_day_lq#11642,d_current_day#11643,... 4 more fields] orc
      :     :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11597L,ss_item_sk#11598L,ss_customer_sk#11599L,ss_cdemo_sk#11600L,ss_hdemo_sk#11601L,ss_addr_sk#11602L,ss_store_sk#11603L,ss_promo_sk#11604L,ss_ticket_number#11605L,ss_quantity#11606,ss_wholesale_cost#11607,ss_list_price#11608,ss_sales_price#11609,ss_ext_discount_amt#11610,ss_ext_sales_price#11611,ss_ext_wholesale_cost#11612,ss_ext_list_price#11613,ss_ext_tax#11614,ss_coupon_amt#11615,ss_net_paid#11616,ss_net_paid_inc_tax#11617,ss_net_profit#11618,ss_sold_date_sk#11619L] orc
      :     :     :        :     +- Project [d_date_sk#11620L, d_year#11626, d_qoy#11630]
      :     :     :        :        +- Filter (((isnotnull(d_qoy#11630) AND isnotnull(d_year#11626)) AND ((d_qoy#11630 = 2) AND (d_year#11626 = 2000))) AND isnotnull(d_date_sk#11620L))
      :     :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11620L,d_date_id#11621,d_date#11622,d_month_seq#11623,d_week_seq#11624,d_quarter_seq#11625,d_year#11626,d_dow#11627,d_moy#11628,d_dom#11629,d_qoy#11630,d_fy_year#11631,d_fy_quarter_seq#11632,d_fy_week_seq#11633,d_day_name#11634,d_quarter_name#11635,d_holiday#11636,d_weekend#11637,d_following_holiday#11638,d_first_dom#11639,d_last_dom#11640,d_same_day_ly#11641,d_same_day_lq#11642,d_current_day#11643,... 4 more fields] orc
      :     :     :        +- Project [ca_address_sk#11648L, ca_county#11655]
      :     :     :           +- Filter (isnotnull(ca_address_sk#11648L) AND isnotnull(ca_county#11655))
      :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11648L,ca_address_id#11649,ca_street_number#11650,ca_street_name#11651,ca_street_type#11652,ca_suite_number#11653,ca_city#11654,ca_county#11655,ca_state#11656,ca_zip#11657,ca_country#11658,ca_gmt_offset#11659,ca_location_type#11660] orc
      :     :     +- Aggregate [ca_county#11720, d_qoy#11695, d_year#11691], [ca_county#11720, sum(ss_ext_sales_price#11676) AS store_sales#11582]
      :     :        +- Project [ss_ext_sales_price#11676, d_year#11691, d_qoy#11695, ca_county#11720]
      :     :           +- Join Inner, (ss_addr_sk#11667L = ca_address_sk#11713L)
      :     :              :- Project [ss_addr_sk#11667L, ss_ext_sales_price#11676, d_year#11691, d_qoy#11695]
      :     :              :  +- Join Inner, (ss_sold_date_sk#11684L = d_date_sk#11685L)
      :     :              :     :- Project [ss_addr_sk#11667L, ss_ext_sales_price#11676, ss_sold_date_sk#11684L]
      :     :              :     :  +- Filter ((isnotnull(ss_sold_date_sk#11684L) AND isnotnull(ss_addr_sk#11667L)) AND dynamicpruning#11880 [ss_sold_date_sk#11684L])
      :     :              :     :     :  +- Project [d_date_sk#11685L, d_year#11691, d_qoy#11695]
      :     :              :     :     :     +- Filter (((isnotnull(d_qoy#11695) AND isnotnull(d_year#11691)) AND ((d_qoy#11695 = 3) AND (d_year#11691 = 2000))) AND isnotnull(d_date_sk#11685L))
      :     :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11685L,d_date_id#11686,d_date#11687,d_month_seq#11688,d_week_seq#11689,d_quarter_seq#11690,d_year#11691,d_dow#11692,d_moy#11693,d_dom#11694,d_qoy#11695,d_fy_year#11696,d_fy_quarter_seq#11697,d_fy_week_seq#11698,d_day_name#11699,d_quarter_name#11700,d_holiday#11701,d_weekend#11702,d_following_holiday#11703,d_first_dom#11704,d_last_dom#11705,d_same_day_ly#11706,d_same_day_lq#11707,d_current_day#11708,... 4 more fields] orc
      :     :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11662L,ss_item_sk#11663L,ss_customer_sk#11664L,ss_cdemo_sk#11665L,ss_hdemo_sk#11666L,ss_addr_sk#11667L,ss_store_sk#11668L,ss_promo_sk#11669L,ss_ticket_number#11670L,ss_quantity#11671,ss_wholesale_cost#11672,ss_list_price#11673,ss_sales_price#11674,ss_ext_discount_amt#11675,ss_ext_sales_price#11676,ss_ext_wholesale_cost#11677,ss_ext_list_price#11678,ss_ext_tax#11679,ss_coupon_amt#11680,ss_net_paid#11681,ss_net_paid_inc_tax#11682,ss_net_profit#11683,ss_sold_date_sk#11684L] orc
      :     :              :     +- Project [d_date_sk#11685L, d_year#11691, d_qoy#11695]
      :     :              :        +- Filter (((isnotnull(d_qoy#11695) AND isnotnull(d_year#11691)) AND ((d_qoy#11695 = 3) AND (d_year#11691 = 2000))) AND isnotnull(d_date_sk#11685L))
      :     :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11685L,d_date_id#11686,d_date#11687,d_month_seq#11688,d_week_seq#11689,d_quarter_seq#11690,d_year#11691,d_dow#11692,d_moy#11693,d_dom#11694,d_qoy#11695,d_fy_year#11696,d_fy_quarter_seq#11697,d_fy_week_seq#11698,d_day_name#11699,d_quarter_name#11700,d_holiday#11701,d_weekend#11702,d_following_holiday#11703,d_first_dom#11704,d_last_dom#11705,d_same_day_ly#11706,d_same_day_lq#11707,d_current_day#11708,... 4 more fields] orc
      :     :              +- Project [ca_address_sk#11713L, ca_county#11720]
      :     :                 +- Filter (isnotnull(ca_address_sk#11713L) AND isnotnull(ca_county#11720))
      :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11713L,ca_address_id#11714,ca_street_number#11715,ca_street_name#11716,ca_street_type#11717,ca_suite_number#11718,ca_city#11719,ca_county#11720,ca_state#11721,ca_zip#11722,ca_country#11723,ca_gmt_offset#11724,ca_location_type#11725] orc
      :     +- Aggregate [ca_county#11492, d_qoy#11467, d_year#11463], [ca_county#11492, d_year#11463, sum(ss_ext_sales_price#11448) AS store_sales#11432]
      :        +- Project [ss_ext_sales_price#11448, d_year#11463, d_qoy#11467, ca_county#11492]
      :           +- Join Inner, (ss_addr_sk#11439L = ca_address_sk#11485L)
      :              :- Project [ss_addr_sk#11439L, ss_ext_sales_price#11448, d_year#11463, d_qoy#11467]
      :              :  +- Join Inner, (ss_sold_date_sk#11456L = d_date_sk#11457L)
      :              :     :- Project [ss_addr_sk#11439L, ss_ext_sales_price#11448, ss_sold_date_sk#11456L]
      :              :     :  +- Filter ((isnotnull(ss_sold_date_sk#11456L) AND isnotnull(ss_addr_sk#11439L)) AND dynamicpruning#11881 [ss_sold_date_sk#11456L])
      :              :     :     :  +- Project [d_date_sk#11457L, d_year#11463, d_qoy#11467]
      :              :     :     :     +- Filter (((isnotnull(d_qoy#11467) AND isnotnull(d_year#11463)) AND ((d_qoy#11467 = 1) AND (d_year#11463 = 2000))) AND isnotnull(d_date_sk#11457L))
      :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11457L,d_date_id#11458,d_date#11459,d_month_seq#11460,d_week_seq#11461,d_quarter_seq#11462,d_year#11463,d_dow#11464,d_moy#11465,d_dom#11466,d_qoy#11467,d_fy_year#11468,d_fy_quarter_seq#11469,d_fy_week_seq#11470,d_day_name#11471,d_quarter_name#11472,d_holiday#11473,d_weekend#11474,d_following_holiday#11475,d_first_dom#11476,d_last_dom#11477,d_same_day_ly#11478,d_same_day_lq#11479,d_current_day#11480,... 4 more fields] orc
      :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#11434L,ss_item_sk#11435L,ss_customer_sk#11436L,ss_cdemo_sk#11437L,ss_hdemo_sk#11438L,ss_addr_sk#11439L,ss_store_sk#11440L,ss_promo_sk#11441L,ss_ticket_number#11442L,ss_quantity#11443,ss_wholesale_cost#11444,ss_list_price#11445,ss_sales_price#11446,ss_ext_discount_amt#11447,ss_ext_sales_price#11448,ss_ext_wholesale_cost#11449,ss_ext_list_price#11450,ss_ext_tax#11451,ss_coupon_amt#11452,ss_net_paid#11453,ss_net_paid_inc_tax#11454,ss_net_profit#11455,ss_sold_date_sk#11456L] orc
      :              :     +- Project [d_date_sk#11457L, d_year#11463, d_qoy#11467]
      :              :        +- Filter (((isnotnull(d_qoy#11467) AND isnotnull(d_year#11463)) AND ((d_qoy#11467 = 1) AND (d_year#11463 = 2000))) AND isnotnull(d_date_sk#11457L))
      :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11457L,d_date_id#11458,d_date#11459,d_month_seq#11460,d_week_seq#11461,d_quarter_seq#11462,d_year#11463,d_dow#11464,d_moy#11465,d_dom#11466,d_qoy#11467,d_fy_year#11468,d_fy_quarter_seq#11469,d_fy_week_seq#11470,d_day_name#11471,d_quarter_name#11472,d_holiday#11473,d_weekend#11474,d_following_holiday#11475,d_first_dom#11476,d_last_dom#11477,d_same_day_ly#11478,d_same_day_lq#11479,d_current_day#11480,... 4 more fields] orc
      :              +- Project [ca_address_sk#11485L, ca_county#11492]
      :                 +- Filter (isnotnull(ca_address_sk#11485L) AND isnotnull(ca_county#11492))
      :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11485L,ca_address_id#11486,ca_street_number#11487,ca_street_name#11488,ca_street_type#11489,ca_suite_number#11490,ca_city#11491,ca_county#11492,ca_state#11493,ca_zip#11494,ca_country#11495,ca_gmt_offset#11496,ca_location_type#11497] orc
      +- Project [ca_county#11567, web_sales#11433, web_sales#11586, web_sales#11590]
         +- Join Inner, (ca_county#11567 = ca_county#11872)
            :- Project [ca_county#11567, web_sales#11433, web_sales#11586]
            :  +- Join Inner, (ca_county#11567 = ca_county#11796)
            :     :- Aggregate [ca_county#11567, d_qoy#11542, d_year#11538], [ca_county#11567, sum(ws_ext_sales_price#11520) AS web_sales#11433]
            :     :  +- Project [ws_ext_sales_price#11520, d_year#11538, d_qoy#11542, ca_county#11567]
            :     :     +- Join Inner, (ws_bill_addr_sk#11504L = ca_address_sk#11560L)
            :     :        :- Project [ws_bill_addr_sk#11504L, ws_ext_sales_price#11520, d_year#11538, d_qoy#11542]
            :     :        :  +- Join Inner, (ws_sold_date_sk#11531L = d_date_sk#11532L)
            :     :        :     :- Project [ws_bill_addr_sk#11504L, ws_ext_sales_price#11520, ws_sold_date_sk#11531L]
            :     :        :     :  +- Filter ((isnotnull(ws_sold_date_sk#11531L) AND isnotnull(ws_bill_addr_sk#11504L)) AND dynamicpruning#11882 [ws_sold_date_sk#11531L])
            :     :        :     :     :  +- Project [d_date_sk#11532L, d_year#11538, d_qoy#11542]
            :     :        :     :     :     +- Filter (((isnotnull(d_qoy#11542) AND isnotnull(d_year#11538)) AND ((d_qoy#11542 = 1) AND (d_year#11538 = 2000))) AND isnotnull(d_date_sk#11532L))
            :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11532L,d_date_id#11533,d_date#11534,d_month_seq#11535,d_week_seq#11536,d_quarter_seq#11537,d_year#11538,d_dow#11539,d_moy#11540,d_dom#11541,d_qoy#11542,d_fy_year#11543,d_fy_quarter_seq#11544,d_fy_week_seq#11545,d_day_name#11546,d_quarter_name#11547,d_holiday#11548,d_weekend#11549,d_following_holiday#11550,d_first_dom#11551,d_last_dom#11552,d_same_day_ly#11553,d_same_day_lq#11554,d_current_day#11555,... 4 more fields] orc
            :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#11498L,ws_ship_date_sk#11499L,ws_item_sk#11500L,ws_bill_customer_sk#11501L,ws_bill_cdemo_sk#11502L,ws_bill_hdemo_sk#11503L,ws_bill_addr_sk#11504L,ws_ship_customer_sk#11505L,ws_ship_cdemo_sk#11506L,ws_ship_hdemo_sk#11507L,ws_ship_addr_sk#11508L,ws_web_page_sk#11509L,ws_web_site_sk#11510L,ws_ship_mode_sk#11511L,ws_warehouse_sk#11512L,ws_promo_sk#11513L,ws_order_number#11514L,ws_quantity#11515,ws_wholesale_cost#11516,ws_list_price#11517,ws_sales_price#11518,ws_ext_discount_amt#11519,ws_ext_sales_price#11520,ws_ext_wholesale_cost#11521,... 10 more fields] orc
            :     :        :     +- Project [d_date_sk#11532L, d_year#11538, d_qoy#11542]
            :     :        :        +- Filter (((isnotnull(d_qoy#11542) AND isnotnull(d_year#11538)) AND ((d_qoy#11542 = 1) AND (d_year#11538 = 2000))) AND isnotnull(d_date_sk#11532L))
            :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11532L,d_date_id#11533,d_date#11534,d_month_seq#11535,d_week_seq#11536,d_quarter_seq#11537,d_year#11538,d_dow#11539,d_moy#11540,d_dom#11541,d_qoy#11542,d_fy_year#11543,d_fy_quarter_seq#11544,d_fy_week_seq#11545,d_day_name#11546,d_quarter_name#11547,d_holiday#11548,d_weekend#11549,d_following_holiday#11550,d_first_dom#11551,d_last_dom#11552,d_same_day_ly#11553,d_same_day_lq#11554,d_current_day#11555,... 4 more fields] orc
            :     :        +- Project [ca_address_sk#11560L, ca_county#11567]
            :     :           +- Filter (isnotnull(ca_address_sk#11560L) AND isnotnull(ca_county#11567))
            :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11560L,ca_address_id#11561,ca_street_number#11562,ca_street_name#11563,ca_street_type#11564,ca_suite_number#11565,ca_city#11566,ca_county#11567,ca_state#11568,ca_zip#11569,ca_country#11570,ca_gmt_offset#11571,ca_location_type#11572] orc
            :     +- Aggregate [ca_county#11796, d_qoy#11771, d_year#11767], [ca_county#11796, sum(ws_ext_sales_price#11749) AS web_sales#11586]
            :        +- Project [ws_ext_sales_price#11749, d_year#11767, d_qoy#11771, ca_county#11796]
            :           +- Join Inner, (ws_bill_addr_sk#11733L = ca_address_sk#11789L)
            :              :- Project [ws_bill_addr_sk#11733L, ws_ext_sales_price#11749, d_year#11767, d_qoy#11771]
            :              :  +- Join Inner, (ws_sold_date_sk#11760L = d_date_sk#11761L)
            :              :     :- Project [ws_bill_addr_sk#11733L, ws_ext_sales_price#11749, ws_sold_date_sk#11760L]
            :              :     :  +- Filter ((isnotnull(ws_sold_date_sk#11760L) AND isnotnull(ws_bill_addr_sk#11733L)) AND dynamicpruning#11883 [ws_sold_date_sk#11760L])
            :              :     :     :  +- Project [d_date_sk#11761L, d_year#11767, d_qoy#11771]
            :              :     :     :     +- Filter (((isnotnull(d_qoy#11771) AND isnotnull(d_year#11767)) AND ((d_qoy#11771 = 2) AND (d_year#11767 = 2000))) AND isnotnull(d_date_sk#11761L))
            :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11761L,d_date_id#11762,d_date#11763,d_month_seq#11764,d_week_seq#11765,d_quarter_seq#11766,d_year#11767,d_dow#11768,d_moy#11769,d_dom#11770,d_qoy#11771,d_fy_year#11772,d_fy_quarter_seq#11773,d_fy_week_seq#11774,d_day_name#11775,d_quarter_name#11776,d_holiday#11777,d_weekend#11778,d_following_holiday#11779,d_first_dom#11780,d_last_dom#11781,d_same_day_ly#11782,d_same_day_lq#11783,d_current_day#11784,... 4 more fields] orc
            :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#11727L,ws_ship_date_sk#11728L,ws_item_sk#11729L,ws_bill_customer_sk#11730L,ws_bill_cdemo_sk#11731L,ws_bill_hdemo_sk#11732L,ws_bill_addr_sk#11733L,ws_ship_customer_sk#11734L,ws_ship_cdemo_sk#11735L,ws_ship_hdemo_sk#11736L,ws_ship_addr_sk#11737L,ws_web_page_sk#11738L,ws_web_site_sk#11739L,ws_ship_mode_sk#11740L,ws_warehouse_sk#11741L,ws_promo_sk#11742L,ws_order_number#11743L,ws_quantity#11744,ws_wholesale_cost#11745,ws_list_price#11746,ws_sales_price#11747,ws_ext_discount_amt#11748,ws_ext_sales_price#11749,ws_ext_wholesale_cost#11750,... 10 more fields] orc
            :              :     +- Project [d_date_sk#11761L, d_year#11767, d_qoy#11771]
            :              :        +- Filter (((isnotnull(d_qoy#11771) AND isnotnull(d_year#11767)) AND ((d_qoy#11771 = 2) AND (d_year#11767 = 2000))) AND isnotnull(d_date_sk#11761L))
            :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11761L,d_date_id#11762,d_date#11763,d_month_seq#11764,d_week_seq#11765,d_quarter_seq#11766,d_year#11767,d_dow#11768,d_moy#11769,d_dom#11770,d_qoy#11771,d_fy_year#11772,d_fy_quarter_seq#11773,d_fy_week_seq#11774,d_day_name#11775,d_quarter_name#11776,d_holiday#11777,d_weekend#11778,d_following_holiday#11779,d_first_dom#11780,d_last_dom#11781,d_same_day_ly#11782,d_same_day_lq#11783,d_current_day#11784,... 4 more fields] orc
            :              +- Project [ca_address_sk#11789L, ca_county#11796]
            :                 +- Filter (isnotnull(ca_address_sk#11789L) AND isnotnull(ca_county#11796))
            :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11789L,ca_address_id#11790,ca_street_number#11791,ca_street_name#11792,ca_street_type#11793,ca_suite_number#11794,ca_city#11795,ca_county#11796,ca_state#11797,ca_zip#11798,ca_country#11799,ca_gmt_offset#11800,ca_location_type#11801] orc
            +- Aggregate [ca_county#11872, d_qoy#11847, d_year#11843], [ca_county#11872, sum(ws_ext_sales_price#11825) AS web_sales#11590]
               +- Project [ws_ext_sales_price#11825, d_year#11843, d_qoy#11847, ca_county#11872]
                  +- Join Inner, (ws_bill_addr_sk#11809L = ca_address_sk#11865L)
                     :- Project [ws_bill_addr_sk#11809L, ws_ext_sales_price#11825, d_year#11843, d_qoy#11847]
                     :  +- Join Inner, (ws_sold_date_sk#11836L = d_date_sk#11837L)
                     :     :- Project [ws_bill_addr_sk#11809L, ws_ext_sales_price#11825, ws_sold_date_sk#11836L]
                     :     :  +- Filter ((isnotnull(ws_sold_date_sk#11836L) AND isnotnull(ws_bill_addr_sk#11809L)) AND dynamicpruning#11884 [ws_sold_date_sk#11836L])
                     :     :     :  +- Project [d_date_sk#11837L, d_year#11843, d_qoy#11847]
                     :     :     :     +- Filter (((isnotnull(d_qoy#11847) AND isnotnull(d_year#11843)) AND ((d_qoy#11847 = 3) AND (d_year#11843 = 2000))) AND isnotnull(d_date_sk#11837L))
                     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11837L,d_date_id#11838,d_date#11839,d_month_seq#11840,d_week_seq#11841,d_quarter_seq#11842,d_year#11843,d_dow#11844,d_moy#11845,d_dom#11846,d_qoy#11847,d_fy_year#11848,d_fy_quarter_seq#11849,d_fy_week_seq#11850,d_day_name#11851,d_quarter_name#11852,d_holiday#11853,d_weekend#11854,d_following_holiday#11855,d_first_dom#11856,d_last_dom#11857,d_same_day_ly#11858,d_same_day_lq#11859,d_current_day#11860,... 4 more fields] orc
                     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#11803L,ws_ship_date_sk#11804L,ws_item_sk#11805L,ws_bill_customer_sk#11806L,ws_bill_cdemo_sk#11807L,ws_bill_hdemo_sk#11808L,ws_bill_addr_sk#11809L,ws_ship_customer_sk#11810L,ws_ship_cdemo_sk#11811L,ws_ship_hdemo_sk#11812L,ws_ship_addr_sk#11813L,ws_web_page_sk#11814L,ws_web_site_sk#11815L,ws_ship_mode_sk#11816L,ws_warehouse_sk#11817L,ws_promo_sk#11818L,ws_order_number#11819L,ws_quantity#11820,ws_wholesale_cost#11821,ws_list_price#11822,ws_sales_price#11823,ws_ext_discount_amt#11824,ws_ext_sales_price#11825,ws_ext_wholesale_cost#11826,... 10 more fields] orc
                     :     +- Project [d_date_sk#11837L, d_year#11843, d_qoy#11847]
                     :        +- Filter (((isnotnull(d_qoy#11847) AND isnotnull(d_year#11843)) AND ((d_qoy#11847 = 3) AND (d_year#11843 = 2000))) AND isnotnull(d_date_sk#11837L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11837L,d_date_id#11838,d_date#11839,d_month_seq#11840,d_week_seq#11841,d_quarter_seq#11842,d_year#11843,d_dow#11844,d_moy#11845,d_dom#11846,d_qoy#11847,d_fy_year#11848,d_fy_quarter_seq#11849,d_fy_week_seq#11850,d_day_name#11851,d_quarter_name#11852,d_holiday#11853,d_weekend#11854,d_following_holiday#11855,d_first_dom#11856,d_last_dom#11857,d_same_day_ly#11858,d_same_day_lq#11859,d_current_day#11860,... 4 more fields] orc
                     +- Project [ca_address_sk#11865L, ca_county#11872]
                        +- Filter (isnotnull(ca_address_sk#11865L) AND isnotnull(ca_county#11872))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11865L,ca_address_id#11866,ca_street_number#11867,ca_street_name#11868,ca_street_type#11869,ca_suite_number#11870,ca_city#11871,ca_county#11872,ca_state#11873,ca_zip#11874,ca_country#11875,ca_gmt_offset#11876,ca_location_type#11877] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [d_year#11463 ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(d_year#11463 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#12447]
      +- Project [ca_county#11492, d_year#11463, (web_sales#11586 / web_sales#11433) AS web_q1_q2_increase#11428, (store_sales#11578 / store_sales#11432) AS store_q1_q2_increase#11429, (web_sales#11590 / web_sales#11586) AS web_q2_q3_increase#11430, (store_sales#11582 / store_sales#11578) AS store_q2_q3_increase#11431]
         +- BroadcastHashJoin [ca_county#11492], [ca_county#11567], Inner, BuildRight, ((CASE WHEN (web_sales#11433 > 0.0) THEN (web_sales#11586 / web_sales#11433) END > CASE WHEN (store_sales#11432 > 0.0) THEN (store_sales#11578 / store_sales#11432) END) AND (CASE WHEN (web_sales#11586 > 0.0) THEN (web_sales#11590 / web_sales#11586) END > CASE WHEN (store_sales#11578 > 0.0) THEN (store_sales#11582 / store_sales#11578) END)), false
            :- Project [store_sales#11578, store_sales#11582, ca_county#11492, d_year#11463, store_sales#11432]
            :  +- BroadcastHashJoin [ca_county#11655], [ca_county#11492], Inner, BuildRight, false
            :     :- Project [ca_county#11655, store_sales#11578, store_sales#11582]
            :     :  +- BroadcastHashJoin [ca_county#11655], [ca_county#11720], Inner, BuildRight, false
            :     :     :- HashAggregate(keys=[ca_county#11655, d_qoy#11630, d_year#11626], functions=[sum(ss_ext_sales_price#11611)], output=[ca_county#11655, store_sales#11578])
            :     :     :  +- Exchange hashpartitioning(ca_county#11655, d_qoy#11630, d_year#11626, 3000), ENSURE_REQUIREMENTS, [id=#12349]
            :     :     :     +- HashAggregate(keys=[ca_county#11655, d_qoy#11630, d_year#11626], functions=[partial_sum(ss_ext_sales_price#11611)], output=[ca_county#11655, d_qoy#11630, d_year#11626, sum#11886])
            :     :     :        +- Project [ss_ext_sales_price#11611, d_year#11626, d_qoy#11630, ca_county#11655]
            :     :     :           +- SortMergeJoin [ss_addr_sk#11602L], [ca_address_sk#11648L], Inner
            :     :     :              :- Sort [ss_addr_sk#11602L ASC NULLS FIRST], false, 0
            :     :     :              :  +- Exchange hashpartitioning(ss_addr_sk#11602L, 3000), ENSURE_REQUIREMENTS, [id=#12341]
            :     :     :              :     +- Project [ss_addr_sk#11602L, ss_ext_sales_price#11611, d_year#11626, d_qoy#11630]
            :     :     :              :        +- BroadcastHashJoin [ss_sold_date_sk#11619L], [d_date_sk#11620L], Inner, BuildRight, false
            :     :     :              :           :- Filter isnotnull(ss_addr_sk#11602L)
            :     :     :              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_addr_sk#11602L,ss_ext_sales_price#11611,ss_sold_date_sk#11619L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#11602L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#11619L), dynamicpruningexpression(ss_sold_date_sk#11619L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:bigint,ss_ext_sales_price:double>
            :     :     :              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11879, 0, true, Project [d_date_sk#11620L, d_year#11626, d_qoy#11630], [d_date_sk#11620L]
            :     :     :              :           :           +- AdaptiveSparkPlan isFinalPlan=false
            :     :     :              :           :              +- Filter ((((isnotnull(d_qoy#11630) AND isnotnull(d_year#11626)) AND (d_qoy#11630 = 2)) AND (d_year#11626 = 2000)) AND isnotnull(d_date_sk#11620L))
            :     :     :              :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11620L,d_year#11626,d_qoy#11630] Batched: true, DataFilters: [isnotnull(d_qoy#11630), isnotnull(d_year#11626), (d_qoy#11630 = 2), (d_year#11626 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :     :     :              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12336]
            :     :     :              :              +- Filter ((((isnotnull(d_qoy#11630) AND isnotnull(d_year#11626)) AND (d_qoy#11630 = 2)) AND (d_year#11626 = 2000)) AND isnotnull(d_date_sk#11620L))
            :     :     :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11620L,d_year#11626,d_qoy#11630] Batched: true, DataFilters: [isnotnull(d_qoy#11630), isnotnull(d_year#11626), (d_qoy#11630 = 2), (d_year#11626 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :     :     :              +- Sort [ca_address_sk#11648L ASC NULLS FIRST], false, 0
            :     :     :                 +- Exchange hashpartitioning(ca_address_sk#11648L, 3000), ENSURE_REQUIREMENTS, [id=#12342]
            :     :     :                    +- Filter (isnotnull(ca_address_sk#11648L) AND isnotnull(ca_county#11655))
            :     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11648L,ca_county#11655] Batched: true, DataFilters: [isnotnull(ca_address_sk#11648L), isnotnull(ca_county#11655)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
            :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#12367]
            :     :        +- HashAggregate(keys=[ca_county#11720, d_qoy#11695, d_year#11691], functions=[sum(ss_ext_sales_price#11676)], output=[ca_county#11720, store_sales#11582])
            :     :           +- Exchange hashpartitioning(ca_county#11720, d_qoy#11695, d_year#11691, 3000), ENSURE_REQUIREMENTS, [id=#12364]
            :     :              +- HashAggregate(keys=[ca_county#11720, d_qoy#11695, d_year#11691], functions=[partial_sum(ss_ext_sales_price#11676)], output=[ca_county#11720, d_qoy#11695, d_year#11691, sum#11888])
            :     :                 +- Project [ss_ext_sales_price#11676, d_year#11691, d_qoy#11695, ca_county#11720]
            :     :                    +- SortMergeJoin [ss_addr_sk#11667L], [ca_address_sk#11713L], Inner
            :     :                       :- Sort [ss_addr_sk#11667L ASC NULLS FIRST], false, 0
            :     :                       :  +- Exchange hashpartitioning(ss_addr_sk#11667L, 3000), ENSURE_REQUIREMENTS, [id=#12356]
            :     :                       :     +- Project [ss_addr_sk#11667L, ss_ext_sales_price#11676, d_year#11691, d_qoy#11695]
            :     :                       :        +- BroadcastHashJoin [ss_sold_date_sk#11684L], [d_date_sk#11685L], Inner, BuildRight, false
            :     :                       :           :- Filter isnotnull(ss_addr_sk#11667L)
            :     :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_addr_sk#11667L,ss_ext_sales_price#11676,ss_sold_date_sk#11684L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#11667L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#11684L), dynamicpruningexpression(ss_sold_date_sk#11684L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:bigint,ss_ext_sales_price:double>
            :     :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11880, 0, true, Project [d_date_sk#11685L, d_year#11691, d_qoy#11695], [d_date_sk#11685L]
            :     :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
            :     :                       :           :              +- Filter ((((isnotnull(d_qoy#11695) AND isnotnull(d_year#11691)) AND (d_qoy#11695 = 3)) AND (d_year#11691 = 2000)) AND isnotnull(d_date_sk#11685L))
            :     :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11685L,d_year#11691,d_qoy#11695] Batched: true, DataFilters: [isnotnull(d_qoy#11695), isnotnull(d_year#11691), (d_qoy#11695 = 3), (d_year#11691 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,3), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :     :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12351]
            :     :                       :              +- Filter ((((isnotnull(d_qoy#11695) AND isnotnull(d_year#11691)) AND (d_qoy#11695 = 3)) AND (d_year#11691 = 2000)) AND isnotnull(d_date_sk#11685L))
            :     :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11685L,d_year#11691,d_qoy#11695] Batched: true, DataFilters: [isnotnull(d_qoy#11695), isnotnull(d_year#11691), (d_qoy#11695 = 3), (d_year#11691 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,3), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :     :                       +- Sort [ca_address_sk#11713L ASC NULLS FIRST], false, 0
            :     :                          +- Exchange hashpartitioning(ca_address_sk#11713L, 3000), ENSURE_REQUIREMENTS, [id=#12357]
            :     :                             +- Filter (isnotnull(ca_address_sk#11713L) AND isnotnull(ca_county#11720))
            :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11713L,ca_county#11720] Batched: true, DataFilters: [isnotnull(ca_address_sk#11713L), isnotnull(ca_county#11720)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
            :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#12386]
            :        +- HashAggregate(keys=[ca_county#11492, d_qoy#11467, d_year#11463], functions=[sum(ss_ext_sales_price#11448)], output=[ca_county#11492, d_year#11463, store_sales#11432])
            :           +- Exchange hashpartitioning(ca_county#11492, d_qoy#11467, d_year#11463, 3000), ENSURE_REQUIREMENTS, [id=#12383]
            :              +- HashAggregate(keys=[ca_county#11492, d_qoy#11467, d_year#11463], functions=[partial_sum(ss_ext_sales_price#11448)], output=[ca_county#11492, d_qoy#11467, d_year#11463, sum#11890])
            :                 +- Project [ss_ext_sales_price#11448, d_year#11463, d_qoy#11467, ca_county#11492]
            :                    +- SortMergeJoin [ss_addr_sk#11439L], [ca_address_sk#11485L], Inner
            :                       :- Sort [ss_addr_sk#11439L ASC NULLS FIRST], false, 0
            :                       :  +- Exchange hashpartitioning(ss_addr_sk#11439L, 3000), ENSURE_REQUIREMENTS, [id=#12375]
            :                       :     +- Project [ss_addr_sk#11439L, ss_ext_sales_price#11448, d_year#11463, d_qoy#11467]
            :                       :        +- BroadcastHashJoin [ss_sold_date_sk#11456L], [d_date_sk#11457L], Inner, BuildRight, false
            :                       :           :- Filter isnotnull(ss_addr_sk#11439L)
            :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_addr_sk#11439L,ss_ext_sales_price#11448,ss_sold_date_sk#11456L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#11439L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#11456L), dynamicpruningexpression(ss_sold_date_sk#11456L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:bigint,ss_ext_sales_price:double>
            :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11881, 0, true, Project [d_date_sk#11457L, d_year#11463, d_qoy#11467], [d_date_sk#11457L]
            :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
            :                       :           :              +- Filter ((((isnotnull(d_qoy#11467) AND isnotnull(d_year#11463)) AND (d_qoy#11467 = 1)) AND (d_year#11463 = 2000)) AND isnotnull(d_date_sk#11457L))
            :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11457L,d_year#11463,d_qoy#11467] Batched: true, DataFilters: [isnotnull(d_qoy#11467), isnotnull(d_year#11463), (d_qoy#11467 = 1), (d_year#11463 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12370]
            :                       :              +- Filter ((((isnotnull(d_qoy#11467) AND isnotnull(d_year#11463)) AND (d_qoy#11467 = 1)) AND (d_year#11463 = 2000)) AND isnotnull(d_date_sk#11457L))
            :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11457L,d_year#11463,d_qoy#11467] Batched: true, DataFilters: [isnotnull(d_qoy#11467), isnotnull(d_year#11463), (d_qoy#11467 = 1), (d_year#11463 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
            :                       +- Sort [ca_address_sk#11485L ASC NULLS FIRST], false, 0
            :                          +- Exchange hashpartitioning(ca_address_sk#11485L, 3000), ENSURE_REQUIREMENTS, [id=#12376]
            :                             +- Filter (isnotnull(ca_address_sk#11485L) AND isnotnull(ca_county#11492))
            :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11485L,ca_county#11492] Batched: true, DataFilters: [isnotnull(ca_address_sk#11485L), isnotnull(ca_county#11492)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
            +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#12443]
               +- Project [ca_county#11567, web_sales#11433, web_sales#11586, web_sales#11590]
                  +- BroadcastHashJoin [ca_county#11567], [ca_county#11872], Inner, BuildRight, false
                     :- Project [ca_county#11567, web_sales#11433, web_sales#11586]
                     :  +- BroadcastHashJoin [ca_county#11567], [ca_county#11796], Inner, BuildRight, false
                     :     :- HashAggregate(keys=[ca_county#11567, d_qoy#11542, d_year#11538], functions=[sum(ws_ext_sales_price#11520)], output=[ca_county#11567, web_sales#11433])
                     :     :  +- Exchange hashpartitioning(ca_county#11567, d_qoy#11542, d_year#11538, 3000), ENSURE_REQUIREMENTS, [id=#12402]
                     :     :     +- HashAggregate(keys=[ca_county#11567, d_qoy#11542, d_year#11538], functions=[partial_sum(ws_ext_sales_price#11520)], output=[ca_county#11567, d_qoy#11542, d_year#11538, sum#11892])
                     :     :        +- Project [ws_ext_sales_price#11520, d_year#11538, d_qoy#11542, ca_county#11567]
                     :     :           +- SortMergeJoin [ws_bill_addr_sk#11504L], [ca_address_sk#11560L], Inner
                     :     :              :- Sort [ws_bill_addr_sk#11504L ASC NULLS FIRST], false, 0
                     :     :              :  +- Exchange hashpartitioning(ws_bill_addr_sk#11504L, 3000), ENSURE_REQUIREMENTS, [id=#12394]
                     :     :              :     +- Project [ws_bill_addr_sk#11504L, ws_ext_sales_price#11520, d_year#11538, d_qoy#11542]
                     :     :              :        +- BroadcastHashJoin [ws_sold_date_sk#11531L], [d_date_sk#11532L], Inner, BuildRight, false
                     :     :              :           :- Filter isnotnull(ws_bill_addr_sk#11504L)
                     :     :              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_addr_sk#11504L,ws_ext_sales_price#11520,ws_sold_date_sk#11531L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#11504L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#11531L), dynamicpruningexpression(ws_sold_date_sk#11531L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                     :     :              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11882, 0, true, Project [d_date_sk#11532L, d_year#11538, d_qoy#11542], [d_date_sk#11532L]
                     :     :              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :     :              :           :              +- Filter ((((isnotnull(d_qoy#11542) AND isnotnull(d_year#11538)) AND (d_qoy#11542 = 1)) AND (d_year#11538 = 2000)) AND isnotnull(d_date_sk#11532L))
                     :     :              :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11532L,d_year#11538,d_qoy#11542] Batched: true, DataFilters: [isnotnull(d_qoy#11542), isnotnull(d_year#11538), (d_qoy#11542 = 1), (d_year#11538 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :     :              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12389]
                     :     :              :              +- Filter ((((isnotnull(d_qoy#11542) AND isnotnull(d_year#11538)) AND (d_qoy#11542 = 1)) AND (d_year#11538 = 2000)) AND isnotnull(d_date_sk#11532L))
                     :     :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11532L,d_year#11538,d_qoy#11542] Batched: true, DataFilters: [isnotnull(d_qoy#11542), isnotnull(d_year#11538), (d_qoy#11542 = 1), (d_year#11538 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :     :              +- Sort [ca_address_sk#11560L ASC NULLS FIRST], false, 0
                     :     :                 +- Exchange hashpartitioning(ca_address_sk#11560L, 3000), ENSURE_REQUIREMENTS, [id=#12395]
                     :     :                    +- Filter (isnotnull(ca_address_sk#11560L) AND isnotnull(ca_county#11567))
                     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11560L,ca_county#11567] Batched: true, DataFilters: [isnotnull(ca_address_sk#11560L), isnotnull(ca_county#11567)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#12420]
                     :        +- HashAggregate(keys=[ca_county#11796, d_qoy#11771, d_year#11767], functions=[sum(ws_ext_sales_price#11749)], output=[ca_county#11796, web_sales#11586])
                     :           +- Exchange hashpartitioning(ca_county#11796, d_qoy#11771, d_year#11767, 3000), ENSURE_REQUIREMENTS, [id=#12417]
                     :              +- HashAggregate(keys=[ca_county#11796, d_qoy#11771, d_year#11767], functions=[partial_sum(ws_ext_sales_price#11749)], output=[ca_county#11796, d_qoy#11771, d_year#11767, sum#11894])
                     :                 +- Project [ws_ext_sales_price#11749, d_year#11767, d_qoy#11771, ca_county#11796]
                     :                    +- SortMergeJoin [ws_bill_addr_sk#11733L], [ca_address_sk#11789L], Inner
                     :                       :- Sort [ws_bill_addr_sk#11733L ASC NULLS FIRST], false, 0
                     :                       :  +- Exchange hashpartitioning(ws_bill_addr_sk#11733L, 3000), ENSURE_REQUIREMENTS, [id=#12409]
                     :                       :     +- Project [ws_bill_addr_sk#11733L, ws_ext_sales_price#11749, d_year#11767, d_qoy#11771]
                     :                       :        +- BroadcastHashJoin [ws_sold_date_sk#11760L], [d_date_sk#11761L], Inner, BuildRight, false
                     :                       :           :- Filter isnotnull(ws_bill_addr_sk#11733L)
                     :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_addr_sk#11733L,ws_ext_sales_price#11749,ws_sold_date_sk#11760L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#11733L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#11760L), dynamicpruningexpression(ws_sold_date_sk#11760L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                     :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11883, 0, true, Project [d_date_sk#11761L, d_year#11767, d_qoy#11771], [d_date_sk#11761L]
                     :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                       :           :              +- Filter ((((isnotnull(d_qoy#11771) AND isnotnull(d_year#11767)) AND (d_qoy#11771 = 2)) AND (d_year#11767 = 2000)) AND isnotnull(d_date_sk#11761L))
                     :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11761L,d_year#11767,d_qoy#11771] Batched: true, DataFilters: [isnotnull(d_qoy#11771), isnotnull(d_year#11767), (d_qoy#11771 = 2), (d_year#11767 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12404]
                     :                       :              +- Filter ((((isnotnull(d_qoy#11771) AND isnotnull(d_year#11767)) AND (d_qoy#11771 = 2)) AND (d_year#11767 = 2000)) AND isnotnull(d_date_sk#11761L))
                     :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11761L,d_year#11767,d_qoy#11771] Batched: true, DataFilters: [isnotnull(d_qoy#11771), isnotnull(d_year#11767), (d_qoy#11771 = 2), (d_year#11767 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :                       +- Sort [ca_address_sk#11789L ASC NULLS FIRST], false, 0
                     :                          +- Exchange hashpartitioning(ca_address_sk#11789L, 3000), ENSURE_REQUIREMENTS, [id=#12410]
                     :                             +- Filter (isnotnull(ca_address_sk#11789L) AND isnotnull(ca_county#11796))
                     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11789L,ca_county#11796] Batched: true, DataFilters: [isnotnull(ca_address_sk#11789L), isnotnull(ca_county#11796)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#12439]
                        +- HashAggregate(keys=[ca_county#11872, d_qoy#11847, d_year#11843], functions=[sum(ws_ext_sales_price#11825)], output=[ca_county#11872, web_sales#11590])
                           +- Exchange hashpartitioning(ca_county#11872, d_qoy#11847, d_year#11843, 3000), ENSURE_REQUIREMENTS, [id=#12436]
                              +- HashAggregate(keys=[ca_county#11872, d_qoy#11847, d_year#11843], functions=[partial_sum(ws_ext_sales_price#11825)], output=[ca_county#11872, d_qoy#11847, d_year#11843, sum#11896])
                                 +- Project [ws_ext_sales_price#11825, d_year#11843, d_qoy#11847, ca_county#11872]
                                    +- SortMergeJoin [ws_bill_addr_sk#11809L], [ca_address_sk#11865L], Inner
                                       :- Sort [ws_bill_addr_sk#11809L ASC NULLS FIRST], false, 0
                                       :  +- Exchange hashpartitioning(ws_bill_addr_sk#11809L, 3000), ENSURE_REQUIREMENTS, [id=#12428]
                                       :     +- Project [ws_bill_addr_sk#11809L, ws_ext_sales_price#11825, d_year#11843, d_qoy#11847]
                                       :        +- BroadcastHashJoin [ws_sold_date_sk#11836L], [d_date_sk#11837L], Inner, BuildRight, false
                                       :           :- Filter isnotnull(ws_bill_addr_sk#11809L)
                                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_addr_sk#11809L,ws_ext_sales_price#11825,ws_sold_date_sk#11836L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#11809L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#11836L), dynamicpruningexpression(ws_sold_date_sk#11836L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#11884, 0, true, Project [d_date_sk#11837L, d_year#11843, d_qoy#11847], [d_date_sk#11837L]
                                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :           :              +- Filter ((((isnotnull(d_qoy#11847) AND isnotnull(d_year#11843)) AND (d_qoy#11847 = 3)) AND (d_year#11843 = 2000)) AND isnotnull(d_date_sk#11837L))
                                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11837L,d_year#11843,d_qoy#11847] Batched: true, DataFilters: [isnotnull(d_qoy#11847), isnotnull(d_year#11843), (d_qoy#11847 = 3), (d_year#11843 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,3), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12423]
                                       :              +- Filter ((((isnotnull(d_qoy#11847) AND isnotnull(d_year#11843)) AND (d_qoy#11847 = 3)) AND (d_year#11843 = 2000)) AND isnotnull(d_date_sk#11837L))
                                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11837L,d_year#11843,d_qoy#11847] Batched: true, DataFilters: [isnotnull(d_qoy#11847), isnotnull(d_year#11843), (d_qoy#11847 = 3), (d_year#11843 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,3), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                                       +- Sort [ca_address_sk#11865L ASC NULLS FIRST], false, 0
                                          +- Exchange hashpartitioning(ca_address_sk#11865L, 3000), ENSURE_REQUIREMENTS, [id=#12429]
                                             +- Filter (isnotnull(ca_address_sk#11865L) AND isnotnull(ca_county#11872))
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#11865L,ca_county#11872] Batched: true, DataFilters: [isnotnull(ca_address_sk#11865L), isnotnull(ca_county#11872)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string>

read query: spark_queries/q32.sql
explain query: q32
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Project ['sum('cs_ext_discount_amt) AS excess discount amount#11897]
      +- 'Filter (((('i_manufact_id = 269) AND ('i_item_sk = 'cs_item_sk)) AND (('d_date >= 1998-03-18) AND ('d_date <= (cast(1998-03-18 as date) + INTERVAL '90' DAY)))) AND (('d_date_sk = 'cs_sold_date_sk) AND ('cs_ext_discount_amt > scalar-subquery#11898 [])))
         :  +- 'Project [unresolvedalias((1.3 * 'avg('cs_ext_discount_amt)), None)]
         :     +- 'Filter ((('cs_item_sk = 'i_item_sk) AND (('d_date >= 1998-03-18) AND ('d_date <= (cast(1998-03-18 as date) + INTERVAL '90' DAY)))) AND ('d_date_sk = 'cs_sold_date_sk))
         :        +- 'Join Inner
         :           :- 'UnresolvedRelation [catalog_sales], [], false
         :           +- 'UnresolvedRelation [date_dim], [], false
         +- 'Join Inner
            :- 'Join Inner
            :  :- 'UnresolvedRelation [catalog_sales], [], false
            :  +- 'UnresolvedRelation [item], [], false
            +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
excess discount amount: double
GlobalLimit 100
+- LocalLimit 100
   +- Aggregate [sum(cs_ext_discount_amt#11920) AS excess discount amount#11897]
      +- Filter ((((i_manufact_id#11946 = 269) AND (i_item_sk#11933L = cs_item_sk#11913L)) AND ((d_date#11957 >= cast(1998-03-18 as date)) AND (d_date#11957 <= date_add(cast(1998-03-18 as date), extractansiintervaldays(INTERVAL '90' DAY))))) AND ((d_date_sk#11955L = cs_sold_date_sk#11932L) AND (cs_ext_discount_amt#11920 > scalar-subquery#11898 [i_item_sk#11933L])))
         :  +- Aggregate [(cast(1.3 as double) * avg(cs_ext_discount_amt#12004)) AS (1.3 * avg(cs_ext_discount_amt))#12046]
         :     +- Filter (((cs_item_sk#11997L = outer(i_item_sk#11933L)) AND ((d_date#12019 >= cast(1998-03-18 as date)) AND (d_date#12019 <= date_add(cast(1998-03-18 as date), extractansiintervaldays(INTERVAL '90' DAY))))) AND (d_date_sk#12017L = cs_sold_date_sk#12016L))
         :        +- Join Inner
         :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
         :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11983L,cs_ship_date_sk#11984L,cs_bill_customer_sk#11985L,cs_bill_cdemo_sk#11986L,cs_bill_hdemo_sk#11987L,cs_bill_addr_sk#11988L,cs_ship_customer_sk#11989L,cs_ship_cdemo_sk#11990L,cs_ship_hdemo_sk#11991L,cs_ship_addr_sk#11992L,cs_call_center_sk#11993L,cs_catalog_page_sk#11994L,cs_ship_mode_sk#11995L,cs_warehouse_sk#11996L,cs_item_sk#11997L,cs_promo_sk#11998L,cs_order_number#11999L,cs_quantity#12000,cs_wholesale_cost#12001,cs_list_price#12002,cs_sales_price#12003,cs_ext_discount_amt#12004,cs_ext_sales_price#12005,cs_ext_wholesale_cost#12006,... 10 more fields] orc
         :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12017L,d_date_id#12018,d_date#12019,d_month_seq#12020,d_week_seq#12021,d_quarter_seq#12022,d_year#12023,d_dow#12024,d_moy#12025,d_dom#12026,d_qoy#12027,d_fy_year#12028,d_fy_quarter_seq#12029,d_fy_week_seq#12030,d_day_name#12031,d_quarter_name#12032,d_holiday#12033,d_weekend#12034,d_following_holiday#12035,d_first_dom#12036,d_last_dom#12037,d_same_day_ly#12038,d_same_day_lq#12039,d_current_day#12040,... 4 more fields] orc
         +- Join Inner
            :- Join Inner
            :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11899L,cs_ship_date_sk#11900L,cs_bill_customer_sk#11901L,cs_bill_cdemo_sk#11902L,cs_bill_hdemo_sk#11903L,cs_bill_addr_sk#11904L,cs_ship_customer_sk#11905L,cs_ship_cdemo_sk#11906L,cs_ship_hdemo_sk#11907L,cs_ship_addr_sk#11908L,cs_call_center_sk#11909L,cs_catalog_page_sk#11910L,cs_ship_mode_sk#11911L,cs_warehouse_sk#11912L,cs_item_sk#11913L,cs_promo_sk#11914L,cs_order_number#11915L,cs_quantity#11916,cs_wholesale_cost#11917,cs_list_price#11918,cs_sales_price#11919,cs_ext_discount_amt#11920,cs_ext_sales_price#11921,cs_ext_wholesale_cost#11922,... 10 more fields] orc
            :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
            :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11933L,i_item_id#11934,i_rec_start_date#11935,i_rec_end_date#11936,i_item_desc#11937,i_current_price#11938,i_wholesale_cost#11939,i_brand_id#11940,i_brand#11941,i_class_id#11942,i_class#11943,i_category_id#11944,i_category#11945,i_manufact_id#11946,i_manufact#11947,i_size#11948,i_formulation#11949,i_color#11950,i_units#11951,i_container#11952,i_manager_id#11953,i_product_name#11954] orc
            +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11955L,d_date_id#11956,d_date#11957,d_month_seq#11958,d_week_seq#11959,d_quarter_seq#11960,d_year#11961,d_dow#11962,d_moy#11963,d_dom#11964,d_qoy#11965,d_fy_year#11966,d_fy_quarter_seq#11967,d_fy_week_seq#11968,d_day_name#11969,d_quarter_name#11970,d_holiday#11971,d_weekend#11972,d_following_holiday#11973,d_first_dom#11974,d_last_dom#11975,d_same_day_ly#11976,d_same_day_lq#11977,d_current_day#11978,... 4 more fields] orc

== Optimized Logical Plan ==
Aggregate [sum(cs_ext_discount_amt#11920) AS excess discount amount#11897]
+- Project [cs_ext_discount_amt#11920]
   +- Join Inner, (d_date_sk#11955L = cs_sold_date_sk#11932L)
      :- Project [cs_ext_discount_amt#11920, cs_sold_date_sk#11932L]
      :  +- Join Inner, ((i_item_sk#11933L = cs_item_sk#11913L) AND (cs_ext_discount_amt#11920 > (1.3 * avg(cs_ext_discount_amt))#12046))
      :     :- Project [i_item_sk#11933L, (1.3 * avg(cs_ext_discount_amt))#12046]
      :     :  +- Join Inner, (cs_item_sk#11997L = i_item_sk#11933L)
      :     :     :- Project [i_item_sk#11933L]
      :     :     :  +- Filter ((isnotnull(i_manufact_id#11946) AND (i_manufact_id#11946 = 269)) AND isnotnull(i_item_sk#11933L))
      :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11933L,i_item_id#11934,i_rec_start_date#11935,i_rec_end_date#11936,i_item_desc#11937,i_current_price#11938,i_wholesale_cost#11939,i_brand_id#11940,i_brand#11941,i_class_id#11942,i_class#11943,i_category_id#11944,i_category#11945,i_manufact_id#11946,i_manufact#11947,i_size#11948,i_formulation#11949,i_color#11950,i_units#11951,i_container#11952,i_manager_id#11953,i_product_name#11954] orc
      :     :     +- Filter isnotnull((1.3 * avg(cs_ext_discount_amt))#12046)
      :     :        +- Aggregate [cs_item_sk#11997L], [(1.3 * avg(cs_ext_discount_amt#12004)) AS (1.3 * avg(cs_ext_discount_amt))#12046, cs_item_sk#11997L]
      :     :           +- Project [cs_item_sk#11997L, cs_ext_discount_amt#12004]
      :     :              +- Join Inner, (d_date_sk#12017L = cs_sold_date_sk#12016L)
      :     :                 :- Project [cs_item_sk#11997L, cs_ext_discount_amt#12004, cs_sold_date_sk#12016L]
      :     :                 :  +- Filter ((isnotnull(cs_sold_date_sk#12016L) AND isnotnull(cs_item_sk#11997L)) AND dynamicpruning#12049 [cs_sold_date_sk#12016L])
      :     :                 :     :  +- Project [d_date_sk#12017L]
      :     :                 :     :     +- Filter ((isnotnull(d_date#12019) AND ((d_date#12019 >= 1998-03-18) AND (d_date#12019 <= 1998-06-16))) AND isnotnull(d_date_sk#12017L))
      :     :                 :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12017L,d_date_id#12018,d_date#12019,d_month_seq#12020,d_week_seq#12021,d_quarter_seq#12022,d_year#12023,d_dow#12024,d_moy#12025,d_dom#12026,d_qoy#12027,d_fy_year#12028,d_fy_quarter_seq#12029,d_fy_week_seq#12030,d_day_name#12031,d_quarter_name#12032,d_holiday#12033,d_weekend#12034,d_following_holiday#12035,d_first_dom#12036,d_last_dom#12037,d_same_day_ly#12038,d_same_day_lq#12039,d_current_day#12040,... 4 more fields] orc
      :     :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11983L,cs_ship_date_sk#11984L,cs_bill_customer_sk#11985L,cs_bill_cdemo_sk#11986L,cs_bill_hdemo_sk#11987L,cs_bill_addr_sk#11988L,cs_ship_customer_sk#11989L,cs_ship_cdemo_sk#11990L,cs_ship_hdemo_sk#11991L,cs_ship_addr_sk#11992L,cs_call_center_sk#11993L,cs_catalog_page_sk#11994L,cs_ship_mode_sk#11995L,cs_warehouse_sk#11996L,cs_item_sk#11997L,cs_promo_sk#11998L,cs_order_number#11999L,cs_quantity#12000,cs_wholesale_cost#12001,cs_list_price#12002,cs_sales_price#12003,cs_ext_discount_amt#12004,cs_ext_sales_price#12005,cs_ext_wholesale_cost#12006,... 10 more fields] orc
      :     :                 +- Project [d_date_sk#12017L]
      :     :                    +- Filter ((isnotnull(d_date#12019) AND ((d_date#12019 >= 1998-03-18) AND (d_date#12019 <= 1998-06-16))) AND isnotnull(d_date_sk#12017L))
      :     :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12017L,d_date_id#12018,d_date#12019,d_month_seq#12020,d_week_seq#12021,d_quarter_seq#12022,d_year#12023,d_dow#12024,d_moy#12025,d_dom#12026,d_qoy#12027,d_fy_year#12028,d_fy_quarter_seq#12029,d_fy_week_seq#12030,d_day_name#12031,d_quarter_name#12032,d_holiday#12033,d_weekend#12034,d_following_holiday#12035,d_first_dom#12036,d_last_dom#12037,d_same_day_ly#12038,d_same_day_lq#12039,d_current_day#12040,... 4 more fields] orc
      :     +- Project [cs_item_sk#11913L, cs_ext_discount_amt#11920, cs_sold_date_sk#11932L]
      :        +- Filter (((isnotnull(cs_item_sk#11913L) AND isnotnull(cs_ext_discount_amt#11920)) AND isnotnull(cs_sold_date_sk#11932L)) AND dynamicpruning#12050 [cs_sold_date_sk#11932L])
      :           :  +- Project [d_date_sk#11955L]
      :           :     +- Filter ((isnotnull(d_date#11957) AND ((d_date#11957 >= 1998-03-18) AND (d_date#11957 <= 1998-06-16))) AND isnotnull(d_date_sk#11955L))
      :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11955L,d_date_id#11956,d_date#11957,d_month_seq#11958,d_week_seq#11959,d_quarter_seq#11960,d_year#11961,d_dow#11962,d_moy#11963,d_dom#11964,d_qoy#11965,d_fy_year#11966,d_fy_quarter_seq#11967,d_fy_week_seq#11968,d_day_name#11969,d_quarter_name#11970,d_holiday#11971,d_weekend#11972,d_following_holiday#11973,d_first_dom#11974,d_last_dom#11975,d_same_day_ly#11976,d_same_day_lq#11977,d_current_day#11978,... 4 more fields] orc
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#11899L,cs_ship_date_sk#11900L,cs_bill_customer_sk#11901L,cs_bill_cdemo_sk#11902L,cs_bill_hdemo_sk#11903L,cs_bill_addr_sk#11904L,cs_ship_customer_sk#11905L,cs_ship_cdemo_sk#11906L,cs_ship_hdemo_sk#11907L,cs_ship_addr_sk#11908L,cs_call_center_sk#11909L,cs_catalog_page_sk#11910L,cs_ship_mode_sk#11911L,cs_warehouse_sk#11912L,cs_item_sk#11913L,cs_promo_sk#11914L,cs_order_number#11915L,cs_quantity#11916,cs_wholesale_cost#11917,cs_list_price#11918,cs_sales_price#11919,cs_ext_discount_amt#11920,cs_ext_sales_price#11921,cs_ext_wholesale_cost#11922,... 10 more fields] orc
      +- Project [d_date_sk#11955L]
         +- Filter ((isnotnull(d_date#11957) AND ((d_date#11957 >= 1998-03-18) AND (d_date#11957 <= 1998-06-16))) AND isnotnull(d_date_sk#11955L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11955L,d_date_id#11956,d_date#11957,d_month_seq#11958,d_week_seq#11959,d_quarter_seq#11960,d_year#11961,d_dow#11962,d_moy#11963,d_dom#11964,d_qoy#11965,d_fy_year#11966,d_fy_quarter_seq#11967,d_fy_week_seq#11968,d_day_name#11969,d_quarter_name#11970,d_holiday#11971,d_weekend#11972,d_following_holiday#11973,d_first_dom#11974,d_last_dom#11975,d_same_day_ly#11976,d_same_day_lq#11977,d_current_day#11978,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(cs_ext_discount_amt#11920)], output=[excess discount amount#11897])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#12605]
      +- HashAggregate(keys=[], functions=[partial_sum(cs_ext_discount_amt#11920)], output=[sum#12052])
         +- Project [cs_ext_discount_amt#11920]
            +- BroadcastHashJoin [cs_sold_date_sk#11932L], [d_date_sk#11955L], Inner, BuildRight, false
               :- Project [cs_ext_discount_amt#11920, cs_sold_date_sk#11932L]
               :  +- BroadcastHashJoin [i_item_sk#11933L], [cs_item_sk#11913L], Inner, BuildLeft, (cs_ext_discount_amt#11920 > (1.3 * avg(cs_ext_discount_amt))#12046), false
               :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12596]
               :     :  +- Project [i_item_sk#11933L, (1.3 * avg(cs_ext_discount_amt))#12046]
               :     :     +- BroadcastHashJoin [i_item_sk#11933L], [cs_item_sk#11997L], Inner, BuildLeft, false
               :     :        :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12592]
               :     :        :  +- Project [i_item_sk#11933L]
               :     :        :     +- Filter ((isnotnull(i_manufact_id#11946) AND (i_manufact_id#11946 = 269)) AND isnotnull(i_item_sk#11933L))
               :     :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#11933L,i_manufact_id#11946] Batched: true, DataFilters: [isnotnull(i_manufact_id#11946), (i_manufact_id#11946 = 269), isnotnull(i_item_sk#11933L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,269), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_manufact_id:int>
               :     :        +- Filter isnotnull((1.3 * avg(cs_ext_discount_amt))#12046)
               :     :           +- HashAggregate(keys=[cs_item_sk#11997L], functions=[avg(cs_ext_discount_amt#12004)], output=[(1.3 * avg(cs_ext_discount_amt))#12046, cs_item_sk#11997L])
               :     :              +- Exchange hashpartitioning(cs_item_sk#11997L, 3000), ENSURE_REQUIREMENTS, [id=#12588]
               :     :                 +- HashAggregate(keys=[cs_item_sk#11997L], functions=[partial_avg(cs_ext_discount_amt#12004)], output=[cs_item_sk#11997L, sum#12055, count#12056L])
               :     :                    +- Project [cs_item_sk#11997L, cs_ext_discount_amt#12004]
               :     :                       +- BroadcastHashJoin [cs_sold_date_sk#12016L], [d_date_sk#12017L], Inner, BuildRight, false
               :     :                          :- Filter isnotnull(cs_item_sk#11997L)
               :     :                          :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#11997L,cs_ext_discount_amt#12004,cs_sold_date_sk#12016L] Batched: true, DataFilters: [isnotnull(cs_item_sk#11997L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#12016L), dynamicpruningexpression(cs_sold_date_sk#12016L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_ext_discount_amt:double>
               :     :                          :        +- SubqueryAdaptiveBroadcast dynamicpruning#12049, 0, true, Project [d_date_sk#12017L], [d_date_sk#12017L]
               :     :                          :           +- AdaptiveSparkPlan isFinalPlan=false
               :     :                          :              +- Project [d_date_sk#12017L]
               :     :                          :                 +- Filter (((isnotnull(d_date#12019) AND (d_date#12019 >= 1998-03-18)) AND (d_date#12019 <= 1998-06-16)) AND isnotnull(d_date_sk#12017L))
               :     :                          :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12017L,d_date#12019] Batched: true, DataFilters: [isnotnull(d_date#12019), (d_date#12019 >= 1998-03-18), (d_date#12019 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               :     :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12583]
               :     :                             +- Project [d_date_sk#12017L]
               :     :                                +- Filter (((isnotnull(d_date#12019) AND (d_date#12019 >= 1998-03-18)) AND (d_date#12019 <= 1998-06-16)) AND isnotnull(d_date_sk#12017L))
               :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12017L,d_date#12019] Batched: true, DataFilters: [isnotnull(d_date#12019), (d_date#12019 >= 1998-03-18), (d_date#12019 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               :     +- Filter (isnotnull(cs_item_sk#11913L) AND isnotnull(cs_ext_discount_amt#11920))
               :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#11913L,cs_ext_discount_amt#11920,cs_sold_date_sk#11932L] Batched: true, DataFilters: [isnotnull(cs_item_sk#11913L), isnotnull(cs_ext_discount_amt#11920)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#11932L), dynamicpruningexpression(cs_sold_date_sk#11932L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_ext_discount_amt)], ReadSchema: struct<cs_item_sk:bigint,cs_ext_discount_amt:double>
               :              +- SubqueryAdaptiveBroadcast dynamicpruning#12050, 0, true, Project [d_date_sk#11955L], [d_date_sk#11955L]
               :                 +- AdaptiveSparkPlan isFinalPlan=false
               :                    +- Project [d_date_sk#11955L]
               :                       +- Filter (((isnotnull(d_date#11957) AND (d_date#11957 >= 1998-03-18)) AND (d_date#11957 <= 1998-06-16)) AND isnotnull(d_date_sk#11955L))
               :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11955L,d_date#11957] Batched: true, DataFilters: [isnotnull(d_date#11957), (d_date#11957 >= 1998-03-18), (d_date#11957 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12600]
                  +- Project [d_date_sk#11955L]
                     +- Filter (((isnotnull(d_date#11957) AND (d_date#11957 >= 1998-03-18)) AND (d_date#11957 <= 1998-06-16)) AND isnotnull(d_date_sk#11955L))
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#11955L,d_date#11957] Batched: true, DataFilters: [isnotnull(d_date#11957), (d_date#11957 >= 1998-03-18), (d_date#11957 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>

read query: spark_queries/q33.sql
explain query: q33
== Parsed Logical Plan ==
CTE [ss, cs, ws]
:  :- 'SubqueryAlias ss
:  :  +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('ss_ext_sales_price) AS total_sales#12058]
:  :     +- 'Filter ((('i_manufact_id IN (list#12059 []) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 3) AND ('ss_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:  :        :  +- 'Project ['i_manufact_id]
:  :        :     +- 'Filter 'i_category IN (Books)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  :- 'SubqueryAlias cs
:  :  +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('cs_ext_sales_price) AS total_sales#12060]
:  :     +- 'Filter ((('i_manufact_id IN (list#12061 []) AND ('cs_item_sk = 'i_item_sk)) AND (('cs_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 3) AND ('cs_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:  :        :  +- 'Project ['i_manufact_id]
:  :        :     +- 'Filter 'i_category IN (Books)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  +- 'SubqueryAlias ws
:     +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('ws_ext_sales_price) AS total_sales#12062]
:        +- 'Filter ((('i_manufact_id IN (list#12063 []) AND ('ws_item_sk = 'i_item_sk)) AND (('ws_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 3) AND ('ws_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:           :  +- 'Project ['i_manufact_id]
:           :     +- 'Filter 'i_category IN (Books)
:           :        +- 'UnresolvedRelation [item], [], false
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'UnresolvedRelation [web_sales], [], false
:              :  :  +- 'UnresolvedRelation [date_dim], [], false
:              :  +- 'UnresolvedRelation [customer_address], [], false
:              +- 'UnresolvedRelation [item], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['total_sales ASC NULLS FIRST], true
         +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('total_sales) AS total_sales#12057]
            +- 'SubqueryAlias tmp1
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [*]
                  :  :  +- 'UnresolvedRelation [ss], [], false
                  :  +- 'Project [*]
                  :     +- 'UnresolvedRelation [cs], [], false
                  +- 'Project [*]
                     +- 'UnresolvedRelation [ws], [], false

== Analyzed Logical Plan ==
i_manufact_id: int, total_sales: double
WithCTE
:- CTERelationDef 22
:  +- SubqueryAlias ss
:     +- Aggregate [i_manufact_id#12141], [i_manufact_id#12141, sum(ss_ext_sales_price#12078) AS total_sales#12058]
:        +- Filter (((i_manufact_id#12141 IN (list#12059 []) AND (ss_item_sk#12065L = i_item_sk#12128L)) AND ((ss_sold_date_sk#12086L = d_date_sk#12087L) AND (d_year#12093 = 1999))) AND (((d_moy#12095 = 3) AND (ss_addr_sk#12069L = ca_address_sk#12115L)) AND (ca_gmt_offset#12126 = cast(-6 as double))))
:           :  +- Project [i_manufact_id#12357]
:           :     +- Filter i_category#12356 IN (Books)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12344L,i_item_id#12345,i_rec_start_date#12346,i_rec_end_date#12347,i_item_desc#12348,i_current_price#12349,i_wholesale_cost#12350,i_brand_id#12351,i_brand#12352,i_class_id#12353,i_class#12354,i_category_id#12355,i_category#12356,i_manufact_id#12357,i_manufact#12358,i_size#12359,i_formulation#12360,i_color#12361,i_units#12362,i_container#12363,i_manager_id#12364,i_product_name#12365] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12064L,ss_item_sk#12065L,ss_customer_sk#12066L,ss_cdemo_sk#12067L,ss_hdemo_sk#12068L,ss_addr_sk#12069L,ss_store_sk#12070L,ss_promo_sk#12071L,ss_ticket_number#12072L,ss_quantity#12073,ss_wholesale_cost#12074,ss_list_price#12075,ss_sales_price#12076,ss_ext_discount_amt#12077,ss_ext_sales_price#12078,ss_ext_wholesale_cost#12079,ss_ext_list_price#12080,ss_ext_tax#12081,ss_coupon_amt#12082,ss_net_paid#12083,ss_net_paid_inc_tax#12084,ss_net_profit#12085,ss_sold_date_sk#12086L] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12087L,d_date_id#12088,d_date#12089,d_month_seq#12090,d_week_seq#12091,d_quarter_seq#12092,d_year#12093,d_dow#12094,d_moy#12095,d_dom#12096,d_qoy#12097,d_fy_year#12098,d_fy_quarter_seq#12099,d_fy_week_seq#12100,d_day_name#12101,d_quarter_name#12102,d_holiday#12103,d_weekend#12104,d_following_holiday#12105,d_first_dom#12106,d_last_dom#12107,d_same_day_ly#12108,d_same_day_lq#12109,d_current_day#12110,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12115L,ca_address_id#12116,ca_street_number#12117,ca_street_name#12118,ca_street_type#12119,ca_suite_number#12120,ca_city#12121,ca_county#12122,ca_state#12123,ca_zip#12124,ca_country#12125,ca_gmt_offset#12126,ca_location_type#12127] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12128L,i_item_id#12129,i_rec_start_date#12130,i_rec_end_date#12131,i_item_desc#12132,i_current_price#12133,i_wholesale_cost#12134,i_brand_id#12135,i_brand#12136,i_class_id#12137,i_class#12138,i_category_id#12139,i_category#12140,i_manufact_id#12141,i_manufact#12142,i_size#12143,i_formulation#12144,i_color#12145,i_units#12146,i_container#12147,i_manager_id#12148,i_product_name#12149] orc
:- CTERelationDef 23
:  +- SubqueryAlias cs
:     +- Aggregate [i_manufact_id#12238], [i_manufact_id#12238, sum(cs_ext_sales_price#12172) AS total_sales#12060]
:        +- Filter (((i_manufact_id#12238 IN (list#12061 []) AND (cs_item_sk#12164L = i_item_sk#12225L)) AND ((cs_sold_date_sk#12183L = d_date_sk#12184L) AND (d_year#12190 = 1999))) AND (((d_moy#12192 = 3) AND (cs_bill_addr_sk#12155L = ca_address_sk#12212L)) AND (ca_gmt_offset#12223 = cast(-6 as double))))
:           :  +- Project [i_manufact_id#12379]
:           :     +- Filter i_category#12378 IN (Books)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12366L,i_item_id#12367,i_rec_start_date#12368,i_rec_end_date#12369,i_item_desc#12370,i_current_price#12371,i_wholesale_cost#12372,i_brand_id#12373,i_brand#12374,i_class_id#12375,i_class#12376,i_category_id#12377,i_category#12378,i_manufact_id#12379,i_manufact#12380,i_size#12381,i_formulation#12382,i_color#12383,i_units#12384,i_container#12385,i_manager_id#12386,i_product_name#12387] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#12150L,cs_ship_date_sk#12151L,cs_bill_customer_sk#12152L,cs_bill_cdemo_sk#12153L,cs_bill_hdemo_sk#12154L,cs_bill_addr_sk#12155L,cs_ship_customer_sk#12156L,cs_ship_cdemo_sk#12157L,cs_ship_hdemo_sk#12158L,cs_ship_addr_sk#12159L,cs_call_center_sk#12160L,cs_catalog_page_sk#12161L,cs_ship_mode_sk#12162L,cs_warehouse_sk#12163L,cs_item_sk#12164L,cs_promo_sk#12165L,cs_order_number#12166L,cs_quantity#12167,cs_wholesale_cost#12168,cs_list_price#12169,cs_sales_price#12170,cs_ext_discount_amt#12171,cs_ext_sales_price#12172,cs_ext_wholesale_cost#12173,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12184L,d_date_id#12185,d_date#12186,d_month_seq#12187,d_week_seq#12188,d_quarter_seq#12189,d_year#12190,d_dow#12191,d_moy#12192,d_dom#12193,d_qoy#12194,d_fy_year#12195,d_fy_quarter_seq#12196,d_fy_week_seq#12197,d_day_name#12198,d_quarter_name#12199,d_holiday#12200,d_weekend#12201,d_following_holiday#12202,d_first_dom#12203,d_last_dom#12204,d_same_day_ly#12205,d_same_day_lq#12206,d_current_day#12207,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12212L,ca_address_id#12213,ca_street_number#12214,ca_street_name#12215,ca_street_type#12216,ca_suite_number#12217,ca_city#12218,ca_county#12219,ca_state#12220,ca_zip#12221,ca_country#12222,ca_gmt_offset#12223,ca_location_type#12224] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12225L,i_item_id#12226,i_rec_start_date#12227,i_rec_end_date#12228,i_item_desc#12229,i_current_price#12230,i_wholesale_cost#12231,i_brand_id#12232,i_brand#12233,i_class_id#12234,i_class#12235,i_category_id#12236,i_category#12237,i_manufact_id#12238,i_manufact#12239,i_size#12240,i_formulation#12241,i_color#12242,i_units#12243,i_container#12244,i_manager_id#12245,i_product_name#12246] orc
:- CTERelationDef 24
:  +- SubqueryAlias ws
:     +- Aggregate [i_manufact_id#12335], [i_manufact_id#12335, sum(ws_ext_sales_price#12269) AS total_sales#12062]
:        +- Filter (((i_manufact_id#12335 IN (list#12063 []) AND (ws_item_sk#12249L = i_item_sk#12322L)) AND ((ws_sold_date_sk#12280L = d_date_sk#12281L) AND (d_year#12287 = 1999))) AND (((d_moy#12289 = 3) AND (ws_bill_addr_sk#12253L = ca_address_sk#12309L)) AND (ca_gmt_offset#12320 = cast(-6 as double))))
:           :  +- Project [i_manufact_id#12401]
:           :     +- Filter i_category#12400 IN (Books)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12388L,i_item_id#12389,i_rec_start_date#12390,i_rec_end_date#12391,i_item_desc#12392,i_current_price#12393,i_wholesale_cost#12394,i_brand_id#12395,i_brand#12396,i_class_id#12397,i_class#12398,i_category_id#12399,i_category#12400,i_manufact_id#12401,i_manufact#12402,i_size#12403,i_formulation#12404,i_color#12405,i_units#12406,i_container#12407,i_manager_id#12408,i_product_name#12409] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#12247L,ws_ship_date_sk#12248L,ws_item_sk#12249L,ws_bill_customer_sk#12250L,ws_bill_cdemo_sk#12251L,ws_bill_hdemo_sk#12252L,ws_bill_addr_sk#12253L,ws_ship_customer_sk#12254L,ws_ship_cdemo_sk#12255L,ws_ship_hdemo_sk#12256L,ws_ship_addr_sk#12257L,ws_web_page_sk#12258L,ws_web_site_sk#12259L,ws_ship_mode_sk#12260L,ws_warehouse_sk#12261L,ws_promo_sk#12262L,ws_order_number#12263L,ws_quantity#12264,ws_wholesale_cost#12265,ws_list_price#12266,ws_sales_price#12267,ws_ext_discount_amt#12268,ws_ext_sales_price#12269,ws_ext_wholesale_cost#12270,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12281L,d_date_id#12282,d_date#12283,d_month_seq#12284,d_week_seq#12285,d_quarter_seq#12286,d_year#12287,d_dow#12288,d_moy#12289,d_dom#12290,d_qoy#12291,d_fy_year#12292,d_fy_quarter_seq#12293,d_fy_week_seq#12294,d_day_name#12295,d_quarter_name#12296,d_holiday#12297,d_weekend#12298,d_following_holiday#12299,d_first_dom#12300,d_last_dom#12301,d_same_day_ly#12302,d_same_day_lq#12303,d_current_day#12304,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12309L,ca_address_id#12310,ca_street_number#12311,ca_street_name#12312,ca_street_type#12313,ca_suite_number#12314,ca_city#12315,ca_county#12316,ca_state#12317,ca_zip#12318,ca_country#12319,ca_gmt_offset#12320,ca_location_type#12321] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12322L,i_item_id#12323,i_rec_start_date#12324,i_rec_end_date#12325,i_item_desc#12326,i_current_price#12327,i_wholesale_cost#12328,i_brand_id#12329,i_brand#12330,i_class_id#12331,i_class#12332,i_category_id#12333,i_category#12334,i_manufact_id#12335,i_manufact#12336,i_size#12337,i_formulation#12338,i_color#12339,i_units#12340,i_container#12341,i_manager_id#12342,i_product_name#12343] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [total_sales#12057 ASC NULLS FIRST], true
         +- Aggregate [i_manufact_id#12141], [i_manufact_id#12141, sum(total_sales#12058) AS total_sales#12057]
            +- SubqueryAlias tmp1
               +- Union false, false
                  :- Union false, false
                  :  :- Project [i_manufact_id#12141, total_sales#12058]
                  :  :  +- SubqueryAlias ss
                  :  :     +- CTERelationRef 22, true, [i_manufact_id#12141, total_sales#12058]
                  :  +- Project [i_manufact_id#12238, total_sales#12060]
                  :     +- SubqueryAlias cs
                  :        +- CTERelationRef 23, true, [i_manufact_id#12238, total_sales#12060]
                  +- Project [i_manufact_id#12335, total_sales#12062]
                     +- SubqueryAlias ws
                        +- CTERelationRef 24, true, [i_manufact_id#12335, total_sales#12062]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [total_sales#12057 ASC NULLS FIRST], true
      +- Aggregate [i_manufact_id#12141], [i_manufact_id#12141, sum(total_sales#12058) AS total_sales#12057]
         +- Union false, false
            :- Aggregate [i_manufact_id#12141], [i_manufact_id#12141, sum(ss_ext_sales_price#12078) AS total_sales#12058]
            :  +- Project [ss_ext_sales_price#12078, i_manufact_id#12141]
            :     +- Join Inner, (ss_item_sk#12065L = i_item_sk#12128L)
            :        :- Project [ss_item_sk#12065L, ss_ext_sales_price#12078]
            :        :  +- Join Inner, (ss_addr_sk#12069L = ca_address_sk#12115L)
            :        :     :- Project [ss_item_sk#12065L, ss_addr_sk#12069L, ss_ext_sales_price#12078]
            :        :     :  +- Join Inner, (ss_sold_date_sk#12086L = d_date_sk#12087L)
            :        :     :     :- Project [ss_item_sk#12065L, ss_addr_sk#12069L, ss_ext_sales_price#12078, ss_sold_date_sk#12086L]
            :        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#12086L) AND isnotnull(ss_addr_sk#12069L)) AND isnotnull(ss_item_sk#12065L)) AND dynamicpruning#12416 [ss_sold_date_sk#12086L])
            :        :     :     :     :  +- Project [d_date_sk#12087L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#12093) AND isnotnull(d_moy#12095)) AND ((d_year#12093 = 1999) AND (d_moy#12095 = 3))) AND isnotnull(d_date_sk#12087L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12087L,d_date_id#12088,d_date#12089,d_month_seq#12090,d_week_seq#12091,d_quarter_seq#12092,d_year#12093,d_dow#12094,d_moy#12095,d_dom#12096,d_qoy#12097,d_fy_year#12098,d_fy_quarter_seq#12099,d_fy_week_seq#12100,d_day_name#12101,d_quarter_name#12102,d_holiday#12103,d_weekend#12104,d_following_holiday#12105,d_first_dom#12106,d_last_dom#12107,d_same_day_ly#12108,d_same_day_lq#12109,d_current_day#12110,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12064L,ss_item_sk#12065L,ss_customer_sk#12066L,ss_cdemo_sk#12067L,ss_hdemo_sk#12068L,ss_addr_sk#12069L,ss_store_sk#12070L,ss_promo_sk#12071L,ss_ticket_number#12072L,ss_quantity#12073,ss_wholesale_cost#12074,ss_list_price#12075,ss_sales_price#12076,ss_ext_discount_amt#12077,ss_ext_sales_price#12078,ss_ext_wholesale_cost#12079,ss_ext_list_price#12080,ss_ext_tax#12081,ss_coupon_amt#12082,ss_net_paid#12083,ss_net_paid_inc_tax#12084,ss_net_profit#12085,ss_sold_date_sk#12086L] orc
            :        :     :     +- Project [d_date_sk#12087L]
            :        :     :        +- Filter (((isnotnull(d_year#12093) AND isnotnull(d_moy#12095)) AND ((d_year#12093 = 1999) AND (d_moy#12095 = 3))) AND isnotnull(d_date_sk#12087L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12087L,d_date_id#12088,d_date#12089,d_month_seq#12090,d_week_seq#12091,d_quarter_seq#12092,d_year#12093,d_dow#12094,d_moy#12095,d_dom#12096,d_qoy#12097,d_fy_year#12098,d_fy_quarter_seq#12099,d_fy_week_seq#12100,d_day_name#12101,d_quarter_name#12102,d_holiday#12103,d_weekend#12104,d_following_holiday#12105,d_first_dom#12106,d_last_dom#12107,d_same_day_ly#12108,d_same_day_lq#12109,d_current_day#12110,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#12115L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#12126) AND (ca_gmt_offset#12126 = -6.0)) AND isnotnull(ca_address_sk#12115L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12115L,ca_address_id#12116,ca_street_number#12117,ca_street_name#12118,ca_street_type#12119,ca_suite_number#12120,ca_city#12121,ca_county#12122,ca_state#12123,ca_zip#12124,ca_country#12125,ca_gmt_offset#12126,ca_location_type#12127] orc
            :        +- Join LeftSemi, (i_manufact_id#12141 = i_manufact_id#12357)
            :           :- Project [i_item_sk#12128L, i_manufact_id#12141]
            :           :  +- Filter isnotnull(i_item_sk#12128L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12128L,i_item_id#12129,i_rec_start_date#12130,i_rec_end_date#12131,i_item_desc#12132,i_current_price#12133,i_wholesale_cost#12134,i_brand_id#12135,i_brand#12136,i_class_id#12137,i_class#12138,i_category_id#12139,i_category#12140,i_manufact_id#12141,i_manufact#12142,i_size#12143,i_formulation#12144,i_color#12145,i_units#12146,i_container#12147,i_manager_id#12148,i_product_name#12149] orc
            :           +- Project [i_manufact_id#12357]
            :              +- Filter (isnotnull(i_category#12356) AND (i_category#12356 = Books))
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12344L,i_item_id#12345,i_rec_start_date#12346,i_rec_end_date#12347,i_item_desc#12348,i_current_price#12349,i_wholesale_cost#12350,i_brand_id#12351,i_brand#12352,i_class_id#12353,i_class#12354,i_category_id#12355,i_category#12356,i_manufact_id#12357,i_manufact#12358,i_size#12359,i_formulation#12360,i_color#12361,i_units#12362,i_container#12363,i_manager_id#12364,i_product_name#12365] orc
            :- Aggregate [i_manufact_id#12238], [i_manufact_id#12238, sum(cs_ext_sales_price#12172) AS total_sales#12060]
            :  +- Project [cs_ext_sales_price#12172, i_manufact_id#12238]
            :     +- Join Inner, (cs_item_sk#12164L = i_item_sk#12225L)
            :        :- Project [cs_item_sk#12164L, cs_ext_sales_price#12172]
            :        :  +- Join Inner, (cs_bill_addr_sk#12155L = ca_address_sk#12212L)
            :        :     :- Project [cs_bill_addr_sk#12155L, cs_item_sk#12164L, cs_ext_sales_price#12172]
            :        :     :  +- Join Inner, (cs_sold_date_sk#12183L = d_date_sk#12184L)
            :        :     :     :- Project [cs_bill_addr_sk#12155L, cs_item_sk#12164L, cs_ext_sales_price#12172, cs_sold_date_sk#12183L]
            :        :     :     :  +- Filter (((isnotnull(cs_sold_date_sk#12183L) AND isnotnull(cs_bill_addr_sk#12155L)) AND isnotnull(cs_item_sk#12164L)) AND dynamicpruning#12417 [cs_sold_date_sk#12183L])
            :        :     :     :     :  +- Project [d_date_sk#12184L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#12190) AND isnotnull(d_moy#12192)) AND ((d_year#12190 = 1999) AND (d_moy#12192 = 3))) AND isnotnull(d_date_sk#12184L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12184L,d_date_id#12185,d_date#12186,d_month_seq#12187,d_week_seq#12188,d_quarter_seq#12189,d_year#12190,d_dow#12191,d_moy#12192,d_dom#12193,d_qoy#12194,d_fy_year#12195,d_fy_quarter_seq#12196,d_fy_week_seq#12197,d_day_name#12198,d_quarter_name#12199,d_holiday#12200,d_weekend#12201,d_following_holiday#12202,d_first_dom#12203,d_last_dom#12204,d_same_day_ly#12205,d_same_day_lq#12206,d_current_day#12207,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#12150L,cs_ship_date_sk#12151L,cs_bill_customer_sk#12152L,cs_bill_cdemo_sk#12153L,cs_bill_hdemo_sk#12154L,cs_bill_addr_sk#12155L,cs_ship_customer_sk#12156L,cs_ship_cdemo_sk#12157L,cs_ship_hdemo_sk#12158L,cs_ship_addr_sk#12159L,cs_call_center_sk#12160L,cs_catalog_page_sk#12161L,cs_ship_mode_sk#12162L,cs_warehouse_sk#12163L,cs_item_sk#12164L,cs_promo_sk#12165L,cs_order_number#12166L,cs_quantity#12167,cs_wholesale_cost#12168,cs_list_price#12169,cs_sales_price#12170,cs_ext_discount_amt#12171,cs_ext_sales_price#12172,cs_ext_wholesale_cost#12173,... 10 more fields] orc
            :        :     :     +- Project [d_date_sk#12184L]
            :        :     :        +- Filter (((isnotnull(d_year#12190) AND isnotnull(d_moy#12192)) AND ((d_year#12190 = 1999) AND (d_moy#12192 = 3))) AND isnotnull(d_date_sk#12184L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12184L,d_date_id#12185,d_date#12186,d_month_seq#12187,d_week_seq#12188,d_quarter_seq#12189,d_year#12190,d_dow#12191,d_moy#12192,d_dom#12193,d_qoy#12194,d_fy_year#12195,d_fy_quarter_seq#12196,d_fy_week_seq#12197,d_day_name#12198,d_quarter_name#12199,d_holiday#12200,d_weekend#12201,d_following_holiday#12202,d_first_dom#12203,d_last_dom#12204,d_same_day_ly#12205,d_same_day_lq#12206,d_current_day#12207,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#12212L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#12223) AND (ca_gmt_offset#12223 = -6.0)) AND isnotnull(ca_address_sk#12212L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12212L,ca_address_id#12213,ca_street_number#12214,ca_street_name#12215,ca_street_type#12216,ca_suite_number#12217,ca_city#12218,ca_county#12219,ca_state#12220,ca_zip#12221,ca_country#12222,ca_gmt_offset#12223,ca_location_type#12224] orc
            :        +- Join LeftSemi, (i_manufact_id#12238 = i_manufact_id#12379)
            :           :- Project [i_item_sk#12225L, i_manufact_id#12238]
            :           :  +- Filter isnotnull(i_item_sk#12225L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12225L,i_item_id#12226,i_rec_start_date#12227,i_rec_end_date#12228,i_item_desc#12229,i_current_price#12230,i_wholesale_cost#12231,i_brand_id#12232,i_brand#12233,i_class_id#12234,i_class#12235,i_category_id#12236,i_category#12237,i_manufact_id#12238,i_manufact#12239,i_size#12240,i_formulation#12241,i_color#12242,i_units#12243,i_container#12244,i_manager_id#12245,i_product_name#12246] orc
            :           +- Project [i_manufact_id#12379]
            :              +- Filter (isnotnull(i_category#12378) AND (i_category#12378 = Books))
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12366L,i_item_id#12367,i_rec_start_date#12368,i_rec_end_date#12369,i_item_desc#12370,i_current_price#12371,i_wholesale_cost#12372,i_brand_id#12373,i_brand#12374,i_class_id#12375,i_class#12376,i_category_id#12377,i_category#12378,i_manufact_id#12379,i_manufact#12380,i_size#12381,i_formulation#12382,i_color#12383,i_units#12384,i_container#12385,i_manager_id#12386,i_product_name#12387] orc
            +- Aggregate [i_manufact_id#12335], [i_manufact_id#12335, sum(ws_ext_sales_price#12269) AS total_sales#12062]
               +- Project [ws_ext_sales_price#12269, i_manufact_id#12335]
                  +- Join Inner, (ws_item_sk#12249L = i_item_sk#12322L)
                     :- Project [ws_item_sk#12249L, ws_ext_sales_price#12269]
                     :  +- Join Inner, (ws_bill_addr_sk#12253L = ca_address_sk#12309L)
                     :     :- Project [ws_item_sk#12249L, ws_bill_addr_sk#12253L, ws_ext_sales_price#12269]
                     :     :  +- Join Inner, (ws_sold_date_sk#12280L = d_date_sk#12281L)
                     :     :     :- Project [ws_item_sk#12249L, ws_bill_addr_sk#12253L, ws_ext_sales_price#12269, ws_sold_date_sk#12280L]
                     :     :     :  +- Filter (((isnotnull(ws_sold_date_sk#12280L) AND isnotnull(ws_bill_addr_sk#12253L)) AND isnotnull(ws_item_sk#12249L)) AND dynamicpruning#12418 [ws_sold_date_sk#12280L])
                     :     :     :     :  +- Project [d_date_sk#12281L]
                     :     :     :     :     +- Filter (((isnotnull(d_year#12287) AND isnotnull(d_moy#12289)) AND ((d_year#12287 = 1999) AND (d_moy#12289 = 3))) AND isnotnull(d_date_sk#12281L))
                     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12281L,d_date_id#12282,d_date#12283,d_month_seq#12284,d_week_seq#12285,d_quarter_seq#12286,d_year#12287,d_dow#12288,d_moy#12289,d_dom#12290,d_qoy#12291,d_fy_year#12292,d_fy_quarter_seq#12293,d_fy_week_seq#12294,d_day_name#12295,d_quarter_name#12296,d_holiday#12297,d_weekend#12298,d_following_holiday#12299,d_first_dom#12300,d_last_dom#12301,d_same_day_ly#12302,d_same_day_lq#12303,d_current_day#12304,... 4 more fields] orc
                     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#12247L,ws_ship_date_sk#12248L,ws_item_sk#12249L,ws_bill_customer_sk#12250L,ws_bill_cdemo_sk#12251L,ws_bill_hdemo_sk#12252L,ws_bill_addr_sk#12253L,ws_ship_customer_sk#12254L,ws_ship_cdemo_sk#12255L,ws_ship_hdemo_sk#12256L,ws_ship_addr_sk#12257L,ws_web_page_sk#12258L,ws_web_site_sk#12259L,ws_ship_mode_sk#12260L,ws_warehouse_sk#12261L,ws_promo_sk#12262L,ws_order_number#12263L,ws_quantity#12264,ws_wholesale_cost#12265,ws_list_price#12266,ws_sales_price#12267,ws_ext_discount_amt#12268,ws_ext_sales_price#12269,ws_ext_wholesale_cost#12270,... 10 more fields] orc
                     :     :     +- Project [d_date_sk#12281L]
                     :     :        +- Filter (((isnotnull(d_year#12287) AND isnotnull(d_moy#12289)) AND ((d_year#12287 = 1999) AND (d_moy#12289 = 3))) AND isnotnull(d_date_sk#12281L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12281L,d_date_id#12282,d_date#12283,d_month_seq#12284,d_week_seq#12285,d_quarter_seq#12286,d_year#12287,d_dow#12288,d_moy#12289,d_dom#12290,d_qoy#12291,d_fy_year#12292,d_fy_quarter_seq#12293,d_fy_week_seq#12294,d_day_name#12295,d_quarter_name#12296,d_holiday#12297,d_weekend#12298,d_following_holiday#12299,d_first_dom#12300,d_last_dom#12301,d_same_day_ly#12302,d_same_day_lq#12303,d_current_day#12304,... 4 more fields] orc
                     :     +- Project [ca_address_sk#12309L]
                     :        +- Filter ((isnotnull(ca_gmt_offset#12320) AND (ca_gmt_offset#12320 = -6.0)) AND isnotnull(ca_address_sk#12309L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12309L,ca_address_id#12310,ca_street_number#12311,ca_street_name#12312,ca_street_type#12313,ca_suite_number#12314,ca_city#12315,ca_county#12316,ca_state#12317,ca_zip#12318,ca_country#12319,ca_gmt_offset#12320,ca_location_type#12321] orc
                     +- Join LeftSemi, (i_manufact_id#12335 = i_manufact_id#12401)
                        :- Project [i_item_sk#12322L, i_manufact_id#12335]
                        :  +- Filter isnotnull(i_item_sk#12322L)
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12322L,i_item_id#12323,i_rec_start_date#12324,i_rec_end_date#12325,i_item_desc#12326,i_current_price#12327,i_wholesale_cost#12328,i_brand_id#12329,i_brand#12330,i_class_id#12331,i_class#12332,i_category_id#12333,i_category#12334,i_manufact_id#12335,i_manufact#12336,i_size#12337,i_formulation#12338,i_color#12339,i_units#12340,i_container#12341,i_manager_id#12342,i_product_name#12343] orc
                        +- Project [i_manufact_id#12401]
                           +- Filter (isnotnull(i_category#12400) AND (i_category#12400 = Books))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12388L,i_item_id#12389,i_rec_start_date#12390,i_rec_end_date#12391,i_item_desc#12392,i_current_price#12393,i_wholesale_cost#12394,i_brand_id#12395,i_brand#12396,i_class_id#12397,i_class#12398,i_category_id#12399,i_category#12400,i_manufact_id#12401,i_manufact#12402,i_size#12403,i_formulation#12404,i_color#12405,i_units#12406,i_container#12407,i_manager_id#12408,i_product_name#12409] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[total_sales#12057 ASC NULLS FIRST], output=[i_manufact_id#12141,total_sales#12057])
   +- HashAggregate(keys=[i_manufact_id#12141], functions=[sum(total_sales#12058)], output=[i_manufact_id#12141, total_sales#12057])
      +- Exchange hashpartitioning(i_manufact_id#12141, 3000), ENSURE_REQUIREMENTS, [id=#12998]
         +- HashAggregate(keys=[i_manufact_id#12141], functions=[partial_sum(total_sales#12058)], output=[i_manufact_id#12141, sum#12420])
            +- Union
               :- HashAggregate(keys=[i_manufact_id#12141], functions=[sum(ss_ext_sales_price#12078)], output=[i_manufact_id#12141, total_sales#12058])
               :  +- Exchange hashpartitioning(i_manufact_id#12141, 3000), ENSURE_REQUIREMENTS, [id=#12951]
               :     +- HashAggregate(keys=[i_manufact_id#12141], functions=[partial_sum(ss_ext_sales_price#12078)], output=[i_manufact_id#12141, sum#12422])
               :        +- Project [ss_ext_sales_price#12078, i_manufact_id#12141]
               :           +- BroadcastHashJoin [ss_item_sk#12065L], [i_item_sk#12128L], Inner, BuildRight, false
               :              :- Project [ss_item_sk#12065L, ss_ext_sales_price#12078]
               :              :  +- SortMergeJoin [ss_addr_sk#12069L], [ca_address_sk#12115L], Inner
               :              :     :- Sort [ss_addr_sk#12069L ASC NULLS FIRST], false, 0
               :              :     :  +- Exchange hashpartitioning(ss_addr_sk#12069L, 3000), ENSURE_REQUIREMENTS, [id=#12937]
               :              :     :     +- Project [ss_item_sk#12065L, ss_addr_sk#12069L, ss_ext_sales_price#12078]
               :              :     :        +- BroadcastHashJoin [ss_sold_date_sk#12086L], [d_date_sk#12087L], Inner, BuildRight, false
               :              :     :           :- Filter (isnotnull(ss_addr_sk#12069L) AND isnotnull(ss_item_sk#12065L))
               :              :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#12065L,ss_addr_sk#12069L,ss_ext_sales_price#12078,ss_sold_date_sk#12086L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#12069L), isnotnull(ss_item_sk#12065L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#12086L), dynamicpruningexpression(ss_sold_date_sk#12086L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_addr_sk:bigint,ss_ext_sales_price:double>
               :              :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#12416, 0, true, Project [d_date_sk#12087L], [d_date_sk#12087L]
               :              :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :     :           :              +- Project [d_date_sk#12087L]
               :              :     :           :                 +- Filter ((((isnotnull(d_year#12093) AND isnotnull(d_moy#12095)) AND (d_year#12093 = 1999)) AND (d_moy#12095 = 3)) AND isnotnull(d_date_sk#12087L))
               :              :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12087L,d_year#12093,d_moy#12095] Batched: true, DataFilters: [isnotnull(d_year#12093), isnotnull(d_moy#12095), (d_year#12093 = 1999), (d_moy#12095 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12932]
               :              :     :              +- Project [d_date_sk#12087L]
               :              :     :                 +- Filter ((((isnotnull(d_year#12093) AND isnotnull(d_moy#12095)) AND (d_year#12093 = 1999)) AND (d_moy#12095 = 3)) AND isnotnull(d_date_sk#12087L))
               :              :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12087L,d_year#12093,d_moy#12095] Batched: true, DataFilters: [isnotnull(d_year#12093), isnotnull(d_moy#12095), (d_year#12093 = 1999), (d_moy#12095 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :     +- Sort [ca_address_sk#12115L ASC NULLS FIRST], false, 0
               :              :        +- Exchange hashpartitioning(ca_address_sk#12115L, 3000), ENSURE_REQUIREMENTS, [id=#12938]
               :              :           +- Project [ca_address_sk#12115L]
               :              :              +- Filter ((isnotnull(ca_gmt_offset#12126) AND (ca_gmt_offset#12126 = -6.0)) AND isnotnull(ca_address_sk#12115L))
               :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12115L,ca_gmt_offset#12126] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#12126), (ca_gmt_offset#12126 = -6.0), isnotnull(ca_address_sk#12115L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12946]
               :                 +- BroadcastHashJoin [i_manufact_id#12141], [i_manufact_id#12357], LeftSemi, BuildRight, false
               :                    :- Filter isnotnull(i_item_sk#12128L)
               :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12128L,i_manufact_id#12141] Batched: true, DataFilters: [isnotnull(i_item_sk#12128L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_manufact_id:int>
               :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#12943]
               :                       +- Project [i_manufact_id#12357]
               :                          +- Filter (isnotnull(i_category#12356) AND (i_category#12356 = Books))
               :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_category#12356,i_manufact_id#12357] Batched: true, DataFilters: [isnotnull(i_category#12356), (i_category#12356 = Books)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Books)], ReadSchema: struct<i_category:string,i_manufact_id:int>
               :- HashAggregate(keys=[i_manufact_id#12238], functions=[sum(cs_ext_sales_price#12172)], output=[i_manufact_id#12238, total_sales#12060])
               :  +- Exchange hashpartitioning(i_manufact_id#12238, 3000), ENSURE_REQUIREMENTS, [id=#12972]
               :     +- HashAggregate(keys=[i_manufact_id#12238], functions=[partial_sum(cs_ext_sales_price#12172)], output=[i_manufact_id#12238, sum#12424])
               :        +- Project [cs_ext_sales_price#12172, i_manufact_id#12238]
               :           +- BroadcastHashJoin [cs_item_sk#12164L], [i_item_sk#12225L], Inner, BuildRight, false
               :              :- Project [cs_item_sk#12164L, cs_ext_sales_price#12172]
               :              :  +- SortMergeJoin [cs_bill_addr_sk#12155L], [ca_address_sk#12212L], Inner
               :              :     :- Sort [cs_bill_addr_sk#12155L ASC NULLS FIRST], false, 0
               :              :     :  +- Exchange hashpartitioning(cs_bill_addr_sk#12155L, 3000), ENSURE_REQUIREMENTS, [id=#12958]
               :              :     :     +- Project [cs_bill_addr_sk#12155L, cs_item_sk#12164L, cs_ext_sales_price#12172]
               :              :     :        +- BroadcastHashJoin [cs_sold_date_sk#12183L], [d_date_sk#12184L], Inner, BuildRight, false
               :              :     :           :- Filter (isnotnull(cs_bill_addr_sk#12155L) AND isnotnull(cs_item_sk#12164L))
               :              :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_addr_sk#12155L,cs_item_sk#12164L,cs_ext_sales_price#12172,cs_sold_date_sk#12183L] Batched: true, DataFilters: [isnotnull(cs_bill_addr_sk#12155L), isnotnull(cs_item_sk#12164L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#12183L), dynamicpruningexpression(cs_sold_date_sk#12183L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:bigint,cs_item_sk:bigint,cs_ext_sales_price:double>
               :              :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#12417, 0, true, Project [d_date_sk#12184L], [d_date_sk#12184L]
               :              :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :     :           :              +- Project [d_date_sk#12184L]
               :              :     :           :                 +- Filter ((((isnotnull(d_year#12190) AND isnotnull(d_moy#12192)) AND (d_year#12190 = 1999)) AND (d_moy#12192 = 3)) AND isnotnull(d_date_sk#12184L))
               :              :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12184L,d_year#12190,d_moy#12192] Batched: true, DataFilters: [isnotnull(d_year#12190), isnotnull(d_moy#12192), (d_year#12190 = 1999), (d_moy#12192 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12953]
               :              :     :              +- Project [d_date_sk#12184L]
               :              :     :                 +- Filter ((((isnotnull(d_year#12190) AND isnotnull(d_moy#12192)) AND (d_year#12190 = 1999)) AND (d_moy#12192 = 3)) AND isnotnull(d_date_sk#12184L))
               :              :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12184L,d_year#12190,d_moy#12192] Batched: true, DataFilters: [isnotnull(d_year#12190), isnotnull(d_moy#12192), (d_year#12190 = 1999), (d_moy#12192 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :     +- Sort [ca_address_sk#12212L ASC NULLS FIRST], false, 0
               :              :        +- Exchange hashpartitioning(ca_address_sk#12212L, 3000), ENSURE_REQUIREMENTS, [id=#12959]
               :              :           +- Project [ca_address_sk#12212L]
               :              :              +- Filter ((isnotnull(ca_gmt_offset#12223) AND (ca_gmt_offset#12223 = -6.0)) AND isnotnull(ca_address_sk#12212L))
               :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12212L,ca_gmt_offset#12223] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#12223), (ca_gmt_offset#12223 = -6.0), isnotnull(ca_address_sk#12212L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12967]
               :                 +- BroadcastHashJoin [i_manufact_id#12238], [i_manufact_id#12379], LeftSemi, BuildRight, false
               :                    :- Filter isnotnull(i_item_sk#12225L)
               :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12225L,i_manufact_id#12238] Batched: true, DataFilters: [isnotnull(i_item_sk#12225L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_manufact_id:int>
               :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#12964]
               :                       +- Project [i_manufact_id#12379]
               :                          +- Filter (isnotnull(i_category#12378) AND (i_category#12378 = Books))
               :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_category#12378,i_manufact_id#12379] Batched: true, DataFilters: [isnotnull(i_category#12378), (i_category#12378 = Books)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Books)], ReadSchema: struct<i_category:string,i_manufact_id:int>
               +- HashAggregate(keys=[i_manufact_id#12335], functions=[sum(ws_ext_sales_price#12269)], output=[i_manufact_id#12335, total_sales#12062])
                  +- Exchange hashpartitioning(i_manufact_id#12335, 3000), ENSURE_REQUIREMENTS, [id=#12993]
                     +- HashAggregate(keys=[i_manufact_id#12335], functions=[partial_sum(ws_ext_sales_price#12269)], output=[i_manufact_id#12335, sum#12426])
                        +- Project [ws_ext_sales_price#12269, i_manufact_id#12335]
                           +- BroadcastHashJoin [ws_item_sk#12249L], [i_item_sk#12322L], Inner, BuildRight, false
                              :- Project [ws_item_sk#12249L, ws_ext_sales_price#12269]
                              :  +- SortMergeJoin [ws_bill_addr_sk#12253L], [ca_address_sk#12309L], Inner
                              :     :- Sort [ws_bill_addr_sk#12253L ASC NULLS FIRST], false, 0
                              :     :  +- Exchange hashpartitioning(ws_bill_addr_sk#12253L, 3000), ENSURE_REQUIREMENTS, [id=#12979]
                              :     :     +- Project [ws_item_sk#12249L, ws_bill_addr_sk#12253L, ws_ext_sales_price#12269]
                              :     :        +- BroadcastHashJoin [ws_sold_date_sk#12280L], [d_date_sk#12281L], Inner, BuildRight, false
                              :     :           :- Filter (isnotnull(ws_bill_addr_sk#12253L) AND isnotnull(ws_item_sk#12249L))
                              :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#12249L,ws_bill_addr_sk#12253L,ws_ext_sales_price#12269,ws_sold_date_sk#12280L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#12253L), isnotnull(ws_item_sk#12249L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#12280L), dynamicpruningexpression(ws_sold_date_sk#12280L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                              :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#12418, 0, true, Project [d_date_sk#12281L], [d_date_sk#12281L]
                              :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :     :           :              +- Project [d_date_sk#12281L]
                              :     :           :                 +- Filter ((((isnotnull(d_year#12287) AND isnotnull(d_moy#12289)) AND (d_year#12287 = 1999)) AND (d_moy#12289 = 3)) AND isnotnull(d_date_sk#12281L))
                              :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12281L,d_year#12287,d_moy#12289] Batched: true, DataFilters: [isnotnull(d_year#12287), isnotnull(d_moy#12289), (d_year#12287 = 1999), (d_moy#12289 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#12974]
                              :     :              +- Project [d_date_sk#12281L]
                              :     :                 +- Filter ((((isnotnull(d_year#12287) AND isnotnull(d_moy#12289)) AND (d_year#12287 = 1999)) AND (d_moy#12289 = 3)) AND isnotnull(d_date_sk#12281L))
                              :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12281L,d_year#12287,d_moy#12289] Batched: true, DataFilters: [isnotnull(d_year#12287), isnotnull(d_moy#12289), (d_year#12287 = 1999), (d_moy#12289 = 3), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :     +- Sort [ca_address_sk#12309L ASC NULLS FIRST], false, 0
                              :        +- Exchange hashpartitioning(ca_address_sk#12309L, 3000), ENSURE_REQUIREMENTS, [id=#12980]
                              :           +- Project [ca_address_sk#12309L]
                              :              +- Filter ((isnotnull(ca_gmt_offset#12320) AND (ca_gmt_offset#12320 = -6.0)) AND isnotnull(ca_address_sk#12309L))
                              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12309L,ca_gmt_offset#12320] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#12320), (ca_gmt_offset#12320 = -6.0), isnotnull(ca_address_sk#12309L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#12988]
                                 +- BroadcastHashJoin [i_manufact_id#12335], [i_manufact_id#12401], LeftSemi, BuildRight, false
                                    :- Filter isnotnull(i_item_sk#12322L)
                                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12322L,i_manufact_id#12335] Batched: true, DataFilters: [isnotnull(i_item_sk#12322L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_manufact_id:int>
                                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#12985]
                                       +- Project [i_manufact_id#12401]
                                          +- Filter (isnotnull(i_category#12400) AND (i_category#12400 = Books))
                                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_category#12400,i_manufact_id#12401] Batched: true, DataFilters: [isnotnull(i_category#12400), (i_category#12400 = Books)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Books)], ReadSchema: struct<i_category:string,i_manufact_id:int>

read query: spark_queries/q34.sql
explain query: q34
== Parsed Logical Plan ==
'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_preferred_cust_flag DESC NULLS LAST], true
+- 'Project ['c_last_name, 'c_first_name, 'c_salutation, 'c_preferred_cust_flag, 'ss_ticket_number, 'cnt]
   +- 'Filter (('ss_customer_sk = 'c_customer_sk) AND (('cnt >= 15) AND ('cnt <= 20)))
      +- 'Join Inner
         :- 'SubqueryAlias dn
         :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk], ['ss_ticket_number, 'ss_customer_sk, 'count(1) AS cnt#12427]
         :     +- 'Filter ((((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_store_sk = 'store.s_store_sk)) AND ('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (((('date_dim.d_dom >= 1) AND ('date_dim.d_dom <= 3)) OR (('date_dim.d_dom >= 25) AND ('date_dim.d_dom <= 28))) AND (('household_demographics.hd_buy_potential = >10000) OR ('household_demographics.hd_buy_potential = unknown)))) AND ((('household_demographics.hd_vehicle_count > 0) AND (CASE WHEN ('household_demographics.hd_vehicle_count > 0) THEN ('household_demographics.hd_dep_count / 'household_demographics.hd_vehicle_count) ELSE null END > 1.2)) AND ('date_dim.d_year IN (2000,(2000 + 1),(2000 + 2)) AND 'store.s_county IN (Mobile County,Maverick County,Huron County,Kittitas County,Fairfield County,Jackson County,Barrow County,Pennington County))))
         :        +- 'Join Inner
         :           :- 'Join Inner
         :           :  :- 'Join Inner
         :           :  :  :- 'UnresolvedRelation [store_sales], [], false
         :           :  :  +- 'UnresolvedRelation [date_dim], [], false
         :           :  +- 'UnresolvedRelation [store], [], false
         :           +- 'UnresolvedRelation [household_demographics], [], false
         +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, c_salutation: string, c_preferred_cust_flag: string, ss_ticket_number: bigint, cnt: bigint
Sort [c_last_name#12523 ASC NULLS FIRST, c_first_name#12522 ASC NULLS FIRST, c_salutation#12521 ASC NULLS FIRST, c_preferred_cust_flag#12524 DESC NULLS LAST], true
+- Project [c_last_name#12523, c_first_name#12522, c_salutation#12521, c_preferred_cust_flag#12524, ss_ticket_number#12437L, cnt#12427L]
   +- Filter ((ss_customer_sk#12431L = c_customer_sk#12514L) AND ((cnt#12427L >= cast(15 as bigint)) AND (cnt#12427L <= cast(20 as bigint))))
      +- Join Inner
         :- SubqueryAlias dn
         :  +- Aggregate [ss_ticket_number#12437L, ss_customer_sk#12431L], [ss_ticket_number#12437L, ss_customer_sk#12431L, count(1) AS cnt#12427L]
         :     +- Filter (((((ss_sold_date_sk#12451L = d_date_sk#12452L) AND (ss_store_sk#12435L = s_store_sk#12480L)) AND (ss_hdemo_sk#12433L = hd_demo_sk#12509L)) AND ((((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))) AND ((hd_buy_potential#12511 = >10000) OR (hd_buy_potential#12511 = unknown)))) AND (((hd_vehicle_count#12513 > 0) AND (CASE WHEN (hd_vehicle_count#12513 > 0) THEN (cast(hd_dep_count#12512 as double) / cast(hd_vehicle_count#12513 as double)) ELSE cast(null as double) END > cast(1.2 as double))) AND (d_year#12458 IN (2000,(2000 + 1),(2000 + 2)) AND s_county#12503 IN (Mobile County,Maverick County,Huron County,Kittitas County,Fairfield County,Jackson County,Barrow County,Pennington County))))
         :        +- Join Inner
         :           :- Join Inner
         :           :  :- Join Inner
         :           :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :           :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12429L,ss_item_sk#12430L,ss_customer_sk#12431L,ss_cdemo_sk#12432L,ss_hdemo_sk#12433L,ss_addr_sk#12434L,ss_store_sk#12435L,ss_promo_sk#12436L,ss_ticket_number#12437L,ss_quantity#12438,ss_wholesale_cost#12439,ss_list_price#12440,ss_sales_price#12441,ss_ext_discount_amt#12442,ss_ext_sales_price#12443,ss_ext_wholesale_cost#12444,ss_ext_list_price#12445,ss_ext_tax#12446,ss_coupon_amt#12447,ss_net_paid#12448,ss_net_paid_inc_tax#12449,ss_net_profit#12450,ss_sold_date_sk#12451L] orc
         :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12452L,d_date_id#12453,d_date#12454,d_month_seq#12455,d_week_seq#12456,d_quarter_seq#12457,d_year#12458,d_dow#12459,d_moy#12460,d_dom#12461,d_qoy#12462,d_fy_year#12463,d_fy_quarter_seq#12464,d_fy_week_seq#12465,d_day_name#12466,d_quarter_name#12467,d_holiday#12468,d_weekend#12469,d_following_holiday#12470,d_first_dom#12471,d_last_dom#12472,d_same_day_ly#12473,d_same_day_lq#12474,d_current_day#12475,... 4 more fields] orc
         :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
         :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12480L,s_store_id#12481,s_rec_start_date#12482,s_rec_end_date#12483,s_closed_date_sk#12484L,s_store_name#12485,s_number_employees#12486,s_floor_space#12487,s_hours#12488,s_manager#12489,s_market_id#12490,s_geography_class#12491,s_market_desc#12492,s_market_manager#12493,s_division_id#12494,s_division_name#12495,s_company_id#12496,s_company_name#12497,s_street_number#12498,s_street_name#12499,s_street_type#12500,s_suite_number#12501,s_city#12502,s_county#12503,... 5 more fields] orc
         :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
         :              +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#12509L,hd_income_band_sk#12510L,hd_buy_potential#12511,hd_dep_count#12512,hd_vehicle_count#12513] orc
         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
            +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12514L,c_customer_id#12515,c_current_cdemo_sk#12516L,c_current_hdemo_sk#12517L,c_current_addr_sk#12518L,c_first_shipto_date_sk#12519L,c_first_sales_date_sk#12520L,c_salutation#12521,c_first_name#12522,c_last_name#12523,c_preferred_cust_flag#12524,c_birth_day#12525,c_birth_month#12526,c_birth_year#12527,c_birth_country#12528,c_login#12529,c_email_address#12530,c_last_review_date#12531] orc

== Optimized Logical Plan ==
Sort [c_last_name#12523 ASC NULLS FIRST, c_first_name#12522 ASC NULLS FIRST, c_salutation#12521 ASC NULLS FIRST, c_preferred_cust_flag#12524 DESC NULLS LAST], true
+- Project [c_last_name#12523, c_first_name#12522, c_salutation#12521, c_preferred_cust_flag#12524, ss_ticket_number#12437L, cnt#12427L]
   +- Join Inner, (ss_customer_sk#12431L = c_customer_sk#12514L)
      :- Filter ((cnt#12427L >= 15) AND (cnt#12427L <= 20))
      :  +- Aggregate [ss_ticket_number#12437L, ss_customer_sk#12431L], [ss_ticket_number#12437L, ss_customer_sk#12431L, count(1) AS cnt#12427L]
      :     +- Project [ss_customer_sk#12431L, ss_ticket_number#12437L]
      :        +- Join Inner, (ss_hdemo_sk#12433L = hd_demo_sk#12509L)
      :           :- Project [ss_customer_sk#12431L, ss_hdemo_sk#12433L, ss_ticket_number#12437L]
      :           :  +- Join Inner, (ss_store_sk#12435L = s_store_sk#12480L)
      :           :     :- Project [ss_customer_sk#12431L, ss_hdemo_sk#12433L, ss_store_sk#12435L, ss_ticket_number#12437L]
      :           :     :  +- Join Inner, (ss_sold_date_sk#12451L = d_date_sk#12452L)
      :           :     :     :- Project [ss_customer_sk#12431L, ss_hdemo_sk#12433L, ss_store_sk#12435L, ss_ticket_number#12437L, ss_sold_date_sk#12451L]
      :           :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#12451L) AND isnotnull(ss_store_sk#12435L)) AND isnotnull(ss_hdemo_sk#12433L)) AND isnotnull(ss_customer_sk#12431L)) AND dynamicpruning#12538 [ss_sold_date_sk#12451L])
      :           :     :     :     :  +- Project [d_date_sk#12452L]
      :           :     :     :     :     +- Filter (((((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))) AND d_year#12458 IN (2000,2001,2002)) AND isnotnull(d_date_sk#12452L))
      :           :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12452L,d_date_id#12453,d_date#12454,d_month_seq#12455,d_week_seq#12456,d_quarter_seq#12457,d_year#12458,d_dow#12459,d_moy#12460,d_dom#12461,d_qoy#12462,d_fy_year#12463,d_fy_quarter_seq#12464,d_fy_week_seq#12465,d_day_name#12466,d_quarter_name#12467,d_holiday#12468,d_weekend#12469,d_following_holiday#12470,d_first_dom#12471,d_last_dom#12472,d_same_day_ly#12473,d_same_day_lq#12474,d_current_day#12475,... 4 more fields] orc
      :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12429L,ss_item_sk#12430L,ss_customer_sk#12431L,ss_cdemo_sk#12432L,ss_hdemo_sk#12433L,ss_addr_sk#12434L,ss_store_sk#12435L,ss_promo_sk#12436L,ss_ticket_number#12437L,ss_quantity#12438,ss_wholesale_cost#12439,ss_list_price#12440,ss_sales_price#12441,ss_ext_discount_amt#12442,ss_ext_sales_price#12443,ss_ext_wholesale_cost#12444,ss_ext_list_price#12445,ss_ext_tax#12446,ss_coupon_amt#12447,ss_net_paid#12448,ss_net_paid_inc_tax#12449,ss_net_profit#12450,ss_sold_date_sk#12451L] orc
      :           :     :     +- Project [d_date_sk#12452L]
      :           :     :        +- Filter (((((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))) AND d_year#12458 IN (2000,2001,2002)) AND isnotnull(d_date_sk#12452L))
      :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12452L,d_date_id#12453,d_date#12454,d_month_seq#12455,d_week_seq#12456,d_quarter_seq#12457,d_year#12458,d_dow#12459,d_moy#12460,d_dom#12461,d_qoy#12462,d_fy_year#12463,d_fy_quarter_seq#12464,d_fy_week_seq#12465,d_day_name#12466,d_quarter_name#12467,d_holiday#12468,d_weekend#12469,d_following_holiday#12470,d_first_dom#12471,d_last_dom#12472,d_same_day_ly#12473,d_same_day_lq#12474,d_current_day#12475,... 4 more fields] orc
      :           :     +- Project [s_store_sk#12480L]
      :           :        +- Filter (s_county#12503 IN (Mobile County,Maverick County,Huron County,Kittitas County,Fairfield County,Jackson County,Barrow County,Pennington County) AND isnotnull(s_store_sk#12480L))
      :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12480L,s_store_id#12481,s_rec_start_date#12482,s_rec_end_date#12483,s_closed_date_sk#12484L,s_store_name#12485,s_number_employees#12486,s_floor_space#12487,s_hours#12488,s_manager#12489,s_market_id#12490,s_geography_class#12491,s_market_desc#12492,s_market_manager#12493,s_division_id#12494,s_division_name#12495,s_company_id#12496,s_company_name#12497,s_street_number#12498,s_street_name#12499,s_street_type#12500,s_suite_number#12501,s_city#12502,s_county#12503,... 5 more fields] orc
      :           +- Project [hd_demo_sk#12509L]
      :              +- Filter (((isnotnull(hd_vehicle_count#12513) AND isnotnull(hd_dep_count#12512)) AND ((((hd_buy_potential#12511 = >10000) OR (hd_buy_potential#12511 = unknown)) AND (hd_vehicle_count#12513 > 0)) AND ((cast(hd_dep_count#12512 as double) / cast(hd_vehicle_count#12513 as double)) > 1.2))) AND isnotnull(hd_demo_sk#12509L))
      :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#12509L,hd_income_band_sk#12510L,hd_buy_potential#12511,hd_dep_count#12512,hd_vehicle_count#12513] orc
      +- Project [c_customer_sk#12514L, c_salutation#12521, c_first_name#12522, c_last_name#12523, c_preferred_cust_flag#12524]
         +- Filter isnotnull(c_customer_sk#12514L)
            +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12514L,c_customer_id#12515,c_current_cdemo_sk#12516L,c_current_hdemo_sk#12517L,c_current_addr_sk#12518L,c_first_shipto_date_sk#12519L,c_first_sales_date_sk#12520L,c_salutation#12521,c_first_name#12522,c_last_name#12523,c_preferred_cust_flag#12524,c_birth_day#12525,c_birth_month#12526,c_birth_year#12527,c_birth_country#12528,c_login#12529,c_email_address#12530,c_last_review_date#12531] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [c_last_name#12523 ASC NULLS FIRST, c_first_name#12522 ASC NULLS FIRST, c_salutation#12521 ASC NULLS FIRST, c_preferred_cust_flag#12524 DESC NULLS LAST], true, 0
   +- Exchange rangepartitioning(c_last_name#12523 ASC NULLS FIRST, c_first_name#12522 ASC NULLS FIRST, c_salutation#12521 ASC NULLS FIRST, c_preferred_cust_flag#12524 DESC NULLS LAST, 3000), ENSURE_REQUIREMENTS, [id=#13146]
      +- Project [c_last_name#12523, c_first_name#12522, c_salutation#12521, c_preferred_cust_flag#12524, ss_ticket_number#12437L, cnt#12427L]
         +- SortMergeJoin [ss_customer_sk#12431L], [c_customer_sk#12514L], Inner
            :- Sort [ss_customer_sk#12431L ASC NULLS FIRST], false, 0
            :  +- Exchange hashpartitioning(ss_customer_sk#12431L, 3000), ENSURE_REQUIREMENTS, [id=#13139]
            :     +- Filter ((cnt#12427L >= 15) AND (cnt#12427L <= 20))
            :        +- HashAggregate(keys=[ss_ticket_number#12437L, ss_customer_sk#12431L], functions=[count(1)], output=[ss_ticket_number#12437L, ss_customer_sk#12431L, cnt#12427L])
            :           +- Exchange hashpartitioning(ss_ticket_number#12437L, ss_customer_sk#12431L, 3000), ENSURE_REQUIREMENTS, [id=#13134]
            :              +- HashAggregate(keys=[ss_ticket_number#12437L, ss_customer_sk#12431L], functions=[partial_count(1)], output=[ss_ticket_number#12437L, ss_customer_sk#12431L, count#12540L])
            :                 +- Project [ss_customer_sk#12431L, ss_ticket_number#12437L]
            :                    +- BroadcastHashJoin [ss_hdemo_sk#12433L], [hd_demo_sk#12509L], Inner, BuildRight, false
            :                       :- Project [ss_customer_sk#12431L, ss_hdemo_sk#12433L, ss_ticket_number#12437L]
            :                       :  +- BroadcastHashJoin [ss_store_sk#12435L], [s_store_sk#12480L], Inner, BuildRight, false
            :                       :     :- Project [ss_customer_sk#12431L, ss_hdemo_sk#12433L, ss_store_sk#12435L, ss_ticket_number#12437L]
            :                       :     :  +- BroadcastHashJoin [ss_sold_date_sk#12451L], [d_date_sk#12452L], Inner, BuildRight, false
            :                       :     :     :- Filter ((isnotnull(ss_store_sk#12435L) AND isnotnull(ss_hdemo_sk#12433L)) AND isnotnull(ss_customer_sk#12431L))
            :                       :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#12431L,ss_hdemo_sk#12433L,ss_store_sk#12435L,ss_ticket_number#12437L,ss_sold_date_sk#12451L] Batched: true, DataFilters: [isnotnull(ss_store_sk#12435L), isnotnull(ss_hdemo_sk#12433L), isnotnull(ss_customer_sk#12431L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#12451L), dynamicpruningexpression(ss_sold_date_sk#12451L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint>
            :                       :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#12538, 0, true, Project [d_date_sk#12452L], [d_date_sk#12452L]
            :                       :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
            :                       :     :     :              +- Project [d_date_sk#12452L]
            :                       :     :     :                 +- Filter (((((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))) AND d_year#12458 IN (2000,2001,2002)) AND isnotnull(d_date_sk#12452L))
            :                       :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12452L,d_year#12458,d_dom#12461] Batched: true, DataFilters: [(((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(GreaterThanOrEqual(d_dom,1),LessThanOrEqual(d_dom,3)),And(GreaterThanOrEqual(d_dom,25),Le..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
            :                       :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13121]
            :                       :     :        +- Project [d_date_sk#12452L]
            :                       :     :           +- Filter (((((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))) AND d_year#12458 IN (2000,2001,2002)) AND isnotnull(d_date_sk#12452L))
            :                       :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12452L,d_year#12458,d_dom#12461] Batched: true, DataFilters: [(((d_dom#12461 >= 1) AND (d_dom#12461 <= 3)) OR ((d_dom#12461 >= 25) AND (d_dom#12461 <= 28))), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(GreaterThanOrEqual(d_dom,1),LessThanOrEqual(d_dom,3)),And(GreaterThanOrEqual(d_dom,25),Le..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
            :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13125]
            :                       :        +- Project [s_store_sk#12480L]
            :                       :           +- Filter (s_county#12503 IN (Mobile County,Maverick County,Huron County,Kittitas County,Fairfield County,Jackson County,Barrow County,Pennington County) AND isnotnull(s_store_sk#12480L))
            :                       :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12480L,s_county#12503] Batched: true, DataFilters: [s_county#12503 IN (Mobile County,Maverick County,Huron County,Kittitas County,Fairfield County,J..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_county, [Barrow County,Fairfield County,Huron County,Jackson County,Kittitas County,Maveric..., ReadSchema: struct<s_store_sk:bigint,s_county:string>
            :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13129]
            :                          +- Project [hd_demo_sk#12509L]
            :                             +- Filter (((((isnotnull(hd_vehicle_count#12513) AND isnotnull(hd_dep_count#12512)) AND ((hd_buy_potential#12511 = >10000) OR (hd_buy_potential#12511 = unknown))) AND (hd_vehicle_count#12513 > 0)) AND ((cast(hd_dep_count#12512 as double) / cast(hd_vehicle_count#12513 as double)) > 1.2)) AND isnotnull(hd_demo_sk#12509L))
            :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#12509L,hd_buy_potential#12511,hd_dep_count#12512,hd_vehicle_count#12513] Batched: true, DataFilters: [isnotnull(hd_vehicle_count#12513), isnotnull(hd_dep_count#12512), ((hd_buy_potential#12511 = >10..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_vehicle_count), IsNotNull(hd_dep_count), Or(EqualTo(hd_buy_potential,>10000),EqualT..., ReadSchema: struct<hd_demo_sk:bigint,hd_buy_potential:string,hd_dep_count:int,hd_vehicle_count:int>
            +- Sort [c_customer_sk#12514L ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(c_customer_sk#12514L, 3000), ENSURE_REQUIREMENTS, [id=#13140]
                  +- Filter isnotnull(c_customer_sk#12514L)
                     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12514L,c_salutation#12521,c_first_name#12522,c_last_name#12523,c_preferred_cust_flag#12524] Batched: true, DataFilters: [isnotnull(c_customer_sk#12514L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_salutation:string,c_first_name:string,c_last_name:string,c_preferre...

read query: spark_queries/q35.sql
explain query: q35
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ca_state ASC NULLS FIRST, 'cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_dep_count ASC NULLS FIRST, 'cd_dep_employed_count ASC NULLS FIRST, 'cd_dep_college_count ASC NULLS FIRST], true
      +- 'Aggregate ['ca_state, 'cd_gender, 'cd_marital_status, 'cd_dep_count, 'cd_dep_employed_count, 'cd_dep_college_count], ['ca_state, 'cd_gender, 'cd_marital_status, 'count(1) AS cnt1#12541, unresolvedalias('avg('cd_dep_count), None), unresolvedalias('max('cd_dep_count), None), unresolvedalias('sum('cd_dep_count), None), 'cd_dep_employed_count, 'count(1) AS cnt2#12542, unresolvedalias('avg('cd_dep_employed_count), None), unresolvedalias('max('cd_dep_employed_count), None), unresolvedalias('sum('cd_dep_employed_count), None), 'cd_dep_college_count, 'count(1) AS cnt3#12543, unresolvedalias('avg('cd_dep_college_count), None), unresolvedalias('max('cd_dep_college_count), None), unresolvedalias('sum('cd_dep_college_count), None)]
         +- 'Filter ((('c.c_current_addr_sk = 'ca.ca_address_sk) AND ('cd_demo_sk = 'c.c_current_cdemo_sk)) AND (exists#12544 [] AND (exists#12545 [] OR exists#12546 [])))
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND ('d_qoy < 4)))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [store_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND ('d_qoy < 4)))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [web_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  +- 'Project [*]
            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND ('d_qoy < 4)))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [catalog_sales], [], false
            :           +- 'UnresolvedRelation [date_dim], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias c
               :  :  +- 'UnresolvedRelation [customer], [], false
               :  +- 'SubqueryAlias ca
               :     +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [customer_demographics], [], false

== Analyzed Logical Plan ==
ca_state: string, cd_gender: string, cd_marital_status: string, cnt1: bigint, avg(cd_dep_count): double, max(cd_dep_count): int, sum(cd_dep_count): bigint, cd_dep_employed_count: int, cnt2: bigint, avg(cd_dep_employed_count): double, max(cd_dep_employed_count): int, sum(cd_dep_employed_count): bigint, cd_dep_college_count: int, cnt3: bigint, avg(cd_dep_college_count): double, max(cd_dep_college_count): int, sum(cd_dep_college_count): bigint
GlobalLimit 100
+- LocalLimit 100
   +- Project [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cnt1#12541L, avg(cd_dep_count)#12774, max(cd_dep_count)#12775, sum(cd_dep_count)#12776L, cd_dep_employed_count#12588, cnt2#12542L, avg(cd_dep_employed_count)#12777, max(cd_dep_employed_count)#12778, sum(cd_dep_employed_count)#12779L, cd_dep_college_count#12589, cnt3#12543L, avg(cd_dep_college_count)#12780, max(cd_dep_college_count)#12781, sum(cd_dep_college_count)#12782L]
      +- Sort [ca_state#12576 ASC NULLS FIRST, cd_gender#12582 ASC NULLS FIRST, cd_marital_status#12583 ASC NULLS FIRST, cd_dep_count#12587 ASC NULLS FIRST, cd_dep_employed_count#12588 ASC NULLS FIRST, cd_dep_college_count#12589 ASC NULLS FIRST], true
         +- Aggregate [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589], [ca_state#12576, cd_gender#12582, cd_marital_status#12583, count(1) AS cnt1#12541L, avg(cd_dep_count#12587) AS avg(cd_dep_count)#12774, max(cd_dep_count#12587) AS max(cd_dep_count)#12775, sum(cd_dep_count#12587) AS sum(cd_dep_count)#12776L, cd_dep_employed_count#12588, count(1) AS cnt2#12542L, avg(cd_dep_employed_count#12588) AS avg(cd_dep_employed_count)#12777, max(cd_dep_employed_count#12588) AS max(cd_dep_employed_count)#12778, sum(cd_dep_employed_count#12588) AS sum(cd_dep_employed_count)#12779L, cd_dep_college_count#12589, count(1) AS cnt3#12543L, avg(cd_dep_college_count#12589) AS avg(cd_dep_college_count)#12780, max(cd_dep_college_count#12589) AS max(cd_dep_college_count)#12781, sum(cd_dep_college_count#12589) AS sum(cd_dep_college_count)#12782L, cd_dep_count#12587]
            +- Filter (((c_current_addr_sk#12554L = ca_address_sk#12568L) AND (cd_demo_sk#12581L = c_current_cdemo_sk#12552L)) AND (exists#12544 [c_customer_sk#12550L] AND (exists#12545 [c_customer_sk#12550L] OR exists#12546 [c_customer_sk#12550L])))
               :  :- Project [ss_sold_time_sk#12590L, ss_item_sk#12591L, ss_customer_sk#12592L, ss_cdemo_sk#12593L, ss_hdemo_sk#12594L, ss_addr_sk#12595L, ss_store_sk#12596L, ss_promo_sk#12597L, ss_ticket_number#12598L, ss_quantity#12599, ss_wholesale_cost#12600, ss_list_price#12601, ss_sales_price#12602, ss_ext_discount_amt#12603, ss_ext_sales_price#12604, ss_ext_wholesale_cost#12605, ss_ext_list_price#12606, ss_ext_tax#12607, ss_coupon_amt#12608, ss_net_paid#12609, ss_net_paid_inc_tax#12610, ss_net_profit#12611, ss_sold_date_sk#12612L, d_date_sk#12613L, ... 27 more fields]
               :  :  +- Filter (((outer(c_customer_sk#12550L) = ss_customer_sk#12592L) AND (ss_sold_date_sk#12612L = d_date_sk#12613L)) AND ((d_year#12619 = 1999) AND (d_qoy#12623 < 4)))
               :  :     +- Join Inner
               :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12590L,ss_item_sk#12591L,ss_customer_sk#12592L,ss_cdemo_sk#12593L,ss_hdemo_sk#12594L,ss_addr_sk#12595L,ss_store_sk#12596L,ss_promo_sk#12597L,ss_ticket_number#12598L,ss_quantity#12599,ss_wholesale_cost#12600,ss_list_price#12601,ss_sales_price#12602,ss_ext_discount_amt#12603,ss_ext_sales_price#12604,ss_ext_wholesale_cost#12605,ss_ext_list_price#12606,ss_ext_tax#12607,ss_coupon_amt#12608,ss_net_paid#12609,ss_net_paid_inc_tax#12610,ss_net_profit#12611,ss_sold_date_sk#12612L] orc
               :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12613L,d_date_id#12614,d_date#12615,d_month_seq#12616,d_week_seq#12617,d_quarter_seq#12618,d_year#12619,d_dow#12620,d_moy#12621,d_dom#12622,d_qoy#12623,d_fy_year#12624,d_fy_quarter_seq#12625,d_fy_week_seq#12626,d_day_name#12627,d_quarter_name#12628,d_holiday#12629,d_weekend#12630,d_following_holiday#12631,d_first_dom#12632,d_last_dom#12633,d_same_day_ly#12634,d_same_day_lq#12635,d_current_day#12636,... 4 more fields] orc
               :  :- Project [ws_sold_time_sk#12641L, ws_ship_date_sk#12642L, ws_item_sk#12643L, ws_bill_customer_sk#12644L, ws_bill_cdemo_sk#12645L, ws_bill_hdemo_sk#12646L, ws_bill_addr_sk#12647L, ws_ship_customer_sk#12648L, ws_ship_cdemo_sk#12649L, ws_ship_hdemo_sk#12650L, ws_ship_addr_sk#12651L, ws_web_page_sk#12652L, ws_web_site_sk#12653L, ws_ship_mode_sk#12654L, ws_warehouse_sk#12655L, ws_promo_sk#12656L, ws_order_number#12657L, ws_quantity#12658, ws_wholesale_cost#12659, ws_list_price#12660, ws_sales_price#12661, ws_ext_discount_amt#12662, ws_ext_sales_price#12663, ws_ext_wholesale_cost#12664, ... 38 more fields]
               :  :  +- Filter (((outer(c_customer_sk#12550L) = ws_bill_customer_sk#12644L) AND (ws_sold_date_sk#12674L = d_date_sk#12675L)) AND ((d_year#12681 = 1999) AND (d_qoy#12685 < 4)))
               :  :     +- Join Inner
               :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#12641L,ws_ship_date_sk#12642L,ws_item_sk#12643L,ws_bill_customer_sk#12644L,ws_bill_cdemo_sk#12645L,ws_bill_hdemo_sk#12646L,ws_bill_addr_sk#12647L,ws_ship_customer_sk#12648L,ws_ship_cdemo_sk#12649L,ws_ship_hdemo_sk#12650L,ws_ship_addr_sk#12651L,ws_web_page_sk#12652L,ws_web_site_sk#12653L,ws_ship_mode_sk#12654L,ws_warehouse_sk#12655L,ws_promo_sk#12656L,ws_order_number#12657L,ws_quantity#12658,ws_wholesale_cost#12659,ws_list_price#12660,ws_sales_price#12661,ws_ext_discount_amt#12662,ws_ext_sales_price#12663,ws_ext_wholesale_cost#12664,... 10 more fields] orc
               :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12675L,d_date_id#12676,d_date#12677,d_month_seq#12678,d_week_seq#12679,d_quarter_seq#12680,d_year#12681,d_dow#12682,d_moy#12683,d_dom#12684,d_qoy#12685,d_fy_year#12686,d_fy_quarter_seq#12687,d_fy_week_seq#12688,d_day_name#12689,d_quarter_name#12690,d_holiday#12691,d_weekend#12692,d_following_holiday#12693,d_first_dom#12694,d_last_dom#12695,d_same_day_ly#12696,d_same_day_lq#12697,d_current_day#12698,... 4 more fields] orc
               :  +- Project [cs_sold_time_sk#12703L, cs_ship_date_sk#12704L, cs_bill_customer_sk#12705L, cs_bill_cdemo_sk#12706L, cs_bill_hdemo_sk#12707L, cs_bill_addr_sk#12708L, cs_ship_customer_sk#12709L, cs_ship_cdemo_sk#12710L, cs_ship_hdemo_sk#12711L, cs_ship_addr_sk#12712L, cs_call_center_sk#12713L, cs_catalog_page_sk#12714L, cs_ship_mode_sk#12715L, cs_warehouse_sk#12716L, cs_item_sk#12717L, cs_promo_sk#12718L, cs_order_number#12719L, cs_quantity#12720, cs_wholesale_cost#12721, cs_list_price#12722, cs_sales_price#12723, cs_ext_discount_amt#12724, cs_ext_sales_price#12725, cs_ext_wholesale_cost#12726, ... 38 more fields]
               :     +- Filter (((outer(c_customer_sk#12550L) = cs_ship_customer_sk#12709L) AND (cs_sold_date_sk#12736L = d_date_sk#12737L)) AND ((d_year#12743 = 1999) AND (d_qoy#12747 < 4)))
               :        +- Join Inner
               :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#12703L,cs_ship_date_sk#12704L,cs_bill_customer_sk#12705L,cs_bill_cdemo_sk#12706L,cs_bill_hdemo_sk#12707L,cs_bill_addr_sk#12708L,cs_ship_customer_sk#12709L,cs_ship_cdemo_sk#12710L,cs_ship_hdemo_sk#12711L,cs_ship_addr_sk#12712L,cs_call_center_sk#12713L,cs_catalog_page_sk#12714L,cs_ship_mode_sk#12715L,cs_warehouse_sk#12716L,cs_item_sk#12717L,cs_promo_sk#12718L,cs_order_number#12719L,cs_quantity#12720,cs_wholesale_cost#12721,cs_list_price#12722,cs_sales_price#12723,cs_ext_discount_amt#12724,cs_ext_sales_price#12725,cs_ext_wholesale_cost#12726,... 10 more fields] orc
               :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12737L,d_date_id#12738,d_date#12739,d_month_seq#12740,d_week_seq#12741,d_quarter_seq#12742,d_year#12743,d_dow#12744,d_moy#12745,d_dom#12746,d_qoy#12747,d_fy_year#12748,d_fy_quarter_seq#12749,d_fy_week_seq#12750,d_day_name#12751,d_quarter_name#12752,d_holiday#12753,d_weekend#12754,d_following_holiday#12755,d_first_dom#12756,d_last_dom#12757,d_same_day_ly#12758,d_same_day_lq#12759,d_current_day#12760,... 4 more fields] orc
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias c
                  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12550L,c_customer_id#12551,c_current_cdemo_sk#12552L,c_current_hdemo_sk#12553L,c_current_addr_sk#12554L,c_first_shipto_date_sk#12555L,c_first_sales_date_sk#12556L,c_salutation#12557,c_first_name#12558,c_last_name#12559,c_preferred_cust_flag#12560,c_birth_day#12561,c_birth_month#12562,c_birth_year#12563,c_birth_country#12564,c_login#12565,c_email_address#12566,c_last_review_date#12567] orc
                  :  +- SubqueryAlias ca
                  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12568L,ca_address_id#12569,ca_street_number#12570,ca_street_name#12571,ca_street_type#12572,ca_suite_number#12573,ca_city#12574,ca_county#12575,ca_state#12576,ca_zip#12577,ca_country#12578,ca_gmt_offset#12579,ca_location_type#12580] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#12581L,cd_gender#12582,cd_marital_status#12583,cd_education_status#12584,cd_purchase_estimate#12585,cd_credit_rating#12586,cd_dep_count#12587,cd_dep_employed_count#12588,cd_dep_college_count#12589] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cnt1#12541L, avg(cd_dep_count)#12774, max(cd_dep_count)#12775, sum(cd_dep_count)#12776L, cd_dep_employed_count#12588, cnt2#12542L, avg(cd_dep_employed_count)#12777, max(cd_dep_employed_count)#12778, sum(cd_dep_employed_count)#12779L, cd_dep_college_count#12589, cnt3#12543L, avg(cd_dep_college_count)#12780, max(cd_dep_college_count)#12781, sum(cd_dep_college_count)#12782L]
      +- Sort [ca_state#12576 ASC NULLS FIRST, cd_gender#12582 ASC NULLS FIRST, cd_marital_status#12583 ASC NULLS FIRST, cd_dep_count#12587 ASC NULLS FIRST, cd_dep_employed_count#12588 ASC NULLS FIRST, cd_dep_college_count#12589 ASC NULLS FIRST], true
         +- Aggregate [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589], [ca_state#12576, cd_gender#12582, cd_marital_status#12583, count(1) AS cnt1#12541L, avg(cd_dep_count#12587) AS avg(cd_dep_count)#12774, max(cd_dep_count#12587) AS max(cd_dep_count)#12775, sum(cd_dep_count#12587) AS sum(cd_dep_count)#12776L, cd_dep_employed_count#12588, count(1) AS cnt2#12542L, avg(cd_dep_employed_count#12588) AS avg(cd_dep_employed_count)#12777, max(cd_dep_employed_count#12588) AS max(cd_dep_employed_count)#12778, sum(cd_dep_employed_count#12588) AS sum(cd_dep_employed_count)#12779L, cd_dep_college_count#12589, count(1) AS cnt3#12543L, avg(cd_dep_college_count#12589) AS avg(cd_dep_college_count)#12780, max(cd_dep_college_count#12589) AS max(cd_dep_college_count)#12781, sum(cd_dep_college_count#12589) AS sum(cd_dep_college_count)#12782L, cd_dep_count#12587]
            +- Project [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589]
               +- Join Inner, (cd_demo_sk#12581L = c_current_cdemo_sk#12552L)
                  :- Project [c_current_cdemo_sk#12552L, ca_state#12576]
                  :  +- Join Inner, (c_current_addr_sk#12554L = ca_address_sk#12568L)
                  :     :- Project [c_current_cdemo_sk#12552L, c_current_addr_sk#12554L]
                  :     :  +- Filter (exists#12800 OR exists#12801)
                  :     :     +- Join ExistenceJoin(exists#12801), (c_customer_sk#12550L = cs_ship_customer_sk#12709L)
                  :     :        :- Join ExistenceJoin(exists#12800), (c_customer_sk#12550L = ws_bill_customer_sk#12644L)
                  :     :        :  :- Join LeftSemi, (c_customer_sk#12550L = ss_customer_sk#12592L)
                  :     :        :  :  :- Project [c_customer_sk#12550L, c_current_cdemo_sk#12552L, c_current_addr_sk#12554L]
                  :     :        :  :  :  +- Filter (isnotnull(c_current_addr_sk#12554L) AND isnotnull(c_current_cdemo_sk#12552L))
                  :     :        :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12550L,c_customer_id#12551,c_current_cdemo_sk#12552L,c_current_hdemo_sk#12553L,c_current_addr_sk#12554L,c_first_shipto_date_sk#12555L,c_first_sales_date_sk#12556L,c_salutation#12557,c_first_name#12558,c_last_name#12559,c_preferred_cust_flag#12560,c_birth_day#12561,c_birth_month#12562,c_birth_year#12563,c_birth_country#12564,c_login#12565,c_email_address#12566,c_last_review_date#12567] orc
                  :     :        :  :  +- Project [ss_customer_sk#12592L]
                  :     :        :  :     +- Join Inner, (ss_sold_date_sk#12612L = d_date_sk#12613L)
                  :     :        :  :        :- Project [ss_customer_sk#12592L, ss_sold_date_sk#12612L]
                  :     :        :  :        :  +- Filter (isnotnull(ss_sold_date_sk#12612L) AND dynamicpruning#12802 [ss_sold_date_sk#12612L])
                  :     :        :  :        :     :  +- Project [d_date_sk#12613L]
                  :     :        :  :        :     :     +- Filter (((isnotnull(d_year#12619) AND isnotnull(d_qoy#12623)) AND ((d_year#12619 = 1999) AND (d_qoy#12623 < 4))) AND isnotnull(d_date_sk#12613L))
                  :     :        :  :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12613L,d_date_id#12614,d_date#12615,d_month_seq#12616,d_week_seq#12617,d_quarter_seq#12618,d_year#12619,d_dow#12620,d_moy#12621,d_dom#12622,d_qoy#12623,d_fy_year#12624,d_fy_quarter_seq#12625,d_fy_week_seq#12626,d_day_name#12627,d_quarter_name#12628,d_holiday#12629,d_weekend#12630,d_following_holiday#12631,d_first_dom#12632,d_last_dom#12633,d_same_day_ly#12634,d_same_day_lq#12635,d_current_day#12636,... 4 more fields] orc
                  :     :        :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12590L,ss_item_sk#12591L,ss_customer_sk#12592L,ss_cdemo_sk#12593L,ss_hdemo_sk#12594L,ss_addr_sk#12595L,ss_store_sk#12596L,ss_promo_sk#12597L,ss_ticket_number#12598L,ss_quantity#12599,ss_wholesale_cost#12600,ss_list_price#12601,ss_sales_price#12602,ss_ext_discount_amt#12603,ss_ext_sales_price#12604,ss_ext_wholesale_cost#12605,ss_ext_list_price#12606,ss_ext_tax#12607,ss_coupon_amt#12608,ss_net_paid#12609,ss_net_paid_inc_tax#12610,ss_net_profit#12611,ss_sold_date_sk#12612L] orc
                  :     :        :  :        +- Project [d_date_sk#12613L]
                  :     :        :  :           +- Filter (((isnotnull(d_year#12619) AND isnotnull(d_qoy#12623)) AND ((d_year#12619 = 1999) AND (d_qoy#12623 < 4))) AND isnotnull(d_date_sk#12613L))
                  :     :        :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12613L,d_date_id#12614,d_date#12615,d_month_seq#12616,d_week_seq#12617,d_quarter_seq#12618,d_year#12619,d_dow#12620,d_moy#12621,d_dom#12622,d_qoy#12623,d_fy_year#12624,d_fy_quarter_seq#12625,d_fy_week_seq#12626,d_day_name#12627,d_quarter_name#12628,d_holiday#12629,d_weekend#12630,d_following_holiday#12631,d_first_dom#12632,d_last_dom#12633,d_same_day_ly#12634,d_same_day_lq#12635,d_current_day#12636,... 4 more fields] orc
                  :     :        :  +- Project [ws_bill_customer_sk#12644L]
                  :     :        :     +- Join Inner, (ws_sold_date_sk#12674L = d_date_sk#12675L)
                  :     :        :        :- Project [ws_bill_customer_sk#12644L, ws_sold_date_sk#12674L]
                  :     :        :        :  +- Filter (isnotnull(ws_sold_date_sk#12674L) AND dynamicpruning#12803 [ws_sold_date_sk#12674L])
                  :     :        :        :     :  +- Project [d_date_sk#12675L]
                  :     :        :        :     :     +- Filter (((isnotnull(d_year#12681) AND isnotnull(d_qoy#12685)) AND ((d_year#12681 = 1999) AND (d_qoy#12685 < 4))) AND isnotnull(d_date_sk#12675L))
                  :     :        :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12675L,d_date_id#12676,d_date#12677,d_month_seq#12678,d_week_seq#12679,d_quarter_seq#12680,d_year#12681,d_dow#12682,d_moy#12683,d_dom#12684,d_qoy#12685,d_fy_year#12686,d_fy_quarter_seq#12687,d_fy_week_seq#12688,d_day_name#12689,d_quarter_name#12690,d_holiday#12691,d_weekend#12692,d_following_holiday#12693,d_first_dom#12694,d_last_dom#12695,d_same_day_ly#12696,d_same_day_lq#12697,d_current_day#12698,... 4 more fields] orc
                  :     :        :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#12641L,ws_ship_date_sk#12642L,ws_item_sk#12643L,ws_bill_customer_sk#12644L,ws_bill_cdemo_sk#12645L,ws_bill_hdemo_sk#12646L,ws_bill_addr_sk#12647L,ws_ship_customer_sk#12648L,ws_ship_cdemo_sk#12649L,ws_ship_hdemo_sk#12650L,ws_ship_addr_sk#12651L,ws_web_page_sk#12652L,ws_web_site_sk#12653L,ws_ship_mode_sk#12654L,ws_warehouse_sk#12655L,ws_promo_sk#12656L,ws_order_number#12657L,ws_quantity#12658,ws_wholesale_cost#12659,ws_list_price#12660,ws_sales_price#12661,ws_ext_discount_amt#12662,ws_ext_sales_price#12663,ws_ext_wholesale_cost#12664,... 10 more fields] orc
                  :     :        :        +- Project [d_date_sk#12675L]
                  :     :        :           +- Filter (((isnotnull(d_year#12681) AND isnotnull(d_qoy#12685)) AND ((d_year#12681 = 1999) AND (d_qoy#12685 < 4))) AND isnotnull(d_date_sk#12675L))
                  :     :        :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12675L,d_date_id#12676,d_date#12677,d_month_seq#12678,d_week_seq#12679,d_quarter_seq#12680,d_year#12681,d_dow#12682,d_moy#12683,d_dom#12684,d_qoy#12685,d_fy_year#12686,d_fy_quarter_seq#12687,d_fy_week_seq#12688,d_day_name#12689,d_quarter_name#12690,d_holiday#12691,d_weekend#12692,d_following_holiday#12693,d_first_dom#12694,d_last_dom#12695,d_same_day_ly#12696,d_same_day_lq#12697,d_current_day#12698,... 4 more fields] orc
                  :     :        +- Project [cs_ship_customer_sk#12709L]
                  :     :           +- Join Inner, (cs_sold_date_sk#12736L = d_date_sk#12737L)
                  :     :              :- Project [cs_ship_customer_sk#12709L, cs_sold_date_sk#12736L]
                  :     :              :  +- Filter (isnotnull(cs_sold_date_sk#12736L) AND dynamicpruning#12804 [cs_sold_date_sk#12736L])
                  :     :              :     :  +- Project [d_date_sk#12737L]
                  :     :              :     :     +- Filter (((isnotnull(d_year#12743) AND isnotnull(d_qoy#12747)) AND ((d_year#12743 = 1999) AND (d_qoy#12747 < 4))) AND isnotnull(d_date_sk#12737L))
                  :     :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12737L,d_date_id#12738,d_date#12739,d_month_seq#12740,d_week_seq#12741,d_quarter_seq#12742,d_year#12743,d_dow#12744,d_moy#12745,d_dom#12746,d_qoy#12747,d_fy_year#12748,d_fy_quarter_seq#12749,d_fy_week_seq#12750,d_day_name#12751,d_quarter_name#12752,d_holiday#12753,d_weekend#12754,d_following_holiday#12755,d_first_dom#12756,d_last_dom#12757,d_same_day_ly#12758,d_same_day_lq#12759,d_current_day#12760,... 4 more fields] orc
                  :     :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#12703L,cs_ship_date_sk#12704L,cs_bill_customer_sk#12705L,cs_bill_cdemo_sk#12706L,cs_bill_hdemo_sk#12707L,cs_bill_addr_sk#12708L,cs_ship_customer_sk#12709L,cs_ship_cdemo_sk#12710L,cs_ship_hdemo_sk#12711L,cs_ship_addr_sk#12712L,cs_call_center_sk#12713L,cs_catalog_page_sk#12714L,cs_ship_mode_sk#12715L,cs_warehouse_sk#12716L,cs_item_sk#12717L,cs_promo_sk#12718L,cs_order_number#12719L,cs_quantity#12720,cs_wholesale_cost#12721,cs_list_price#12722,cs_sales_price#12723,cs_ext_discount_amt#12724,cs_ext_sales_price#12725,cs_ext_wholesale_cost#12726,... 10 more fields] orc
                  :     :              +- Project [d_date_sk#12737L]
                  :     :                 +- Filter (((isnotnull(d_year#12743) AND isnotnull(d_qoy#12747)) AND ((d_year#12743 = 1999) AND (d_qoy#12747 < 4))) AND isnotnull(d_date_sk#12737L))
                  :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12737L,d_date_id#12738,d_date#12739,d_month_seq#12740,d_week_seq#12741,d_quarter_seq#12742,d_year#12743,d_dow#12744,d_moy#12745,d_dom#12746,d_qoy#12747,d_fy_year#12748,d_fy_quarter_seq#12749,d_fy_week_seq#12750,d_day_name#12751,d_quarter_name#12752,d_holiday#12753,d_weekend#12754,d_following_holiday#12755,d_first_dom#12756,d_last_dom#12757,d_same_day_ly#12758,d_same_day_lq#12759,d_current_day#12760,... 4 more fields] orc
                  :     +- Project [ca_address_sk#12568L, ca_state#12576]
                  :        +- Filter isnotnull(ca_address_sk#12568L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12568L,ca_address_id#12569,ca_street_number#12570,ca_street_name#12571,ca_street_type#12572,ca_suite_number#12573,ca_city#12574,ca_county#12575,ca_state#12576,ca_zip#12577,ca_country#12578,ca_gmt_offset#12579,ca_location_type#12580] orc
                  +- Project [cd_demo_sk#12581L, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589]
                     +- Filter isnotnull(cd_demo_sk#12581L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#12581L,cd_gender#12582,cd_marital_status#12583,cd_education_status#12584,cd_purchase_estimate#12585,cd_credit_rating#12586,cd_dep_count#12587,cd_dep_employed_count#12588,cd_dep_college_count#12589] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ca_state#12576 ASC NULLS FIRST,cd_gender#12582 ASC NULLS FIRST,cd_marital_status#12583 ASC NULLS FIRST,cd_dep_count#12587 ASC NULLS FIRST,cd_dep_employed_count#12588 ASC NULLS FIRST,cd_dep_college_count#12589 ASC NULLS FIRST], output=[ca_state#12576,cd_gender#12582,cd_marital_status#12583,cnt1#12541L,avg(cd_dep_count)#12774,max(cd_dep_count)#12775,sum(cd_dep_count)#12776L,cd_dep_employed_count#12588,cnt2#12542L,avg(cd_dep_employed_count)#12777,max(cd_dep_employed_count)#12778,sum(cd_dep_employed_count)#12779L,cd_dep_college_count#12589,cnt3#12543L,avg(cd_dep_college_count)#12780,max(cd_dep_college_count)#12781,sum(cd_dep_college_count)#12782L])
   +- HashAggregate(keys=[ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589], functions=[count(1), avg(cd_dep_count#12587), max(cd_dep_count#12587), sum(cd_dep_count#12587), avg(cd_dep_employed_count#12588), max(cd_dep_employed_count#12588), sum(cd_dep_employed_count#12588), avg(cd_dep_college_count#12589), max(cd_dep_college_count#12589), sum(cd_dep_college_count#12589)], output=[ca_state#12576, cd_gender#12582, cd_marital_status#12583, cnt1#12541L, avg(cd_dep_count)#12774, max(cd_dep_count)#12775, sum(cd_dep_count)#12776L, cd_dep_employed_count#12588, cnt2#12542L, avg(cd_dep_employed_count)#12777, max(cd_dep_employed_count)#12778, sum(cd_dep_employed_count)#12779L, cd_dep_college_count#12589, cnt3#12543L, avg(cd_dep_college_count)#12780, max(cd_dep_college_count)#12781, sum(cd_dep_college_count)#12782L, cd_dep_count#12587])
      +- Exchange hashpartitioning(ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589, 3000), ENSURE_REQUIREMENTS, [id=#13375]
         +- HashAggregate(keys=[ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589], functions=[partial_count(1), partial_avg(cd_dep_count#12587), partial_max(cd_dep_count#12587), partial_sum(cd_dep_count#12587), partial_avg(cd_dep_employed_count#12588), partial_max(cd_dep_employed_count#12588), partial_sum(cd_dep_employed_count#12588), partial_avg(cd_dep_college_count#12589), partial_max(cd_dep_college_count#12589), partial_sum(cd_dep_college_count#12589)], output=[ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589, count#12818L, sum#12819, count#12820L, max#12821, sum#12822L, sum#12823, count#12824L, max#12825, sum#12826L, sum#12827, count#12828L, max#12829, sum#12830L])
            +- Project [ca_state#12576, cd_gender#12582, cd_marital_status#12583, cd_dep_count#12587, cd_dep_employed_count#12588, cd_dep_college_count#12589]
               +- SortMergeJoin [c_current_cdemo_sk#12552L], [cd_demo_sk#12581L], Inner
                  :- Sort [c_current_cdemo_sk#12552L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(c_current_cdemo_sk#12552L, 3000), ENSURE_REQUIREMENTS, [id=#13367]
                  :     +- Project [c_current_cdemo_sk#12552L, ca_state#12576]
                  :        +- SortMergeJoin [c_current_addr_sk#12554L], [ca_address_sk#12568L], Inner
                  :           :- Sort [c_current_addr_sk#12554L ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(c_current_addr_sk#12554L, 3000), ENSURE_REQUIREMENTS, [id=#13359]
                  :           :     +- Project [c_current_cdemo_sk#12552L, c_current_addr_sk#12554L]
                  :           :        +- Filter (exists#12800 OR exists#12801)
                  :           :           +- SortMergeJoin [c_customer_sk#12550L], [cs_ship_customer_sk#12709L], ExistenceJoin(exists#12801)
                  :           :              :- SortMergeJoin [c_customer_sk#12550L], [ws_bill_customer_sk#12644L], ExistenceJoin(exists#12800)
                  :           :              :  :- SortMergeJoin [c_customer_sk#12550L], [ss_customer_sk#12592L], LeftSemi
                  :           :              :  :  :- Sort [c_customer_sk#12550L ASC NULLS FIRST], false, 0
                  :           :              :  :  :  +- Exchange hashpartitioning(c_customer_sk#12550L, 3000), ENSURE_REQUIREMENTS, [id=#13334]
                  :           :              :  :  :     +- Filter (isnotnull(c_current_addr_sk#12554L) AND isnotnull(c_current_cdemo_sk#12552L))
                  :           :              :  :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#12550L,c_current_cdemo_sk#12552L,c_current_addr_sk#12554L] Batched: true, DataFilters: [isnotnull(c_current_addr_sk#12554L), isnotnull(c_current_cdemo_sk#12552L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_addr_sk:bigint>
                  :           :              :  :  +- Sort [ss_customer_sk#12592L ASC NULLS FIRST], false, 0
                  :           :              :  :     +- Exchange hashpartitioning(ss_customer_sk#12592L, 3000), ENSURE_REQUIREMENTS, [id=#13335]
                  :           :              :  :        +- Project [ss_customer_sk#12592L]
                  :           :              :  :           +- BroadcastHashJoin [ss_sold_date_sk#12612L], [d_date_sk#12613L], Inner, BuildRight, false
                  :           :              :  :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#12592L,ss_sold_date_sk#12612L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#12612L), dynamicpruningexpression(ss_sold_date_sk#12612L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<ss_customer_sk:bigint>
                  :           :              :  :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#12802, 0, true, Project [d_date_sk#12613L], [d_date_sk#12613L]
                  :           :              :  :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :              :  :              :           +- Project [d_date_sk#12613L]
                  :           :              :  :              :              +- Filter ((((isnotnull(d_year#12619) AND isnotnull(d_qoy#12623)) AND (d_year#12619 = 1999)) AND (d_qoy#12623 < 4)) AND isnotnull(d_date_sk#12613L))
                  :           :              :  :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12613L,d_year#12619,d_qoy#12623] Batched: true, DataFilters: [isnotnull(d_year#12619), isnotnull(d_qoy#12623), (d_year#12619 = 1999), (d_qoy#12623 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :              :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13329]
                  :           :              :  :                 +- Project [d_date_sk#12613L]
                  :           :              :  :                    +- Filter ((((isnotnull(d_year#12619) AND isnotnull(d_qoy#12623)) AND (d_year#12619 = 1999)) AND (d_qoy#12623 < 4)) AND isnotnull(d_date_sk#12613L))
                  :           :              :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12613L,d_year#12619,d_qoy#12623] Batched: true, DataFilters: [isnotnull(d_year#12619), isnotnull(d_qoy#12623), (d_year#12619 = 1999), (d_qoy#12623 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :              :  +- Sort [ws_bill_customer_sk#12644L ASC NULLS FIRST], false, 0
                  :           :              :     +- Exchange hashpartitioning(ws_bill_customer_sk#12644L, 3000), ENSURE_REQUIREMENTS, [id=#13344]
                  :           :              :        +- Project [ws_bill_customer_sk#12644L]
                  :           :              :           +- BroadcastHashJoin [ws_sold_date_sk#12674L], [d_date_sk#12675L], Inner, BuildRight, false
                  :           :              :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#12644L,ws_sold_date_sk#12674L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#12674L), dynamicpruningexpression(ws_sold_date_sk#12674L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:bigint>
                  :           :              :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#12803, 0, true, Project [d_date_sk#12675L], [d_date_sk#12675L]
                  :           :              :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :              :              :           +- Project [d_date_sk#12675L]
                  :           :              :              :              +- Filter ((((isnotnull(d_year#12681) AND isnotnull(d_qoy#12685)) AND (d_year#12681 = 1999)) AND (d_qoy#12685 < 4)) AND isnotnull(d_date_sk#12675L))
                  :           :              :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12675L,d_year#12681,d_qoy#12685] Batched: true, DataFilters: [isnotnull(d_year#12681), isnotnull(d_qoy#12685), (d_year#12681 = 1999), (d_qoy#12685 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :              :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13339]
                  :           :              :                 +- Project [d_date_sk#12675L]
                  :           :              :                    +- Filter ((((isnotnull(d_year#12681) AND isnotnull(d_qoy#12685)) AND (d_year#12681 = 1999)) AND (d_qoy#12685 < 4)) AND isnotnull(d_date_sk#12675L))
                  :           :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12675L,d_year#12681,d_qoy#12685] Batched: true, DataFilters: [isnotnull(d_year#12681), isnotnull(d_qoy#12685), (d_year#12681 = 1999), (d_qoy#12685 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :              +- Sort [cs_ship_customer_sk#12709L ASC NULLS FIRST], false, 0
                  :           :                 +- Exchange hashpartitioning(cs_ship_customer_sk#12709L, 3000), ENSURE_REQUIREMENTS, [id=#13352]
                  :           :                    +- Project [cs_ship_customer_sk#12709L]
                  :           :                       +- BroadcastHashJoin [cs_sold_date_sk#12736L], [d_date_sk#12737L], Inner, BuildRight, false
                  :           :                          :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_customer_sk#12709L,cs_sold_date_sk#12736L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#12736L), dynamicpruningexpression(cs_sold_date_sk#12736L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:bigint>
                  :           :                          :     +- SubqueryAdaptiveBroadcast dynamicpruning#12804, 0, true, Project [d_date_sk#12737L], [d_date_sk#12737L]
                  :           :                          :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :                          :           +- Project [d_date_sk#12737L]
                  :           :                          :              +- Filter ((((isnotnull(d_year#12743) AND isnotnull(d_qoy#12747)) AND (d_year#12743 = 1999)) AND (d_qoy#12747 < 4)) AND isnotnull(d_date_sk#12737L))
                  :           :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12737L,d_year#12743,d_qoy#12747] Batched: true, DataFilters: [isnotnull(d_year#12743), isnotnull(d_qoy#12747), (d_year#12743 = 1999), (d_qoy#12747 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13347]
                  :           :                             +- Project [d_date_sk#12737L]
                  :           :                                +- Filter ((((isnotnull(d_year#12743) AND isnotnull(d_qoy#12747)) AND (d_year#12743 = 1999)) AND (d_qoy#12747 < 4)) AND isnotnull(d_date_sk#12737L))
                  :           :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12737L,d_year#12743,d_qoy#12747] Batched: true, DataFilters: [isnotnull(d_year#12743), isnotnull(d_qoy#12747), (d_year#12743 = 1999), (d_qoy#12747 < 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,1999), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                  :           +- Sort [ca_address_sk#12568L ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(ca_address_sk#12568L, 3000), ENSURE_REQUIREMENTS, [id=#13360]
                  :                 +- Filter isnotnull(ca_address_sk#12568L)
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#12568L,ca_state#12576] Batched: true, DataFilters: [isnotnull(ca_address_sk#12568L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                  +- Sort [cd_demo_sk#12581L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cd_demo_sk#12581L, 3000), ENSURE_REQUIREMENTS, [id=#13368]
                        +- Filter isnotnull(cd_demo_sk#12581L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#12581L,cd_gender#12582,cd_marital_status#12583,cd_dep_count#12587,cd_dep_employed_count#12588,cd_dep_college_count#12589] Batched: true, DataFilters: [isnotnull(cd_demo_sk#12581L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_dep_count:int,cd_dep_employ...

read query: spark_queries/q36.sql
explain query: q36
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 'i_category END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), 'i_category, 'i_class)], [('sum('ss_net_profit) / 'sum('ss_ext_sales_price)) AS gross_margin#12831, 'i_category, 'i_class, ('grouping('i_category) + 'grouping('i_class)) AS lochierarchy#12832, 'rank() windowspecdefinition(('grouping('i_category) + 'grouping('i_class)), CASE WHEN ('grouping('i_class) = 0) THEN 'i_category END, ('sum('ss_net_profit) / 'sum('ss_ext_sales_price)) ASC NULLS FIRST, unspecifiedframe$()) AS rank_within_parent#12833]
         +- 'Filter (((('d1.d_year = 1999) AND ('d1.d_date_sk = 'ss_sold_date_sk)) AND ('i_item_sk = 'ss_item_sk)) AND (('s_store_sk = 'ss_store_sk) AND 's_state IN (SD,FL,MI,LA,MO,SC,AL,GA)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  +- 'SubqueryAlias d1
               :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
gross_margin: double, i_category: string, i_class: string, lochierarchy: tinyint, rank_within_parent: int
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#12832 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#12832 as int) = 0) THEN i_category#12945 END ASC NULLS FIRST, rank_within_parent#12833 ASC NULLS FIRST], true
      +- Project [gross_margin#12831, i_category#12945, i_class#12946, lochierarchy#12832, rank_within_parent#12833]
         +- Project [gross_margin#12831, i_category#12945, i_class#12946, lochierarchy#12832, _w0#12955, _w1#12959, _w2#12960, _w3#12961, rank_within_parent#12833, rank_within_parent#12833]
            +- Window [rank(_w3#12961) windowspecdefinition(_w1#12959, _w2#12960, _w3#12961 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#12833], [_w1#12959, _w2#12960], [_w3#12961 ASC NULLS FIRST]
               +- Aggregate [i_category#12945, i_class#12946, spark_grouping_id#12944L], [(sum(ss_net_profit#12857) / sum(ss_ext_sales_price#12850)) AS gross_margin#12831, i_category#12945, i_class#12946, (cast((shiftright(spark_grouping_id#12944L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint)) AS lochierarchy#12832, (sum(ss_net_profit#12857) / sum(ss_ext_sales_price#12850)) AS _w0#12955, (cast((shiftright(spark_grouping_id#12944L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint)) AS _w1#12959, CASE WHEN (cast(cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint) as int) = 0) THEN i_category#12945 END AS _w2#12960, (sum(ss_net_profit#12857) / sum(ss_ext_sales_price#12850)) AS _w3#12961]
                  +- Expand [[ss_sold_time_sk#12836L, ss_item_sk#12837L, ss_customer_sk#12838L, ss_cdemo_sk#12839L, ss_hdemo_sk#12840L, ss_addr_sk#12841L, ss_store_sk#12842L, ss_promo_sk#12843L, ss_ticket_number#12844L, ss_quantity#12845, ss_wholesale_cost#12846, ss_list_price#12847, ss_sales_price#12848, ss_ext_discount_amt#12849, ss_ext_sales_price#12850, ss_ext_wholesale_cost#12851, ss_ext_list_price#12852, ss_ext_tax#12853, ss_coupon_amt#12854, ss_net_paid#12855, ss_net_paid_inc_tax#12856, ss_net_profit#12857, ss_sold_date_sk#12858L, d_date_sk#12859L, ... 81 more fields], [ss_sold_time_sk#12836L, ss_item_sk#12837L, ss_customer_sk#12838L, ss_cdemo_sk#12839L, ss_hdemo_sk#12840L, ss_addr_sk#12841L, ss_store_sk#12842L, ss_promo_sk#12843L, ss_ticket_number#12844L, ss_quantity#12845, ss_wholesale_cost#12846, ss_list_price#12847, ss_sales_price#12848, ss_ext_discount_amt#12849, ss_ext_sales_price#12850, ss_ext_wholesale_cost#12851, ss_ext_list_price#12852, ss_ext_tax#12853, ss_coupon_amt#12854, ss_net_paid#12855, ss_net_paid_inc_tax#12856, ss_net_profit#12857, ss_sold_date_sk#12858L, d_date_sk#12859L, ... 81 more fields], [ss_sold_time_sk#12836L, ss_item_sk#12837L, ss_customer_sk#12838L, ss_cdemo_sk#12839L, ss_hdemo_sk#12840L, ss_addr_sk#12841L, ss_store_sk#12842L, ss_promo_sk#12843L, ss_ticket_number#12844L, ss_quantity#12845, ss_wholesale_cost#12846, ss_list_price#12847, ss_sales_price#12848, ss_ext_discount_amt#12849, ss_ext_sales_price#12850, ss_ext_wholesale_cost#12851, ss_ext_list_price#12852, ss_ext_tax#12853, ss_coupon_amt#12854, ss_net_paid#12855, ss_net_paid_inc_tax#12856, ss_net_profit#12857, ss_sold_date_sk#12858L, d_date_sk#12859L, ... 81 more fields]], [ss_sold_time_sk#12836L, ss_item_sk#12837L, ss_customer_sk#12838L, ss_cdemo_sk#12839L, ss_hdemo_sk#12840L, ss_addr_sk#12841L, ss_store_sk#12842L, ss_promo_sk#12843L, ss_ticket_number#12844L, ss_quantity#12845, ss_wholesale_cost#12846, ss_list_price#12847, ss_sales_price#12848, ss_ext_discount_amt#12849, ss_ext_sales_price#12850, ss_ext_wholesale_cost#12851, ss_ext_list_price#12852, ss_ext_tax#12853, ss_coupon_amt#12854, ss_net_paid#12855, ss_net_paid_inc_tax#12856, ss_net_profit#12857, ss_sold_date_sk#12858L, d_date_sk#12859L, ... 81 more fields]
                     +- Project [ss_sold_time_sk#12836L, ss_item_sk#12837L, ss_customer_sk#12838L, ss_cdemo_sk#12839L, ss_hdemo_sk#12840L, ss_addr_sk#12841L, ss_store_sk#12842L, ss_promo_sk#12843L, ss_ticket_number#12844L, ss_quantity#12845, ss_wholesale_cost#12846, ss_list_price#12847, ss_sales_price#12848, ss_ext_discount_amt#12849, ss_ext_sales_price#12850, ss_ext_wholesale_cost#12851, ss_ext_list_price#12852, ss_ext_tax#12853, ss_coupon_amt#12854, ss_net_paid#12855, ss_net_paid_inc_tax#12856, ss_net_profit#12857, ss_sold_date_sk#12858L, d_date_sk#12859L, ... 80 more fields]
                        +- Filter ((((d_year#12865 = 1999) AND (d_date_sk#12859L = ss_sold_date_sk#12858L)) AND (i_item_sk#12887L = ss_item_sk#12837L)) AND ((s_store_sk#12909L = ss_store_sk#12842L) AND s_state#12933 IN (SD,FL,MI,LA,MO,SC,AL,GA)))
                           +- Join Inner
                              :- Join Inner
                              :  :- Join Inner
                              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12836L,ss_item_sk#12837L,ss_customer_sk#12838L,ss_cdemo_sk#12839L,ss_hdemo_sk#12840L,ss_addr_sk#12841L,ss_store_sk#12842L,ss_promo_sk#12843L,ss_ticket_number#12844L,ss_quantity#12845,ss_wholesale_cost#12846,ss_list_price#12847,ss_sales_price#12848,ss_ext_discount_amt#12849,ss_ext_sales_price#12850,ss_ext_wholesale_cost#12851,ss_ext_list_price#12852,ss_ext_tax#12853,ss_coupon_amt#12854,ss_net_paid#12855,ss_net_paid_inc_tax#12856,ss_net_profit#12857,ss_sold_date_sk#12858L] orc
                              :  :  +- SubqueryAlias d1
                              :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12859L,d_date_id#12860,d_date#12861,d_month_seq#12862,d_week_seq#12863,d_quarter_seq#12864,d_year#12865,d_dow#12866,d_moy#12867,d_dom#12868,d_qoy#12869,d_fy_year#12870,d_fy_quarter_seq#12871,d_fy_week_seq#12872,d_day_name#12873,d_quarter_name#12874,d_holiday#12875,d_weekend#12876,d_following_holiday#12877,d_first_dom#12878,d_last_dom#12879,d_same_day_ly#12880,d_same_day_lq#12881,d_current_day#12882,... 4 more fields] orc
                              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12887L,i_item_id#12888,i_rec_start_date#12889,i_rec_end_date#12890,i_item_desc#12891,i_current_price#12892,i_wholesale_cost#12893,i_brand_id#12894,i_brand#12895,i_class_id#12896,i_class#12897,i_category_id#12898,i_category#12899,i_manufact_id#12900,i_manufact#12901,i_size#12902,i_formulation#12903,i_color#12904,i_units#12905,i_container#12906,i_manager_id#12907,i_product_name#12908] orc
                              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12909L,s_store_id#12910,s_rec_start_date#12911,s_rec_end_date#12912,s_closed_date_sk#12913L,s_store_name#12914,s_number_employees#12915,s_floor_space#12916,s_hours#12917,s_manager#12918,s_market_id#12919,s_geography_class#12920,s_market_desc#12921,s_market_manager#12922,s_division_id#12923,s_division_name#12924,s_company_id#12925,s_company_name#12926,s_street_number#12927,s_street_name#12928,s_street_type#12929,s_suite_number#12930,s_city#12931,s_county#12932,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#12832 DESC NULLS LAST, CASE WHEN (lochierarchy#12832 = 0) THEN i_category#12945 END ASC NULLS FIRST, rank_within_parent#12833 ASC NULLS FIRST], true
      +- Project [gross_margin#12831, i_category#12945, i_class#12946, lochierarchy#12832, rank_within_parent#12833]
         +- Window [rank(_w3#12961) windowspecdefinition(_w1#12959, _w2#12960, _w3#12961 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#12833], [_w1#12959, _w2#12960], [_w3#12961 ASC NULLS FIRST]
            +- Aggregate [i_category#12945, i_class#12946, spark_grouping_id#12944L], [(sum(ss_net_profit#12857) / sum(ss_ext_sales_price#12850)) AS gross_margin#12831, i_category#12945, i_class#12946, (cast((shiftright(spark_grouping_id#12944L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint)) AS lochierarchy#12832, (cast((shiftright(spark_grouping_id#12944L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint)) AS _w1#12959, CASE WHEN (cast((shiftright(spark_grouping_id#12944L, 0) & 1) as tinyint) = 0) THEN i_category#12945 END AS _w2#12960, (sum(ss_net_profit#12857) / sum(ss_ext_sales_price#12850)) AS _w3#12961]
               +- Expand [[ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, i_class#12897, 0], [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, null, 1], [ss_ext_sales_price#12850, ss_net_profit#12857, null, null, 3]], [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12945, i_class#12946, spark_grouping_id#12944L]
                  +- Project [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, i_class#12897]
                     +- Join Inner, (i_item_sk#12887L = ss_item_sk#12837L)
                        :- Project [ss_item_sk#12837L, ss_ext_sales_price#12850, ss_net_profit#12857]
                        :  +- Join Inner, (s_store_sk#12909L = ss_store_sk#12842L)
                        :     :- Project [ss_item_sk#12837L, ss_store_sk#12842L, ss_ext_sales_price#12850, ss_net_profit#12857]
                        :     :  +- Join Inner, (d_date_sk#12859L = ss_sold_date_sk#12858L)
                        :     :     :- Project [ss_item_sk#12837L, ss_store_sk#12842L, ss_ext_sales_price#12850, ss_net_profit#12857, ss_sold_date_sk#12858L]
                        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#12858L) AND isnotnull(ss_item_sk#12837L)) AND isnotnull(ss_store_sk#12842L)) AND dynamicpruning#12973 [ss_sold_date_sk#12858L])
                        :     :     :     :  +- Project [d_date_sk#12859L]
                        :     :     :     :     +- Filter ((isnotnull(d_year#12865) AND (d_year#12865 = 1999)) AND isnotnull(d_date_sk#12859L))
                        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12859L,d_date_id#12860,d_date#12861,d_month_seq#12862,d_week_seq#12863,d_quarter_seq#12864,d_year#12865,d_dow#12866,d_moy#12867,d_dom#12868,d_qoy#12869,d_fy_year#12870,d_fy_quarter_seq#12871,d_fy_week_seq#12872,d_day_name#12873,d_quarter_name#12874,d_holiday#12875,d_weekend#12876,d_following_holiday#12877,d_first_dom#12878,d_last_dom#12879,d_same_day_ly#12880,d_same_day_lq#12881,d_current_day#12882,... 4 more fields] orc
                        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#12836L,ss_item_sk#12837L,ss_customer_sk#12838L,ss_cdemo_sk#12839L,ss_hdemo_sk#12840L,ss_addr_sk#12841L,ss_store_sk#12842L,ss_promo_sk#12843L,ss_ticket_number#12844L,ss_quantity#12845,ss_wholesale_cost#12846,ss_list_price#12847,ss_sales_price#12848,ss_ext_discount_amt#12849,ss_ext_sales_price#12850,ss_ext_wholesale_cost#12851,ss_ext_list_price#12852,ss_ext_tax#12853,ss_coupon_amt#12854,ss_net_paid#12855,ss_net_paid_inc_tax#12856,ss_net_profit#12857,ss_sold_date_sk#12858L] orc
                        :     :     +- Project [d_date_sk#12859L]
                        :     :        +- Filter ((isnotnull(d_year#12865) AND (d_year#12865 = 1999)) AND isnotnull(d_date_sk#12859L))
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12859L,d_date_id#12860,d_date#12861,d_month_seq#12862,d_week_seq#12863,d_quarter_seq#12864,d_year#12865,d_dow#12866,d_moy#12867,d_dom#12868,d_qoy#12869,d_fy_year#12870,d_fy_quarter_seq#12871,d_fy_week_seq#12872,d_day_name#12873,d_quarter_name#12874,d_holiday#12875,d_weekend#12876,d_following_holiday#12877,d_first_dom#12878,d_last_dom#12879,d_same_day_ly#12880,d_same_day_lq#12881,d_current_day#12882,... 4 more fields] orc
                        :     +- Project [s_store_sk#12909L]
                        :        +- Filter (s_state#12933 IN (SD,FL,MI,LA,MO,SC,AL,GA) AND isnotnull(s_store_sk#12909L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12909L,s_store_id#12910,s_rec_start_date#12911,s_rec_end_date#12912,s_closed_date_sk#12913L,s_store_name#12914,s_number_employees#12915,s_floor_space#12916,s_hours#12917,s_manager#12918,s_market_id#12919,s_geography_class#12920,s_market_desc#12921,s_market_manager#12922,s_division_id#12923,s_division_name#12924,s_company_id#12925,s_company_name#12926,s_street_number#12927,s_street_name#12928,s_street_type#12929,s_suite_number#12930,s_city#12931,s_county#12932,... 5 more fields] orc
                        +- Project [i_item_sk#12887L, i_class#12897, i_category#12899]
                           +- Filter isnotnull(i_item_sk#12887L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12887L,i_item_id#12888,i_rec_start_date#12889,i_rec_end_date#12890,i_item_desc#12891,i_current_price#12892,i_wholesale_cost#12893,i_brand_id#12894,i_brand#12895,i_class_id#12896,i_class#12897,i_category_id#12898,i_category#12899,i_manufact_id#12900,i_manufact#12901,i_size#12902,i_formulation#12903,i_color#12904,i_units#12905,i_container#12906,i_manager_id#12907,i_product_name#12908] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#12832 DESC NULLS LAST,CASE WHEN (lochierarchy#12832 = 0) THEN i_category#12945 END ASC NULLS FIRST,rank_within_parent#12833 ASC NULLS FIRST], output=[gross_margin#12831,i_category#12945,i_class#12946,lochierarchy#12832,rank_within_parent#12833])
   +- Project [gross_margin#12831, i_category#12945, i_class#12946, lochierarchy#12832, rank_within_parent#12833]
      +- Window [rank(_w3#12961) windowspecdefinition(_w1#12959, _w2#12960, _w3#12961 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#12833], [_w1#12959, _w2#12960], [_w3#12961 ASC NULLS FIRST]
         +- Sort [_w1#12959 ASC NULLS FIRST, _w2#12960 ASC NULLS FIRST, _w3#12961 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(_w1#12959, _w2#12960, 3000), ENSURE_REQUIREMENTS, [id=#13510]
               +- HashAggregate(keys=[i_category#12945, i_class#12946, spark_grouping_id#12944L], functions=[sum(ss_net_profit#12857), sum(ss_ext_sales_price#12850)], output=[gross_margin#12831, i_category#12945, i_class#12946, lochierarchy#12832, _w1#12959, _w2#12960, _w3#12961])
                  +- Exchange hashpartitioning(i_category#12945, i_class#12946, spark_grouping_id#12944L, 3000), ENSURE_REQUIREMENTS, [id=#13507]
                     +- HashAggregate(keys=[i_category#12945, i_class#12946, spark_grouping_id#12944L], functions=[partial_sum(ss_net_profit#12857), partial_sum(ss_ext_sales_price#12850)], output=[i_category#12945, i_class#12946, spark_grouping_id#12944L, sum#12976, sum#12977])
                        +- Expand [[ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, i_class#12897, 0], [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, null, 1], [ss_ext_sales_price#12850, ss_net_profit#12857, null, null, 3]], [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12945, i_class#12946, spark_grouping_id#12944L]
                           +- Project [ss_ext_sales_price#12850, ss_net_profit#12857, i_category#12899, i_class#12897]
                              +- SortMergeJoin [ss_item_sk#12837L], [i_item_sk#12887L], Inner
                                 :- Sort [ss_item_sk#12837L ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(ss_item_sk#12837L, 3000), ENSURE_REQUIREMENTS, [id=#13498]
                                 :     +- Project [ss_item_sk#12837L, ss_ext_sales_price#12850, ss_net_profit#12857]
                                 :        +- BroadcastHashJoin [ss_store_sk#12842L], [s_store_sk#12909L], Inner, BuildRight, false
                                 :           :- Project [ss_item_sk#12837L, ss_store_sk#12842L, ss_ext_sales_price#12850, ss_net_profit#12857]
                                 :           :  +- BroadcastHashJoin [ss_sold_date_sk#12858L], [d_date_sk#12859L], Inner, BuildRight, false
                                 :           :     :- Filter (isnotnull(ss_item_sk#12837L) AND isnotnull(ss_store_sk#12842L))
                                 :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#12837L,ss_store_sk#12842L,ss_ext_sales_price#12850,ss_net_profit#12857,ss_sold_date_sk#12858L] Batched: true, DataFilters: [isnotnull(ss_item_sk#12837L), isnotnull(ss_store_sk#12842L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#12858L), dynamicpruningexpression(ss_sold_date_sk#12858L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_ext_sales_price:double,ss_net_profit:double>
                                 :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#12973, 0, true, Project [d_date_sk#12859L], [d_date_sk#12859L]
                                 :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                 :           :     :              +- Project [d_date_sk#12859L]
                                 :           :     :                 +- Filter ((isnotnull(d_year#12865) AND (d_year#12865 = 1999)) AND isnotnull(d_date_sk#12859L))
                                 :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12859L,d_year#12865] Batched: true, DataFilters: [isnotnull(d_year#12865), (d_year#12865 = 1999), isnotnull(d_date_sk#12859L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13489]
                                 :           :        +- Project [d_date_sk#12859L]
                                 :           :           +- Filter ((isnotnull(d_year#12865) AND (d_year#12865 = 1999)) AND isnotnull(d_date_sk#12859L))
                                 :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#12859L,d_year#12865] Batched: true, DataFilters: [isnotnull(d_year#12865), (d_year#12865 = 1999), isnotnull(d_date_sk#12859L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13493]
                                 :              +- Project [s_store_sk#12909L]
                                 :                 +- Filter (s_state#12933 IN (SD,FL,MI,LA,MO,SC,AL,GA) AND isnotnull(s_store_sk#12909L))
                                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#12909L,s_state#12933] Batched: true, DataFilters: [s_state#12933 IN (SD,FL,MI,LA,MO,SC,AL,GA), isnotnull(s_store_sk#12909L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_state, [AL,FL,GA,LA,MI,MO,SC,SD]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_state:string>
                                 +- Sort [i_item_sk#12887L ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(i_item_sk#12887L, 3000), ENSURE_REQUIREMENTS, [id=#13499]
                                       +- Filter isnotnull(i_item_sk#12887L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12887L,i_class#12897,i_category#12899] Batched: true, DataFilters: [isnotnull(i_item_sk#12887L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_class:string,i_category:string>

read query: spark_queries/q37.sql
explain query: q37
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_current_price]
         +- 'Filter ((((('i_current_price >= 22) AND ('i_current_price <= (22 + 30))) AND ('inv_item_sk = 'i_item_sk)) AND (('d_date_sk = 'inv_date_sk) AND (('d_date >= cast(2001-06-02 as date)) AND ('d_date <= (cast(2001-06-02 as date) + INTERVAL '60' DAY))))) AND (('i_manufact_id IN (678,964,918,849) AND (('inv_quantity_on_hand >= 100) AND ('inv_quantity_on_hand <= 500))) AND ('cs_item_sk = 'i_item_sk)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [item], [], false
               :  :  +- 'UnresolvedRelation [inventory], [], false
               :  +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [catalog_sales], [], false

== Analyzed Logical Plan ==
i_item_id: string, i_item_desc: string, i_current_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#12979 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#12979, i_item_desc#12982, i_current_price#12983], [i_item_id#12979, i_item_desc#12982, i_current_price#12983]
         +- Filter (((((i_current_price#12983 >= cast(22 as double)) AND (i_current_price#12983 <= cast((22 + 30) as double))) AND (inv_item_sk#13001L = i_item_sk#12978L)) AND ((d_date_sk#13004L = inv_date_sk#13000L) AND ((d_date#13006 >= cast(2001-06-02 as date)) AND (d_date#13006 <= date_add(cast(2001-06-02 as date), extractansiintervaldays(INTERVAL '60' DAY)))))) AND ((i_manufact_id#12991 IN (678,964,918,849) AND ((inv_quantity_on_hand#13003 >= 100) AND (inv_quantity_on_hand#13003 <= 500))) AND (cs_item_sk#13046L = i_item_sk#12978L)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12978L,i_item_id#12979,i_rec_start_date#12980,i_rec_end_date#12981,i_item_desc#12982,i_current_price#12983,i_wholesale_cost#12984,i_brand_id#12985,i_brand#12986,i_class_id#12987,i_class#12988,i_category_id#12989,i_category#12990,i_manufact_id#12991,i_manufact#12992,i_size#12993,i_formulation#12994,i_color#12995,i_units#12996,i_container#12997,i_manager_id#12998,i_product_name#12999] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13000L,inv_item_sk#13001L,inv_warehouse_sk#13002L,inv_quantity_on_hand#13003] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13004L,d_date_id#13005,d_date#13006,d_month_seq#13007,d_week_seq#13008,d_quarter_seq#13009,d_year#13010,d_dow#13011,d_moy#13012,d_dom#13013,d_qoy#13014,d_fy_year#13015,d_fy_quarter_seq#13016,d_fy_week_seq#13017,d_day_name#13018,d_quarter_name#13019,d_holiday#13020,d_weekend#13021,d_following_holiday#13022,d_first_dom#13023,d_last_dom#13024,d_same_day_ly#13025,d_same_day_lq#13026,d_current_day#13027,... 4 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13032L,cs_ship_date_sk#13033L,cs_bill_customer_sk#13034L,cs_bill_cdemo_sk#13035L,cs_bill_hdemo_sk#13036L,cs_bill_addr_sk#13037L,cs_ship_customer_sk#13038L,cs_ship_cdemo_sk#13039L,cs_ship_hdemo_sk#13040L,cs_ship_addr_sk#13041L,cs_call_center_sk#13042L,cs_catalog_page_sk#13043L,cs_ship_mode_sk#13044L,cs_warehouse_sk#13045L,cs_item_sk#13046L,cs_promo_sk#13047L,cs_order_number#13048L,cs_quantity#13049,cs_wholesale_cost#13050,cs_list_price#13051,cs_sales_price#13052,cs_ext_discount_amt#13053,cs_ext_sales_price#13054,cs_ext_wholesale_cost#13055,... 10 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#12979 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#12979, i_item_desc#12982, i_current_price#12983], [i_item_id#12979, i_item_desc#12982, i_current_price#12983]
         +- Project [i_item_id#12979, i_item_desc#12982, i_current_price#12983]
            +- Join Inner, (cs_item_sk#13046L = i_item_sk#12978L)
               :- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983]
               :  +- Join Inner, (d_date_sk#13004L = inv_date_sk#13000L)
               :     :- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983, inv_date_sk#13000L]
               :     :  +- Join Inner, (inv_item_sk#13001L = i_item_sk#12978L)
               :     :     :- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983]
               :     :     :  +- Filter ((isnotnull(i_current_price#12983) AND (((i_current_price#12983 >= 22.0) AND (i_current_price#12983 <= 52.0)) AND i_manufact_id#12991 IN (678,964,918,849))) AND isnotnull(i_item_sk#12978L))
               :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12978L,i_item_id#12979,i_rec_start_date#12980,i_rec_end_date#12981,i_item_desc#12982,i_current_price#12983,i_wholesale_cost#12984,i_brand_id#12985,i_brand#12986,i_class_id#12987,i_class#12988,i_category_id#12989,i_category#12990,i_manufact_id#12991,i_manufact#12992,i_size#12993,i_formulation#12994,i_color#12995,i_units#12996,i_container#12997,i_manager_id#12998,i_product_name#12999] orc
               :     :     +- Project [inv_date_sk#13000L, inv_item_sk#13001L]
               :     :        +- Filter ((isnotnull(inv_quantity_on_hand#13003) AND ((inv_quantity_on_hand#13003 >= 100) AND (inv_quantity_on_hand#13003 <= 500))) AND (isnotnull(inv_item_sk#13001L) AND isnotnull(inv_date_sk#13000L)))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13000L,inv_item_sk#13001L,inv_warehouse_sk#13002L,inv_quantity_on_hand#13003] orc
               :     +- Project [d_date_sk#13004L]
               :        +- Filter ((isnotnull(d_date#13006) AND ((d_date#13006 >= 2001-06-02) AND (d_date#13006 <= 2001-08-01))) AND isnotnull(d_date_sk#13004L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13004L,d_date_id#13005,d_date#13006,d_month_seq#13007,d_week_seq#13008,d_quarter_seq#13009,d_year#13010,d_dow#13011,d_moy#13012,d_dom#13013,d_qoy#13014,d_fy_year#13015,d_fy_quarter_seq#13016,d_fy_week_seq#13017,d_day_name#13018,d_quarter_name#13019,d_holiday#13020,d_weekend#13021,d_following_holiday#13022,d_first_dom#13023,d_last_dom#13024,d_same_day_ly#13025,d_same_day_lq#13026,d_current_day#13027,... 4 more fields] orc
               +- Project [cs_item_sk#13046L]
                  +- Filter isnotnull(cs_item_sk#13046L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13032L,cs_ship_date_sk#13033L,cs_bill_customer_sk#13034L,cs_bill_cdemo_sk#13035L,cs_bill_hdemo_sk#13036L,cs_bill_addr_sk#13037L,cs_ship_customer_sk#13038L,cs_ship_cdemo_sk#13039L,cs_ship_hdemo_sk#13040L,cs_ship_addr_sk#13041L,cs_call_center_sk#13042L,cs_catalog_page_sk#13043L,cs_ship_mode_sk#13044L,cs_warehouse_sk#13045L,cs_item_sk#13046L,cs_promo_sk#13047L,cs_order_number#13048L,cs_quantity#13049,cs_wholesale_cost#13050,cs_list_price#13051,cs_sales_price#13052,cs_ext_discount_amt#13053,cs_ext_sales_price#13054,cs_ext_wholesale_cost#13055,... 10 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#12979 ASC NULLS FIRST], output=[i_item_id#12979,i_item_desc#12982,i_current_price#12983])
   +- HashAggregate(keys=[i_item_id#12979, i_item_desc#12982, i_current_price#12983], functions=[], output=[i_item_id#12979, i_item_desc#12982, i_current_price#12983])
      +- Exchange hashpartitioning(i_item_id#12979, i_item_desc#12982, i_current_price#12983, 3000), ENSURE_REQUIREMENTS, [id=#13598]
         +- HashAggregate(keys=[i_item_id#12979, i_item_desc#12982, knownfloatingpointnormalized(normalizenanandzero(i_current_price#12983)) AS i_current_price#12983], functions=[], output=[i_item_id#12979, i_item_desc#12982, i_current_price#12983])
            +- Project [i_item_id#12979, i_item_desc#12982, i_current_price#12983]
               +- SortMergeJoin [i_item_sk#12978L], [cs_item_sk#13046L], Inner
                  :- Sort [i_item_sk#12978L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(i_item_sk#12978L, 3000), ENSURE_REQUIREMENTS, [id=#13590]
                  :     +- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983]
                  :        +- BroadcastHashJoin [inv_date_sk#13000L], [d_date_sk#13004L], Inner, BuildRight, false
                  :           :- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983, inv_date_sk#13000L]
                  :           :  +- BroadcastHashJoin [i_item_sk#12978L], [inv_item_sk#13001L], Inner, BuildLeft, false
                  :           :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13581]
                  :           :     :  +- Project [i_item_sk#12978L, i_item_id#12979, i_item_desc#12982, i_current_price#12983]
                  :           :     :     +- Filter ((((isnotnull(i_current_price#12983) AND (i_current_price#12983 >= 22.0)) AND (i_current_price#12983 <= 52.0)) AND i_manufact_id#12991 IN (678,964,918,849)) AND isnotnull(i_item_sk#12978L))
                  :           :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#12978L,i_item_id#12979,i_item_desc#12982,i_current_price#12983,i_manufact_id#12991] Batched: true, DataFilters: [isnotnull(i_current_price#12983), (i_current_price#12983 >= 22.0), (i_current_price#12983 <= 52...., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,22.0), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string,i_current_price:double,i_manufact_id:...
                  :           :     +- Project [inv_date_sk#13000L, inv_item_sk#13001L]
                  :           :        +- Filter ((((isnotnull(inv_quantity_on_hand#13003) AND (inv_quantity_on_hand#13003 >= 100)) AND (inv_quantity_on_hand#13003 <= 500)) AND isnotnull(inv_item_sk#13001L)) AND isnotnull(inv_date_sk#13000L))
                  :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13000L,inv_item_sk#13001L,inv_quantity_on_hand#13003] Batched: true, DataFilters: [isnotnull(inv_quantity_on_hand#13003), (inv_quantity_on_hand#13003 >= 100), (inv_quantity_on_han..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_quantity_on_hand), GreaterThanOrEqual(inv_quantity_on_hand,100), LessThanOrEqual(i..., ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_quantity_on_hand:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13585]
                  :              +- Project [d_date_sk#13004L]
                  :                 +- Filter (((isnotnull(d_date#13006) AND (d_date#13006 >= 2001-06-02)) AND (d_date#13006 <= 2001-08-01)) AND isnotnull(d_date_sk#13004L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13004L,d_date#13006] Batched: true, DataFilters: [isnotnull(d_date#13006), (d_date#13006 >= 2001-06-02), (d_date#13006 <= 2001-08-01), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-06-02), LessThanOrEqual(d_date,2001-08-01), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  +- Sort [cs_item_sk#13046L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cs_item_sk#13046L, 3000), ENSURE_REQUIREMENTS, [id=#13591]
                        +- Project [cs_item_sk#13046L]
                           +- Filter isnotnull(cs_item_sk#13046L)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#13046L,cs_sold_date_sk#13065L] Batched: true, DataFilters: [isnotnull(cs_item_sk#13046L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint>

read query: spark_queries/q38.sql
explain query: q38
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Project [unresolvedalias('count(1), None)]
      +- 'SubqueryAlias hot_cust
         +- 'Intersect false
            :- 'Intersect false
            :  :- 'Distinct
            :  :  +- 'Project ['c_last_name, 'c_first_name, 'd_date]
            :  :     +- 'Filter ((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
            :  :        +- 'Join Inner
            :  :           :- 'Join Inner
            :  :           :  :- 'UnresolvedRelation [store_sales], [], false
            :  :           :  +- 'UnresolvedRelation [date_dim], [], false
            :  :           +- 'UnresolvedRelation [customer], [], false
            :  +- 'Distinct
            :     +- 'Project ['c_last_name, 'c_first_name, 'd_date]
            :        +- 'Filter ((('catalog_sales.cs_sold_date_sk = 'date_dim.d_date_sk) AND ('catalog_sales.cs_bill_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
            :           +- 'Join Inner
            :              :- 'Join Inner
            :              :  :- 'UnresolvedRelation [catalog_sales], [], false
            :              :  +- 'UnresolvedRelation [date_dim], [], false
            :              +- 'UnresolvedRelation [customer], [], false
            +- 'Distinct
               +- 'Project ['c_last_name, 'c_first_name, 'd_date]
                  +- 'Filter ((('web_sales.ws_sold_date_sk = 'date_dim.d_date_sk) AND ('web_sales.ws_bill_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'UnresolvedRelation [web_sales], [], false
                        :  +- 'UnresolvedRelation [date_dim], [], false
                        +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
count(1): bigint
GlobalLimit 100
+- LocalLimit 100
   +- Aggregate [count(1) AS count(1)#13299L]
      +- SubqueryAlias hot_cust
         +- Intersect false
            :- Intersect false
            :  :- Distinct
            :  :  +- Project [c_last_name#13130, c_first_name#13129, d_date#13095]
            :  :     +- Filter (((ss_sold_date_sk#13092L = d_date_sk#13093L) AND (ss_customer_sk#13072L = c_customer_sk#13121L)) AND ((d_month_seq#13096 >= 1212) AND (d_month_seq#13096 <= (1212 + 11))))
            :  :        +- Join Inner
            :  :           :- Join Inner
            :  :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
            :  :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#13070L,ss_item_sk#13071L,ss_customer_sk#13072L,ss_cdemo_sk#13073L,ss_hdemo_sk#13074L,ss_addr_sk#13075L,ss_store_sk#13076L,ss_promo_sk#13077L,ss_ticket_number#13078L,ss_quantity#13079,ss_wholesale_cost#13080,ss_list_price#13081,ss_sales_price#13082,ss_ext_discount_amt#13083,ss_ext_sales_price#13084,ss_ext_wholesale_cost#13085,ss_ext_list_price#13086,ss_ext_tax#13087,ss_coupon_amt#13088,ss_net_paid#13089,ss_net_paid_inc_tax#13090,ss_net_profit#13091,ss_sold_date_sk#13092L] orc
            :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13093L,d_date_id#13094,d_date#13095,d_month_seq#13096,d_week_seq#13097,d_quarter_seq#13098,d_year#13099,d_dow#13100,d_moy#13101,d_dom#13102,d_qoy#13103,d_fy_year#13104,d_fy_quarter_seq#13105,d_fy_week_seq#13106,d_day_name#13107,d_quarter_name#13108,d_holiday#13109,d_weekend#13110,d_following_holiday#13111,d_first_dom#13112,d_last_dom#13113,d_same_day_ly#13114,d_same_day_lq#13115,d_current_day#13116,... 4 more fields] orc
            :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
            :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13121L,c_customer_id#13122,c_current_cdemo_sk#13123L,c_current_hdemo_sk#13124L,c_current_addr_sk#13125L,c_first_shipto_date_sk#13126L,c_first_sales_date_sk#13127L,c_salutation#13128,c_first_name#13129,c_last_name#13130,c_preferred_cust_flag#13131,c_birth_day#13132,c_birth_month#13133,c_birth_year#13134,c_birth_country#13135,c_login#13136,c_email_address#13137,c_last_review_date#13138] orc
            :  +- Distinct
            :     +- Project [c_last_name#13210, c_first_name#13209, d_date#13175]
            :        +- Filter (((cs_sold_date_sk#13172L = d_date_sk#13173L) AND (cs_bill_customer_sk#13141L = c_customer_sk#13201L)) AND ((d_month_seq#13176 >= 1212) AND (d_month_seq#13176 <= (1212 + 11))))
            :           +- Join Inner
            :              :- Join Inner
            :              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13139L,cs_ship_date_sk#13140L,cs_bill_customer_sk#13141L,cs_bill_cdemo_sk#13142L,cs_bill_hdemo_sk#13143L,cs_bill_addr_sk#13144L,cs_ship_customer_sk#13145L,cs_ship_cdemo_sk#13146L,cs_ship_hdemo_sk#13147L,cs_ship_addr_sk#13148L,cs_call_center_sk#13149L,cs_catalog_page_sk#13150L,cs_ship_mode_sk#13151L,cs_warehouse_sk#13152L,cs_item_sk#13153L,cs_promo_sk#13154L,cs_order_number#13155L,cs_quantity#13156,cs_wholesale_cost#13157,cs_list_price#13158,cs_sales_price#13159,cs_ext_discount_amt#13160,cs_ext_sales_price#13161,cs_ext_wholesale_cost#13162,... 10 more fields] orc
            :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13173L,d_date_id#13174,d_date#13175,d_month_seq#13176,d_week_seq#13177,d_quarter_seq#13178,d_year#13179,d_dow#13180,d_moy#13181,d_dom#13182,d_qoy#13183,d_fy_year#13184,d_fy_quarter_seq#13185,d_fy_week_seq#13186,d_day_name#13187,d_quarter_name#13188,d_holiday#13189,d_weekend#13190,d_following_holiday#13191,d_first_dom#13192,d_last_dom#13193,d_same_day_ly#13194,d_same_day_lq#13195,d_current_day#13196,... 4 more fields] orc
            :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13201L,c_customer_id#13202,c_current_cdemo_sk#13203L,c_current_hdemo_sk#13204L,c_current_addr_sk#13205L,c_first_shipto_date_sk#13206L,c_first_sales_date_sk#13207L,c_salutation#13208,c_first_name#13209,c_last_name#13210,c_preferred_cust_flag#13211,c_birth_day#13212,c_birth_month#13213,c_birth_year#13214,c_birth_country#13215,c_login#13216,c_email_address#13217,c_last_review_date#13218] orc
            +- Distinct
               +- Project [c_last_name#13290, c_first_name#13289, d_date#13255]
                  +- Filter (((ws_sold_date_sk#13252L = d_date_sk#13253L) AND (ws_bill_customer_sk#13222L = c_customer_sk#13281L)) AND ((d_month_seq#13256 >= 1212) AND (d_month_seq#13256 <= (1212 + 11))))
                     +- Join Inner
                        :- Join Inner
                        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#13219L,ws_ship_date_sk#13220L,ws_item_sk#13221L,ws_bill_customer_sk#13222L,ws_bill_cdemo_sk#13223L,ws_bill_hdemo_sk#13224L,ws_bill_addr_sk#13225L,ws_ship_customer_sk#13226L,ws_ship_cdemo_sk#13227L,ws_ship_hdemo_sk#13228L,ws_ship_addr_sk#13229L,ws_web_page_sk#13230L,ws_web_site_sk#13231L,ws_ship_mode_sk#13232L,ws_warehouse_sk#13233L,ws_promo_sk#13234L,ws_order_number#13235L,ws_quantity#13236,ws_wholesale_cost#13237,ws_list_price#13238,ws_sales_price#13239,ws_ext_discount_amt#13240,ws_ext_sales_price#13241,ws_ext_wholesale_cost#13242,... 10 more fields] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13253L,d_date_id#13254,d_date#13255,d_month_seq#13256,d_week_seq#13257,d_quarter_seq#13258,d_year#13259,d_dow#13260,d_moy#13261,d_dom#13262,d_qoy#13263,d_fy_year#13264,d_fy_quarter_seq#13265,d_fy_week_seq#13266,d_day_name#13267,d_quarter_name#13268,d_holiday#13269,d_weekend#13270,d_following_holiday#13271,d_first_dom#13272,d_last_dom#13273,d_same_day_ly#13274,d_same_day_lq#13275,d_current_day#13276,... 4 more fields] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13281L,c_customer_id#13282,c_current_cdemo_sk#13283L,c_current_hdemo_sk#13284L,c_current_addr_sk#13285L,c_first_shipto_date_sk#13286L,c_first_sales_date_sk#13287L,c_salutation#13288,c_first_name#13289,c_last_name#13290,c_preferred_cust_flag#13291,c_birth_day#13292,c_birth_month#13293,c_birth_year#13294,c_birth_country#13295,c_login#13296,c_email_address#13297,c_last_review_date#13298] orc

== Optimized Logical Plan ==
Aggregate [count(1) AS count(1)#13299L]
+- Aggregate [c_last_name#13130, c_first_name#13129, d_date#13095]
   +- Join LeftSemi, (((c_last_name#13130 <=> c_last_name#13290) AND (c_first_name#13129 <=> c_first_name#13289)) AND (d_date#13095 <=> d_date#13255))
      :- Aggregate [c_last_name#13130, c_first_name#13129, d_date#13095], [c_last_name#13130, c_first_name#13129, d_date#13095]
      :  +- Join LeftSemi, (((c_last_name#13130 <=> c_last_name#13210) AND (c_first_name#13129 <=> c_first_name#13209)) AND (d_date#13095 <=> d_date#13175))
      :     :- Aggregate [c_last_name#13130, c_first_name#13129, d_date#13095], [c_last_name#13130, c_first_name#13129, d_date#13095]
      :     :  +- Project [c_last_name#13130, c_first_name#13129, d_date#13095]
      :     :     +- Join Inner, (ss_customer_sk#13072L = c_customer_sk#13121L)
      :     :        :- Project [ss_customer_sk#13072L, d_date#13095]
      :     :        :  +- Join Inner, (ss_sold_date_sk#13092L = d_date_sk#13093L)
      :     :        :     :- Project [ss_customer_sk#13072L, ss_sold_date_sk#13092L]
      :     :        :     :  +- Filter ((isnotnull(ss_sold_date_sk#13092L) AND isnotnull(ss_customer_sk#13072L)) AND dynamicpruning#13301 [ss_sold_date_sk#13092L])
      :     :        :     :     :  +- Project [d_date_sk#13093L, d_date#13095]
      :     :        :     :     :     +- Filter ((isnotnull(d_month_seq#13096) AND ((d_month_seq#13096 >= 1212) AND (d_month_seq#13096 <= 1223))) AND isnotnull(d_date_sk#13093L))
      :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13093L,d_date_id#13094,d_date#13095,d_month_seq#13096,d_week_seq#13097,d_quarter_seq#13098,d_year#13099,d_dow#13100,d_moy#13101,d_dom#13102,d_qoy#13103,d_fy_year#13104,d_fy_quarter_seq#13105,d_fy_week_seq#13106,d_day_name#13107,d_quarter_name#13108,d_holiday#13109,d_weekend#13110,d_following_holiday#13111,d_first_dom#13112,d_last_dom#13113,d_same_day_ly#13114,d_same_day_lq#13115,d_current_day#13116,... 4 more fields] orc
      :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#13070L,ss_item_sk#13071L,ss_customer_sk#13072L,ss_cdemo_sk#13073L,ss_hdemo_sk#13074L,ss_addr_sk#13075L,ss_store_sk#13076L,ss_promo_sk#13077L,ss_ticket_number#13078L,ss_quantity#13079,ss_wholesale_cost#13080,ss_list_price#13081,ss_sales_price#13082,ss_ext_discount_amt#13083,ss_ext_sales_price#13084,ss_ext_wholesale_cost#13085,ss_ext_list_price#13086,ss_ext_tax#13087,ss_coupon_amt#13088,ss_net_paid#13089,ss_net_paid_inc_tax#13090,ss_net_profit#13091,ss_sold_date_sk#13092L] orc
      :     :        :     +- Project [d_date_sk#13093L, d_date#13095]
      :     :        :        +- Filter ((isnotnull(d_month_seq#13096) AND ((d_month_seq#13096 >= 1212) AND (d_month_seq#13096 <= 1223))) AND isnotnull(d_date_sk#13093L))
      :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13093L,d_date_id#13094,d_date#13095,d_month_seq#13096,d_week_seq#13097,d_quarter_seq#13098,d_year#13099,d_dow#13100,d_moy#13101,d_dom#13102,d_qoy#13103,d_fy_year#13104,d_fy_quarter_seq#13105,d_fy_week_seq#13106,d_day_name#13107,d_quarter_name#13108,d_holiday#13109,d_weekend#13110,d_following_holiday#13111,d_first_dom#13112,d_last_dom#13113,d_same_day_ly#13114,d_same_day_lq#13115,d_current_day#13116,... 4 more fields] orc
      :     :        +- Project [c_customer_sk#13121L, c_first_name#13129, c_last_name#13130]
      :     :           +- Filter isnotnull(c_customer_sk#13121L)
      :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13121L,c_customer_id#13122,c_current_cdemo_sk#13123L,c_current_hdemo_sk#13124L,c_current_addr_sk#13125L,c_first_shipto_date_sk#13126L,c_first_sales_date_sk#13127L,c_salutation#13128,c_first_name#13129,c_last_name#13130,c_preferred_cust_flag#13131,c_birth_day#13132,c_birth_month#13133,c_birth_year#13134,c_birth_country#13135,c_login#13136,c_email_address#13137,c_last_review_date#13138] orc
      :     +- Aggregate [c_last_name#13210, c_first_name#13209, d_date#13175], [c_last_name#13210, c_first_name#13209, d_date#13175]
      :        +- Project [c_last_name#13210, c_first_name#13209, d_date#13175]
      :           +- Join Inner, (cs_bill_customer_sk#13141L = c_customer_sk#13201L)
      :              :- Project [cs_bill_customer_sk#13141L, d_date#13175]
      :              :  +- Join Inner, (cs_sold_date_sk#13172L = d_date_sk#13173L)
      :              :     :- Project [cs_bill_customer_sk#13141L, cs_sold_date_sk#13172L]
      :              :     :  +- Filter ((isnotnull(cs_sold_date_sk#13172L) AND isnotnull(cs_bill_customer_sk#13141L)) AND dynamicpruning#13302 [cs_sold_date_sk#13172L])
      :              :     :     :  +- Project [d_date_sk#13173L, d_date#13175]
      :              :     :     :     +- Filter ((isnotnull(d_month_seq#13176) AND ((d_month_seq#13176 >= 1212) AND (d_month_seq#13176 <= 1223))) AND isnotnull(d_date_sk#13173L))
      :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13173L,d_date_id#13174,d_date#13175,d_month_seq#13176,d_week_seq#13177,d_quarter_seq#13178,d_year#13179,d_dow#13180,d_moy#13181,d_dom#13182,d_qoy#13183,d_fy_year#13184,d_fy_quarter_seq#13185,d_fy_week_seq#13186,d_day_name#13187,d_quarter_name#13188,d_holiday#13189,d_weekend#13190,d_following_holiday#13191,d_first_dom#13192,d_last_dom#13193,d_same_day_ly#13194,d_same_day_lq#13195,d_current_day#13196,... 4 more fields] orc
      :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13139L,cs_ship_date_sk#13140L,cs_bill_customer_sk#13141L,cs_bill_cdemo_sk#13142L,cs_bill_hdemo_sk#13143L,cs_bill_addr_sk#13144L,cs_ship_customer_sk#13145L,cs_ship_cdemo_sk#13146L,cs_ship_hdemo_sk#13147L,cs_ship_addr_sk#13148L,cs_call_center_sk#13149L,cs_catalog_page_sk#13150L,cs_ship_mode_sk#13151L,cs_warehouse_sk#13152L,cs_item_sk#13153L,cs_promo_sk#13154L,cs_order_number#13155L,cs_quantity#13156,cs_wholesale_cost#13157,cs_list_price#13158,cs_sales_price#13159,cs_ext_discount_amt#13160,cs_ext_sales_price#13161,cs_ext_wholesale_cost#13162,... 10 more fields] orc
      :              :     +- Project [d_date_sk#13173L, d_date#13175]
      :              :        +- Filter ((isnotnull(d_month_seq#13176) AND ((d_month_seq#13176 >= 1212) AND (d_month_seq#13176 <= 1223))) AND isnotnull(d_date_sk#13173L))
      :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13173L,d_date_id#13174,d_date#13175,d_month_seq#13176,d_week_seq#13177,d_quarter_seq#13178,d_year#13179,d_dow#13180,d_moy#13181,d_dom#13182,d_qoy#13183,d_fy_year#13184,d_fy_quarter_seq#13185,d_fy_week_seq#13186,d_day_name#13187,d_quarter_name#13188,d_holiday#13189,d_weekend#13190,d_following_holiday#13191,d_first_dom#13192,d_last_dom#13193,d_same_day_ly#13194,d_same_day_lq#13195,d_current_day#13196,... 4 more fields] orc
      :              +- Project [c_customer_sk#13201L, c_first_name#13209, c_last_name#13210]
      :                 +- Filter isnotnull(c_customer_sk#13201L)
      :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13201L,c_customer_id#13202,c_current_cdemo_sk#13203L,c_current_hdemo_sk#13204L,c_current_addr_sk#13205L,c_first_shipto_date_sk#13206L,c_first_sales_date_sk#13207L,c_salutation#13208,c_first_name#13209,c_last_name#13210,c_preferred_cust_flag#13211,c_birth_day#13212,c_birth_month#13213,c_birth_year#13214,c_birth_country#13215,c_login#13216,c_email_address#13217,c_last_review_date#13218] orc
      +- Aggregate [c_last_name#13290, c_first_name#13289, d_date#13255], [c_last_name#13290, c_first_name#13289, d_date#13255]
         +- Project [c_last_name#13290, c_first_name#13289, d_date#13255]
            +- Join Inner, (ws_bill_customer_sk#13222L = c_customer_sk#13281L)
               :- Project [ws_bill_customer_sk#13222L, d_date#13255]
               :  +- Join Inner, (ws_sold_date_sk#13252L = d_date_sk#13253L)
               :     :- Project [ws_bill_customer_sk#13222L, ws_sold_date_sk#13252L]
               :     :  +- Filter ((isnotnull(ws_sold_date_sk#13252L) AND isnotnull(ws_bill_customer_sk#13222L)) AND dynamicpruning#13303 [ws_sold_date_sk#13252L])
               :     :     :  +- Project [d_date_sk#13253L, d_date#13255]
               :     :     :     +- Filter ((isnotnull(d_month_seq#13256) AND ((d_month_seq#13256 >= 1212) AND (d_month_seq#13256 <= 1223))) AND isnotnull(d_date_sk#13253L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13253L,d_date_id#13254,d_date#13255,d_month_seq#13256,d_week_seq#13257,d_quarter_seq#13258,d_year#13259,d_dow#13260,d_moy#13261,d_dom#13262,d_qoy#13263,d_fy_year#13264,d_fy_quarter_seq#13265,d_fy_week_seq#13266,d_day_name#13267,d_quarter_name#13268,d_holiday#13269,d_weekend#13270,d_following_holiday#13271,d_first_dom#13272,d_last_dom#13273,d_same_day_ly#13274,d_same_day_lq#13275,d_current_day#13276,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#13219L,ws_ship_date_sk#13220L,ws_item_sk#13221L,ws_bill_customer_sk#13222L,ws_bill_cdemo_sk#13223L,ws_bill_hdemo_sk#13224L,ws_bill_addr_sk#13225L,ws_ship_customer_sk#13226L,ws_ship_cdemo_sk#13227L,ws_ship_hdemo_sk#13228L,ws_ship_addr_sk#13229L,ws_web_page_sk#13230L,ws_web_site_sk#13231L,ws_ship_mode_sk#13232L,ws_warehouse_sk#13233L,ws_promo_sk#13234L,ws_order_number#13235L,ws_quantity#13236,ws_wholesale_cost#13237,ws_list_price#13238,ws_sales_price#13239,ws_ext_discount_amt#13240,ws_ext_sales_price#13241,ws_ext_wholesale_cost#13242,... 10 more fields] orc
               :     +- Project [d_date_sk#13253L, d_date#13255]
               :        +- Filter ((isnotnull(d_month_seq#13256) AND ((d_month_seq#13256 >= 1212) AND (d_month_seq#13256 <= 1223))) AND isnotnull(d_date_sk#13253L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13253L,d_date_id#13254,d_date#13255,d_month_seq#13256,d_week_seq#13257,d_quarter_seq#13258,d_year#13259,d_dow#13260,d_moy#13261,d_dom#13262,d_qoy#13263,d_fy_year#13264,d_fy_quarter_seq#13265,d_fy_week_seq#13266,d_day_name#13267,d_quarter_name#13268,d_holiday#13269,d_weekend#13270,d_following_holiday#13271,d_first_dom#13272,d_last_dom#13273,d_same_day_ly#13274,d_same_day_lq#13275,d_current_day#13276,... 4 more fields] orc
               +- Project [c_customer_sk#13281L, c_first_name#13289, c_last_name#13290]
                  +- Filter isnotnull(c_customer_sk#13281L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13281L,c_customer_id#13282,c_current_cdemo_sk#13283L,c_current_hdemo_sk#13284L,c_current_addr_sk#13285L,c_first_shipto_date_sk#13286L,c_first_sales_date_sk#13287L,c_salutation#13288,c_first_name#13289,c_last_name#13290,c_preferred_cust_flag#13291,c_birth_day#13292,c_birth_month#13293,c_birth_year#13294,c_birth_country#13295,c_login#13296,c_email_address#13297,c_last_review_date#13298] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#13299L])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#13919]
      +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#13305L])
         +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[])
            +- Exchange hashpartitioning(c_last_name#13130, c_first_name#13129, d_date#13095, 3000), ENSURE_REQUIREMENTS, [id=#13915]
               +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[c_last_name#13130, c_first_name#13129, d_date#13095])
                  +- SortMergeJoin [coalesce(c_last_name#13130, ), isnull(c_last_name#13130), coalesce(c_first_name#13129, ), isnull(c_first_name#13129), coalesce(d_date#13095, 1970-01-01), isnull(d_date#13095)], [coalesce(c_last_name#13290, ), isnull(c_last_name#13290), coalesce(c_first_name#13289, ), isnull(c_first_name#13289), coalesce(d_date#13255, 1970-01-01), isnull(d_date#13255)], LeftSemi
                     :- Sort [coalesce(c_last_name#13130, ) ASC NULLS FIRST, isnull(c_last_name#13130) ASC NULLS FIRST, coalesce(c_first_name#13129, ) ASC NULLS FIRST, isnull(c_first_name#13129) ASC NULLS FIRST, coalesce(d_date#13095, 1970-01-01) ASC NULLS FIRST, isnull(d_date#13095) ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(coalesce(c_last_name#13130, ), isnull(c_last_name#13130), coalesce(c_first_name#13129, ), isnull(c_first_name#13129), coalesce(d_date#13095, 1970-01-01), isnull(d_date#13095), 3000), ENSURE_REQUIREMENTS, [id=#13908]
                     :     +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[c_last_name#13130, c_first_name#13129, d_date#13095])
                     :        +- Exchange hashpartitioning(c_last_name#13130, c_first_name#13129, d_date#13095, 3000), ENSURE_REQUIREMENTS, [id=#13889]
                     :           +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[c_last_name#13130, c_first_name#13129, d_date#13095])
                     :              +- SortMergeJoin [coalesce(c_last_name#13130, ), isnull(c_last_name#13130), coalesce(c_first_name#13129, ), isnull(c_first_name#13129), coalesce(d_date#13095, 1970-01-01), isnull(d_date#13095)], [coalesce(c_last_name#13210, ), isnull(c_last_name#13210), coalesce(c_first_name#13209, ), isnull(c_first_name#13209), coalesce(d_date#13175, 1970-01-01), isnull(d_date#13175)], LeftSemi
                     :                 :- Sort [coalesce(c_last_name#13130, ) ASC NULLS FIRST, isnull(c_last_name#13130) ASC NULLS FIRST, coalesce(c_first_name#13129, ) ASC NULLS FIRST, isnull(c_first_name#13129) ASC NULLS FIRST, coalesce(d_date#13095, 1970-01-01) ASC NULLS FIRST, isnull(d_date#13095) ASC NULLS FIRST], false, 0
                     :                 :  +- Exchange hashpartitioning(coalesce(c_last_name#13130, ), isnull(c_last_name#13130), coalesce(c_first_name#13129, ), isnull(c_first_name#13129), coalesce(d_date#13095, 1970-01-01), isnull(d_date#13095), 3000), ENSURE_REQUIREMENTS, [id=#13882]
                     :                 :     +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[c_last_name#13130, c_first_name#13129, d_date#13095])
                     :                 :        +- Exchange hashpartitioning(c_last_name#13130, c_first_name#13129, d_date#13095, 3000), ENSURE_REQUIREMENTS, [id=#13863]
                     :                 :           +- HashAggregate(keys=[c_last_name#13130, c_first_name#13129, d_date#13095], functions=[], output=[c_last_name#13130, c_first_name#13129, d_date#13095])
                     :                 :              +- Project [c_last_name#13130, c_first_name#13129, d_date#13095]
                     :                 :                 +- SortMergeJoin [ss_customer_sk#13072L], [c_customer_sk#13121L], Inner
                     :                 :                    :- Sort [ss_customer_sk#13072L ASC NULLS FIRST], false, 0
                     :                 :                    :  +- Exchange hashpartitioning(ss_customer_sk#13072L, 3000), ENSURE_REQUIREMENTS, [id=#13855]
                     :                 :                    :     +- Project [ss_customer_sk#13072L, d_date#13095]
                     :                 :                    :        +- BroadcastHashJoin [ss_sold_date_sk#13092L], [d_date_sk#13093L], Inner, BuildRight, false
                     :                 :                    :           :- Filter isnotnull(ss_customer_sk#13072L)
                     :                 :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#13072L,ss_sold_date_sk#13092L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#13072L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#13092L), dynamicpruningexpression(ss_sold_date_sk#13092L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint>
                     :                 :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#13301, 0, true, Project [d_date_sk#13093L, d_date#13095], [d_date_sk#13093L]
                     :                 :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                 :                    :           :              +- Project [d_date_sk#13093L, d_date#13095]
                     :                 :                    :           :                 +- Filter (((isnotnull(d_month_seq#13096) AND (d_month_seq#13096 >= 1212)) AND (d_month_seq#13096 <= 1223)) AND isnotnull(d_date_sk#13093L))
                     :                 :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13093L,d_date#13095,d_month_seq#13096] Batched: true, DataFilters: [isnotnull(d_month_seq#13096), (d_month_seq#13096 >= 1212), (d_month_seq#13096 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                 :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13850]
                     :                 :                    :              +- Project [d_date_sk#13093L, d_date#13095]
                     :                 :                    :                 +- Filter (((isnotnull(d_month_seq#13096) AND (d_month_seq#13096 >= 1212)) AND (d_month_seq#13096 <= 1223)) AND isnotnull(d_date_sk#13093L))
                     :                 :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13093L,d_date#13095,d_month_seq#13096] Batched: true, DataFilters: [isnotnull(d_month_seq#13096), (d_month_seq#13096 >= 1212), (d_month_seq#13096 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                 :                    +- Sort [c_customer_sk#13121L ASC NULLS FIRST], false, 0
                     :                 :                       +- Exchange hashpartitioning(c_customer_sk#13121L, 3000), ENSURE_REQUIREMENTS, [id=#13856]
                     :                 :                          +- Filter isnotnull(c_customer_sk#13121L)
                     :                 :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13121L,c_first_name#13129,c_last_name#13130] Batched: true, DataFilters: [isnotnull(c_customer_sk#13121L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
                     :                 +- Sort [coalesce(c_last_name#13210, ) ASC NULLS FIRST, isnull(c_last_name#13210) ASC NULLS FIRST, coalesce(c_first_name#13209, ) ASC NULLS FIRST, isnull(c_first_name#13209) ASC NULLS FIRST, coalesce(d_date#13175, 1970-01-01) ASC NULLS FIRST, isnull(d_date#13175) ASC NULLS FIRST], false, 0
                     :                    +- Exchange hashpartitioning(coalesce(c_last_name#13210, ), isnull(c_last_name#13210), coalesce(c_first_name#13209, ), isnull(c_first_name#13209), coalesce(d_date#13175, 1970-01-01), isnull(d_date#13175), 3000), ENSURE_REQUIREMENTS, [id=#13883]
                     :                       +- HashAggregate(keys=[c_last_name#13210, c_first_name#13209, d_date#13175], functions=[], output=[c_last_name#13210, c_first_name#13209, d_date#13175])
                     :                          +- Exchange hashpartitioning(c_last_name#13210, c_first_name#13209, d_date#13175, 3000), ENSURE_REQUIREMENTS, [id=#13878]
                     :                             +- HashAggregate(keys=[c_last_name#13210, c_first_name#13209, d_date#13175], functions=[], output=[c_last_name#13210, c_first_name#13209, d_date#13175])
                     :                                +- Project [c_last_name#13210, c_first_name#13209, d_date#13175]
                     :                                   +- SortMergeJoin [cs_bill_customer_sk#13141L], [c_customer_sk#13201L], Inner
                     :                                      :- Sort [cs_bill_customer_sk#13141L ASC NULLS FIRST], false, 0
                     :                                      :  +- Exchange hashpartitioning(cs_bill_customer_sk#13141L, 3000), ENSURE_REQUIREMENTS, [id=#13870]
                     :                                      :     +- Project [cs_bill_customer_sk#13141L, d_date#13175]
                     :                                      :        +- BroadcastHashJoin [cs_sold_date_sk#13172L], [d_date_sk#13173L], Inner, BuildRight, false
                     :                                      :           :- Filter isnotnull(cs_bill_customer_sk#13141L)
                     :                                      :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#13141L,cs_sold_date_sk#13172L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#13141L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#13172L), dynamicpruningexpression(cs_sold_date_sk#13172L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint>
                     :                                      :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#13302, 0, true, Project [d_date_sk#13173L, d_date#13175], [d_date_sk#13173L]
                     :                                      :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                                      :           :              +- Project [d_date_sk#13173L, d_date#13175]
                     :                                      :           :                 +- Filter (((isnotnull(d_month_seq#13176) AND (d_month_seq#13176 >= 1212)) AND (d_month_seq#13176 <= 1223)) AND isnotnull(d_date_sk#13173L))
                     :                                      :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13173L,d_date#13175,d_month_seq#13176] Batched: true, DataFilters: [isnotnull(d_month_seq#13176), (d_month_seq#13176 >= 1212), (d_month_seq#13176 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                                      :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13865]
                     :                                      :              +- Project [d_date_sk#13173L, d_date#13175]
                     :                                      :                 +- Filter (((isnotnull(d_month_seq#13176) AND (d_month_seq#13176 >= 1212)) AND (d_month_seq#13176 <= 1223)) AND isnotnull(d_date_sk#13173L))
                     :                                      :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13173L,d_date#13175,d_month_seq#13176] Batched: true, DataFilters: [isnotnull(d_month_seq#13176), (d_month_seq#13176 >= 1212), (d_month_seq#13176 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                                      +- Sort [c_customer_sk#13201L ASC NULLS FIRST], false, 0
                     :                                         +- Exchange hashpartitioning(c_customer_sk#13201L, 3000), ENSURE_REQUIREMENTS, [id=#13871]
                     :                                            +- Filter isnotnull(c_customer_sk#13201L)
                     :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13201L,c_first_name#13209,c_last_name#13210] Batched: true, DataFilters: [isnotnull(c_customer_sk#13201L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
                     +- Sort [coalesce(c_last_name#13290, ) ASC NULLS FIRST, isnull(c_last_name#13290) ASC NULLS FIRST, coalesce(c_first_name#13289, ) ASC NULLS FIRST, isnull(c_first_name#13289) ASC NULLS FIRST, coalesce(d_date#13255, 1970-01-01) ASC NULLS FIRST, isnull(d_date#13255) ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(coalesce(c_last_name#13290, ), isnull(c_last_name#13290), coalesce(c_first_name#13289, ), isnull(c_first_name#13289), coalesce(d_date#13255, 1970-01-01), isnull(d_date#13255), 3000), ENSURE_REQUIREMENTS, [id=#13909]
                           +- HashAggregate(keys=[c_last_name#13290, c_first_name#13289, d_date#13255], functions=[], output=[c_last_name#13290, c_first_name#13289, d_date#13255])
                              +- Exchange hashpartitioning(c_last_name#13290, c_first_name#13289, d_date#13255, 3000), ENSURE_REQUIREMENTS, [id=#13904]
                                 +- HashAggregate(keys=[c_last_name#13290, c_first_name#13289, d_date#13255], functions=[], output=[c_last_name#13290, c_first_name#13289, d_date#13255])
                                    +- Project [c_last_name#13290, c_first_name#13289, d_date#13255]
                                       +- SortMergeJoin [ws_bill_customer_sk#13222L], [c_customer_sk#13281L], Inner
                                          :- Sort [ws_bill_customer_sk#13222L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(ws_bill_customer_sk#13222L, 3000), ENSURE_REQUIREMENTS, [id=#13896]
                                          :     +- Project [ws_bill_customer_sk#13222L, d_date#13255]
                                          :        +- BroadcastHashJoin [ws_sold_date_sk#13252L], [d_date_sk#13253L], Inner, BuildRight, false
                                          :           :- Filter isnotnull(ws_bill_customer_sk#13222L)
                                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#13222L,ws_sold_date_sk#13252L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#13222L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#13252L), dynamicpruningexpression(ws_sold_date_sk#13252L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint>
                                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#13303, 0, true, Project [d_date_sk#13253L, d_date#13255], [d_date_sk#13253L]
                                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :           :              +- Project [d_date_sk#13253L, d_date#13255]
                                          :           :                 +- Filter (((isnotnull(d_month_seq#13256) AND (d_month_seq#13256 >= 1212)) AND (d_month_seq#13256 <= 1223)) AND isnotnull(d_date_sk#13253L))
                                          :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13253L,d_date#13255,d_month_seq#13256] Batched: true, DataFilters: [isnotnull(d_month_seq#13256), (d_month_seq#13256 >= 1212), (d_month_seq#13256 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#13891]
                                          :              +- Project [d_date_sk#13253L, d_date#13255]
                                          :                 +- Filter (((isnotnull(d_month_seq#13256) AND (d_month_seq#13256 >= 1212)) AND (d_month_seq#13256 <= 1223)) AND isnotnull(d_date_sk#13253L))
                                          :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13253L,d_date#13255,d_month_seq#13256] Batched: true, DataFilters: [isnotnull(d_month_seq#13256), (d_month_seq#13256 >= 1212), (d_month_seq#13256 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                                          +- Sort [c_customer_sk#13281L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(c_customer_sk#13281L, 3000), ENSURE_REQUIREMENTS, [id=#13897]
                                                +- Filter isnotnull(c_customer_sk#13281L)
                                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#13281L,c_first_name#13289,c_last_name#13290] Batched: true, DataFilters: [isnotnull(c_customer_sk#13281L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>

read query: spark_queries/q39a.sql
explain query: q39a
== Parsed Logical Plan ==
CTE [inv]
:  +- 'SubqueryAlias inv
:     +- 'Project ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stdev, 'mean, CASE WHEN ('mean = 0) THEN null ELSE ('stdev / 'mean) END AS cov#13308]
:        +- 'Filter (CASE WHEN ('mean = 0) THEN 0 ELSE ('stdev / 'mean) END > 1)
:           +- 'SubqueryAlias foo
:              +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy], ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stddev_samp('inv_quantity_on_hand) AS stdev#13306, 'avg('inv_quantity_on_hand) AS mean#13307]
:                 +- 'Filter ((('inv_item_sk = 'i_item_sk) AND ('inv_warehouse_sk = 'w_warehouse_sk)) AND (('inv_date_sk = 'd_date_sk) AND ('d_year = 1999)))
:                    +- 'Join Inner
:                       :- 'Join Inner
:                       :  :- 'Join Inner
:                       :  :  :- 'UnresolvedRelation [inventory], [], false
:                       :  :  +- 'UnresolvedRelation [item], [], false
:                       :  +- 'UnresolvedRelation [warehouse], [], false
:                       +- 'UnresolvedRelation [date_dim], [], false
+- 'Sort ['inv1.w_warehouse_sk ASC NULLS FIRST, 'inv1.i_item_sk ASC NULLS FIRST, 'inv1.d_moy ASC NULLS FIRST, 'inv1.mean ASC NULLS FIRST, 'inv1.cov ASC NULLS FIRST, 'inv2.d_moy ASC NULLS FIRST, 'inv2.mean ASC NULLS FIRST, 'inv2.cov ASC NULLS FIRST], true
   +- 'Project ['inv1.w_warehouse_sk, 'inv1.i_item_sk, 'inv1.d_moy, 'inv1.mean, 'inv1.cov, 'inv2.w_warehouse_sk, 'inv2.i_item_sk, 'inv2.d_moy, 'inv2.mean, 'inv2.cov]
      +- 'Filter ((('inv1.i_item_sk = 'inv2.i_item_sk) AND ('inv1.w_warehouse_sk = 'inv2.w_warehouse_sk)) AND (('inv1.d_moy = 4) AND ('inv2.d_moy = (4 + 1))))
         +- 'Join Inner
            :- 'SubqueryAlias inv1
            :  +- 'UnresolvedRelation [inv], [], false
            +- 'SubqueryAlias inv2
               +- 'UnresolvedRelation [inv], [], false

== Analyzed Logical Plan ==
w_warehouse_sk: bigint, i_item_sk: bigint, d_moy: int, mean: double, cov: double, w_warehouse_sk: bigint, i_item_sk: bigint, d_moy: int, mean: double, cov: double
WithCTE
:- CTERelationDef 25
:  +- SubqueryAlias inv
:     +- Project [w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, stdev#13306, mean#13307, CASE WHEN (mean#13307 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#13306 / mean#13307) END AS cov#13308]
:        +- Filter (CASE WHEN (mean#13307 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#13306 / mean#13307) END > cast(1 as double))
:           +- SubqueryAlias foo
:              +- Aggregate [w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357], [w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, stddev_samp(cast(inv_quantity_on_hand#13312 as double)) AS stdev#13306, avg(inv_quantity_on_hand#13312) AS mean#13307]
:                 +- Filter (((inv_item_sk#13310L = i_item_sk#13313L) AND (inv_warehouse_sk#13311L = w_warehouse_sk#13335L)) AND ((inv_date_sk#13309L = d_date_sk#13349L) AND (d_year#13355 = 1999)))
:                    +- Join Inner
:                       :- Join Inner
:                       :  :- Join Inner
:                       :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
:                       :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13309L,inv_item_sk#13310L,inv_warehouse_sk#13311L,inv_quantity_on_hand#13312] orc
:                       :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                       :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13313L,i_item_id#13314,i_rec_start_date#13315,i_rec_end_date#13316,i_item_desc#13317,i_current_price#13318,i_wholesale_cost#13319,i_brand_id#13320,i_brand#13321,i_class_id#13322,i_class#13323,i_category_id#13324,i_category#13325,i_manufact_id#13326,i_manufact#13327,i_size#13328,i_formulation#13329,i_color#13330,i_units#13331,i_container#13332,i_manager_id#13333,i_product_name#13334] orc
:                       :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
:                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13335L,w_warehouse_id#13336,w_warehouse_name#13337,w_warehouse_sq_ft#13338,w_street_number#13339,w_street_name#13340,w_street_type#13341,w_suite_number#13342,w_city#13343,w_county#13344,w_state#13345,w_zip#13346,w_country#13347,w_gmt_offset#13348] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13349L,d_date_id#13350,d_date#13351,d_month_seq#13352,d_week_seq#13353,d_quarter_seq#13354,d_year#13355,d_dow#13356,d_moy#13357,d_dom#13358,d_qoy#13359,d_fy_year#13360,d_fy_quarter_seq#13361,d_fy_week_seq#13362,d_day_name#13363,d_quarter_name#13364,d_holiday#13365,d_weekend#13366,d_following_holiday#13367,d_first_dom#13368,d_last_dom#13369,d_same_day_ly#13370,d_same_day_lq#13371,d_current_day#13372,... 4 more fields] orc
+- Sort [w_warehouse_sk#13335L ASC NULLS FIRST, i_item_sk#13313L ASC NULLS FIRST, d_moy#13357 ASC NULLS FIRST, mean#13307 ASC NULLS FIRST, cov#13308 ASC NULLS FIRST, d_moy#13406 ASC NULLS FIRST, mean#13408 ASC NULLS FIRST, cov#13409 ASC NULLS FIRST], true
   +- Project [w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, mean#13307, cov#13308, w_warehouse_sk#13404L, i_item_sk#13405L, d_moy#13406, mean#13408, cov#13409]
      +- Filter (((i_item_sk#13313L = i_item_sk#13405L) AND (w_warehouse_sk#13335L = w_warehouse_sk#13404L)) AND ((d_moy#13357 = 4) AND (d_moy#13406 = (4 + 1))))
         +- Join Inner
            :- SubqueryAlias inv1
            :  +- SubqueryAlias inv
            :     +- CTERelationRef 25, true, [w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, stdev#13306, mean#13307, cov#13308]
            +- SubqueryAlias inv2
               +- SubqueryAlias inv
                  +- CTERelationRef 25, true, [w_warehouse_name#13403, w_warehouse_sk#13404L, i_item_sk#13405L, d_moy#13406, stdev#13407, mean#13408, cov#13409]

== Optimized Logical Plan ==
Sort [w_warehouse_sk#13335L ASC NULLS FIRST, i_item_sk#13313L ASC NULLS FIRST, d_moy#13357 ASC NULLS FIRST, mean#13307 ASC NULLS FIRST, cov#13308 ASC NULLS FIRST, d_moy#13476 ASC NULLS FIRST, mean#13408 ASC NULLS FIRST, cov#13409 ASC NULLS FIRST], true
+- Join Inner, ((i_item_sk#13313L = i_item_sk#13432L) AND (w_warehouse_sk#13335L = w_warehouse_sk#13454L))
   :- Project [w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, mean#13307, CASE WHEN (mean#13307 = 0.0) THEN null ELSE (stdev#13306 / mean#13307) END AS cov#13308]
   :  +- Filter ((isnotnull(stdev#13306) AND isnotnull(mean#13307)) AND (NOT coalesce((mean#13307 = 0.0), false) AND ((stdev#13306 / mean#13307) > 1.0)))
   :     +- Aggregate [w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357], [w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, stddev_samp(cast(inv_quantity_on_hand#13312 as double)) AS stdev#13306, avg(inv_quantity_on_hand#13312) AS mean#13307]
   :        +- Project [inv_quantity_on_hand#13312, i_item_sk#13313L, w_warehouse_sk#13335L, w_warehouse_name#13337, d_moy#13357]
   :           +- Join Inner, (inv_warehouse_sk#13311L = w_warehouse_sk#13335L)
   :              :- Project [inv_warehouse_sk#13311L, inv_quantity_on_hand#13312, d_moy#13357, i_item_sk#13313L]
   :              :  +- Join Inner, (inv_item_sk#13310L = i_item_sk#13313L)
   :              :     :- Project [inv_item_sk#13310L, inv_warehouse_sk#13311L, inv_quantity_on_hand#13312, d_moy#13357]
   :              :     :  +- Join Inner, (inv_date_sk#13309L = d_date_sk#13349L)
   :              :     :     :- Filter (isnotnull(inv_item_sk#13310L) AND (isnotnull(inv_warehouse_sk#13311L) AND isnotnull(inv_date_sk#13309L)))
   :              :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13309L,inv_item_sk#13310L,inv_warehouse_sk#13311L,inv_quantity_on_hand#13312] orc
   :              :     :     +- Project [d_date_sk#13349L, d_moy#13357]
   :              :     :        +- Filter (((isnotnull(d_year#13355) AND isnotnull(d_moy#13357)) AND ((d_year#13355 = 1999) AND (d_moy#13357 = 4))) AND isnotnull(d_date_sk#13349L))
   :              :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13349L,d_date_id#13350,d_date#13351,d_month_seq#13352,d_week_seq#13353,d_quarter_seq#13354,d_year#13355,d_dow#13356,d_moy#13357,d_dom#13358,d_qoy#13359,d_fy_year#13360,d_fy_quarter_seq#13361,d_fy_week_seq#13362,d_day_name#13363,d_quarter_name#13364,d_holiday#13365,d_weekend#13366,d_following_holiday#13367,d_first_dom#13368,d_last_dom#13369,d_same_day_ly#13370,d_same_day_lq#13371,d_current_day#13372,... 4 more fields] orc
   :              :     +- Project [i_item_sk#13313L]
   :              :        +- Filter isnotnull(i_item_sk#13313L)
   :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13313L,i_item_id#13314,i_rec_start_date#13315,i_rec_end_date#13316,i_item_desc#13317,i_current_price#13318,i_wholesale_cost#13319,i_brand_id#13320,i_brand#13321,i_class_id#13322,i_class#13323,i_category_id#13324,i_category#13325,i_manufact_id#13326,i_manufact#13327,i_size#13328,i_formulation#13329,i_color#13330,i_units#13331,i_container#13332,i_manager_id#13333,i_product_name#13334] orc
   :              +- Project [w_warehouse_sk#13335L, w_warehouse_name#13337]
   :                 +- Filter isnotnull(w_warehouse_sk#13335L)
   :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13335L,w_warehouse_id#13336,w_warehouse_name#13337,w_warehouse_sq_ft#13338,w_street_number#13339,w_street_name#13340,w_street_type#13341,w_suite_number#13342,w_city#13343,w_county#13344,w_state#13345,w_zip#13346,w_country#13347,w_gmt_offset#13348] orc
   +- Project [w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, mean#13307 AS mean#13408, CASE WHEN (mean#13307 = 0.0) THEN null ELSE (stdev#13306 / mean#13307) END AS cov#13409]
      +- Filter ((isnotnull(stdev#13306) AND isnotnull(mean#13307)) AND (NOT coalesce((mean#13307 = 0.0), false) AND ((stdev#13306 / mean#13307) > 1.0)))
         +- Aggregate [w_warehouse_name#13456, w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476], [w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, stddev_samp(cast(inv_quantity_on_hand#13431 as double)) AS stdev#13306, avg(inv_quantity_on_hand#13431) AS mean#13307]
            +- Project [inv_quantity_on_hand#13431, i_item_sk#13432L, w_warehouse_sk#13454L, w_warehouse_name#13456, d_moy#13476]
               +- Join Inner, (inv_warehouse_sk#13430L = w_warehouse_sk#13454L)
                  :- Project [inv_warehouse_sk#13430L, inv_quantity_on_hand#13431, d_moy#13476, i_item_sk#13432L]
                  :  +- Join Inner, (inv_item_sk#13429L = i_item_sk#13432L)
                  :     :- Project [inv_item_sk#13429L, inv_warehouse_sk#13430L, inv_quantity_on_hand#13431, d_moy#13476]
                  :     :  +- Join Inner, (inv_date_sk#13428L = d_date_sk#13468L)
                  :     :     :- Filter (isnotnull(inv_item_sk#13429L) AND (isnotnull(inv_warehouse_sk#13430L) AND isnotnull(inv_date_sk#13428L)))
                  :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13428L,inv_item_sk#13429L,inv_warehouse_sk#13430L,inv_quantity_on_hand#13431] orc
                  :     :     +- Project [d_date_sk#13468L, d_moy#13476]
                  :     :        +- Filter (((isnotnull(d_year#13474) AND isnotnull(d_moy#13476)) AND ((d_year#13474 = 1999) AND (d_moy#13476 = 5))) AND isnotnull(d_date_sk#13468L))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13468L,d_date_id#13469,d_date#13470,d_month_seq#13471,d_week_seq#13472,d_quarter_seq#13473,d_year#13474,d_dow#13475,d_moy#13476,d_dom#13477,d_qoy#13478,d_fy_year#13479,d_fy_quarter_seq#13480,d_fy_week_seq#13481,d_day_name#13482,d_quarter_name#13483,d_holiday#13484,d_weekend#13485,d_following_holiday#13486,d_first_dom#13487,d_last_dom#13488,d_same_day_ly#13489,d_same_day_lq#13490,d_current_day#13491,... 4 more fields] orc
                  :     +- Project [i_item_sk#13432L]
                  :        +- Filter isnotnull(i_item_sk#13432L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13432L,i_item_id#13433,i_rec_start_date#13434,i_rec_end_date#13435,i_item_desc#13436,i_current_price#13437,i_wholesale_cost#13438,i_brand_id#13439,i_brand#13440,i_class_id#13441,i_class#13442,i_category_id#13443,i_category#13444,i_manufact_id#13445,i_manufact#13446,i_size#13447,i_formulation#13448,i_color#13449,i_units#13450,i_container#13451,i_manager_id#13452,i_product_name#13453] orc
                  +- Project [w_warehouse_sk#13454L, w_warehouse_name#13456]
                     +- Filter isnotnull(w_warehouse_sk#13454L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13454L,w_warehouse_id#13455,w_warehouse_name#13456,w_warehouse_sq_ft#13457,w_street_number#13458,w_street_name#13459,w_street_type#13460,w_suite_number#13461,w_city#13462,w_county#13463,w_state#13464,w_zip#13465,w_country#13466,w_gmt_offset#13467] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [w_warehouse_sk#13335L ASC NULLS FIRST, i_item_sk#13313L ASC NULLS FIRST, d_moy#13357 ASC NULLS FIRST, mean#13307 ASC NULLS FIRST, cov#13308 ASC NULLS FIRST, d_moy#13476 ASC NULLS FIRST, mean#13408 ASC NULLS FIRST, cov#13409 ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(w_warehouse_sk#13335L ASC NULLS FIRST, i_item_sk#13313L ASC NULLS FIRST, d_moy#13357 ASC NULLS FIRST, mean#13307 ASC NULLS FIRST, cov#13308 ASC NULLS FIRST, d_moy#13476 ASC NULLS FIRST, mean#13408 ASC NULLS FIRST, cov#13409 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#14135]
      +- SortMergeJoin [i_item_sk#13313L, w_warehouse_sk#13335L], [i_item_sk#13432L, w_warehouse_sk#13454L], Inner
         :- Sort [i_item_sk#13313L ASC NULLS FIRST, w_warehouse_sk#13335L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(i_item_sk#13313L, w_warehouse_sk#13335L, 3000), ENSURE_REQUIREMENTS, [id=#14129]
         :     +- Project [w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, mean#13307, CASE WHEN (mean#13307 = 0.0) THEN null ELSE (stdev#13306 / mean#13307) END AS cov#13308]
         :        +- Filter ((isnotnull(stdev#13306) AND isnotnull(mean#13307)) AND (NOT coalesce((mean#13307 = 0.0), false) AND ((stdev#13306 / mean#13307) > 1.0)))
         :           +- HashAggregate(keys=[w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357], functions=[stddev_samp(cast(inv_quantity_on_hand#13312 as double)), avg(inv_quantity_on_hand#13312)], output=[w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, stdev#13306, mean#13307])
         :              +- Exchange hashpartitioning(w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, 3000), ENSURE_REQUIREMENTS, [id=#14106]
         :                 +- HashAggregate(keys=[w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#13312 as double)), partial_avg(inv_quantity_on_hand#13312)], output=[w_warehouse_name#13337, w_warehouse_sk#13335L, i_item_sk#13313L, d_moy#13357, n#13400, avg#13401, m2#13402, sum#13507, count#13508L])
         :                    +- Project [inv_quantity_on_hand#13312, i_item_sk#13313L, w_warehouse_sk#13335L, w_warehouse_name#13337, d_moy#13357]
         :                       +- BroadcastHashJoin [inv_warehouse_sk#13311L], [w_warehouse_sk#13335L], Inner, BuildRight, false
         :                          :- Project [inv_warehouse_sk#13311L, inv_quantity_on_hand#13312, d_moy#13357, i_item_sk#13313L]
         :                          :  +- BroadcastHashJoin [inv_item_sk#13310L], [i_item_sk#13313L], Inner, BuildRight, false
         :                          :     :- Project [inv_item_sk#13310L, inv_warehouse_sk#13311L, inv_quantity_on_hand#13312, d_moy#13357]
         :                          :     :  +- BroadcastHashJoin [inv_date_sk#13309L], [d_date_sk#13349L], Inner, BuildRight, false
         :                          :     :     :- Filter ((isnotnull(inv_item_sk#13310L) AND isnotnull(inv_warehouse_sk#13311L)) AND isnotnull(inv_date_sk#13309L))
         :                          :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13309L,inv_item_sk#13310L,inv_warehouse_sk#13311L,inv_quantity_on_hand#13312] Batched: true, DataFilters: [isnotnull(inv_item_sk#13310L), isnotnull(inv_warehouse_sk#13311L), isnotnull(inv_date_sk#13309L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(inv_date_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
         :                          :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14093]
         :                          :     :        +- Project [d_date_sk#13349L, d_moy#13357]
         :                          :     :           +- Filter ((((isnotnull(d_year#13355) AND isnotnull(d_moy#13357)) AND (d_year#13355 = 1999)) AND (d_moy#13357 = 4)) AND isnotnull(d_date_sk#13349L))
         :                          :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13349L,d_year#13355,d_moy#13357] Batched: true, DataFilters: [isnotnull(d_year#13355), isnotnull(d_moy#13357), (d_year#13355 = 1999), (d_moy#13357 = 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14097]
         :                          :        +- Filter isnotnull(i_item_sk#13313L)
         :                          :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13313L] Batched: true, DataFilters: [isnotnull(i_item_sk#13313L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint>
         :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14101]
         :                             +- Filter isnotnull(w_warehouse_sk#13335L)
         :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13335L,w_warehouse_name#13337] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#13335L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>
         +- Sort [i_item_sk#13432L ASC NULLS FIRST, w_warehouse_sk#13454L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_item_sk#13432L, w_warehouse_sk#13454L, 3000), ENSURE_REQUIREMENTS, [id=#14130]
               +- Project [w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, mean#13307 AS mean#13408, CASE WHEN (mean#13307 = 0.0) THEN null ELSE (stdev#13306 / mean#13307) END AS cov#13409]
                  +- Filter ((isnotnull(stdev#13306) AND isnotnull(mean#13307)) AND (NOT coalesce((mean#13307 = 0.0), false) AND ((stdev#13306 / mean#13307) > 1.0)))
                     +- HashAggregate(keys=[w_warehouse_name#13456, w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476], functions=[stddev_samp(cast(inv_quantity_on_hand#13431 as double)), avg(inv_quantity_on_hand#13431)], output=[w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, stdev#13306, mean#13307])
                        +- Exchange hashpartitioning(w_warehouse_name#13456, w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, 3000), ENSURE_REQUIREMENTS, [id=#14123]
                           +- HashAggregate(keys=[w_warehouse_name#13456, w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#13431 as double)), partial_avg(inv_quantity_on_hand#13431)], output=[w_warehouse_name#13456, w_warehouse_sk#13454L, i_item_sk#13432L, d_moy#13476, n#13501, avg#13502, m2#13503, sum#13519, count#13520L])
                              +- Project [inv_quantity_on_hand#13431, i_item_sk#13432L, w_warehouse_sk#13454L, w_warehouse_name#13456, d_moy#13476]
                                 +- BroadcastHashJoin [inv_warehouse_sk#13430L], [w_warehouse_sk#13454L], Inner, BuildRight, false
                                    :- Project [inv_warehouse_sk#13430L, inv_quantity_on_hand#13431, d_moy#13476, i_item_sk#13432L]
                                    :  +- BroadcastHashJoin [inv_item_sk#13429L], [i_item_sk#13432L], Inner, BuildRight, false
                                    :     :- Project [inv_item_sk#13429L, inv_warehouse_sk#13430L, inv_quantity_on_hand#13431, d_moy#13476]
                                    :     :  +- BroadcastHashJoin [inv_date_sk#13428L], [d_date_sk#13468L], Inner, BuildRight, false
                                    :     :     :- Filter ((isnotnull(inv_item_sk#13429L) AND isnotnull(inv_warehouse_sk#13430L)) AND isnotnull(inv_date_sk#13428L))
                                    :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13428L,inv_item_sk#13429L,inv_warehouse_sk#13430L,inv_quantity_on_hand#13431] Batched: true, DataFilters: [isnotnull(inv_item_sk#13429L), isnotnull(inv_warehouse_sk#13430L), isnotnull(inv_date_sk#13428L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(inv_date_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14110]
                                    :     :        +- Project [d_date_sk#13468L, d_moy#13476]
                                    :     :           +- Filter ((((isnotnull(d_year#13474) AND isnotnull(d_moy#13476)) AND (d_year#13474 = 1999)) AND (d_moy#13476 = 5)) AND isnotnull(d_date_sk#13468L))
                                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13468L,d_year#13474,d_moy#13476] Batched: true, DataFilters: [isnotnull(d_year#13474), isnotnull(d_moy#13476), (d_year#13474 = 1999), (d_moy#13476 = 5), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,5), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14114]
                                    :        +- Filter isnotnull(i_item_sk#13432L)
                                    :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13432L] Batched: true, DataFilters: [isnotnull(i_item_sk#13432L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint>
                                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14118]
                                       +- Filter isnotnull(w_warehouse_sk#13454L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13454L,w_warehouse_name#13456] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#13454L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>

read query: spark_queries/q39b.sql
explain query: q39b
== Parsed Logical Plan ==
CTE [inv]
:  +- 'SubqueryAlias inv
:     +- 'Project ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stdev, 'mean, CASE WHEN ('mean = 0) THEN null ELSE ('stdev / 'mean) END AS cov#13523]
:        +- 'Filter (CASE WHEN ('mean = 0) THEN 0 ELSE ('stdev / 'mean) END > 1)
:           +- 'SubqueryAlias foo
:              +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy], ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stddev_samp('inv_quantity_on_hand) AS stdev#13521, 'avg('inv_quantity_on_hand) AS mean#13522]
:                 +- 'Filter ((('inv_item_sk = 'i_item_sk) AND ('inv_warehouse_sk = 'w_warehouse_sk)) AND (('inv_date_sk = 'd_date_sk) AND ('d_year = 1999)))
:                    +- 'Join Inner
:                       :- 'Join Inner
:                       :  :- 'Join Inner
:                       :  :  :- 'UnresolvedRelation [inventory], [], false
:                       :  :  +- 'UnresolvedRelation [item], [], false
:                       :  +- 'UnresolvedRelation [warehouse], [], false
:                       +- 'UnresolvedRelation [date_dim], [], false
+- 'Sort ['inv1.w_warehouse_sk ASC NULLS FIRST, 'inv1.i_item_sk ASC NULLS FIRST, 'inv1.d_moy ASC NULLS FIRST, 'inv1.mean ASC NULLS FIRST, 'inv1.cov ASC NULLS FIRST, 'inv2.d_moy ASC NULLS FIRST, 'inv2.mean ASC NULLS FIRST, 'inv2.cov ASC NULLS FIRST], true
   +- 'Project ['inv1.w_warehouse_sk, 'inv1.i_item_sk, 'inv1.d_moy, 'inv1.mean, 'inv1.cov, 'inv2.w_warehouse_sk, 'inv2.i_item_sk, 'inv2.d_moy, 'inv2.mean, 'inv2.cov]
      +- 'Filter (((('inv1.i_item_sk = 'inv2.i_item_sk) AND ('inv1.w_warehouse_sk = 'inv2.w_warehouse_sk)) AND ('inv1.d_moy = 4)) AND (('inv2.d_moy = (4 + 1)) AND ('inv1.cov > 1.5)))
         +- 'Join Inner
            :- 'SubqueryAlias inv1
            :  +- 'UnresolvedRelation [inv], [], false
            +- 'SubqueryAlias inv2
               +- 'UnresolvedRelation [inv], [], false

== Analyzed Logical Plan ==
w_warehouse_sk: bigint, i_item_sk: bigint, d_moy: int, mean: double, cov: double, w_warehouse_sk: bigint, i_item_sk: bigint, d_moy: int, mean: double, cov: double
WithCTE
:- CTERelationDef 26
:  +- SubqueryAlias inv
:     +- Project [w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, stdev#13521, mean#13522, CASE WHEN (mean#13522 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#13521 / mean#13522) END AS cov#13523]
:        +- Filter (CASE WHEN (mean#13522 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#13521 / mean#13522) END > cast(1 as double))
:           +- SubqueryAlias foo
:              +- Aggregate [w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572], [w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, stddev_samp(cast(inv_quantity_on_hand#13527 as double)) AS stdev#13521, avg(inv_quantity_on_hand#13527) AS mean#13522]
:                 +- Filter (((inv_item_sk#13525L = i_item_sk#13528L) AND (inv_warehouse_sk#13526L = w_warehouse_sk#13550L)) AND ((inv_date_sk#13524L = d_date_sk#13564L) AND (d_year#13570 = 1999)))
:                    +- Join Inner
:                       :- Join Inner
:                       :  :- Join Inner
:                       :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
:                       :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13524L,inv_item_sk#13525L,inv_warehouse_sk#13526L,inv_quantity_on_hand#13527] orc
:                       :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                       :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13528L,i_item_id#13529,i_rec_start_date#13530,i_rec_end_date#13531,i_item_desc#13532,i_current_price#13533,i_wholesale_cost#13534,i_brand_id#13535,i_brand#13536,i_class_id#13537,i_class#13538,i_category_id#13539,i_category#13540,i_manufact_id#13541,i_manufact#13542,i_size#13543,i_formulation#13544,i_color#13545,i_units#13546,i_container#13547,i_manager_id#13548,i_product_name#13549] orc
:                       :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
:                       :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13550L,w_warehouse_id#13551,w_warehouse_name#13552,w_warehouse_sq_ft#13553,w_street_number#13554,w_street_name#13555,w_street_type#13556,w_suite_number#13557,w_city#13558,w_county#13559,w_state#13560,w_zip#13561,w_country#13562,w_gmt_offset#13563] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13564L,d_date_id#13565,d_date#13566,d_month_seq#13567,d_week_seq#13568,d_quarter_seq#13569,d_year#13570,d_dow#13571,d_moy#13572,d_dom#13573,d_qoy#13574,d_fy_year#13575,d_fy_quarter_seq#13576,d_fy_week_seq#13577,d_day_name#13578,d_quarter_name#13579,d_holiday#13580,d_weekend#13581,d_following_holiday#13582,d_first_dom#13583,d_last_dom#13584,d_same_day_ly#13585,d_same_day_lq#13586,d_current_day#13587,... 4 more fields] orc
+- Sort [w_warehouse_sk#13550L ASC NULLS FIRST, i_item_sk#13528L ASC NULLS FIRST, d_moy#13572 ASC NULLS FIRST, mean#13522 ASC NULLS FIRST, cov#13523 ASC NULLS FIRST, d_moy#13621 ASC NULLS FIRST, mean#13623 ASC NULLS FIRST, cov#13624 ASC NULLS FIRST], true
   +- Project [w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, mean#13522, cov#13523, w_warehouse_sk#13619L, i_item_sk#13620L, d_moy#13621, mean#13623, cov#13624]
      +- Filter ((((i_item_sk#13528L = i_item_sk#13620L) AND (w_warehouse_sk#13550L = w_warehouse_sk#13619L)) AND (d_moy#13572 = 4)) AND ((d_moy#13621 = (4 + 1)) AND (cov#13523 > cast(1.5 as double))))
         +- Join Inner
            :- SubqueryAlias inv1
            :  +- SubqueryAlias inv
            :     +- CTERelationRef 26, true, [w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, stdev#13521, mean#13522, cov#13523]
            +- SubqueryAlias inv2
               +- SubqueryAlias inv
                  +- CTERelationRef 26, true, [w_warehouse_name#13618, w_warehouse_sk#13619L, i_item_sk#13620L, d_moy#13621, stdev#13622, mean#13623, cov#13624]

== Optimized Logical Plan ==
Sort [w_warehouse_sk#13550L ASC NULLS FIRST, i_item_sk#13528L ASC NULLS FIRST, d_moy#13572 ASC NULLS FIRST, mean#13522 ASC NULLS FIRST, cov#13523 ASC NULLS FIRST, d_moy#13691 ASC NULLS FIRST, mean#13623 ASC NULLS FIRST, cov#13624 ASC NULLS FIRST], true
+- Join Inner, ((i_item_sk#13528L = i_item_sk#13647L) AND (w_warehouse_sk#13550L = w_warehouse_sk#13669L))
   :- Project [w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, mean#13522, CASE WHEN (mean#13522 = 0.0) THEN null ELSE (stdev#13521 / mean#13522) END AS cov#13523]
   :  +- Filter ((isnotnull(stdev#13521) AND isnotnull(mean#13522)) AND ((NOT coalesce((mean#13522 = 0.0), false) AND ((stdev#13521 / mean#13522) > 1.0)) AND ((stdev#13521 / mean#13522) > 1.5)))
   :     +- Aggregate [w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572], [w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, stddev_samp(cast(inv_quantity_on_hand#13527 as double)) AS stdev#13521, avg(inv_quantity_on_hand#13527) AS mean#13522]
   :        +- Project [inv_quantity_on_hand#13527, i_item_sk#13528L, w_warehouse_sk#13550L, w_warehouse_name#13552, d_moy#13572]
   :           +- Join Inner, (inv_warehouse_sk#13526L = w_warehouse_sk#13550L)
   :              :- Project [inv_warehouse_sk#13526L, inv_quantity_on_hand#13527, d_moy#13572, i_item_sk#13528L]
   :              :  +- Join Inner, (inv_item_sk#13525L = i_item_sk#13528L)
   :              :     :- Project [inv_item_sk#13525L, inv_warehouse_sk#13526L, inv_quantity_on_hand#13527, d_moy#13572]
   :              :     :  +- Join Inner, (inv_date_sk#13524L = d_date_sk#13564L)
   :              :     :     :- Filter (isnotnull(inv_item_sk#13525L) AND (isnotnull(inv_warehouse_sk#13526L) AND isnotnull(inv_date_sk#13524L)))
   :              :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13524L,inv_item_sk#13525L,inv_warehouse_sk#13526L,inv_quantity_on_hand#13527] orc
   :              :     :     +- Project [d_date_sk#13564L, d_moy#13572]
   :              :     :        +- Filter (((isnotnull(d_year#13570) AND isnotnull(d_moy#13572)) AND ((d_year#13570 = 1999) AND (d_moy#13572 = 4))) AND isnotnull(d_date_sk#13564L))
   :              :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13564L,d_date_id#13565,d_date#13566,d_month_seq#13567,d_week_seq#13568,d_quarter_seq#13569,d_year#13570,d_dow#13571,d_moy#13572,d_dom#13573,d_qoy#13574,d_fy_year#13575,d_fy_quarter_seq#13576,d_fy_week_seq#13577,d_day_name#13578,d_quarter_name#13579,d_holiday#13580,d_weekend#13581,d_following_holiday#13582,d_first_dom#13583,d_last_dom#13584,d_same_day_ly#13585,d_same_day_lq#13586,d_current_day#13587,... 4 more fields] orc
   :              :     +- Project [i_item_sk#13528L]
   :              :        +- Filter isnotnull(i_item_sk#13528L)
   :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13528L,i_item_id#13529,i_rec_start_date#13530,i_rec_end_date#13531,i_item_desc#13532,i_current_price#13533,i_wholesale_cost#13534,i_brand_id#13535,i_brand#13536,i_class_id#13537,i_class#13538,i_category_id#13539,i_category#13540,i_manufact_id#13541,i_manufact#13542,i_size#13543,i_formulation#13544,i_color#13545,i_units#13546,i_container#13547,i_manager_id#13548,i_product_name#13549] orc
   :              +- Project [w_warehouse_sk#13550L, w_warehouse_name#13552]
   :                 +- Filter isnotnull(w_warehouse_sk#13550L)
   :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13550L,w_warehouse_id#13551,w_warehouse_name#13552,w_warehouse_sq_ft#13553,w_street_number#13554,w_street_name#13555,w_street_type#13556,w_suite_number#13557,w_city#13558,w_county#13559,w_state#13560,w_zip#13561,w_country#13562,w_gmt_offset#13563] orc
   +- Project [w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, mean#13522 AS mean#13623, CASE WHEN (mean#13522 = 0.0) THEN null ELSE (stdev#13521 / mean#13522) END AS cov#13624]
      +- Filter ((isnotnull(stdev#13521) AND isnotnull(mean#13522)) AND (NOT coalesce((mean#13522 = 0.0), false) AND ((stdev#13521 / mean#13522) > 1.0)))
         +- Aggregate [w_warehouse_name#13671, w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691], [w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, stddev_samp(cast(inv_quantity_on_hand#13646 as double)) AS stdev#13521, avg(inv_quantity_on_hand#13646) AS mean#13522]
            +- Project [inv_quantity_on_hand#13646, i_item_sk#13647L, w_warehouse_sk#13669L, w_warehouse_name#13671, d_moy#13691]
               +- Join Inner, (inv_warehouse_sk#13645L = w_warehouse_sk#13669L)
                  :- Project [inv_warehouse_sk#13645L, inv_quantity_on_hand#13646, d_moy#13691, i_item_sk#13647L]
                  :  +- Join Inner, (inv_item_sk#13644L = i_item_sk#13647L)
                  :     :- Project [inv_item_sk#13644L, inv_warehouse_sk#13645L, inv_quantity_on_hand#13646, d_moy#13691]
                  :     :  +- Join Inner, (inv_date_sk#13643L = d_date_sk#13683L)
                  :     :     :- Filter (isnotnull(inv_item_sk#13644L) AND (isnotnull(inv_warehouse_sk#13645L) AND isnotnull(inv_date_sk#13643L)))
                  :     :     :  +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13643L,inv_item_sk#13644L,inv_warehouse_sk#13645L,inv_quantity_on_hand#13646] orc
                  :     :     +- Project [d_date_sk#13683L, d_moy#13691]
                  :     :        +- Filter (((isnotnull(d_year#13689) AND isnotnull(d_moy#13691)) AND ((d_year#13689 = 1999) AND (d_moy#13691 = 5))) AND isnotnull(d_date_sk#13683L))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13683L,d_date_id#13684,d_date#13685,d_month_seq#13686,d_week_seq#13687,d_quarter_seq#13688,d_year#13689,d_dow#13690,d_moy#13691,d_dom#13692,d_qoy#13693,d_fy_year#13694,d_fy_quarter_seq#13695,d_fy_week_seq#13696,d_day_name#13697,d_quarter_name#13698,d_holiday#13699,d_weekend#13700,d_following_holiday#13701,d_first_dom#13702,d_last_dom#13703,d_same_day_ly#13704,d_same_day_lq#13705,d_current_day#13706,... 4 more fields] orc
                  :     +- Project [i_item_sk#13647L]
                  :        +- Filter isnotnull(i_item_sk#13647L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13647L,i_item_id#13648,i_rec_start_date#13649,i_rec_end_date#13650,i_item_desc#13651,i_current_price#13652,i_wholesale_cost#13653,i_brand_id#13654,i_brand#13655,i_class_id#13656,i_class#13657,i_category_id#13658,i_category#13659,i_manufact_id#13660,i_manufact#13661,i_size#13662,i_formulation#13663,i_color#13664,i_units#13665,i_container#13666,i_manager_id#13667,i_product_name#13668] orc
                  +- Project [w_warehouse_sk#13669L, w_warehouse_name#13671]
                     +- Filter isnotnull(w_warehouse_sk#13669L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13669L,w_warehouse_id#13670,w_warehouse_name#13671,w_warehouse_sq_ft#13672,w_street_number#13673,w_street_name#13674,w_street_type#13675,w_suite_number#13676,w_city#13677,w_county#13678,w_state#13679,w_zip#13680,w_country#13681,w_gmt_offset#13682] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [w_warehouse_sk#13550L ASC NULLS FIRST, i_item_sk#13528L ASC NULLS FIRST, d_moy#13572 ASC NULLS FIRST, mean#13522 ASC NULLS FIRST, cov#13523 ASC NULLS FIRST, d_moy#13691 ASC NULLS FIRST, mean#13623 ASC NULLS FIRST, cov#13624 ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(w_warehouse_sk#13550L ASC NULLS FIRST, i_item_sk#13528L ASC NULLS FIRST, d_moy#13572 ASC NULLS FIRST, mean#13522 ASC NULLS FIRST, cov#13523 ASC NULLS FIRST, d_moy#13691 ASC NULLS FIRST, mean#13623 ASC NULLS FIRST, cov#13624 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#14351]
      +- SortMergeJoin [i_item_sk#13528L, w_warehouse_sk#13550L], [i_item_sk#13647L, w_warehouse_sk#13669L], Inner
         :- Sort [i_item_sk#13528L ASC NULLS FIRST, w_warehouse_sk#13550L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(i_item_sk#13528L, w_warehouse_sk#13550L, 3000), ENSURE_REQUIREMENTS, [id=#14345]
         :     +- Project [w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, mean#13522, CASE WHEN (mean#13522 = 0.0) THEN null ELSE (stdev#13521 / mean#13522) END AS cov#13523]
         :        +- Filter ((isnotnull(stdev#13521) AND isnotnull(mean#13522)) AND ((NOT coalesce((mean#13522 = 0.0), false) AND ((stdev#13521 / mean#13522) > 1.0)) AND ((stdev#13521 / mean#13522) > 1.5)))
         :           +- HashAggregate(keys=[w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572], functions=[stddev_samp(cast(inv_quantity_on_hand#13527 as double)), avg(inv_quantity_on_hand#13527)], output=[w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, stdev#13521, mean#13522])
         :              +- Exchange hashpartitioning(w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, 3000), ENSURE_REQUIREMENTS, [id=#14322]
         :                 +- HashAggregate(keys=[w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#13527 as double)), partial_avg(inv_quantity_on_hand#13527)], output=[w_warehouse_name#13552, w_warehouse_sk#13550L, i_item_sk#13528L, d_moy#13572, n#13615, avg#13616, m2#13617, sum#13722, count#13723L])
         :                    +- Project [inv_quantity_on_hand#13527, i_item_sk#13528L, w_warehouse_sk#13550L, w_warehouse_name#13552, d_moy#13572]
         :                       +- BroadcastHashJoin [inv_warehouse_sk#13526L], [w_warehouse_sk#13550L], Inner, BuildRight, false
         :                          :- Project [inv_warehouse_sk#13526L, inv_quantity_on_hand#13527, d_moy#13572, i_item_sk#13528L]
         :                          :  +- BroadcastHashJoin [inv_item_sk#13525L], [i_item_sk#13528L], Inner, BuildRight, false
         :                          :     :- Project [inv_item_sk#13525L, inv_warehouse_sk#13526L, inv_quantity_on_hand#13527, d_moy#13572]
         :                          :     :  +- BroadcastHashJoin [inv_date_sk#13524L], [d_date_sk#13564L], Inner, BuildRight, false
         :                          :     :     :- Filter ((isnotnull(inv_item_sk#13525L) AND isnotnull(inv_warehouse_sk#13526L)) AND isnotnull(inv_date_sk#13524L))
         :                          :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13524L,inv_item_sk#13525L,inv_warehouse_sk#13526L,inv_quantity_on_hand#13527] Batched: true, DataFilters: [isnotnull(inv_item_sk#13525L), isnotnull(inv_warehouse_sk#13526L), isnotnull(inv_date_sk#13524L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(inv_date_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
         :                          :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14309]
         :                          :     :        +- Project [d_date_sk#13564L, d_moy#13572]
         :                          :     :           +- Filter ((((isnotnull(d_year#13570) AND isnotnull(d_moy#13572)) AND (d_year#13570 = 1999)) AND (d_moy#13572 = 4)) AND isnotnull(d_date_sk#13564L))
         :                          :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13564L,d_year#13570,d_moy#13572] Batched: true, DataFilters: [isnotnull(d_year#13570), isnotnull(d_moy#13572), (d_year#13570 = 1999), (d_moy#13572 = 4), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14313]
         :                          :        +- Filter isnotnull(i_item_sk#13528L)
         :                          :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13528L] Batched: true, DataFilters: [isnotnull(i_item_sk#13528L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint>
         :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14317]
         :                             +- Filter isnotnull(w_warehouse_sk#13550L)
         :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13550L,w_warehouse_name#13552] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#13550L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>
         +- Sort [i_item_sk#13647L ASC NULLS FIRST, w_warehouse_sk#13669L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_item_sk#13647L, w_warehouse_sk#13669L, 3000), ENSURE_REQUIREMENTS, [id=#14346]
               +- Project [w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, mean#13522 AS mean#13623, CASE WHEN (mean#13522 = 0.0) THEN null ELSE (stdev#13521 / mean#13522) END AS cov#13624]
                  +- Filter ((isnotnull(stdev#13521) AND isnotnull(mean#13522)) AND (NOT coalesce((mean#13522 = 0.0), false) AND ((stdev#13521 / mean#13522) > 1.0)))
                     +- HashAggregate(keys=[w_warehouse_name#13671, w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691], functions=[stddev_samp(cast(inv_quantity_on_hand#13646 as double)), avg(inv_quantity_on_hand#13646)], output=[w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, stdev#13521, mean#13522])
                        +- Exchange hashpartitioning(w_warehouse_name#13671, w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, 3000), ENSURE_REQUIREMENTS, [id=#14339]
                           +- HashAggregate(keys=[w_warehouse_name#13671, w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#13646 as double)), partial_avg(inv_quantity_on_hand#13646)], output=[w_warehouse_name#13671, w_warehouse_sk#13669L, i_item_sk#13647L, d_moy#13691, n#13716, avg#13717, m2#13718, sum#13734, count#13735L])
                              +- Project [inv_quantity_on_hand#13646, i_item_sk#13647L, w_warehouse_sk#13669L, w_warehouse_name#13671, d_moy#13691]
                                 +- BroadcastHashJoin [inv_warehouse_sk#13645L], [w_warehouse_sk#13669L], Inner, BuildRight, false
                                    :- Project [inv_warehouse_sk#13645L, inv_quantity_on_hand#13646, d_moy#13691, i_item_sk#13647L]
                                    :  +- BroadcastHashJoin [inv_item_sk#13644L], [i_item_sk#13647L], Inner, BuildRight, false
                                    :     :- Project [inv_item_sk#13644L, inv_warehouse_sk#13645L, inv_quantity_on_hand#13646, d_moy#13691]
                                    :     :  +- BroadcastHashJoin [inv_date_sk#13643L], [d_date_sk#13683L], Inner, BuildRight, false
                                    :     :     :- Filter ((isnotnull(inv_item_sk#13644L) AND isnotnull(inv_warehouse_sk#13645L)) AND isnotnull(inv_date_sk#13643L))
                                    :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#13643L,inv_item_sk#13644L,inv_warehouse_sk#13645L,inv_quantity_on_hand#13646] Batched: true, DataFilters: [isnotnull(inv_item_sk#13644L), isnotnull(inv_warehouse_sk#13645L), isnotnull(inv_date_sk#13643L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(inv_date_sk)], ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14326]
                                    :     :        +- Project [d_date_sk#13683L, d_moy#13691]
                                    :     :           +- Filter ((((isnotnull(d_year#13689) AND isnotnull(d_moy#13691)) AND (d_year#13689 = 1999)) AND (d_moy#13691 = 5)) AND isnotnull(d_date_sk#13683L))
                                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13683L,d_year#13689,d_moy#13691] Batched: true, DataFilters: [isnotnull(d_year#13689), isnotnull(d_moy#13691), (d_year#13689 = 1999), (d_moy#13691 = 5), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,5), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14330]
                                    :        +- Filter isnotnull(i_item_sk#13647L)
                                    :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13647L] Batched: true, DataFilters: [isnotnull(i_item_sk#13647L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint>
                                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14334]
                                       +- Filter isnotnull(w_warehouse_sk#13669L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13669L,w_warehouse_name#13671] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#13669L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>

read query: spark_queries/q40.sql
explain query: q40
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['w_state ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true
      +- 'Aggregate ['w_state, 'i_item_id], ['w_state, 'i_item_id, 'sum(CASE WHEN (cast('d_date as date) < cast(1998-04-08 as date)) THEN ('cs_sales_price - 'coalesce('cr_refunded_cash, 0)) ELSE 0 END) AS sales_before#13736, 'sum(CASE WHEN (cast('d_date as date) >= cast(1998-04-08 as date)) THEN ('cs_sales_price - 'coalesce('cr_refunded_cash, 0)) ELSE 0 END) AS sales_after#13737]
         +- 'Filter ((((('i_current_price >= 0.99) AND ('i_current_price <= 1.49)) AND ('i_item_sk = 'cs_item_sk)) AND ('cs_warehouse_sk = 'w_warehouse_sk)) AND (('cs_sold_date_sk = 'd_date_sk) AND (('d_date >= (cast(1998-04-08 as date) - INTERVAL '30' DAY)) AND ('d_date <= (cast(1998-04-08 as date) + INTERVAL '30' DAY)))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join LeftOuter, (('cs_order_number = 'cr_order_number) AND ('cs_item_sk = 'cr_item_sk))
               :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  +- 'UnresolvedRelation [catalog_returns], [], false
               :  :  +- 'UnresolvedRelation [warehouse], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
w_state: string, i_item_id: string, sales_before: double, sales_after: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_state#13809 ASC NULLS FIRST, i_item_id#13814 ASC NULLS FIRST], true
      +- Aggregate [w_state#13809, i_item_id#13814], [w_state#13809, i_item_id#13814, sum(CASE WHEN (cast(d_date#13837 as date) < cast(1998-04-08 as date)) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, cast(0 as double))) ELSE cast(0 as double) END) AS sales_before#13736, sum(CASE WHEN (cast(d_date#13837 as date) >= cast(1998-04-08 as date)) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, cast(0 as double))) ELSE cast(0 as double) END) AS sales_after#13737]
         +- Filter (((((i_current_price#13818 >= cast(0.99 as double)) AND (i_current_price#13818 <= cast(1.49 as double))) AND (i_item_sk#13813L = cs_item_sk#13752L)) AND (cs_warehouse_sk#13751L = w_warehouse_sk#13799L)) AND ((cs_sold_date_sk#13771L = d_date_sk#13835L) AND ((d_date#13837 >= date_add(cast(1998-04-08 as date), -extractansiintervaldays(INTERVAL '30' DAY))) AND (d_date#13837 <= date_add(cast(1998-04-08 as date), extractansiintervaldays(INTERVAL '30' DAY))))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join LeftOuter, ((cs_order_number#13754L = cr_order_number#13787L) AND (cs_item_sk#13752L = cr_item_sk#13773L))
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13738L,cs_ship_date_sk#13739L,cs_bill_customer_sk#13740L,cs_bill_cdemo_sk#13741L,cs_bill_hdemo_sk#13742L,cs_bill_addr_sk#13743L,cs_ship_customer_sk#13744L,cs_ship_cdemo_sk#13745L,cs_ship_hdemo_sk#13746L,cs_ship_addr_sk#13747L,cs_call_center_sk#13748L,cs_catalog_page_sk#13749L,cs_ship_mode_sk#13750L,cs_warehouse_sk#13751L,cs_item_sk#13752L,cs_promo_sk#13753L,cs_order_number#13754L,cs_quantity#13755,cs_wholesale_cost#13756,cs_list_price#13757,cs_sales_price#13758,cs_ext_discount_amt#13759,cs_ext_sales_price#13760,cs_ext_wholesale_cost#13761,... 10 more fields] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#13772L,cr_item_sk#13773L,cr_refunded_customer_sk#13774L,cr_refunded_cdemo_sk#13775L,cr_refunded_hdemo_sk#13776L,cr_refunded_addr_sk#13777L,cr_returning_customer_sk#13778L,cr_returning_cdemo_sk#13779L,cr_returning_hdemo_sk#13780L,cr_returning_addr_sk#13781L,cr_call_center_sk#13782L,cr_catalog_page_sk#13783L,cr_ship_mode_sk#13784L,cr_warehouse_sk#13785L,cr_reason_sk#13786L,cr_order_number#13787L,cr_return_quantity#13788,cr_return_amount#13789,cr_return_tax#13790,cr_return_amt_inc_tax#13791,cr_fee#13792,cr_return_ship_cost#13793,cr_refunded_cash#13794,cr_reversed_charge#13795,... 3 more fields] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13799L,w_warehouse_id#13800,w_warehouse_name#13801,w_warehouse_sq_ft#13802,w_street_number#13803,w_street_name#13804,w_street_type#13805,w_suite_number#13806,w_city#13807,w_county#13808,w_state#13809,w_zip#13810,w_country#13811,w_gmt_offset#13812] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13813L,i_item_id#13814,i_rec_start_date#13815,i_rec_end_date#13816,i_item_desc#13817,i_current_price#13818,i_wholesale_cost#13819,i_brand_id#13820,i_brand#13821,i_class_id#13822,i_class#13823,i_category_id#13824,i_category#13825,i_manufact_id#13826,i_manufact#13827,i_size#13828,i_formulation#13829,i_color#13830,i_units#13831,i_container#13832,i_manager_id#13833,i_product_name#13834] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13835L,d_date_id#13836,d_date#13837,d_month_seq#13838,d_week_seq#13839,d_quarter_seq#13840,d_year#13841,d_dow#13842,d_moy#13843,d_dom#13844,d_qoy#13845,d_fy_year#13846,d_fy_quarter_seq#13847,d_fy_week_seq#13848,d_day_name#13849,d_quarter_name#13850,d_holiday#13851,d_weekend#13852,d_following_holiday#13853,d_first_dom#13854,d_last_dom#13855,d_same_day_ly#13856,d_same_day_lq#13857,d_current_day#13858,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_state#13809 ASC NULLS FIRST, i_item_id#13814 ASC NULLS FIRST], true
      +- Aggregate [w_state#13809, i_item_id#13814], [w_state#13809, i_item_id#13814, sum(CASE WHEN (d_date#13837 < 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END) AS sales_before#13736, sum(CASE WHEN (d_date#13837 >= 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END) AS sales_after#13737]
         +- Project [cs_sales_price#13758, cr_refunded_cash#13794, w_state#13809, i_item_id#13814, d_date#13837]
            +- Join Inner, (cs_warehouse_sk#13751L = w_warehouse_sk#13799L)
               :- Project [cs_warehouse_sk#13751L, cs_sales_price#13758, cr_refunded_cash#13794, i_item_id#13814, d_date#13837]
               :  +- Join Inner, (cs_sold_date_sk#13771L = d_date_sk#13835L)
               :     :- Project [cs_warehouse_sk#13751L, cs_sales_price#13758, cs_sold_date_sk#13771L, cr_refunded_cash#13794, i_item_id#13814]
               :     :  +- Join Inner, (i_item_sk#13813L = cs_item_sk#13752L)
               :     :     :- Project [cs_warehouse_sk#13751L, cs_item_sk#13752L, cs_sales_price#13758, cs_sold_date_sk#13771L, cr_refunded_cash#13794]
               :     :     :  +- Join LeftOuter, ((cs_order_number#13754L = cr_order_number#13787L) AND (cs_item_sk#13752L = cr_item_sk#13773L))
               :     :     :     :- Project [cs_warehouse_sk#13751L, cs_item_sk#13752L, cs_order_number#13754L, cs_sales_price#13758, cs_sold_date_sk#13771L]
               :     :     :     :  +- Filter (((isnotnull(cs_warehouse_sk#13751L) AND isnotnull(cs_item_sk#13752L)) AND isnotnull(cs_sold_date_sk#13771L)) AND dynamicpruning#13869 [cs_sold_date_sk#13771L])
               :     :     :     :     :  +- Project [d_date_sk#13835L, d_date#13837]
               :     :     :     :     :     +- Filter ((isnotnull(d_date#13837) AND ((d_date#13837 >= 1998-03-09) AND (d_date#13837 <= 1998-05-08))) AND isnotnull(d_date_sk#13835L))
               :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13835L,d_date_id#13836,d_date#13837,d_month_seq#13838,d_week_seq#13839,d_quarter_seq#13840,d_year#13841,d_dow#13842,d_moy#13843,d_dom#13844,d_qoy#13845,d_fy_year#13846,d_fy_quarter_seq#13847,d_fy_week_seq#13848,d_day_name#13849,d_quarter_name#13850,d_holiday#13851,d_weekend#13852,d_following_holiday#13853,d_first_dom#13854,d_last_dom#13855,d_same_day_ly#13856,d_same_day_lq#13857,d_current_day#13858,... 4 more fields] orc
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#13738L,cs_ship_date_sk#13739L,cs_bill_customer_sk#13740L,cs_bill_cdemo_sk#13741L,cs_bill_hdemo_sk#13742L,cs_bill_addr_sk#13743L,cs_ship_customer_sk#13744L,cs_ship_cdemo_sk#13745L,cs_ship_hdemo_sk#13746L,cs_ship_addr_sk#13747L,cs_call_center_sk#13748L,cs_catalog_page_sk#13749L,cs_ship_mode_sk#13750L,cs_warehouse_sk#13751L,cs_item_sk#13752L,cs_promo_sk#13753L,cs_order_number#13754L,cs_quantity#13755,cs_wholesale_cost#13756,cs_list_price#13757,cs_sales_price#13758,cs_ext_discount_amt#13759,cs_ext_sales_price#13760,cs_ext_wholesale_cost#13761,... 10 more fields] orc
               :     :     :     +- Project [cr_item_sk#13773L, cr_order_number#13787L, cr_refunded_cash#13794]
               :     :     :        +- Filter (isnotnull(cr_order_number#13787L) AND isnotnull(cr_item_sk#13773L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#13772L,cr_item_sk#13773L,cr_refunded_customer_sk#13774L,cr_refunded_cdemo_sk#13775L,cr_refunded_hdemo_sk#13776L,cr_refunded_addr_sk#13777L,cr_returning_customer_sk#13778L,cr_returning_cdemo_sk#13779L,cr_returning_hdemo_sk#13780L,cr_returning_addr_sk#13781L,cr_call_center_sk#13782L,cr_catalog_page_sk#13783L,cr_ship_mode_sk#13784L,cr_warehouse_sk#13785L,cr_reason_sk#13786L,cr_order_number#13787L,cr_return_quantity#13788,cr_return_amount#13789,cr_return_tax#13790,cr_return_amt_inc_tax#13791,cr_fee#13792,cr_return_ship_cost#13793,cr_refunded_cash#13794,cr_reversed_charge#13795,... 3 more fields] orc
               :     :     +- Project [i_item_sk#13813L, i_item_id#13814]
               :     :        +- Filter ((isnotnull(i_current_price#13818) AND ((i_current_price#13818 >= 0.99) AND (i_current_price#13818 <= 1.49))) AND isnotnull(i_item_sk#13813L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13813L,i_item_id#13814,i_rec_start_date#13815,i_rec_end_date#13816,i_item_desc#13817,i_current_price#13818,i_wholesale_cost#13819,i_brand_id#13820,i_brand#13821,i_class_id#13822,i_class#13823,i_category_id#13824,i_category#13825,i_manufact_id#13826,i_manufact#13827,i_size#13828,i_formulation#13829,i_color#13830,i_units#13831,i_container#13832,i_manager_id#13833,i_product_name#13834] orc
               :     +- Project [d_date_sk#13835L, d_date#13837]
               :        +- Filter ((isnotnull(d_date#13837) AND ((d_date#13837 >= 1998-03-09) AND (d_date#13837 <= 1998-05-08))) AND isnotnull(d_date_sk#13835L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13835L,d_date_id#13836,d_date#13837,d_month_seq#13838,d_week_seq#13839,d_quarter_seq#13840,d_year#13841,d_dow#13842,d_moy#13843,d_dom#13844,d_qoy#13845,d_fy_year#13846,d_fy_quarter_seq#13847,d_fy_week_seq#13848,d_day_name#13849,d_quarter_name#13850,d_holiday#13851,d_weekend#13852,d_following_holiday#13853,d_first_dom#13854,d_last_dom#13855,d_same_day_ly#13856,d_same_day_lq#13857,d_current_day#13858,... 4 more fields] orc
               +- Project [w_warehouse_sk#13799L, w_state#13809]
                  +- Filter isnotnull(w_warehouse_sk#13799L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13799L,w_warehouse_id#13800,w_warehouse_name#13801,w_warehouse_sq_ft#13802,w_street_number#13803,w_street_name#13804,w_street_type#13805,w_suite_number#13806,w_city#13807,w_county#13808,w_state#13809,w_zip#13810,w_country#13811,w_gmt_offset#13812] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[w_state#13809 ASC NULLS FIRST,i_item_id#13814 ASC NULLS FIRST], output=[w_state#13809,i_item_id#13814,sales_before#13736,sales_after#13737])
   +- HashAggregate(keys=[w_state#13809, i_item_id#13814], functions=[sum(CASE WHEN (d_date#13837 < 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END), sum(CASE WHEN (d_date#13837 >= 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END)], output=[w_state#13809, i_item_id#13814, sales_before#13736, sales_after#13737])
      +- Exchange hashpartitioning(w_state#13809, i_item_id#13814, 3000), ENSURE_REQUIREMENTS, [id=#14487]
         +- HashAggregate(keys=[w_state#13809, i_item_id#13814], functions=[partial_sum(CASE WHEN (d_date#13837 < 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END), partial_sum(CASE WHEN (d_date#13837 >= 1998-04-08) THEN (cs_sales_price#13758 - coalesce(cr_refunded_cash#13794, 0.0)) ELSE 0.0 END)], output=[w_state#13809, i_item_id#13814, sum#13872, sum#13873])
            +- Project [cs_sales_price#13758, cr_refunded_cash#13794, w_state#13809, i_item_id#13814, d_date#13837]
               +- BroadcastHashJoin [cs_warehouse_sk#13751L], [w_warehouse_sk#13799L], Inner, BuildRight, false
                  :- Project [cs_warehouse_sk#13751L, cs_sales_price#13758, cr_refunded_cash#13794, i_item_id#13814, d_date#13837]
                  :  +- BroadcastHashJoin [cs_sold_date_sk#13771L], [d_date_sk#13835L], Inner, BuildRight, false
                  :     :- Project [cs_warehouse_sk#13751L, cs_sales_price#13758, cs_sold_date_sk#13771L, cr_refunded_cash#13794, i_item_id#13814]
                  :     :  +- BroadcastHashJoin [cs_item_sk#13752L], [i_item_sk#13813L], Inner, BuildRight, false
                  :     :     :- Project [cs_warehouse_sk#13751L, cs_item_sk#13752L, cs_sales_price#13758, cs_sold_date_sk#13771L, cr_refunded_cash#13794]
                  :     :     :  +- SortMergeJoin [cs_order_number#13754L, cs_item_sk#13752L], [cr_order_number#13787L, cr_item_sk#13773L], LeftOuter
                  :     :     :     :- Sort [cs_order_number#13754L ASC NULLS FIRST, cs_item_sk#13752L ASC NULLS FIRST], false, 0
                  :     :     :     :  +- Exchange hashpartitioning(cs_order_number#13754L, cs_item_sk#13752L, 3000), ENSURE_REQUIREMENTS, [id=#14467]
                  :     :     :     :     +- Filter (isnotnull(cs_warehouse_sk#13751L) AND isnotnull(cs_item_sk#13752L))
                  :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_warehouse_sk#13751L,cs_item_sk#13752L,cs_order_number#13754L,cs_sales_price#13758,cs_sold_date_sk#13771L] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#13751L), isnotnull(cs_item_sk#13752L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#13771L), dynamicpruningexpression(cs_sold_date_sk#13771L IN dynamicpru..., PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_warehouse_sk:bigint,cs_item_sk:bigint,cs_order_number:bigint,cs_sales_price:double>
                  :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#13869, 0, true, Project [d_date_sk#13835L, d_date#13837], [d_date_sk#13835L]
                  :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :     :     :     :                    +- Filter (((isnotnull(d_date#13837) AND (d_date#13837 >= 1998-03-09)) AND (d_date#13837 <= 1998-05-08)) AND isnotnull(d_date_sk#13835L))
                  :     :     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13835L,d_date#13837] Batched: true, DataFilters: [isnotnull(d_date#13837), (d_date#13837 >= 1998-03-09), (d_date#13837 <= 1998-05-08), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-09), LessThanOrEqual(d_date,1998-05-08), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :     :     :     +- Sort [cr_order_number#13787L ASC NULLS FIRST, cr_item_sk#13773L ASC NULLS FIRST], false, 0
                  :     :     :        +- Exchange hashpartitioning(cr_order_number#13787L, cr_item_sk#13773L, 3000), ENSURE_REQUIREMENTS, [id=#14468]
                  :     :     :           +- Project [cr_item_sk#13773L, cr_order_number#13787L, cr_refunded_cash#13794]
                  :     :     :              +- Filter (isnotnull(cr_order_number#13787L) AND isnotnull(cr_item_sk#13773L))
                  :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#13773L,cr_order_number#13787L,cr_refunded_cash#13794,cr_returned_date_sk#13798L] Batched: true, DataFilters: [isnotnull(cr_order_number#13787L), isnotnull(cr_item_sk#13773L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_refunded_cash:double>
                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14474]
                  :     :        +- Project [i_item_sk#13813L, i_item_id#13814]
                  :     :           +- Filter (((isnotnull(i_current_price#13818) AND (i_current_price#13818 >= 0.99)) AND (i_current_price#13818 <= 1.49)) AND isnotnull(i_item_sk#13813L))
                  :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13813L,i_item_id#13814,i_current_price#13818] Batched: true, DataFilters: [isnotnull(i_current_price#13818), (i_current_price#13818 >= 0.99), (i_current_price#13818 <= 1.4..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_current_price:double>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14478]
                  :        +- Filter (((isnotnull(d_date#13837) AND (d_date#13837 >= 1998-03-09)) AND (d_date#13837 <= 1998-05-08)) AND isnotnull(d_date_sk#13835L))
                  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13835L,d_date#13837] Batched: true, DataFilters: [isnotnull(d_date#13837), (d_date#13837 >= 1998-03-09), (d_date#13837 <= 1998-05-08), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-09), LessThanOrEqual(d_date,1998-05-08), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#14482]
                     +- Filter isnotnull(w_warehouse_sk#13799L)
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#13799L,w_state#13809] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#13799L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_state:string>

read query: spark_queries/q41.sql
explain query: q41
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_product_name ASC NULLS FIRST], true
      +- 'Distinct
         +- 'Project ['i_product_name]
            +- 'Filter ((('i_manufact_id >= 742) AND ('i_manufact_id <= (742 + 40))) AND (scalar-subquery#13875 [] > 0))
               :  +- 'Project ['count(1) AS item_cnt#13874]
               :     +- 'Filter ((('i_manufact = 'i1.i_manufact) AND ((((('i_category = Women) AND (('i_color = orchid) OR ('i_color = papaya))) AND ((('i_units = Pound) OR ('i_units = Lb)) AND (('i_size = petite) OR ('i_size = medium)))) OR ((('i_category = Women) AND (('i_color = burlywood) OR ('i_color = navy))) AND ((('i_units = Bundle) OR ('i_units = Each)) AND (('i_size = N/A) OR ('i_size = extra large))))) OR (((('i_category = Men) AND (('i_color = bisque) OR ('i_color = azure))) AND ((('i_units = N/A) OR ('i_units = Tsp)) AND (('i_size = small) OR ('i_size = large)))) OR ((('i_category = Men) AND (('i_color = chocolate) OR ('i_color = cornflower))) AND ((('i_units = Bunch) OR ('i_units = Gross)) AND (('i_size = petite) OR ('i_size = medium))))))) OR (('i_manufact = 'i1.i_manufact) AND ((((('i_category = Women) AND (('i_color = salmon) OR ('i_color = midnight))) AND ((('i_units = Oz) OR ('i_units = Box)) AND (('i_size = petite) OR ('i_size = medium)))) OR ((('i_category = Women) AND (('i_color = snow) OR ('i_color = steel))) AND ((('i_units = Carton) OR ('i_units = Tbl)) AND (('i_size = N/A) OR ('i_size = extra large))))) OR (((('i_category = Men) AND (('i_color = purple) OR ('i_color = gainsboro))) AND ((('i_units = Dram) OR ('i_units = Unknown)) AND (('i_size = small) OR ('i_size = large)))) OR ((('i_category = Men) AND (('i_color = metallic) OR ('i_color = forest))) AND ((('i_units = Gram) OR ('i_units = Ounce)) AND (('i_size = petite) OR ('i_size = medium))))))))
               :        +- 'UnresolvedRelation [item], [], false
               +- 'SubqueryAlias i1
                  +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_product_name: string
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_product_name#13897 ASC NULLS FIRST], true
      +- Distinct
         +- Project [i_product_name#13897]
            +- Filter (((i_manufact_id#13889 >= 742) AND (i_manufact_id#13889 <= (742 + 40))) AND (scalar-subquery#13875 [i_manufact#13890 && i_manufact#13890] > cast(0 as bigint)))
               :  +- Aggregate [count(1) AS item_cnt#13874L]
               :     +- Filter (((i_manufact#13913 = outer(i_manufact#13890)) AND (((((i_category#13911 = Women) AND ((i_color#13916 = orchid) OR (i_color#13916 = papaya))) AND (((i_units#13917 = Pound) OR (i_units#13917 = Lb)) AND ((i_size#13914 = petite) OR (i_size#13914 = medium)))) OR (((i_category#13911 = Women) AND ((i_color#13916 = burlywood) OR (i_color#13916 = navy))) AND (((i_units#13917 = Bundle) OR (i_units#13917 = Each)) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((((i_category#13911 = Men) AND ((i_color#13916 = bisque) OR (i_color#13916 = azure))) AND (((i_units#13917 = N/A) OR (i_units#13917 = Tsp)) AND ((i_size#13914 = small) OR (i_size#13914 = large)))) OR (((i_category#13911 = Men) AND ((i_color#13916 = chocolate) OR (i_color#13916 = cornflower))) AND (((i_units#13917 = Bunch) OR (i_units#13917 = Gross)) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))))))) OR ((i_manufact#13913 = outer(i_manufact#13890)) AND (((((i_category#13911 = Women) AND ((i_color#13916 = salmon) OR (i_color#13916 = midnight))) AND (((i_units#13917 = Oz) OR (i_units#13917 = Box)) AND ((i_size#13914 = petite) OR (i_size#13914 = medium)))) OR (((i_category#13911 = Women) AND ((i_color#13916 = snow) OR (i_color#13916 = steel))) AND (((i_units#13917 = Carton) OR (i_units#13917 = Tbl)) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((((i_category#13911 = Men) AND ((i_color#13916 = purple) OR (i_color#13916 = gainsboro))) AND (((i_units#13917 = Dram) OR (i_units#13917 = Unknown)) AND ((i_size#13914 = small) OR (i_size#13914 = large)))) OR (((i_category#13911 = Men) AND ((i_color#13916 = metallic) OR (i_color#13916 = forest))) AND (((i_units#13917 = Gram) OR (i_units#13917 = Ounce)) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))))))))
               :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13899L,i_item_id#13900,i_rec_start_date#13901,i_rec_end_date#13902,i_item_desc#13903,i_current_price#13904,i_wholesale_cost#13905,i_brand_id#13906,i_brand#13907,i_class_id#13908,i_class#13909,i_category_id#13910,i_category#13911,i_manufact_id#13912,i_manufact#13913,i_size#13914,i_formulation#13915,i_color#13916,i_units#13917,i_container#13918,i_manager_id#13919,i_product_name#13920] orc
               +- SubqueryAlias i1
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13876L,i_item_id#13877,i_rec_start_date#13878,i_rec_end_date#13879,i_item_desc#13880,i_current_price#13881,i_wholesale_cost#13882,i_brand_id#13883,i_brand#13884,i_class_id#13885,i_class#13886,i_category_id#13887,i_category#13888,i_manufact_id#13889,i_manufact#13890,i_size#13891,i_formulation#13892,i_color#13893,i_units#13894,i_container#13895,i_manager_id#13896,i_product_name#13897] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_product_name#13897 ASC NULLS FIRST], true
      +- Aggregate [i_product_name#13897], [i_product_name#13897]
         +- Project [i_product_name#13897]
            +- Join Inner, (i_manufact#13913 = i_manufact#13890)
               :- Project [i_manufact#13890, i_product_name#13897]
               :  +- Filter ((isnotnull(i_manufact_id#13889) AND ((i_manufact_id#13889 >= 742) AND (i_manufact_id#13889 <= 782))) AND isnotnull(i_manufact#13890))
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13876L,i_item_id#13877,i_rec_start_date#13878,i_rec_end_date#13879,i_item_desc#13880,i_current_price#13881,i_wholesale_cost#13882,i_brand_id#13883,i_brand#13884,i_class_id#13885,i_class#13886,i_category_id#13887,i_category#13888,i_manufact_id#13889,i_manufact#13890,i_size#13891,i_formulation#13892,i_color#13893,i_units#13894,i_container#13895,i_manager_id#13896,i_product_name#13897] orc
               +- Project [i_manufact#13913]
                  +- Filter (item_cnt#13874L > 0)
                     +- Aggregate [i_manufact#13913], [count(1) AS item_cnt#13874L, i_manufact#13913]
                        +- Project [i_manufact#13913]
                           +- Filter (((((i_category#13911 = Women) AND (((((i_color#13916 = orchid) OR (i_color#13916 = papaya)) AND ((i_units#13917 = Pound) OR (i_units#13917 = Lb))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))) OR ((((i_color#13916 = burlywood) OR (i_color#13916 = navy)) AND ((i_units#13917 = Bundle) OR (i_units#13917 = Each))) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((i_category#13911 = Men) AND (((((i_color#13916 = bisque) OR (i_color#13916 = azure)) AND ((i_units#13917 = N/A) OR (i_units#13917 = Tsp))) AND ((i_size#13914 = small) OR (i_size#13914 = large))) OR ((((i_color#13916 = chocolate) OR (i_color#13916 = cornflower)) AND ((i_units#13917 = Bunch) OR (i_units#13917 = Gross))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium)))))) OR (((i_category#13911 = Women) AND (((((i_color#13916 = salmon) OR (i_color#13916 = midnight)) AND ((i_units#13917 = Oz) OR (i_units#13917 = Box))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))) OR ((((i_color#13916 = snow) OR (i_color#13916 = steel)) AND ((i_units#13917 = Carton) OR (i_units#13917 = Tbl))) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((i_category#13911 = Men) AND (((((i_color#13916 = purple) OR (i_color#13916 = gainsboro)) AND ((i_units#13917 = Dram) OR (i_units#13917 = Unknown))) AND ((i_size#13914 = small) OR (i_size#13914 = large))) OR ((((i_color#13916 = metallic) OR (i_color#13916 = forest)) AND ((i_units#13917 = Gram) OR (i_units#13917 = Ounce))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))))))) AND isnotnull(i_manufact#13913))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13899L,i_item_id#13900,i_rec_start_date#13901,i_rec_end_date#13902,i_item_desc#13903,i_current_price#13904,i_wholesale_cost#13905,i_brand_id#13906,i_brand#13907,i_class_id#13908,i_class#13909,i_category_id#13910,i_category#13911,i_manufact_id#13912,i_manufact#13913,i_size#13914,i_formulation#13915,i_color#13916,i_units#13917,i_container#13918,i_manager_id#13919,i_product_name#13920] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_product_name#13897 ASC NULLS FIRST], output=[i_product_name#13897])
   +- HashAggregate(keys=[i_product_name#13897], functions=[], output=[i_product_name#13897])
      +- Exchange hashpartitioning(i_product_name#13897, 3000), ENSURE_REQUIREMENTS, [id=#14549]
         +- HashAggregate(keys=[i_product_name#13897], functions=[], output=[i_product_name#13897])
            +- Project [i_product_name#13897]
               +- BroadcastHashJoin [i_manufact#13890], [i_manufact#13913], Inner, BuildRight, false
                  :- Project [i_manufact#13890, i_product_name#13897]
                  :  +- Filter (((isnotnull(i_manufact_id#13889) AND (i_manufact_id#13889 >= 742)) AND (i_manufact_id#13889 <= 782)) AND isnotnull(i_manufact#13890))
                  :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_manufact_id#13889,i_manufact#13890,i_product_name#13897] Batched: true, DataFilters: [isnotnull(i_manufact_id#13889), (i_manufact_id#13889 >= 742), (i_manufact_id#13889 <= 782), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), GreaterThanOrEqual(i_manufact_id,742), LessThanOrEqual(i_manufact_id,7..., ReadSchema: struct<i_manufact_id:int,i_manufact:string,i_product_name:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#14544]
                     +- Project [i_manufact#13913]
                        +- Filter (item_cnt#13874L > 0)
                           +- HashAggregate(keys=[i_manufact#13913], functions=[count(1)], output=[item_cnt#13874L, i_manufact#13913])
                              +- Exchange hashpartitioning(i_manufact#13913, 3000), ENSURE_REQUIREMENTS, [id=#14539]
                                 +- HashAggregate(keys=[i_manufact#13913], functions=[partial_count(1)], output=[i_manufact#13913, count#13925L])
                                    +- Project [i_manufact#13913]
                                       +- Filter (((((i_category#13911 = Women) AND (((((i_color#13916 = orchid) OR (i_color#13916 = papaya)) AND ((i_units#13917 = Pound) OR (i_units#13917 = Lb))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))) OR ((((i_color#13916 = burlywood) OR (i_color#13916 = navy)) AND ((i_units#13917 = Bundle) OR (i_units#13917 = Each))) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((i_category#13911 = Men) AND (((((i_color#13916 = bisque) OR (i_color#13916 = azure)) AND ((i_units#13917 = N/A) OR (i_units#13917 = Tsp))) AND ((i_size#13914 = small) OR (i_size#13914 = large))) OR ((((i_color#13916 = chocolate) OR (i_color#13916 = cornflower)) AND ((i_units#13917 = Bunch) OR (i_units#13917 = Gross))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium)))))) OR (((i_category#13911 = Women) AND (((((i_color#13916 = salmon) OR (i_color#13916 = midnight)) AND ((i_units#13917 = Oz) OR (i_units#13917 = Box))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))) OR ((((i_color#13916 = snow) OR (i_color#13916 = steel)) AND ((i_units#13917 = Carton) OR (i_units#13917 = Tbl))) AND ((i_size#13914 = N/A) OR (i_size#13914 = extra large))))) OR ((i_category#13911 = Men) AND (((((i_color#13916 = purple) OR (i_color#13916 = gainsboro)) AND ((i_units#13917 = Dram) OR (i_units#13917 = Unknown))) AND ((i_size#13914 = small) OR (i_size#13914 = large))) OR ((((i_color#13916 = metallic) OR (i_color#13916 = forest)) AND ((i_units#13917 = Gram) OR (i_units#13917 = Ounce))) AND ((i_size#13914 = petite) OR (i_size#13914 = medium))))))) AND isnotnull(i_manufact#13913))
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_category#13911,i_manufact#13913,i_size#13914,i_color#13916,i_units#13917] Batched: true, DataFilters: [((((i_category#13911 = Women) AND (((((i_color#13916 = orchid) OR (i_color#13916 = papaya)) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(i_category,Women),Or(And(And(Or(EqualTo(i_color,orchid),EqualTo(i_color,papaya..., ReadSchema: struct<i_category:string,i_manufact:string,i_size:string,i_color:string,i_units:string>

read query: spark_queries/q42.sql
explain query: q42
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['sum('ss_ext_sales_price) DESC NULLS LAST, 'dt.d_year ASC NULLS FIRST, 'item.i_category_id ASC NULLS FIRST, 'item.i_category ASC NULLS FIRST], true
      +- 'Aggregate ['dt.d_year, 'item.i_category_id, 'item.i_category], ['dt.d_year, 'item.i_category_id, 'item.i_category, unresolvedalias('sum('ss_ext_sales_price), None)]
         +- 'Filter (((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) AND ('store_sales.ss_item_sk = 'item.i_item_sk)) AND ('item.i_manager_id = 1)) AND (('dt.d_moy = 12) AND ('dt.d_year = 1998)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias dt
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store_sales], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
d_year: int, i_category_id: int, i_category: string, sum(ss_ext_sales_price): double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [sum(ss_ext_sales_price)#14000 DESC NULLS LAST, d_year#13932 ASC NULLS FIRST, i_category_id#13988 ASC NULLS FIRST, i_category#13989 ASC NULLS FIRST], true
      +- Aggregate [d_year#13932, i_category_id#13988, i_category#13989], [d_year#13932, i_category_id#13988, i_category#13989, sum(ss_ext_sales_price#13968) AS sum(ss_ext_sales_price)#14000]
         +- Filter ((((d_date_sk#13926L = ss_sold_date_sk#13976L) AND (ss_item_sk#13955L = i_item_sk#13977L)) AND (i_manager_id#13997 = 1)) AND ((d_moy#13934 = 12) AND (d_year#13932 = 1998)))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias dt
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13926L,d_date_id#13927,d_date#13928,d_month_seq#13929,d_week_seq#13930,d_quarter_seq#13931,d_year#13932,d_dow#13933,d_moy#13934,d_dom#13935,d_qoy#13936,d_fy_year#13937,d_fy_quarter_seq#13938,d_fy_week_seq#13939,d_day_name#13940,d_quarter_name#13941,d_holiday#13942,d_weekend#13943,d_following_holiday#13944,d_first_dom#13945,d_last_dom#13946,d_same_day_ly#13947,d_same_day_lq#13948,d_current_day#13949,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#13954L,ss_item_sk#13955L,ss_customer_sk#13956L,ss_cdemo_sk#13957L,ss_hdemo_sk#13958L,ss_addr_sk#13959L,ss_store_sk#13960L,ss_promo_sk#13961L,ss_ticket_number#13962L,ss_quantity#13963,ss_wholesale_cost#13964,ss_list_price#13965,ss_sales_price#13966,ss_ext_discount_amt#13967,ss_ext_sales_price#13968,ss_ext_wholesale_cost#13969,ss_ext_list_price#13970,ss_ext_tax#13971,ss_coupon_amt#13972,ss_net_paid#13973,ss_net_paid_inc_tax#13974,ss_net_profit#13975,ss_sold_date_sk#13976L] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13977L,i_item_id#13978,i_rec_start_date#13979,i_rec_end_date#13980,i_item_desc#13981,i_current_price#13982,i_wholesale_cost#13983,i_brand_id#13984,i_brand#13985,i_class_id#13986,i_class#13987,i_category_id#13988,i_category#13989,i_manufact_id#13990,i_manufact#13991,i_size#13992,i_formulation#13993,i_color#13994,i_units#13995,i_container#13996,i_manager_id#13997,i_product_name#13998] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [sum(ss_ext_sales_price)#14000 DESC NULLS LAST, d_year#13932 ASC NULLS FIRST, i_category_id#13988 ASC NULLS FIRST, i_category#13989 ASC NULLS FIRST], true
      +- Aggregate [d_year#13932, i_category_id#13988, i_category#13989], [d_year#13932, i_category_id#13988, i_category#13989, sum(ss_ext_sales_price#13968) AS sum(ss_ext_sales_price)#14000]
         +- Project [d_year#13932, ss_ext_sales_price#13968, i_category_id#13988, i_category#13989]
            +- Join Inner, (d_date_sk#13926L = ss_sold_date_sk#13976L)
               :- Project [ss_ext_sales_price#13968, ss_sold_date_sk#13976L, i_category_id#13988, i_category#13989]
               :  +- Join Inner, (ss_item_sk#13955L = i_item_sk#13977L)
               :     :- Project [ss_item_sk#13955L, ss_ext_sales_price#13968, ss_sold_date_sk#13976L]
               :     :  +- Filter ((isnotnull(ss_sold_date_sk#13976L) AND isnotnull(ss_item_sk#13955L)) AND dynamicpruning#14006 [ss_sold_date_sk#13976L])
               :     :     :  +- Project [d_date_sk#13926L, d_year#13932]
               :     :     :     +- Filter (((isnotnull(d_moy#13934) AND isnotnull(d_year#13932)) AND ((d_moy#13934 = 12) AND (d_year#13932 = 1998))) AND isnotnull(d_date_sk#13926L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13926L,d_date_id#13927,d_date#13928,d_month_seq#13929,d_week_seq#13930,d_quarter_seq#13931,d_year#13932,d_dow#13933,d_moy#13934,d_dom#13935,d_qoy#13936,d_fy_year#13937,d_fy_quarter_seq#13938,d_fy_week_seq#13939,d_day_name#13940,d_quarter_name#13941,d_holiday#13942,d_weekend#13943,d_following_holiday#13944,d_first_dom#13945,d_last_dom#13946,d_same_day_ly#13947,d_same_day_lq#13948,d_current_day#13949,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#13954L,ss_item_sk#13955L,ss_customer_sk#13956L,ss_cdemo_sk#13957L,ss_hdemo_sk#13958L,ss_addr_sk#13959L,ss_store_sk#13960L,ss_promo_sk#13961L,ss_ticket_number#13962L,ss_quantity#13963,ss_wholesale_cost#13964,ss_list_price#13965,ss_sales_price#13966,ss_ext_discount_amt#13967,ss_ext_sales_price#13968,ss_ext_wholesale_cost#13969,ss_ext_list_price#13970,ss_ext_tax#13971,ss_coupon_amt#13972,ss_net_paid#13973,ss_net_paid_inc_tax#13974,ss_net_profit#13975,ss_sold_date_sk#13976L] orc
               :     +- Project [i_item_sk#13977L, i_category_id#13988, i_category#13989]
               :        +- Filter ((isnotnull(i_manager_id#13997) AND (i_manager_id#13997 = 1)) AND isnotnull(i_item_sk#13977L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13977L,i_item_id#13978,i_rec_start_date#13979,i_rec_end_date#13980,i_item_desc#13981,i_current_price#13982,i_wholesale_cost#13983,i_brand_id#13984,i_brand#13985,i_class_id#13986,i_class#13987,i_category_id#13988,i_category#13989,i_manufact_id#13990,i_manufact#13991,i_size#13992,i_formulation#13993,i_color#13994,i_units#13995,i_container#13996,i_manager_id#13997,i_product_name#13998] orc
               +- Project [d_date_sk#13926L, d_year#13932]
                  +- Filter (((isnotnull(d_moy#13934) AND isnotnull(d_year#13932)) AND ((d_moy#13934 = 12) AND (d_year#13932 = 1998))) AND isnotnull(d_date_sk#13926L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13926L,d_date_id#13927,d_date#13928,d_month_seq#13929,d_week_seq#13930,d_quarter_seq#13931,d_year#13932,d_dow#13933,d_moy#13934,d_dom#13935,d_qoy#13936,d_fy_year#13937,d_fy_quarter_seq#13938,d_fy_week_seq#13939,d_day_name#13940,d_quarter_name#13941,d_holiday#13942,d_weekend#13943,d_following_holiday#13944,d_first_dom#13945,d_last_dom#13946,d_same_day_ly#13947,d_same_day_lq#13948,d_current_day#13949,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[sum(ss_ext_sales_price)#14000 DESC NULLS LAST,d_year#13932 ASC NULLS FIRST,i_category_id#13988 ASC NULLS FIRST,i_category#13989 ASC NULLS FIRST], output=[d_year#13932,i_category_id#13988,i_category#13989,sum(ss_ext_sales_price)#14000])
   +- HashAggregate(keys=[d_year#13932, i_category_id#13988, i_category#13989], functions=[sum(ss_ext_sales_price#13968)], output=[d_year#13932, i_category_id#13988, i_category#13989, sum(ss_ext_sales_price)#14000])
      +- Exchange hashpartitioning(d_year#13932, i_category_id#13988, i_category#13989, 3000), ENSURE_REQUIREMENTS, [id=#14634]
         +- HashAggregate(keys=[d_year#13932, i_category_id#13988, i_category#13989], functions=[partial_sum(ss_ext_sales_price#13968)], output=[d_year#13932, i_category_id#13988, i_category#13989, sum#14008])
            +- Project [d_year#13932, ss_ext_sales_price#13968, i_category_id#13988, i_category#13989]
               +- BroadcastHashJoin [ss_sold_date_sk#13976L], [d_date_sk#13926L], Inner, BuildRight, false
                  :- Project [ss_ext_sales_price#13968, ss_sold_date_sk#13976L, i_category_id#13988, i_category#13989]
                  :  +- BroadcastHashJoin [ss_item_sk#13955L], [i_item_sk#13977L], Inner, BuildRight, false
                  :     :- Filter isnotnull(ss_item_sk#13955L)
                  :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#13955L,ss_ext_sales_price#13968,ss_sold_date_sk#13976L] Batched: true, DataFilters: [isnotnull(ss_item_sk#13955L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#13976L), dynamicpruningexpression(ss_sold_date_sk#13976L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
                  :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#14006, 0, true, Project [d_date_sk#13926L, d_year#13932], [d_date_sk#13926L]
                  :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              +- Project [d_date_sk#13926L, d_year#13932]
                  :     :                 +- Filter ((((isnotnull(d_moy#13934) AND isnotnull(d_year#13932)) AND (d_moy#13934 = 12)) AND (d_year#13932 = 1998)) AND isnotnull(d_date_sk#13926L))
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13926L,d_year#13932,d_moy#13934] Batched: true, DataFilters: [isnotnull(d_moy#13934), isnotnull(d_year#13932), (d_moy#13934 = 12), (d_year#13932 = 1998), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14625]
                  :        +- Project [i_item_sk#13977L, i_category_id#13988, i_category#13989]
                  :           +- Filter ((isnotnull(i_manager_id#13997) AND (i_manager_id#13997 = 1)) AND isnotnull(i_item_sk#13977L))
                  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#13977L,i_category_id#13988,i_category#13989,i_manager_id#13997] Batched: true, DataFilters: [isnotnull(i_manager_id#13997), (i_manager_id#13997 = 1), isnotnull(i_item_sk#13977L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category_id:int,i_category:string,i_manager_id:int>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14629]
                     +- Project [d_date_sk#13926L, d_year#13932]
                        +- Filter ((((isnotnull(d_moy#13934) AND isnotnull(d_year#13932)) AND (d_moy#13934 = 12)) AND (d_year#13932 = 1998)) AND isnotnull(d_date_sk#13926L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#13926L,d_year#13932,d_moy#13934] Batched: true, DataFilters: [isnotnull(d_moy#13934), isnotnull(d_year#13932), (d_moy#13934 = 12), (d_year#13932 = 1998), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q43.sql
explain query: q43
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['s_store_name ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 'sun_sales ASC NULLS FIRST, 'mon_sales ASC NULLS FIRST, 'tue_sales ASC NULLS FIRST, 'wed_sales ASC NULLS FIRST, 'thu_sales ASC NULLS FIRST, 'fri_sales ASC NULLS FIRST, 'sat_sales ASC NULLS FIRST], true
      +- 'Aggregate ['s_store_name, 's_store_id], ['s_store_name, 's_store_id, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'ss_sales_price ELSE null END) AS sun_sales#14009, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'ss_sales_price ELSE null END) AS mon_sales#14010, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'ss_sales_price ELSE null END) AS tue_sales#14011, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'ss_sales_price ELSE null END) AS wed_sales#14012, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'ss_sales_price ELSE null END) AS thu_sales#14013, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'ss_sales_price ELSE null END) AS fri_sales#14014, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'ss_sales_price ELSE null END) AS sat_sales#14015]
         +- 'Filter ((('d_date_sk = 'ss_sold_date_sk) AND ('s_store_sk = 'ss_store_sk)) AND (('s_gmt_offset = -6) AND ('d_year = 1998)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store_sales], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
s_store_name: string, s_store_id: string, sun_sales: double, mon_sales: double, tue_sales: double, wed_sales: double, thu_sales: double, fri_sales: double, sat_sales: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#14072 ASC NULLS FIRST, s_store_id#14068 ASC NULLS FIRST, sun_sales#14009 ASC NULLS FIRST, mon_sales#14010 ASC NULLS FIRST, tue_sales#14011 ASC NULLS FIRST, wed_sales#14012 ASC NULLS FIRST, thu_sales#14013 ASC NULLS FIRST, fri_sales#14014 ASC NULLS FIRST, sat_sales#14015 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#14072, s_store_id#14068], [s_store_name#14072, s_store_id#14068, sum(CASE WHEN (d_day_name#14030 = Sunday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS sun_sales#14009, sum(CASE WHEN (d_day_name#14030 = Monday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS mon_sales#14010, sum(CASE WHEN (d_day_name#14030 = Tuesday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS tue_sales#14011, sum(CASE WHEN (d_day_name#14030 = Wednesday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS wed_sales#14012, sum(CASE WHEN (d_day_name#14030 = Thursday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS thu_sales#14013, sum(CASE WHEN (d_day_name#14030 = Friday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS fri_sales#14014, sum(CASE WHEN (d_day_name#14030 = Saturday) THEN ss_sales_price#14056 ELSE cast(null as double) END) AS sat_sales#14015]
         +- Filter (((d_date_sk#14016L = ss_sold_date_sk#14066L) AND (s_store_sk#14067L = ss_store_sk#14050L)) AND ((s_gmt_offset#14094 = cast(-6 as double)) AND (d_year#14022 = 1998)))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14016L,d_date_id#14017,d_date#14018,d_month_seq#14019,d_week_seq#14020,d_quarter_seq#14021,d_year#14022,d_dow#14023,d_moy#14024,d_dom#14025,d_qoy#14026,d_fy_year#14027,d_fy_quarter_seq#14028,d_fy_week_seq#14029,d_day_name#14030,d_quarter_name#14031,d_holiday#14032,d_weekend#14033,d_following_holiday#14034,d_first_dom#14035,d_last_dom#14036,d_same_day_ly#14037,d_same_day_lq#14038,d_current_day#14039,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14044L,ss_item_sk#14045L,ss_customer_sk#14046L,ss_cdemo_sk#14047L,ss_hdemo_sk#14048L,ss_addr_sk#14049L,ss_store_sk#14050L,ss_promo_sk#14051L,ss_ticket_number#14052L,ss_quantity#14053,ss_wholesale_cost#14054,ss_list_price#14055,ss_sales_price#14056,ss_ext_discount_amt#14057,ss_ext_sales_price#14058,ss_ext_wholesale_cost#14059,ss_ext_list_price#14060,ss_ext_tax#14061,ss_coupon_amt#14062,ss_net_paid#14063,ss_net_paid_inc_tax#14064,ss_net_profit#14065,ss_sold_date_sk#14066L] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14067L,s_store_id#14068,s_rec_start_date#14069,s_rec_end_date#14070,s_closed_date_sk#14071L,s_store_name#14072,s_number_employees#14073,s_floor_space#14074,s_hours#14075,s_manager#14076,s_market_id#14077,s_geography_class#14078,s_market_desc#14079,s_market_manager#14080,s_division_id#14081,s_division_name#14082,s_company_id#14083,s_company_name#14084,s_street_number#14085,s_street_name#14086,s_street_type#14087,s_suite_number#14088,s_city#14089,s_county#14090,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#14072 ASC NULLS FIRST, s_store_id#14068 ASC NULLS FIRST, sun_sales#14009 ASC NULLS FIRST, mon_sales#14010 ASC NULLS FIRST, tue_sales#14011 ASC NULLS FIRST, wed_sales#14012 ASC NULLS FIRST, thu_sales#14013 ASC NULLS FIRST, fri_sales#14014 ASC NULLS FIRST, sat_sales#14015 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#14072, s_store_id#14068], [s_store_name#14072, s_store_id#14068, sum(CASE WHEN (d_day_name#14030 = Sunday) THEN ss_sales_price#14056 END) AS sun_sales#14009, sum(CASE WHEN (d_day_name#14030 = Monday) THEN ss_sales_price#14056 END) AS mon_sales#14010, sum(CASE WHEN (d_day_name#14030 = Tuesday) THEN ss_sales_price#14056 END) AS tue_sales#14011, sum(CASE WHEN (d_day_name#14030 = Wednesday) THEN ss_sales_price#14056 END) AS wed_sales#14012, sum(CASE WHEN (d_day_name#14030 = Thursday) THEN ss_sales_price#14056 END) AS thu_sales#14013, sum(CASE WHEN (d_day_name#14030 = Friday) THEN ss_sales_price#14056 END) AS fri_sales#14014, sum(CASE WHEN (d_day_name#14030 = Saturday) THEN ss_sales_price#14056 END) AS sat_sales#14015]
         +- Project [d_day_name#14030, ss_sales_price#14056, s_store_id#14068, s_store_name#14072]
            +- Join Inner, (s_store_sk#14067L = ss_store_sk#14050L)
               :- Project [d_day_name#14030, ss_store_sk#14050L, ss_sales_price#14056]
               :  +- Join Inner, (d_date_sk#14016L = ss_sold_date_sk#14066L)
               :     :- Project [d_date_sk#14016L, d_day_name#14030]
               :     :  +- Filter ((isnotnull(d_year#14022) AND (d_year#14022 = 1998)) AND isnotnull(d_date_sk#14016L))
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14016L,d_date_id#14017,d_date#14018,d_month_seq#14019,d_week_seq#14020,d_quarter_seq#14021,d_year#14022,d_dow#14023,d_moy#14024,d_dom#14025,d_qoy#14026,d_fy_year#14027,d_fy_quarter_seq#14028,d_fy_week_seq#14029,d_day_name#14030,d_quarter_name#14031,d_holiday#14032,d_weekend#14033,d_following_holiday#14034,d_first_dom#14035,d_last_dom#14036,d_same_day_ly#14037,d_same_day_lq#14038,d_current_day#14039,... 4 more fields] orc
               :     +- Project [ss_store_sk#14050L, ss_sales_price#14056, ss_sold_date_sk#14066L]
               :        +- Filter ((isnotnull(ss_sold_date_sk#14066L) AND isnotnull(ss_store_sk#14050L)) AND dynamicpruning#14112 [ss_sold_date_sk#14066L])
               :           :  +- Project [d_date_sk#14016L, d_day_name#14030]
               :           :     +- Filter ((isnotnull(d_year#14022) AND (d_year#14022 = 1998)) AND isnotnull(d_date_sk#14016L))
               :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14016L,d_date_id#14017,d_date#14018,d_month_seq#14019,d_week_seq#14020,d_quarter_seq#14021,d_year#14022,d_dow#14023,d_moy#14024,d_dom#14025,d_qoy#14026,d_fy_year#14027,d_fy_quarter_seq#14028,d_fy_week_seq#14029,d_day_name#14030,d_quarter_name#14031,d_holiday#14032,d_weekend#14033,d_following_holiday#14034,d_first_dom#14035,d_last_dom#14036,d_same_day_ly#14037,d_same_day_lq#14038,d_current_day#14039,... 4 more fields] orc
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14044L,ss_item_sk#14045L,ss_customer_sk#14046L,ss_cdemo_sk#14047L,ss_hdemo_sk#14048L,ss_addr_sk#14049L,ss_store_sk#14050L,ss_promo_sk#14051L,ss_ticket_number#14052L,ss_quantity#14053,ss_wholesale_cost#14054,ss_list_price#14055,ss_sales_price#14056,ss_ext_discount_amt#14057,ss_ext_sales_price#14058,ss_ext_wholesale_cost#14059,ss_ext_list_price#14060,ss_ext_tax#14061,ss_coupon_amt#14062,ss_net_paid#14063,ss_net_paid_inc_tax#14064,ss_net_profit#14065,ss_sold_date_sk#14066L] orc
               +- Project [s_store_sk#14067L, s_store_id#14068, s_store_name#14072]
                  +- Filter ((isnotnull(s_gmt_offset#14094) AND (s_gmt_offset#14094 = -6.0)) AND isnotnull(s_store_sk#14067L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14067L,s_store_id#14068,s_rec_start_date#14069,s_rec_end_date#14070,s_closed_date_sk#14071L,s_store_name#14072,s_number_employees#14073,s_floor_space#14074,s_hours#14075,s_manager#14076,s_market_id#14077,s_geography_class#14078,s_market_desc#14079,s_market_manager#14080,s_division_id#14081,s_division_name#14082,s_company_id#14083,s_company_name#14084,s_street_number#14085,s_street_name#14086,s_street_type#14087,s_suite_number#14088,s_city#14089,s_county#14090,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name#14072 ASC NULLS FIRST,s_store_id#14068 ASC NULLS FIRST,sun_sales#14009 ASC NULLS FIRST,mon_sales#14010 ASC NULLS FIRST,tue_sales#14011 ASC NULLS FIRST,wed_sales#14012 ASC NULLS FIRST,thu_sales#14013 ASC NULLS FIRST,fri_sales#14014 ASC NULLS FIRST,sat_sales#14015 ASC NULLS FIRST], output=[s_store_name#14072,s_store_id#14068,sun_sales#14009,mon_sales#14010,tue_sales#14011,wed_sales#14012,thu_sales#14013,fri_sales#14014,sat_sales#14015])
   +- HashAggregate(keys=[s_store_name#14072, s_store_id#14068], functions=[sum(CASE WHEN (d_day_name#14030 = Sunday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Monday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Tuesday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Wednesday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Thursday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Friday) THEN ss_sales_price#14056 END), sum(CASE WHEN (d_day_name#14030 = Saturday) THEN ss_sales_price#14056 END)], output=[s_store_name#14072, s_store_id#14068, sun_sales#14009, mon_sales#14010, tue_sales#14011, wed_sales#14012, thu_sales#14013, fri_sales#14014, sat_sales#14015])
      +- Exchange hashpartitioning(s_store_name#14072, s_store_id#14068, 3000), ENSURE_REQUIREMENTS, [id=#14719]
         +- HashAggregate(keys=[s_store_name#14072, s_store_id#14068], functions=[partial_sum(CASE WHEN (d_day_name#14030 = Sunday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Monday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Tuesday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Wednesday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Thursday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Friday) THEN ss_sales_price#14056 END), partial_sum(CASE WHEN (d_day_name#14030 = Saturday) THEN ss_sales_price#14056 END)], output=[s_store_name#14072, s_store_id#14068, sum#14120, sum#14121, sum#14122, sum#14123, sum#14124, sum#14125, sum#14126])
            +- Project [d_day_name#14030, ss_sales_price#14056, s_store_id#14068, s_store_name#14072]
               +- BroadcastHashJoin [ss_store_sk#14050L], [s_store_sk#14067L], Inner, BuildRight, false
                  :- Project [d_day_name#14030, ss_store_sk#14050L, ss_sales_price#14056]
                  :  +- BroadcastHashJoin [d_date_sk#14016L], [ss_sold_date_sk#14066L], Inner, BuildLeft, false
                  :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14710]
                  :     :  +- Project [d_date_sk#14016L, d_day_name#14030]
                  :     :     +- Filter ((isnotnull(d_year#14022) AND (d_year#14022 = 1998)) AND isnotnull(d_date_sk#14016L))
                  :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14016L,d_year#14022,d_day_name#14030] Batched: true, DataFilters: [isnotnull(d_year#14022), (d_year#14022 = 1998), isnotnull(d_date_sk#14016L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_day_name:string>
                  :     +- Filter isnotnull(ss_store_sk#14050L)
                  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#14050L,ss_sales_price#14056,ss_sold_date_sk#14066L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14050L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#14066L), dynamicpruningexpression(ss_sold_date_sk#14066L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_sales_price:double>
                  :              +- SubqueryAdaptiveBroadcast dynamicpruning#14112, 0, true, Project [d_date_sk#14016L, d_day_name#14030], [d_date_sk#14016L]
                  :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :                    +- Project [d_date_sk#14016L, d_day_name#14030]
                  :                       +- Filter ((isnotnull(d_year#14022) AND (d_year#14022 = 1998)) AND isnotnull(d_date_sk#14016L))
                  :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14016L,d_year#14022,d_day_name#14030] Batched: true, DataFilters: [isnotnull(d_year#14022), (d_year#14022 = 1998), isnotnull(d_date_sk#14016L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_day_name:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#14714]
                     +- Project [s_store_sk#14067L, s_store_id#14068, s_store_name#14072]
                        +- Filter ((isnotnull(s_gmt_offset#14094) AND (s_gmt_offset#14094 = -6.0)) AND isnotnull(s_store_sk#14067L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14067L,s_store_id#14068,s_store_name#14072,s_gmt_offset#14094] Batched: true, DataFilters: [isnotnull(s_gmt_offset#14094), (s_gmt_offset#14094 = -6.0), isnotnull(s_store_sk#14067L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_gmt_offset), EqualTo(s_gmt_offset,-6.0), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string,s_store_name:string,s_gmt_offset:double>

read query: spark_queries/q44.sql
explain query: q44
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['asceding.rnk ASC NULLS FIRST], true
      +- 'Project ['asceding.rnk, 'i1.i_product_name AS best_performing#14137, 'i2.i_product_name AS worst_performing#14138]
         +- 'Filter ((('asceding.rnk = 'descending.rnk) AND ('i1.i_item_sk = 'asceding.item_sk)) AND ('i2.i_item_sk = 'descending.item_sk))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'SubqueryAlias asceding
               :  :  :  +- 'Project [*]
               :  :  :     +- 'Filter ('rnk < 11)
               :  :  :        +- 'SubqueryAlias V11
               :  :  :           +- 'Project ['item_sk, 'rank() windowspecdefinition('rank_col ASC NULLS FIRST, unspecifiedframe$()) AS rnk#14131]
               :  :  :              +- 'SubqueryAlias V1
               :  :  :                 +- 'UnresolvedHaving ('avg('ss_net_profit) > (0.9 * scalar-subquery#14130 []))
               :  :  :                    :  +- 'Aggregate ['ss_store_sk], ['avg('ss_net_profit) AS rank_col#14129]
               :  :  :                    :     +- 'Filter (('ss_store_sk = 410) AND isnull('ss_hdemo_sk))
               :  :  :                    :        +- 'UnresolvedRelation [store_sales], [], false
               :  :  :                    +- 'Aggregate ['ss_item_sk], ['ss_item_sk AS item_sk#14127, 'avg('ss_net_profit) AS rank_col#14128]
               :  :  :                       +- 'Filter ('ss_store_sk = 410)
               :  :  :                          +- 'SubqueryAlias ss1
               :  :  :                             +- 'UnresolvedRelation [store_sales], [], false
               :  :  +- 'SubqueryAlias descending
               :  :     +- 'Project [*]
               :  :        +- 'Filter ('rnk < 11)
               :  :           +- 'SubqueryAlias V21
               :  :              +- 'Project ['item_sk, 'rank() windowspecdefinition('rank_col DESC NULLS LAST, unspecifiedframe$()) AS rnk#14136]
               :  :                 +- 'SubqueryAlias V2
               :  :                    +- 'UnresolvedHaving ('avg('ss_net_profit) > (0.9 * scalar-subquery#14135 []))
               :  :                       :  +- 'Aggregate ['ss_store_sk], ['avg('ss_net_profit) AS rank_col#14134]
               :  :                       :     +- 'Filter (('ss_store_sk = 410) AND isnull('ss_hdemo_sk))
               :  :                       :        +- 'UnresolvedRelation [store_sales], [], false
               :  :                       +- 'Aggregate ['ss_item_sk], ['ss_item_sk AS item_sk#14132, 'avg('ss_net_profit) AS rank_col#14133]
               :  :                          +- 'Filter ('ss_store_sk = 410)
               :  :                             +- 'SubqueryAlias ss1
               :  :                                +- 'UnresolvedRelation [store_sales], [], false
               :  +- 'SubqueryAlias i1
               :     +- 'UnresolvedRelation [item], [], false
               +- 'SubqueryAlias i2
                  +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
rnk: int, best_performing: string, worst_performing: string
GlobalLimit 100
+- LocalLimit 100
   +- Sort [rnk#14131 ASC NULLS FIRST], true
      +- Project [rnk#14131, i_product_name#14210 AS best_performing#14137, i_product_name#14232 AS worst_performing#14138]
         +- Filter (((rnk#14131 = rnk#14136) AND (i_item_sk#14189L = item_sk#14127L)) AND (i_item_sk#14211L = item_sk#14132L))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias asceding
               :  :  :  +- Project [item_sk#14127L, rnk#14131]
               :  :  :     +- Filter (rnk#14131 < 11)
               :  :  :        +- SubqueryAlias V11
               :  :  :           +- Project [item_sk#14127L, rnk#14131]
               :  :  :              +- Project [item_sk#14127L, rank_col#14128, rnk#14131, rnk#14131]
               :  :  :                 +- Window [rank(rank_col#14128) windowspecdefinition(rank_col#14128 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14131], [rank_col#14128 ASC NULLS FIRST]
               :  :  :                    +- Project [item_sk#14127L, rank_col#14128]
               :  :  :                       +- SubqueryAlias V1
               :  :  :                          +- Filter (rank_col#14128 > (cast(0.9 as double) * scalar-subquery#14130 []))
               :  :  :                             :  +- Aggregate [ss_store_sk#14241L], [avg(ss_net_profit#14256) AS rank_col#14129]
               :  :  :                             :     +- Filter ((ss_store_sk#14241L = cast(410 as bigint)) AND isnull(ss_hdemo_sk#14239L))
               :  :  :                             :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :                             :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14235L,ss_item_sk#14236L,ss_customer_sk#14237L,ss_cdemo_sk#14238L,ss_hdemo_sk#14239L,ss_addr_sk#14240L,ss_store_sk#14241L,ss_promo_sk#14242L,ss_ticket_number#14243L,ss_quantity#14244,ss_wholesale_cost#14245,ss_list_price#14246,ss_sales_price#14247,ss_ext_discount_amt#14248,ss_ext_sales_price#14249,ss_ext_wholesale_cost#14250,ss_ext_list_price#14251,ss_ext_tax#14252,ss_coupon_amt#14253,ss_net_paid#14254,ss_net_paid_inc_tax#14255,ss_net_profit#14256,ss_sold_date_sk#14257L] orc
               :  :  :                             +- Aggregate [ss_item_sk#14144L], [ss_item_sk#14144L AS item_sk#14127L, avg(ss_net_profit#14164) AS rank_col#14128]
               :  :  :                                +- Filter (ss_store_sk#14149L = cast(410 as bigint))
               :  :  :                                   +- SubqueryAlias ss1
               :  :  :                                      +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :                                         +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14143L,ss_item_sk#14144L,ss_customer_sk#14145L,ss_cdemo_sk#14146L,ss_hdemo_sk#14147L,ss_addr_sk#14148L,ss_store_sk#14149L,ss_promo_sk#14150L,ss_ticket_number#14151L,ss_quantity#14152,ss_wholesale_cost#14153,ss_list_price#14154,ss_sales_price#14155,ss_ext_discount_amt#14156,ss_ext_sales_price#14157,ss_ext_wholesale_cost#14158,ss_ext_list_price#14159,ss_ext_tax#14160,ss_coupon_amt#14161,ss_net_paid#14162,ss_net_paid_inc_tax#14163,ss_net_profit#14164,ss_sold_date_sk#14165L] orc
               :  :  +- SubqueryAlias descending
               :  :     +- Project [item_sk#14132L, rnk#14136]
               :  :        +- Filter (rnk#14136 < 11)
               :  :           +- SubqueryAlias V21
               :  :              +- Project [item_sk#14132L, rnk#14136]
               :  :                 +- Project [item_sk#14132L, rank_col#14133, rnk#14136, rnk#14136]
               :  :                    +- Window [rank(rank_col#14133) windowspecdefinition(rank_col#14133 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14136], [rank_col#14133 DESC NULLS LAST]
               :  :                       +- Project [item_sk#14132L, rank_col#14133]
               :  :                          +- SubqueryAlias V2
               :  :                             +- Filter (rank_col#14133 > (cast(0.9 as double) * scalar-subquery#14135 []))
               :  :                                :  +- Aggregate [ss_store_sk#14265L], [avg(ss_net_profit#14280) AS rank_col#14134]
               :  :                                :     +- Filter ((ss_store_sk#14265L = cast(410 as bigint)) AND isnull(ss_hdemo_sk#14263L))
               :  :                                :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :                                :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14259L,ss_item_sk#14260L,ss_customer_sk#14261L,ss_cdemo_sk#14262L,ss_hdemo_sk#14263L,ss_addr_sk#14264L,ss_store_sk#14265L,ss_promo_sk#14266L,ss_ticket_number#14267L,ss_quantity#14268,ss_wholesale_cost#14269,ss_list_price#14270,ss_sales_price#14271,ss_ext_discount_amt#14272,ss_ext_sales_price#14273,ss_ext_wholesale_cost#14274,ss_ext_list_price#14275,ss_ext_tax#14276,ss_coupon_amt#14277,ss_net_paid#14278,ss_net_paid_inc_tax#14279,ss_net_profit#14280,ss_sold_date_sk#14281L] orc
               :  :                                +- Aggregate [ss_item_sk#14167L], [ss_item_sk#14167L AS item_sk#14132L, avg(ss_net_profit#14187) AS rank_col#14133]
               :  :                                   +- Filter (ss_store_sk#14172L = cast(410 as bigint))
               :  :                                      +- SubqueryAlias ss1
               :  :                                         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :                                            +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14166L,ss_item_sk#14167L,ss_customer_sk#14168L,ss_cdemo_sk#14169L,ss_hdemo_sk#14170L,ss_addr_sk#14171L,ss_store_sk#14172L,ss_promo_sk#14173L,ss_ticket_number#14174L,ss_quantity#14175,ss_wholesale_cost#14176,ss_list_price#14177,ss_sales_price#14178,ss_ext_discount_amt#14179,ss_ext_sales_price#14180,ss_ext_wholesale_cost#14181,ss_ext_list_price#14182,ss_ext_tax#14183,ss_coupon_amt#14184,ss_net_paid#14185,ss_net_paid_inc_tax#14186,ss_net_profit#14187,ss_sold_date_sk#14188L] orc
               :  +- SubqueryAlias i1
               :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14189L,i_item_id#14190,i_rec_start_date#14191,i_rec_end_date#14192,i_item_desc#14193,i_current_price#14194,i_wholesale_cost#14195,i_brand_id#14196,i_brand#14197,i_class_id#14198,i_class#14199,i_category_id#14200,i_category#14201,i_manufact_id#14202,i_manufact#14203,i_size#14204,i_formulation#14205,i_color#14206,i_units#14207,i_container#14208,i_manager_id#14209,i_product_name#14210] orc
               +- SubqueryAlias i2
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14211L,i_item_id#14212,i_rec_start_date#14213,i_rec_end_date#14214,i_item_desc#14215,i_current_price#14216,i_wholesale_cost#14217,i_brand_id#14218,i_brand#14219,i_class_id#14220,i_class#14221,i_category_id#14222,i_category#14223,i_manufact_id#14224,i_manufact#14225,i_size#14226,i_formulation#14227,i_color#14228,i_units#14229,i_container#14230,i_manager_id#14231,i_product_name#14232] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [rnk#14131 ASC NULLS FIRST], true
      +- Project [rnk#14131, i_product_name#14210 AS best_performing#14137, i_product_name#14232 AS worst_performing#14138]
         +- Join Inner, (i_item_sk#14211L = item_sk#14132L)
            :- Project [rnk#14131, item_sk#14132L, i_product_name#14210]
            :  +- Join Inner, (i_item_sk#14189L = item_sk#14127L)
            :     :- Project [item_sk#14127L, rnk#14131, item_sk#14132L]
            :     :  +- Join Inner, (rnk#14131 = rnk#14136)
            :     :     :- Project [item_sk#14127L, rnk#14131]
            :     :     :  +- Filter ((rnk#14131 < 11) AND isnotnull(item_sk#14127L))
            :     :     :     +- Window [rank(rank_col#14128) windowspecdefinition(rank_col#14128 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14131], [rank_col#14128 ASC NULLS FIRST]
            :     :     :        +- Filter (isnotnull(rank_col#14128) AND (rank_col#14128 > (0.9 * scalar-subquery#14130 [])))
            :     :     :           :  +- Aggregate [ss_store_sk#14241L], [avg(ss_net_profit#14256) AS rank_col#14129]
            :     :     :           :     +- Project [ss_store_sk#14241L, ss_net_profit#14256]
            :     :     :           :        +- Filter (isnotnull(ss_store_sk#14241L) AND ((ss_store_sk#14241L = 410) AND isnull(ss_hdemo_sk#14239L)))
            :     :     :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14235L,ss_item_sk#14236L,ss_customer_sk#14237L,ss_cdemo_sk#14238L,ss_hdemo_sk#14239L,ss_addr_sk#14240L,ss_store_sk#14241L,ss_promo_sk#14242L,ss_ticket_number#14243L,ss_quantity#14244,ss_wholesale_cost#14245,ss_list_price#14246,ss_sales_price#14247,ss_ext_discount_amt#14248,ss_ext_sales_price#14249,ss_ext_wholesale_cost#14250,ss_ext_list_price#14251,ss_ext_tax#14252,ss_coupon_amt#14253,ss_net_paid#14254,ss_net_paid_inc_tax#14255,ss_net_profit#14256,ss_sold_date_sk#14257L] orc
            :     :     :           +- Aggregate [ss_item_sk#14144L], [ss_item_sk#14144L AS item_sk#14127L, avg(ss_net_profit#14164) AS rank_col#14128]
            :     :     :              +- Project [ss_item_sk#14144L, ss_net_profit#14164]
            :     :     :                 +- Filter (isnotnull(ss_store_sk#14149L) AND (ss_store_sk#14149L = 410))
            :     :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14143L,ss_item_sk#14144L,ss_customer_sk#14145L,ss_cdemo_sk#14146L,ss_hdemo_sk#14147L,ss_addr_sk#14148L,ss_store_sk#14149L,ss_promo_sk#14150L,ss_ticket_number#14151L,ss_quantity#14152,ss_wholesale_cost#14153,ss_list_price#14154,ss_sales_price#14155,ss_ext_discount_amt#14156,ss_ext_sales_price#14157,ss_ext_wholesale_cost#14158,ss_ext_list_price#14159,ss_ext_tax#14160,ss_coupon_amt#14161,ss_net_paid#14162,ss_net_paid_inc_tax#14163,ss_net_profit#14164,ss_sold_date_sk#14165L] orc
            :     :     +- Project [item_sk#14132L, rnk#14136]
            :     :        +- Filter ((rnk#14136 < 11) AND isnotnull(item_sk#14132L))
            :     :           +- Window [rank(rank_col#14133) windowspecdefinition(rank_col#14133 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14136], [rank_col#14133 DESC NULLS LAST]
            :     :              +- Filter (isnotnull(rank_col#14133) AND (rank_col#14133 > (0.9 * scalar-subquery#14135 [])))
            :     :                 :  +- Aggregate [ss_store_sk#14265L], [avg(ss_net_profit#14280) AS rank_col#14134]
            :     :                 :     +- Project [ss_store_sk#14265L, ss_net_profit#14280]
            :     :                 :        +- Filter (isnotnull(ss_store_sk#14265L) AND ((ss_store_sk#14265L = 410) AND isnull(ss_hdemo_sk#14263L)))
            :     :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14259L,ss_item_sk#14260L,ss_customer_sk#14261L,ss_cdemo_sk#14262L,ss_hdemo_sk#14263L,ss_addr_sk#14264L,ss_store_sk#14265L,ss_promo_sk#14266L,ss_ticket_number#14267L,ss_quantity#14268,ss_wholesale_cost#14269,ss_list_price#14270,ss_sales_price#14271,ss_ext_discount_amt#14272,ss_ext_sales_price#14273,ss_ext_wholesale_cost#14274,ss_ext_list_price#14275,ss_ext_tax#14276,ss_coupon_amt#14277,ss_net_paid#14278,ss_net_paid_inc_tax#14279,ss_net_profit#14280,ss_sold_date_sk#14281L] orc
            :     :                 +- Aggregate [ss_item_sk#14167L], [ss_item_sk#14167L AS item_sk#14132L, avg(ss_net_profit#14187) AS rank_col#14133]
            :     :                    +- Project [ss_item_sk#14167L, ss_net_profit#14187]
            :     :                       +- Filter (isnotnull(ss_store_sk#14172L) AND (ss_store_sk#14172L = 410))
            :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14166L,ss_item_sk#14167L,ss_customer_sk#14168L,ss_cdemo_sk#14169L,ss_hdemo_sk#14170L,ss_addr_sk#14171L,ss_store_sk#14172L,ss_promo_sk#14173L,ss_ticket_number#14174L,ss_quantity#14175,ss_wholesale_cost#14176,ss_list_price#14177,ss_sales_price#14178,ss_ext_discount_amt#14179,ss_ext_sales_price#14180,ss_ext_wholesale_cost#14181,ss_ext_list_price#14182,ss_ext_tax#14183,ss_coupon_amt#14184,ss_net_paid#14185,ss_net_paid_inc_tax#14186,ss_net_profit#14187,ss_sold_date_sk#14188L] orc
            :     +- Project [i_item_sk#14189L, i_product_name#14210]
            :        +- Filter isnotnull(i_item_sk#14189L)
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14189L,i_item_id#14190,i_rec_start_date#14191,i_rec_end_date#14192,i_item_desc#14193,i_current_price#14194,i_wholesale_cost#14195,i_brand_id#14196,i_brand#14197,i_class_id#14198,i_class#14199,i_category_id#14200,i_category#14201,i_manufact_id#14202,i_manufact#14203,i_size#14204,i_formulation#14205,i_color#14206,i_units#14207,i_container#14208,i_manager_id#14209,i_product_name#14210] orc
            +- Project [i_item_sk#14211L, i_product_name#14232]
               +- Filter isnotnull(i_item_sk#14211L)
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14211L,i_item_id#14212,i_rec_start_date#14213,i_rec_end_date#14214,i_item_desc#14215,i_current_price#14216,i_wholesale_cost#14217,i_brand_id#14218,i_brand#14219,i_class_id#14220,i_class#14221,i_category_id#14222,i_category#14223,i_manufact_id#14224,i_manufact#14225,i_size#14226,i_formulation#14227,i_color#14228,i_units#14229,i_container#14230,i_manager_id#14231,i_product_name#14232] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[rnk#14131 ASC NULLS FIRST], output=[rnk#14131,best_performing#14137,worst_performing#14138])
   +- Project [rnk#14131, i_product_name#14210 AS best_performing#14137, i_product_name#14232 AS worst_performing#14138]
      +- SortMergeJoin [item_sk#14132L], [i_item_sk#14211L], Inner
         :- Sort [item_sk#14132L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(item_sk#14132L, 3000), ENSURE_REQUIREMENTS, [id=#14905]
         :     +- Project [rnk#14131, item_sk#14132L, i_product_name#14210]
         :        +- SortMergeJoin [item_sk#14127L], [i_item_sk#14189L], Inner
         :           :- Sort [item_sk#14127L ASC NULLS FIRST], false, 0
         :           :  +- Exchange hashpartitioning(item_sk#14127L, 3000), ENSURE_REQUIREMENTS, [id=#14898]
         :           :     +- Project [item_sk#14127L, rnk#14131, item_sk#14132L]
         :           :        +- BroadcastHashJoin [rnk#14131], [rnk#14136], Inner, BuildRight, false
         :           :           :- Project [item_sk#14127L, rnk#14131]
         :           :           :  +- Filter ((rnk#14131 < 11) AND isnotnull(item_sk#14127L))
         :           :           :     +- Window [rank(rank_col#14128) windowspecdefinition(rank_col#14128 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14131], [rank_col#14128 ASC NULLS FIRST]
         :           :           :        +- Sort [rank_col#14128 ASC NULLS FIRST], false, 0
         :           :           :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#14877]
         :           :           :              +- Filter (isnotnull(rank_col#14128) AND (rank_col#14128 > (0.9 * Subquery subquery#14130, [id=#14838])))
         :           :           :                 :  +- Subquery subquery#14130, [id=#14838]
         :           :           :                 :     +- AdaptiveSparkPlan isFinalPlan=false
         :           :           :                 :        +- HashAggregate(keys=[ss_store_sk#14241L], functions=[avg(ss_net_profit#14256)], output=[rank_col#14129])
         :           :           :                 :           +- Exchange hashpartitioning(ss_store_sk#14241L, 3000), ENSURE_REQUIREMENTS, [id=#14836]
         :           :           :                 :              +- HashAggregate(keys=[ss_store_sk#14241L], functions=[partial_avg(ss_net_profit#14256)], output=[ss_store_sk#14241L, sum#14316, count#14317L])
         :           :           :                 :                 +- Project [ss_store_sk#14241L, ss_net_profit#14256]
         :           :           :                 :                    +- Filter ((isnotnull(ss_store_sk#14241L) AND (ss_store_sk#14241L = 410)) AND isnull(ss_hdemo_sk#14239L))
         :           :           :                 :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_hdemo_sk#14239L,ss_store_sk#14241L,ss_net_profit#14256,ss_sold_date_sk#14257L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14241L), (ss_store_sk#14241L = 410), isnull(ss_hdemo_sk#14239L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,410), IsNull(ss_hdemo_sk)], ReadSchema: struct<ss_hdemo_sk:bigint,ss_store_sk:bigint,ss_net_profit:double>
         :           :           :                 +- HashAggregate(keys=[ss_item_sk#14144L], functions=[avg(ss_net_profit#14164)], output=[item_sk#14127L, rank_col#14128])
         :           :           :                    +- Exchange hashpartitioning(ss_item_sk#14144L, 3000), ENSURE_REQUIREMENTS, [id=#14873]
         :           :           :                       +- HashAggregate(keys=[ss_item_sk#14144L], functions=[partial_avg(ss_net_profit#14164)], output=[ss_item_sk#14144L, sum#14308, count#14309L])
         :           :           :                          +- Project [ss_item_sk#14144L, ss_net_profit#14164]
         :           :           :                             +- Filter (isnotnull(ss_store_sk#14149L) AND (ss_store_sk#14149L = 410))
         :           :           :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#14144L,ss_store_sk#14149L,ss_net_profit#14164,ss_sold_date_sk#14165L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14149L), (ss_store_sk#14149L = 410)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,410)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_net_profit:double>
         :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[1, int, false] as bigint)),false), [id=#14892]
         :           :              +- Project [item_sk#14132L, rnk#14136]
         :           :                 +- Filter ((rnk#14136 < 11) AND isnotnull(item_sk#14132L))
         :           :                    +- Window [rank(rank_col#14133) windowspecdefinition(rank_col#14133 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#14136], [rank_col#14133 DESC NULLS LAST]
         :           :                       +- Sort [rank_col#14133 DESC NULLS LAST], false, 0
         :           :                          +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#14886]
         :           :                             +- Filter (isnotnull(rank_col#14133) AND (rank_col#14133 > (0.9 * Subquery subquery#14135, [id=#14851])))
         :           :                                :  +- Subquery subquery#14135, [id=#14851]
         :           :                                :     +- AdaptiveSparkPlan isFinalPlan=false
         :           :                                :        +- HashAggregate(keys=[ss_store_sk#14265L], functions=[avg(ss_net_profit#14280)], output=[rank_col#14134])
         :           :                                :           +- Exchange hashpartitioning(ss_store_sk#14265L, 3000), ENSURE_REQUIREMENTS, [id=#14849]
         :           :                                :              +- HashAggregate(keys=[ss_store_sk#14265L], functions=[partial_avg(ss_net_profit#14280)], output=[ss_store_sk#14265L, sum#14320, count#14321L])
         :           :                                :                 +- Project [ss_store_sk#14265L, ss_net_profit#14280]
         :           :                                :                    +- Filter ((isnotnull(ss_store_sk#14265L) AND (ss_store_sk#14265L = 410)) AND isnull(ss_hdemo_sk#14263L))
         :           :                                :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_hdemo_sk#14263L,ss_store_sk#14265L,ss_net_profit#14280,ss_sold_date_sk#14281L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14265L), (ss_store_sk#14265L = 410), isnull(ss_hdemo_sk#14263L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,410), IsNull(ss_hdemo_sk)], ReadSchema: struct<ss_hdemo_sk:bigint,ss_store_sk:bigint,ss_net_profit:double>
         :           :                                +- HashAggregate(keys=[ss_item_sk#14167L], functions=[avg(ss_net_profit#14187)], output=[item_sk#14132L, rank_col#14133])
         :           :                                   +- Exchange hashpartitioning(ss_item_sk#14167L, 3000), ENSURE_REQUIREMENTS, [id=#14882]
         :           :                                      +- HashAggregate(keys=[ss_item_sk#14167L], functions=[partial_avg(ss_net_profit#14187)], output=[ss_item_sk#14167L, sum#14312, count#14313L])
         :           :                                         +- Project [ss_item_sk#14167L, ss_net_profit#14187]
         :           :                                            +- Filter (isnotnull(ss_store_sk#14172L) AND (ss_store_sk#14172L = 410))
         :           :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#14167L,ss_store_sk#14172L,ss_net_profit#14187,ss_sold_date_sk#14188L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14172L), (ss_store_sk#14172L = 410)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,410)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_net_profit:double>
         :           +- Sort [i_item_sk#14189L ASC NULLS FIRST], false, 0
         :              +- Exchange hashpartitioning(i_item_sk#14189L, 3000), ENSURE_REQUIREMENTS, [id=#14897]
         :                 +- Filter isnotnull(i_item_sk#14189L)
         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14189L,i_product_name#14210] Batched: true, DataFilters: [isnotnull(i_item_sk#14189L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_product_name:string>
         +- Sort [i_item_sk#14211L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_item_sk#14211L, 3000), ENSURE_REQUIREMENTS, [id=#14906]
               +- Filter isnotnull(i_item_sk#14211L)
                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14211L,i_product_name#14232] Batched: true, DataFilters: [isnotnull(i_item_sk#14211L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_product_name:string>

read query: spark_queries/q45.sql
explain query: q45
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ca_zip ASC NULLS FIRST, 'ca_city ASC NULLS FIRST], true
      +- 'Aggregate ['ca_zip, 'ca_city], ['ca_zip, 'ca_city, unresolvedalias('sum('ws_sales_price), None)]
         +- 'Filter (((('ws_bill_customer_sk = 'c_customer_sk) AND ('c_current_addr_sk = 'ca_address_sk)) AND (('ws_item_sk = 'i_item_sk) AND ('substr('ca_zip, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR 'i_item_id IN (list#14322 [])))) AND ((('ws_sold_date_sk = 'd_date_sk) AND ('d_qoy = 2)) AND ('d_year = 2000)))
            :  +- 'Project ['i_item_id]
            :     +- 'Filter 'i_item_sk IN (2,3,5,7,11,13,17,19,23,29)
            :        +- 'UnresolvedRelation [item], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [web_sales], [], false
               :  :  :  +- 'UnresolvedRelation [customer], [], false
               :  :  +- 'UnresolvedRelation [customer_address], [], false
               :  +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
ca_zip: string, ca_city: string, sum(ws_sales_price): double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_zip#14384 ASC NULLS FIRST, ca_city#14381 ASC NULLS FIRST], true
      +- Aggregate [ca_zip#14384, ca_city#14381], [ca_zip#14384, ca_city#14381, sum(ws_sales_price#14343) AS sum(ws_sales_price)#14461]
         +- Filter ((((ws_bill_customer_sk#14326L = c_customer_sk#14357L) AND (c_current_addr_sk#14361L = ca_address_sk#14375L)) AND ((ws_item_sk#14325L = i_item_sk#14416L) AND (substr(ca_zip#14384, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR i_item_id#14417 IN (list#14322 [])))) AND (((ws_sold_date_sk#14356L = d_date_sk#14388L) AND (d_qoy#14398 = 2)) AND (d_year#14394 = 2000)))
            :  +- Project [i_item_id#14439]
            :     +- Filter cast(i_item_sk#14438L as bigint) IN (cast(2 as bigint),cast(3 as bigint),cast(5 as bigint),cast(7 as bigint),cast(11 as bigint),cast(13 as bigint),cast(17 as bigint),cast(19 as bigint),cast(23 as bigint),cast(29 as bigint))
            :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14438L,i_item_id#14439,i_rec_start_date#14440,i_rec_end_date#14441,i_item_desc#14442,i_current_price#14443,i_wholesale_cost#14444,i_brand_id#14445,i_brand#14446,i_class_id#14447,i_class#14448,i_category_id#14449,i_category#14450,i_manufact_id#14451,i_manufact#14452,i_size#14453,i_formulation#14454,i_color#14455,i_units#14456,i_container#14457,i_manager_id#14458,i_product_name#14459] orc
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#14323L,ws_ship_date_sk#14324L,ws_item_sk#14325L,ws_bill_customer_sk#14326L,ws_bill_cdemo_sk#14327L,ws_bill_hdemo_sk#14328L,ws_bill_addr_sk#14329L,ws_ship_customer_sk#14330L,ws_ship_cdemo_sk#14331L,ws_ship_hdemo_sk#14332L,ws_ship_addr_sk#14333L,ws_web_page_sk#14334L,ws_web_site_sk#14335L,ws_ship_mode_sk#14336L,ws_warehouse_sk#14337L,ws_promo_sk#14338L,ws_order_number#14339L,ws_quantity#14340,ws_wholesale_cost#14341,ws_list_price#14342,ws_sales_price#14343,ws_ext_discount_amt#14344,ws_ext_sales_price#14345,ws_ext_wholesale_cost#14346,... 10 more fields] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14357L,c_customer_id#14358,c_current_cdemo_sk#14359L,c_current_hdemo_sk#14360L,c_current_addr_sk#14361L,c_first_shipto_date_sk#14362L,c_first_sales_date_sk#14363L,c_salutation#14364,c_first_name#14365,c_last_name#14366,c_preferred_cust_flag#14367,c_birth_day#14368,c_birth_month#14369,c_birth_year#14370,c_birth_country#14371,c_login#14372,c_email_address#14373,c_last_review_date#14374] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14375L,ca_address_id#14376,ca_street_number#14377,ca_street_name#14378,ca_street_type#14379,ca_suite_number#14380,ca_city#14381,ca_county#14382,ca_state#14383,ca_zip#14384,ca_country#14385,ca_gmt_offset#14386,ca_location_type#14387] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14388L,d_date_id#14389,d_date#14390,d_month_seq#14391,d_week_seq#14392,d_quarter_seq#14393,d_year#14394,d_dow#14395,d_moy#14396,d_dom#14397,d_qoy#14398,d_fy_year#14399,d_fy_quarter_seq#14400,d_fy_week_seq#14401,d_day_name#14402,d_quarter_name#14403,d_holiday#14404,d_weekend#14405,d_following_holiday#14406,d_first_dom#14407,d_last_dom#14408,d_same_day_ly#14409,d_same_day_lq#14410,d_current_day#14411,... 4 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14416L,i_item_id#14417,i_rec_start_date#14418,i_rec_end_date#14419,i_item_desc#14420,i_current_price#14421,i_wholesale_cost#14422,i_brand_id#14423,i_brand#14424,i_class_id#14425,i_class#14426,i_category_id#14427,i_category#14428,i_manufact_id#14429,i_manufact#14430,i_size#14431,i_formulation#14432,i_color#14433,i_units#14434,i_container#14435,i_manager_id#14436,i_product_name#14437] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ca_zip#14384 ASC NULLS FIRST, ca_city#14381 ASC NULLS FIRST], true
      +- Aggregate [ca_zip#14384, ca_city#14381], [ca_zip#14384, ca_city#14381, sum(ws_sales_price#14343) AS sum(ws_sales_price)#14461]
         +- Project [ws_sales_price#14343, ca_city#14381, ca_zip#14384]
            +- Filter (substr(ca_zip#14384, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR exists#14465)
               +- Join ExistenceJoin(exists#14465), (i_item_id#14417 = i_item_id#14439)
                  :- Project [ws_sales_price#14343, ca_city#14381, ca_zip#14384, i_item_id#14417]
                  :  +- Join Inner, (ws_item_sk#14325L = i_item_sk#14416L)
                  :     :- Project [ws_item_sk#14325L, ws_sales_price#14343, ca_city#14381, ca_zip#14384]
                  :     :  +- Join Inner, (ws_bill_customer_sk#14326L = c_customer_sk#14357L)
                  :     :     :- Project [ws_item_sk#14325L, ws_bill_customer_sk#14326L, ws_sales_price#14343]
                  :     :     :  +- Join Inner, (ws_sold_date_sk#14356L = d_date_sk#14388L)
                  :     :     :     :- Project [ws_item_sk#14325L, ws_bill_customer_sk#14326L, ws_sales_price#14343, ws_sold_date_sk#14356L]
                  :     :     :     :  +- Filter (((isnotnull(ws_bill_customer_sk#14326L) AND isnotnull(ws_sold_date_sk#14356L)) AND isnotnull(ws_item_sk#14325L)) AND dynamicpruning#14466 [ws_sold_date_sk#14356L])
                  :     :     :     :     :  +- Project [d_date_sk#14388L]
                  :     :     :     :     :     +- Filter (((isnotnull(d_qoy#14398) AND isnotnull(d_year#14394)) AND ((d_qoy#14398 = 2) AND (d_year#14394 = 2000))) AND isnotnull(d_date_sk#14388L))
                  :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14388L,d_date_id#14389,d_date#14390,d_month_seq#14391,d_week_seq#14392,d_quarter_seq#14393,d_year#14394,d_dow#14395,d_moy#14396,d_dom#14397,d_qoy#14398,d_fy_year#14399,d_fy_quarter_seq#14400,d_fy_week_seq#14401,d_day_name#14402,d_quarter_name#14403,d_holiday#14404,d_weekend#14405,d_following_holiday#14406,d_first_dom#14407,d_last_dom#14408,d_same_day_ly#14409,d_same_day_lq#14410,d_current_day#14411,... 4 more fields] orc
                  :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#14323L,ws_ship_date_sk#14324L,ws_item_sk#14325L,ws_bill_customer_sk#14326L,ws_bill_cdemo_sk#14327L,ws_bill_hdemo_sk#14328L,ws_bill_addr_sk#14329L,ws_ship_customer_sk#14330L,ws_ship_cdemo_sk#14331L,ws_ship_hdemo_sk#14332L,ws_ship_addr_sk#14333L,ws_web_page_sk#14334L,ws_web_site_sk#14335L,ws_ship_mode_sk#14336L,ws_warehouse_sk#14337L,ws_promo_sk#14338L,ws_order_number#14339L,ws_quantity#14340,ws_wholesale_cost#14341,ws_list_price#14342,ws_sales_price#14343,ws_ext_discount_amt#14344,ws_ext_sales_price#14345,ws_ext_wholesale_cost#14346,... 10 more fields] orc
                  :     :     :     +- Project [d_date_sk#14388L]
                  :     :     :        +- Filter (((isnotnull(d_qoy#14398) AND isnotnull(d_year#14394)) AND ((d_qoy#14398 = 2) AND (d_year#14394 = 2000))) AND isnotnull(d_date_sk#14388L))
                  :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14388L,d_date_id#14389,d_date#14390,d_month_seq#14391,d_week_seq#14392,d_quarter_seq#14393,d_year#14394,d_dow#14395,d_moy#14396,d_dom#14397,d_qoy#14398,d_fy_year#14399,d_fy_quarter_seq#14400,d_fy_week_seq#14401,d_day_name#14402,d_quarter_name#14403,d_holiday#14404,d_weekend#14405,d_following_holiday#14406,d_first_dom#14407,d_last_dom#14408,d_same_day_ly#14409,d_same_day_lq#14410,d_current_day#14411,... 4 more fields] orc
                  :     :     +- Project [c_customer_sk#14357L, ca_city#14381, ca_zip#14384]
                  :     :        +- Join Inner, (c_current_addr_sk#14361L = ca_address_sk#14375L)
                  :     :           :- Project [c_customer_sk#14357L, c_current_addr_sk#14361L]
                  :     :           :  +- Filter (isnotnull(c_customer_sk#14357L) AND isnotnull(c_current_addr_sk#14361L))
                  :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14357L,c_customer_id#14358,c_current_cdemo_sk#14359L,c_current_hdemo_sk#14360L,c_current_addr_sk#14361L,c_first_shipto_date_sk#14362L,c_first_sales_date_sk#14363L,c_salutation#14364,c_first_name#14365,c_last_name#14366,c_preferred_cust_flag#14367,c_birth_day#14368,c_birth_month#14369,c_birth_year#14370,c_birth_country#14371,c_login#14372,c_email_address#14373,c_last_review_date#14374] orc
                  :     :           +- Project [ca_address_sk#14375L, ca_city#14381, ca_zip#14384]
                  :     :              +- Filter isnotnull(ca_address_sk#14375L)
                  :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14375L,ca_address_id#14376,ca_street_number#14377,ca_street_name#14378,ca_street_type#14379,ca_suite_number#14380,ca_city#14381,ca_county#14382,ca_state#14383,ca_zip#14384,ca_country#14385,ca_gmt_offset#14386,ca_location_type#14387] orc
                  :     +- Project [i_item_sk#14416L, i_item_id#14417]
                  :        +- Filter isnotnull(i_item_sk#14416L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14416L,i_item_id#14417,i_rec_start_date#14418,i_rec_end_date#14419,i_item_desc#14420,i_current_price#14421,i_wholesale_cost#14422,i_brand_id#14423,i_brand#14424,i_class_id#14425,i_class#14426,i_category_id#14427,i_category#14428,i_manufact_id#14429,i_manufact#14430,i_size#14431,i_formulation#14432,i_color#14433,i_units#14434,i_container#14435,i_manager_id#14436,i_product_name#14437] orc
                  +- Project [i_item_id#14439]
                     +- Filter i_item_sk#14438L IN (2,3,5,7,11,13,17,19,23,29)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14438L,i_item_id#14439,i_rec_start_date#14440,i_rec_end_date#14441,i_item_desc#14442,i_current_price#14443,i_wholesale_cost#14444,i_brand_id#14445,i_brand#14446,i_class_id#14447,i_class#14448,i_category_id#14449,i_category#14450,i_manufact_id#14451,i_manufact#14452,i_size#14453,i_formulation#14454,i_color#14455,i_units#14456,i_container#14457,i_manager_id#14458,i_product_name#14459] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ca_zip#14384 ASC NULLS FIRST,ca_city#14381 ASC NULLS FIRST], output=[ca_zip#14384,ca_city#14381,sum(ws_sales_price)#14461])
   +- HashAggregate(keys=[ca_zip#14384, ca_city#14381], functions=[sum(ws_sales_price#14343)], output=[ca_zip#14384, ca_city#14381, sum(ws_sales_price)#14461])
      +- Exchange hashpartitioning(ca_zip#14384, ca_city#14381, 3000), ENSURE_REQUIREMENTS, [id=#15082]
         +- HashAggregate(keys=[ca_zip#14384, ca_city#14381], functions=[partial_sum(ws_sales_price#14343)], output=[ca_zip#14384, ca_city#14381, sum#14468])
            +- Project [ws_sales_price#14343, ca_city#14381, ca_zip#14384]
               +- Filter (substr(ca_zip#14384, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR exists#14465)
                  +- BroadcastHashJoin [i_item_id#14417], [i_item_id#14439], ExistenceJoin(exists#14465), BuildRight, false
                     :- Project [ws_sales_price#14343, ca_city#14381, ca_zip#14384, i_item_id#14417]
                     :  +- SortMergeJoin [ws_item_sk#14325L], [i_item_sk#14416L], Inner
                     :     :- Sort [ws_item_sk#14325L ASC NULLS FIRST], false, 0
                     :     :  +- Exchange hashpartitioning(ws_item_sk#14325L, 3000), ENSURE_REQUIREMENTS, [id=#15069]
                     :     :     +- Project [ws_item_sk#14325L, ws_sales_price#14343, ca_city#14381, ca_zip#14384]
                     :     :        +- SortMergeJoin [ws_bill_customer_sk#14326L], [c_customer_sk#14357L], Inner
                     :     :           :- Sort [ws_bill_customer_sk#14326L ASC NULLS FIRST], false, 0
                     :     :           :  +- Exchange hashpartitioning(ws_bill_customer_sk#14326L, 3000), ENSURE_REQUIREMENTS, [id=#15061]
                     :     :           :     +- Project [ws_item_sk#14325L, ws_bill_customer_sk#14326L, ws_sales_price#14343]
                     :     :           :        +- BroadcastHashJoin [ws_sold_date_sk#14356L], [d_date_sk#14388L], Inner, BuildRight, false
                     :     :           :           :- Filter (isnotnull(ws_bill_customer_sk#14326L) AND isnotnull(ws_item_sk#14325L))
                     :     :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#14325L,ws_bill_customer_sk#14326L,ws_sales_price#14343,ws_sold_date_sk#14356L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#14326L), isnotnull(ws_item_sk#14325L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#14356L), dynamicpruningexpression(ws_sold_date_sk#14356L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_customer_sk:bigint,ws_sales_price:double>
                     :     :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#14466, 0, true, Project [d_date_sk#14388L], [d_date_sk#14388L]
                     :     :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :     :           :           :              +- Project [d_date_sk#14388L]
                     :     :           :           :                 +- Filter ((((isnotnull(d_qoy#14398) AND isnotnull(d_year#14394)) AND (d_qoy#14398 = 2)) AND (d_year#14394 = 2000)) AND isnotnull(d_date_sk#14388L))
                     :     :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14388L,d_year#14394,d_qoy#14398] Batched: true, DataFilters: [isnotnull(d_qoy#14398), isnotnull(d_year#14394), (d_qoy#14398 = 2), (d_year#14394 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15049]
                     :     :           :              +- Project [d_date_sk#14388L]
                     :     :           :                 +- Filter ((((isnotnull(d_qoy#14398) AND isnotnull(d_year#14394)) AND (d_qoy#14398 = 2)) AND (d_year#14394 = 2000)) AND isnotnull(d_date_sk#14388L))
                     :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14388L,d_year#14394,d_qoy#14398] Batched: true, DataFilters: [isnotnull(d_qoy#14398), isnotnull(d_year#14394), (d_qoy#14398 = 2), (d_year#14394 = 2000), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     :     :           +- Sort [c_customer_sk#14357L ASC NULLS FIRST], false, 0
                     :     :              +- Exchange hashpartitioning(c_customer_sk#14357L, 3000), ENSURE_REQUIREMENTS, [id=#15062]
                     :     :                 +- Project [c_customer_sk#14357L, ca_city#14381, ca_zip#14384]
                     :     :                    +- SortMergeJoin [c_current_addr_sk#14361L], [ca_address_sk#14375L], Inner
                     :     :                       :- Sort [c_current_addr_sk#14361L ASC NULLS FIRST], false, 0
                     :     :                       :  +- Exchange hashpartitioning(c_current_addr_sk#14361L, 3000), ENSURE_REQUIREMENTS, [id=#15053]
                     :     :                       :     +- Filter (isnotnull(c_customer_sk#14357L) AND isnotnull(c_current_addr_sk#14361L))
                     :     :                       :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14357L,c_current_addr_sk#14361L] Batched: true, DataFilters: [isnotnull(c_customer_sk#14357L), isnotnull(c_current_addr_sk#14361L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
                     :     :                       +- Sort [ca_address_sk#14375L ASC NULLS FIRST], false, 0
                     :     :                          +- Exchange hashpartitioning(ca_address_sk#14375L, 3000), ENSURE_REQUIREMENTS, [id=#15054]
                     :     :                             +- Filter isnotnull(ca_address_sk#14375L)
                     :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14375L,ca_city#14381,ca_zip#14384] Batched: true, DataFilters: [isnotnull(ca_address_sk#14375L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string,ca_zip:string>
                     :     +- Sort [i_item_sk#14416L ASC NULLS FIRST], false, 0
                     :        +- Exchange hashpartitioning(i_item_sk#14416L, 3000), ENSURE_REQUIREMENTS, [id=#15070]
                     :           +- Filter isnotnull(i_item_sk#14416L)
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14416L,i_item_id#14417] Batched: true, DataFilters: [isnotnull(i_item_sk#14416L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#15076]
                        +- Project [i_item_id#14439]
                           +- Filter i_item_sk#14438L IN (2,3,5,7,11,13,17,19,23,29)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14438L,i_item_id#14439] Batched: true, DataFilters: [i_item_sk#14438L IN (2,3,5,7,11,13,17,19,23,29)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_item_sk, [11,13,17,19,2,23,29,3,5,7])], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q46.sql
explain query: q46
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'ca_city ASC NULLS FIRST, 'bought_city ASC NULLS FIRST, 'ss_ticket_number ASC NULLS FIRST], true
      +- 'Project ['c_last_name, 'c_first_name, 'ca_city, 'bought_city, 'ss_ticket_number, 'amt, 'profit]
         +- 'Filter ((('ss_customer_sk = 'c_customer_sk) AND ('customer.c_current_addr_sk = 'current_addr.ca_address_sk)) AND NOT ('current_addr.ca_city = 'bought_city))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias dn
               :  :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'ca_city], ['ss_ticket_number, 'ss_customer_sk, 'ca_city AS bought_city#14469, 'sum('ss_coupon_amt) AS amt#14470, 'sum('ss_net_profit) AS profit#14471]
               :  :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_store_sk = 'store.s_store_sk)) AND (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) AND ('store_sales.ss_addr_sk = 'customer_address.ca_address_sk))) AND (((('household_demographics.hd_dep_count = 2) OR ('household_demographics.hd_vehicle_count = 1)) AND 'date_dim.d_dow IN (6,0)) AND ('date_dim.d_year IN (1998,(1998 + 1),(1998 + 2)) AND 'store.s_city IN (Cedar Grove,Wildwood,Union,Salem,Highland Park))))
               :  :        +- 'Join Inner
               :  :           :- 'Join Inner
               :  :           :  :- 'Join Inner
               :  :           :  :  :- 'Join Inner
               :  :           :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :           :  :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  :           :  :  +- 'UnresolvedRelation [store], [], false
               :  :           :  +- 'UnresolvedRelation [household_demographics], [], false
               :  :           +- 'UnresolvedRelation [customer_address], [], false
               :  +- 'UnresolvedRelation [customer], [], false
               +- 'SubqueryAlias current_addr
                  +- 'UnresolvedRelation [customer_address], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, ca_city: string, bought_city: string, ss_ticket_number: bigint, amt: double, profit: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_last_name#14579 ASC NULLS FIRST, c_first_name#14578 ASC NULLS FIRST, ca_city#14594 ASC NULLS FIRST, bought_city#14469 ASC NULLS FIRST, ss_ticket_number#14480L ASC NULLS FIRST], true
      +- Project [c_last_name#14579, c_first_name#14578, ca_city#14594, bought_city#14469, ss_ticket_number#14480L, amt#14470, profit#14471]
         +- Filter (((ss_customer_sk#14474L = c_customer_sk#14570L) AND (c_current_addr_sk#14574L = ca_address_sk#14588L)) AND NOT (ca_city#14594 = bought_city#14469))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias dn
               :  :  +- Aggregate [ss_ticket_number#14480L, ss_customer_sk#14474L, ss_addr_sk#14477L, ca_city#14563], [ss_ticket_number#14480L, ss_customer_sk#14474L, ca_city#14563 AS bought_city#14469, sum(ss_coupon_amt#14490) AS amt#14470, sum(ss_net_profit#14493) AS profit#14471]
               :  :     +- Filter ((((ss_sold_date_sk#14494L = d_date_sk#14495L) AND (ss_store_sk#14478L = s_store_sk#14523L)) AND ((ss_hdemo_sk#14476L = hd_demo_sk#14552L) AND (ss_addr_sk#14477L = ca_address_sk#14557L))) AND ((((hd_dep_count#14555 = 2) OR (hd_vehicle_count#14556 = 1)) AND d_dow#14502 IN (6,0)) AND (d_year#14501 IN (1998,(1998 + 1),(1998 + 2)) AND s_city#14545 IN (Cedar Grove,Wildwood,Union,Salem,Highland Park))))
               :  :        +- Join Inner
               :  :           :- Join Inner
               :  :           :  :- Join Inner
               :  :           :  :  :- Join Inner
               :  :           :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :           :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14472L,ss_item_sk#14473L,ss_customer_sk#14474L,ss_cdemo_sk#14475L,ss_hdemo_sk#14476L,ss_addr_sk#14477L,ss_store_sk#14478L,ss_promo_sk#14479L,ss_ticket_number#14480L,ss_quantity#14481,ss_wholesale_cost#14482,ss_list_price#14483,ss_sales_price#14484,ss_ext_discount_amt#14485,ss_ext_sales_price#14486,ss_ext_wholesale_cost#14487,ss_ext_list_price#14488,ss_ext_tax#14489,ss_coupon_amt#14490,ss_net_paid#14491,ss_net_paid_inc_tax#14492,ss_net_profit#14493,ss_sold_date_sk#14494L] orc
               :  :           :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14495L,d_date_id#14496,d_date#14497,d_month_seq#14498,d_week_seq#14499,d_quarter_seq#14500,d_year#14501,d_dow#14502,d_moy#14503,d_dom#14504,d_qoy#14505,d_fy_year#14506,d_fy_quarter_seq#14507,d_fy_week_seq#14508,d_day_name#14509,d_quarter_name#14510,d_holiday#14511,d_weekend#14512,d_following_holiday#14513,d_first_dom#14514,d_last_dom#14515,d_same_day_ly#14516,d_same_day_lq#14517,d_current_day#14518,... 4 more fields] orc
               :  :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :  :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14523L,s_store_id#14524,s_rec_start_date#14525,s_rec_end_date#14526,s_closed_date_sk#14527L,s_store_name#14528,s_number_employees#14529,s_floor_space#14530,s_hours#14531,s_manager#14532,s_market_id#14533,s_geography_class#14534,s_market_desc#14535,s_market_manager#14536,s_division_id#14537,s_division_name#14538,s_company_id#14539,s_company_name#14540,s_street_number#14541,s_street_name#14542,s_street_type#14543,s_suite_number#14544,s_city#14545,s_county#14546,... 5 more fields] orc
               :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
               :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#14552L,hd_income_band_sk#14553L,hd_buy_potential#14554,hd_dep_count#14555,hd_vehicle_count#14556] orc
               :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14557L,ca_address_id#14558,ca_street_number#14559,ca_street_name#14560,ca_street_type#14561,ca_suite_number#14562,ca_city#14563,ca_county#14564,ca_state#14565,ca_zip#14566,ca_country#14567,ca_gmt_offset#14568,ca_location_type#14569] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14570L,c_customer_id#14571,c_current_cdemo_sk#14572L,c_current_hdemo_sk#14573L,c_current_addr_sk#14574L,c_first_shipto_date_sk#14575L,c_first_sales_date_sk#14576L,c_salutation#14577,c_first_name#14578,c_last_name#14579,c_preferred_cust_flag#14580,c_birth_day#14581,c_birth_month#14582,c_birth_year#14583,c_birth_country#14584,c_login#14585,c_email_address#14586,c_last_review_date#14587] orc
               +- SubqueryAlias current_addr
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14588L,ca_address_id#14589,ca_street_number#14590,ca_street_name#14591,ca_street_type#14592,ca_suite_number#14593,ca_city#14594,ca_county#14595,ca_state#14596,ca_zip#14597,ca_country#14598,ca_gmt_offset#14599,ca_location_type#14600] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_last_name#14579 ASC NULLS FIRST, c_first_name#14578 ASC NULLS FIRST, ca_city#14594 ASC NULLS FIRST, bought_city#14469 ASC NULLS FIRST, ss_ticket_number#14480L ASC NULLS FIRST], true
      +- Project [c_last_name#14579, c_first_name#14578, ca_city#14594, bought_city#14469, ss_ticket_number#14480L, amt#14470, profit#14471]
         +- Join Inner, ((ss_customer_sk#14474L = c_customer_sk#14570L) AND NOT (ca_city#14594 = bought_city#14469))
            :- Project [c_customer_sk#14570L, c_first_name#14578, c_last_name#14579, ca_city#14594]
            :  +- Join Inner, (c_current_addr_sk#14574L = ca_address_sk#14588L)
            :     :- Project [c_customer_sk#14570L, c_current_addr_sk#14574L, c_first_name#14578, c_last_name#14579]
            :     :  +- Filter (isnotnull(c_customer_sk#14570L) AND isnotnull(c_current_addr_sk#14574L))
            :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14570L,c_customer_id#14571,c_current_cdemo_sk#14572L,c_current_hdemo_sk#14573L,c_current_addr_sk#14574L,c_first_shipto_date_sk#14575L,c_first_sales_date_sk#14576L,c_salutation#14577,c_first_name#14578,c_last_name#14579,c_preferred_cust_flag#14580,c_birth_day#14581,c_birth_month#14582,c_birth_year#14583,c_birth_country#14584,c_login#14585,c_email_address#14586,c_last_review_date#14587] orc
            :     +- Project [ca_address_sk#14588L, ca_city#14594]
            :        +- Filter (isnotnull(ca_address_sk#14588L) AND isnotnull(ca_city#14594))
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14588L,ca_address_id#14589,ca_street_number#14590,ca_street_name#14591,ca_street_type#14592,ca_suite_number#14593,ca_city#14594,ca_county#14595,ca_state#14596,ca_zip#14597,ca_country#14598,ca_gmt_offset#14599,ca_location_type#14600] orc
            +- Aggregate [ss_ticket_number#14480L, ss_customer_sk#14474L, ss_addr_sk#14477L, ca_city#14563], [ss_ticket_number#14480L, ss_customer_sk#14474L, ca_city#14563 AS bought_city#14469, sum(ss_coupon_amt#14490) AS amt#14470, sum(ss_net_profit#14493) AS profit#14471]
               +- Project [ss_customer_sk#14474L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493, ca_city#14563]
                  +- Join Inner, (ss_addr_sk#14477L = ca_address_sk#14557L)
                     :- Project [ss_customer_sk#14474L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493]
                     :  +- Join Inner, (ss_hdemo_sk#14476L = hd_demo_sk#14552L)
                     :     :- Project [ss_customer_sk#14474L, ss_hdemo_sk#14476L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493]
                     :     :  +- Join Inner, (ss_sold_date_sk#14494L = d_date_sk#14495L)
                     :     :     :- Project [ss_customer_sk#14474L, ss_hdemo_sk#14476L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493, ss_sold_date_sk#14494L]
                     :     :     :  +- Join Inner, (ss_store_sk#14478L = s_store_sk#14523L)
                     :     :     :     :- Project [ss_customer_sk#14474L, ss_hdemo_sk#14476L, ss_addr_sk#14477L, ss_store_sk#14478L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493, ss_sold_date_sk#14494L]
                     :     :     :     :  +- Filter (((((isnotnull(ss_sold_date_sk#14494L) AND isnotnull(ss_store_sk#14478L)) AND isnotnull(ss_hdemo_sk#14476L)) AND isnotnull(ss_addr_sk#14477L)) AND isnotnull(ss_customer_sk#14474L)) AND dynamicpruning#14610 [ss_sold_date_sk#14494L])
                     :     :     :     :     :  +- Project [d_date_sk#14495L]
                     :     :     :     :     :     +- Filter ((d_dow#14502 IN (6,0) AND d_year#14501 IN (1998,1999,2000)) AND isnotnull(d_date_sk#14495L))
                     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14495L,d_date_id#14496,d_date#14497,d_month_seq#14498,d_week_seq#14499,d_quarter_seq#14500,d_year#14501,d_dow#14502,d_moy#14503,d_dom#14504,d_qoy#14505,d_fy_year#14506,d_fy_quarter_seq#14507,d_fy_week_seq#14508,d_day_name#14509,d_quarter_name#14510,d_holiday#14511,d_weekend#14512,d_following_holiday#14513,d_first_dom#14514,d_last_dom#14515,d_same_day_ly#14516,d_same_day_lq#14517,d_current_day#14518,... 4 more fields] orc
                     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14472L,ss_item_sk#14473L,ss_customer_sk#14474L,ss_cdemo_sk#14475L,ss_hdemo_sk#14476L,ss_addr_sk#14477L,ss_store_sk#14478L,ss_promo_sk#14479L,ss_ticket_number#14480L,ss_quantity#14481,ss_wholesale_cost#14482,ss_list_price#14483,ss_sales_price#14484,ss_ext_discount_amt#14485,ss_ext_sales_price#14486,ss_ext_wholesale_cost#14487,ss_ext_list_price#14488,ss_ext_tax#14489,ss_coupon_amt#14490,ss_net_paid#14491,ss_net_paid_inc_tax#14492,ss_net_profit#14493,ss_sold_date_sk#14494L] orc
                     :     :     :     +- Project [s_store_sk#14523L]
                     :     :     :        +- Filter (s_city#14545 IN (Cedar Grove,Wildwood,Union,Salem,Highland Park) AND isnotnull(s_store_sk#14523L))
                     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14523L,s_store_id#14524,s_rec_start_date#14525,s_rec_end_date#14526,s_closed_date_sk#14527L,s_store_name#14528,s_number_employees#14529,s_floor_space#14530,s_hours#14531,s_manager#14532,s_market_id#14533,s_geography_class#14534,s_market_desc#14535,s_market_manager#14536,s_division_id#14537,s_division_name#14538,s_company_id#14539,s_company_name#14540,s_street_number#14541,s_street_name#14542,s_street_type#14543,s_suite_number#14544,s_city#14545,s_county#14546,... 5 more fields] orc
                     :     :     +- Project [d_date_sk#14495L]
                     :     :        +- Filter ((d_dow#14502 IN (6,0) AND d_year#14501 IN (1998,1999,2000)) AND isnotnull(d_date_sk#14495L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14495L,d_date_id#14496,d_date#14497,d_month_seq#14498,d_week_seq#14499,d_quarter_seq#14500,d_year#14501,d_dow#14502,d_moy#14503,d_dom#14504,d_qoy#14505,d_fy_year#14506,d_fy_quarter_seq#14507,d_fy_week_seq#14508,d_day_name#14509,d_quarter_name#14510,d_holiday#14511,d_weekend#14512,d_following_holiday#14513,d_first_dom#14514,d_last_dom#14515,d_same_day_ly#14516,d_same_day_lq#14517,d_current_day#14518,... 4 more fields] orc
                     :     +- Project [hd_demo_sk#14552L]
                     :        +- Filter (((hd_dep_count#14555 = 2) OR (hd_vehicle_count#14556 = 1)) AND isnotnull(hd_demo_sk#14552L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#14552L,hd_income_band_sk#14553L,hd_buy_potential#14554,hd_dep_count#14555,hd_vehicle_count#14556] orc
                     +- Project [ca_address_sk#14557L, ca_city#14563]
                        +- Filter (isnotnull(ca_address_sk#14557L) AND isnotnull(ca_city#14563))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14557L,ca_address_id#14558,ca_street_number#14559,ca_street_name#14560,ca_street_type#14561,ca_suite_number#14562,ca_city#14563,ca_county#14564,ca_state#14565,ca_zip#14566,ca_country#14567,ca_gmt_offset#14568,ca_location_type#14569] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_last_name#14579 ASC NULLS FIRST,c_first_name#14578 ASC NULLS FIRST,ca_city#14594 ASC NULLS FIRST,bought_city#14469 ASC NULLS FIRST,ss_ticket_number#14480L ASC NULLS FIRST], output=[c_last_name#14579,c_first_name#14578,ca_city#14594,bought_city#14469,ss_ticket_number#14480L,amt#14470,profit#14471])
   +- Project [c_last_name#14579, c_first_name#14578, ca_city#14594, bought_city#14469, ss_ticket_number#14480L, amt#14470, profit#14471]
      +- SortMergeJoin [c_customer_sk#14570L], [ss_customer_sk#14474L], Inner, NOT (ca_city#14594 = bought_city#14469)
         :- Sort [c_customer_sk#14570L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(c_customer_sk#14570L, 3000), ENSURE_REQUIREMENTS, [id=#15266]
         :     +- Project [c_customer_sk#14570L, c_first_name#14578, c_last_name#14579, ca_city#14594]
         :        +- SortMergeJoin [c_current_addr_sk#14574L], [ca_address_sk#14588L], Inner
         :           :- Sort [c_current_addr_sk#14574L ASC NULLS FIRST], false, 0
         :           :  +- Exchange hashpartitioning(c_current_addr_sk#14574L, 3000), ENSURE_REQUIREMENTS, [id=#15237]
         :           :     +- Filter (isnotnull(c_customer_sk#14570L) AND isnotnull(c_current_addr_sk#14574L))
         :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#14570L,c_current_addr_sk#14574L,c_first_name#14578,c_last_name#14579] Batched: true, DataFilters: [isnotnull(c_customer_sk#14570L), isnotnull(c_current_addr_sk#14574L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint,c_first_name:string,c_last_name:string>
         :           +- Sort [ca_address_sk#14588L ASC NULLS FIRST], false, 0
         :              +- Exchange hashpartitioning(ca_address_sk#14588L, 3000), ENSURE_REQUIREMENTS, [id=#15238]
         :                 +- Filter (isnotnull(ca_address_sk#14588L) AND isnotnull(ca_city#14594))
         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14588L,ca_city#14594] Batched: true, DataFilters: [isnotnull(ca_address_sk#14588L), isnotnull(ca_city#14594)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string>
         +- Sort [ss_customer_sk#14474L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(ss_customer_sk#14474L, 3000), ENSURE_REQUIREMENTS, [id=#15267]
               +- HashAggregate(keys=[ss_ticket_number#14480L, ss_customer_sk#14474L, ss_addr_sk#14477L, ca_city#14563], functions=[sum(ss_coupon_amt#14490), sum(ss_net_profit#14493)], output=[ss_ticket_number#14480L, ss_customer_sk#14474L, bought_city#14469, amt#14470, profit#14471])
                  +- HashAggregate(keys=[ss_ticket_number#14480L, ss_customer_sk#14474L, ss_addr_sk#14477L, ca_city#14563], functions=[partial_sum(ss_coupon_amt#14490), partial_sum(ss_net_profit#14493)], output=[ss_ticket_number#14480L, ss_customer_sk#14474L, ss_addr_sk#14477L, ca_city#14563, sum#14613, sum#14614])
                     +- Project [ss_customer_sk#14474L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493, ca_city#14563]
                        +- SortMergeJoin [ss_addr_sk#14477L], [ca_address_sk#14557L], Inner
                           :- Sort [ss_addr_sk#14477L ASC NULLS FIRST], false, 0
                           :  +- Exchange hashpartitioning(ss_addr_sk#14477L, 3000), ENSURE_REQUIREMENTS, [id=#15256]
                           :     +- Project [ss_customer_sk#14474L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493]
                           :        +- BroadcastHashJoin [ss_hdemo_sk#14476L], [hd_demo_sk#14552L], Inner, BuildRight, false
                           :           :- Project [ss_customer_sk#14474L, ss_hdemo_sk#14476L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493]
                           :           :  +- BroadcastHashJoin [ss_sold_date_sk#14494L], [d_date_sk#14495L], Inner, BuildRight, false
                           :           :     :- Project [ss_customer_sk#14474L, ss_hdemo_sk#14476L, ss_addr_sk#14477L, ss_ticket_number#14480L, ss_coupon_amt#14490, ss_net_profit#14493, ss_sold_date_sk#14494L]
                           :           :     :  +- BroadcastHashJoin [ss_store_sk#14478L], [s_store_sk#14523L], Inner, BuildRight, false
                           :           :     :     :- Filter (((isnotnull(ss_store_sk#14478L) AND isnotnull(ss_hdemo_sk#14476L)) AND isnotnull(ss_addr_sk#14477L)) AND isnotnull(ss_customer_sk#14474L))
                           :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#14474L,ss_hdemo_sk#14476L,ss_addr_sk#14477L,ss_store_sk#14478L,ss_ticket_number#14480L,ss_coupon_amt#14490,ss_net_profit#14493,ss_sold_date_sk#14494L] Batched: true, DataFilters: [isnotnull(ss_store_sk#14478L), isnotnull(ss_hdemo_sk#14476L), isnotnull(ss_addr_sk#14477L), isno..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#14494L), dynamicpruningexpression(ss_sold_date_sk#14494L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:bigint,ss_store_sk:bigint,ss_ticket_nu...
                           :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#14610, 0, true, Project [d_date_sk#14495L], [d_date_sk#14495L]
                           :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                           :           :     :     :              +- Project [d_date_sk#14495L]
                           :           :     :     :                 +- Filter ((d_dow#14502 IN (6,0) AND d_year#14501 IN (1998,1999,2000)) AND isnotnull(d_date_sk#14495L))
                           :           :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14495L,d_year#14501,d_dow#14502] Batched: true, DataFilters: [d_dow#14502 IN (6,0), d_year#14501 IN (1998,1999,2000), isnotnull(d_date_sk#14495L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_dow, [0,6]), In(d_year, [1998,1999,2000]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dow:int>
                           :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15243]
                           :           :     :        +- Project [s_store_sk#14523L]
                           :           :     :           +- Filter (s_city#14545 IN (Cedar Grove,Wildwood,Union,Salem,Highland Park) AND isnotnull(s_store_sk#14523L))
                           :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14523L,s_city#14545] Batched: true, DataFilters: [s_city#14545 IN (Cedar Grove,Wildwood,Union,Salem,Highland Park), isnotnull(s_store_sk#14523L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_city, [Cedar Grove,Highland Park,Salem,Union,Wildwood]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_city:string>
                           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15247]
                           :           :        +- Project [d_date_sk#14495L]
                           :           :           +- Filter ((d_dow#14502 IN (6,0) AND d_year#14501 IN (1998,1999,2000)) AND isnotnull(d_date_sk#14495L))
                           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14495L,d_year#14501,d_dow#14502] Batched: true, DataFilters: [d_dow#14502 IN (6,0), d_year#14501 IN (1998,1999,2000), isnotnull(d_date_sk#14495L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_dow, [0,6]), In(d_year, [1998,1999,2000]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dow:int>
                           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15251]
                           :              +- Project [hd_demo_sk#14552L]
                           :                 +- Filter (((hd_dep_count#14555 = 2) OR (hd_vehicle_count#14556 = 1)) AND isnotnull(hd_demo_sk#14552L))
                           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#14552L,hd_dep_count#14555,hd_vehicle_count#14556] Batched: true, DataFilters: [((hd_dep_count#14555 = 2) OR (hd_vehicle_count#14556 = 1)), isnotnull(hd_demo_sk#14552L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,2),EqualTo(hd_vehicle_count,1)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
                           +- Sort [ca_address_sk#14557L ASC NULLS FIRST], false, 0
                              +- Exchange hashpartitioning(ca_address_sk#14557L, 3000), ENSURE_REQUIREMENTS, [id=#15257]
                                 +- Filter (isnotnull(ca_address_sk#14557L) AND isnotnull(ca_city#14563))
                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#14557L,ca_city#14563] Batched: true, DataFilters: [isnotnull(ca_address_sk#14557L), isnotnull(ca_city#14563)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string>

read query: spark_queries/q47.sql
explain query: q47
== Parsed Logical Plan ==
CTE [v1, v2]
:  :- 'SubqueryAlias v1
:  :  +- 'Aggregate ['i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, 'd_moy], ['i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, 'd_moy, 'sum('ss_sales_price) AS sum_sales#14615, 'avg('sum('ss_sales_price)) windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, unspecifiedframe$()) AS avg_monthly_sales#14616, 'rank() windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, unspecifiedframe$()) AS rn#14617]
:  :     +- 'Filter ((('ss_item_sk = 'i_item_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND (('ss_store_sk = 's_store_sk) AND ((('d_year = 2000) OR (('d_year = (2000 - 1)) AND ('d_moy = 12))) OR (('d_year = (2000 + 1)) AND ('d_moy = 1)))))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [item], [], false
:  :           :  :  +- 'UnresolvedRelation [store_sales], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [store], [], false
:  +- 'SubqueryAlias v2
:     +- 'Project ['v1.i_category, 'v1.d_year, 'v1.d_moy, 'v1.avg_monthly_sales, 'v1.sum_sales, 'v1_lag.sum_sales AS psum#14618, 'v1_lead.sum_sales AS nsum#14619]
:        +- 'Filter ((((('v1.i_category = 'v1_lag.i_category) AND ('v1.i_category = 'v1_lead.i_category)) AND ('v1.i_brand = 'v1_lag.i_brand)) AND (('v1.i_brand = 'v1_lead.i_brand) AND ('v1.s_store_name = 'v1_lag.s_store_name))) AND (((('v1.s_store_name = 'v1_lead.s_store_name) AND ('v1.s_company_name = 'v1_lag.s_company_name)) AND ('v1.s_company_name = 'v1_lead.s_company_name)) AND (('v1.rn = ('v1_lag.rn + 1)) AND ('v1.rn = ('v1_lead.rn - 1)))))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [v1], [], false
:              :  +- 'SubqueryAlias v1_lag
:              :     +- 'UnresolvedRelation [v1], [], false
:              +- 'SubqueryAlias v1_lead
:                 +- 'UnresolvedRelation [v1], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 3 ASC NULLS FIRST], true
         +- 'Project [*]
            +- 'Filter ((('d_year = 2000) AND ('avg_monthly_sales > 0)) AND (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1))
               +- 'UnresolvedRelation [v2], [], false

== Analyzed Logical Plan ==
i_category: string, d_year: int, d_moy: int, avg_monthly_sales: double, sum_sales: double, psum: double, nsum: double
WithCTE
:- CTERelationDef 27
:  +- SubqueryAlias v1
:     +- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617]
:        +- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, _w0#14735, avg_monthly_sales#14616, rn#14617, avg_monthly_sales#14616, rn#14617]
:           +- Window [rank(d_year#14673, d_moy#14675) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14617], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712], [d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST]
:              +- Window [avg(_w0#14735) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#14616], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673]
:                 +- Aggregate [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum(ss_sales_price#14656) AS sum_sales#14615, sum(ss_sales_price#14656) AS _w0#14735]
:                    +- Filter (((ss_item_sk#14645L = i_item_sk#14622L) AND (ss_sold_date_sk#14666L = d_date_sk#14667L)) AND ((ss_store_sk#14650L = s_store_sk#14695L) AND (((d_year#14673 = 2000) OR ((d_year#14673 = (2000 - 1)) AND (d_moy#14675 = 12))) OR ((d_year#14673 = (2000 + 1)) AND (d_moy#14675 = 1)))))
:                       +- Join Inner
:                          :- Join Inner
:                          :  :- Join Inner
:                          :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                          :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14622L,i_item_id#14623,i_rec_start_date#14624,i_rec_end_date#14625,i_item_desc#14626,i_current_price#14627,i_wholesale_cost#14628,i_brand_id#14629,i_brand#14630,i_class_id#14631,i_class#14632,i_category_id#14633,i_category#14634,i_manufact_id#14635,i_manufact#14636,i_size#14637,i_formulation#14638,i_color#14639,i_units#14640,i_container#14641,i_manager_id#14642,i_product_name#14643] orc
:                          :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                          :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14644L,ss_item_sk#14645L,ss_customer_sk#14646L,ss_cdemo_sk#14647L,ss_hdemo_sk#14648L,ss_addr_sk#14649L,ss_store_sk#14650L,ss_promo_sk#14651L,ss_ticket_number#14652L,ss_quantity#14653,ss_wholesale_cost#14654,ss_list_price#14655,ss_sales_price#14656,ss_ext_discount_amt#14657,ss_ext_sales_price#14658,ss_ext_wholesale_cost#14659,ss_ext_list_price#14660,ss_ext_tax#14661,ss_coupon_amt#14662,ss_net_paid#14663,ss_net_paid_inc_tax#14664,ss_net_profit#14665,ss_sold_date_sk#14666L] orc
:                          :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14667L,d_date_id#14668,d_date#14669,d_month_seq#14670,d_week_seq#14671,d_quarter_seq#14672,d_year#14673,d_dow#14674,d_moy#14675,d_dom#14676,d_qoy#14677,d_fy_year#14678,d_fy_quarter_seq#14679,d_fy_week_seq#14680,d_day_name#14681,d_quarter_name#14682,d_holiday#14683,d_weekend#14684,d_following_holiday#14685,d_first_dom#14686,d_last_dom#14687,d_same_day_ly#14688,d_same_day_lq#14689,d_current_day#14690,... 4 more fields] orc
:                          +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:                             +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14695L,s_store_id#14696,s_rec_start_date#14697,s_rec_end_date#14698,s_closed_date_sk#14699L,s_store_name#14700,s_number_employees#14701,s_floor_space#14702,s_hours#14703,s_manager#14704,s_market_id#14705,s_geography_class#14706,s_market_desc#14707,s_market_manager#14708,s_division_id#14709,s_division_name#14710,s_company_id#14711,s_company_name#14712,s_street_number#14713,s_street_name#14714,s_street_type#14715,s_suite_number#14716,s_city#14717,s_county#14718,... 5 more fields] orc
:- CTERelationDef 28
:  +- SubqueryAlias v2
:     +- Project [i_category#14634, d_year#14673, d_moy#14675, avg_monthly_sales#14616, sum_sales#14615, sum_sales#14742 AS psum#14618, sum_sales#14751 AS nsum#14619]
:        +- Filter (((((i_category#14634 = i_category#14736) AND (i_category#14634 = i_category#14745)) AND (i_brand#14630 = i_brand#14737)) AND ((i_brand#14630 = i_brand#14746) AND (s_store_name#14700 = s_store_name#14738))) AND ((((s_store_name#14700 = s_store_name#14747) AND (s_company_name#14712 = s_company_name#14739)) AND (s_company_name#14712 = s_company_name#14748)) AND ((rn#14617 = (rn#14744 + 1)) AND (rn#14617 = (rn#14753 - 1)))))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias v1
:              :  :  +- CTERelationRef 27, true, [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617]
:              :  +- SubqueryAlias v1_lag
:              :     +- SubqueryAlias v1
:              :        +- CTERelationRef 27, true, [i_category#14736, i_brand#14737, s_store_name#14738, s_company_name#14739, d_year#14740, d_moy#14741, sum_sales#14742, avg_monthly_sales#14743, rn#14744]
:              +- SubqueryAlias v1_lead
:                 +- SubqueryAlias v1
:                    +- CTERelationRef 27, true, [i_category#14745, i_brand#14746, s_store_name#14747, s_company_name#14748, d_year#14749, d_moy#14750, sum_sales#14751, avg_monthly_sales#14752, rn#14753]
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [(sum_sales#14615 - avg_monthly_sales#14616) ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST], true
         +- Project [i_category#14634, d_year#14673, d_moy#14675, avg_monthly_sales#14616, sum_sales#14615, psum#14618, nsum#14619]
            +- Filter (((d_year#14673 = 2000) AND (avg_monthly_sales#14616 > cast(0 as double))) AND (CASE WHEN (avg_monthly_sales#14616 > cast(0 as double)) THEN (abs((sum_sales#14615 - avg_monthly_sales#14616), false) / avg_monthly_sales#14616) ELSE cast(null as double) END > cast(0.1 as double)))
               +- SubqueryAlias v2
                  +- CTERelationRef 28, true, [i_category#14634, d_year#14673, d_moy#14675, avg_monthly_sales#14616, sum_sales#14615, psum#14618, nsum#14619]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [(sum_sales#14615 - avg_monthly_sales#14616) ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST], true
      +- Project [i_category#14634, d_year#14673, d_moy#14675, avg_monthly_sales#14616, sum_sales#14615, sum_sales#14742 AS psum#14618, sum_sales#14751 AS nsum#14619]
         +- Join Inner, (((((i_category#14634 = i_category#14880) AND (i_brand#14630 = i_brand#14876)) AND (s_store_name#14700 = s_store_name#14946)) AND (s_company_name#14712 = s_company_name#14958)) AND (rn#14617 = (rn#14974 - 1)))
            :- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617, sum_sales#14742]
            :  +- Join Inner, (((((i_category#14634 = i_category#14773) AND (i_brand#14630 = i_brand#14769)) AND (s_store_name#14700 = s_store_name#14839)) AND (s_company_name#14712 = s_company_name#14851)) AND (rn#14617 = (rn#14867 + 1)))
            :     :- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617]
            :     :  +- Filter (((isnotnull(avg_monthly_sales#14616) AND isnotnull(sum_sales#14615)) AND (avg_monthly_sales#14616 > 0.0)) AND ((abs((sum_sales#14615 - avg_monthly_sales#14616), false) / avg_monthly_sales#14616) > 0.1))
            :     :     +- Window [avg(_w0#14735) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#14616], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673]
            :     :        +- Filter (isnotnull(d_year#14673) AND (d_year#14673 = 2000))
            :     :           +- Window [rank(d_year#14673, d_moy#14675) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14617], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712], [d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST]
            :     :              +- Aggregate [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum(ss_sales_price#14656) AS sum_sales#14615, sum(ss_sales_price#14656) AS _w0#14735]
            :     :                 +- Project [i_brand#14630, i_category#14634, ss_sales_price#14656, d_year#14673, d_moy#14675, s_store_name#14700, s_company_name#14712]
            :     :                    +- Join Inner, (ss_item_sk#14645L = i_item_sk#14622L)
            :     :                       :- Project [ss_item_sk#14645L, ss_sales_price#14656, d_year#14673, d_moy#14675, s_store_name#14700, s_company_name#14712]
            :     :                       :  +- Join Inner, (ss_store_sk#14650L = s_store_sk#14695L)
            :     :                       :     :- Project [ss_item_sk#14645L, ss_store_sk#14650L, ss_sales_price#14656, d_year#14673, d_moy#14675]
            :     :                       :     :  +- Join Inner, (ss_sold_date_sk#14666L = d_date_sk#14667L)
            :     :                       :     :     :- Project [ss_item_sk#14645L, ss_store_sk#14650L, ss_sales_price#14656, ss_sold_date_sk#14666L]
            :     :                       :     :     :  +- Filter (((isnotnull(ss_item_sk#14645L) AND isnotnull(ss_sold_date_sk#14666L)) AND isnotnull(ss_store_sk#14650L)) AND dynamicpruning#14975 [ss_sold_date_sk#14666L])
            :     :                       :     :     :     :  +- Project [d_date_sk#14667L, d_year#14673, d_moy#14675]
            :     :                       :     :     :     :     +- Filter ((((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2001) AND (d_moy#14675 = 1))) AND isnotnull(d_date_sk#14667L))
            :     :                       :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14667L,d_date_id#14668,d_date#14669,d_month_seq#14670,d_week_seq#14671,d_quarter_seq#14672,d_year#14673,d_dow#14674,d_moy#14675,d_dom#14676,d_qoy#14677,d_fy_year#14678,d_fy_quarter_seq#14679,d_fy_week_seq#14680,d_day_name#14681,d_quarter_name#14682,d_holiday#14683,d_weekend#14684,d_following_holiday#14685,d_first_dom#14686,d_last_dom#14687,d_same_day_ly#14688,d_same_day_lq#14689,d_current_day#14690,... 4 more fields] orc
            :     :                       :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14644L,ss_item_sk#14645L,ss_customer_sk#14646L,ss_cdemo_sk#14647L,ss_hdemo_sk#14648L,ss_addr_sk#14649L,ss_store_sk#14650L,ss_promo_sk#14651L,ss_ticket_number#14652L,ss_quantity#14653,ss_wholesale_cost#14654,ss_list_price#14655,ss_sales_price#14656,ss_ext_discount_amt#14657,ss_ext_sales_price#14658,ss_ext_wholesale_cost#14659,ss_ext_list_price#14660,ss_ext_tax#14661,ss_coupon_amt#14662,ss_net_paid#14663,ss_net_paid_inc_tax#14664,ss_net_profit#14665,ss_sold_date_sk#14666L] orc
            :     :                       :     :     +- Project [d_date_sk#14667L, d_year#14673, d_moy#14675]
            :     :                       :     :        +- Filter ((((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2001) AND (d_moy#14675 = 1))) AND isnotnull(d_date_sk#14667L))
            :     :                       :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14667L,d_date_id#14668,d_date#14669,d_month_seq#14670,d_week_seq#14671,d_quarter_seq#14672,d_year#14673,d_dow#14674,d_moy#14675,d_dom#14676,d_qoy#14677,d_fy_year#14678,d_fy_quarter_seq#14679,d_fy_week_seq#14680,d_day_name#14681,d_quarter_name#14682,d_holiday#14683,d_weekend#14684,d_following_holiday#14685,d_first_dom#14686,d_last_dom#14687,d_same_day_ly#14688,d_same_day_lq#14689,d_current_day#14690,... 4 more fields] orc
            :     :                       :     +- Project [s_store_sk#14695L, s_store_name#14700, s_company_name#14712]
            :     :                       :        +- Filter (isnotnull(s_store_sk#14695L) AND (isnotnull(s_store_name#14700) AND isnotnull(s_company_name#14712)))
            :     :                       :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14695L,s_store_id#14696,s_rec_start_date#14697,s_rec_end_date#14698,s_closed_date_sk#14699L,s_store_name#14700,s_number_employees#14701,s_floor_space#14702,s_hours#14703,s_manager#14704,s_market_id#14705,s_geography_class#14706,s_market_desc#14707,s_market_manager#14708,s_division_id#14709,s_division_name#14710,s_company_id#14711,s_company_name#14712,s_street_number#14713,s_street_name#14714,s_street_type#14715,s_suite_number#14716,s_city#14717,s_county#14718,... 5 more fields] orc
            :     :                       +- Project [i_item_sk#14622L, i_brand#14630, i_category#14634]
            :     :                          +- Filter (isnotnull(i_item_sk#14622L) AND (isnotnull(i_category#14634) AND isnotnull(i_brand#14630)))
            :     :                             +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14622L,i_item_id#14623,i_rec_start_date#14624,i_rec_end_date#14625,i_item_desc#14626,i_current_price#14627,i_wholesale_cost#14628,i_brand_id#14629,i_brand#14630,i_class_id#14631,i_class#14632,i_category_id#14633,i_category#14634,i_manufact_id#14635,i_manufact#14636,i_size#14637,i_formulation#14638,i_color#14639,i_units#14640,i_container#14641,i_manager_id#14642,i_product_name#14643] orc
            :     +- Project [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, sum_sales#14615 AS sum_sales#14742, rn#14867]
            :        +- Window [rank(d_year#14812, d_moy#14814) windowspecdefinition(i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812 ASC NULLS FIRST, d_moy#14814 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14867], [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851], [d_year#14812 ASC NULLS FIRST, d_moy#14814 ASC NULLS FIRST]
            :           +- Aggregate [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814], [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814, sum(ss_sales_price#14795) AS sum_sales#14615]
            :              +- Project [i_brand#14769, i_category#14773, ss_sales_price#14795, d_year#14812, d_moy#14814, s_store_name#14839, s_company_name#14851]
            :                 +- Join Inner, (ss_item_sk#14784L = i_item_sk#14761L)
            :                    :- Project [ss_item_sk#14784L, ss_sales_price#14795, d_year#14812, d_moy#14814, s_store_name#14839, s_company_name#14851]
            :                    :  +- Join Inner, (ss_store_sk#14789L = s_store_sk#14834L)
            :                    :     :- Project [ss_item_sk#14784L, ss_store_sk#14789L, ss_sales_price#14795, d_year#14812, d_moy#14814]
            :                    :     :  +- Join Inner, (ss_sold_date_sk#14805L = d_date_sk#14806L)
            :                    :     :     :- Project [ss_item_sk#14784L, ss_store_sk#14789L, ss_sales_price#14795, ss_sold_date_sk#14805L]
            :                    :     :     :  +- Filter (((isnotnull(ss_item_sk#14784L) AND isnotnull(ss_sold_date_sk#14805L)) AND isnotnull(ss_store_sk#14789L)) AND dynamicpruning#14976 [ss_sold_date_sk#14805L])
            :                    :     :     :     :  +- Project [d_date_sk#14806L, d_year#14812, d_moy#14814]
            :                    :     :     :     :     +- Filter ((((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2001) AND (d_moy#14814 = 1))) AND isnotnull(d_date_sk#14806L))
            :                    :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14806L,d_date_id#14807,d_date#14808,d_month_seq#14809,d_week_seq#14810,d_quarter_seq#14811,d_year#14812,d_dow#14813,d_moy#14814,d_dom#14815,d_qoy#14816,d_fy_year#14817,d_fy_quarter_seq#14818,d_fy_week_seq#14819,d_day_name#14820,d_quarter_name#14821,d_holiday#14822,d_weekend#14823,d_following_holiday#14824,d_first_dom#14825,d_last_dom#14826,d_same_day_ly#14827,d_same_day_lq#14828,d_current_day#14829,... 4 more fields] orc
            :                    :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14783L,ss_item_sk#14784L,ss_customer_sk#14785L,ss_cdemo_sk#14786L,ss_hdemo_sk#14787L,ss_addr_sk#14788L,ss_store_sk#14789L,ss_promo_sk#14790L,ss_ticket_number#14791L,ss_quantity#14792,ss_wholesale_cost#14793,ss_list_price#14794,ss_sales_price#14795,ss_ext_discount_amt#14796,ss_ext_sales_price#14797,ss_ext_wholesale_cost#14798,ss_ext_list_price#14799,ss_ext_tax#14800,ss_coupon_amt#14801,ss_net_paid#14802,ss_net_paid_inc_tax#14803,ss_net_profit#14804,ss_sold_date_sk#14805L] orc
            :                    :     :     +- Project [d_date_sk#14806L, d_year#14812, d_moy#14814]
            :                    :     :        +- Filter ((((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2001) AND (d_moy#14814 = 1))) AND isnotnull(d_date_sk#14806L))
            :                    :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14806L,d_date_id#14807,d_date#14808,d_month_seq#14809,d_week_seq#14810,d_quarter_seq#14811,d_year#14812,d_dow#14813,d_moy#14814,d_dom#14815,d_qoy#14816,d_fy_year#14817,d_fy_quarter_seq#14818,d_fy_week_seq#14819,d_day_name#14820,d_quarter_name#14821,d_holiday#14822,d_weekend#14823,d_following_holiday#14824,d_first_dom#14825,d_last_dom#14826,d_same_day_ly#14827,d_same_day_lq#14828,d_current_day#14829,... 4 more fields] orc
            :                    :     +- Project [s_store_sk#14834L, s_store_name#14839, s_company_name#14851]
            :                    :        +- Filter (isnotnull(s_store_sk#14834L) AND (isnotnull(s_store_name#14839) AND isnotnull(s_company_name#14851)))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14834L,s_store_id#14835,s_rec_start_date#14836,s_rec_end_date#14837,s_closed_date_sk#14838L,s_store_name#14839,s_number_employees#14840,s_floor_space#14841,s_hours#14842,s_manager#14843,s_market_id#14844,s_geography_class#14845,s_market_desc#14846,s_market_manager#14847,s_division_id#14848,s_division_name#14849,s_company_id#14850,s_company_name#14851,s_street_number#14852,s_street_name#14853,s_street_type#14854,s_suite_number#14855,s_city#14856,s_county#14857,... 5 more fields] orc
            :                    +- Project [i_item_sk#14761L, i_brand#14769, i_category#14773]
            :                       +- Filter (isnotnull(i_item_sk#14761L) AND (isnotnull(i_category#14773) AND isnotnull(i_brand#14769)))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14761L,i_item_id#14762,i_rec_start_date#14763,i_rec_end_date#14764,i_item_desc#14765,i_current_price#14766,i_wholesale_cost#14767,i_brand_id#14768,i_brand#14769,i_class_id#14770,i_class#14771,i_category_id#14772,i_category#14773,i_manufact_id#14774,i_manufact#14775,i_size#14776,i_formulation#14777,i_color#14778,i_units#14779,i_container#14780,i_manager_id#14781,i_product_name#14782] orc
            +- Project [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, sum_sales#14615 AS sum_sales#14751, rn#14974]
               +- Window [rank(d_year#14919, d_moy#14921) windowspecdefinition(i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919 ASC NULLS FIRST, d_moy#14921 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14974], [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958], [d_year#14919 ASC NULLS FIRST, d_moy#14921 ASC NULLS FIRST]
                  +- Aggregate [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921], [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921, sum(ss_sales_price#14902) AS sum_sales#14615]
                     +- Project [i_brand#14876, i_category#14880, ss_sales_price#14902, d_year#14919, d_moy#14921, s_store_name#14946, s_company_name#14958]
                        +- Join Inner, (ss_item_sk#14891L = i_item_sk#14868L)
                           :- Project [ss_item_sk#14891L, ss_sales_price#14902, d_year#14919, d_moy#14921, s_store_name#14946, s_company_name#14958]
                           :  +- Join Inner, (ss_store_sk#14896L = s_store_sk#14941L)
                           :     :- Project [ss_item_sk#14891L, ss_store_sk#14896L, ss_sales_price#14902, d_year#14919, d_moy#14921]
                           :     :  +- Join Inner, (ss_sold_date_sk#14912L = d_date_sk#14913L)
                           :     :     :- Project [ss_item_sk#14891L, ss_store_sk#14896L, ss_sales_price#14902, ss_sold_date_sk#14912L]
                           :     :     :  +- Filter (((isnotnull(ss_item_sk#14891L) AND isnotnull(ss_sold_date_sk#14912L)) AND isnotnull(ss_store_sk#14896L)) AND dynamicpruning#14977 [ss_sold_date_sk#14912L])
                           :     :     :     :  +- Project [d_date_sk#14913L, d_year#14919, d_moy#14921]
                           :     :     :     :     +- Filter ((((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2001) AND (d_moy#14921 = 1))) AND isnotnull(d_date_sk#14913L))
                           :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14913L,d_date_id#14914,d_date#14915,d_month_seq#14916,d_week_seq#14917,d_quarter_seq#14918,d_year#14919,d_dow#14920,d_moy#14921,d_dom#14922,d_qoy#14923,d_fy_year#14924,d_fy_quarter_seq#14925,d_fy_week_seq#14926,d_day_name#14927,d_quarter_name#14928,d_holiday#14929,d_weekend#14930,d_following_holiday#14931,d_first_dom#14932,d_last_dom#14933,d_same_day_ly#14934,d_same_day_lq#14935,d_current_day#14936,... 4 more fields] orc
                           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14890L,ss_item_sk#14891L,ss_customer_sk#14892L,ss_cdemo_sk#14893L,ss_hdemo_sk#14894L,ss_addr_sk#14895L,ss_store_sk#14896L,ss_promo_sk#14897L,ss_ticket_number#14898L,ss_quantity#14899,ss_wholesale_cost#14900,ss_list_price#14901,ss_sales_price#14902,ss_ext_discount_amt#14903,ss_ext_sales_price#14904,ss_ext_wholesale_cost#14905,ss_ext_list_price#14906,ss_ext_tax#14907,ss_coupon_amt#14908,ss_net_paid#14909,ss_net_paid_inc_tax#14910,ss_net_profit#14911,ss_sold_date_sk#14912L] orc
                           :     :     +- Project [d_date_sk#14913L, d_year#14919, d_moy#14921]
                           :     :        +- Filter ((((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2001) AND (d_moy#14921 = 1))) AND isnotnull(d_date_sk#14913L))
                           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14913L,d_date_id#14914,d_date#14915,d_month_seq#14916,d_week_seq#14917,d_quarter_seq#14918,d_year#14919,d_dow#14920,d_moy#14921,d_dom#14922,d_qoy#14923,d_fy_year#14924,d_fy_quarter_seq#14925,d_fy_week_seq#14926,d_day_name#14927,d_quarter_name#14928,d_holiday#14929,d_weekend#14930,d_following_holiday#14931,d_first_dom#14932,d_last_dom#14933,d_same_day_ly#14934,d_same_day_lq#14935,d_current_day#14936,... 4 more fields] orc
                           :     +- Project [s_store_sk#14941L, s_store_name#14946, s_company_name#14958]
                           :        +- Filter (isnotnull(s_store_sk#14941L) AND (isnotnull(s_store_name#14946) AND isnotnull(s_company_name#14958)))
                           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14941L,s_store_id#14942,s_rec_start_date#14943,s_rec_end_date#14944,s_closed_date_sk#14945L,s_store_name#14946,s_number_employees#14947,s_floor_space#14948,s_hours#14949,s_manager#14950,s_market_id#14951,s_geography_class#14952,s_market_desc#14953,s_market_manager#14954,s_division_id#14955,s_division_name#14956,s_company_id#14957,s_company_name#14958,s_street_number#14959,s_street_name#14960,s_street_type#14961,s_suite_number#14962,s_city#14963,s_county#14964,... 5 more fields] orc
                           +- Project [i_item_sk#14868L, i_brand#14876, i_category#14880]
                              +- Filter (isnotnull(i_item_sk#14868L) AND (isnotnull(i_category#14880) AND isnotnull(i_brand#14876)))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14868L,i_item_id#14869,i_rec_start_date#14870,i_rec_end_date#14871,i_item_desc#14872,i_current_price#14873,i_wholesale_cost#14874,i_brand_id#14875,i_brand#14876,i_class_id#14877,i_class#14878,i_category_id#14879,i_category#14880,i_manufact_id#14881,i_manufact#14882,i_size#14883,i_formulation#14884,i_color#14885,i_units#14886,i_container#14887,i_manager_id#14888,i_product_name#14889] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[(sum_sales#14615 - avg_monthly_sales#14616) ASC NULLS FIRST,d_moy#14675 ASC NULLS FIRST], output=[i_category#14634,d_year#14673,d_moy#14675,avg_monthly_sales#14616,sum_sales#14615,psum#14618,nsum#14619])
   +- Project [i_category#14634, d_year#14673, d_moy#14675, avg_monthly_sales#14616, sum_sales#14615, sum_sales#14742 AS psum#14618, sum_sales#14751 AS nsum#14619]
      +- SortMergeJoin [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, rn#14617], [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, (rn#14974 - 1)], Inner
         :- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617, sum_sales#14742]
         :  +- SortMergeJoin [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, rn#14617], [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, (rn#14867 + 1)], Inner
         :     :- Sort [i_category#14634 ASC NULLS FIRST, i_brand#14630 ASC NULLS FIRST, s_store_name#14700 ASC NULLS FIRST, s_company_name#14712 ASC NULLS FIRST, rn#14617 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, rn#14617, 3000), ENSURE_REQUIREMENTS, [id=#15673]
         :     :     +- Project [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, avg_monthly_sales#14616, rn#14617]
         :     :        +- Filter (((isnotnull(avg_monthly_sales#14616) AND isnotnull(sum_sales#14615)) AND (avg_monthly_sales#14616 > 0.0)) AND ((abs((sum_sales#14615 - avg_monthly_sales#14616), false) / avg_monthly_sales#14616) > 0.1))
         :     :           +- Window [avg(_w0#14735) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#14616], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673]
         :     :              +- Filter (isnotnull(d_year#14673) AND (d_year#14673 = 2000))
         :     :                 +- Window [rank(d_year#14673, d_moy#14675) windowspecdefinition(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14617], [i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712], [d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#14634 ASC NULLS FIRST, i_brand#14630 ASC NULLS FIRST, s_store_name#14700 ASC NULLS FIRST, s_company_name#14712 ASC NULLS FIRST, d_year#14673 ASC NULLS FIRST, d_moy#14675 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, 3000), ENSURE_REQUIREMENTS, [id=#15640]
         :     :                          +- HashAggregate(keys=[i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675], functions=[sum(ss_sales_price#14656)], output=[i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum_sales#14615, _w0#14735])
         :     :                             +- Exchange hashpartitioning(i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, 3000), ENSURE_REQUIREMENTS, [id=#15637]
         :     :                                +- HashAggregate(keys=[i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675], functions=[partial_sum(ss_sales_price#14656)], output=[i_category#14634, i_brand#14630, s_store_name#14700, s_company_name#14712, d_year#14673, d_moy#14675, sum#14979])
         :     :                                   +- Project [i_brand#14630, i_category#14634, ss_sales_price#14656, d_year#14673, d_moy#14675, s_store_name#14700, s_company_name#14712]
         :     :                                      +- SortMergeJoin [ss_item_sk#14645L], [i_item_sk#14622L], Inner
         :     :                                         :- Sort [ss_item_sk#14645L ASC NULLS FIRST], false, 0
         :     :                                         :  +- Exchange hashpartitioning(ss_item_sk#14645L, 3000), ENSURE_REQUIREMENTS, [id=#15629]
         :     :                                         :     +- Project [ss_item_sk#14645L, ss_sales_price#14656, d_year#14673, d_moy#14675, s_store_name#14700, s_company_name#14712]
         :     :                                         :        +- BroadcastHashJoin [ss_store_sk#14650L], [s_store_sk#14695L], Inner, BuildRight, false
         :     :                                         :           :- Project [ss_item_sk#14645L, ss_store_sk#14650L, ss_sales_price#14656, d_year#14673, d_moy#14675]
         :     :                                         :           :  +- BroadcastHashJoin [ss_sold_date_sk#14666L], [d_date_sk#14667L], Inner, BuildRight, false
         :     :                                         :           :     :- Filter (isnotnull(ss_item_sk#14645L) AND isnotnull(ss_store_sk#14650L))
         :     :                                         :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#14645L,ss_store_sk#14650L,ss_sales_price#14656,ss_sold_date_sk#14666L] Batched: true, DataFilters: [isnotnull(ss_item_sk#14645L), isnotnull(ss_store_sk#14650L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#14666L), dynamicpruningexpression(ss_sold_date_sk#14666L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
         :     :                                         :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#14975, 0, true, Project [d_date_sk#14667L, d_year#14673, d_moy#14675], [d_date_sk#14667L]
         :     :                                         :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                                         :           :     :              +- Filter ((((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2001) AND (d_moy#14675 = 1))) AND isnotnull(d_date_sk#14667L))
         :     :                                         :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14667L,d_year#14673,d_moy#14675] Batched: true, DataFilters: [(((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :     :                                         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15620]
         :     :                                         :           :        +- Filter ((((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2001) AND (d_moy#14675 = 1))) AND isnotnull(d_date_sk#14667L))
         :     :                                         :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14667L,d_year#14673,d_moy#14675] Batched: true, DataFilters: [(((d_year#14673 = 2000) OR ((d_year#14673 = 1999) AND (d_moy#14675 = 12))) OR ((d_year#14673 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15624]
         :     :                                         :              +- Filter ((isnotnull(s_store_sk#14695L) AND isnotnull(s_store_name#14700)) AND isnotnull(s_company_name#14712))
         :     :                                         :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14695L,s_store_name#14700,s_company_name#14712] Batched: true, DataFilters: [isnotnull(s_store_sk#14695L), isnotnull(s_store_name#14700), isnotnull(s_company_name#14712)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_company_name:string>
         :     :                                         +- Sort [i_item_sk#14622L ASC NULLS FIRST], false, 0
         :     :                                            +- Exchange hashpartitioning(i_item_sk#14622L, 3000), ENSURE_REQUIREMENTS, [id=#15630]
         :     :                                               +- Filter ((isnotnull(i_item_sk#14622L) AND isnotnull(i_category#14634)) AND isnotnull(i_brand#14630))
         :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14622L,i_brand#14630,i_category#14634] Batched: true, DataFilters: [isnotnull(i_item_sk#14622L), isnotnull(i_category#14634), isnotnull(i_brand#14630)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>
         :     +- Sort [i_category#14773 ASC NULLS FIRST, i_brand#14769 ASC NULLS FIRST, s_store_name#14839 ASC NULLS FIRST, s_company_name#14851 ASC NULLS FIRST, (rn#14867 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, (rn#14867 + 1), 3000), ENSURE_REQUIREMENTS, [id=#15674]
         :           +- Project [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, sum_sales#14615 AS sum_sales#14742, rn#14867]
         :              +- Window [rank(d_year#14812, d_moy#14814) windowspecdefinition(i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812 ASC NULLS FIRST, d_moy#14814 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14867], [i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851], [d_year#14812 ASC NULLS FIRST, d_moy#14814 ASC NULLS FIRST]
         :                 +- Sort [i_category#14773 ASC NULLS FIRST, i_brand#14769 ASC NULLS FIRST, s_store_name#14839 ASC NULLS FIRST, s_company_name#14851 ASC NULLS FIRST, d_year#14812 ASC NULLS FIRST, d_moy#14814 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, 3000), ENSURE_REQUIREMENTS, [id=#15667]
         :                       +- HashAggregate(keys=[i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814], functions=[sum(ss_sales_price#14795)], output=[i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814, sum_sales#14615])
         :                          +- Exchange hashpartitioning(i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814, 3000), ENSURE_REQUIREMENTS, [id=#15664]
         :                             +- HashAggregate(keys=[i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814], functions=[partial_sum(ss_sales_price#14795)], output=[i_category#14773, i_brand#14769, s_store_name#14839, s_company_name#14851, d_year#14812, d_moy#14814, sum#14981])
         :                                +- Project [i_brand#14769, i_category#14773, ss_sales_price#14795, d_year#14812, d_moy#14814, s_store_name#14839, s_company_name#14851]
         :                                   +- SortMergeJoin [ss_item_sk#14784L], [i_item_sk#14761L], Inner
         :                                      :- Sort [ss_item_sk#14784L ASC NULLS FIRST], false, 0
         :                                      :  +- Exchange hashpartitioning(ss_item_sk#14784L, 3000), ENSURE_REQUIREMENTS, [id=#15656]
         :                                      :     +- Project [ss_item_sk#14784L, ss_sales_price#14795, d_year#14812, d_moy#14814, s_store_name#14839, s_company_name#14851]
         :                                      :        +- BroadcastHashJoin [ss_store_sk#14789L], [s_store_sk#14834L], Inner, BuildRight, false
         :                                      :           :- Project [ss_item_sk#14784L, ss_store_sk#14789L, ss_sales_price#14795, d_year#14812, d_moy#14814]
         :                                      :           :  +- BroadcastHashJoin [ss_sold_date_sk#14805L], [d_date_sk#14806L], Inner, BuildRight, false
         :                                      :           :     :- Filter (isnotnull(ss_item_sk#14784L) AND isnotnull(ss_store_sk#14789L))
         :                                      :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#14784L,ss_store_sk#14789L,ss_sales_price#14795,ss_sold_date_sk#14805L] Batched: true, DataFilters: [isnotnull(ss_item_sk#14784L), isnotnull(ss_store_sk#14789L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#14805L), dynamicpruningexpression(ss_sold_date_sk#14805L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
         :                                      :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#14976, 0, true, Project [d_date_sk#14806L, d_year#14812, d_moy#14814], [d_date_sk#14806L]
         :                                      :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                      :           :     :              +- Filter ((((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2001) AND (d_moy#14814 = 1))) AND isnotnull(d_date_sk#14806L))
         :                                      :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14806L,d_year#14812,d_moy#14814] Batched: true, DataFilters: [(((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                                      :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15647]
         :                                      :           :        +- Filter ((((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2001) AND (d_moy#14814 = 1))) AND isnotnull(d_date_sk#14806L))
         :                                      :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14806L,d_year#14812,d_moy#14814] Batched: true, DataFilters: [(((d_year#14812 = 2000) OR ((d_year#14812 = 1999) AND (d_moy#14814 = 12))) OR ((d_year#14812 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                                      :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15651]
         :                                      :              +- Filter ((isnotnull(s_store_sk#14834L) AND isnotnull(s_store_name#14839)) AND isnotnull(s_company_name#14851))
         :                                      :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14834L,s_store_name#14839,s_company_name#14851] Batched: true, DataFilters: [isnotnull(s_store_sk#14834L), isnotnull(s_store_name#14839), isnotnull(s_company_name#14851)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_company_name:string>
         :                                      +- Sort [i_item_sk#14761L ASC NULLS FIRST], false, 0
         :                                         +- Exchange hashpartitioning(i_item_sk#14761L, 3000), ENSURE_REQUIREMENTS, [id=#15657]
         :                                            +- Filter ((isnotnull(i_item_sk#14761L) AND isnotnull(i_category#14773)) AND isnotnull(i_brand#14769))
         :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14761L,i_brand#14769,i_category#14773] Batched: true, DataFilters: [isnotnull(i_item_sk#14761L), isnotnull(i_category#14773), isnotnull(i_brand#14769)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>
         +- Sort [i_category#14880 ASC NULLS FIRST, i_brand#14876 ASC NULLS FIRST, s_store_name#14946 ASC NULLS FIRST, s_company_name#14958 ASC NULLS FIRST, (rn#14974 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, (rn#14974 - 1), 3000), ENSURE_REQUIREMENTS, [id=#15705]
               +- Project [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, sum_sales#14615 AS sum_sales#14751, rn#14974]
                  +- Window [rank(d_year#14919, d_moy#14921) windowspecdefinition(i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919 ASC NULLS FIRST, d_moy#14921 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#14974], [i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958], [d_year#14919 ASC NULLS FIRST, d_moy#14921 ASC NULLS FIRST]
                     +- Sort [i_category#14880 ASC NULLS FIRST, i_brand#14876 ASC NULLS FIRST, s_store_name#14946 ASC NULLS FIRST, s_company_name#14958 ASC NULLS FIRST, d_year#14919 ASC NULLS FIRST, d_moy#14921 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, 3000), ENSURE_REQUIREMENTS, [id=#15699]
                           +- HashAggregate(keys=[i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921], functions=[sum(ss_sales_price#14902)], output=[i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921, sum_sales#14615])
                              +- Exchange hashpartitioning(i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921, 3000), ENSURE_REQUIREMENTS, [id=#15696]
                                 +- HashAggregate(keys=[i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921], functions=[partial_sum(ss_sales_price#14902)], output=[i_category#14880, i_brand#14876, s_store_name#14946, s_company_name#14958, d_year#14919, d_moy#14921, sum#14983])
                                    +- Project [i_brand#14876, i_category#14880, ss_sales_price#14902, d_year#14919, d_moy#14921, s_store_name#14946, s_company_name#14958]
                                       +- SortMergeJoin [ss_item_sk#14891L], [i_item_sk#14868L], Inner
                                          :- Sort [ss_item_sk#14891L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(ss_item_sk#14891L, 3000), ENSURE_REQUIREMENTS, [id=#15688]
                                          :     +- Project [ss_item_sk#14891L, ss_sales_price#14902, d_year#14919, d_moy#14921, s_store_name#14946, s_company_name#14958]
                                          :        +- BroadcastHashJoin [ss_store_sk#14896L], [s_store_sk#14941L], Inner, BuildRight, false
                                          :           :- Project [ss_item_sk#14891L, ss_store_sk#14896L, ss_sales_price#14902, d_year#14919, d_moy#14921]
                                          :           :  +- BroadcastHashJoin [ss_sold_date_sk#14912L], [d_date_sk#14913L], Inner, BuildRight, false
                                          :           :     :- Filter (isnotnull(ss_item_sk#14891L) AND isnotnull(ss_store_sk#14896L))
                                          :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#14891L,ss_store_sk#14896L,ss_sales_price#14902,ss_sold_date_sk#14912L] Batched: true, DataFilters: [isnotnull(ss_item_sk#14891L), isnotnull(ss_store_sk#14896L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#14912L), dynamicpruningexpression(ss_sold_date_sk#14912L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
                                          :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#14977, 0, true, Project [d_date_sk#14913L, d_year#14919, d_moy#14921], [d_date_sk#14913L]
                                          :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :           :     :              +- Filter ((((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2001) AND (d_moy#14921 = 1))) AND isnotnull(d_date_sk#14913L))
                                          :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14913L,d_year#14919,d_moy#14921] Batched: true, DataFilters: [(((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                          :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15679]
                                          :           :        +- Filter ((((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2001) AND (d_moy#14921 = 1))) AND isnotnull(d_date_sk#14913L))
                                          :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#14913L,d_year#14919,d_moy#14921] Batched: true, DataFilters: [(((d_year#14919 = 2000) OR ((d_year#14919 = 1999) AND (d_moy#14921 = 12))) OR ((d_year#14919 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15683]
                                          :              +- Filter ((isnotnull(s_store_sk#14941L) AND isnotnull(s_store_name#14946)) AND isnotnull(s_company_name#14958))
                                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#14941L,s_store_name#14946,s_company_name#14958] Batched: true, DataFilters: [isnotnull(s_store_sk#14941L), isnotnull(s_store_name#14946), isnotnull(s_company_name#14958)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_company_name:string>
                                          +- Sort [i_item_sk#14868L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(i_item_sk#14868L, 3000), ENSURE_REQUIREMENTS, [id=#15689]
                                                +- Filter ((isnotnull(i_item_sk#14868L) AND isnotnull(i_category#14880)) AND isnotnull(i_brand#14876))
                                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#14868L,i_brand#14876,i_category#14880] Batched: true, DataFilters: [isnotnull(i_item_sk#14868L), isnotnull(i_category#14880), isnotnull(i_brand#14876)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>

read query: spark_queries/q48.sql
explain query: q48
== Parsed Logical Plan ==
'Project [unresolvedalias('sum('ss_quantity), None)]
+- 'Filter (((('s_store_sk = 'ss_store_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('d_year = 1998)) AND (((((('cd_demo_sk = 'ss_cdemo_sk) AND ('cd_marital_status = M)) AND (('cd_education_status = 4 yr Degree) AND (('ss_sales_price >= 100.00) AND ('ss_sales_price <= 150.00)))) OR ((('cd_demo_sk = 'ss_cdemo_sk) AND ('cd_marital_status = M)) AND (('cd_education_status = 4 yr Degree) AND (('ss_sales_price >= 50.00) AND ('ss_sales_price <= 100.00))))) OR ((('cd_demo_sk = 'ss_cdemo_sk) AND ('cd_marital_status = M)) AND (('cd_education_status = 4 yr Degree) AND (('ss_sales_price >= 150.00) AND ('ss_sales_price <= 200.00))))) AND ((((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (KY,GA,NM) AND (('ss_net_profit >= 0) AND ('ss_net_profit <= 2000)))) OR ((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (MT,OR,IN) AND (('ss_net_profit >= 150) AND ('ss_net_profit <= 3000))))) OR ((('ss_addr_sk = 'ca_address_sk) AND ('ca_country = United States)) AND ('ca_state IN (WI,MO,WV) AND (('ss_net_profit >= 50) AND ('ss_net_profit <= 25000)))))))
   +- 'Join Inner
      :- 'Join Inner
      :  :- 'Join Inner
      :  :  :- 'Join Inner
      :  :  :  :- 'UnresolvedRelation [store_sales], [], false
      :  :  :  +- 'UnresolvedRelation [store], [], false
      :  :  +- 'UnresolvedRelation [customer_demographics], [], false
      :  +- 'UnresolvedRelation [customer_address], [], false
      +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
sum(ss_quantity): bigint
Aggregate [sum(ss_quantity#14993) AS sum(ss_quantity)#15087L]
+- Filter ((((s_store_sk#15007L = ss_store_sk#14990L) AND (ss_sold_date_sk#15006L = d_date_sk#15058L)) AND (d_year#15064 = 1998)) AND ((((((cd_demo_sk#15036L = ss_cdemo_sk#14987L) AND (cd_marital_status#15038 = M)) AND ((cd_education_status#15039 = 4 yr Degree) AND ((ss_sales_price#14996 >= cast(100.00 as double)) AND (ss_sales_price#14996 <= cast(150.00 as double))))) OR (((cd_demo_sk#15036L = ss_cdemo_sk#14987L) AND (cd_marital_status#15038 = M)) AND ((cd_education_status#15039 = 4 yr Degree) AND ((ss_sales_price#14996 >= cast(50.00 as double)) AND (ss_sales_price#14996 <= cast(100.00 as double)))))) OR (((cd_demo_sk#15036L = ss_cdemo_sk#14987L) AND (cd_marital_status#15038 = M)) AND ((cd_education_status#15039 = 4 yr Degree) AND ((ss_sales_price#14996 >= cast(150.00 as double)) AND (ss_sales_price#14996 <= cast(200.00 as double)))))) AND (((((ss_addr_sk#14989L = ca_address_sk#15045L) AND (ca_country#15055 = United States)) AND (ca_state#15053 IN (KY,GA,NM) AND ((ss_net_profit#15005 >= cast(0 as double)) AND (ss_net_profit#15005 <= cast(2000 as double))))) OR (((ss_addr_sk#14989L = ca_address_sk#15045L) AND (ca_country#15055 = United States)) AND (ca_state#15053 IN (MT,OR,IN) AND ((ss_net_profit#15005 >= cast(150 as double)) AND (ss_net_profit#15005 <= cast(3000 as double)))))) OR (((ss_addr_sk#14989L = ca_address_sk#15045L) AND (ca_country#15055 = United States)) AND (ca_state#15053 IN (WI,MO,WV) AND ((ss_net_profit#15005 >= cast(50 as double)) AND (ss_net_profit#15005 <= cast(25000 as double))))))))
   +- Join Inner
      :- Join Inner
      :  :- Join Inner
      :  :  :- Join Inner
      :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
      :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14984L,ss_item_sk#14985L,ss_customer_sk#14986L,ss_cdemo_sk#14987L,ss_hdemo_sk#14988L,ss_addr_sk#14989L,ss_store_sk#14990L,ss_promo_sk#14991L,ss_ticket_number#14992L,ss_quantity#14993,ss_wholesale_cost#14994,ss_list_price#14995,ss_sales_price#14996,ss_ext_discount_amt#14997,ss_ext_sales_price#14998,ss_ext_wholesale_cost#14999,ss_ext_list_price#15000,ss_ext_tax#15001,ss_coupon_amt#15002,ss_net_paid#15003,ss_net_paid_inc_tax#15004,ss_net_profit#15005,ss_sold_date_sk#15006L] orc
      :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
      :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15007L,s_store_id#15008,s_rec_start_date#15009,s_rec_end_date#15010,s_closed_date_sk#15011L,s_store_name#15012,s_number_employees#15013,s_floor_space#15014,s_hours#15015,s_manager#15016,s_market_id#15017,s_geography_class#15018,s_market_desc#15019,s_market_manager#15020,s_division_id#15021,s_division_name#15022,s_company_id#15023,s_company_name#15024,s_street_number#15025,s_street_name#15026,s_street_type#15027,s_suite_number#15028,s_city#15029,s_county#15030,... 5 more fields] orc
      :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
      :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#15036L,cd_gender#15037,cd_marital_status#15038,cd_education_status#15039,cd_purchase_estimate#15040,cd_credit_rating#15041,cd_dep_count#15042,cd_dep_employed_count#15043,cd_dep_college_count#15044] orc
      :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
      :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#15045L,ca_address_id#15046,ca_street_number#15047,ca_street_name#15048,ca_street_type#15049,ca_suite_number#15050,ca_city#15051,ca_county#15052,ca_state#15053,ca_zip#15054,ca_country#15055,ca_gmt_offset#15056,ca_location_type#15057] orc
      +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15058L,d_date_id#15059,d_date#15060,d_month_seq#15061,d_week_seq#15062,d_quarter_seq#15063,d_year#15064,d_dow#15065,d_moy#15066,d_dom#15067,d_qoy#15068,d_fy_year#15069,d_fy_quarter_seq#15070,d_fy_week_seq#15071,d_day_name#15072,d_quarter_name#15073,d_holiday#15074,d_weekend#15075,d_following_holiday#15076,d_first_dom#15077,d_last_dom#15078,d_same_day_ly#15079,d_same_day_lq#15080,d_current_day#15081,... 4 more fields] orc

== Optimized Logical Plan ==
Aggregate [sum(ss_quantity#14993) AS sum(ss_quantity)#15087L]
+- Project [ss_quantity#14993]
   +- Join Inner, (s_store_sk#15007L = ss_store_sk#14990L)
      :- Project [ss_store_sk#14990L, ss_quantity#14993]
      :  +- Join Inner, (ss_sold_date_sk#15006L = d_date_sk#15058L)
      :     :- Project [ss_store_sk#14990L, ss_quantity#14993, ss_sold_date_sk#15006L]
      :     :  +- Join Inner, ((ss_addr_sk#14989L = ca_address_sk#15045L) AND ((((ca_state#15053 IN (KY,GA,NM) AND (ss_net_profit#15005 >= 0.0)) AND (ss_net_profit#15005 <= 2000.0)) OR ((ca_state#15053 IN (MT,OR,IN) AND (ss_net_profit#15005 >= 150.0)) AND (ss_net_profit#15005 <= 3000.0))) OR ((ca_state#15053 IN (WI,MO,WV) AND (ss_net_profit#15005 >= 50.0)) AND (ss_net_profit#15005 <= 25000.0))))
      :     :     :- Project [ss_addr_sk#14989L, ss_store_sk#14990L, ss_quantity#14993, ss_net_profit#15005, ss_sold_date_sk#15006L]
      :     :     :  +- Join Inner, (cd_demo_sk#15036L = ss_cdemo_sk#14987L)
      :     :     :     :- Project [ss_cdemo_sk#14987L, ss_addr_sk#14989L, ss_store_sk#14990L, ss_quantity#14993, ss_net_profit#15005, ss_sold_date_sk#15006L]
      :     :     :     :  +- Filter ((((((((((ss_sales_price#14996 >= 100.0) AND (ss_sales_price#14996 <= 150.0)) OR ((ss_sales_price#14996 >= 50.0) AND (ss_sales_price#14996 <= 100.0))) OR ((ss_sales_price#14996 >= 150.0) AND (ss_sales_price#14996 <= 200.0))) AND isnotnull(ss_store_sk#14990L)) AND isnotnull(ss_cdemo_sk#14987L)) AND isnotnull(ss_addr_sk#14989L)) AND isnotnull(ss_sold_date_sk#15006L)) AND ((((ss_net_profit#15005 >= 0.0) AND (ss_net_profit#15005 <= 2000.0)) OR ((ss_net_profit#15005 >= 150.0) AND (ss_net_profit#15005 <= 3000.0))) OR ((ss_net_profit#15005 >= 50.0) AND (ss_net_profit#15005 <= 25000.0)))) AND dynamicpruning#15089 [ss_sold_date_sk#15006L])
      :     :     :     :     :  +- Project [d_date_sk#15058L]
      :     :     :     :     :     +- Filter ((isnotnull(d_year#15064) AND (d_year#15064 = 1998)) AND isnotnull(d_date_sk#15058L))
      :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15058L,d_date_id#15059,d_date#15060,d_month_seq#15061,d_week_seq#15062,d_quarter_seq#15063,d_year#15064,d_dow#15065,d_moy#15066,d_dom#15067,d_qoy#15068,d_fy_year#15069,d_fy_quarter_seq#15070,d_fy_week_seq#15071,d_day_name#15072,d_quarter_name#15073,d_holiday#15074,d_weekend#15075,d_following_holiday#15076,d_first_dom#15077,d_last_dom#15078,d_same_day_ly#15079,d_same_day_lq#15080,d_current_day#15081,... 4 more fields] orc
      :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#14984L,ss_item_sk#14985L,ss_customer_sk#14986L,ss_cdemo_sk#14987L,ss_hdemo_sk#14988L,ss_addr_sk#14989L,ss_store_sk#14990L,ss_promo_sk#14991L,ss_ticket_number#14992L,ss_quantity#14993,ss_wholesale_cost#14994,ss_list_price#14995,ss_sales_price#14996,ss_ext_discount_amt#14997,ss_ext_sales_price#14998,ss_ext_wholesale_cost#14999,ss_ext_list_price#15000,ss_ext_tax#15001,ss_coupon_amt#15002,ss_net_paid#15003,ss_net_paid_inc_tax#15004,ss_net_profit#15005,ss_sold_date_sk#15006L] orc
      :     :     :     +- Project [cd_demo_sk#15036L]
      :     :     :        +- Filter (((isnotnull(cd_marital_status#15038) AND isnotnull(cd_education_status#15039)) AND ((cd_marital_status#15038 = M) AND (cd_education_status#15039 = 4 yr Degree))) AND isnotnull(cd_demo_sk#15036L))
      :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#15036L,cd_gender#15037,cd_marital_status#15038,cd_education_status#15039,cd_purchase_estimate#15040,cd_credit_rating#15041,cd_dep_count#15042,cd_dep_employed_count#15043,cd_dep_college_count#15044] orc
      :     :     +- Project [ca_address_sk#15045L, ca_state#15053]
      :     :        +- Filter (((isnotnull(ca_country#15055) AND (ca_country#15055 = United States)) AND isnotnull(ca_address_sk#15045L)) AND ((ca_state#15053 IN (KY,GA,NM) OR ca_state#15053 IN (MT,OR,IN)) OR ca_state#15053 IN (WI,MO,WV)))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#15045L,ca_address_id#15046,ca_street_number#15047,ca_street_name#15048,ca_street_type#15049,ca_suite_number#15050,ca_city#15051,ca_county#15052,ca_state#15053,ca_zip#15054,ca_country#15055,ca_gmt_offset#15056,ca_location_type#15057] orc
      :     +- Project [d_date_sk#15058L]
      :        +- Filter ((isnotnull(d_year#15064) AND (d_year#15064 = 1998)) AND isnotnull(d_date_sk#15058L))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15058L,d_date_id#15059,d_date#15060,d_month_seq#15061,d_week_seq#15062,d_quarter_seq#15063,d_year#15064,d_dow#15065,d_moy#15066,d_dom#15067,d_qoy#15068,d_fy_year#15069,d_fy_quarter_seq#15070,d_fy_week_seq#15071,d_day_name#15072,d_quarter_name#15073,d_holiday#15074,d_weekend#15075,d_following_holiday#15076,d_first_dom#15077,d_last_dom#15078,d_same_day_ly#15079,d_same_day_lq#15080,d_current_day#15081,... 4 more fields] orc
      +- Project [s_store_sk#15007L]
         +- Filter isnotnull(s_store_sk#15007L)
            +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15007L,s_store_id#15008,s_rec_start_date#15009,s_rec_end_date#15010,s_closed_date_sk#15011L,s_store_name#15012,s_number_employees#15013,s_floor_space#15014,s_hours#15015,s_manager#15016,s_market_id#15017,s_geography_class#15018,s_market_desc#15019,s_market_manager#15020,s_division_id#15021,s_division_name#15022,s_company_id#15023,s_company_name#15024,s_street_number#15025,s_street_name#15026,s_street_type#15027,s_suite_number#15028,s_city#15029,s_county#15030,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(ss_quantity#14993)], output=[sum(ss_quantity)#15087L])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#15833]
      +- HashAggregate(keys=[], functions=[partial_sum(ss_quantity#14993)], output=[sum#15091L])
         +- Project [ss_quantity#14993]
            +- BroadcastHashJoin [ss_store_sk#14990L], [s_store_sk#15007L], Inner, BuildRight, false
               :- Project [ss_store_sk#14990L, ss_quantity#14993]
               :  +- BroadcastHashJoin [ss_sold_date_sk#15006L], [d_date_sk#15058L], Inner, BuildRight, false
               :     :- Project [ss_store_sk#14990L, ss_quantity#14993, ss_sold_date_sk#15006L]
               :     :  +- SortMergeJoin [ss_addr_sk#14989L], [ca_address_sk#15045L], Inner, ((((ca_state#15053 IN (KY,GA,NM) AND (ss_net_profit#15005 >= 0.0)) AND (ss_net_profit#15005 <= 2000.0)) OR ((ca_state#15053 IN (MT,OR,IN) AND (ss_net_profit#15005 >= 150.0)) AND (ss_net_profit#15005 <= 3000.0))) OR ((ca_state#15053 IN (WI,MO,WV) AND (ss_net_profit#15005 >= 50.0)) AND (ss_net_profit#15005 <= 25000.0)))
               :     :     :- Sort [ss_addr_sk#14989L ASC NULLS FIRST], false, 0
               :     :     :  +- Exchange hashpartitioning(ss_addr_sk#14989L, 3000), ENSURE_REQUIREMENTS, [id=#15817]
               :     :     :     +- Project [ss_addr_sk#14989L, ss_store_sk#14990L, ss_quantity#14993, ss_net_profit#15005, ss_sold_date_sk#15006L]
               :     :     :        +- BroadcastHashJoin [ss_cdemo_sk#14987L], [cd_demo_sk#15036L], Inner, BuildRight, false
               :     :     :           :- Project [ss_cdemo_sk#14987L, ss_addr_sk#14989L, ss_store_sk#14990L, ss_quantity#14993, ss_net_profit#15005, ss_sold_date_sk#15006L]
               :     :     :           :  +- Filter ((((((((ss_sales_price#14996 >= 100.0) AND (ss_sales_price#14996 <= 150.0)) OR ((ss_sales_price#14996 >= 50.0) AND (ss_sales_price#14996 <= 100.0))) OR ((ss_sales_price#14996 >= 150.0) AND (ss_sales_price#14996 <= 200.0))) AND isnotnull(ss_store_sk#14990L)) AND isnotnull(ss_cdemo_sk#14987L)) AND isnotnull(ss_addr_sk#14989L)) AND ((((ss_net_profit#15005 >= 0.0) AND (ss_net_profit#15005 <= 2000.0)) OR ((ss_net_profit#15005 >= 150.0) AND (ss_net_profit#15005 <= 3000.0))) OR ((ss_net_profit#15005 >= 50.0) AND (ss_net_profit#15005 <= 25000.0))))
               :     :     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_cdemo_sk#14987L,ss_addr_sk#14989L,ss_store_sk#14990L,ss_quantity#14993,ss_sales_price#14996,ss_net_profit#15005,ss_sold_date_sk#15006L] Batched: true, DataFilters: [((((ss_sales_price#14996 >= 100.0) AND (ss_sales_price#14996 <= 150.0)) OR ((ss_sales_price#1499..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15006L), dynamicpruningexpression(ss_sold_date_sk#15006L IN dynamicpru..., PushedFilters: [Or(Or(And(GreaterThanOrEqual(ss_sales_price,100.0),LessThanOrEqual(ss_sales_price,150.0)),And(Gr..., ReadSchema: struct<ss_cdemo_sk:bigint,ss_addr_sk:bigint,ss_store_sk:bigint,ss_quantity:int,ss_sales_price:dou...
               :     :     :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#15089, 0, true, Project [d_date_sk#15058L], [d_date_sk#15058L]
               :     :     :           :              +- AdaptiveSparkPlan isFinalPlan=false
               :     :     :           :                 +- Project [d_date_sk#15058L]
               :     :     :           :                    +- Filter ((isnotnull(d_year#15064) AND (d_year#15064 = 1998)) AND isnotnull(d_date_sk#15058L))
               :     :     :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15058L,d_year#15064] Batched: true, DataFilters: [isnotnull(d_year#15064), (d_year#15064 = 1998), isnotnull(d_date_sk#15058L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
               :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15812]
               :     :     :              +- Project [cd_demo_sk#15036L]
               :     :     :                 +- Filter ((((isnotnull(cd_marital_status#15038) AND isnotnull(cd_education_status#15039)) AND (cd_marital_status#15038 = M)) AND (cd_education_status#15039 = 4 yr Degree)) AND isnotnull(cd_demo_sk#15036L))
               :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#15036L,cd_marital_status#15038,cd_education_status#15039] Batched: true, DataFilters: [isnotnull(cd_marital_status#15038), isnotnull(cd_education_status#15039), (cd_marital_status#150..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_marital_status), IsNotNull(cd_education_status), EqualTo(cd_marital_status,M), Equa..., ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string,cd_education_status:string>
               :     :     +- Sort [ca_address_sk#15045L ASC NULLS FIRST], false, 0
               :     :        +- Exchange hashpartitioning(ca_address_sk#15045L, 3000), ENSURE_REQUIREMENTS, [id=#15818]
               :     :           +- Project [ca_address_sk#15045L, ca_state#15053]
               :     :              +- Filter (((isnotnull(ca_country#15055) AND (ca_country#15055 = United States)) AND isnotnull(ca_address_sk#15045L)) AND ((ca_state#15053 IN (KY,GA,NM) OR ca_state#15053 IN (MT,OR,IN)) OR ca_state#15053 IN (WI,MO,WV)))
               :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#15045L,ca_state#15053,ca_country#15055] Batched: true, DataFilters: [isnotnull(ca_country#15055), (ca_country#15055 = United States), isnotnull(ca_address_sk#15045L)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk), Or(Or(In(ca_..., ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_country:string>
               :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#15824]
               :        +- Project [d_date_sk#15058L]
               :           +- Filter ((isnotnull(d_year#15064) AND (d_year#15064 = 1998)) AND isnotnull(d_date_sk#15058L))
               :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15058L,d_year#15064] Batched: true, DataFilters: [isnotnull(d_year#15064), (d_year#15064 = 1998), isnotnull(d_date_sk#15058L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#15828]
                  +- Filter isnotnull(s_store_sk#15007L)
                     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15007L] Batched: true, DataFilters: [isnotnull(s_store_sk#15007L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>

read query: spark_queries/q49.sql
explain query: q49
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort [1 ASC NULLS FIRST, 4 ASC NULLS FIRST, 5 ASC NULLS FIRST], true
      +- 'Distinct
         +- 'Union false, false
            :- 'Distinct
            :  +- 'Union false, false
            :     :- 'Project [web AS channel#15097, 'web.item, 'web.return_ratio, 'web.return_rank, 'web.currency_rank]
            :     :  +- 'Filter (('web.return_rank <= 10) OR ('web.currency_rank <= 10))
            :     :     +- 'SubqueryAlias web
            :     :        +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#15095, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#15096]
            :     :           +- 'SubqueryAlias in_web
            :     :              +- 'Aggregate ['ws.ws_item_sk], ['ws.ws_item_sk AS item#15092, (cast('sum('coalesce('wr.wr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('ws.ws_quantity, 0)) as decimal(15,4))) AS return_ratio#15093, (cast('sum('coalesce('wr.wr_return_amt, 0)) as decimal(15,4)) / cast('sum('coalesce('ws.ws_net_paid, 0)) as decimal(15,4))) AS currency_ratio#15094]
            :     :                 +- 'Filter (((('wr.wr_return_amt > 10000) AND ('ws.ws_net_profit > 1)) AND (('ws.ws_net_paid > 0) AND ('ws.ws_quantity > 0))) AND ((('ws_sold_date_sk = 'd_date_sk) AND ('d_year = 2000)) AND ('d_moy = 12)))
            :     :                    +- 'Join Inner
            :     :                       :- 'Join LeftOuter, (('ws.ws_order_number = 'wr.wr_order_number) AND ('ws.ws_item_sk = 'wr.wr_item_sk))
            :     :                       :  :- 'SubqueryAlias ws
            :     :                       :  :  +- 'UnresolvedRelation [web_sales], [], false
            :     :                       :  +- 'SubqueryAlias wr
            :     :                       :     +- 'UnresolvedRelation [web_returns], [], false
            :     :                       +- 'UnresolvedRelation [date_dim], [], false
            :     +- 'Project [catalog AS channel#15103, 'catalog.item, 'catalog.return_ratio, 'catalog.return_rank, 'catalog.currency_rank]
            :        +- 'Filter (('catalog.return_rank <= 10) OR ('catalog.currency_rank <= 10))
            :           +- 'SubqueryAlias catalog
            :              +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#15101, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#15102]
            :                 +- 'SubqueryAlias in_cat
            :                    +- 'Aggregate ['cs.cs_item_sk], ['cs.cs_item_sk AS item#15098, (cast('sum('coalesce('cr.cr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('cs.cs_quantity, 0)) as decimal(15,4))) AS return_ratio#15099, (cast('sum('coalesce('cr.cr_return_amount, 0)) as decimal(15,4)) / cast('sum('coalesce('cs.cs_net_paid, 0)) as decimal(15,4))) AS currency_ratio#15100]
            :                       +- 'Filter (((('cr.cr_return_amount > 10000) AND ('cs.cs_net_profit > 1)) AND (('cs.cs_net_paid > 0) AND ('cs.cs_quantity > 0))) AND ((('cs_sold_date_sk = 'd_date_sk) AND ('d_year = 2000)) AND ('d_moy = 12)))
            :                          +- 'Join Inner
            :                             :- 'Join LeftOuter, (('cs.cs_order_number = 'cr.cr_order_number) AND ('cs.cs_item_sk = 'cr.cr_item_sk))
            :                             :  :- 'SubqueryAlias cs
            :                             :  :  +- 'UnresolvedRelation [catalog_sales], [], false
            :                             :  +- 'SubqueryAlias cr
            :                             :     +- 'UnresolvedRelation [catalog_returns], [], false
            :                             +- 'UnresolvedRelation [date_dim], [], false
            +- 'Project [store AS channel#15109, 'store.item, 'store.return_ratio, 'store.return_rank, 'store.currency_rank]
               +- 'Filter (('store.return_rank <= 10) OR ('store.currency_rank <= 10))
                  +- 'SubqueryAlias store
                     +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#15107, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#15108]
                        +- 'SubqueryAlias in_store
                           +- 'Aggregate ['sts.ss_item_sk], ['sts.ss_item_sk AS item#15104, (cast('sum('coalesce('sr.sr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('sts.ss_quantity, 0)) as decimal(15,4))) AS return_ratio#15105, (cast('sum('coalesce('sr.sr_return_amt, 0)) as decimal(15,4)) / cast('sum('coalesce('sts.ss_net_paid, 0)) as decimal(15,4))) AS currency_ratio#15106]
                              +- 'Filter (((('sr.sr_return_amt > 10000) AND ('sts.ss_net_profit > 1)) AND (('sts.ss_net_paid > 0) AND ('sts.ss_quantity > 0))) AND ((('ss_sold_date_sk = 'd_date_sk) AND ('d_year = 2000)) AND ('d_moy = 12)))
                                 +- 'Join Inner
                                    :- 'Join LeftOuter, (('sts.ss_ticket_number = 'sr.sr_ticket_number) AND ('sts.ss_item_sk = 'sr.sr_item_sk))
                                    :  :- 'SubqueryAlias sts
                                    :  :  +- 'UnresolvedRelation [store_sales], [], false
                                    :  +- 'SubqueryAlias sr
                                    :     +- 'UnresolvedRelation [store_returns], [], false
                                    +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
channel: string, item: bigint, return_ratio: decimal(35,20), return_rank: int, currency_rank: int
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#15097 ASC NULLS FIRST, return_rank#15095 ASC NULLS FIRST, currency_rank#15096 ASC NULLS FIRST], true
      +- Distinct
         +- Union false, false
            :- Distinct
            :  +- Union false, false
            :     :- Project [web AS channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096]
            :     :  +- Filter ((return_rank#15095 <= 10) OR (currency_rank#15096 <= 10))
            :     :     +- SubqueryAlias web
            :     :        +- Project [item#15092L, return_ratio#15093, currency_ratio#15094, return_rank#15095, currency_rank#15096]
            :     :           +- Project [item#15092L, return_ratio#15093, currency_ratio#15094, return_rank#15095, currency_rank#15096, return_rank#15095, currency_rank#15096]
            :     :              +- Window [rank(currency_ratio#15094) windowspecdefinition(currency_ratio#15094 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15096], [currency_ratio#15094 ASC NULLS FIRST]
            :     :                 +- Window [rank(return_ratio#15093) windowspecdefinition(return_ratio#15093 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15095], [return_ratio#15093 ASC NULLS FIRST]
            :     :                    +- Project [item#15092L, return_ratio#15093, currency_ratio#15094]
            :     :                       +- SubqueryAlias in_web
            :     :                          +- Aggregate [ws_item_sk#15124L], [ws_item_sk#15124L AS item#15092L, CheckOverflow((promote_precision(cast(cast(sum(coalesce(wr_return_quantity#15169, 0)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(ws_quantity#15139, 0)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15093, CheckOverflow((promote_precision(cast(cast(sum(coalesce(wr_return_amt#15170, cast(0 as double))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(ws_net_paid#15150, cast(0 as double))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15094]
            :     :                             +- Filter ((((wr_return_amt#15170 > cast(10000 as double)) AND (ws_net_profit#15154 > cast(1 as double))) AND ((ws_net_paid#15150 > cast(0 as double)) AND (ws_quantity#15139 > 0))) AND (((ws_sold_date_sk#15155L = d_date_sk#15180L) AND (d_year#15186 = 2000)) AND (d_moy#15188 = 12)))
            :     :                                +- Join Inner
            :     :                                   :- Join LeftOuter, ((ws_order_number#15138L = wr_order_number#15168L) AND (ws_item_sk#15124L = wr_item_sk#15157L))
            :     :                                   :  :- SubqueryAlias ws
            :     :                                   :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :     :                                   :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#15122L,ws_ship_date_sk#15123L,ws_item_sk#15124L,ws_bill_customer_sk#15125L,ws_bill_cdemo_sk#15126L,ws_bill_hdemo_sk#15127L,ws_bill_addr_sk#15128L,ws_ship_customer_sk#15129L,ws_ship_cdemo_sk#15130L,ws_ship_hdemo_sk#15131L,ws_ship_addr_sk#15132L,ws_web_page_sk#15133L,ws_web_site_sk#15134L,ws_ship_mode_sk#15135L,ws_warehouse_sk#15136L,ws_promo_sk#15137L,ws_order_number#15138L,ws_quantity#15139,ws_wholesale_cost#15140,ws_list_price#15141,ws_sales_price#15142,ws_ext_discount_amt#15143,ws_ext_sales_price#15144,ws_ext_wholesale_cost#15145,... 10 more fields] orc
            :     :                                   :  +- SubqueryAlias wr
            :     :                                   :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
            :     :                                   :        +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#15156L,wr_item_sk#15157L,wr_refunded_customer_sk#15158L,wr_refunded_cdemo_sk#15159L,wr_refunded_hdemo_sk#15160L,wr_refunded_addr_sk#15161L,wr_returning_customer_sk#15162L,wr_returning_cdemo_sk#15163L,wr_returning_hdemo_sk#15164L,wr_returning_addr_sk#15165L,wr_web_page_sk#15166L,wr_reason_sk#15167L,wr_order_number#15168L,wr_return_quantity#15169,wr_return_amt#15170,wr_return_tax#15171,wr_return_amt_inc_tax#15172,wr_fee#15173,wr_return_ship_cost#15174,wr_refunded_cash#15175,wr_reversed_charge#15176,wr_account_credit#15177,wr_net_loss#15178,wr_returned_date_sk#15179L] orc
            :     :                                   +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :     :                                      +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15180L,d_date_id#15181,d_date#15182,d_month_seq#15183,d_week_seq#15184,d_quarter_seq#15185,d_year#15186,d_dow#15187,d_moy#15188,d_dom#15189,d_qoy#15190,d_fy_year#15191,d_fy_quarter_seq#15192,d_fy_week_seq#15193,d_day_name#15194,d_quarter_name#15195,d_holiday#15196,d_weekend#15197,d_following_holiday#15198,d_first_dom#15199,d_last_dom#15200,d_same_day_ly#15201,d_same_day_lq#15202,d_current_day#15203,... 4 more fields] orc
            :     +- Project [catalog AS channel#15103, item#15098L, return_ratio#15099, return_rank#15101, currency_rank#15102]
            :        +- Filter ((return_rank#15101 <= 10) OR (currency_rank#15102 <= 10))
            :           +- SubqueryAlias catalog
            :              +- Project [item#15098L, return_ratio#15099, currency_ratio#15100, return_rank#15101, currency_rank#15102]
            :                 +- Project [item#15098L, return_ratio#15099, currency_ratio#15100, return_rank#15101, currency_rank#15102, return_rank#15101, currency_rank#15102]
            :                    +- Window [rank(currency_ratio#15100) windowspecdefinition(currency_ratio#15100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15102], [currency_ratio#15100 ASC NULLS FIRST]
            :                       +- Window [rank(return_ratio#15099) windowspecdefinition(return_ratio#15099 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15101], [return_ratio#15099 ASC NULLS FIRST]
            :                          +- Project [item#15098L, return_ratio#15099, currency_ratio#15100]
            :                             +- SubqueryAlias in_cat
            :                                +- Aggregate [cs_item_sk#15222L], [cs_item_sk#15222L AS item#15098L, CheckOverflow((promote_precision(cast(cast(sum(coalesce(cr_return_quantity#15258, 0)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(cs_quantity#15225, 0)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15099, CheckOverflow((promote_precision(cast(cast(sum(coalesce(cr_return_amount#15259, cast(0 as double))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(cs_net_paid#15236, cast(0 as double))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15100]
            :                                   +- Filter ((((cr_return_amount#15259 > cast(10000 as double)) AND (cs_net_profit#15240 > cast(1 as double))) AND ((cs_net_paid#15236 > cast(0 as double)) AND (cs_quantity#15225 > 0))) AND (((cs_sold_date_sk#15241L = d_date_sk#15269L) AND (d_year#15275 = 2000)) AND (d_moy#15277 = 12)))
            :                                      +- Join Inner
            :                                         :- Join LeftOuter, ((cs_order_number#15224L = cr_order_number#15257L) AND (cs_item_sk#15222L = cr_item_sk#15243L))
            :                                         :  :- SubqueryAlias cs
            :                                         :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :                                         :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#15208L,cs_ship_date_sk#15209L,cs_bill_customer_sk#15210L,cs_bill_cdemo_sk#15211L,cs_bill_hdemo_sk#15212L,cs_bill_addr_sk#15213L,cs_ship_customer_sk#15214L,cs_ship_cdemo_sk#15215L,cs_ship_hdemo_sk#15216L,cs_ship_addr_sk#15217L,cs_call_center_sk#15218L,cs_catalog_page_sk#15219L,cs_ship_mode_sk#15220L,cs_warehouse_sk#15221L,cs_item_sk#15222L,cs_promo_sk#15223L,cs_order_number#15224L,cs_quantity#15225,cs_wholesale_cost#15226,cs_list_price#15227,cs_sales_price#15228,cs_ext_discount_amt#15229,cs_ext_sales_price#15230,cs_ext_wholesale_cost#15231,... 10 more fields] orc
            :                                         :  +- SubqueryAlias cr
            :                                         :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
            :                                         :        +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#15242L,cr_item_sk#15243L,cr_refunded_customer_sk#15244L,cr_refunded_cdemo_sk#15245L,cr_refunded_hdemo_sk#15246L,cr_refunded_addr_sk#15247L,cr_returning_customer_sk#15248L,cr_returning_cdemo_sk#15249L,cr_returning_hdemo_sk#15250L,cr_returning_addr_sk#15251L,cr_call_center_sk#15252L,cr_catalog_page_sk#15253L,cr_ship_mode_sk#15254L,cr_warehouse_sk#15255L,cr_reason_sk#15256L,cr_order_number#15257L,cr_return_quantity#15258,cr_return_amount#15259,cr_return_tax#15260,cr_return_amt_inc_tax#15261,cr_fee#15262,cr_return_ship_cost#15263,cr_refunded_cash#15264,cr_reversed_charge#15265,... 3 more fields] orc
            :                                         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :                                            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15269L,d_date_id#15270,d_date#15271,d_month_seq#15272,d_week_seq#15273,d_quarter_seq#15274,d_year#15275,d_dow#15276,d_moy#15277,d_dom#15278,d_qoy#15279,d_fy_year#15280,d_fy_quarter_seq#15281,d_fy_week_seq#15282,d_day_name#15283,d_quarter_name#15284,d_holiday#15285,d_weekend#15286,d_following_holiday#15287,d_first_dom#15288,d_last_dom#15289,d_same_day_ly#15290,d_same_day_lq#15291,d_current_day#15292,... 4 more fields] orc
            +- Project [store AS channel#15109, item#15104L, return_ratio#15105, return_rank#15107, currency_rank#15108]
               +- Filter ((return_rank#15107 <= 10) OR (currency_rank#15108 <= 10))
                  +- SubqueryAlias store
                     +- Project [item#15104L, return_ratio#15105, currency_ratio#15106, return_rank#15107, currency_rank#15108]
                        +- Project [item#15104L, return_ratio#15105, currency_ratio#15106, return_rank#15107, currency_rank#15108, return_rank#15107, currency_rank#15108]
                           +- Window [rank(currency_ratio#15106) windowspecdefinition(currency_ratio#15106 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15108], [currency_ratio#15106 ASC NULLS FIRST]
                              +- Window [rank(return_ratio#15105) windowspecdefinition(return_ratio#15105 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15107], [return_ratio#15105 ASC NULLS FIRST]
                                 +- Project [item#15104L, return_ratio#15105, currency_ratio#15106]
                                    +- SubqueryAlias in_store
                                       +- Aggregate [ss_item_sk#15298L], [ss_item_sk#15298L AS item#15104L, CheckOverflow((promote_precision(cast(cast(sum(coalesce(sr_return_quantity#15329, 0)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(ss_quantity#15306, 0)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15105, CheckOverflow((promote_precision(cast(cast(sum(coalesce(sr_return_amt#15330, cast(0 as double))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(ss_net_paid#15316, cast(0 as double))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15106]
                                          +- Filter ((((sr_return_amt#15330 > cast(10000 as double)) AND (ss_net_profit#15318 > cast(1 as double))) AND ((ss_net_paid#15316 > cast(0 as double)) AND (ss_quantity#15306 > 0))) AND (((ss_sold_date_sk#15319L = d_date_sk#15340L) AND (d_year#15346 = 2000)) AND (d_moy#15348 = 12)))
                                             +- Join Inner
                                                :- Join LeftOuter, ((ss_ticket_number#15305L = sr_ticket_number#15328L) AND (ss_item_sk#15298L = sr_item_sk#15321L))
                                                :  :- SubqueryAlias sts
                                                :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                                :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15297L,ss_item_sk#15298L,ss_customer_sk#15299L,ss_cdemo_sk#15300L,ss_hdemo_sk#15301L,ss_addr_sk#15302L,ss_store_sk#15303L,ss_promo_sk#15304L,ss_ticket_number#15305L,ss_quantity#15306,ss_wholesale_cost#15307,ss_list_price#15308,ss_sales_price#15309,ss_ext_discount_amt#15310,ss_ext_sales_price#15311,ss_ext_wholesale_cost#15312,ss_ext_list_price#15313,ss_ext_tax#15314,ss_coupon_amt#15315,ss_net_paid#15316,ss_net_paid_inc_tax#15317,ss_net_profit#15318,ss_sold_date_sk#15319L] orc
                                                :  +- SubqueryAlias sr
                                                :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
                                                :        +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#15320L,sr_item_sk#15321L,sr_customer_sk#15322L,sr_cdemo_sk#15323L,sr_hdemo_sk#15324L,sr_addr_sk#15325L,sr_store_sk#15326L,sr_reason_sk#15327L,sr_ticket_number#15328L,sr_return_quantity#15329,sr_return_amt#15330,sr_return_tax#15331,sr_return_amt_inc_tax#15332,sr_fee#15333,sr_return_ship_cost#15334,sr_refunded_cash#15335,sr_reversed_charge#15336,sr_store_credit#15337,sr_net_loss#15338,sr_returned_date_sk#15339L] orc
                                                +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                                   +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15340L,d_date_id#15341,d_date#15342,d_month_seq#15343,d_week_seq#15344,d_quarter_seq#15345,d_year#15346,d_dow#15347,d_moy#15348,d_dom#15349,d_qoy#15350,d_fy_year#15351,d_fy_quarter_seq#15352,d_fy_week_seq#15353,d_day_name#15354,d_quarter_name#15355,d_holiday#15356,d_weekend#15357,d_following_holiday#15358,d_first_dom#15359,d_last_dom#15360,d_same_day_ly#15361,d_same_day_lq#15362,d_current_day#15363,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#15097 ASC NULLS FIRST, return_rank#15095 ASC NULLS FIRST, currency_rank#15096 ASC NULLS FIRST], true
      +- Aggregate [channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096], [channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096]
         +- Union false, false
            :- Project [web AS channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096]
            :  +- Filter ((return_rank#15095 <= 10) OR (currency_rank#15096 <= 10))
            :     +- Window [rank(currency_ratio#15094) windowspecdefinition(currency_ratio#15094 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15096], [currency_ratio#15094 ASC NULLS FIRST]
            :        +- Window [rank(return_ratio#15093) windowspecdefinition(return_ratio#15093 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15095], [return_ratio#15093 ASC NULLS FIRST]
            :           +- Aggregate [ws_item_sk#15124L], [ws_item_sk#15124L AS item#15092L, CheckOverflow((promote_precision(cast(sum(coalesce(wr_return_quantity#15169, 0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(ws_quantity#15139, 0)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15093, CheckOverflow((promote_precision(cast(sum(coalesce(wr_return_amt#15170, 0.0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(ws_net_paid#15150, 0.0)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15094]
            :              +- Project [ws_item_sk#15124L, ws_quantity#15139, ws_net_paid#15150, wr_return_quantity#15169, wr_return_amt#15170]
            :                 +- Join Inner, ((ws_order_number#15138L = wr_order_number#15168L) AND (ws_item_sk#15124L = wr_item_sk#15157L))
            :                    :- Project [ws_item_sk#15124L, ws_order_number#15138L, ws_quantity#15139, ws_net_paid#15150]
            :                    :  +- Join Inner, (ws_sold_date_sk#15155L = d_date_sk#15180L)
            :                    :     :- Project [ws_item_sk#15124L, ws_order_number#15138L, ws_quantity#15139, ws_net_paid#15150, ws_sold_date_sk#15155L]
            :                    :     :  +- Filter (((((((((isnotnull(ws_net_profit#15154) AND isnotnull(ws_net_paid#15150)) AND isnotnull(ws_quantity#15139)) AND (ws_net_profit#15154 > 1.0)) AND (ws_net_paid#15150 > 0.0)) AND (ws_quantity#15139 > 0)) AND isnotnull(ws_order_number#15138L)) AND isnotnull(ws_item_sk#15124L)) AND isnotnull(ws_sold_date_sk#15155L)) AND dynamicpruning#15457 [ws_sold_date_sk#15155L])
            :                    :     :     :  +- Project [d_date_sk#15180L]
            :                    :     :     :     +- Filter (((isnotnull(d_year#15186) AND isnotnull(d_moy#15188)) AND ((d_year#15186 = 2000) AND (d_moy#15188 = 12))) AND isnotnull(d_date_sk#15180L))
            :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15180L,d_date_id#15181,d_date#15182,d_month_seq#15183,d_week_seq#15184,d_quarter_seq#15185,d_year#15186,d_dow#15187,d_moy#15188,d_dom#15189,d_qoy#15190,d_fy_year#15191,d_fy_quarter_seq#15192,d_fy_week_seq#15193,d_day_name#15194,d_quarter_name#15195,d_holiday#15196,d_weekend#15197,d_following_holiday#15198,d_first_dom#15199,d_last_dom#15200,d_same_day_ly#15201,d_same_day_lq#15202,d_current_day#15203,... 4 more fields] orc
            :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#15122L,ws_ship_date_sk#15123L,ws_item_sk#15124L,ws_bill_customer_sk#15125L,ws_bill_cdemo_sk#15126L,ws_bill_hdemo_sk#15127L,ws_bill_addr_sk#15128L,ws_ship_customer_sk#15129L,ws_ship_cdemo_sk#15130L,ws_ship_hdemo_sk#15131L,ws_ship_addr_sk#15132L,ws_web_page_sk#15133L,ws_web_site_sk#15134L,ws_ship_mode_sk#15135L,ws_warehouse_sk#15136L,ws_promo_sk#15137L,ws_order_number#15138L,ws_quantity#15139,ws_wholesale_cost#15140,ws_list_price#15141,ws_sales_price#15142,ws_ext_discount_amt#15143,ws_ext_sales_price#15144,ws_ext_wholesale_cost#15145,... 10 more fields] orc
            :                    :     +- Project [d_date_sk#15180L]
            :                    :        +- Filter (((isnotnull(d_year#15186) AND isnotnull(d_moy#15188)) AND ((d_year#15186 = 2000) AND (d_moy#15188 = 12))) AND isnotnull(d_date_sk#15180L))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15180L,d_date_id#15181,d_date#15182,d_month_seq#15183,d_week_seq#15184,d_quarter_seq#15185,d_year#15186,d_dow#15187,d_moy#15188,d_dom#15189,d_qoy#15190,d_fy_year#15191,d_fy_quarter_seq#15192,d_fy_week_seq#15193,d_day_name#15194,d_quarter_name#15195,d_holiday#15196,d_weekend#15197,d_following_holiday#15198,d_first_dom#15199,d_last_dom#15200,d_same_day_ly#15201,d_same_day_lq#15202,d_current_day#15203,... 4 more fields] orc
            :                    +- Project [wr_item_sk#15157L, wr_order_number#15168L, wr_return_quantity#15169, wr_return_amt#15170]
            :                       +- Filter ((isnotnull(wr_return_amt#15170) AND (wr_return_amt#15170 > 10000.0)) AND (isnotnull(wr_order_number#15168L) AND isnotnull(wr_item_sk#15157L)))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#15156L,wr_item_sk#15157L,wr_refunded_customer_sk#15158L,wr_refunded_cdemo_sk#15159L,wr_refunded_hdemo_sk#15160L,wr_refunded_addr_sk#15161L,wr_returning_customer_sk#15162L,wr_returning_cdemo_sk#15163L,wr_returning_hdemo_sk#15164L,wr_returning_addr_sk#15165L,wr_web_page_sk#15166L,wr_reason_sk#15167L,wr_order_number#15168L,wr_return_quantity#15169,wr_return_amt#15170,wr_return_tax#15171,wr_return_amt_inc_tax#15172,wr_fee#15173,wr_return_ship_cost#15174,wr_refunded_cash#15175,wr_reversed_charge#15176,wr_account_credit#15177,wr_net_loss#15178,wr_returned_date_sk#15179L] orc
            :- Project [catalog AS channel#15103, item#15098L, return_ratio#15099, return_rank#15101, currency_rank#15102]
            :  +- Filter ((return_rank#15101 <= 10) OR (currency_rank#15102 <= 10))
            :     +- Window [rank(currency_ratio#15100) windowspecdefinition(currency_ratio#15100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15102], [currency_ratio#15100 ASC NULLS FIRST]
            :        +- Window [rank(return_ratio#15099) windowspecdefinition(return_ratio#15099 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15101], [return_ratio#15099 ASC NULLS FIRST]
            :           +- Aggregate [cs_item_sk#15222L], [cs_item_sk#15222L AS item#15098L, CheckOverflow((promote_precision(cast(sum(coalesce(cr_return_quantity#15258, 0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(cs_quantity#15225, 0)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15099, CheckOverflow((promote_precision(cast(sum(coalesce(cr_return_amount#15259, 0.0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(cs_net_paid#15236, 0.0)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15100]
            :              +- Project [cs_item_sk#15222L, cs_quantity#15225, cs_net_paid#15236, cr_return_quantity#15258, cr_return_amount#15259]
            :                 +- Join Inner, ((cs_order_number#15224L = cr_order_number#15257L) AND (cs_item_sk#15222L = cr_item_sk#15243L))
            :                    :- Project [cs_item_sk#15222L, cs_order_number#15224L, cs_quantity#15225, cs_net_paid#15236]
            :                    :  +- Join Inner, (cs_sold_date_sk#15241L = d_date_sk#15269L)
            :                    :     :- Project [cs_item_sk#15222L, cs_order_number#15224L, cs_quantity#15225, cs_net_paid#15236, cs_sold_date_sk#15241L]
            :                    :     :  +- Filter (((((((((isnotnull(cs_net_profit#15240) AND isnotnull(cs_net_paid#15236)) AND isnotnull(cs_quantity#15225)) AND (cs_net_profit#15240 > 1.0)) AND (cs_net_paid#15236 > 0.0)) AND (cs_quantity#15225 > 0)) AND isnotnull(cs_order_number#15224L)) AND isnotnull(cs_item_sk#15222L)) AND isnotnull(cs_sold_date_sk#15241L)) AND dynamicpruning#15458 [cs_sold_date_sk#15241L])
            :                    :     :     :  +- Project [d_date_sk#15269L]
            :                    :     :     :     +- Filter (((isnotnull(d_year#15275) AND isnotnull(d_moy#15277)) AND ((d_year#15275 = 2000) AND (d_moy#15277 = 12))) AND isnotnull(d_date_sk#15269L))
            :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15269L,d_date_id#15270,d_date#15271,d_month_seq#15272,d_week_seq#15273,d_quarter_seq#15274,d_year#15275,d_dow#15276,d_moy#15277,d_dom#15278,d_qoy#15279,d_fy_year#15280,d_fy_quarter_seq#15281,d_fy_week_seq#15282,d_day_name#15283,d_quarter_name#15284,d_holiday#15285,d_weekend#15286,d_following_holiday#15287,d_first_dom#15288,d_last_dom#15289,d_same_day_ly#15290,d_same_day_lq#15291,d_current_day#15292,... 4 more fields] orc
            :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#15208L,cs_ship_date_sk#15209L,cs_bill_customer_sk#15210L,cs_bill_cdemo_sk#15211L,cs_bill_hdemo_sk#15212L,cs_bill_addr_sk#15213L,cs_ship_customer_sk#15214L,cs_ship_cdemo_sk#15215L,cs_ship_hdemo_sk#15216L,cs_ship_addr_sk#15217L,cs_call_center_sk#15218L,cs_catalog_page_sk#15219L,cs_ship_mode_sk#15220L,cs_warehouse_sk#15221L,cs_item_sk#15222L,cs_promo_sk#15223L,cs_order_number#15224L,cs_quantity#15225,cs_wholesale_cost#15226,cs_list_price#15227,cs_sales_price#15228,cs_ext_discount_amt#15229,cs_ext_sales_price#15230,cs_ext_wholesale_cost#15231,... 10 more fields] orc
            :                    :     +- Project [d_date_sk#15269L]
            :                    :        +- Filter (((isnotnull(d_year#15275) AND isnotnull(d_moy#15277)) AND ((d_year#15275 = 2000) AND (d_moy#15277 = 12))) AND isnotnull(d_date_sk#15269L))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15269L,d_date_id#15270,d_date#15271,d_month_seq#15272,d_week_seq#15273,d_quarter_seq#15274,d_year#15275,d_dow#15276,d_moy#15277,d_dom#15278,d_qoy#15279,d_fy_year#15280,d_fy_quarter_seq#15281,d_fy_week_seq#15282,d_day_name#15283,d_quarter_name#15284,d_holiday#15285,d_weekend#15286,d_following_holiday#15287,d_first_dom#15288,d_last_dom#15289,d_same_day_ly#15290,d_same_day_lq#15291,d_current_day#15292,... 4 more fields] orc
            :                    +- Project [cr_item_sk#15243L, cr_order_number#15257L, cr_return_quantity#15258, cr_return_amount#15259]
            :                       +- Filter ((isnotnull(cr_return_amount#15259) AND (cr_return_amount#15259 > 10000.0)) AND (isnotnull(cr_order_number#15257L) AND isnotnull(cr_item_sk#15243L)))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#15242L,cr_item_sk#15243L,cr_refunded_customer_sk#15244L,cr_refunded_cdemo_sk#15245L,cr_refunded_hdemo_sk#15246L,cr_refunded_addr_sk#15247L,cr_returning_customer_sk#15248L,cr_returning_cdemo_sk#15249L,cr_returning_hdemo_sk#15250L,cr_returning_addr_sk#15251L,cr_call_center_sk#15252L,cr_catalog_page_sk#15253L,cr_ship_mode_sk#15254L,cr_warehouse_sk#15255L,cr_reason_sk#15256L,cr_order_number#15257L,cr_return_quantity#15258,cr_return_amount#15259,cr_return_tax#15260,cr_return_amt_inc_tax#15261,cr_fee#15262,cr_return_ship_cost#15263,cr_refunded_cash#15264,cr_reversed_charge#15265,... 3 more fields] orc
            +- Project [store AS channel#15109, item#15104L, return_ratio#15105, return_rank#15107, currency_rank#15108]
               +- Filter ((return_rank#15107 <= 10) OR (currency_rank#15108 <= 10))
                  +- Window [rank(currency_ratio#15106) windowspecdefinition(currency_ratio#15106 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15108], [currency_ratio#15106 ASC NULLS FIRST]
                     +- Window [rank(return_ratio#15105) windowspecdefinition(return_ratio#15105 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15107], [return_ratio#15105 ASC NULLS FIRST]
                        +- Aggregate [ss_item_sk#15298L], [ss_item_sk#15298L AS item#15104L, CheckOverflow((promote_precision(cast(sum(coalesce(sr_return_quantity#15329, 0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(ss_quantity#15306, 0)) as decimal(15,4)))), DecimalType(35,20), true) AS return_ratio#15105, CheckOverflow((promote_precision(cast(sum(coalesce(sr_return_amt#15330, 0.0)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(ss_net_paid#15316, 0.0)) as decimal(15,4)))), DecimalType(35,20), true) AS currency_ratio#15106]
                           +- Project [ss_item_sk#15298L, ss_quantity#15306, ss_net_paid#15316, sr_return_quantity#15329, sr_return_amt#15330]
                              +- Join Inner, ((ss_ticket_number#15305L = sr_ticket_number#15328L) AND (ss_item_sk#15298L = sr_item_sk#15321L))
                                 :- Project [ss_item_sk#15298L, ss_ticket_number#15305L, ss_quantity#15306, ss_net_paid#15316]
                                 :  +- Join Inner, (ss_sold_date_sk#15319L = d_date_sk#15340L)
                                 :     :- Project [ss_item_sk#15298L, ss_ticket_number#15305L, ss_quantity#15306, ss_net_paid#15316, ss_sold_date_sk#15319L]
                                 :     :  +- Filter (((((((((isnotnull(ss_net_profit#15318) AND isnotnull(ss_net_paid#15316)) AND isnotnull(ss_quantity#15306)) AND (ss_net_profit#15318 > 1.0)) AND (ss_net_paid#15316 > 0.0)) AND (ss_quantity#15306 > 0)) AND isnotnull(ss_ticket_number#15305L)) AND isnotnull(ss_item_sk#15298L)) AND isnotnull(ss_sold_date_sk#15319L)) AND dynamicpruning#15459 [ss_sold_date_sk#15319L])
                                 :     :     :  +- Project [d_date_sk#15340L]
                                 :     :     :     +- Filter (((isnotnull(d_year#15346) AND isnotnull(d_moy#15348)) AND ((d_year#15346 = 2000) AND (d_moy#15348 = 12))) AND isnotnull(d_date_sk#15340L))
                                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15340L,d_date_id#15341,d_date#15342,d_month_seq#15343,d_week_seq#15344,d_quarter_seq#15345,d_year#15346,d_dow#15347,d_moy#15348,d_dom#15349,d_qoy#15350,d_fy_year#15351,d_fy_quarter_seq#15352,d_fy_week_seq#15353,d_day_name#15354,d_quarter_name#15355,d_holiday#15356,d_weekend#15357,d_following_holiday#15358,d_first_dom#15359,d_last_dom#15360,d_same_day_ly#15361,d_same_day_lq#15362,d_current_day#15363,... 4 more fields] orc
                                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15297L,ss_item_sk#15298L,ss_customer_sk#15299L,ss_cdemo_sk#15300L,ss_hdemo_sk#15301L,ss_addr_sk#15302L,ss_store_sk#15303L,ss_promo_sk#15304L,ss_ticket_number#15305L,ss_quantity#15306,ss_wholesale_cost#15307,ss_list_price#15308,ss_sales_price#15309,ss_ext_discount_amt#15310,ss_ext_sales_price#15311,ss_ext_wholesale_cost#15312,ss_ext_list_price#15313,ss_ext_tax#15314,ss_coupon_amt#15315,ss_net_paid#15316,ss_net_paid_inc_tax#15317,ss_net_profit#15318,ss_sold_date_sk#15319L] orc
                                 :     +- Project [d_date_sk#15340L]
                                 :        +- Filter (((isnotnull(d_year#15346) AND isnotnull(d_moy#15348)) AND ((d_year#15346 = 2000) AND (d_moy#15348 = 12))) AND isnotnull(d_date_sk#15340L))
                                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15340L,d_date_id#15341,d_date#15342,d_month_seq#15343,d_week_seq#15344,d_quarter_seq#15345,d_year#15346,d_dow#15347,d_moy#15348,d_dom#15349,d_qoy#15350,d_fy_year#15351,d_fy_quarter_seq#15352,d_fy_week_seq#15353,d_day_name#15354,d_quarter_name#15355,d_holiday#15356,d_weekend#15357,d_following_holiday#15358,d_first_dom#15359,d_last_dom#15360,d_same_day_ly#15361,d_same_day_lq#15362,d_current_day#15363,... 4 more fields] orc
                                 +- Project [sr_item_sk#15321L, sr_ticket_number#15328L, sr_return_quantity#15329, sr_return_amt#15330]
                                    +- Filter ((isnotnull(sr_return_amt#15330) AND (sr_return_amt#15330 > 10000.0)) AND (isnotnull(sr_ticket_number#15328L) AND isnotnull(sr_item_sk#15321L)))
                                       +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#15320L,sr_item_sk#15321L,sr_customer_sk#15322L,sr_cdemo_sk#15323L,sr_hdemo_sk#15324L,sr_addr_sk#15325L,sr_store_sk#15326L,sr_reason_sk#15327L,sr_ticket_number#15328L,sr_return_quantity#15329,sr_return_amt#15330,sr_return_tax#15331,sr_return_amt_inc_tax#15332,sr_fee#15333,sr_return_ship_cost#15334,sr_refunded_cash#15335,sr_reversed_charge#15336,sr_store_credit#15337,sr_net_loss#15338,sr_returned_date_sk#15339L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#15097 ASC NULLS FIRST,return_rank#15095 ASC NULLS FIRST,currency_rank#15096 ASC NULLS FIRST], output=[channel#15097,item#15092L,return_ratio#15093,return_rank#15095,currency_rank#15096])
   +- HashAggregate(keys=[channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096], functions=[], output=[channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096])
      +- Exchange hashpartitioning(channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096, 3000), ENSURE_REQUIREMENTS, [id=#16174]
         +- HashAggregate(keys=[channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096], functions=[], output=[channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096])
            +- Union
               :- Project [web AS channel#15097, item#15092L, return_ratio#15093, return_rank#15095, currency_rank#15096]
               :  +- Filter ((return_rank#15095 <= 10) OR (currency_rank#15096 <= 10))
               :     +- Window [rank(currency_ratio#15094) windowspecdefinition(currency_ratio#15094 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15096], [currency_ratio#15094 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#15094 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#15093) windowspecdefinition(return_ratio#15093 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15095], [return_ratio#15093 ASC NULLS FIRST]
               :              +- Sort [return_ratio#15093 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#16115]
               :                    +- HashAggregate(keys=[ws_item_sk#15124L], functions=[sum(coalesce(wr_return_quantity#15169, 0)), sum(coalesce(ws_quantity#15139, 0)), sum(coalesce(wr_return_amt#15170, 0.0)), sum(coalesce(ws_net_paid#15150, 0.0))], output=[item#15092L, return_ratio#15093, currency_ratio#15094])
               :                       +- Exchange hashpartitioning(ws_item_sk#15124L, 3000), ENSURE_REQUIREMENTS, [id=#16112]
               :                          +- HashAggregate(keys=[ws_item_sk#15124L], functions=[partial_sum(coalesce(wr_return_quantity#15169, 0)), partial_sum(coalesce(ws_quantity#15139, 0)), partial_sum(coalesce(wr_return_amt#15170, 0.0)), partial_sum(coalesce(ws_net_paid#15150, 0.0))], output=[ws_item_sk#15124L, sum#15464L, sum#15465L, sum#15466, sum#15467])
               :                             +- Project [ws_item_sk#15124L, ws_quantity#15139, ws_net_paid#15150, wr_return_quantity#15169, wr_return_amt#15170]
               :                                +- SortMergeJoin [ws_order_number#15138L, ws_item_sk#15124L], [wr_order_number#15168L, wr_item_sk#15157L], Inner
               :                                   :- Sort [ws_order_number#15138L ASC NULLS FIRST, ws_item_sk#15124L ASC NULLS FIRST], false, 0
               :                                   :  +- Exchange hashpartitioning(ws_order_number#15138L, ws_item_sk#15124L, 3000), ENSURE_REQUIREMENTS, [id=#16104]
               :                                   :     +- Project [ws_item_sk#15124L, ws_order_number#15138L, ws_quantity#15139, ws_net_paid#15150]
               :                                   :        +- BroadcastHashJoin [ws_sold_date_sk#15155L], [d_date_sk#15180L], Inner, BuildRight, false
               :                                   :           :- Project [ws_item_sk#15124L, ws_order_number#15138L, ws_quantity#15139, ws_net_paid#15150, ws_sold_date_sk#15155L]
               :                                   :           :  +- Filter (((((((isnotnull(ws_net_profit#15154) AND isnotnull(ws_net_paid#15150)) AND isnotnull(ws_quantity#15139)) AND (ws_net_profit#15154 > 1.0)) AND (ws_net_paid#15150 > 0.0)) AND (ws_quantity#15139 > 0)) AND isnotnull(ws_order_number#15138L)) AND isnotnull(ws_item_sk#15124L))
               :                                   :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#15124L,ws_order_number#15138L,ws_quantity#15139,ws_net_paid#15150,ws_net_profit#15154,ws_sold_date_sk#15155L] Batched: true, DataFilters: [isnotnull(ws_net_profit#15154), isnotnull(ws_net_paid#15150), isnotnull(ws_quantity#15139), (ws_..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#15155L), dynamicpruningexpression(ws_sold_date_sk#15155L IN dynamicpru..., PushedFilters: [IsNotNull(ws_net_profit), IsNotNull(ws_net_paid), IsNotNull(ws_quantity), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_item_sk:bigint,ws_order_number:bigint,ws_quantity:int,ws_net_paid:double,ws_net_profit:...
               :                                   :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#15457, 0, true, Project [d_date_sk#15180L], [d_date_sk#15180L]
               :                                   :           :              +- AdaptiveSparkPlan isFinalPlan=false
               :                                   :           :                 +- Project [d_date_sk#15180L]
               :                                   :           :                    +- Filter ((((isnotnull(d_year#15186) AND isnotnull(d_moy#15188)) AND (d_year#15186 = 2000)) AND (d_moy#15188 = 12)) AND isnotnull(d_date_sk#15180L))
               :                                   :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15180L,d_year#15186,d_moy#15188] Batched: true, DataFilters: [isnotnull(d_year#15186), isnotnull(d_moy#15188), (d_year#15186 = 2000), (d_moy#15188 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :                                   :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16099]
               :                                   :              +- Project [d_date_sk#15180L]
               :                                   :                 +- Filter ((((isnotnull(d_year#15186) AND isnotnull(d_moy#15188)) AND (d_year#15186 = 2000)) AND (d_moy#15188 = 12)) AND isnotnull(d_date_sk#15180L))
               :                                   :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15180L,d_year#15186,d_moy#15188] Batched: true, DataFilters: [isnotnull(d_year#15186), isnotnull(d_moy#15188), (d_year#15186 = 2000), (d_moy#15188 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :                                   +- Sort [wr_order_number#15168L ASC NULLS FIRST, wr_item_sk#15157L ASC NULLS FIRST], false, 0
               :                                      +- Exchange hashpartitioning(wr_order_number#15168L, wr_item_sk#15157L, 3000), ENSURE_REQUIREMENTS, [id=#16105]
               :                                         +- Project [wr_item_sk#15157L, wr_order_number#15168L, wr_return_quantity#15169, wr_return_amt#15170]
               :                                            +- Filter (((isnotnull(wr_return_amt#15170) AND (wr_return_amt#15170 > 10000.0)) AND isnotnull(wr_order_number#15168L)) AND isnotnull(wr_item_sk#15157L))
               :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#15157L,wr_order_number#15168L,wr_return_quantity#15169,wr_return_amt#15170,wr_returned_date_sk#15179L] Batched: true, DataFilters: [isnotnull(wr_return_amt#15170), (wr_return_amt#15170 > 10000.0), isnotnull(wr_order_number#15168..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.0), IsNotNull(wr_order_number), IsNotN..., ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:double>
               :- Project [catalog AS channel#15103, item#15098L, return_ratio#15099, return_rank#15101, currency_rank#15102]
               :  +- Filter ((return_rank#15101 <= 10) OR (currency_rank#15102 <= 10))
               :     +- Window [rank(currency_ratio#15100) windowspecdefinition(currency_ratio#15100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15102], [currency_ratio#15100 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#15100 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#15099) windowspecdefinition(return_ratio#15099 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15101], [return_ratio#15099 ASC NULLS FIRST]
               :              +- Sort [return_ratio#15099 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#16139]
               :                    +- HashAggregate(keys=[cs_item_sk#15222L], functions=[sum(coalesce(cr_return_quantity#15258, 0)), sum(coalesce(cs_quantity#15225, 0)), sum(coalesce(cr_return_amount#15259, 0.0)), sum(coalesce(cs_net_paid#15236, 0.0))], output=[item#15098L, return_ratio#15099, currency_ratio#15100])
               :                       +- Exchange hashpartitioning(cs_item_sk#15222L, 3000), ENSURE_REQUIREMENTS, [id=#16136]
               :                          +- HashAggregate(keys=[cs_item_sk#15222L], functions=[partial_sum(coalesce(cr_return_quantity#15258, 0)), partial_sum(coalesce(cs_quantity#15225, 0)), partial_sum(coalesce(cr_return_amount#15259, 0.0)), partial_sum(coalesce(cs_net_paid#15236, 0.0))], output=[cs_item_sk#15222L, sum#15472L, sum#15473L, sum#15474, sum#15475])
               :                             +- Project [cs_item_sk#15222L, cs_quantity#15225, cs_net_paid#15236, cr_return_quantity#15258, cr_return_amount#15259]
               :                                +- SortMergeJoin [cs_order_number#15224L, cs_item_sk#15222L], [cr_order_number#15257L, cr_item_sk#15243L], Inner
               :                                   :- Sort [cs_order_number#15224L ASC NULLS FIRST, cs_item_sk#15222L ASC NULLS FIRST], false, 0
               :                                   :  +- Exchange hashpartitioning(cs_order_number#15224L, cs_item_sk#15222L, 3000), ENSURE_REQUIREMENTS, [id=#16128]
               :                                   :     +- Project [cs_item_sk#15222L, cs_order_number#15224L, cs_quantity#15225, cs_net_paid#15236]
               :                                   :        +- BroadcastHashJoin [cs_sold_date_sk#15241L], [d_date_sk#15269L], Inner, BuildRight, false
               :                                   :           :- Project [cs_item_sk#15222L, cs_order_number#15224L, cs_quantity#15225, cs_net_paid#15236, cs_sold_date_sk#15241L]
               :                                   :           :  +- Filter (((((((isnotnull(cs_net_profit#15240) AND isnotnull(cs_net_paid#15236)) AND isnotnull(cs_quantity#15225)) AND (cs_net_profit#15240 > 1.0)) AND (cs_net_paid#15236 > 0.0)) AND (cs_quantity#15225 > 0)) AND isnotnull(cs_order_number#15224L)) AND isnotnull(cs_item_sk#15222L))
               :                                   :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#15222L,cs_order_number#15224L,cs_quantity#15225,cs_net_paid#15236,cs_net_profit#15240,cs_sold_date_sk#15241L] Batched: true, DataFilters: [isnotnull(cs_net_profit#15240), isnotnull(cs_net_paid#15236), isnotnull(cs_quantity#15225), (cs_..., Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#15241L), dynamicpruningexpression(cs_sold_date_sk#15241L IN dynamicpru..., PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_net_paid), IsNotNull(cs_quantity), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_item_sk:bigint,cs_order_number:bigint,cs_quantity:int,cs_net_paid:double,cs_net_profit:...
               :                                   :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#15458, 0, true, Project [d_date_sk#15269L], [d_date_sk#15269L]
               :                                   :           :              +- AdaptiveSparkPlan isFinalPlan=false
               :                                   :           :                 +- Project [d_date_sk#15269L]
               :                                   :           :                    +- Filter ((((isnotnull(d_year#15275) AND isnotnull(d_moy#15277)) AND (d_year#15275 = 2000)) AND (d_moy#15277 = 12)) AND isnotnull(d_date_sk#15269L))
               :                                   :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15269L,d_year#15275,d_moy#15277] Batched: true, DataFilters: [isnotnull(d_year#15275), isnotnull(d_moy#15277), (d_year#15275 = 2000), (d_moy#15277 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :                                   :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16123]
               :                                   :              +- Project [d_date_sk#15269L]
               :                                   :                 +- Filter ((((isnotnull(d_year#15275) AND isnotnull(d_moy#15277)) AND (d_year#15275 = 2000)) AND (d_moy#15277 = 12)) AND isnotnull(d_date_sk#15269L))
               :                                   :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15269L,d_year#15275,d_moy#15277] Batched: true, DataFilters: [isnotnull(d_year#15275), isnotnull(d_moy#15277), (d_year#15275 = 2000), (d_moy#15277 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :                                   +- Sort [cr_order_number#15257L ASC NULLS FIRST, cr_item_sk#15243L ASC NULLS FIRST], false, 0
               :                                      +- Exchange hashpartitioning(cr_order_number#15257L, cr_item_sk#15243L, 3000), ENSURE_REQUIREMENTS, [id=#16129]
               :                                         +- Project [cr_item_sk#15243L, cr_order_number#15257L, cr_return_quantity#15258, cr_return_amount#15259]
               :                                            +- Filter (((isnotnull(cr_return_amount#15259) AND (cr_return_amount#15259 > 10000.0)) AND isnotnull(cr_order_number#15257L)) AND isnotnull(cr_item_sk#15243L))
               :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#15243L,cr_order_number#15257L,cr_return_quantity#15258,cr_return_amount#15259,cr_returned_date_sk#15268L] Batched: true, DataFilters: [isnotnull(cr_return_amount#15259), (cr_return_amount#15259 > 10000.0), isnotnull(cr_order_number..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.0), IsNotNull(cr_order_number), ..., ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:double>
               +- Project [store AS channel#15109, item#15104L, return_ratio#15105, return_rank#15107, currency_rank#15108]
                  +- Filter ((return_rank#15107 <= 10) OR (currency_rank#15108 <= 10))
                     +- Window [rank(currency_ratio#15106) windowspecdefinition(currency_ratio#15106 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#15108], [currency_ratio#15106 ASC NULLS FIRST]
                        +- Sort [currency_ratio#15106 ASC NULLS FIRST], false, 0
                           +- Window [rank(return_ratio#15105) windowspecdefinition(return_ratio#15105 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#15107], [return_ratio#15105 ASC NULLS FIRST]
                              +- Sort [return_ratio#15105 ASC NULLS FIRST], false, 0
                                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#16163]
                                    +- HashAggregate(keys=[ss_item_sk#15298L], functions=[sum(coalesce(sr_return_quantity#15329, 0)), sum(coalesce(ss_quantity#15306, 0)), sum(coalesce(sr_return_amt#15330, 0.0)), sum(coalesce(ss_net_paid#15316, 0.0))], output=[item#15104L, return_ratio#15105, currency_ratio#15106])
                                       +- Exchange hashpartitioning(ss_item_sk#15298L, 3000), ENSURE_REQUIREMENTS, [id=#16160]
                                          +- HashAggregate(keys=[ss_item_sk#15298L], functions=[partial_sum(coalesce(sr_return_quantity#15329, 0)), partial_sum(coalesce(ss_quantity#15306, 0)), partial_sum(coalesce(sr_return_amt#15330, 0.0)), partial_sum(coalesce(ss_net_paid#15316, 0.0))], output=[ss_item_sk#15298L, sum#15480L, sum#15481L, sum#15482, sum#15483])
                                             +- Project [ss_item_sk#15298L, ss_quantity#15306, ss_net_paid#15316, sr_return_quantity#15329, sr_return_amt#15330]
                                                +- SortMergeJoin [ss_ticket_number#15305L, ss_item_sk#15298L], [sr_ticket_number#15328L, sr_item_sk#15321L], Inner
                                                   :- Sort [ss_ticket_number#15305L ASC NULLS FIRST, ss_item_sk#15298L ASC NULLS FIRST], false, 0
                                                   :  +- Exchange hashpartitioning(ss_ticket_number#15305L, ss_item_sk#15298L, 3000), ENSURE_REQUIREMENTS, [id=#16152]
                                                   :     +- Project [ss_item_sk#15298L, ss_ticket_number#15305L, ss_quantity#15306, ss_net_paid#15316]
                                                   :        +- BroadcastHashJoin [ss_sold_date_sk#15319L], [d_date_sk#15340L], Inner, BuildRight, false
                                                   :           :- Project [ss_item_sk#15298L, ss_ticket_number#15305L, ss_quantity#15306, ss_net_paid#15316, ss_sold_date_sk#15319L]
                                                   :           :  +- Filter (((((((isnotnull(ss_net_profit#15318) AND isnotnull(ss_net_paid#15316)) AND isnotnull(ss_quantity#15306)) AND (ss_net_profit#15318 > 1.0)) AND (ss_net_paid#15316 > 0.0)) AND (ss_quantity#15306 > 0)) AND isnotnull(ss_ticket_number#15305L)) AND isnotnull(ss_item_sk#15298L))
                                                   :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#15298L,ss_ticket_number#15305L,ss_quantity#15306,ss_net_paid#15316,ss_net_profit#15318,ss_sold_date_sk#15319L] Batched: true, DataFilters: [isnotnull(ss_net_profit#15318), isnotnull(ss_net_paid#15316), isnotnull(ss_quantity#15306), (ss_..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15319L), dynamicpruningexpression(ss_sold_date_sk#15319L IN dynamicpru..., PushedFilters: [IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), IsNotNull(ss_quantity), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_item_sk:bigint,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:double,ss_net_profit...
                                                   :           :           +- SubqueryAdaptiveBroadcast dynamicpruning#15459, 0, true, Project [d_date_sk#15340L], [d_date_sk#15340L]
                                                   :           :              +- AdaptiveSparkPlan isFinalPlan=false
                                                   :           :                 +- Project [d_date_sk#15340L]
                                                   :           :                    +- Filter ((((isnotnull(d_year#15346) AND isnotnull(d_moy#15348)) AND (d_year#15346 = 2000)) AND (d_moy#15348 = 12)) AND isnotnull(d_date_sk#15340L))
                                                   :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15340L,d_year#15346,d_moy#15348] Batched: true, DataFilters: [isnotnull(d_year#15346), isnotnull(d_moy#15348), (d_year#15346 = 2000), (d_moy#15348 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                                   :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16147]
                                                   :              +- Project [d_date_sk#15340L]
                                                   :                 +- Filter ((((isnotnull(d_year#15346) AND isnotnull(d_moy#15348)) AND (d_year#15346 = 2000)) AND (d_moy#15348 = 12)) AND isnotnull(d_date_sk#15340L))
                                                   :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15340L,d_year#15346,d_moy#15348] Batched: true, DataFilters: [isnotnull(d_year#15346), isnotnull(d_moy#15348), (d_year#15346 = 2000), (d_moy#15348 = 12), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                                   +- Sort [sr_ticket_number#15328L ASC NULLS FIRST, sr_item_sk#15321L ASC NULLS FIRST], false, 0
                                                      +- Exchange hashpartitioning(sr_ticket_number#15328L, sr_item_sk#15321L, 3000), ENSURE_REQUIREMENTS, [id=#16153]
                                                         +- Project [sr_item_sk#15321L, sr_ticket_number#15328L, sr_return_quantity#15329, sr_return_amt#15330]
                                                            +- Filter (((isnotnull(sr_return_amt#15330) AND (sr_return_amt#15330 > 10000.0)) AND isnotnull(sr_ticket_number#15328L)) AND isnotnull(sr_item_sk#15321L))
                                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#15321L,sr_ticket_number#15328L,sr_return_quantity#15329,sr_return_amt#15330,sr_returned_date_sk#15339L] Batched: true, DataFilters: [isnotnull(sr_return_amt#15330), (sr_return_amt#15330 > 10000.0), isnotnull(sr_ticket_number#1532..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.0), IsNotNull(sr_ticket_number), IsNot..., ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:double>

read query: spark_queries/q50.sql
explain query: q50
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['s_store_name ASC NULLS FIRST, 's_company_id ASC NULLS FIRST, 's_street_number ASC NULLS FIRST, 's_street_name ASC NULLS FIRST, 's_street_type ASC NULLS FIRST, 's_suite_number ASC NULLS FIRST, 's_city ASC NULLS FIRST, 's_county ASC NULLS FIRST, 's_state ASC NULLS FIRST, 's_zip ASC NULLS FIRST], true
      +- 'Aggregate ['s_store_name, 's_company_id, 's_street_number, 's_street_name, 's_street_type, 's_suite_number, 's_city, 's_county, 's_state, 's_zip], ['s_store_name, 's_company_id, 's_street_number, 's_street_name, 's_street_type, 's_suite_number, 's_city, 's_county, 's_state, 's_zip, 'sum(CASE WHEN (('sr_returned_date_sk - 'ss_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#15484, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 30) AND (('sr_returned_date_sk - 'ss_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#15485, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 60) AND (('sr_returned_date_sk - 'ss_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#15486, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 90) AND (('sr_returned_date_sk - 'ss_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#15487, 'sum(CASE WHEN (('sr_returned_date_sk - 'ss_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#15488]
         +- 'Filter (((('d2.d_year = 2000) AND ('d2.d_moy = 9)) AND (('ss_ticket_number = 'sr_ticket_number) AND ('ss_item_sk = 'sr_item_sk))) AND ((('ss_sold_date_sk = 'd1.d_date_sk) AND ('sr_returned_date_sk = 'd2.d_date_sk)) AND (('ss_customer_sk = 'sr_customer_sk) AND ('ss_store_sk = 's_store_sk))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  :  +- 'UnresolvedRelation [store_returns], [], false
               :  :  +- 'UnresolvedRelation [store], [], false
               :  +- 'SubqueryAlias d1
               :     +- 'UnresolvedRelation [date_dim], [], false
               +- 'SubqueryAlias d2
                  +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
s_store_name: string, s_company_id: int, s_street_number: string, s_street_name: string, s_street_type: string, s_suite_number: string, s_city: string, s_county: string, s_state: string, s_zip: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#15537 ASC NULLS FIRST, s_company_id#15548 ASC NULLS FIRST, s_street_number#15550 ASC NULLS FIRST, s_street_name#15551 ASC NULLS FIRST, s_street_type#15552 ASC NULLS FIRST, s_suite_number#15553 ASC NULLS FIRST, s_city#15554 ASC NULLS FIRST, s_county#15555 ASC NULLS FIRST, s_state#15556 ASC NULLS FIRST, s_zip#15557 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557], [s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557, sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= cast(30 as bigint)) THEN 1 ELSE 0 END) AS 30 days#15484L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > cast(30 as bigint)) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= cast(60 as bigint))) THEN 1 ELSE 0 END) AS 31-60 days#15485L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > cast(60 as bigint)) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= cast(90 as bigint))) THEN 1 ELSE 0 END) AS 61-90 days#15486L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > cast(90 as bigint)) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= cast(120 as bigint))) THEN 1 ELSE 0 END) AS 91-120 days#15487L, sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > cast(120 as bigint)) THEN 1 ELSE 0 END) AS >120 days#15488L]
         +- Filter ((((d_year#15595 = 2000) AND (d_moy#15597 = 9)) AND ((ss_ticket_number#15497L = sr_ticket_number#15520L) AND (ss_item_sk#15490L = sr_item_sk#15513L))) AND (((ss_sold_date_sk#15511L = d_date_sk#15561L) AND (sr_returned_date_sk#15531L = d_date_sk#15589L)) AND ((ss_customer_sk#15491L = sr_customer_sk#15514L) AND (ss_store_sk#15495L = s_store_sk#15532L))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15489L,ss_item_sk#15490L,ss_customer_sk#15491L,ss_cdemo_sk#15492L,ss_hdemo_sk#15493L,ss_addr_sk#15494L,ss_store_sk#15495L,ss_promo_sk#15496L,ss_ticket_number#15497L,ss_quantity#15498,ss_wholesale_cost#15499,ss_list_price#15500,ss_sales_price#15501,ss_ext_discount_amt#15502,ss_ext_sales_price#15503,ss_ext_wholesale_cost#15504,ss_ext_list_price#15505,ss_ext_tax#15506,ss_coupon_amt#15507,ss_net_paid#15508,ss_net_paid_inc_tax#15509,ss_net_profit#15510,ss_sold_date_sk#15511L] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#15512L,sr_item_sk#15513L,sr_customer_sk#15514L,sr_cdemo_sk#15515L,sr_hdemo_sk#15516L,sr_addr_sk#15517L,sr_store_sk#15518L,sr_reason_sk#15519L,sr_ticket_number#15520L,sr_return_quantity#15521,sr_return_amt#15522,sr_return_tax#15523,sr_return_amt_inc_tax#15524,sr_fee#15525,sr_return_ship_cost#15526,sr_refunded_cash#15527,sr_reversed_charge#15528,sr_store_credit#15529,sr_net_loss#15530,sr_returned_date_sk#15531L] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15532L,s_store_id#15533,s_rec_start_date#15534,s_rec_end_date#15535,s_closed_date_sk#15536L,s_store_name#15537,s_number_employees#15538,s_floor_space#15539,s_hours#15540,s_manager#15541,s_market_id#15542,s_geography_class#15543,s_market_desc#15544,s_market_manager#15545,s_division_id#15546,s_division_name#15547,s_company_id#15548,s_company_name#15549,s_street_number#15550,s_street_name#15551,s_street_type#15552,s_suite_number#15553,s_city#15554,s_county#15555,... 5 more fields] orc
               :  +- SubqueryAlias d1
               :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15561L,d_date_id#15562,d_date#15563,d_month_seq#15564,d_week_seq#15565,d_quarter_seq#15566,d_year#15567,d_dow#15568,d_moy#15569,d_dom#15570,d_qoy#15571,d_fy_year#15572,d_fy_quarter_seq#15573,d_fy_week_seq#15574,d_day_name#15575,d_quarter_name#15576,d_holiday#15577,d_weekend#15578,d_following_holiday#15579,d_first_dom#15580,d_last_dom#15581,d_same_day_ly#15582,d_same_day_lq#15583,d_current_day#15584,... 4 more fields] orc
               +- SubqueryAlias d2
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15589L,d_date_id#15590,d_date#15591,d_month_seq#15592,d_week_seq#15593,d_quarter_seq#15594,d_year#15595,d_dow#15596,d_moy#15597,d_dom#15598,d_qoy#15599,d_fy_year#15600,d_fy_quarter_seq#15601,d_fy_week_seq#15602,d_day_name#15603,d_quarter_name#15604,d_holiday#15605,d_weekend#15606,d_following_holiday#15607,d_first_dom#15608,d_last_dom#15609,d_same_day_ly#15610,d_same_day_lq#15611,d_current_day#15612,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#15537 ASC NULLS FIRST, s_company_id#15548 ASC NULLS FIRST, s_street_number#15550 ASC NULLS FIRST, s_street_name#15551 ASC NULLS FIRST, s_street_type#15552 ASC NULLS FIRST, s_suite_number#15553 ASC NULLS FIRST, s_city#15554 ASC NULLS FIRST, s_county#15555 ASC NULLS FIRST, s_state#15556 ASC NULLS FIRST, s_zip#15557 ASC NULLS FIRST], true
      +- Aggregate [s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557], [s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557, sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 30) THEN 1 ELSE 0 END) AS 30 days#15484L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 30) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#15485L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 60) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#15486L, sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 90) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#15487L, sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 120) THEN 1 ELSE 0 END) AS >120 days#15488L]
         +- Project [ss_sold_date_sk#15511L, sr_returned_date_sk#15531L, s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557]
            +- Join Inner, (ss_store_sk#15495L = s_store_sk#15532L)
               :- Project [sr_returned_date_sk#15531L, ss_store_sk#15495L, ss_sold_date_sk#15511L]
               :  +- Join Inner, (ss_sold_date_sk#15511L = d_date_sk#15561L)
               :     :- Project [sr_returned_date_sk#15531L, ss_store_sk#15495L, ss_sold_date_sk#15511L]
               :     :  +- Join Inner, (((ss_ticket_number#15497L = sr_ticket_number#15520L) AND (ss_item_sk#15490L = sr_item_sk#15513L)) AND (ss_customer_sk#15491L = sr_customer_sk#15514L))
               :     :     :- Project [sr_item_sk#15513L, sr_customer_sk#15514L, sr_ticket_number#15520L, sr_returned_date_sk#15531L]
               :     :     :  +- Join Inner, (sr_returned_date_sk#15531L = d_date_sk#15589L)
               :     :     :     :- Project [sr_item_sk#15513L, sr_customer_sk#15514L, sr_ticket_number#15520L, sr_returned_date_sk#15531L]
               :     :     :     :  +- Filter ((((isnotnull(sr_ticket_number#15520L) AND isnotnull(sr_item_sk#15513L)) AND isnotnull(sr_customer_sk#15514L)) AND isnotnull(sr_returned_date_sk#15531L)) AND dynamicpruning#15637 [sr_returned_date_sk#15531L])
               :     :     :     :     :  +- Project [d_date_sk#15589L]
               :     :     :     :     :     +- Filter (((isnotnull(d_year#15595) AND isnotnull(d_moy#15597)) AND ((d_year#15595 = 2000) AND (d_moy#15597 = 9))) AND isnotnull(d_date_sk#15589L))
               :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15589L,d_date_id#15590,d_date#15591,d_month_seq#15592,d_week_seq#15593,d_quarter_seq#15594,d_year#15595,d_dow#15596,d_moy#15597,d_dom#15598,d_qoy#15599,d_fy_year#15600,d_fy_quarter_seq#15601,d_fy_week_seq#15602,d_day_name#15603,d_quarter_name#15604,d_holiday#15605,d_weekend#15606,d_following_holiday#15607,d_first_dom#15608,d_last_dom#15609,d_same_day_ly#15610,d_same_day_lq#15611,d_current_day#15612,... 4 more fields] orc
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#15512L,sr_item_sk#15513L,sr_customer_sk#15514L,sr_cdemo_sk#15515L,sr_hdemo_sk#15516L,sr_addr_sk#15517L,sr_store_sk#15518L,sr_reason_sk#15519L,sr_ticket_number#15520L,sr_return_quantity#15521,sr_return_amt#15522,sr_return_tax#15523,sr_return_amt_inc_tax#15524,sr_fee#15525,sr_return_ship_cost#15526,sr_refunded_cash#15527,sr_reversed_charge#15528,sr_store_credit#15529,sr_net_loss#15530,sr_returned_date_sk#15531L] orc
               :     :     :     +- Project [d_date_sk#15589L]
               :     :     :        +- Filter (((isnotnull(d_year#15595) AND isnotnull(d_moy#15597)) AND ((d_year#15595 = 2000) AND (d_moy#15597 = 9))) AND isnotnull(d_date_sk#15589L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15589L,d_date_id#15590,d_date#15591,d_month_seq#15592,d_week_seq#15593,d_quarter_seq#15594,d_year#15595,d_dow#15596,d_moy#15597,d_dom#15598,d_qoy#15599,d_fy_year#15600,d_fy_quarter_seq#15601,d_fy_week_seq#15602,d_day_name#15603,d_quarter_name#15604,d_holiday#15605,d_weekend#15606,d_following_holiday#15607,d_first_dom#15608,d_last_dom#15609,d_same_day_ly#15610,d_same_day_lq#15611,d_current_day#15612,... 4 more fields] orc
               :     :     +- Project [ss_item_sk#15490L, ss_customer_sk#15491L, ss_store_sk#15495L, ss_ticket_number#15497L, ss_sold_date_sk#15511L]
               :     :        +- Filter ((((isnotnull(ss_ticket_number#15497L) AND isnotnull(ss_item_sk#15490L)) AND isnotnull(ss_customer_sk#15491L)) AND isnotnull(ss_store_sk#15495L)) AND isnotnull(ss_sold_date_sk#15511L))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15489L,ss_item_sk#15490L,ss_customer_sk#15491L,ss_cdemo_sk#15492L,ss_hdemo_sk#15493L,ss_addr_sk#15494L,ss_store_sk#15495L,ss_promo_sk#15496L,ss_ticket_number#15497L,ss_quantity#15498,ss_wholesale_cost#15499,ss_list_price#15500,ss_sales_price#15501,ss_ext_discount_amt#15502,ss_ext_sales_price#15503,ss_ext_wholesale_cost#15504,ss_ext_list_price#15505,ss_ext_tax#15506,ss_coupon_amt#15507,ss_net_paid#15508,ss_net_paid_inc_tax#15509,ss_net_profit#15510,ss_sold_date_sk#15511L] orc
               :     +- Project [d_date_sk#15561L]
               :        +- Filter isnotnull(d_date_sk#15561L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15561L,d_date_id#15562,d_date#15563,d_month_seq#15564,d_week_seq#15565,d_quarter_seq#15566,d_year#15567,d_dow#15568,d_moy#15569,d_dom#15570,d_qoy#15571,d_fy_year#15572,d_fy_quarter_seq#15573,d_fy_week_seq#15574,d_day_name#15575,d_quarter_name#15576,d_holiday#15577,d_weekend#15578,d_following_holiday#15579,d_first_dom#15580,d_last_dom#15581,d_same_day_ly#15582,d_same_day_lq#15583,d_current_day#15584,... 4 more fields] orc
               +- Project [s_store_sk#15532L, s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557]
                  +- Filter isnotnull(s_store_sk#15532L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15532L,s_store_id#15533,s_rec_start_date#15534,s_rec_end_date#15535,s_closed_date_sk#15536L,s_store_name#15537,s_number_employees#15538,s_floor_space#15539,s_hours#15540,s_manager#15541,s_market_id#15542,s_geography_class#15543,s_market_desc#15544,s_market_manager#15545,s_division_id#15546,s_division_name#15547,s_company_id#15548,s_company_name#15549,s_street_number#15550,s_street_name#15551,s_street_type#15552,s_suite_number#15553,s_city#15554,s_county#15555,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name#15537 ASC NULLS FIRST,s_company_id#15548 ASC NULLS FIRST,s_street_number#15550 ASC NULLS FIRST,s_street_name#15551 ASC NULLS FIRST,s_street_type#15552 ASC NULLS FIRST,s_suite_number#15553 ASC NULLS FIRST,s_city#15554 ASC NULLS FIRST,s_county#15555 ASC NULLS FIRST,s_state#15556 ASC NULLS FIRST,s_zip#15557 ASC NULLS FIRST], output=[s_store_name#15537,s_company_id#15548,s_street_number#15550,s_street_name#15551,s_street_type#15552,s_suite_number#15553,s_city#15554,s_county#15555,s_state#15556,s_zip#15557,30 days#15484L,31-60 days#15485L,61-90 days#15486L,91-120 days#15487L,>120 days#15488L])
   +- HashAggregate(keys=[s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557], functions=[sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 30) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 60) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 90) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 120) THEN 1 ELSE 0 END)], output=[s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557, 30 days#15484L, 31-60 days#15485L, 61-90 days#15486L, 91-120 days#15487L, >120 days#15488L])
      +- Exchange hashpartitioning(s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557, 3000), ENSURE_REQUIREMENTS, [id=#16311]
         +- HashAggregate(keys=[s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557], functions=[partial_sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 30) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 60) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 90) AND ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((sr_returned_date_sk#15531L - ss_sold_date_sk#15511L) > 120) THEN 1 ELSE 0 END)], output=[s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557, sum#15643L, sum#15644L, sum#15645L, sum#15646L, sum#15647L])
            +- Project [ss_sold_date_sk#15511L, sr_returned_date_sk#15531L, s_store_name#15537, s_company_id#15548, s_street_number#15550, s_street_name#15551, s_street_type#15552, s_suite_number#15553, s_city#15554, s_county#15555, s_state#15556, s_zip#15557]
               +- BroadcastHashJoin [ss_store_sk#15495L], [s_store_sk#15532L], Inner, BuildRight, false
                  :- Project [sr_returned_date_sk#15531L, ss_store_sk#15495L, ss_sold_date_sk#15511L]
                  :  +- BroadcastHashJoin [ss_sold_date_sk#15511L], [d_date_sk#15561L], Inner, BuildRight, false
                  :     :- Project [sr_returned_date_sk#15531L, ss_store_sk#15495L, ss_sold_date_sk#15511L]
                  :     :  +- SortMergeJoin [sr_ticket_number#15520L, sr_item_sk#15513L, sr_customer_sk#15514L], [ss_ticket_number#15497L, ss_item_sk#15490L, ss_customer_sk#15491L], Inner
                  :     :     :- Sort [sr_ticket_number#15520L ASC NULLS FIRST, sr_item_sk#15513L ASC NULLS FIRST, sr_customer_sk#15514L ASC NULLS FIRST], false, 0
                  :     :     :  +- Exchange hashpartitioning(sr_ticket_number#15520L, sr_item_sk#15513L, sr_customer_sk#15514L, 3000), ENSURE_REQUIREMENTS, [id=#16295]
                  :     :     :     +- Project [sr_item_sk#15513L, sr_customer_sk#15514L, sr_ticket_number#15520L, sr_returned_date_sk#15531L]
                  :     :     :        +- BroadcastHashJoin [sr_returned_date_sk#15531L], [d_date_sk#15589L], Inner, BuildRight, false
                  :     :     :           :- Filter ((isnotnull(sr_ticket_number#15520L) AND isnotnull(sr_item_sk#15513L)) AND isnotnull(sr_customer_sk#15514L))
                  :     :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#15513L,sr_customer_sk#15514L,sr_ticket_number#15520L,sr_returned_date_sk#15531L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#15520L), isnotnull(sr_item_sk#15513L), isnotnull(sr_customer_sk#15514L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#15531L), dynamicpruningexpression(sr_returned_date_sk#15531L IN dy..., PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk), IsNotNull(sr_customer_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_customer_sk:bigint,sr_ticket_number:bigint>
                  :     :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#15637, 0, true, Project [d_date_sk#15589L], [d_date_sk#15589L]
                  :     :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :     :           :              +- Project [d_date_sk#15589L]
                  :     :     :           :                 +- Filter ((((isnotnull(d_year#15595) AND isnotnull(d_moy#15597)) AND (d_year#15595 = 2000)) AND (d_moy#15597 = 9)) AND isnotnull(d_date_sk#15589L))
                  :     :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15589L,d_year#15595,d_moy#15597] Batched: true, DataFilters: [isnotnull(d_year#15595), isnotnull(d_moy#15597), (d_year#15595 = 2000), (d_moy#15597 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16290]
                  :     :     :              +- Project [d_date_sk#15589L]
                  :     :     :                 +- Filter ((((isnotnull(d_year#15595) AND isnotnull(d_moy#15597)) AND (d_year#15595 = 2000)) AND (d_moy#15597 = 9)) AND isnotnull(d_date_sk#15589L))
                  :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15589L,d_year#15595,d_moy#15597] Batched: true, DataFilters: [isnotnull(d_year#15595), isnotnull(d_moy#15597), (d_year#15595 = 2000), (d_moy#15597 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     :     +- Sort [ss_ticket_number#15497L ASC NULLS FIRST, ss_item_sk#15490L ASC NULLS FIRST, ss_customer_sk#15491L ASC NULLS FIRST], false, 0
                  :     :        +- Exchange hashpartitioning(ss_ticket_number#15497L, ss_item_sk#15490L, ss_customer_sk#15491L, 3000), ENSURE_REQUIREMENTS, [id=#16296]
                  :     :           +- Filter (((isnotnull(ss_ticket_number#15497L) AND isnotnull(ss_item_sk#15490L)) AND isnotnull(ss_customer_sk#15491L)) AND isnotnull(ss_store_sk#15495L))
                  :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#15490L,ss_customer_sk#15491L,ss_store_sk#15495L,ss_ticket_number#15497L,ss_sold_date_sk#15511L] Batched: true, DataFilters: [isnotnull(ss_ticket_number#15497L), isnotnull(ss_item_sk#15490L), isnotnull(ss_customer_sk#15491..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15511L)], PushedFilters: [IsNotNull(ss_ticket_number), IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#16302]
                  :        +- Filter isnotnull(d_date_sk#15561L)
                  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15561L] Batched: true, DataFilters: [isnotnull(d_date_sk#15561L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#16306]
                     +- Filter isnotnull(s_store_sk#15532L)
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15532L,s_store_name#15537,s_company_id#15548,s_street_number#15550,s_street_name#15551,s_street_type#15552,s_suite_number#15553,s_city#15554,s_county#15555,s_state#15556,s_zip#15557] Batched: true, DataFilters: [isnotnull(s_store_sk#15532L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_company_id:int,s_street_number:string,s_street_nam...

read query: spark_queries/q51.sql
explain query: q51
== Parsed Logical Plan ==
CTE [web_v1, store_v1]
:  :- 'SubqueryAlias web_v1
:  :  +- 'Aggregate ['ws_item_sk, 'd_date], ['ws_item_sk AS item_sk#15654, 'd_date, 'sum('sum('ws_sales_price)) windowspecdefinition('ws_item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15655]
:  :     +- 'Filter ((('ws_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11)))) AND isnotnull('ws_item_sk))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [web_sales], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias store_v1
:     +- 'Aggregate ['ss_item_sk, 'd_date], ['ss_item_sk AS item_sk#15656, 'd_date, 'sum('sum('ss_sales_price)) windowspecdefinition('ss_item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15657]
:        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11)))) AND isnotnull('ss_item_sk))
:           +- 'Join Inner
:              :- 'UnresolvedRelation [store_sales], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['item_sk ASC NULLS FIRST, 'd_date ASC NULLS FIRST], true
         +- 'Project [*]
            +- 'Filter ('web_cumulative > 'store_cumulative)
               +- 'SubqueryAlias y
                  +- 'Project ['item_sk, 'd_date, 'web_sales, 'store_sales, 'max('web_sales) windowspecdefinition('item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#15652, 'max('store_sales) windowspecdefinition('item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#15653]
                     +- 'SubqueryAlias x
                        +- 'Project [CASE WHEN isnotnull('web.item_sk) THEN 'web.item_sk ELSE 'store.item_sk END AS item_sk#15648, CASE WHEN isnotnull('web.d_date) THEN 'web.d_date ELSE 'store.d_date END AS d_date#15649, 'web.cume_sales AS web_sales#15650, 'store.cume_sales AS store_sales#15651]
                           +- 'Join FullOuter, (('web.item_sk = 'store.item_sk) AND ('web.d_date = 'store.d_date))
                              :- 'SubqueryAlias web
                              :  +- 'UnresolvedRelation [web_v1], [], false
                              +- 'SubqueryAlias store
                                 +- 'UnresolvedRelation [store_v1], [], false

== Analyzed Logical Plan ==
item_sk: bigint, d_date: date, web_sales: double, store_sales: double, web_cumulative: double, store_cumulative: double
WithCTE
:- CTERelationDef 29
:  +- SubqueryAlias web_v1
:     +- Project [item_sk#15654L, d_date#15694, cume_sales#15655]
:        +- Project [item_sk#15654L, d_date#15694, _w0#15775, ws_item_sk#15660L, cume_sales#15655, cume_sales#15655]
:           +- Window [sum(_w0#15775) windowspecdefinition(ws_item_sk#15660L, d_date#15694 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15655], [ws_item_sk#15660L], [d_date#15694 ASC NULLS FIRST]
:              +- Aggregate [ws_item_sk#15660L, d_date#15694], [ws_item_sk#15660L AS item_sk#15654L, d_date#15694, sum(ws_sales_price#15678) AS _w0#15775, ws_item_sk#15660L]
:                 +- Filter (((ws_sold_date_sk#15691L = d_date_sk#15692L) AND ((d_month_seq#15695 >= 1212) AND (d_month_seq#15695 <= (1212 + 11)))) AND isnotnull(ws_item_sk#15660L))
:                    +- Join Inner
:                       :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                       :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#15658L,ws_ship_date_sk#15659L,ws_item_sk#15660L,ws_bill_customer_sk#15661L,ws_bill_cdemo_sk#15662L,ws_bill_hdemo_sk#15663L,ws_bill_addr_sk#15664L,ws_ship_customer_sk#15665L,ws_ship_cdemo_sk#15666L,ws_ship_hdemo_sk#15667L,ws_ship_addr_sk#15668L,ws_web_page_sk#15669L,ws_web_site_sk#15670L,ws_ship_mode_sk#15671L,ws_warehouse_sk#15672L,ws_promo_sk#15673L,ws_order_number#15674L,ws_quantity#15675,ws_wholesale_cost#15676,ws_list_price#15677,ws_sales_price#15678,ws_ext_discount_amt#15679,ws_ext_sales_price#15680,ws_ext_wholesale_cost#15681,... 10 more fields] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15692L,d_date_id#15693,d_date#15694,d_month_seq#15695,d_week_seq#15696,d_quarter_seq#15697,d_year#15698,d_dow#15699,d_moy#15700,d_dom#15701,d_qoy#15702,d_fy_year#15703,d_fy_quarter_seq#15704,d_fy_week_seq#15705,d_day_name#15706,d_quarter_name#15707,d_holiday#15708,d_weekend#15709,d_following_holiday#15710,d_first_dom#15711,d_last_dom#15712,d_same_day_ly#15713,d_same_day_lq#15714,d_current_day#15715,... 4 more fields] orc
:- CTERelationDef 30
:  +- SubqueryAlias store_v1
:     +- Project [item_sk#15656L, d_date#15745, cume_sales#15657]
:        +- Project [item_sk#15656L, d_date#15745, _w0#15776, ss_item_sk#15721L, cume_sales#15657, cume_sales#15657]
:           +- Window [sum(_w0#15776) windowspecdefinition(ss_item_sk#15721L, d_date#15745 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15657], [ss_item_sk#15721L], [d_date#15745 ASC NULLS FIRST]
:              +- Aggregate [ss_item_sk#15721L, d_date#15745], [ss_item_sk#15721L AS item_sk#15656L, d_date#15745, sum(ss_sales_price#15732) AS _w0#15776, ss_item_sk#15721L]
:                 +- Filter (((ss_sold_date_sk#15742L = d_date_sk#15743L) AND ((d_month_seq#15746 >= 1212) AND (d_month_seq#15746 <= (1212 + 11)))) AND isnotnull(ss_item_sk#15721L))
:                    +- Join Inner
:                       :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                       :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15720L,ss_item_sk#15721L,ss_customer_sk#15722L,ss_cdemo_sk#15723L,ss_hdemo_sk#15724L,ss_addr_sk#15725L,ss_store_sk#15726L,ss_promo_sk#15727L,ss_ticket_number#15728L,ss_quantity#15729,ss_wholesale_cost#15730,ss_list_price#15731,ss_sales_price#15732,ss_ext_discount_amt#15733,ss_ext_sales_price#15734,ss_ext_wholesale_cost#15735,ss_ext_list_price#15736,ss_ext_tax#15737,ss_coupon_amt#15738,ss_net_paid#15739,ss_net_paid_inc_tax#15740,ss_net_profit#15741,ss_sold_date_sk#15742L] orc
:                       +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15743L,d_date_id#15744,d_date#15745,d_month_seq#15746,d_week_seq#15747,d_quarter_seq#15748,d_year#15749,d_dow#15750,d_moy#15751,d_dom#15752,d_qoy#15753,d_fy_year#15754,d_fy_quarter_seq#15755,d_fy_week_seq#15756,d_day_name#15757,d_quarter_name#15758,d_holiday#15759,d_weekend#15760,d_following_holiday#15761,d_first_dom#15762,d_last_dom#15763,d_same_day_ly#15764,d_same_day_lq#15765,d_current_day#15766,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [item_sk#15648L ASC NULLS FIRST, d_date#15649 ASC NULLS FIRST], true
         +- Project [item_sk#15648L, d_date#15649, web_sales#15650, store_sales#15651, web_cumulative#15652, store_cumulative#15653]
            +- Filter (web_cumulative#15652 > store_cumulative#15653)
               +- SubqueryAlias y
                  +- Project [item_sk#15648L, d_date#15649, web_sales#15650, store_sales#15651, web_cumulative#15652, store_cumulative#15653]
                     +- Project [item_sk#15648L, d_date#15649, web_sales#15650, store_sales#15651, web_cumulative#15652, store_cumulative#15653, web_cumulative#15652, store_cumulative#15653]
                        +- Window [max(web_sales#15650) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#15652, max(store_sales#15651) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#15653], [item_sk#15648L], [d_date#15649 ASC NULLS FIRST]
                           +- Project [item_sk#15648L, d_date#15649, web_sales#15650, store_sales#15651]
                              +- SubqueryAlias x
                                 +- Project [CASE WHEN isnotnull(item_sk#15654L) THEN item_sk#15654L ELSE item_sk#15656L END AS item_sk#15648L, CASE WHEN isnotnull(d_date#15694) THEN d_date#15694 ELSE d_date#15745 END AS d_date#15649, cume_sales#15655 AS web_sales#15650, cume_sales#15657 AS store_sales#15651]
                                    +- Join FullOuter, ((item_sk#15654L = item_sk#15656L) AND (d_date#15694 = d_date#15745))
                                       :- SubqueryAlias web
                                       :  +- SubqueryAlias web_v1
                                       :     +- CTERelationRef 29, true, [item_sk#15654L, d_date#15694, cume_sales#15655]
                                       +- SubqueryAlias store
                                          +- SubqueryAlias store_v1
                                             +- CTERelationRef 30, true, [item_sk#15656L, d_date#15745, cume_sales#15657]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [item_sk#15648L ASC NULLS FIRST, d_date#15649 ASC NULLS FIRST], true
      +- Filter ((isnotnull(web_cumulative#15652) AND isnotnull(store_cumulative#15653)) AND (web_cumulative#15652 > store_cumulative#15653))
         +- Window [max(web_sales#15650) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#15652, max(store_sales#15651) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#15653], [item_sk#15648L], [d_date#15649 ASC NULLS FIRST]
            +- Project [CASE WHEN isnotnull(item_sk#15654L) THEN item_sk#15654L ELSE item_sk#15656L END AS item_sk#15648L, CASE WHEN isnotnull(d_date#15694) THEN d_date#15694 ELSE d_date#15745 END AS d_date#15649, cume_sales#15655 AS web_sales#15650, cume_sales#15657 AS store_sales#15651]
               +- Join FullOuter, ((item_sk#15654L = item_sk#15656L) AND (d_date#15694 = d_date#15745))
                  :- Project [item_sk#15654L, d_date#15694, cume_sales#15655]
                  :  +- Window [sum(_w0#15775) windowspecdefinition(ws_item_sk#15660L, d_date#15694 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15655], [ws_item_sk#15660L], [d_date#15694 ASC NULLS FIRST]
                  :     +- Aggregate [ws_item_sk#15660L, d_date#15694], [ws_item_sk#15660L AS item_sk#15654L, d_date#15694, sum(ws_sales_price#15678) AS _w0#15775, ws_item_sk#15660L]
                  :        +- Project [ws_item_sk#15660L, ws_sales_price#15678, d_date#15694]
                  :           +- Join Inner, (ws_sold_date_sk#15691L = d_date_sk#15692L)
                  :              :- Project [ws_item_sk#15660L, ws_sales_price#15678, ws_sold_date_sk#15691L]
                  :              :  +- Filter ((isnotnull(ws_item_sk#15660L) AND isnotnull(ws_sold_date_sk#15691L)) AND dynamicpruning#15785 [ws_sold_date_sk#15691L])
                  :              :     :  +- Project [d_date_sk#15692L, d_date#15694]
                  :              :     :     +- Filter ((isnotnull(d_month_seq#15695) AND ((d_month_seq#15695 >= 1212) AND (d_month_seq#15695 <= 1223))) AND isnotnull(d_date_sk#15692L))
                  :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15692L,d_date_id#15693,d_date#15694,d_month_seq#15695,d_week_seq#15696,d_quarter_seq#15697,d_year#15698,d_dow#15699,d_moy#15700,d_dom#15701,d_qoy#15702,d_fy_year#15703,d_fy_quarter_seq#15704,d_fy_week_seq#15705,d_day_name#15706,d_quarter_name#15707,d_holiday#15708,d_weekend#15709,d_following_holiday#15710,d_first_dom#15711,d_last_dom#15712,d_same_day_ly#15713,d_same_day_lq#15714,d_current_day#15715,... 4 more fields] orc
                  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#15658L,ws_ship_date_sk#15659L,ws_item_sk#15660L,ws_bill_customer_sk#15661L,ws_bill_cdemo_sk#15662L,ws_bill_hdemo_sk#15663L,ws_bill_addr_sk#15664L,ws_ship_customer_sk#15665L,ws_ship_cdemo_sk#15666L,ws_ship_hdemo_sk#15667L,ws_ship_addr_sk#15668L,ws_web_page_sk#15669L,ws_web_site_sk#15670L,ws_ship_mode_sk#15671L,ws_warehouse_sk#15672L,ws_promo_sk#15673L,ws_order_number#15674L,ws_quantity#15675,ws_wholesale_cost#15676,ws_list_price#15677,ws_sales_price#15678,ws_ext_discount_amt#15679,ws_ext_sales_price#15680,ws_ext_wholesale_cost#15681,... 10 more fields] orc
                  :              +- Project [d_date_sk#15692L, d_date#15694]
                  :                 +- Filter ((isnotnull(d_month_seq#15695) AND ((d_month_seq#15695 >= 1212) AND (d_month_seq#15695 <= 1223))) AND isnotnull(d_date_sk#15692L))
                  :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15692L,d_date_id#15693,d_date#15694,d_month_seq#15695,d_week_seq#15696,d_quarter_seq#15697,d_year#15698,d_dow#15699,d_moy#15700,d_dom#15701,d_qoy#15702,d_fy_year#15703,d_fy_quarter_seq#15704,d_fy_week_seq#15705,d_day_name#15706,d_quarter_name#15707,d_holiday#15708,d_weekend#15709,d_following_holiday#15710,d_first_dom#15711,d_last_dom#15712,d_same_day_ly#15713,d_same_day_lq#15714,d_current_day#15715,... 4 more fields] orc
                  +- Project [item_sk#15656L, d_date#15745, cume_sales#15657]
                     +- Window [sum(_w0#15776) windowspecdefinition(ss_item_sk#15721L, d_date#15745 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15657], [ss_item_sk#15721L], [d_date#15745 ASC NULLS FIRST]
                        +- Aggregate [ss_item_sk#15721L, d_date#15745], [ss_item_sk#15721L AS item_sk#15656L, d_date#15745, sum(ss_sales_price#15732) AS _w0#15776, ss_item_sk#15721L]
                           +- Project [ss_item_sk#15721L, ss_sales_price#15732, d_date#15745]
                              +- Join Inner, (ss_sold_date_sk#15742L = d_date_sk#15743L)
                                 :- Project [ss_item_sk#15721L, ss_sales_price#15732, ss_sold_date_sk#15742L]
                                 :  +- Filter ((isnotnull(ss_item_sk#15721L) AND isnotnull(ss_sold_date_sk#15742L)) AND dynamicpruning#15786 [ss_sold_date_sk#15742L])
                                 :     :  +- Project [d_date_sk#15743L, d_date#15745]
                                 :     :     +- Filter ((isnotnull(d_month_seq#15746) AND ((d_month_seq#15746 >= 1212) AND (d_month_seq#15746 <= 1223))) AND isnotnull(d_date_sk#15743L))
                                 :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15743L,d_date_id#15744,d_date#15745,d_month_seq#15746,d_week_seq#15747,d_quarter_seq#15748,d_year#15749,d_dow#15750,d_moy#15751,d_dom#15752,d_qoy#15753,d_fy_year#15754,d_fy_quarter_seq#15755,d_fy_week_seq#15756,d_day_name#15757,d_quarter_name#15758,d_holiday#15759,d_weekend#15760,d_following_holiday#15761,d_first_dom#15762,d_last_dom#15763,d_same_day_ly#15764,d_same_day_lq#15765,d_current_day#15766,... 4 more fields] orc
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15720L,ss_item_sk#15721L,ss_customer_sk#15722L,ss_cdemo_sk#15723L,ss_hdemo_sk#15724L,ss_addr_sk#15725L,ss_store_sk#15726L,ss_promo_sk#15727L,ss_ticket_number#15728L,ss_quantity#15729,ss_wholesale_cost#15730,ss_list_price#15731,ss_sales_price#15732,ss_ext_discount_amt#15733,ss_ext_sales_price#15734,ss_ext_wholesale_cost#15735,ss_ext_list_price#15736,ss_ext_tax#15737,ss_coupon_amt#15738,ss_net_paid#15739,ss_net_paid_inc_tax#15740,ss_net_profit#15741,ss_sold_date_sk#15742L] orc
                                 +- Project [d_date_sk#15743L, d_date#15745]
                                    +- Filter ((isnotnull(d_month_seq#15746) AND ((d_month_seq#15746 >= 1212) AND (d_month_seq#15746 <= 1223))) AND isnotnull(d_date_sk#15743L))
                                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15743L,d_date_id#15744,d_date#15745,d_month_seq#15746,d_week_seq#15747,d_quarter_seq#15748,d_year#15749,d_dow#15750,d_moy#15751,d_dom#15752,d_qoy#15753,d_fy_year#15754,d_fy_quarter_seq#15755,d_fy_week_seq#15756,d_day_name#15757,d_quarter_name#15758,d_holiday#15759,d_weekend#15760,d_following_holiday#15761,d_first_dom#15762,d_last_dom#15763,d_same_day_ly#15764,d_same_day_lq#15765,d_current_day#15766,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[item_sk#15648L ASC NULLS FIRST,d_date#15649 ASC NULLS FIRST], output=[item_sk#15648L,d_date#15649,web_sales#15650,store_sales#15651,web_cumulative#15652,store_cumulative#15653])
   +- Filter ((isnotnull(web_cumulative#15652) AND isnotnull(store_cumulative#15653)) AND (web_cumulative#15652 > store_cumulative#15653))
      +- Window [max(web_sales#15650) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#15652, max(store_sales#15651) windowspecdefinition(item_sk#15648L, d_date#15649 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#15653], [item_sk#15648L], [d_date#15649 ASC NULLS FIRST]
         +- Sort [item_sk#15648L ASC NULLS FIRST, d_date#15649 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(item_sk#15648L, 3000), ENSURE_REQUIREMENTS, [id=#16496]
               +- Project [CASE WHEN isnotnull(item_sk#15654L) THEN item_sk#15654L ELSE item_sk#15656L END AS item_sk#15648L, CASE WHEN isnotnull(d_date#15694) THEN d_date#15694 ELSE d_date#15745 END AS d_date#15649, cume_sales#15655 AS web_sales#15650, cume_sales#15657 AS store_sales#15651]
                  +- SortMergeJoin [item_sk#15654L, d_date#15694], [item_sk#15656L, d_date#15745], FullOuter
                     :- Sort [item_sk#15654L ASC NULLS FIRST, d_date#15694 ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(item_sk#15654L, d_date#15694, 3000), ENSURE_REQUIREMENTS, [id=#16489]
                     :     +- Project [item_sk#15654L, d_date#15694, cume_sales#15655]
                     :        +- Window [sum(_w0#15775) windowspecdefinition(ws_item_sk#15660L, d_date#15694 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15655], [ws_item_sk#15660L], [d_date#15694 ASC NULLS FIRST]
                     :           +- Sort [ws_item_sk#15660L ASC NULLS FIRST, d_date#15694 ASC NULLS FIRST], false, 0
                     :              +- Exchange hashpartitioning(ws_item_sk#15660L, 3000), ENSURE_REQUIREMENTS, [id=#16471]
                     :                 +- HashAggregate(keys=[ws_item_sk#15660L, d_date#15694], functions=[sum(ws_sales_price#15678)], output=[item_sk#15654L, d_date#15694, _w0#15775, ws_item_sk#15660L])
                     :                    +- Exchange hashpartitioning(ws_item_sk#15660L, d_date#15694, 3000), ENSURE_REQUIREMENTS, [id=#16468]
                     :                       +- HashAggregate(keys=[ws_item_sk#15660L, d_date#15694], functions=[partial_sum(ws_sales_price#15678)], output=[ws_item_sk#15660L, d_date#15694, sum#15788])
                     :                          +- Project [ws_item_sk#15660L, ws_sales_price#15678, d_date#15694]
                     :                             +- BroadcastHashJoin [ws_sold_date_sk#15691L], [d_date_sk#15692L], Inner, BuildRight, false
                     :                                :- Filter isnotnull(ws_item_sk#15660L)
                     :                                :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#15660L,ws_sales_price#15678,ws_sold_date_sk#15691L] Batched: true, DataFilters: [isnotnull(ws_item_sk#15660L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#15691L), dynamicpruningexpression(ws_sold_date_sk#15691L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_sales_price:double>
                     :                                :        +- SubqueryAdaptiveBroadcast dynamicpruning#15785, 0, true, Project [d_date_sk#15692L, d_date#15694], [d_date_sk#15692L]
                     :                                :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                                :              +- Project [d_date_sk#15692L, d_date#15694]
                     :                                :                 +- Filter (((isnotnull(d_month_seq#15695) AND (d_month_seq#15695 >= 1212)) AND (d_month_seq#15695 <= 1223)) AND isnotnull(d_date_sk#15692L))
                     :                                :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15692L,d_date#15694,d_month_seq#15695] Batched: true, DataFilters: [isnotnull(d_month_seq#15695), (d_month_seq#15695 >= 1212), (d_month_seq#15695 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                                +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16463]
                     :                                   +- Project [d_date_sk#15692L, d_date#15694]
                     :                                      +- Filter (((isnotnull(d_month_seq#15695) AND (d_month_seq#15695 >= 1212)) AND (d_month_seq#15695 <= 1223)) AND isnotnull(d_date_sk#15692L))
                     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15692L,d_date#15694,d_month_seq#15695] Batched: true, DataFilters: [isnotnull(d_month_seq#15695), (d_month_seq#15695 >= 1212), (d_month_seq#15695 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     +- Sort [item_sk#15656L ASC NULLS FIRST, d_date#15745 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(item_sk#15656L, d_date#15745, 3000), ENSURE_REQUIREMENTS, [id=#16490]
                           +- Project [item_sk#15656L, d_date#15745, cume_sales#15657]
                              +- Window [sum(_w0#15776) windowspecdefinition(ss_item_sk#15721L, d_date#15745 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#15657], [ss_item_sk#15721L], [d_date#15745 ASC NULLS FIRST]
                                 +- Sort [ss_item_sk#15721L ASC NULLS FIRST, d_date#15745 ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(ss_item_sk#15721L, 3000), ENSURE_REQUIREMENTS, [id=#16483]
                                       +- HashAggregate(keys=[ss_item_sk#15721L, d_date#15745], functions=[sum(ss_sales_price#15732)], output=[item_sk#15656L, d_date#15745, _w0#15776, ss_item_sk#15721L])
                                          +- Exchange hashpartitioning(ss_item_sk#15721L, d_date#15745, 3000), ENSURE_REQUIREMENTS, [id=#16480]
                                             +- HashAggregate(keys=[ss_item_sk#15721L, d_date#15745], functions=[partial_sum(ss_sales_price#15732)], output=[ss_item_sk#15721L, d_date#15745, sum#15790])
                                                +- Project [ss_item_sk#15721L, ss_sales_price#15732, d_date#15745]
                                                   +- BroadcastHashJoin [ss_sold_date_sk#15742L], [d_date_sk#15743L], Inner, BuildRight, false
                                                      :- Filter isnotnull(ss_item_sk#15721L)
                                                      :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#15721L,ss_sales_price#15732,ss_sold_date_sk#15742L] Batched: true, DataFilters: [isnotnull(ss_item_sk#15721L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15742L), dynamicpruningexpression(ss_sold_date_sk#15742L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_sales_price:double>
                                                      :        +- SubqueryAdaptiveBroadcast dynamicpruning#15786, 0, true, Project [d_date_sk#15743L, d_date#15745], [d_date_sk#15743L]
                                                      :           +- AdaptiveSparkPlan isFinalPlan=false
                                                      :              +- Project [d_date_sk#15743L, d_date#15745]
                                                      :                 +- Filter (((isnotnull(d_month_seq#15746) AND (d_month_seq#15746 >= 1212)) AND (d_month_seq#15746 <= 1223)) AND isnotnull(d_date_sk#15743L))
                                                      :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15743L,d_date#15745,d_month_seq#15746] Batched: true, DataFilters: [isnotnull(d_month_seq#15746), (d_month_seq#15746 >= 1212), (d_month_seq#15746 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                                                      +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16475]
                                                         +- Project [d_date_sk#15743L, d_date#15745]
                                                            +- Filter (((isnotnull(d_month_seq#15746) AND (d_month_seq#15746 >= 1212)) AND (d_month_seq#15746 <= 1223)) AND isnotnull(d_date_sk#15743L))
                                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15743L,d_date#15745,d_month_seq#15746] Batched: true, DataFilters: [isnotnull(d_month_seq#15746), (d_month_seq#15746 >= 1212), (d_month_seq#15746 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>

read query: spark_queries/q52.sql
explain query: q52
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['dt.d_year ASC NULLS FIRST, 'ext_price DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true
      +- 'Aggregate ['dt.d_year, 'item.i_brand, 'item.i_brand_id], ['dt.d_year, 'item.i_brand_id AS brand_id#15791, 'item.i_brand AS brand#15792, 'sum('ss_ext_sales_price) AS ext_price#15793]
         +- 'Filter (((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) AND ('store_sales.ss_item_sk = 'item.i_item_sk)) AND ('item.i_manager_id = 1)) AND (('dt.d_moy = 11) AND ('dt.d_year = 1998)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias dt
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store_sales], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
d_year: int, brand_id: int, brand: string, ext_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [d_year#15800 ASC NULLS FIRST, ext_price#15793 DESC NULLS LAST, brand_id#15791 ASC NULLS FIRST], true
      +- Aggregate [d_year#15800, i_brand#15853, i_brand_id#15852], [d_year#15800, i_brand_id#15852 AS brand_id#15791, i_brand#15853 AS brand#15792, sum(ss_ext_sales_price#15836) AS ext_price#15793]
         +- Filter ((((d_date_sk#15794L = ss_sold_date_sk#15844L) AND (ss_item_sk#15823L = i_item_sk#15845L)) AND (i_manager_id#15865 = 1)) AND ((d_moy#15802 = 11) AND (d_year#15800 = 1998)))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias dt
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15794L,d_date_id#15795,d_date#15796,d_month_seq#15797,d_week_seq#15798,d_quarter_seq#15799,d_year#15800,d_dow#15801,d_moy#15802,d_dom#15803,d_qoy#15804,d_fy_year#15805,d_fy_quarter_seq#15806,d_fy_week_seq#15807,d_day_name#15808,d_quarter_name#15809,d_holiday#15810,d_weekend#15811,d_following_holiday#15812,d_first_dom#15813,d_last_dom#15814,d_same_day_ly#15815,d_same_day_lq#15816,d_current_day#15817,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15822L,ss_item_sk#15823L,ss_customer_sk#15824L,ss_cdemo_sk#15825L,ss_hdemo_sk#15826L,ss_addr_sk#15827L,ss_store_sk#15828L,ss_promo_sk#15829L,ss_ticket_number#15830L,ss_quantity#15831,ss_wholesale_cost#15832,ss_list_price#15833,ss_sales_price#15834,ss_ext_discount_amt#15835,ss_ext_sales_price#15836,ss_ext_wholesale_cost#15837,ss_ext_list_price#15838,ss_ext_tax#15839,ss_coupon_amt#15840,ss_net_paid#15841,ss_net_paid_inc_tax#15842,ss_net_profit#15843,ss_sold_date_sk#15844L] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15845L,i_item_id#15846,i_rec_start_date#15847,i_rec_end_date#15848,i_item_desc#15849,i_current_price#15850,i_wholesale_cost#15851,i_brand_id#15852,i_brand#15853,i_class_id#15854,i_class#15855,i_category_id#15856,i_category#15857,i_manufact_id#15858,i_manufact#15859,i_size#15860,i_formulation#15861,i_color#15862,i_units#15863,i_container#15864,i_manager_id#15865,i_product_name#15866] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [d_year#15800 ASC NULLS FIRST, ext_price#15793 DESC NULLS LAST, brand_id#15791 ASC NULLS FIRST], true
      +- Aggregate [d_year#15800, i_brand#15853, i_brand_id#15852], [d_year#15800, i_brand_id#15852 AS brand_id#15791, i_brand#15853 AS brand#15792, sum(ss_ext_sales_price#15836) AS ext_price#15793]
         +- Project [d_year#15800, ss_ext_sales_price#15836, i_brand_id#15852, i_brand#15853]
            +- Join Inner, (d_date_sk#15794L = ss_sold_date_sk#15844L)
               :- Project [ss_ext_sales_price#15836, ss_sold_date_sk#15844L, i_brand_id#15852, i_brand#15853]
               :  +- Join Inner, (ss_item_sk#15823L = i_item_sk#15845L)
               :     :- Project [ss_item_sk#15823L, ss_ext_sales_price#15836, ss_sold_date_sk#15844L]
               :     :  +- Filter ((isnotnull(ss_sold_date_sk#15844L) AND isnotnull(ss_item_sk#15823L)) AND dynamicpruning#15872 [ss_sold_date_sk#15844L])
               :     :     :  +- Project [d_date_sk#15794L, d_year#15800]
               :     :     :     +- Filter (((isnotnull(d_moy#15802) AND isnotnull(d_year#15800)) AND ((d_moy#15802 = 11) AND (d_year#15800 = 1998))) AND isnotnull(d_date_sk#15794L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15794L,d_date_id#15795,d_date#15796,d_month_seq#15797,d_week_seq#15798,d_quarter_seq#15799,d_year#15800,d_dow#15801,d_moy#15802,d_dom#15803,d_qoy#15804,d_fy_year#15805,d_fy_quarter_seq#15806,d_fy_week_seq#15807,d_day_name#15808,d_quarter_name#15809,d_holiday#15810,d_weekend#15811,d_following_holiday#15812,d_first_dom#15813,d_last_dom#15814,d_same_day_ly#15815,d_same_day_lq#15816,d_current_day#15817,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15822L,ss_item_sk#15823L,ss_customer_sk#15824L,ss_cdemo_sk#15825L,ss_hdemo_sk#15826L,ss_addr_sk#15827L,ss_store_sk#15828L,ss_promo_sk#15829L,ss_ticket_number#15830L,ss_quantity#15831,ss_wholesale_cost#15832,ss_list_price#15833,ss_sales_price#15834,ss_ext_discount_amt#15835,ss_ext_sales_price#15836,ss_ext_wholesale_cost#15837,ss_ext_list_price#15838,ss_ext_tax#15839,ss_coupon_amt#15840,ss_net_paid#15841,ss_net_paid_inc_tax#15842,ss_net_profit#15843,ss_sold_date_sk#15844L] orc
               :     +- Project [i_item_sk#15845L, i_brand_id#15852, i_brand#15853]
               :        +- Filter ((isnotnull(i_manager_id#15865) AND (i_manager_id#15865 = 1)) AND isnotnull(i_item_sk#15845L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15845L,i_item_id#15846,i_rec_start_date#15847,i_rec_end_date#15848,i_item_desc#15849,i_current_price#15850,i_wholesale_cost#15851,i_brand_id#15852,i_brand#15853,i_class_id#15854,i_class#15855,i_category_id#15856,i_category#15857,i_manufact_id#15858,i_manufact#15859,i_size#15860,i_formulation#15861,i_color#15862,i_units#15863,i_container#15864,i_manager_id#15865,i_product_name#15866] orc
               +- Project [d_date_sk#15794L, d_year#15800]
                  +- Filter (((isnotnull(d_moy#15802) AND isnotnull(d_year#15800)) AND ((d_moy#15802 = 11) AND (d_year#15800 = 1998))) AND isnotnull(d_date_sk#15794L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15794L,d_date_id#15795,d_date#15796,d_month_seq#15797,d_week_seq#15798,d_quarter_seq#15799,d_year#15800,d_dow#15801,d_moy#15802,d_dom#15803,d_qoy#15804,d_fy_year#15805,d_fy_quarter_seq#15806,d_fy_week_seq#15807,d_day_name#15808,d_quarter_name#15809,d_holiday#15810,d_weekend#15811,d_following_holiday#15812,d_first_dom#15813,d_last_dom#15814,d_same_day_ly#15815,d_same_day_lq#15816,d_current_day#15817,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[d_year#15800 ASC NULLS FIRST,ext_price#15793 DESC NULLS LAST,brand_id#15791 ASC NULLS FIRST], output=[d_year#15800,brand_id#15791,brand#15792,ext_price#15793])
   +- HashAggregate(keys=[d_year#15800, i_brand#15853, i_brand_id#15852], functions=[sum(ss_ext_sales_price#15836)], output=[d_year#15800, brand_id#15791, brand#15792, ext_price#15793])
      +- Exchange hashpartitioning(d_year#15800, i_brand#15853, i_brand_id#15852, 3000), ENSURE_REQUIREMENTS, [id=#16583]
         +- HashAggregate(keys=[d_year#15800, i_brand#15853, i_brand_id#15852], functions=[partial_sum(ss_ext_sales_price#15836)], output=[d_year#15800, i_brand#15853, i_brand_id#15852, sum#15874])
            +- Project [d_year#15800, ss_ext_sales_price#15836, i_brand_id#15852, i_brand#15853]
               +- BroadcastHashJoin [ss_sold_date_sk#15844L], [d_date_sk#15794L], Inner, BuildRight, false
                  :- Project [ss_ext_sales_price#15836, ss_sold_date_sk#15844L, i_brand_id#15852, i_brand#15853]
                  :  +- BroadcastHashJoin [ss_item_sk#15823L], [i_item_sk#15845L], Inner, BuildRight, false
                  :     :- Filter isnotnull(ss_item_sk#15823L)
                  :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#15823L,ss_ext_sales_price#15836,ss_sold_date_sk#15844L] Batched: true, DataFilters: [isnotnull(ss_item_sk#15823L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15844L), dynamicpruningexpression(ss_sold_date_sk#15844L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
                  :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#15872, 0, true, Project [d_date_sk#15794L, d_year#15800], [d_date_sk#15794L]
                  :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              +- Project [d_date_sk#15794L, d_year#15800]
                  :     :                 +- Filter ((((isnotnull(d_moy#15802) AND isnotnull(d_year#15800)) AND (d_moy#15802 = 11)) AND (d_year#15800 = 1998)) AND isnotnull(d_date_sk#15794L))
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15794L,d_year#15800,d_moy#15802] Batched: true, DataFilters: [isnotnull(d_moy#15802), isnotnull(d_year#15800), (d_moy#15802 = 11), (d_year#15800 = 1998), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16574]
                  :        +- Project [i_item_sk#15845L, i_brand_id#15852, i_brand#15853]
                  :           +- Filter ((isnotnull(i_manager_id#15865) AND (i_manager_id#15865 = 1)) AND isnotnull(i_item_sk#15845L))
                  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15845L,i_brand_id#15852,i_brand#15853,i_manager_id#15865] Batched: true, DataFilters: [isnotnull(i_manager_id#15865), (i_manager_id#15865 = 1), isnotnull(i_item_sk#15845L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_brand:string,i_manager_id:int>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16578]
                     +- Project [d_date_sk#15794L, d_year#15800]
                        +- Filter ((((isnotnull(d_moy#15802) AND isnotnull(d_year#15800)) AND (d_moy#15802 = 11)) AND (d_year#15800 = 1998)) AND isnotnull(d_date_sk#15794L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15794L,d_year#15800,d_moy#15802] Batched: true, DataFilters: [isnotnull(d_moy#15802), isnotnull(d_year#15800), (d_moy#15802 = 11), (d_year#15800 = 1998), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q53.sql
explain query: q53
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['avg_quarterly_sales ASC NULLS FIRST, 'sum_sales ASC NULLS FIRST, 'i_manufact_id ASC NULLS FIRST], true
      +- 'Project [*]
         +- 'Filter (CASE WHEN ('avg_quarterly_sales > 0) THEN ('abs(('sum_sales - 'avg_quarterly_sales)) / 'avg_quarterly_sales) ELSE null END > 0.1)
            +- 'SubqueryAlias tmp1
               +- 'Aggregate ['i_manufact_id, 'd_qoy], ['i_manufact_id, 'sum('ss_sales_price) AS sum_sales#15875, 'avg('sum('ss_sales_price)) windowspecdefinition('i_manufact_id, unspecifiedframe$()) AS avg_quarterly_sales#15876]
                  +- 'Filter (((('ss_item_sk = 'i_item_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('ss_store_sk = 's_store_sk)) AND ('d_month_seq IN (1212,(1212 + 1),(1212 + 2),(1212 + 3),(1212 + 4),(1212 + 5),(1212 + 6),(1212 + 7),(1212 + 8),(1212 + 9),(1212 + 10),(1212 + 11)) AND ((('i_category IN (Books,Children,Electronics) AND 'i_class IN (personal,portable,reference,self-help)) AND 'i_brand IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR (('i_category IN (Women,Music,Men) AND 'i_class IN (accessories,classical,fragrances,pants)) AND 'i_brand IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'UnresolvedRelation [item], [], false
                        :  :  +- 'UnresolvedRelation [store_sales], [], false
                        :  +- 'UnresolvedRelation [date_dim], [], false
                        +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
i_manufact_id: int, sum_sales: double, avg_quarterly_sales: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [avg_quarterly_sales#15876 ASC NULLS FIRST, sum_sales#15875 ASC NULLS FIRST, i_manufact_id#15890 ASC NULLS FIRST], true
      +- Project [i_manufact_id#15890, sum_sales#15875, avg_quarterly_sales#15876]
         +- Filter (CASE WHEN (avg_quarterly_sales#15876 > cast(0 as double)) THEN (abs((sum_sales#15875 - avg_quarterly_sales#15876), false) / avg_quarterly_sales#15876) ELSE cast(null as double) END > cast(0.1 as double))
            +- SubqueryAlias tmp1
               +- Project [i_manufact_id#15890, sum_sales#15875, avg_quarterly_sales#15876]
                  +- Project [i_manufact_id#15890, sum_sales#15875, _w0#15982, avg_quarterly_sales#15876, avg_quarterly_sales#15876]
                     +- Window [avg(_w0#15982) windowspecdefinition(i_manufact_id#15890, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#15876], [i_manufact_id#15890]
                        +- Aggregate [i_manufact_id#15890, d_qoy#15932], [i_manufact_id#15890, sum(ss_sales_price#15911) AS sum_sales#15875, sum(ss_sales_price#15911) AS _w0#15982]
                           +- Filter ((((ss_item_sk#15900L = i_item_sk#15877L) AND (ss_sold_date_sk#15921L = d_date_sk#15922L)) AND (ss_store_sk#15905L = s_store_sk#15950L)) AND (d_month_seq#15925 IN (1212,(1212 + 1),(1212 + 2),(1212 + 3),(1212 + 4),(1212 + 5),(1212 + 6),(1212 + 7),(1212 + 8),(1212 + 9),(1212 + 10),(1212 + 11)) AND (((i_category#15889 IN (Books,Children,Electronics) AND i_class#15887 IN (personal,portable,reference,self-help)) AND i_brand#15885 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#15889 IN (Women,Music,Men) AND i_class#15887 IN (accessories,classical,fragrances,pants)) AND i_brand#15885 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))
                              +- Join Inner
                                 :- Join Inner
                                 :  :- Join Inner
                                 :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                 :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15877L,i_item_id#15878,i_rec_start_date#15879,i_rec_end_date#15880,i_item_desc#15881,i_current_price#15882,i_wholesale_cost#15883,i_brand_id#15884,i_brand#15885,i_class_id#15886,i_class#15887,i_category_id#15888,i_category#15889,i_manufact_id#15890,i_manufact#15891,i_size#15892,i_formulation#15893,i_color#15894,i_units#15895,i_container#15896,i_manager_id#15897,i_product_name#15898] orc
                                 :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                 :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15899L,ss_item_sk#15900L,ss_customer_sk#15901L,ss_cdemo_sk#15902L,ss_hdemo_sk#15903L,ss_addr_sk#15904L,ss_store_sk#15905L,ss_promo_sk#15906L,ss_ticket_number#15907L,ss_quantity#15908,ss_wholesale_cost#15909,ss_list_price#15910,ss_sales_price#15911,ss_ext_discount_amt#15912,ss_ext_sales_price#15913,ss_ext_wholesale_cost#15914,ss_ext_list_price#15915,ss_ext_tax#15916,ss_coupon_amt#15917,ss_net_paid#15918,ss_net_paid_inc_tax#15919,ss_net_profit#15920,ss_sold_date_sk#15921L] orc
                                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15922L,d_date_id#15923,d_date#15924,d_month_seq#15925,d_week_seq#15926,d_quarter_seq#15927,d_year#15928,d_dow#15929,d_moy#15930,d_dom#15931,d_qoy#15932,d_fy_year#15933,d_fy_quarter_seq#15934,d_fy_week_seq#15935,d_day_name#15936,d_quarter_name#15937,d_holiday#15938,d_weekend#15939,d_following_holiday#15940,d_first_dom#15941,d_last_dom#15942,d_same_day_ly#15943,d_same_day_lq#15944,d_current_day#15945,... 4 more fields] orc
                                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15950L,s_store_id#15951,s_rec_start_date#15952,s_rec_end_date#15953,s_closed_date_sk#15954L,s_store_name#15955,s_number_employees#15956,s_floor_space#15957,s_hours#15958,s_manager#15959,s_market_id#15960,s_geography_class#15961,s_market_desc#15962,s_market_manager#15963,s_division_id#15964,s_division_name#15965,s_company_id#15966,s_company_name#15967,s_street_number#15968,s_street_name#15969,s_street_type#15970,s_suite_number#15971,s_city#15972,s_county#15973,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [avg_quarterly_sales#15876 ASC NULLS FIRST, sum_sales#15875 ASC NULLS FIRST, i_manufact_id#15890 ASC NULLS FIRST], true
      +- Project [i_manufact_id#15890, sum_sales#15875, avg_quarterly_sales#15876]
         +- Filter ((isnotnull(avg_quarterly_sales#15876) AND isnotnull(sum_sales#15875)) AND ((avg_quarterly_sales#15876 > 0.0) AND ((abs((sum_sales#15875 - avg_quarterly_sales#15876), false) / avg_quarterly_sales#15876) > 0.1)))
            +- Window [avg(_w0#15982) windowspecdefinition(i_manufact_id#15890, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#15876], [i_manufact_id#15890]
               +- Aggregate [i_manufact_id#15890, d_qoy#15932], [i_manufact_id#15890, sum(ss_sales_price#15911) AS sum_sales#15875, sum(ss_sales_price#15911) AS _w0#15982]
                  +- Project [i_manufact_id#15890, ss_sales_price#15911, d_qoy#15932]
                     +- Join Inner, (ss_store_sk#15905L = s_store_sk#15950L)
                        :- Project [i_manufact_id#15890, ss_store_sk#15905L, ss_sales_price#15911, d_qoy#15932]
                        :  +- Join Inner, (ss_sold_date_sk#15921L = d_date_sk#15922L)
                        :     :- Project [i_manufact_id#15890, ss_store_sk#15905L, ss_sales_price#15911, ss_sold_date_sk#15921L]
                        :     :  +- Join Inner, (ss_item_sk#15900L = i_item_sk#15877L)
                        :     :     :- Project [i_item_sk#15877L, i_manufact_id#15890]
                        :     :     :  +- Filter ((((i_category#15889 IN (Books,Children,Electronics) AND i_class#15887 IN (personal,portable,reference,self-help)) AND i_brand#15885 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#15889 IN (Women,Music,Men) AND i_class#15887 IN (accessories,classical,fragrances,pants)) AND i_brand#15885 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) AND isnotnull(i_item_sk#15877L))
                        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15877L,i_item_id#15878,i_rec_start_date#15879,i_rec_end_date#15880,i_item_desc#15881,i_current_price#15882,i_wholesale_cost#15883,i_brand_id#15884,i_brand#15885,i_class_id#15886,i_class#15887,i_category_id#15888,i_category#15889,i_manufact_id#15890,i_manufact#15891,i_size#15892,i_formulation#15893,i_color#15894,i_units#15895,i_container#15896,i_manager_id#15897,i_product_name#15898] orc
                        :     :     +- Project [ss_item_sk#15900L, ss_store_sk#15905L, ss_sales_price#15911, ss_sold_date_sk#15921L]
                        :     :        +- Filter (((isnotnull(ss_item_sk#15900L) AND isnotnull(ss_sold_date_sk#15921L)) AND isnotnull(ss_store_sk#15905L)) AND dynamicpruning#15986 [ss_sold_date_sk#15921L])
                        :     :           :  +- Project [d_date_sk#15922L, d_qoy#15932]
                        :     :           :     +- Filter (d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#15922L))
                        :     :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15922L,d_date_id#15923,d_date#15924,d_month_seq#15925,d_week_seq#15926,d_quarter_seq#15927,d_year#15928,d_dow#15929,d_moy#15930,d_dom#15931,d_qoy#15932,d_fy_year#15933,d_fy_quarter_seq#15934,d_fy_week_seq#15935,d_day_name#15936,d_quarter_name#15937,d_holiday#15938,d_weekend#15939,d_following_holiday#15940,d_first_dom#15941,d_last_dom#15942,d_same_day_ly#15943,d_same_day_lq#15944,d_current_day#15945,... 4 more fields] orc
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#15899L,ss_item_sk#15900L,ss_customer_sk#15901L,ss_cdemo_sk#15902L,ss_hdemo_sk#15903L,ss_addr_sk#15904L,ss_store_sk#15905L,ss_promo_sk#15906L,ss_ticket_number#15907L,ss_quantity#15908,ss_wholesale_cost#15909,ss_list_price#15910,ss_sales_price#15911,ss_ext_discount_amt#15912,ss_ext_sales_price#15913,ss_ext_wholesale_cost#15914,ss_ext_list_price#15915,ss_ext_tax#15916,ss_coupon_amt#15917,ss_net_paid#15918,ss_net_paid_inc_tax#15919,ss_net_profit#15920,ss_sold_date_sk#15921L] orc
                        :     +- Project [d_date_sk#15922L, d_qoy#15932]
                        :        +- Filter (d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#15922L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15922L,d_date_id#15923,d_date#15924,d_month_seq#15925,d_week_seq#15926,d_quarter_seq#15927,d_year#15928,d_dow#15929,d_moy#15930,d_dom#15931,d_qoy#15932,d_fy_year#15933,d_fy_quarter_seq#15934,d_fy_week_seq#15935,d_day_name#15936,d_quarter_name#15937,d_holiday#15938,d_weekend#15939,d_following_holiday#15940,d_first_dom#15941,d_last_dom#15942,d_same_day_ly#15943,d_same_day_lq#15944,d_current_day#15945,... 4 more fields] orc
                        +- Project [s_store_sk#15950L]
                           +- Filter isnotnull(s_store_sk#15950L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15950L,s_store_id#15951,s_rec_start_date#15952,s_rec_end_date#15953,s_closed_date_sk#15954L,s_store_name#15955,s_number_employees#15956,s_floor_space#15957,s_hours#15958,s_manager#15959,s_market_id#15960,s_geography_class#15961,s_market_desc#15962,s_market_manager#15963,s_division_id#15964,s_division_name#15965,s_company_id#15966,s_company_name#15967,s_street_number#15968,s_street_name#15969,s_street_type#15970,s_suite_number#15971,s_city#15972,s_county#15973,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[avg_quarterly_sales#15876 ASC NULLS FIRST,sum_sales#15875 ASC NULLS FIRST,i_manufact_id#15890 ASC NULLS FIRST], output=[i_manufact_id#15890,sum_sales#15875,avg_quarterly_sales#15876])
   +- Project [i_manufact_id#15890, sum_sales#15875, avg_quarterly_sales#15876]
      +- Filter ((isnotnull(avg_quarterly_sales#15876) AND isnotnull(sum_sales#15875)) AND ((avg_quarterly_sales#15876 > 0.0) AND ((abs((sum_sales#15875 - avg_quarterly_sales#15876), false) / avg_quarterly_sales#15876) > 0.1)))
         +- Window [avg(_w0#15982) windowspecdefinition(i_manufact_id#15890, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#15876], [i_manufact_id#15890]
            +- Sort [i_manufact_id#15890 ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(i_manufact_id#15890, 3000), ENSURE_REQUIREMENTS, [id=#16713]
                  +- HashAggregate(keys=[i_manufact_id#15890, d_qoy#15932], functions=[sum(ss_sales_price#15911)], output=[i_manufact_id#15890, sum_sales#15875, _w0#15982])
                     +- Exchange hashpartitioning(i_manufact_id#15890, d_qoy#15932, 3000), ENSURE_REQUIREMENTS, [id=#16710]
                        +- HashAggregate(keys=[i_manufact_id#15890, d_qoy#15932], functions=[partial_sum(ss_sales_price#15911)], output=[i_manufact_id#15890, d_qoy#15932, sum#15988])
                           +- Project [i_manufact_id#15890, ss_sales_price#15911, d_qoy#15932]
                              +- BroadcastHashJoin [ss_store_sk#15905L], [s_store_sk#15950L], Inner, BuildRight, false
                                 :- Project [i_manufact_id#15890, ss_store_sk#15905L, ss_sales_price#15911, d_qoy#15932]
                                 :  +- BroadcastHashJoin [ss_sold_date_sk#15921L], [d_date_sk#15922L], Inner, BuildRight, false
                                 :     :- Project [i_manufact_id#15890, ss_store_sk#15905L, ss_sales_price#15911, ss_sold_date_sk#15921L]
                                 :     :  +- BroadcastHashJoin [i_item_sk#15877L], [ss_item_sk#15900L], Inner, BuildLeft, false
                                 :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16697]
                                 :     :     :  +- Project [i_item_sk#15877L, i_manufact_id#15890]
                                 :     :     :     +- Filter ((((i_category#15889 IN (Books,Children,Electronics) AND i_class#15887 IN (personal,portable,reference,self-help)) AND i_brand#15885 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#15889 IN (Women,Music,Men) AND i_class#15887 IN (accessories,classical,fragrances,pants)) AND i_brand#15885 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) AND isnotnull(i_item_sk#15877L))
                                 :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#15877L,i_brand#15885,i_class#15887,i_category#15889,i_manufact_id#15890] Batched: true, DataFilters: [(((i_category#15889 IN (Books,Children,Electronics) AND i_class#15887 IN (personal,portable,refe..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(And(In(i_category, [Books,Children,Electronics]),In(i_class, [personal,portable,reference..., ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_class:string,i_category:string,i_manufact_id:int>
                                 :     :     +- Filter (isnotnull(ss_item_sk#15900L) AND isnotnull(ss_store_sk#15905L))
                                 :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#15900L,ss_store_sk#15905L,ss_sales_price#15911,ss_sold_date_sk#15921L] Batched: true, DataFilters: [isnotnull(ss_item_sk#15900L), isnotnull(ss_store_sk#15905L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#15921L), dynamicpruningexpression(ss_sold_date_sk#15921L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
                                 :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#15986, 0, true, Project [d_date_sk#15922L, d_qoy#15932], [d_date_sk#15922L]
                                 :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :                    +- Project [d_date_sk#15922L, d_qoy#15932]
                                 :     :                       +- Filter (d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#15922L))
                                 :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15922L,d_month_seq#15925,d_qoy#15932] Batched: true, DataFilters: [d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_month_seq, [1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_qoy:int>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16701]
                                 :        +- Project [d_date_sk#15922L, d_qoy#15932]
                                 :           +- Filter (d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#15922L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#15922L,d_month_seq#15925,d_qoy#15932] Batched: true, DataFilters: [d_month_seq#15925 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_month_seq, [1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_qoy:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#16705]
                                    +- Filter isnotnull(s_store_sk#15950L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#15950L] Batched: true, DataFilters: [isnotnull(s_store_sk#15950L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>

read query: spark_queries/q54.sql
explain query: q54
== Parsed Logical Plan ==
CTE [my_customers, my_revenue, segments]
:  :- 'SubqueryAlias my_customers
:  :  +- 'Distinct
:  :     +- 'Project ['c_customer_sk, 'c_current_addr_sk]
:  :        +- 'Filter (((('sold_date_sk = 'd_date_sk) AND ('item_sk = 'i_item_sk)) AND (('i_category = Jewelry) AND ('i_class = consignment))) AND ((('c_customer_sk = 'cs_or_ws_sales.customer_sk) AND ('d_moy = 3)) AND ('d_year = 1999)))
:  :           +- 'Join Inner
:  :              :- 'Join Inner
:  :              :  :- 'Join Inner
:  :              :  :  :- 'SubqueryAlias cs_or_ws_sales
:  :              :  :  :  +- 'Union false, false
:  :              :  :  :     :- 'Project ['cs_sold_date_sk AS sold_date_sk#15991, 'cs_bill_customer_sk AS customer_sk#15992, 'cs_item_sk AS item_sk#15993]
:  :              :  :  :     :  +- 'UnresolvedRelation [catalog_sales], [], false
:  :              :  :  :     +- 'Project ['ws_sold_date_sk AS sold_date_sk#15994, 'ws_bill_customer_sk AS customer_sk#15995, 'ws_item_sk AS item_sk#15996]
:  :              :  :  :        +- 'UnresolvedRelation [web_sales], [], false
:  :              :  :  +- 'UnresolvedRelation [item], [], false
:  :              :  +- 'UnresolvedRelation [date_dim], [], false
:  :              +- 'UnresolvedRelation [customer], [], false
:  :- 'SubqueryAlias my_revenue
:  :  +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum('ss_ext_sales_price) AS revenue#15997]
:  :     +- 'Filter (((('c_current_addr_sk = 'ca_address_sk) AND ('ca_county = 's_county)) AND ('ca_state = 's_state)) AND ((('ss_sold_date_sk = 'd_date_sk) AND ('c_customer_sk = 'ss_customer_sk)) AND (('d_month_seq >= scalar-subquery#15998 []) AND ('d_month_seq <= scalar-subquery#15999 []))))
:  :        :  :- 'Distinct
:  :        :  :  +- 'Project [unresolvedalias(('d_month_seq + 1), None)]
:  :        :  :     +- 'Filter (('d_year = 1999) AND ('d_moy = 3))
:  :        :  :        +- 'UnresolvedRelation [date_dim], [], false
:  :        :  +- 'Distinct
:  :        :     +- 'Project [unresolvedalias(('d_month_seq + 3), None)]
:  :        :        +- 'Filter (('d_year = 1999) AND ('d_moy = 3))
:  :        :           +- 'UnresolvedRelation [date_dim], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'Join Inner
:  :           :  :  :  :- 'UnresolvedRelation [my_customers], [], false
:  :           :  :  :  +- 'UnresolvedRelation [store_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [customer_address], [], false
:  :           :  +- 'UnresolvedRelation [store], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias segments
:     +- 'Project [cast(('revenue / 50) as int) AS segment#16000]
:        +- 'UnresolvedRelation [my_revenue], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['segment ASC NULLS FIRST, 'num_customers ASC NULLS FIRST], true
         +- 'Aggregate ['segment], ['segment, 'count(1) AS num_customers#15989, ('segment * 50) AS segment_base#15990]
            +- 'UnresolvedRelation [segments], [], false

== Analyzed Logical Plan ==
segment: int, num_customers: bigint, segment_base: int
WithCTE
:- CTERelationDef 31
:  +- SubqueryAlias my_customers
:     +- Distinct
:        +- Project [c_customer_sk#16120L, c_current_addr_sk#16124L]
:           +- Filter ((((sold_date_sk#15991L = d_date_sk#16092L) AND (item_sk#15993L = i_item_sk#16070L)) AND ((i_category#16082 = Jewelry) AND (i_class#16080 = consignment))) AND (((c_customer_sk#16120L = customer_sk#15992L) AND (d_moy#16100 = 3)) AND (d_year#16098 = 1999)))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- Join Inner
:                 :  :  :- SubqueryAlias cs_or_ws_sales
:                 :  :  :  +- Union false, false
:                 :  :  :     :- Project [cs_sold_date_sk#16035L AS sold_date_sk#15991L, cs_bill_customer_sk#16004L AS customer_sk#15992L, cs_item_sk#16016L AS item_sk#15993L]
:                 :  :  :     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                 :  :  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16002L,cs_ship_date_sk#16003L,cs_bill_customer_sk#16004L,cs_bill_cdemo_sk#16005L,cs_bill_hdemo_sk#16006L,cs_bill_addr_sk#16007L,cs_ship_customer_sk#16008L,cs_ship_cdemo_sk#16009L,cs_ship_hdemo_sk#16010L,cs_ship_addr_sk#16011L,cs_call_center_sk#16012L,cs_catalog_page_sk#16013L,cs_ship_mode_sk#16014L,cs_warehouse_sk#16015L,cs_item_sk#16016L,cs_promo_sk#16017L,cs_order_number#16018L,cs_quantity#16019,cs_wholesale_cost#16020,cs_list_price#16021,cs_sales_price#16022,cs_ext_discount_amt#16023,cs_ext_sales_price#16024,cs_ext_wholesale_cost#16025,... 10 more fields] orc
:                 :  :  :     +- Project [ws_sold_date_sk#16069L AS sold_date_sk#15994L, ws_bill_customer_sk#16039L AS customer_sk#15995L, ws_item_sk#16038L AS item_sk#15996L]
:                 :  :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                 :  :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#16036L,ws_ship_date_sk#16037L,ws_item_sk#16038L,ws_bill_customer_sk#16039L,ws_bill_cdemo_sk#16040L,ws_bill_hdemo_sk#16041L,ws_bill_addr_sk#16042L,ws_ship_customer_sk#16043L,ws_ship_cdemo_sk#16044L,ws_ship_hdemo_sk#16045L,ws_ship_addr_sk#16046L,ws_web_page_sk#16047L,ws_web_site_sk#16048L,ws_ship_mode_sk#16049L,ws_warehouse_sk#16050L,ws_promo_sk#16051L,ws_order_number#16052L,ws_quantity#16053,ws_wholesale_cost#16054,ws_list_price#16055,ws_sales_price#16056,ws_ext_discount_amt#16057,ws_ext_sales_price#16058,ws_ext_wholesale_cost#16059,... 10 more fields] orc
:                 :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16070L,i_item_id#16071,i_rec_start_date#16072,i_rec_end_date#16073,i_item_desc#16074,i_current_price#16075,i_wholesale_cost#16076,i_brand_id#16077,i_brand#16078,i_class_id#16079,i_class#16080,i_category_id#16081,i_category#16082,i_manufact_id#16083,i_manufact#16084,i_size#16085,i_formulation#16086,i_color#16087,i_units#16088,i_container#16089,i_manager_id#16090,i_product_name#16091] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_date_id#16093,d_date#16094,d_month_seq#16095,d_week_seq#16096,d_quarter_seq#16097,d_year#16098,d_dow#16099,d_moy#16100,d_dom#16101,d_qoy#16102,d_fy_year#16103,d_fy_quarter_seq#16104,d_fy_week_seq#16105,d_day_name#16106,d_quarter_name#16107,d_holiday#16108,d_weekend#16109,d_following_holiday#16110,d_first_dom#16111,d_last_dom#16112,d_same_day_ly#16113,d_same_day_lq#16114,d_current_day#16115,... 4 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#16120L,c_customer_id#16121,c_current_cdemo_sk#16122L,c_current_hdemo_sk#16123L,c_current_addr_sk#16124L,c_first_shipto_date_sk#16125L,c_first_sales_date_sk#16126L,c_salutation#16127,c_first_name#16128,c_last_name#16129,c_preferred_cust_flag#16130,c_birth_day#16131,c_birth_month#16132,c_birth_year#16133,c_birth_country#16134,c_login#16135,c_email_address#16136,c_last_review_date#16137] orc
:- CTERelationDef 32
:  +- SubqueryAlias my_revenue
:     +- Aggregate [c_customer_sk#16120L], [c_customer_sk#16120L, sum(ss_ext_sales_price#16152) AS revenue#15997]
:        +- Filter ((((c_current_addr_sk#16124L = ca_address_sk#16161L) AND (ca_county#16168 = s_county#16197)) AND (ca_state#16169 = s_state#16198)) AND (((ss_sold_date_sk#16160L = d_date_sk#16203L) AND (c_customer_sk#16120L = ss_customer_sk#16140L)) AND ((d_month_seq#16206 >= scalar-subquery#15998 []) AND (d_month_seq#16206 <= scalar-subquery#15999 []))))
:           :  :- Distinct
:           :  :  +- Project [(d_month_seq#16234 + 1) AS (d_month_seq + 1)#16259]
:           :  :     +- Filter ((d_year#16237 = 1999) AND (d_moy#16239 = 3))
:           :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16231L,d_date_id#16232,d_date#16233,d_month_seq#16234,d_week_seq#16235,d_quarter_seq#16236,d_year#16237,d_dow#16238,d_moy#16239,d_dom#16240,d_qoy#16241,d_fy_year#16242,d_fy_quarter_seq#16243,d_fy_week_seq#16244,d_day_name#16245,d_quarter_name#16246,d_holiday#16247,d_weekend#16248,d_following_holiday#16249,d_first_dom#16250,d_last_dom#16251,d_same_day_ly#16252,d_same_day_lq#16253,d_current_day#16254,... 4 more fields] orc
:           :  +- Distinct
:           :     +- Project [(d_month_seq#16263 + 3) AS (d_month_seq + 3)#16288]
:           :        +- Filter ((d_year#16266 = 1999) AND (d_moy#16268 = 3))
:           :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16260L,d_date_id#16261,d_date#16262,d_month_seq#16263,d_week_seq#16264,d_quarter_seq#16265,d_year#16266,d_dow#16267,d_moy#16268,d_dom#16269,d_qoy#16270,d_fy_year#16271,d_fy_quarter_seq#16272,d_fy_week_seq#16273,d_day_name#16274,d_quarter_name#16275,d_holiday#16276,d_weekend#16277,d_following_holiday#16278,d_first_dom#16279,d_last_dom#16280,d_same_day_ly#16281,d_same_day_lq#16282,d_current_day#16283,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- SubqueryAlias my_customers
:              :  :  :  :  +- CTERelationRef 31, true, [c_customer_sk#16120L, c_current_addr_sk#16124L]
:              :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16138L,ss_item_sk#16139L,ss_customer_sk#16140L,ss_cdemo_sk#16141L,ss_hdemo_sk#16142L,ss_addr_sk#16143L,ss_store_sk#16144L,ss_promo_sk#16145L,ss_ticket_number#16146L,ss_quantity#16147,ss_wholesale_cost#16148,ss_list_price#16149,ss_sales_price#16150,ss_ext_discount_amt#16151,ss_ext_sales_price#16152,ss_ext_wholesale_cost#16153,ss_ext_list_price#16154,ss_ext_tax#16155,ss_coupon_amt#16156,ss_net_paid#16157,ss_net_paid_inc_tax#16158,ss_net_profit#16159,ss_sold_date_sk#16160L] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16161L,ca_address_id#16162,ca_street_number#16163,ca_street_name#16164,ca_street_type#16165,ca_suite_number#16166,ca_city#16167,ca_county#16168,ca_state#16169,ca_zip#16170,ca_country#16171,ca_gmt_offset#16172,ca_location_type#16173] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#16174L,s_store_id#16175,s_rec_start_date#16176,s_rec_end_date#16177,s_closed_date_sk#16178L,s_store_name#16179,s_number_employees#16180,s_floor_space#16181,s_hours#16182,s_manager#16183,s_market_id#16184,s_geography_class#16185,s_market_desc#16186,s_market_manager#16187,s_division_id#16188,s_division_name#16189,s_company_id#16190,s_company_name#16191,s_street_number#16192,s_street_name#16193,s_street_type#16194,s_suite_number#16195,s_city#16196,s_county#16197,... 5 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16203L,d_date_id#16204,d_date#16205,d_month_seq#16206,d_week_seq#16207,d_quarter_seq#16208,d_year#16209,d_dow#16210,d_moy#16211,d_dom#16212,d_qoy#16213,d_fy_year#16214,d_fy_quarter_seq#16215,d_fy_week_seq#16216,d_day_name#16217,d_quarter_name#16218,d_holiday#16219,d_weekend#16220,d_following_holiday#16221,d_first_dom#16222,d_last_dom#16223,d_same_day_ly#16224,d_same_day_lq#16225,d_current_day#16226,... 4 more fields] orc
:- CTERelationDef 33
:  +- SubqueryAlias segments
:     +- Project [cast((revenue#15997 / cast(50 as double)) as int) AS segment#16000]
:        +- SubqueryAlias my_revenue
:           +- CTERelationRef 32, true, [c_customer_sk#16120L, revenue#15997]
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [segment#16000 ASC NULLS FIRST, num_customers#15989L ASC NULLS FIRST], true
         +- Aggregate [segment#16000], [segment#16000, count(1) AS num_customers#15989L, (segment#16000 * 50) AS segment_base#15990]
            +- SubqueryAlias segments
               +- CTERelationRef 33, true, [segment#16000]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [segment#16000 ASC NULLS FIRST, num_customers#15989L ASC NULLS FIRST], true
      +- Aggregate [segment#16000], [segment#16000, count(1) AS num_customers#15989L, (segment#16000 * 50) AS segment_base#15990]
         +- Aggregate [c_customer_sk#16120L], [cast((sum(ss_ext_sales_price#16152) / 50.0) as int) AS segment#16000]
            +- Project [c_customer_sk#16120L, ss_ext_sales_price#16152]
               +- Join Inner, (c_customer_sk#16120L = ss_customer_sk#16140L)
                  :- Project [c_customer_sk#16120L]
                  :  +- Join Inner, (c_current_addr_sk#16124L = ca_address_sk#16161L)
                  :     :- Project [ca_address_sk#16161L]
                  :     :  +- Join Inner, ((ca_county#16168 = s_county#16197) AND (ca_state#16169 = s_state#16198))
                  :     :     :- Project [ca_address_sk#16161L, ca_county#16168, ca_state#16169]
                  :     :     :  +- Filter (isnotnull(ca_address_sk#16161L) AND (isnotnull(ca_county#16168) AND isnotnull(ca_state#16169)))
                  :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16161L,ca_address_id#16162,ca_street_number#16163,ca_street_name#16164,ca_street_type#16165,ca_suite_number#16166,ca_city#16167,ca_county#16168,ca_state#16169,ca_zip#16170,ca_country#16171,ca_gmt_offset#16172,ca_location_type#16173] orc
                  :     :     +- Project [s_county#16197, s_state#16198]
                  :     :        +- Filter (isnotnull(s_county#16197) AND isnotnull(s_state#16198))
                  :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#16174L,s_store_id#16175,s_rec_start_date#16176,s_rec_end_date#16177,s_closed_date_sk#16178L,s_store_name#16179,s_number_employees#16180,s_floor_space#16181,s_hours#16182,s_manager#16183,s_market_id#16184,s_geography_class#16185,s_market_desc#16186,s_market_manager#16187,s_division_id#16188,s_division_name#16189,s_company_id#16190,s_company_name#16191,s_street_number#16192,s_street_name#16193,s_street_type#16194,s_suite_number#16195,s_city#16196,s_county#16197,... 5 more fields] orc
                  :     +- Aggregate [c_customer_sk#16120L, c_current_addr_sk#16124L], [c_customer_sk#16120L, c_current_addr_sk#16124L]
                  :        +- Project [c_customer_sk#16120L, c_current_addr_sk#16124L]
                  :           +- Join Inner, (c_customer_sk#16120L = customer_sk#15992L)
                  :              :- Project [customer_sk#15992L]
                  :              :  +- Join Inner, (item_sk#15993L = i_item_sk#16070L)
                  :              :     :- Project [customer_sk#15992L, item_sk#15993L]
                  :              :     :  +- Join Inner, (sold_date_sk#15991L = d_date_sk#16092L)
                  :              :     :     :- Union false, false
                  :              :     :     :  :- Project [cs_sold_date_sk#16035L AS sold_date_sk#15991L, cs_bill_customer_sk#16004L AS customer_sk#15992L, cs_item_sk#16016L AS item_sk#15993L]
                  :              :     :     :  :  +- Filter (((isnotnull(cs_item_sk#16016L) AND isnotnull(cs_sold_date_sk#16035L)) AND isnotnull(cs_bill_customer_sk#16004L)) AND dynamicpruning#16293 [cs_sold_date_sk#16035L])
                  :              :     :     :  :     :  +- Project [d_date_sk#16092L]
                  :              :     :     :  :     :     +- Filter (((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND ((d_moy#16100 = 3) AND (d_year#16098 = 1999))) AND isnotnull(d_date_sk#16092L))
                  :              :     :     :  :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_date_id#16093,d_date#16094,d_month_seq#16095,d_week_seq#16096,d_quarter_seq#16097,d_year#16098,d_dow#16099,d_moy#16100,d_dom#16101,d_qoy#16102,d_fy_year#16103,d_fy_quarter_seq#16104,d_fy_week_seq#16105,d_day_name#16106,d_quarter_name#16107,d_holiday#16108,d_weekend#16109,d_following_holiday#16110,d_first_dom#16111,d_last_dom#16112,d_same_day_ly#16113,d_same_day_lq#16114,d_current_day#16115,... 4 more fields] orc
                  :              :     :     :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16002L,cs_ship_date_sk#16003L,cs_bill_customer_sk#16004L,cs_bill_cdemo_sk#16005L,cs_bill_hdemo_sk#16006L,cs_bill_addr_sk#16007L,cs_ship_customer_sk#16008L,cs_ship_cdemo_sk#16009L,cs_ship_hdemo_sk#16010L,cs_ship_addr_sk#16011L,cs_call_center_sk#16012L,cs_catalog_page_sk#16013L,cs_ship_mode_sk#16014L,cs_warehouse_sk#16015L,cs_item_sk#16016L,cs_promo_sk#16017L,cs_order_number#16018L,cs_quantity#16019,cs_wholesale_cost#16020,cs_list_price#16021,cs_sales_price#16022,cs_ext_discount_amt#16023,cs_ext_sales_price#16024,cs_ext_wholesale_cost#16025,... 10 more fields] orc
                  :              :     :     :  +- Project [ws_sold_date_sk#16069L AS sold_date_sk#15994L, ws_bill_customer_sk#16039L AS customer_sk#15995L, ws_item_sk#16038L AS item_sk#15996L]
                  :              :     :     :     +- Filter (((isnotnull(ws_item_sk#16038L) AND isnotnull(ws_sold_date_sk#16069L)) AND isnotnull(ws_bill_customer_sk#16039L)) AND dynamicpruning#16293 [ws_sold_date_sk#16069L])
                  :              :     :     :        :  +- Project [d_date_sk#16092L]
                  :              :     :     :        :     +- Filter (((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND ((d_moy#16100 = 3) AND (d_year#16098 = 1999))) AND isnotnull(d_date_sk#16092L))
                  :              :     :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_date_id#16093,d_date#16094,d_month_seq#16095,d_week_seq#16096,d_quarter_seq#16097,d_year#16098,d_dow#16099,d_moy#16100,d_dom#16101,d_qoy#16102,d_fy_year#16103,d_fy_quarter_seq#16104,d_fy_week_seq#16105,d_day_name#16106,d_quarter_name#16107,d_holiday#16108,d_weekend#16109,d_following_holiday#16110,d_first_dom#16111,d_last_dom#16112,d_same_day_ly#16113,d_same_day_lq#16114,d_current_day#16115,... 4 more fields] orc
                  :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#16036L,ws_ship_date_sk#16037L,ws_item_sk#16038L,ws_bill_customer_sk#16039L,ws_bill_cdemo_sk#16040L,ws_bill_hdemo_sk#16041L,ws_bill_addr_sk#16042L,ws_ship_customer_sk#16043L,ws_ship_cdemo_sk#16044L,ws_ship_hdemo_sk#16045L,ws_ship_addr_sk#16046L,ws_web_page_sk#16047L,ws_web_site_sk#16048L,ws_ship_mode_sk#16049L,ws_warehouse_sk#16050L,ws_promo_sk#16051L,ws_order_number#16052L,ws_quantity#16053,ws_wholesale_cost#16054,ws_list_price#16055,ws_sales_price#16056,ws_ext_discount_amt#16057,ws_ext_sales_price#16058,ws_ext_wholesale_cost#16059,... 10 more fields] orc
                  :              :     :     +- Project [d_date_sk#16092L]
                  :              :     :        +- Filter (((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND ((d_moy#16100 = 3) AND (d_year#16098 = 1999))) AND isnotnull(d_date_sk#16092L))
                  :              :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_date_id#16093,d_date#16094,d_month_seq#16095,d_week_seq#16096,d_quarter_seq#16097,d_year#16098,d_dow#16099,d_moy#16100,d_dom#16101,d_qoy#16102,d_fy_year#16103,d_fy_quarter_seq#16104,d_fy_week_seq#16105,d_day_name#16106,d_quarter_name#16107,d_holiday#16108,d_weekend#16109,d_following_holiday#16110,d_first_dom#16111,d_last_dom#16112,d_same_day_ly#16113,d_same_day_lq#16114,d_current_day#16115,... 4 more fields] orc
                  :              :     +- Project [i_item_sk#16070L]
                  :              :        +- Filter (((isnotnull(i_category#16082) AND isnotnull(i_class#16080)) AND ((i_category#16082 = Jewelry) AND (i_class#16080 = consignment))) AND isnotnull(i_item_sk#16070L))
                  :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16070L,i_item_id#16071,i_rec_start_date#16072,i_rec_end_date#16073,i_item_desc#16074,i_current_price#16075,i_wholesale_cost#16076,i_brand_id#16077,i_brand#16078,i_class_id#16079,i_class#16080,i_category_id#16081,i_category#16082,i_manufact_id#16083,i_manufact#16084,i_size#16085,i_formulation#16086,i_color#16087,i_units#16088,i_container#16089,i_manager_id#16090,i_product_name#16091] orc
                  :              +- Project [c_customer_sk#16120L, c_current_addr_sk#16124L]
                  :                 +- Filter (isnotnull(c_customer_sk#16120L) AND isnotnull(c_current_addr_sk#16124L))
                  :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#16120L,c_customer_id#16121,c_current_cdemo_sk#16122L,c_current_hdemo_sk#16123L,c_current_addr_sk#16124L,c_first_shipto_date_sk#16125L,c_first_sales_date_sk#16126L,c_salutation#16127,c_first_name#16128,c_last_name#16129,c_preferred_cust_flag#16130,c_birth_day#16131,c_birth_month#16132,c_birth_year#16133,c_birth_country#16134,c_login#16135,c_email_address#16136,c_last_review_date#16137] orc
                  +- Project [ss_customer_sk#16140L, ss_ext_sales_price#16152]
                     +- Join Inner, (ss_sold_date_sk#16160L = d_date_sk#16203L)
                        :- Project [ss_customer_sk#16140L, ss_ext_sales_price#16152, ss_sold_date_sk#16160L]
                        :  +- Filter ((isnotnull(ss_customer_sk#16140L) AND isnotnull(ss_sold_date_sk#16160L)) AND dynamicpruning#16294 [ss_sold_date_sk#16160L])
                        :     :  +- Project [d_date_sk#16203L]
                        :     :     +- Filter ((isnotnull(d_month_seq#16206) AND ((d_month_seq#16206 >= scalar-subquery#15998 []) AND (d_month_seq#16206 <= scalar-subquery#15999 []))) AND isnotnull(d_date_sk#16203L))
                        :     :        :  :- Aggregate [(d_month_seq + 1)#16259], [(d_month_seq + 1)#16259]
                        :     :        :  :  +- Project [(d_month_seq#16234 + 1) AS (d_month_seq + 1)#16259]
                        :     :        :  :     +- Filter ((isnotnull(d_year#16237) AND isnotnull(d_moy#16239)) AND ((d_year#16237 = 1999) AND (d_moy#16239 = 3)))
                        :     :        :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16231L,d_date_id#16232,d_date#16233,d_month_seq#16234,d_week_seq#16235,d_quarter_seq#16236,d_year#16237,d_dow#16238,d_moy#16239,d_dom#16240,d_qoy#16241,d_fy_year#16242,d_fy_quarter_seq#16243,d_fy_week_seq#16244,d_day_name#16245,d_quarter_name#16246,d_holiday#16247,d_weekend#16248,d_following_holiday#16249,d_first_dom#16250,d_last_dom#16251,d_same_day_ly#16252,d_same_day_lq#16253,d_current_day#16254,... 4 more fields] orc
                        :     :        :  +- Aggregate [(d_month_seq + 3)#16288], [(d_month_seq + 3)#16288]
                        :     :        :     +- Project [(d_month_seq#16263 + 3) AS (d_month_seq + 3)#16288]
                        :     :        :        +- Filter ((isnotnull(d_year#16266) AND isnotnull(d_moy#16268)) AND ((d_year#16266 = 1999) AND (d_moy#16268 = 3)))
                        :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16260L,d_date_id#16261,d_date#16262,d_month_seq#16263,d_week_seq#16264,d_quarter_seq#16265,d_year#16266,d_dow#16267,d_moy#16268,d_dom#16269,d_qoy#16270,d_fy_year#16271,d_fy_quarter_seq#16272,d_fy_week_seq#16273,d_day_name#16274,d_quarter_name#16275,d_holiday#16276,d_weekend#16277,d_following_holiday#16278,d_first_dom#16279,d_last_dom#16280,d_same_day_ly#16281,d_same_day_lq#16282,d_current_day#16283,... 4 more fields] orc
                        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16203L,d_date_id#16204,d_date#16205,d_month_seq#16206,d_week_seq#16207,d_quarter_seq#16208,d_year#16209,d_dow#16210,d_moy#16211,d_dom#16212,d_qoy#16213,d_fy_year#16214,d_fy_quarter_seq#16215,d_fy_week_seq#16216,d_day_name#16217,d_quarter_name#16218,d_holiday#16219,d_weekend#16220,d_following_holiday#16221,d_first_dom#16222,d_last_dom#16223,d_same_day_ly#16224,d_same_day_lq#16225,d_current_day#16226,... 4 more fields] orc
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16138L,ss_item_sk#16139L,ss_customer_sk#16140L,ss_cdemo_sk#16141L,ss_hdemo_sk#16142L,ss_addr_sk#16143L,ss_store_sk#16144L,ss_promo_sk#16145L,ss_ticket_number#16146L,ss_quantity#16147,ss_wholesale_cost#16148,ss_list_price#16149,ss_sales_price#16150,ss_ext_discount_amt#16151,ss_ext_sales_price#16152,ss_ext_wholesale_cost#16153,ss_ext_list_price#16154,ss_ext_tax#16155,ss_coupon_amt#16156,ss_net_paid#16157,ss_net_paid_inc_tax#16158,ss_net_profit#16159,ss_sold_date_sk#16160L] orc
                        +- Project [d_date_sk#16203L]
                           +- Filter ((isnotnull(d_month_seq#16206) AND ((d_month_seq#16206 >= scalar-subquery#15998 []) AND (d_month_seq#16206 <= scalar-subquery#15999 []))) AND isnotnull(d_date_sk#16203L))
                              :  :- Aggregate [(d_month_seq + 1)#16259], [(d_month_seq + 1)#16259]
                              :  :  +- Project [(d_month_seq#16234 + 1) AS (d_month_seq + 1)#16259]
                              :  :     +- Filter ((isnotnull(d_year#16237) AND isnotnull(d_moy#16239)) AND ((d_year#16237 = 1999) AND (d_moy#16239 = 3)))
                              :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16231L,d_date_id#16232,d_date#16233,d_month_seq#16234,d_week_seq#16235,d_quarter_seq#16236,d_year#16237,d_dow#16238,d_moy#16239,d_dom#16240,d_qoy#16241,d_fy_year#16242,d_fy_quarter_seq#16243,d_fy_week_seq#16244,d_day_name#16245,d_quarter_name#16246,d_holiday#16247,d_weekend#16248,d_following_holiday#16249,d_first_dom#16250,d_last_dom#16251,d_same_day_ly#16252,d_same_day_lq#16253,d_current_day#16254,... 4 more fields] orc
                              :  +- Aggregate [(d_month_seq + 3)#16288], [(d_month_seq + 3)#16288]
                              :     +- Project [(d_month_seq#16263 + 3) AS (d_month_seq + 3)#16288]
                              :        +- Filter ((isnotnull(d_year#16266) AND isnotnull(d_moy#16268)) AND ((d_year#16266 = 1999) AND (d_moy#16268 = 3)))
                              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16260L,d_date_id#16261,d_date#16262,d_month_seq#16263,d_week_seq#16264,d_quarter_seq#16265,d_year#16266,d_dow#16267,d_moy#16268,d_dom#16269,d_qoy#16270,d_fy_year#16271,d_fy_quarter_seq#16272,d_fy_week_seq#16273,d_day_name#16274,d_quarter_name#16275,d_holiday#16276,d_weekend#16277,d_following_holiday#16278,d_first_dom#16279,d_last_dom#16280,d_same_day_ly#16281,d_same_day_lq#16282,d_current_day#16283,... 4 more fields] orc
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16203L,d_date_id#16204,d_date#16205,d_month_seq#16206,d_week_seq#16207,d_quarter_seq#16208,d_year#16209,d_dow#16210,d_moy#16211,d_dom#16212,d_qoy#16213,d_fy_year#16214,d_fy_quarter_seq#16215,d_fy_week_seq#16216,d_day_name#16217,d_quarter_name#16218,d_holiday#16219,d_weekend#16220,d_following_holiday#16221,d_first_dom#16222,d_last_dom#16223,d_same_day_ly#16224,d_same_day_lq#16225,d_current_day#16226,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[segment#16000 ASC NULLS FIRST,num_customers#15989L ASC NULLS FIRST], output=[segment#16000,num_customers#15989L,segment_base#15990])
   +- HashAggregate(keys=[segment#16000], functions=[count(1)], output=[segment#16000, num_customers#15989L, segment_base#15990])
      +- Exchange hashpartitioning(segment#16000, 3000), ENSURE_REQUIREMENTS, [id=#17032]
         +- HashAggregate(keys=[segment#16000], functions=[partial_count(1)], output=[segment#16000, count#16296L])
            +- HashAggregate(keys=[c_customer_sk#16120L], functions=[sum(ss_ext_sales_price#16152)], output=[segment#16000])
               +- HashAggregate(keys=[c_customer_sk#16120L], functions=[partial_sum(ss_ext_sales_price#16152)], output=[c_customer_sk#16120L, sum#16298])
                  +- Project [c_customer_sk#16120L, ss_ext_sales_price#16152]
                     +- SortMergeJoin [c_customer_sk#16120L], [ss_customer_sk#16140L], Inner
                        :- Sort [c_customer_sk#16120L ASC NULLS FIRST], false, 0
                        :  +- Exchange hashpartitioning(c_customer_sk#16120L, 3000), ENSURE_REQUIREMENTS, [id=#17022]
                        :     +- Project [c_customer_sk#16120L]
                        :        +- SortMergeJoin [ca_address_sk#16161L], [c_current_addr_sk#16124L], Inner
                        :           :- Sort [ca_address_sk#16161L ASC NULLS FIRST], false, 0
                        :           :  +- Exchange hashpartitioning(ca_address_sk#16161L, 3000), ENSURE_REQUIREMENTS, [id=#17011]
                        :           :     +- Project [ca_address_sk#16161L]
                        :           :        +- BroadcastHashJoin [ca_county#16168, ca_state#16169], [s_county#16197, s_state#16198], Inner, BuildRight, false
                        :           :           :- Filter ((isnotnull(ca_address_sk#16161L) AND isnotnull(ca_county#16168)) AND isnotnull(ca_state#16169))
                        :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16161L,ca_county#16168,ca_state#16169] Batched: true, DataFilters: [isnotnull(ca_address_sk#16161L), isnotnull(ca_county#16168), isnotnull(ca_state#16169)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:bigint,ca_county:string,ca_state:string>
                        :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, false], input[1, string, false]),false), [id=#16989]
                        :           :              +- Filter (isnotnull(s_county#16197) AND isnotnull(s_state#16198))
                        :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_county#16197,s_state#16198] Batched: true, DataFilters: [isnotnull(s_county#16197), isnotnull(s_state#16198)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_county), IsNotNull(s_state)], ReadSchema: struct<s_county:string,s_state:string>
                        :           +- Sort [c_current_addr_sk#16124L ASC NULLS FIRST], false, 0
                        :              +- Exchange hashpartitioning(c_current_addr_sk#16124L, 3000), ENSURE_REQUIREMENTS, [id=#17012]
                        :                 +- HashAggregate(keys=[c_customer_sk#16120L, c_current_addr_sk#16124L], functions=[], output=[c_customer_sk#16120L, c_current_addr_sk#16124L])
                        :                    +- HashAggregate(keys=[c_customer_sk#16120L, c_current_addr_sk#16124L], functions=[], output=[c_customer_sk#16120L, c_current_addr_sk#16124L])
                        :                       +- Project [c_customer_sk#16120L, c_current_addr_sk#16124L]
                        :                          +- SortMergeJoin [customer_sk#15992L], [c_customer_sk#16120L], Inner
                        :                             :- Sort [customer_sk#15992L ASC NULLS FIRST], false, 0
                        :                             :  +- Exchange hashpartitioning(customer_sk#15992L, 3000), ENSURE_REQUIREMENTS, [id=#17001]
                        :                             :     +- Project [customer_sk#15992L]
                        :                             :        +- BroadcastHashJoin [item_sk#15993L], [i_item_sk#16070L], Inner, BuildRight, false
                        :                             :           :- Project [customer_sk#15992L, item_sk#15993L]
                        :                             :           :  +- BroadcastHashJoin [sold_date_sk#15991L], [d_date_sk#16092L], Inner, BuildRight, false
                        :                             :           :     :- Union
                        :                             :           :     :  :- Project [cs_sold_date_sk#16035L AS sold_date_sk#15991L, cs_bill_customer_sk#16004L AS customer_sk#15992L, cs_item_sk#16016L AS item_sk#15993L]
                        :                             :           :     :  :  +- Filter (isnotnull(cs_item_sk#16016L) AND isnotnull(cs_bill_customer_sk#16004L))
                        :                             :           :     :  :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#16004L,cs_item_sk#16016L,cs_sold_date_sk#16035L] Batched: true, DataFilters: [isnotnull(cs_item_sk#16016L), isnotnull(cs_bill_customer_sk#16004L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#16035L), dynamicpruningexpression(cs_sold_date_sk#16035L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint>
                        :                             :           :     :  :           +- SubqueryAdaptiveBroadcast dynamicpruning#16293, 0, true, Project [d_date_sk#16092L], [d_date_sk#16092L]
                        :                             :           :     :  :              +- AdaptiveSparkPlan isFinalPlan=false
                        :                             :           :     :  :                 +- Project [d_date_sk#16092L]
                        :                             :           :     :  :                    +- Filter ((((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND (d_moy#16100 = 3)) AND (d_year#16098 = 1999)) AND isnotnull(d_date_sk#16092L))
                        :                             :           :     :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_year#16098,d_moy#16100] Batched: true, DataFilters: [isnotnull(d_moy#16100), isnotnull(d_year#16098), (d_moy#16100 = 3), (d_year#16098 = 1999), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,3), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                        :                             :           :     :  +- Project [ws_sold_date_sk#16069L AS sold_date_sk#15994L, ws_bill_customer_sk#16039L AS customer_sk#15995L, ws_item_sk#16038L AS item_sk#15996L]
                        :                             :           :     :     +- Filter (isnotnull(ws_item_sk#16038L) AND isnotnull(ws_bill_customer_sk#16039L))
                        :                             :           :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#16038L,ws_bill_customer_sk#16039L,ws_sold_date_sk#16069L] Batched: true, DataFilters: [isnotnull(ws_item_sk#16038L), isnotnull(ws_bill_customer_sk#16039L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#16069L), dynamicpruningexpression(ws_sold_date_sk#16069L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_customer_sk:bigint>
                        :                             :           :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#16293, 0, true, Project [d_date_sk#16092L], [d_date_sk#16092L]
                        :                             :           :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                        :                             :           :     :                    +- Project [d_date_sk#16092L]
                        :                             :           :     :                       +- Filter ((((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND (d_moy#16100 = 3)) AND (d_year#16098 = 1999)) AND isnotnull(d_date_sk#16092L))
                        :                             :           :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_year#16098,d_moy#16100] Batched: true, DataFilters: [isnotnull(d_moy#16100), isnotnull(d_year#16098), (d_moy#16100 = 3), (d_year#16098 = 1999), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,3), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                        :                             :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16992]
                        :                             :           :        +- Project [d_date_sk#16092L]
                        :                             :           :           +- Filter ((((isnotnull(d_moy#16100) AND isnotnull(d_year#16098)) AND (d_moy#16100 = 3)) AND (d_year#16098 = 1999)) AND isnotnull(d_date_sk#16092L))
                        :                             :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16092L,d_year#16098,d_moy#16100] Batched: true, DataFilters: [isnotnull(d_moy#16100), isnotnull(d_year#16098), (d_moy#16100 = 3), (d_year#16098 = 1999), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,3), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                        :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#16996]
                        :                             :              +- Project [i_item_sk#16070L]
                        :                             :                 +- Filter ((((isnotnull(i_category#16082) AND isnotnull(i_class#16080)) AND (i_category#16082 = Jewelry)) AND (i_class#16080 = consignment)) AND isnotnull(i_item_sk#16070L))
                        :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16070L,i_class#16080,i_category#16082] Batched: true, DataFilters: [isnotnull(i_category#16082), isnotnull(i_class#16080), (i_category#16082 = Jewelry), (i_class#16..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), IsNotNull(i_class), EqualTo(i_category,Jewelry), EqualTo(i_class,consignm..., ReadSchema: struct<i_item_sk:bigint,i_class:string,i_category:string>
                        :                             +- Sort [c_customer_sk#16120L ASC NULLS FIRST], false, 0
                        :                                +- Exchange hashpartitioning(c_customer_sk#16120L, 3000), ENSURE_REQUIREMENTS, [id=#17002]
                        :                                   +- Filter (isnotnull(c_customer_sk#16120L) AND isnotnull(c_current_addr_sk#16124L))
                        :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#16120L,c_current_addr_sk#16124L] Batched: true, DataFilters: [isnotnull(c_customer_sk#16120L), isnotnull(c_current_addr_sk#16124L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
                        +- Sort [ss_customer_sk#16140L ASC NULLS FIRST], false, 0
                           +- Exchange hashpartitioning(ss_customer_sk#16140L, 3000), ENSURE_REQUIREMENTS, [id=#17023]
                              +- Project [ss_customer_sk#16140L, ss_ext_sales_price#16152]
                                 +- BroadcastHashJoin [ss_sold_date_sk#16160L], [d_date_sk#16203L], Inner, BuildRight, false
                                    :- Filter isnotnull(ss_customer_sk#16140L)
                                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#16140L,ss_ext_sales_price#16152,ss_sold_date_sk#16160L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#16140L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#16160L), dynamicpruningexpression(ss_sold_date_sk#16160L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_ext_sales_price:double>
                                    :        +- SubqueryAdaptiveBroadcast dynamicpruning#16294, 0, true, Project [d_date_sk#16203L], [d_date_sk#16203L]
                                    :           +- AdaptiveSparkPlan isFinalPlan=false
                                    :              +- Project [d_date_sk#16203L]
                                    :                 +- Filter (((isnotnull(d_month_seq#16206) AND (d_month_seq#16206 >= Subquery subquery#15998, [id=#16896])) AND (d_month_seq#16206 <= Subquery subquery#15999, [id=#16909])) AND isnotnull(d_date_sk#16203L))
                                    :                    :  :- Subquery subquery#15998, [id=#16896]
                                    :                    :  :  +- AdaptiveSparkPlan isFinalPlan=false
                                    :                    :  :     +- HashAggregate(keys=[(d_month_seq + 1)#16259], functions=[], output=[(d_month_seq + 1)#16259])
                                    :                    :  :        +- Exchange hashpartitioning((d_month_seq + 1)#16259, 3000), ENSURE_REQUIREMENTS, [id=#16894]
                                    :                    :  :           +- HashAggregate(keys=[(d_month_seq + 1)#16259], functions=[], output=[(d_month_seq + 1)#16259])
                                    :                    :  :              +- Project [(d_month_seq#16234 + 1) AS (d_month_seq + 1)#16259]
                                    :                    :  :                 +- Filter (((isnotnull(d_year#16237) AND isnotnull(d_moy#16239)) AND (d_year#16237 = 1999)) AND (d_moy#16239 = 3))
                                    :                    :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#16234,d_year#16237,d_moy#16239] Batched: true, DataFilters: [isnotnull(d_year#16237), isnotnull(d_moy#16239), (d_year#16237 = 1999), (d_moy#16239 = 3)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                                    :                    :  +- Subquery subquery#15999, [id=#16909]
                                    :                    :     +- AdaptiveSparkPlan isFinalPlan=false
                                    :                    :        +- HashAggregate(keys=[(d_month_seq + 3)#16288], functions=[], output=[(d_month_seq + 3)#16288])
                                    :                    :           +- Exchange hashpartitioning((d_month_seq + 3)#16288, 3000), ENSURE_REQUIREMENTS, [id=#16907]
                                    :                    :              +- HashAggregate(keys=[(d_month_seq + 3)#16288], functions=[], output=[(d_month_seq + 3)#16288])
                                    :                    :                 +- Project [(d_month_seq#16263 + 3) AS (d_month_seq + 3)#16288]
                                    :                    :                    +- Filter (((isnotnull(d_year#16266) AND isnotnull(d_moy#16268)) AND (d_year#16266 = 1999)) AND (d_moy#16268 = 3))
                                    :                    :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#16263,d_year#16266,d_moy#16268] Batched: true, DataFilters: [isnotnull(d_year#16266), isnotnull(d_moy#16268), (d_year#16266 = 1999), (d_moy#16268 = 3)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16203L,d_month_seq#16206] Batched: true, DataFilters: [isnotnull(d_month_seq#16206), isnotnull(d_date_sk#16203L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17017]
                                       +- Project [d_date_sk#16203L]
                                          +- Filter (((isnotnull(d_month_seq#16206) AND (d_month_seq#16206 >= Subquery subquery#15998, [id=#16926])) AND (d_month_seq#16206 <= Subquery subquery#15999, [id=#16939])) AND isnotnull(d_date_sk#16203L))
                                             :  :- Subquery subquery#15998, [id=#16926]
                                             :  :  +- AdaptiveSparkPlan isFinalPlan=false
                                             :  :     +- HashAggregate(keys=[(d_month_seq + 1)#16259], functions=[], output=[(d_month_seq + 1)#16259])
                                             :  :        +- Exchange hashpartitioning((d_month_seq + 1)#16259, 3000), ENSURE_REQUIREMENTS, [id=#16924]
                                             :  :           +- HashAggregate(keys=[(d_month_seq + 1)#16259], functions=[], output=[(d_month_seq + 1)#16259])
                                             :  :              +- Project [(d_month_seq#16234 + 1) AS (d_month_seq + 1)#16259]
                                             :  :                 +- Filter (((isnotnull(d_year#16237) AND isnotnull(d_moy#16239)) AND (d_year#16237 = 1999)) AND (d_moy#16239 = 3))
                                             :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#16234,d_year#16237,d_moy#16239] Batched: true, DataFilters: [isnotnull(d_year#16237), isnotnull(d_moy#16239), (d_year#16237 = 1999), (d_moy#16239 = 3)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                                             :  +- Subquery subquery#15999, [id=#16939]
                                             :     +- AdaptiveSparkPlan isFinalPlan=false
                                             :        +- HashAggregate(keys=[(d_month_seq + 3)#16288], functions=[], output=[(d_month_seq + 3)#16288])
                                             :           +- Exchange hashpartitioning((d_month_seq + 3)#16288, 3000), ENSURE_REQUIREMENTS, [id=#16937]
                                             :              +- HashAggregate(keys=[(d_month_seq + 3)#16288], functions=[], output=[(d_month_seq + 3)#16288])
                                             :                 +- Project [(d_month_seq#16263 + 3) AS (d_month_seq + 3)#16288]
                                             :                    +- Filter (((isnotnull(d_year#16266) AND isnotnull(d_moy#16268)) AND (d_year#16266 = 1999)) AND (d_moy#16268 = 3))
                                             :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#16263,d_year#16266,d_moy#16268] Batched: true, DataFilters: [isnotnull(d_year#16266), isnotnull(d_moy#16268), (d_year#16266 = 1999), (d_moy#16268 = 3)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,3)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>
                                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16203L,d_month_seq#16206] Batched: true, DataFilters: [isnotnull(d_month_seq#16206), isnotnull(d_date_sk#16203L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>

read query: spark_queries/q55.sql
explain query: q55
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['ext_price DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true
      +- 'Aggregate ['i_brand, 'i_brand_id], ['i_brand_id AS brand_id#16299, 'i_brand AS brand#16300, 'sum('ss_ext_sales_price) AS ext_price#16301]
         +- 'Filter (((('d_date_sk = 'ss_sold_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND ('i_manager_id = 36)) AND (('d_moy = 12) AND ('d_year = 2001)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [store_sales], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
brand_id: int, brand: string, ext_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ext_price#16301 DESC NULLS LAST, brand_id#16299 ASC NULLS FIRST], true
      +- Aggregate [i_brand#16361, i_brand_id#16360], [i_brand_id#16360 AS brand_id#16299, i_brand#16361 AS brand#16300, sum(ss_ext_sales_price#16344) AS ext_price#16301]
         +- Filter ((((d_date_sk#16302L = ss_sold_date_sk#16352L) AND (ss_item_sk#16331L = i_item_sk#16353L)) AND (i_manager_id#16373 = 36)) AND ((d_moy#16310 = 12) AND (d_year#16308 = 2001)))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16302L,d_date_id#16303,d_date#16304,d_month_seq#16305,d_week_seq#16306,d_quarter_seq#16307,d_year#16308,d_dow#16309,d_moy#16310,d_dom#16311,d_qoy#16312,d_fy_year#16313,d_fy_quarter_seq#16314,d_fy_week_seq#16315,d_day_name#16316,d_quarter_name#16317,d_holiday#16318,d_weekend#16319,d_following_holiday#16320,d_first_dom#16321,d_last_dom#16322,d_same_day_ly#16323,d_same_day_lq#16324,d_current_day#16325,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16330L,ss_item_sk#16331L,ss_customer_sk#16332L,ss_cdemo_sk#16333L,ss_hdemo_sk#16334L,ss_addr_sk#16335L,ss_store_sk#16336L,ss_promo_sk#16337L,ss_ticket_number#16338L,ss_quantity#16339,ss_wholesale_cost#16340,ss_list_price#16341,ss_sales_price#16342,ss_ext_discount_amt#16343,ss_ext_sales_price#16344,ss_ext_wholesale_cost#16345,ss_ext_list_price#16346,ss_ext_tax#16347,ss_coupon_amt#16348,ss_net_paid#16349,ss_net_paid_inc_tax#16350,ss_net_profit#16351,ss_sold_date_sk#16352L] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16353L,i_item_id#16354,i_rec_start_date#16355,i_rec_end_date#16356,i_item_desc#16357,i_current_price#16358,i_wholesale_cost#16359,i_brand_id#16360,i_brand#16361,i_class_id#16362,i_class#16363,i_category_id#16364,i_category#16365,i_manufact_id#16366,i_manufact#16367,i_size#16368,i_formulation#16369,i_color#16370,i_units#16371,i_container#16372,i_manager_id#16373,i_product_name#16374] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [ext_price#16301 DESC NULLS LAST, brand_id#16299 ASC NULLS FIRST], true
      +- Aggregate [i_brand#16361, i_brand_id#16360], [i_brand_id#16360 AS brand_id#16299, i_brand#16361 AS brand#16300, sum(ss_ext_sales_price#16344) AS ext_price#16301]
         +- Project [ss_ext_sales_price#16344, i_brand_id#16360, i_brand#16361]
            +- Join Inner, (d_date_sk#16302L = ss_sold_date_sk#16352L)
               :- Project [ss_ext_sales_price#16344, ss_sold_date_sk#16352L, i_brand_id#16360, i_brand#16361]
               :  +- Join Inner, (ss_item_sk#16331L = i_item_sk#16353L)
               :     :- Project [ss_item_sk#16331L, ss_ext_sales_price#16344, ss_sold_date_sk#16352L]
               :     :  +- Filter ((isnotnull(ss_sold_date_sk#16352L) AND isnotnull(ss_item_sk#16331L)) AND dynamicpruning#16379 [ss_sold_date_sk#16352L])
               :     :     :  +- Project [d_date_sk#16302L]
               :     :     :     +- Filter (((isnotnull(d_moy#16310) AND isnotnull(d_year#16308)) AND ((d_moy#16310 = 12) AND (d_year#16308 = 2001))) AND isnotnull(d_date_sk#16302L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16302L,d_date_id#16303,d_date#16304,d_month_seq#16305,d_week_seq#16306,d_quarter_seq#16307,d_year#16308,d_dow#16309,d_moy#16310,d_dom#16311,d_qoy#16312,d_fy_year#16313,d_fy_quarter_seq#16314,d_fy_week_seq#16315,d_day_name#16316,d_quarter_name#16317,d_holiday#16318,d_weekend#16319,d_following_holiday#16320,d_first_dom#16321,d_last_dom#16322,d_same_day_ly#16323,d_same_day_lq#16324,d_current_day#16325,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16330L,ss_item_sk#16331L,ss_customer_sk#16332L,ss_cdemo_sk#16333L,ss_hdemo_sk#16334L,ss_addr_sk#16335L,ss_store_sk#16336L,ss_promo_sk#16337L,ss_ticket_number#16338L,ss_quantity#16339,ss_wholesale_cost#16340,ss_list_price#16341,ss_sales_price#16342,ss_ext_discount_amt#16343,ss_ext_sales_price#16344,ss_ext_wholesale_cost#16345,ss_ext_list_price#16346,ss_ext_tax#16347,ss_coupon_amt#16348,ss_net_paid#16349,ss_net_paid_inc_tax#16350,ss_net_profit#16351,ss_sold_date_sk#16352L] orc
               :     +- Project [i_item_sk#16353L, i_brand_id#16360, i_brand#16361]
               :        +- Filter ((isnotnull(i_manager_id#16373) AND (i_manager_id#16373 = 36)) AND isnotnull(i_item_sk#16353L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16353L,i_item_id#16354,i_rec_start_date#16355,i_rec_end_date#16356,i_item_desc#16357,i_current_price#16358,i_wholesale_cost#16359,i_brand_id#16360,i_brand#16361,i_class_id#16362,i_class#16363,i_category_id#16364,i_category#16365,i_manufact_id#16366,i_manufact#16367,i_size#16368,i_formulation#16369,i_color#16370,i_units#16371,i_container#16372,i_manager_id#16373,i_product_name#16374] orc
               +- Project [d_date_sk#16302L]
                  +- Filter (((isnotnull(d_moy#16310) AND isnotnull(d_year#16308)) AND ((d_moy#16310 = 12) AND (d_year#16308 = 2001))) AND isnotnull(d_date_sk#16302L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16302L,d_date_id#16303,d_date#16304,d_month_seq#16305,d_week_seq#16306,d_quarter_seq#16307,d_year#16308,d_dow#16309,d_moy#16310,d_dom#16311,d_qoy#16312,d_fy_year#16313,d_fy_quarter_seq#16314,d_fy_week_seq#16315,d_day_name#16316,d_quarter_name#16317,d_holiday#16318,d_weekend#16319,d_following_holiday#16320,d_first_dom#16321,d_last_dom#16322,d_same_day_ly#16323,d_same_day_lq#16324,d_current_day#16325,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ext_price#16301 DESC NULLS LAST,brand_id#16299 ASC NULLS FIRST], output=[brand_id#16299,brand#16300,ext_price#16301])
   +- HashAggregate(keys=[i_brand#16361, i_brand_id#16360], functions=[sum(ss_ext_sales_price#16344)], output=[brand_id#16299, brand#16300, ext_price#16301])
      +- Exchange hashpartitioning(i_brand#16361, i_brand_id#16360, 3000), ENSURE_REQUIREMENTS, [id=#17117]
         +- HashAggregate(keys=[i_brand#16361, i_brand_id#16360], functions=[partial_sum(ss_ext_sales_price#16344)], output=[i_brand#16361, i_brand_id#16360, sum#16381])
            +- Project [ss_ext_sales_price#16344, i_brand_id#16360, i_brand#16361]
               +- BroadcastHashJoin [ss_sold_date_sk#16352L], [d_date_sk#16302L], Inner, BuildRight, false
                  :- Project [ss_ext_sales_price#16344, ss_sold_date_sk#16352L, i_brand_id#16360, i_brand#16361]
                  :  +- BroadcastHashJoin [ss_item_sk#16331L], [i_item_sk#16353L], Inner, BuildRight, false
                  :     :- Filter isnotnull(ss_item_sk#16331L)
                  :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#16331L,ss_ext_sales_price#16344,ss_sold_date_sk#16352L] Batched: true, DataFilters: [isnotnull(ss_item_sk#16331L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#16352L), dynamicpruningexpression(ss_sold_date_sk#16352L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
                  :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#16379, 0, true, Project [d_date_sk#16302L], [d_date_sk#16302L]
                  :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              +- Project [d_date_sk#16302L]
                  :     :                 +- Filter ((((isnotnull(d_moy#16310) AND isnotnull(d_year#16308)) AND (d_moy#16310 = 12)) AND (d_year#16308 = 2001)) AND isnotnull(d_date_sk#16302L))
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16302L,d_year#16308,d_moy#16310] Batched: true, DataFilters: [isnotnull(d_moy#16310), isnotnull(d_year#16308), (d_moy#16310 = 12), (d_year#16308 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17108]
                  :        +- Project [i_item_sk#16353L, i_brand_id#16360, i_brand#16361]
                  :           +- Filter ((isnotnull(i_manager_id#16373) AND (i_manager_id#16373 = 36)) AND isnotnull(i_item_sk#16353L))
                  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16353L,i_brand_id#16360,i_brand#16361,i_manager_id#16373] Batched: true, DataFilters: [isnotnull(i_manager_id#16373), (i_manager_id#16373 = 36), isnotnull(i_item_sk#16353L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,36), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_brand:string,i_manager_id:int>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17112]
                     +- Project [d_date_sk#16302L]
                        +- Filter ((((isnotnull(d_moy#16310) AND isnotnull(d_year#16308)) AND (d_moy#16310 = 12)) AND (d_year#16308 = 2001)) AND isnotnull(d_date_sk#16302L))
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16302L,d_year#16308,d_moy#16310] Batched: true, DataFilters: [isnotnull(d_moy#16310), isnotnull(d_year#16308), (d_moy#16310 = 12), (d_year#16308 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>

read query: spark_queries/q56.sql
explain query: q56
== Parsed Logical Plan ==
CTE [ss, cs, ws]
:  :- 'SubqueryAlias ss
:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ss_ext_sales_price) AS total_sales#16383]
:  :     +- 'Filter ((('i_item_id IN (list#16384 []) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_sold_date_sk = 'd_date_sk) AND ('d_year = 2001))) AND ((('d_moy = 1) AND ('ss_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -8)))
:  :        :  +- 'Project ['i_item_id]
:  :        :     +- 'Filter 'i_color IN (orchid,chiffon,lace)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  :- 'SubqueryAlias cs
:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('cs_ext_sales_price) AS total_sales#16385]
:  :     +- 'Filter ((('i_item_id IN (list#16386 []) AND ('cs_item_sk = 'i_item_sk)) AND (('cs_sold_date_sk = 'd_date_sk) AND ('d_year = 2000))) AND ((('d_moy = 1) AND ('cs_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -8)))
:  :        :  +- 'Project ['i_item_id]
:  :        :     +- 'Filter 'i_color IN (orchid,chiffon,lace)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  +- 'SubqueryAlias ws
:     +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ws_ext_sales_price) AS total_sales#16387]
:        +- 'Filter ((('i_item_id IN (list#16388 []) AND ('ws_item_sk = 'i_item_sk)) AND (('ws_sold_date_sk = 'd_date_sk) AND ('d_year = 2000))) AND ((('d_moy = 1) AND ('ws_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -8)))
:           :  +- 'Project ['i_item_id]
:           :     +- 'Filter 'i_color IN (orchid,chiffon,lace)
:           :        +- 'UnresolvedRelation [item], [], false
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'UnresolvedRelation [web_sales], [], false
:              :  :  +- 'UnresolvedRelation [date_dim], [], false
:              :  +- 'UnresolvedRelation [customer_address], [], false
:              +- 'UnresolvedRelation [item], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['total_sales ASC NULLS FIRST], true
         +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('total_sales) AS total_sales#16382]
            +- 'SubqueryAlias tmp1
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [*]
                  :  :  +- 'UnresolvedRelation [ss], [], false
                  :  +- 'Project [*]
                  :     +- 'UnresolvedRelation [cs], [], false
                  +- 'Project [*]
                     +- 'UnresolvedRelation [ws], [], false

== Analyzed Logical Plan ==
i_item_id: string, total_sales: double
WithCTE
:- CTERelationDef 34
:  +- SubqueryAlias ss
:     +- Aggregate [i_item_id#16454], [i_item_id#16454, sum(ss_ext_sales_price#16403) AS total_sales#16383]
:        +- Filter (((i_item_id#16454 IN (list#16384 []) AND (ss_item_sk#16390L = i_item_sk#16453L)) AND ((ss_sold_date_sk#16411L = d_date_sk#16412L) AND (d_year#16418 = 2001))) AND (((d_moy#16420 = 1) AND (ss_addr_sk#16394L = ca_address_sk#16440L)) AND (ca_gmt_offset#16451 = cast(-8 as double))))
:           :  +- Project [i_item_id#16670]
:           :     +- Filter i_color#16686 IN (orchid,chiffon,lace)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16669L,i_item_id#16670,i_rec_start_date#16671,i_rec_end_date#16672,i_item_desc#16673,i_current_price#16674,i_wholesale_cost#16675,i_brand_id#16676,i_brand#16677,i_class_id#16678,i_class#16679,i_category_id#16680,i_category#16681,i_manufact_id#16682,i_manufact#16683,i_size#16684,i_formulation#16685,i_color#16686,i_units#16687,i_container#16688,i_manager_id#16689,i_product_name#16690] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16389L,ss_item_sk#16390L,ss_customer_sk#16391L,ss_cdemo_sk#16392L,ss_hdemo_sk#16393L,ss_addr_sk#16394L,ss_store_sk#16395L,ss_promo_sk#16396L,ss_ticket_number#16397L,ss_quantity#16398,ss_wholesale_cost#16399,ss_list_price#16400,ss_sales_price#16401,ss_ext_discount_amt#16402,ss_ext_sales_price#16403,ss_ext_wholesale_cost#16404,ss_ext_list_price#16405,ss_ext_tax#16406,ss_coupon_amt#16407,ss_net_paid#16408,ss_net_paid_inc_tax#16409,ss_net_profit#16410,ss_sold_date_sk#16411L] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16412L,d_date_id#16413,d_date#16414,d_month_seq#16415,d_week_seq#16416,d_quarter_seq#16417,d_year#16418,d_dow#16419,d_moy#16420,d_dom#16421,d_qoy#16422,d_fy_year#16423,d_fy_quarter_seq#16424,d_fy_week_seq#16425,d_day_name#16426,d_quarter_name#16427,d_holiday#16428,d_weekend#16429,d_following_holiday#16430,d_first_dom#16431,d_last_dom#16432,d_same_day_ly#16433,d_same_day_lq#16434,d_current_day#16435,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16440L,ca_address_id#16441,ca_street_number#16442,ca_street_name#16443,ca_street_type#16444,ca_suite_number#16445,ca_city#16446,ca_county#16447,ca_state#16448,ca_zip#16449,ca_country#16450,ca_gmt_offset#16451,ca_location_type#16452] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16453L,i_item_id#16454,i_rec_start_date#16455,i_rec_end_date#16456,i_item_desc#16457,i_current_price#16458,i_wholesale_cost#16459,i_brand_id#16460,i_brand#16461,i_class_id#16462,i_class#16463,i_category_id#16464,i_category#16465,i_manufact_id#16466,i_manufact#16467,i_size#16468,i_formulation#16469,i_color#16470,i_units#16471,i_container#16472,i_manager_id#16473,i_product_name#16474] orc
:- CTERelationDef 35
:  +- SubqueryAlias cs
:     +- Aggregate [i_item_id#16551], [i_item_id#16551, sum(cs_ext_sales_price#16497) AS total_sales#16385]
:        +- Filter (((i_item_id#16551 IN (list#16386 []) AND (cs_item_sk#16489L = i_item_sk#16550L)) AND ((cs_sold_date_sk#16508L = d_date_sk#16509L) AND (d_year#16515 = 2000))) AND (((d_moy#16517 = 1) AND (cs_bill_addr_sk#16480L = ca_address_sk#16537L)) AND (ca_gmt_offset#16548 = cast(-8 as double))))
:           :  +- Project [i_item_id#16692]
:           :     +- Filter i_color#16708 IN (orchid,chiffon,lace)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16691L,i_item_id#16692,i_rec_start_date#16693,i_rec_end_date#16694,i_item_desc#16695,i_current_price#16696,i_wholesale_cost#16697,i_brand_id#16698,i_brand#16699,i_class_id#16700,i_class#16701,i_category_id#16702,i_category#16703,i_manufact_id#16704,i_manufact#16705,i_size#16706,i_formulation#16707,i_color#16708,i_units#16709,i_container#16710,i_manager_id#16711,i_product_name#16712] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16475L,cs_ship_date_sk#16476L,cs_bill_customer_sk#16477L,cs_bill_cdemo_sk#16478L,cs_bill_hdemo_sk#16479L,cs_bill_addr_sk#16480L,cs_ship_customer_sk#16481L,cs_ship_cdemo_sk#16482L,cs_ship_hdemo_sk#16483L,cs_ship_addr_sk#16484L,cs_call_center_sk#16485L,cs_catalog_page_sk#16486L,cs_ship_mode_sk#16487L,cs_warehouse_sk#16488L,cs_item_sk#16489L,cs_promo_sk#16490L,cs_order_number#16491L,cs_quantity#16492,cs_wholesale_cost#16493,cs_list_price#16494,cs_sales_price#16495,cs_ext_discount_amt#16496,cs_ext_sales_price#16497,cs_ext_wholesale_cost#16498,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16509L,d_date_id#16510,d_date#16511,d_month_seq#16512,d_week_seq#16513,d_quarter_seq#16514,d_year#16515,d_dow#16516,d_moy#16517,d_dom#16518,d_qoy#16519,d_fy_year#16520,d_fy_quarter_seq#16521,d_fy_week_seq#16522,d_day_name#16523,d_quarter_name#16524,d_holiday#16525,d_weekend#16526,d_following_holiday#16527,d_first_dom#16528,d_last_dom#16529,d_same_day_ly#16530,d_same_day_lq#16531,d_current_day#16532,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16537L,ca_address_id#16538,ca_street_number#16539,ca_street_name#16540,ca_street_type#16541,ca_suite_number#16542,ca_city#16543,ca_county#16544,ca_state#16545,ca_zip#16546,ca_country#16547,ca_gmt_offset#16548,ca_location_type#16549] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16550L,i_item_id#16551,i_rec_start_date#16552,i_rec_end_date#16553,i_item_desc#16554,i_current_price#16555,i_wholesale_cost#16556,i_brand_id#16557,i_brand#16558,i_class_id#16559,i_class#16560,i_category_id#16561,i_category#16562,i_manufact_id#16563,i_manufact#16564,i_size#16565,i_formulation#16566,i_color#16567,i_units#16568,i_container#16569,i_manager_id#16570,i_product_name#16571] orc
:- CTERelationDef 36
:  +- SubqueryAlias ws
:     +- Aggregate [i_item_id#16648], [i_item_id#16648, sum(ws_ext_sales_price#16594) AS total_sales#16387]
:        +- Filter (((i_item_id#16648 IN (list#16388 []) AND (ws_item_sk#16574L = i_item_sk#16647L)) AND ((ws_sold_date_sk#16605L = d_date_sk#16606L) AND (d_year#16612 = 2000))) AND (((d_moy#16614 = 1) AND (ws_bill_addr_sk#16578L = ca_address_sk#16634L)) AND (ca_gmt_offset#16645 = cast(-8 as double))))
:           :  +- Project [i_item_id#16714]
:           :     +- Filter i_color#16730 IN (orchid,chiffon,lace)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16713L,i_item_id#16714,i_rec_start_date#16715,i_rec_end_date#16716,i_item_desc#16717,i_current_price#16718,i_wholesale_cost#16719,i_brand_id#16720,i_brand#16721,i_class_id#16722,i_class#16723,i_category_id#16724,i_category#16725,i_manufact_id#16726,i_manufact#16727,i_size#16728,i_formulation#16729,i_color#16730,i_units#16731,i_container#16732,i_manager_id#16733,i_product_name#16734] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#16572L,ws_ship_date_sk#16573L,ws_item_sk#16574L,ws_bill_customer_sk#16575L,ws_bill_cdemo_sk#16576L,ws_bill_hdemo_sk#16577L,ws_bill_addr_sk#16578L,ws_ship_customer_sk#16579L,ws_ship_cdemo_sk#16580L,ws_ship_hdemo_sk#16581L,ws_ship_addr_sk#16582L,ws_web_page_sk#16583L,ws_web_site_sk#16584L,ws_ship_mode_sk#16585L,ws_warehouse_sk#16586L,ws_promo_sk#16587L,ws_order_number#16588L,ws_quantity#16589,ws_wholesale_cost#16590,ws_list_price#16591,ws_sales_price#16592,ws_ext_discount_amt#16593,ws_ext_sales_price#16594,ws_ext_wholesale_cost#16595,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16606L,d_date_id#16607,d_date#16608,d_month_seq#16609,d_week_seq#16610,d_quarter_seq#16611,d_year#16612,d_dow#16613,d_moy#16614,d_dom#16615,d_qoy#16616,d_fy_year#16617,d_fy_quarter_seq#16618,d_fy_week_seq#16619,d_day_name#16620,d_quarter_name#16621,d_holiday#16622,d_weekend#16623,d_following_holiday#16624,d_first_dom#16625,d_last_dom#16626,d_same_day_ly#16627,d_same_day_lq#16628,d_current_day#16629,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16634L,ca_address_id#16635,ca_street_number#16636,ca_street_name#16637,ca_street_type#16638,ca_suite_number#16639,ca_city#16640,ca_county#16641,ca_state#16642,ca_zip#16643,ca_country#16644,ca_gmt_offset#16645,ca_location_type#16646] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16647L,i_item_id#16648,i_rec_start_date#16649,i_rec_end_date#16650,i_item_desc#16651,i_current_price#16652,i_wholesale_cost#16653,i_brand_id#16654,i_brand#16655,i_class_id#16656,i_class#16657,i_category_id#16658,i_category#16659,i_manufact_id#16660,i_manufact#16661,i_size#16662,i_formulation#16663,i_color#16664,i_units#16665,i_container#16666,i_manager_id#16667,i_product_name#16668] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [total_sales#16382 ASC NULLS FIRST], true
         +- Aggregate [i_item_id#16454], [i_item_id#16454, sum(total_sales#16383) AS total_sales#16382]
            +- SubqueryAlias tmp1
               +- Union false, false
                  :- Union false, false
                  :  :- Project [i_item_id#16454, total_sales#16383]
                  :  :  +- SubqueryAlias ss
                  :  :     +- CTERelationRef 34, true, [i_item_id#16454, total_sales#16383]
                  :  +- Project [i_item_id#16551, total_sales#16385]
                  :     +- SubqueryAlias cs
                  :        +- CTERelationRef 35, true, [i_item_id#16551, total_sales#16385]
                  +- Project [i_item_id#16648, total_sales#16387]
                     +- SubqueryAlias ws
                        +- CTERelationRef 36, true, [i_item_id#16648, total_sales#16387]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [total_sales#16382 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#16454], [i_item_id#16454, sum(total_sales#16383) AS total_sales#16382]
         +- Union false, false
            :- Aggregate [i_item_id#16454], [i_item_id#16454, sum(ss_ext_sales_price#16403) AS total_sales#16383]
            :  +- Project [ss_ext_sales_price#16403, i_item_id#16454]
            :     +- Join Inner, (ss_item_sk#16390L = i_item_sk#16453L)
            :        :- Project [ss_item_sk#16390L, ss_ext_sales_price#16403]
            :        :  +- Join Inner, (ss_addr_sk#16394L = ca_address_sk#16440L)
            :        :     :- Project [ss_item_sk#16390L, ss_addr_sk#16394L, ss_ext_sales_price#16403]
            :        :     :  +- Join Inner, (ss_sold_date_sk#16411L = d_date_sk#16412L)
            :        :     :     :- Project [ss_item_sk#16390L, ss_addr_sk#16394L, ss_ext_sales_price#16403, ss_sold_date_sk#16411L]
            :        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#16411L) AND isnotnull(ss_addr_sk#16394L)) AND isnotnull(ss_item_sk#16390L)) AND dynamicpruning#16741 [ss_sold_date_sk#16411L])
            :        :     :     :     :  +- Project [d_date_sk#16412L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#16418) AND isnotnull(d_moy#16420)) AND ((d_year#16418 = 2001) AND (d_moy#16420 = 1))) AND isnotnull(d_date_sk#16412L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16412L,d_date_id#16413,d_date#16414,d_month_seq#16415,d_week_seq#16416,d_quarter_seq#16417,d_year#16418,d_dow#16419,d_moy#16420,d_dom#16421,d_qoy#16422,d_fy_year#16423,d_fy_quarter_seq#16424,d_fy_week_seq#16425,d_day_name#16426,d_quarter_name#16427,d_holiday#16428,d_weekend#16429,d_following_holiday#16430,d_first_dom#16431,d_last_dom#16432,d_same_day_ly#16433,d_same_day_lq#16434,d_current_day#16435,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#16389L,ss_item_sk#16390L,ss_customer_sk#16391L,ss_cdemo_sk#16392L,ss_hdemo_sk#16393L,ss_addr_sk#16394L,ss_store_sk#16395L,ss_promo_sk#16396L,ss_ticket_number#16397L,ss_quantity#16398,ss_wholesale_cost#16399,ss_list_price#16400,ss_sales_price#16401,ss_ext_discount_amt#16402,ss_ext_sales_price#16403,ss_ext_wholesale_cost#16404,ss_ext_list_price#16405,ss_ext_tax#16406,ss_coupon_amt#16407,ss_net_paid#16408,ss_net_paid_inc_tax#16409,ss_net_profit#16410,ss_sold_date_sk#16411L] orc
            :        :     :     +- Project [d_date_sk#16412L]
            :        :     :        +- Filter (((isnotnull(d_year#16418) AND isnotnull(d_moy#16420)) AND ((d_year#16418 = 2001) AND (d_moy#16420 = 1))) AND isnotnull(d_date_sk#16412L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16412L,d_date_id#16413,d_date#16414,d_month_seq#16415,d_week_seq#16416,d_quarter_seq#16417,d_year#16418,d_dow#16419,d_moy#16420,d_dom#16421,d_qoy#16422,d_fy_year#16423,d_fy_quarter_seq#16424,d_fy_week_seq#16425,d_day_name#16426,d_quarter_name#16427,d_holiday#16428,d_weekend#16429,d_following_holiday#16430,d_first_dom#16431,d_last_dom#16432,d_same_day_ly#16433,d_same_day_lq#16434,d_current_day#16435,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#16440L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#16451) AND (ca_gmt_offset#16451 = -8.0)) AND isnotnull(ca_address_sk#16440L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16440L,ca_address_id#16441,ca_street_number#16442,ca_street_name#16443,ca_street_type#16444,ca_suite_number#16445,ca_city#16446,ca_county#16447,ca_state#16448,ca_zip#16449,ca_country#16450,ca_gmt_offset#16451,ca_location_type#16452] orc
            :        +- Join LeftSemi, (i_item_id#16454 = i_item_id#16670)
            :           :- Project [i_item_sk#16453L, i_item_id#16454]
            :           :  +- Filter isnotnull(i_item_sk#16453L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16453L,i_item_id#16454,i_rec_start_date#16455,i_rec_end_date#16456,i_item_desc#16457,i_current_price#16458,i_wholesale_cost#16459,i_brand_id#16460,i_brand#16461,i_class_id#16462,i_class#16463,i_category_id#16464,i_category#16465,i_manufact_id#16466,i_manufact#16467,i_size#16468,i_formulation#16469,i_color#16470,i_units#16471,i_container#16472,i_manager_id#16473,i_product_name#16474] orc
            :           +- Project [i_item_id#16670]
            :              +- Filter i_color#16686 IN (orchid,chiffon,lace)
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16669L,i_item_id#16670,i_rec_start_date#16671,i_rec_end_date#16672,i_item_desc#16673,i_current_price#16674,i_wholesale_cost#16675,i_brand_id#16676,i_brand#16677,i_class_id#16678,i_class#16679,i_category_id#16680,i_category#16681,i_manufact_id#16682,i_manufact#16683,i_size#16684,i_formulation#16685,i_color#16686,i_units#16687,i_container#16688,i_manager_id#16689,i_product_name#16690] orc
            :- Aggregate [i_item_id#16551], [i_item_id#16551, sum(cs_ext_sales_price#16497) AS total_sales#16385]
            :  +- Project [cs_ext_sales_price#16497, i_item_id#16551]
            :     +- Join Inner, (cs_item_sk#16489L = i_item_sk#16550L)
            :        :- Project [cs_item_sk#16489L, cs_ext_sales_price#16497]
            :        :  +- Join Inner, (cs_bill_addr_sk#16480L = ca_address_sk#16537L)
            :        :     :- Project [cs_bill_addr_sk#16480L, cs_item_sk#16489L, cs_ext_sales_price#16497]
            :        :     :  +- Join Inner, (cs_sold_date_sk#16508L = d_date_sk#16509L)
            :        :     :     :- Project [cs_bill_addr_sk#16480L, cs_item_sk#16489L, cs_ext_sales_price#16497, cs_sold_date_sk#16508L]
            :        :     :     :  +- Filter (((isnotnull(cs_sold_date_sk#16508L) AND isnotnull(cs_bill_addr_sk#16480L)) AND isnotnull(cs_item_sk#16489L)) AND dynamicpruning#16742 [cs_sold_date_sk#16508L])
            :        :     :     :     :  +- Project [d_date_sk#16509L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#16515) AND isnotnull(d_moy#16517)) AND ((d_year#16515 = 2000) AND (d_moy#16517 = 1))) AND isnotnull(d_date_sk#16509L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16509L,d_date_id#16510,d_date#16511,d_month_seq#16512,d_week_seq#16513,d_quarter_seq#16514,d_year#16515,d_dow#16516,d_moy#16517,d_dom#16518,d_qoy#16519,d_fy_year#16520,d_fy_quarter_seq#16521,d_fy_week_seq#16522,d_day_name#16523,d_quarter_name#16524,d_holiday#16525,d_weekend#16526,d_following_holiday#16527,d_first_dom#16528,d_last_dom#16529,d_same_day_ly#16530,d_same_day_lq#16531,d_current_day#16532,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16475L,cs_ship_date_sk#16476L,cs_bill_customer_sk#16477L,cs_bill_cdemo_sk#16478L,cs_bill_hdemo_sk#16479L,cs_bill_addr_sk#16480L,cs_ship_customer_sk#16481L,cs_ship_cdemo_sk#16482L,cs_ship_hdemo_sk#16483L,cs_ship_addr_sk#16484L,cs_call_center_sk#16485L,cs_catalog_page_sk#16486L,cs_ship_mode_sk#16487L,cs_warehouse_sk#16488L,cs_item_sk#16489L,cs_promo_sk#16490L,cs_order_number#16491L,cs_quantity#16492,cs_wholesale_cost#16493,cs_list_price#16494,cs_sales_price#16495,cs_ext_discount_amt#16496,cs_ext_sales_price#16497,cs_ext_wholesale_cost#16498,... 10 more fields] orc
            :        :     :     +- Project [d_date_sk#16509L]
            :        :     :        +- Filter (((isnotnull(d_year#16515) AND isnotnull(d_moy#16517)) AND ((d_year#16515 = 2000) AND (d_moy#16517 = 1))) AND isnotnull(d_date_sk#16509L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16509L,d_date_id#16510,d_date#16511,d_month_seq#16512,d_week_seq#16513,d_quarter_seq#16514,d_year#16515,d_dow#16516,d_moy#16517,d_dom#16518,d_qoy#16519,d_fy_year#16520,d_fy_quarter_seq#16521,d_fy_week_seq#16522,d_day_name#16523,d_quarter_name#16524,d_holiday#16525,d_weekend#16526,d_following_holiday#16527,d_first_dom#16528,d_last_dom#16529,d_same_day_ly#16530,d_same_day_lq#16531,d_current_day#16532,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#16537L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#16548) AND (ca_gmt_offset#16548 = -8.0)) AND isnotnull(ca_address_sk#16537L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16537L,ca_address_id#16538,ca_street_number#16539,ca_street_name#16540,ca_street_type#16541,ca_suite_number#16542,ca_city#16543,ca_county#16544,ca_state#16545,ca_zip#16546,ca_country#16547,ca_gmt_offset#16548,ca_location_type#16549] orc
            :        +- Join LeftSemi, (i_item_id#16551 = i_item_id#16692)
            :           :- Project [i_item_sk#16550L, i_item_id#16551]
            :           :  +- Filter isnotnull(i_item_sk#16550L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16550L,i_item_id#16551,i_rec_start_date#16552,i_rec_end_date#16553,i_item_desc#16554,i_current_price#16555,i_wholesale_cost#16556,i_brand_id#16557,i_brand#16558,i_class_id#16559,i_class#16560,i_category_id#16561,i_category#16562,i_manufact_id#16563,i_manufact#16564,i_size#16565,i_formulation#16566,i_color#16567,i_units#16568,i_container#16569,i_manager_id#16570,i_product_name#16571] orc
            :           +- Project [i_item_id#16692]
            :              +- Filter i_color#16708 IN (orchid,chiffon,lace)
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16691L,i_item_id#16692,i_rec_start_date#16693,i_rec_end_date#16694,i_item_desc#16695,i_current_price#16696,i_wholesale_cost#16697,i_brand_id#16698,i_brand#16699,i_class_id#16700,i_class#16701,i_category_id#16702,i_category#16703,i_manufact_id#16704,i_manufact#16705,i_size#16706,i_formulation#16707,i_color#16708,i_units#16709,i_container#16710,i_manager_id#16711,i_product_name#16712] orc
            +- Aggregate [i_item_id#16648], [i_item_id#16648, sum(ws_ext_sales_price#16594) AS total_sales#16387]
               +- Project [ws_ext_sales_price#16594, i_item_id#16648]
                  +- Join Inner, (ws_item_sk#16574L = i_item_sk#16647L)
                     :- Project [ws_item_sk#16574L, ws_ext_sales_price#16594]
                     :  +- Join Inner, (ws_bill_addr_sk#16578L = ca_address_sk#16634L)
                     :     :- Project [ws_item_sk#16574L, ws_bill_addr_sk#16578L, ws_ext_sales_price#16594]
                     :     :  +- Join Inner, (ws_sold_date_sk#16605L = d_date_sk#16606L)
                     :     :     :- Project [ws_item_sk#16574L, ws_bill_addr_sk#16578L, ws_ext_sales_price#16594, ws_sold_date_sk#16605L]
                     :     :     :  +- Filter (((isnotnull(ws_sold_date_sk#16605L) AND isnotnull(ws_bill_addr_sk#16578L)) AND isnotnull(ws_item_sk#16574L)) AND dynamicpruning#16743 [ws_sold_date_sk#16605L])
                     :     :     :     :  +- Project [d_date_sk#16606L]
                     :     :     :     :     +- Filter (((isnotnull(d_year#16612) AND isnotnull(d_moy#16614)) AND ((d_year#16612 = 2000) AND (d_moy#16614 = 1))) AND isnotnull(d_date_sk#16606L))
                     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16606L,d_date_id#16607,d_date#16608,d_month_seq#16609,d_week_seq#16610,d_quarter_seq#16611,d_year#16612,d_dow#16613,d_moy#16614,d_dom#16615,d_qoy#16616,d_fy_year#16617,d_fy_quarter_seq#16618,d_fy_week_seq#16619,d_day_name#16620,d_quarter_name#16621,d_holiday#16622,d_weekend#16623,d_following_holiday#16624,d_first_dom#16625,d_last_dom#16626,d_same_day_ly#16627,d_same_day_lq#16628,d_current_day#16629,... 4 more fields] orc
                     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#16572L,ws_ship_date_sk#16573L,ws_item_sk#16574L,ws_bill_customer_sk#16575L,ws_bill_cdemo_sk#16576L,ws_bill_hdemo_sk#16577L,ws_bill_addr_sk#16578L,ws_ship_customer_sk#16579L,ws_ship_cdemo_sk#16580L,ws_ship_hdemo_sk#16581L,ws_ship_addr_sk#16582L,ws_web_page_sk#16583L,ws_web_site_sk#16584L,ws_ship_mode_sk#16585L,ws_warehouse_sk#16586L,ws_promo_sk#16587L,ws_order_number#16588L,ws_quantity#16589,ws_wholesale_cost#16590,ws_list_price#16591,ws_sales_price#16592,ws_ext_discount_amt#16593,ws_ext_sales_price#16594,ws_ext_wholesale_cost#16595,... 10 more fields] orc
                     :     :     +- Project [d_date_sk#16606L]
                     :     :        +- Filter (((isnotnull(d_year#16612) AND isnotnull(d_moy#16614)) AND ((d_year#16612 = 2000) AND (d_moy#16614 = 1))) AND isnotnull(d_date_sk#16606L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16606L,d_date_id#16607,d_date#16608,d_month_seq#16609,d_week_seq#16610,d_quarter_seq#16611,d_year#16612,d_dow#16613,d_moy#16614,d_dom#16615,d_qoy#16616,d_fy_year#16617,d_fy_quarter_seq#16618,d_fy_week_seq#16619,d_day_name#16620,d_quarter_name#16621,d_holiday#16622,d_weekend#16623,d_following_holiday#16624,d_first_dom#16625,d_last_dom#16626,d_same_day_ly#16627,d_same_day_lq#16628,d_current_day#16629,... 4 more fields] orc
                     :     +- Project [ca_address_sk#16634L]
                     :        +- Filter ((isnotnull(ca_gmt_offset#16645) AND (ca_gmt_offset#16645 = -8.0)) AND isnotnull(ca_address_sk#16634L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16634L,ca_address_id#16635,ca_street_number#16636,ca_street_name#16637,ca_street_type#16638,ca_suite_number#16639,ca_city#16640,ca_county#16641,ca_state#16642,ca_zip#16643,ca_country#16644,ca_gmt_offset#16645,ca_location_type#16646] orc
                     +- Join LeftSemi, (i_item_id#16648 = i_item_id#16714)
                        :- Project [i_item_sk#16647L, i_item_id#16648]
                        :  +- Filter isnotnull(i_item_sk#16647L)
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16647L,i_item_id#16648,i_rec_start_date#16649,i_rec_end_date#16650,i_item_desc#16651,i_current_price#16652,i_wholesale_cost#16653,i_brand_id#16654,i_brand#16655,i_class_id#16656,i_class#16657,i_category_id#16658,i_category#16659,i_manufact_id#16660,i_manufact#16661,i_size#16662,i_formulation#16663,i_color#16664,i_units#16665,i_container#16666,i_manager_id#16667,i_product_name#16668] orc
                        +- Project [i_item_id#16714]
                           +- Filter i_color#16730 IN (orchid,chiffon,lace)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16713L,i_item_id#16714,i_rec_start_date#16715,i_rec_end_date#16716,i_item_desc#16717,i_current_price#16718,i_wholesale_cost#16719,i_brand_id#16720,i_brand#16721,i_class_id#16722,i_class#16723,i_category_id#16724,i_category#16725,i_manufact_id#16726,i_manufact#16727,i_size#16728,i_formulation#16729,i_color#16730,i_units#16731,i_container#16732,i_manager_id#16733,i_product_name#16734] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[total_sales#16382 ASC NULLS FIRST], output=[i_item_id#16454,total_sales#16382])
   +- HashAggregate(keys=[i_item_id#16454], functions=[sum(total_sales#16383)], output=[i_item_id#16454, total_sales#16382])
      +- Exchange hashpartitioning(i_item_id#16454, 3000), ENSURE_REQUIREMENTS, [id=#17523]
         +- HashAggregate(keys=[i_item_id#16454], functions=[partial_sum(total_sales#16383)], output=[i_item_id#16454, sum#16745])
            +- Union
               :- HashAggregate(keys=[i_item_id#16454], functions=[sum(ss_ext_sales_price#16403)], output=[i_item_id#16454, total_sales#16383])
               :  +- Exchange hashpartitioning(i_item_id#16454, 3000), ENSURE_REQUIREMENTS, [id=#17468]
               :     +- HashAggregate(keys=[i_item_id#16454], functions=[partial_sum(ss_ext_sales_price#16403)], output=[i_item_id#16454, sum#16747])
               :        +- Project [ss_ext_sales_price#16403, i_item_id#16454]
               :           +- SortMergeJoin [ss_item_sk#16390L], [i_item_sk#16453L], Inner
               :              :- Sort [ss_item_sk#16390L ASC NULLS FIRST], false, 0
               :              :  +- Exchange hashpartitioning(ss_item_sk#16390L, 3000), ENSURE_REQUIREMENTS, [id=#17460]
               :              :     +- Project [ss_item_sk#16390L, ss_ext_sales_price#16403]
               :              :        +- SortMergeJoin [ss_addr_sk#16394L], [ca_address_sk#16440L], Inner
               :              :           :- Sort [ss_addr_sk#16394L ASC NULLS FIRST], false, 0
               :              :           :  +- Exchange hashpartitioning(ss_addr_sk#16394L, 3000), ENSURE_REQUIREMENTS, [id=#17450]
               :              :           :     +- Project [ss_item_sk#16390L, ss_addr_sk#16394L, ss_ext_sales_price#16403]
               :              :           :        +- BroadcastHashJoin [ss_sold_date_sk#16411L], [d_date_sk#16412L], Inner, BuildRight, false
               :              :           :           :- Filter (isnotnull(ss_addr_sk#16394L) AND isnotnull(ss_item_sk#16390L))
               :              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#16390L,ss_addr_sk#16394L,ss_ext_sales_price#16403,ss_sold_date_sk#16411L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#16394L), isnotnull(ss_item_sk#16390L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#16411L), dynamicpruningexpression(ss_sold_date_sk#16411L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_addr_sk:bigint,ss_ext_sales_price:double>
               :              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#16741, 0, true, Project [d_date_sk#16412L], [d_date_sk#16412L]
               :              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :           :           :              +- Project [d_date_sk#16412L]
               :              :           :           :                 +- Filter ((((isnotnull(d_year#16418) AND isnotnull(d_moy#16420)) AND (d_year#16418 = 2001)) AND (d_moy#16420 = 1)) AND isnotnull(d_date_sk#16412L))
               :              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16412L,d_year#16418,d_moy#16420] Batched: true, DataFilters: [isnotnull(d_year#16418), isnotnull(d_moy#16420), (d_year#16418 = 2001), (d_moy#16420 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17445]
               :              :           :              +- Project [d_date_sk#16412L]
               :              :           :                 +- Filter ((((isnotnull(d_year#16418) AND isnotnull(d_moy#16420)) AND (d_year#16418 = 2001)) AND (d_moy#16420 = 1)) AND isnotnull(d_date_sk#16412L))
               :              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16412L,d_year#16418,d_moy#16420] Batched: true, DataFilters: [isnotnull(d_year#16418), isnotnull(d_moy#16420), (d_year#16418 = 2001), (d_moy#16420 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           +- Sort [ca_address_sk#16440L ASC NULLS FIRST], false, 0
               :              :              +- Exchange hashpartitioning(ca_address_sk#16440L, 3000), ENSURE_REQUIREMENTS, [id=#17451]
               :              :                 +- Project [ca_address_sk#16440L]
               :              :                    +- Filter ((isnotnull(ca_gmt_offset#16451) AND (ca_gmt_offset#16451 = -8.0)) AND isnotnull(ca_address_sk#16440L))
               :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16440L,ca_gmt_offset#16451] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#16451), (ca_gmt_offset#16451 = -8.0), isnotnull(ca_address_sk#16440L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-8.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- Sort [i_item_sk#16453L ASC NULLS FIRST], false, 0
               :                 +- Exchange hashpartitioning(i_item_sk#16453L, 3000), ENSURE_REQUIREMENTS, [id=#17461]
               :                    +- BroadcastHashJoin [i_item_id#16454], [i_item_id#16670], LeftSemi, BuildRight, false
               :                       :- Filter isnotnull(i_item_sk#16453L)
               :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16453L,i_item_id#16454] Batched: true, DataFilters: [isnotnull(i_item_sk#16453L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
               :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#17456]
               :                          +- Project [i_item_id#16670]
               :                             +- Filter i_color#16686 IN (orchid,chiffon,lace)
               :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#16670,i_color#16686] Batched: true, DataFilters: [i_color#16686 IN (orchid,chiffon,lace)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_color, [chiffon,lace,orchid])], ReadSchema: struct<i_item_id:string,i_color:string>
               :- HashAggregate(keys=[i_item_id#16551], functions=[sum(cs_ext_sales_price#16497)], output=[i_item_id#16551, total_sales#16385])
               :  +- Exchange hashpartitioning(i_item_id#16551, 3000), ENSURE_REQUIREMENTS, [id=#17493]
               :     +- HashAggregate(keys=[i_item_id#16551], functions=[partial_sum(cs_ext_sales_price#16497)], output=[i_item_id#16551, sum#16749])
               :        +- Project [cs_ext_sales_price#16497, i_item_id#16551]
               :           +- SortMergeJoin [cs_item_sk#16489L], [i_item_sk#16550L], Inner
               :              :- Sort [cs_item_sk#16489L ASC NULLS FIRST], false, 0
               :              :  +- Exchange hashpartitioning(cs_item_sk#16489L, 3000), ENSURE_REQUIREMENTS, [id=#17485]
               :              :     +- Project [cs_item_sk#16489L, cs_ext_sales_price#16497]
               :              :        +- SortMergeJoin [cs_bill_addr_sk#16480L], [ca_address_sk#16537L], Inner
               :              :           :- Sort [cs_bill_addr_sk#16480L ASC NULLS FIRST], false, 0
               :              :           :  +- Exchange hashpartitioning(cs_bill_addr_sk#16480L, 3000), ENSURE_REQUIREMENTS, [id=#17475]
               :              :           :     +- Project [cs_bill_addr_sk#16480L, cs_item_sk#16489L, cs_ext_sales_price#16497]
               :              :           :        +- BroadcastHashJoin [cs_sold_date_sk#16508L], [d_date_sk#16509L], Inner, BuildRight, false
               :              :           :           :- Filter (isnotnull(cs_bill_addr_sk#16480L) AND isnotnull(cs_item_sk#16489L))
               :              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_addr_sk#16480L,cs_item_sk#16489L,cs_ext_sales_price#16497,cs_sold_date_sk#16508L] Batched: true, DataFilters: [isnotnull(cs_bill_addr_sk#16480L), isnotnull(cs_item_sk#16489L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#16508L), dynamicpruningexpression(cs_sold_date_sk#16508L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:bigint,cs_item_sk:bigint,cs_ext_sales_price:double>
               :              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#16742, 0, true, Project [d_date_sk#16509L], [d_date_sk#16509L]
               :              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :           :           :              +- Project [d_date_sk#16509L]
               :              :           :           :                 +- Filter ((((isnotnull(d_year#16515) AND isnotnull(d_moy#16517)) AND (d_year#16515 = 2000)) AND (d_moy#16517 = 1)) AND isnotnull(d_date_sk#16509L))
               :              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16509L,d_year#16515,d_moy#16517] Batched: true, DataFilters: [isnotnull(d_year#16515), isnotnull(d_moy#16517), (d_year#16515 = 2000), (d_moy#16517 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17470]
               :              :           :              +- Project [d_date_sk#16509L]
               :              :           :                 +- Filter ((((isnotnull(d_year#16515) AND isnotnull(d_moy#16517)) AND (d_year#16515 = 2000)) AND (d_moy#16517 = 1)) AND isnotnull(d_date_sk#16509L))
               :              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16509L,d_year#16515,d_moy#16517] Batched: true, DataFilters: [isnotnull(d_year#16515), isnotnull(d_moy#16517), (d_year#16515 = 2000), (d_moy#16517 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           +- Sort [ca_address_sk#16537L ASC NULLS FIRST], false, 0
               :              :              +- Exchange hashpartitioning(ca_address_sk#16537L, 3000), ENSURE_REQUIREMENTS, [id=#17476]
               :              :                 +- Project [ca_address_sk#16537L]
               :              :                    +- Filter ((isnotnull(ca_gmt_offset#16548) AND (ca_gmt_offset#16548 = -8.0)) AND isnotnull(ca_address_sk#16537L))
               :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16537L,ca_gmt_offset#16548] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#16548), (ca_gmt_offset#16548 = -8.0), isnotnull(ca_address_sk#16537L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-8.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- Sort [i_item_sk#16550L ASC NULLS FIRST], false, 0
               :                 +- Exchange hashpartitioning(i_item_sk#16550L, 3000), ENSURE_REQUIREMENTS, [id=#17486]
               :                    +- BroadcastHashJoin [i_item_id#16551], [i_item_id#16692], LeftSemi, BuildRight, false
               :                       :- Filter isnotnull(i_item_sk#16550L)
               :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16550L,i_item_id#16551] Batched: true, DataFilters: [isnotnull(i_item_sk#16550L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
               :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#17481]
               :                          +- Project [i_item_id#16692]
               :                             +- Filter i_color#16708 IN (orchid,chiffon,lace)
               :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#16692,i_color#16708] Batched: true, DataFilters: [i_color#16708 IN (orchid,chiffon,lace)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_color, [chiffon,lace,orchid])], ReadSchema: struct<i_item_id:string,i_color:string>
               +- HashAggregate(keys=[i_item_id#16648], functions=[sum(ws_ext_sales_price#16594)], output=[i_item_id#16648, total_sales#16387])
                  +- Exchange hashpartitioning(i_item_id#16648, 3000), ENSURE_REQUIREMENTS, [id=#17518]
                     +- HashAggregate(keys=[i_item_id#16648], functions=[partial_sum(ws_ext_sales_price#16594)], output=[i_item_id#16648, sum#16751])
                        +- Project [ws_ext_sales_price#16594, i_item_id#16648]
                           +- SortMergeJoin [ws_item_sk#16574L], [i_item_sk#16647L], Inner
                              :- Sort [ws_item_sk#16574L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_item_sk#16574L, 3000), ENSURE_REQUIREMENTS, [id=#17510]
                              :     +- Project [ws_item_sk#16574L, ws_ext_sales_price#16594]
                              :        +- SortMergeJoin [ws_bill_addr_sk#16578L], [ca_address_sk#16634L], Inner
                              :           :- Sort [ws_bill_addr_sk#16578L ASC NULLS FIRST], false, 0
                              :           :  +- Exchange hashpartitioning(ws_bill_addr_sk#16578L, 3000), ENSURE_REQUIREMENTS, [id=#17500]
                              :           :     +- Project [ws_item_sk#16574L, ws_bill_addr_sk#16578L, ws_ext_sales_price#16594]
                              :           :        +- BroadcastHashJoin [ws_sold_date_sk#16605L], [d_date_sk#16606L], Inner, BuildRight, false
                              :           :           :- Filter (isnotnull(ws_bill_addr_sk#16578L) AND isnotnull(ws_item_sk#16574L))
                              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#16574L,ws_bill_addr_sk#16578L,ws_ext_sales_price#16594,ws_sold_date_sk#16605L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#16578L), isnotnull(ws_item_sk#16574L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#16605L), dynamicpruningexpression(ws_sold_date_sk#16605L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#16743, 0, true, Project [d_date_sk#16606L], [d_date_sk#16606L]
                              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :           :              +- Project [d_date_sk#16606L]
                              :           :           :                 +- Filter ((((isnotnull(d_year#16612) AND isnotnull(d_moy#16614)) AND (d_year#16612 = 2000)) AND (d_moy#16614 = 1)) AND isnotnull(d_date_sk#16606L))
                              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16606L,d_year#16612,d_moy#16614] Batched: true, DataFilters: [isnotnull(d_year#16612), isnotnull(d_moy#16614), (d_year#16612 = 2000), (d_moy#16614 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#17495]
                              :           :              +- Project [d_date_sk#16606L]
                              :           :                 +- Filter ((((isnotnull(d_year#16612) AND isnotnull(d_moy#16614)) AND (d_year#16612 = 2000)) AND (d_moy#16614 = 1)) AND isnotnull(d_date_sk#16606L))
                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16606L,d_year#16612,d_moy#16614] Batched: true, DataFilters: [isnotnull(d_year#16612), isnotnull(d_moy#16614), (d_year#16612 = 2000), (d_moy#16614 = 1), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :           +- Sort [ca_address_sk#16634L ASC NULLS FIRST], false, 0
                              :              +- Exchange hashpartitioning(ca_address_sk#16634L, 3000), ENSURE_REQUIREMENTS, [id=#17501]
                              :                 +- Project [ca_address_sk#16634L]
                              :                    +- Filter ((isnotnull(ca_gmt_offset#16645) AND (ca_gmt_offset#16645 = -8.0)) AND isnotnull(ca_address_sk#16634L))
                              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#16634L,ca_gmt_offset#16645] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#16645), (ca_gmt_offset#16645 = -8.0), isnotnull(ca_address_sk#16634L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-8.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
                              +- Sort [i_item_sk#16647L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(i_item_sk#16647L, 3000), ENSURE_REQUIREMENTS, [id=#17511]
                                    +- BroadcastHashJoin [i_item_id#16648], [i_item_id#16714], LeftSemi, BuildRight, false
                                       :- Filter isnotnull(i_item_sk#16647L)
                                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16647L,i_item_id#16648] Batched: true, DataFilters: [isnotnull(i_item_sk#16647L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
                                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#17506]
                                          +- Project [i_item_id#16714]
                                             +- Filter i_color#16730 IN (orchid,chiffon,lace)
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#16714,i_color#16730] Batched: true, DataFilters: [i_color#16730 IN (orchid,chiffon,lace)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_color, [chiffon,lace,orchid])], ReadSchema: struct<i_item_id:string,i_color:string>

read query: spark_queries/q57.sql
explain query: q57
== Parsed Logical Plan ==
CTE [v1, v2]
:  :- 'SubqueryAlias v1
:  :  +- 'Aggregate ['i_category, 'i_brand, 'cc_name, 'd_year, 'd_moy], ['i_category, 'i_brand, 'cc_name, 'd_year, 'd_moy, 'sum('cs_sales_price) AS sum_sales#16752, 'avg('sum('cs_sales_price)) windowspecdefinition('i_category, 'i_brand, 'cc_name, 'd_year, unspecifiedframe$()) AS avg_monthly_sales#16753, 'rank() windowspecdefinition('i_category, 'i_brand, 'cc_name, 'd_year ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, unspecifiedframe$()) AS rn#16754]
:  :     +- 'Filter ((('cs_item_sk = 'i_item_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('cc_call_center_sk = 'cs_call_center_sk) AND ((('d_year = 2000) OR (('d_year = (2000 - 1)) AND ('d_moy = 12))) OR (('d_year = (2000 + 1)) AND ('d_moy = 1)))))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [item], [], false
:  :           :  :  +- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [call_center], [], false
:  +- 'SubqueryAlias v2
:     +- 'Project ['v1.i_category, 'v1.i_brand, 'v1.d_year, 'v1.d_moy, 'v1.avg_monthly_sales, 'v1.sum_sales, 'v1_lag.sum_sales AS psum#16755, 'v1_lead.sum_sales AS nsum#16756]
:        +- 'Filter (((('v1.i_category = 'v1_lag.i_category) AND ('v1.i_category = 'v1_lead.i_category)) AND (('v1.i_brand = 'v1_lag.i_brand) AND ('v1.i_brand = 'v1_lead.i_brand))) AND ((('v1.cc_name = 'v1_lag.cc_name) AND ('v1.cc_name = 'v1_lead.cc_name)) AND (('v1.rn = ('v1_lag.rn + 1)) AND ('v1.rn = ('v1_lead.rn - 1)))))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [v1], [], false
:              :  +- 'SubqueryAlias v1_lag
:              :     +- 'UnresolvedRelation [v1], [], false
:              +- 'SubqueryAlias v1_lead
:                 +- 'UnresolvedRelation [v1], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 3 ASC NULLS FIRST], true
         +- 'Project [*]
            +- 'Filter ((('d_year = 2000) AND ('avg_monthly_sales > 0)) AND (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1))
               +- 'UnresolvedRelation [v2], [], false

== Analyzed Logical Plan ==
i_category: string, i_brand: string, d_year: int, d_moy: int, avg_monthly_sales: double, sum_sales: double, psum: double, nsum: double
WithCTE
:- CTERelationDef 37
:  +- SubqueryAlias v1
:     +- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754]
:        +- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, _w0#16885, avg_monthly_sales#16753, rn#16754, avg_monthly_sales#16753, rn#16754]
:           +- Window [rank(d_year#16821, d_moy#16823) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16754], [i_category#16771, i_brand#16767, cc_name#16849], [d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST]
:              +- Window [avg(_w0#16885) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#16753], [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821]
:                 +- Aggregate [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823], [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum(cs_sales_price#16801) AS sum_sales#16752, sum(cs_sales_price#16801) AS _w0#16885]
:                    +- Filter (((cs_item_sk#16795L = i_item_sk#16759L) AND (cs_sold_date_sk#16814L = d_date_sk#16815L)) AND ((cc_call_center_sk#16843L = cs_call_center_sk#16791L) AND (((d_year#16821 = 2000) OR ((d_year#16821 = (2000 - 1)) AND (d_moy#16823 = 12))) OR ((d_year#16821 = (2000 + 1)) AND (d_moy#16823 = 1)))))
:                       +- Join Inner
:                          :- Join Inner
:                          :  :- Join Inner
:                          :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                          :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16759L,i_item_id#16760,i_rec_start_date#16761,i_rec_end_date#16762,i_item_desc#16763,i_current_price#16764,i_wholesale_cost#16765,i_brand_id#16766,i_brand#16767,i_class_id#16768,i_class#16769,i_category_id#16770,i_category#16771,i_manufact_id#16772,i_manufact#16773,i_size#16774,i_formulation#16775,i_color#16776,i_units#16777,i_container#16778,i_manager_id#16779,i_product_name#16780] orc
:                          :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                          :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16781L,cs_ship_date_sk#16782L,cs_bill_customer_sk#16783L,cs_bill_cdemo_sk#16784L,cs_bill_hdemo_sk#16785L,cs_bill_addr_sk#16786L,cs_ship_customer_sk#16787L,cs_ship_cdemo_sk#16788L,cs_ship_hdemo_sk#16789L,cs_ship_addr_sk#16790L,cs_call_center_sk#16791L,cs_catalog_page_sk#16792L,cs_ship_mode_sk#16793L,cs_warehouse_sk#16794L,cs_item_sk#16795L,cs_promo_sk#16796L,cs_order_number#16797L,cs_quantity#16798,cs_wholesale_cost#16799,cs_list_price#16800,cs_sales_price#16801,cs_ext_discount_amt#16802,cs_ext_sales_price#16803,cs_ext_wholesale_cost#16804,... 10 more fields] orc
:                          :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16815L,d_date_id#16816,d_date#16817,d_month_seq#16818,d_week_seq#16819,d_quarter_seq#16820,d_year#16821,d_dow#16822,d_moy#16823,d_dom#16824,d_qoy#16825,d_fy_year#16826,d_fy_quarter_seq#16827,d_fy_week_seq#16828,d_day_name#16829,d_quarter_name#16830,d_holiday#16831,d_weekend#16832,d_following_holiday#16833,d_first_dom#16834,d_last_dom#16835,d_same_day_ly#16836,d_same_day_lq#16837,d_current_day#16838,... 4 more fields] orc
:                          +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.call_center
:                             +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#16843L,cc_call_center_id#16844,cc_rec_start_date#16845,cc_rec_end_date#16846,cc_closed_date_sk#16847L,cc_open_date_sk#16848L,cc_name#16849,cc_class#16850,cc_employees#16851,cc_sq_ft#16852,cc_hours#16853,cc_manager#16854,cc_mkt_id#16855,cc_mkt_class#16856,cc_mkt_desc#16857,cc_market_manager#16858,cc_division#16859,cc_division_name#16860,cc_company#16861,cc_company_name#16862,cc_street_number#16863,cc_street_name#16864,cc_street_type#16865,cc_suite_number#16866,... 7 more fields] orc
:- CTERelationDef 38
:  +- SubqueryAlias v2
:     +- Project [i_category#16771, i_brand#16767, d_year#16821, d_moy#16823, avg_monthly_sales#16753, sum_sales#16752, sum_sales#16891 AS psum#16755, sum_sales#16899 AS nsum#16756]
:        +- Filter ((((i_category#16771 = i_category#16886) AND (i_category#16771 = i_category#16894)) AND ((i_brand#16767 = i_brand#16887) AND (i_brand#16767 = i_brand#16895))) AND (((cc_name#16849 = cc_name#16888) AND (cc_name#16849 = cc_name#16896)) AND ((rn#16754 = (rn#16893 + 1)) AND (rn#16754 = (rn#16901 - 1)))))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias v1
:              :  :  +- CTERelationRef 37, true, [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754]
:              :  +- SubqueryAlias v1_lag
:              :     +- SubqueryAlias v1
:              :        +- CTERelationRef 37, true, [i_category#16886, i_brand#16887, cc_name#16888, d_year#16889, d_moy#16890, sum_sales#16891, avg_monthly_sales#16892, rn#16893]
:              +- SubqueryAlias v1_lead
:                 +- SubqueryAlias v1
:                    +- CTERelationRef 37, true, [i_category#16894, i_brand#16895, cc_name#16896, d_year#16897, d_moy#16898, sum_sales#16899, avg_monthly_sales#16900, rn#16901]
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [(sum_sales#16752 - avg_monthly_sales#16753) ASC NULLS FIRST, d_year#16821 ASC NULLS FIRST], true
         +- Project [i_category#16771, i_brand#16767, d_year#16821, d_moy#16823, avg_monthly_sales#16753, sum_sales#16752, psum#16755, nsum#16756]
            +- Filter (((d_year#16821 = 2000) AND (avg_monthly_sales#16753 > cast(0 as double))) AND (CASE WHEN (avg_monthly_sales#16753 > cast(0 as double)) THEN (abs((sum_sales#16752 - avg_monthly_sales#16753), false) / avg_monthly_sales#16753) ELSE cast(null as double) END > cast(0.1 as double)))
               +- SubqueryAlias v2
                  +- CTERelationRef 38, true, [i_category#16771, i_brand#16767, d_year#16821, d_moy#16823, avg_monthly_sales#16753, sum_sales#16752, psum#16755, nsum#16756]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [(sum_sales#16752 - avg_monthly_sales#16753) ASC NULLS FIRST, d_year#16821 ASC NULLS FIRST], true
      +- Project [i_category#16771, i_brand#16767, d_year#16821, d_moy#16823, avg_monthly_sales#16753, sum_sales#16752, sum_sales#16891 AS psum#16755, sum_sales#16899 AS nsum#16756]
         +- Join Inner, ((((i_category#16771 = i_category#17042) AND (i_brand#16767 = i_brand#17038)) AND (cc_name#16849 = cc_name#17120)) AND (rn#16754 = (rn#17149 - 1)))
            :- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754, sum_sales#16891]
            :  +- Join Inner, ((((i_category#16771 = i_category#16922) AND (i_brand#16767 = i_brand#16918)) AND (cc_name#16849 = cc_name#17000)) AND (rn#16754 = (rn#17029 + 1)))
            :     :- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754]
            :     :  +- Filter (((isnotnull(avg_monthly_sales#16753) AND isnotnull(sum_sales#16752)) AND (avg_monthly_sales#16753 > 0.0)) AND ((abs((sum_sales#16752 - avg_monthly_sales#16753), false) / avg_monthly_sales#16753) > 0.1))
            :     :     +- Window [avg(_w0#16885) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#16753], [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821]
            :     :        +- Filter (isnotnull(d_year#16821) AND (d_year#16821 = 2000))
            :     :           +- Window [rank(d_year#16821, d_moy#16823) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16754], [i_category#16771, i_brand#16767, cc_name#16849], [d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST]
            :     :              +- Aggregate [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823], [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum(cs_sales_price#16801) AS sum_sales#16752, sum(cs_sales_price#16801) AS _w0#16885]
            :     :                 +- Project [i_brand#16767, i_category#16771, cs_sales_price#16801, d_year#16821, d_moy#16823, cc_name#16849]
            :     :                    +- Join Inner, (cs_item_sk#16795L = i_item_sk#16759L)
            :     :                       :- Project [cs_item_sk#16795L, cs_sales_price#16801, d_year#16821, d_moy#16823, cc_name#16849]
            :     :                       :  +- Join Inner, (cc_call_center_sk#16843L = cs_call_center_sk#16791L)
            :     :                       :     :- Project [cs_call_center_sk#16791L, cs_item_sk#16795L, cs_sales_price#16801, d_year#16821, d_moy#16823]
            :     :                       :     :  +- Join Inner, (cs_sold_date_sk#16814L = d_date_sk#16815L)
            :     :                       :     :     :- Project [cs_call_center_sk#16791L, cs_item_sk#16795L, cs_sales_price#16801, cs_sold_date_sk#16814L]
            :     :                       :     :     :  +- Filter (((isnotnull(cs_item_sk#16795L) AND isnotnull(cs_sold_date_sk#16814L)) AND isnotnull(cs_call_center_sk#16791L)) AND dynamicpruning#17150 [cs_sold_date_sk#16814L])
            :     :                       :     :     :     :  +- Project [d_date_sk#16815L, d_year#16821, d_moy#16823]
            :     :                       :     :     :     :     +- Filter ((((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2001) AND (d_moy#16823 = 1))) AND isnotnull(d_date_sk#16815L))
            :     :                       :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16815L,d_date_id#16816,d_date#16817,d_month_seq#16818,d_week_seq#16819,d_quarter_seq#16820,d_year#16821,d_dow#16822,d_moy#16823,d_dom#16824,d_qoy#16825,d_fy_year#16826,d_fy_quarter_seq#16827,d_fy_week_seq#16828,d_day_name#16829,d_quarter_name#16830,d_holiday#16831,d_weekend#16832,d_following_holiday#16833,d_first_dom#16834,d_last_dom#16835,d_same_day_ly#16836,d_same_day_lq#16837,d_current_day#16838,... 4 more fields] orc
            :     :                       :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16781L,cs_ship_date_sk#16782L,cs_bill_customer_sk#16783L,cs_bill_cdemo_sk#16784L,cs_bill_hdemo_sk#16785L,cs_bill_addr_sk#16786L,cs_ship_customer_sk#16787L,cs_ship_cdemo_sk#16788L,cs_ship_hdemo_sk#16789L,cs_ship_addr_sk#16790L,cs_call_center_sk#16791L,cs_catalog_page_sk#16792L,cs_ship_mode_sk#16793L,cs_warehouse_sk#16794L,cs_item_sk#16795L,cs_promo_sk#16796L,cs_order_number#16797L,cs_quantity#16798,cs_wholesale_cost#16799,cs_list_price#16800,cs_sales_price#16801,cs_ext_discount_amt#16802,cs_ext_sales_price#16803,cs_ext_wholesale_cost#16804,... 10 more fields] orc
            :     :                       :     :     +- Project [d_date_sk#16815L, d_year#16821, d_moy#16823]
            :     :                       :     :        +- Filter ((((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2001) AND (d_moy#16823 = 1))) AND isnotnull(d_date_sk#16815L))
            :     :                       :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16815L,d_date_id#16816,d_date#16817,d_month_seq#16818,d_week_seq#16819,d_quarter_seq#16820,d_year#16821,d_dow#16822,d_moy#16823,d_dom#16824,d_qoy#16825,d_fy_year#16826,d_fy_quarter_seq#16827,d_fy_week_seq#16828,d_day_name#16829,d_quarter_name#16830,d_holiday#16831,d_weekend#16832,d_following_holiday#16833,d_first_dom#16834,d_last_dom#16835,d_same_day_ly#16836,d_same_day_lq#16837,d_current_day#16838,... 4 more fields] orc
            :     :                       :     +- Project [cc_call_center_sk#16843L, cc_name#16849]
            :     :                       :        +- Filter (isnotnull(cc_call_center_sk#16843L) AND isnotnull(cc_name#16849))
            :     :                       :           +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#16843L,cc_call_center_id#16844,cc_rec_start_date#16845,cc_rec_end_date#16846,cc_closed_date_sk#16847L,cc_open_date_sk#16848L,cc_name#16849,cc_class#16850,cc_employees#16851,cc_sq_ft#16852,cc_hours#16853,cc_manager#16854,cc_mkt_id#16855,cc_mkt_class#16856,cc_mkt_desc#16857,cc_market_manager#16858,cc_division#16859,cc_division_name#16860,cc_company#16861,cc_company_name#16862,cc_street_number#16863,cc_street_name#16864,cc_street_type#16865,cc_suite_number#16866,... 7 more fields] orc
            :     :                       +- Project [i_item_sk#16759L, i_brand#16767, i_category#16771]
            :     :                          +- Filter (isnotnull(i_item_sk#16759L) AND (isnotnull(i_category#16771) AND isnotnull(i_brand#16767)))
            :     :                             +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16759L,i_item_id#16760,i_rec_start_date#16761,i_rec_end_date#16762,i_item_desc#16763,i_current_price#16764,i_wholesale_cost#16765,i_brand_id#16766,i_brand#16767,i_class_id#16768,i_class#16769,i_category_id#16770,i_category#16771,i_manufact_id#16772,i_manufact#16773,i_size#16774,i_formulation#16775,i_color#16776,i_units#16777,i_container#16778,i_manager_id#16779,i_product_name#16780] orc
            :     +- Project [i_category#16922, i_brand#16918, cc_name#17000, sum_sales#16752 AS sum_sales#16891, rn#17029]
            :        +- Window [rank(d_year#16972, d_moy#16974) windowspecdefinition(i_category#16922, i_brand#16918, cc_name#17000, d_year#16972 ASC NULLS FIRST, d_moy#16974 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#17029], [i_category#16922, i_brand#16918, cc_name#17000], [d_year#16972 ASC NULLS FIRST, d_moy#16974 ASC NULLS FIRST]
            :           +- Aggregate [i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974], [i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974, sum(cs_sales_price#16952) AS sum_sales#16752]
            :              +- Project [i_brand#16918, i_category#16922, cs_sales_price#16952, d_year#16972, d_moy#16974, cc_name#17000]
            :                 +- Join Inner, (cs_item_sk#16946L = i_item_sk#16910L)
            :                    :- Project [cs_item_sk#16946L, cs_sales_price#16952, d_year#16972, d_moy#16974, cc_name#17000]
            :                    :  +- Join Inner, (cc_call_center_sk#16994L = cs_call_center_sk#16942L)
            :                    :     :- Project [cs_call_center_sk#16942L, cs_item_sk#16946L, cs_sales_price#16952, d_year#16972, d_moy#16974]
            :                    :     :  +- Join Inner, (cs_sold_date_sk#16965L = d_date_sk#16966L)
            :                    :     :     :- Project [cs_call_center_sk#16942L, cs_item_sk#16946L, cs_sales_price#16952, cs_sold_date_sk#16965L]
            :                    :     :     :  +- Filter (((isnotnull(cs_item_sk#16946L) AND isnotnull(cs_sold_date_sk#16965L)) AND isnotnull(cs_call_center_sk#16942L)) AND dynamicpruning#17151 [cs_sold_date_sk#16965L])
            :                    :     :     :     :  +- Project [d_date_sk#16966L, d_year#16972, d_moy#16974]
            :                    :     :     :     :     +- Filter ((((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2001) AND (d_moy#16974 = 1))) AND isnotnull(d_date_sk#16966L))
            :                    :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16966L,d_date_id#16967,d_date#16968,d_month_seq#16969,d_week_seq#16970,d_quarter_seq#16971,d_year#16972,d_dow#16973,d_moy#16974,d_dom#16975,d_qoy#16976,d_fy_year#16977,d_fy_quarter_seq#16978,d_fy_week_seq#16979,d_day_name#16980,d_quarter_name#16981,d_holiday#16982,d_weekend#16983,d_following_holiday#16984,d_first_dom#16985,d_last_dom#16986,d_same_day_ly#16987,d_same_day_lq#16988,d_current_day#16989,... 4 more fields] orc
            :                    :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#16932L,cs_ship_date_sk#16933L,cs_bill_customer_sk#16934L,cs_bill_cdemo_sk#16935L,cs_bill_hdemo_sk#16936L,cs_bill_addr_sk#16937L,cs_ship_customer_sk#16938L,cs_ship_cdemo_sk#16939L,cs_ship_hdemo_sk#16940L,cs_ship_addr_sk#16941L,cs_call_center_sk#16942L,cs_catalog_page_sk#16943L,cs_ship_mode_sk#16944L,cs_warehouse_sk#16945L,cs_item_sk#16946L,cs_promo_sk#16947L,cs_order_number#16948L,cs_quantity#16949,cs_wholesale_cost#16950,cs_list_price#16951,cs_sales_price#16952,cs_ext_discount_amt#16953,cs_ext_sales_price#16954,cs_ext_wholesale_cost#16955,... 10 more fields] orc
            :                    :     :     +- Project [d_date_sk#16966L, d_year#16972, d_moy#16974]
            :                    :     :        +- Filter ((((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2001) AND (d_moy#16974 = 1))) AND isnotnull(d_date_sk#16966L))
            :                    :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16966L,d_date_id#16967,d_date#16968,d_month_seq#16969,d_week_seq#16970,d_quarter_seq#16971,d_year#16972,d_dow#16973,d_moy#16974,d_dom#16975,d_qoy#16976,d_fy_year#16977,d_fy_quarter_seq#16978,d_fy_week_seq#16979,d_day_name#16980,d_quarter_name#16981,d_holiday#16982,d_weekend#16983,d_following_holiday#16984,d_first_dom#16985,d_last_dom#16986,d_same_day_ly#16987,d_same_day_lq#16988,d_current_day#16989,... 4 more fields] orc
            :                    :     +- Project [cc_call_center_sk#16994L, cc_name#17000]
            :                    :        +- Filter (isnotnull(cc_call_center_sk#16994L) AND isnotnull(cc_name#17000))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#16994L,cc_call_center_id#16995,cc_rec_start_date#16996,cc_rec_end_date#16997,cc_closed_date_sk#16998L,cc_open_date_sk#16999L,cc_name#17000,cc_class#17001,cc_employees#17002,cc_sq_ft#17003,cc_hours#17004,cc_manager#17005,cc_mkt_id#17006,cc_mkt_class#17007,cc_mkt_desc#17008,cc_market_manager#17009,cc_division#17010,cc_division_name#17011,cc_company#17012,cc_company_name#17013,cc_street_number#17014,cc_street_name#17015,cc_street_type#17016,cc_suite_number#17017,... 7 more fields] orc
            :                    +- Project [i_item_sk#16910L, i_brand#16918, i_category#16922]
            :                       +- Filter (isnotnull(i_item_sk#16910L) AND (isnotnull(i_category#16922) AND isnotnull(i_brand#16918)))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16910L,i_item_id#16911,i_rec_start_date#16912,i_rec_end_date#16913,i_item_desc#16914,i_current_price#16915,i_wholesale_cost#16916,i_brand_id#16917,i_brand#16918,i_class_id#16919,i_class#16920,i_category_id#16921,i_category#16922,i_manufact_id#16923,i_manufact#16924,i_size#16925,i_formulation#16926,i_color#16927,i_units#16928,i_container#16929,i_manager_id#16930,i_product_name#16931] orc
            +- Project [i_category#17042, i_brand#17038, cc_name#17120, sum_sales#16752 AS sum_sales#16899, rn#17149]
               +- Window [rank(d_year#17092, d_moy#17094) windowspecdefinition(i_category#17042, i_brand#17038, cc_name#17120, d_year#17092 ASC NULLS FIRST, d_moy#17094 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#17149], [i_category#17042, i_brand#17038, cc_name#17120], [d_year#17092 ASC NULLS FIRST, d_moy#17094 ASC NULLS FIRST]
                  +- Aggregate [i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094], [i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094, sum(cs_sales_price#17072) AS sum_sales#16752]
                     +- Project [i_brand#17038, i_category#17042, cs_sales_price#17072, d_year#17092, d_moy#17094, cc_name#17120]
                        +- Join Inner, (cs_item_sk#17066L = i_item_sk#17030L)
                           :- Project [cs_item_sk#17066L, cs_sales_price#17072, d_year#17092, d_moy#17094, cc_name#17120]
                           :  +- Join Inner, (cc_call_center_sk#17114L = cs_call_center_sk#17062L)
                           :     :- Project [cs_call_center_sk#17062L, cs_item_sk#17066L, cs_sales_price#17072, d_year#17092, d_moy#17094]
                           :     :  +- Join Inner, (cs_sold_date_sk#17085L = d_date_sk#17086L)
                           :     :     :- Project [cs_call_center_sk#17062L, cs_item_sk#17066L, cs_sales_price#17072, cs_sold_date_sk#17085L]
                           :     :     :  +- Filter (((isnotnull(cs_item_sk#17066L) AND isnotnull(cs_sold_date_sk#17085L)) AND isnotnull(cs_call_center_sk#17062L)) AND dynamicpruning#17152 [cs_sold_date_sk#17085L])
                           :     :     :     :  +- Project [d_date_sk#17086L, d_year#17092, d_moy#17094]
                           :     :     :     :     +- Filter ((((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2001) AND (d_moy#17094 = 1))) AND isnotnull(d_date_sk#17086L))
                           :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17086L,d_date_id#17087,d_date#17088,d_month_seq#17089,d_week_seq#17090,d_quarter_seq#17091,d_year#17092,d_dow#17093,d_moy#17094,d_dom#17095,d_qoy#17096,d_fy_year#17097,d_fy_quarter_seq#17098,d_fy_week_seq#17099,d_day_name#17100,d_quarter_name#17101,d_holiday#17102,d_weekend#17103,d_following_holiday#17104,d_first_dom#17105,d_last_dom#17106,d_same_day_ly#17107,d_same_day_lq#17108,d_current_day#17109,... 4 more fields] orc
                           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#17052L,cs_ship_date_sk#17053L,cs_bill_customer_sk#17054L,cs_bill_cdemo_sk#17055L,cs_bill_hdemo_sk#17056L,cs_bill_addr_sk#17057L,cs_ship_customer_sk#17058L,cs_ship_cdemo_sk#17059L,cs_ship_hdemo_sk#17060L,cs_ship_addr_sk#17061L,cs_call_center_sk#17062L,cs_catalog_page_sk#17063L,cs_ship_mode_sk#17064L,cs_warehouse_sk#17065L,cs_item_sk#17066L,cs_promo_sk#17067L,cs_order_number#17068L,cs_quantity#17069,cs_wholesale_cost#17070,cs_list_price#17071,cs_sales_price#17072,cs_ext_discount_amt#17073,cs_ext_sales_price#17074,cs_ext_wholesale_cost#17075,... 10 more fields] orc
                           :     :     +- Project [d_date_sk#17086L, d_year#17092, d_moy#17094]
                           :     :        +- Filter ((((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2001) AND (d_moy#17094 = 1))) AND isnotnull(d_date_sk#17086L))
                           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17086L,d_date_id#17087,d_date#17088,d_month_seq#17089,d_week_seq#17090,d_quarter_seq#17091,d_year#17092,d_dow#17093,d_moy#17094,d_dom#17095,d_qoy#17096,d_fy_year#17097,d_fy_quarter_seq#17098,d_fy_week_seq#17099,d_day_name#17100,d_quarter_name#17101,d_holiday#17102,d_weekend#17103,d_following_holiday#17104,d_first_dom#17105,d_last_dom#17106,d_same_day_ly#17107,d_same_day_lq#17108,d_current_day#17109,... 4 more fields] orc
                           :     +- Project [cc_call_center_sk#17114L, cc_name#17120]
                           :        +- Filter (isnotnull(cc_call_center_sk#17114L) AND isnotnull(cc_name#17120))
                           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#17114L,cc_call_center_id#17115,cc_rec_start_date#17116,cc_rec_end_date#17117,cc_closed_date_sk#17118L,cc_open_date_sk#17119L,cc_name#17120,cc_class#17121,cc_employees#17122,cc_sq_ft#17123,cc_hours#17124,cc_manager#17125,cc_mkt_id#17126,cc_mkt_class#17127,cc_mkt_desc#17128,cc_market_manager#17129,cc_division#17130,cc_division_name#17131,cc_company#17132,cc_company_name#17133,cc_street_number#17134,cc_street_name#17135,cc_street_type#17136,cc_suite_number#17137,... 7 more fields] orc
                           +- Project [i_item_sk#17030L, i_brand#17038, i_category#17042]
                              +- Filter (isnotnull(i_item_sk#17030L) AND (isnotnull(i_category#17042) AND isnotnull(i_brand#17038)))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17030L,i_item_id#17031,i_rec_start_date#17032,i_rec_end_date#17033,i_item_desc#17034,i_current_price#17035,i_wholesale_cost#17036,i_brand_id#17037,i_brand#17038,i_class_id#17039,i_class#17040,i_category_id#17041,i_category#17042,i_manufact_id#17043,i_manufact#17044,i_size#17045,i_formulation#17046,i_color#17047,i_units#17048,i_container#17049,i_manager_id#17050,i_product_name#17051] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[(sum_sales#16752 - avg_monthly_sales#16753) ASC NULLS FIRST,d_year#16821 ASC NULLS FIRST], output=[i_category#16771,i_brand#16767,d_year#16821,d_moy#16823,avg_monthly_sales#16753,sum_sales#16752,psum#16755,nsum#16756])
   +- Project [i_category#16771, i_brand#16767, d_year#16821, d_moy#16823, avg_monthly_sales#16753, sum_sales#16752, sum_sales#16891 AS psum#16755, sum_sales#16899 AS nsum#16756]
      +- SortMergeJoin [i_category#16771, i_brand#16767, cc_name#16849, rn#16754], [i_category#17042, i_brand#17038, cc_name#17120, (rn#17149 - 1)], Inner
         :- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754, sum_sales#16891]
         :  +- SortMergeJoin [i_category#16771, i_brand#16767, cc_name#16849, rn#16754], [i_category#16922, i_brand#16918, cc_name#17000, (rn#17029 + 1)], Inner
         :     :- Sort [i_category#16771 ASC NULLS FIRST, i_brand#16767 ASC NULLS FIRST, cc_name#16849 ASC NULLS FIRST, rn#16754 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#16771, i_brand#16767, cc_name#16849, rn#16754, 3000), ENSURE_REQUIREMENTS, [id=#17926]
         :     :     +- Project [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, avg_monthly_sales#16753, rn#16754]
         :     :        +- Filter (((isnotnull(avg_monthly_sales#16753) AND isnotnull(sum_sales#16752)) AND (avg_monthly_sales#16753 > 0.0)) AND ((abs((sum_sales#16752 - avg_monthly_sales#16753), false) / avg_monthly_sales#16753) > 0.1))
         :     :           +- Window [avg(_w0#16885) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#16753], [i_category#16771, i_brand#16767, cc_name#16849, d_year#16821]
         :     :              +- Filter (isnotnull(d_year#16821) AND (d_year#16821 = 2000))
         :     :                 +- Window [rank(d_year#16821, d_moy#16823) windowspecdefinition(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16754], [i_category#16771, i_brand#16767, cc_name#16849], [d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#16771 ASC NULLS FIRST, i_brand#16767 ASC NULLS FIRST, cc_name#16849 ASC NULLS FIRST, d_year#16821 ASC NULLS FIRST, d_moy#16823 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#16771, i_brand#16767, cc_name#16849, 3000), ENSURE_REQUIREMENTS, [id=#17893]
         :     :                          +- HashAggregate(keys=[i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823], functions=[sum(cs_sales_price#16801)], output=[i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum_sales#16752, _w0#16885])
         :     :                             +- Exchange hashpartitioning(i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, 3000), ENSURE_REQUIREMENTS, [id=#17890]
         :     :                                +- HashAggregate(keys=[i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823], functions=[partial_sum(cs_sales_price#16801)], output=[i_category#16771, i_brand#16767, cc_name#16849, d_year#16821, d_moy#16823, sum#17154])
         :     :                                   +- Project [i_brand#16767, i_category#16771, cs_sales_price#16801, d_year#16821, d_moy#16823, cc_name#16849]
         :     :                                      +- SortMergeJoin [cs_item_sk#16795L], [i_item_sk#16759L], Inner
         :     :                                         :- Sort [cs_item_sk#16795L ASC NULLS FIRST], false, 0
         :     :                                         :  +- Exchange hashpartitioning(cs_item_sk#16795L, 3000), ENSURE_REQUIREMENTS, [id=#17882]
         :     :                                         :     +- Project [cs_item_sk#16795L, cs_sales_price#16801, d_year#16821, d_moy#16823, cc_name#16849]
         :     :                                         :        +- BroadcastHashJoin [cs_call_center_sk#16791L], [cc_call_center_sk#16843L], Inner, BuildRight, false
         :     :                                         :           :- Project [cs_call_center_sk#16791L, cs_item_sk#16795L, cs_sales_price#16801, d_year#16821, d_moy#16823]
         :     :                                         :           :  +- BroadcastHashJoin [cs_sold_date_sk#16814L], [d_date_sk#16815L], Inner, BuildRight, false
         :     :                                         :           :     :- Filter (isnotnull(cs_item_sk#16795L) AND isnotnull(cs_call_center_sk#16791L))
         :     :                                         :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_call_center_sk#16791L,cs_item_sk#16795L,cs_sales_price#16801,cs_sold_date_sk#16814L] Batched: true, DataFilters: [isnotnull(cs_item_sk#16795L), isnotnull(cs_call_center_sk#16791L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#16814L), dynamicpruningexpression(cs_sold_date_sk#16814L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_call_center_sk:bigint,cs_item_sk:bigint,cs_sales_price:double>
         :     :                                         :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#17150, 0, true, Project [d_date_sk#16815L, d_year#16821, d_moy#16823], [d_date_sk#16815L]
         :     :                                         :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                                         :           :     :              +- Filter ((((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2001) AND (d_moy#16823 = 1))) AND isnotnull(d_date_sk#16815L))
         :     :                                         :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16815L,d_year#16821,d_moy#16823] Batched: true, DataFilters: [(((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :     :                                         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17873]
         :     :                                         :           :        +- Filter ((((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2001) AND (d_moy#16823 = 1))) AND isnotnull(d_date_sk#16815L))
         :     :                                         :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16815L,d_year#16821,d_moy#16823] Batched: true, DataFilters: [(((d_year#16821 = 2000) OR ((d_year#16821 = 1999) AND (d_moy#16823 = 12))) OR ((d_year#16821 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :     :                                         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17877]
         :     :                                         :              +- Filter (isnotnull(cc_call_center_sk#16843L) AND isnotnull(cc_name#16849))
         :     :                                         :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#16843L,cc_name#16849] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#16843L), isnotnull(cc_name#16849)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:bigint,cc_name:string>
         :     :                                         +- Sort [i_item_sk#16759L ASC NULLS FIRST], false, 0
         :     :                                            +- Exchange hashpartitioning(i_item_sk#16759L, 3000), ENSURE_REQUIREMENTS, [id=#17883]
         :     :                                               +- Filter ((isnotnull(i_item_sk#16759L) AND isnotnull(i_category#16771)) AND isnotnull(i_brand#16767))
         :     :                                                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16759L,i_brand#16767,i_category#16771] Batched: true, DataFilters: [isnotnull(i_item_sk#16759L), isnotnull(i_category#16771), isnotnull(i_brand#16767)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>
         :     +- Sort [i_category#16922 ASC NULLS FIRST, i_brand#16918 ASC NULLS FIRST, cc_name#17000 ASC NULLS FIRST, (rn#17029 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#16922, i_brand#16918, cc_name#17000, (rn#17029 + 1), 3000), ENSURE_REQUIREMENTS, [id=#17927]
         :           +- Project [i_category#16922, i_brand#16918, cc_name#17000, sum_sales#16752 AS sum_sales#16891, rn#17029]
         :              +- Window [rank(d_year#16972, d_moy#16974) windowspecdefinition(i_category#16922, i_brand#16918, cc_name#17000, d_year#16972 ASC NULLS FIRST, d_moy#16974 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#17029], [i_category#16922, i_brand#16918, cc_name#17000], [d_year#16972 ASC NULLS FIRST, d_moy#16974 ASC NULLS FIRST]
         :                 +- Sort [i_category#16922 ASC NULLS FIRST, i_brand#16918 ASC NULLS FIRST, cc_name#17000 ASC NULLS FIRST, d_year#16972 ASC NULLS FIRST, d_moy#16974 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#16922, i_brand#16918, cc_name#17000, 3000), ENSURE_REQUIREMENTS, [id=#17920]
         :                       +- HashAggregate(keys=[i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974], functions=[sum(cs_sales_price#16952)], output=[i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974, sum_sales#16752])
         :                          +- Exchange hashpartitioning(i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974, 3000), ENSURE_REQUIREMENTS, [id=#17917]
         :                             +- HashAggregate(keys=[i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974], functions=[partial_sum(cs_sales_price#16952)], output=[i_category#16922, i_brand#16918, cc_name#17000, d_year#16972, d_moy#16974, sum#17156])
         :                                +- Project [i_brand#16918, i_category#16922, cs_sales_price#16952, d_year#16972, d_moy#16974, cc_name#17000]
         :                                   +- SortMergeJoin [cs_item_sk#16946L], [i_item_sk#16910L], Inner
         :                                      :- Sort [cs_item_sk#16946L ASC NULLS FIRST], false, 0
         :                                      :  +- Exchange hashpartitioning(cs_item_sk#16946L, 3000), ENSURE_REQUIREMENTS, [id=#17909]
         :                                      :     +- Project [cs_item_sk#16946L, cs_sales_price#16952, d_year#16972, d_moy#16974, cc_name#17000]
         :                                      :        +- BroadcastHashJoin [cs_call_center_sk#16942L], [cc_call_center_sk#16994L], Inner, BuildRight, false
         :                                      :           :- Project [cs_call_center_sk#16942L, cs_item_sk#16946L, cs_sales_price#16952, d_year#16972, d_moy#16974]
         :                                      :           :  +- BroadcastHashJoin [cs_sold_date_sk#16965L], [d_date_sk#16966L], Inner, BuildRight, false
         :                                      :           :     :- Filter (isnotnull(cs_item_sk#16946L) AND isnotnull(cs_call_center_sk#16942L))
         :                                      :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_call_center_sk#16942L,cs_item_sk#16946L,cs_sales_price#16952,cs_sold_date_sk#16965L] Batched: true, DataFilters: [isnotnull(cs_item_sk#16946L), isnotnull(cs_call_center_sk#16942L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#16965L), dynamicpruningexpression(cs_sold_date_sk#16965L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_call_center_sk:bigint,cs_item_sk:bigint,cs_sales_price:double>
         :                                      :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#17151, 0, true, Project [d_date_sk#16966L, d_year#16972, d_moy#16974], [d_date_sk#16966L]
         :                                      :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                      :           :     :              +- Filter ((((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2001) AND (d_moy#16974 = 1))) AND isnotnull(d_date_sk#16966L))
         :                                      :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16966L,d_year#16972,d_moy#16974] Batched: true, DataFilters: [(((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                                      :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17900]
         :                                      :           :        +- Filter ((((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2001) AND (d_moy#16974 = 1))) AND isnotnull(d_date_sk#16966L))
         :                                      :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#16966L,d_year#16972,d_moy#16974] Batched: true, DataFilters: [(((d_year#16972 = 2000) OR ((d_year#16972 = 1999) AND (d_moy#16974 = 12))) OR ((d_year#16972 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
         :                                      :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17904]
         :                                      :              +- Filter (isnotnull(cc_call_center_sk#16994L) AND isnotnull(cc_name#17000))
         :                                      :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#16994L,cc_name#17000] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#16994L), isnotnull(cc_name#17000)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:bigint,cc_name:string>
         :                                      +- Sort [i_item_sk#16910L ASC NULLS FIRST], false, 0
         :                                         +- Exchange hashpartitioning(i_item_sk#16910L, 3000), ENSURE_REQUIREMENTS, [id=#17910]
         :                                            +- Filter ((isnotnull(i_item_sk#16910L) AND isnotnull(i_category#16922)) AND isnotnull(i_brand#16918))
         :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#16910L,i_brand#16918,i_category#16922] Batched: true, DataFilters: [isnotnull(i_item_sk#16910L), isnotnull(i_category#16922), isnotnull(i_brand#16918)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>
         +- Sort [i_category#17042 ASC NULLS FIRST, i_brand#17038 ASC NULLS FIRST, cc_name#17120 ASC NULLS FIRST, (rn#17149 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#17042, i_brand#17038, cc_name#17120, (rn#17149 - 1), 3000), ENSURE_REQUIREMENTS, [id=#17958]
               +- Project [i_category#17042, i_brand#17038, cc_name#17120, sum_sales#16752 AS sum_sales#16899, rn#17149]
                  +- Window [rank(d_year#17092, d_moy#17094) windowspecdefinition(i_category#17042, i_brand#17038, cc_name#17120, d_year#17092 ASC NULLS FIRST, d_moy#17094 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#17149], [i_category#17042, i_brand#17038, cc_name#17120], [d_year#17092 ASC NULLS FIRST, d_moy#17094 ASC NULLS FIRST]
                     +- Sort [i_category#17042 ASC NULLS FIRST, i_brand#17038 ASC NULLS FIRST, cc_name#17120 ASC NULLS FIRST, d_year#17092 ASC NULLS FIRST, d_moy#17094 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#17042, i_brand#17038, cc_name#17120, 3000), ENSURE_REQUIREMENTS, [id=#17952]
                           +- HashAggregate(keys=[i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094], functions=[sum(cs_sales_price#17072)], output=[i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094, sum_sales#16752])
                              +- Exchange hashpartitioning(i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094, 3000), ENSURE_REQUIREMENTS, [id=#17949]
                                 +- HashAggregate(keys=[i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094], functions=[partial_sum(cs_sales_price#17072)], output=[i_category#17042, i_brand#17038, cc_name#17120, d_year#17092, d_moy#17094, sum#17158])
                                    +- Project [i_brand#17038, i_category#17042, cs_sales_price#17072, d_year#17092, d_moy#17094, cc_name#17120]
                                       +- SortMergeJoin [cs_item_sk#17066L], [i_item_sk#17030L], Inner
                                          :- Sort [cs_item_sk#17066L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(cs_item_sk#17066L, 3000), ENSURE_REQUIREMENTS, [id=#17941]
                                          :     +- Project [cs_item_sk#17066L, cs_sales_price#17072, d_year#17092, d_moy#17094, cc_name#17120]
                                          :        +- BroadcastHashJoin [cs_call_center_sk#17062L], [cc_call_center_sk#17114L], Inner, BuildRight, false
                                          :           :- Project [cs_call_center_sk#17062L, cs_item_sk#17066L, cs_sales_price#17072, d_year#17092, d_moy#17094]
                                          :           :  +- BroadcastHashJoin [cs_sold_date_sk#17085L], [d_date_sk#17086L], Inner, BuildRight, false
                                          :           :     :- Filter (isnotnull(cs_item_sk#17066L) AND isnotnull(cs_call_center_sk#17062L))
                                          :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_call_center_sk#17062L,cs_item_sk#17066L,cs_sales_price#17072,cs_sold_date_sk#17085L] Batched: true, DataFilters: [isnotnull(cs_item_sk#17066L), isnotnull(cs_call_center_sk#17062L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#17085L), dynamicpruningexpression(cs_sold_date_sk#17085L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_call_center_sk:bigint,cs_item_sk:bigint,cs_sales_price:double>
                                          :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#17152, 0, true, Project [d_date_sk#17086L, d_year#17092, d_moy#17094], [d_date_sk#17086L]
                                          :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :           :     :              +- Filter ((((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2001) AND (d_moy#17094 = 1))) AND isnotnull(d_date_sk#17086L))
                                          :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17086L,d_year#17092,d_moy#17094] Batched: true, DataFilters: [(((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                          :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17932]
                                          :           :        +- Filter ((((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2001) AND (d_moy#17094 = 1))) AND isnotnull(d_date_sk#17086L))
                                          :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17086L,d_year#17092,d_moy#17094] Batched: true, DataFilters: [(((d_year#17092 = 2000) OR ((d_year#17092 = 1999) AND (d_moy#17094 = 12))) OR ((d_year#17092 = 2..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#17936]
                                          :              +- Filter (isnotnull(cc_call_center_sk#17114L) AND isnotnull(cc_name#17120))
                                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#17114L,cc_name#17120] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#17114L), isnotnull(cc_name#17120)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:bigint,cc_name:string>
                                          +- Sort [i_item_sk#17030L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(i_item_sk#17030L, 3000), ENSURE_REQUIREMENTS, [id=#17942]
                                                +- Filter ((isnotnull(i_item_sk#17030L) AND isnotnull(i_category#17042)) AND isnotnull(i_brand#17038))
                                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17030L,i_brand#17038,i_category#17042] Batched: true, DataFilters: [isnotnull(i_item_sk#17030L), isnotnull(i_category#17042), isnotnull(i_brand#17038)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_category:string>

read query: spark_queries/q58.sql
explain query: q58
== Parsed Logical Plan ==
CTE [ss_items, cs_items, ws_items]
:  :- 'SubqueryAlias ss_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#17163, 'sum('ss_ext_sales_price) AS ss_item_rev#17164]
:  :     +- 'Filter ((('ss_item_sk = 'i_item_sk) AND 'd_date IN (list#17166 [])) AND ('ss_sold_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter ('d_week_seq = scalar-subquery#17165 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter ('d_date = 1998-02-19)
:  :        :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  :- 'SubqueryAlias cs_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#17167, 'sum('cs_ext_sales_price) AS cs_item_rev#17168]
:  :     +- 'Filter ((('cs_item_sk = 'i_item_sk) AND 'd_date IN (list#17170 [])) AND ('cs_sold_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter ('d_week_seq = scalar-subquery#17169 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter ('d_date = 1998-02-19)
:  :        :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias ws_items
:     +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#17171, 'sum('ws_ext_sales_price) AS ws_item_rev#17172]
:        +- 'Filter ((('ws_item_sk = 'i_item_sk) AND 'd_date IN (list#17174 [])) AND ('ws_sold_date_sk = 'd_date_sk))
:           :  +- 'Project ['d_date]
:           :     +- 'Filter ('d_week_seq = scalar-subquery#17173 [])
:           :        :  +- 'Project ['d_week_seq]
:           :        :     +- 'Filter ('d_date = 1998-02-19)
:           :        :        +- 'UnresolvedRelation [date_dim], [], false
:           :        +- 'UnresolvedRelation [date_dim], [], false
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_sales], [], false
:              :  +- 'UnresolvedRelation [item], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['item_id ASC NULLS FIRST, 'ss_item_rev ASC NULLS FIRST], true
         +- 'Project ['ss_items.item_id, 'ss_item_rev, ((('ss_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS ss_dev#17159, 'cs_item_rev, ((('cs_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS cs_dev#17160, 'ws_item_rev, ((('ws_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS ws_dev#17161, ((('ss_item_rev + 'cs_item_rev) + 'ws_item_rev) / 3) AS average#17162]
            +- 'Filter (((('ss_items.item_id = 'cs_items.item_id) AND ('ss_items.item_id = 'ws_items.item_id)) AND ((('ss_item_rev >= (0.9 * 'cs_item_rev)) AND ('ss_item_rev <= (1.1 * 'cs_item_rev))) AND (('ss_item_rev >= (0.9 * 'ws_item_rev)) AND ('ss_item_rev <= (1.1 * 'ws_item_rev))))) AND (((('cs_item_rev >= (0.9 * 'ss_item_rev)) AND ('cs_item_rev <= (1.1 * 'ss_item_rev))) AND (('cs_item_rev >= (0.9 * 'ws_item_rev)) AND ('cs_item_rev <= (1.1 * 'ws_item_rev)))) AND ((('ws_item_rev >= (0.9 * 'ss_item_rev)) AND ('ws_item_rev <= (1.1 * 'ss_item_rev))) AND (('ws_item_rev >= (0.9 * 'cs_item_rev)) AND ('ws_item_rev <= (1.1 * 'cs_item_rev))))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'UnresolvedRelation [ss_items], [], false
                  :  +- 'UnresolvedRelation [cs_items], [], false
                  +- 'UnresolvedRelation [ws_items], [], false

== Analyzed Logical Plan ==
item_id: string, ss_item_rev: double, ss_dev: double, cs_item_rev: double, cs_dev: double, ws_item_rev: double, ws_dev: double, average: double
WithCTE
:- CTERelationDef 39
:  +- SubqueryAlias ss_items
:     +- Aggregate [i_item_id#17199], [i_item_id#17199 AS item_id#17163, sum(ss_ext_sales_price#17189) AS ss_item_rev#17164]
:        +- Filter (((ss_item_sk#17176L = i_item_sk#17198L) AND d_date#17222 IN (list#17166 [])) AND (ss_sold_date_sk#17197L = d_date_sk#17220L))
:           :  +- Project [d_date#17418]
:           :     +- Filter (d_week_seq#17420 = scalar-subquery#17165 [])
:           :        :  +- Project [d_week_seq#17448]
:           :        :     +- Filter (d_date#17446 = cast(1998-02-19 as date))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17444L,d_date_id#17445,d_date#17446,d_month_seq#17447,d_week_seq#17448,d_quarter_seq#17449,d_year#17450,d_dow#17451,d_moy#17452,d_dom#17453,d_qoy#17454,d_fy_year#17455,d_fy_quarter_seq#17456,d_fy_week_seq#17457,d_day_name#17458,d_quarter_name#17459,d_holiday#17460,d_weekend#17461,d_following_holiday#17462,d_first_dom#17463,d_last_dom#17464,d_same_day_ly#17465,d_same_day_lq#17466,d_current_day#17467,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17416L,d_date_id#17417,d_date#17418,d_month_seq#17419,d_week_seq#17420,d_quarter_seq#17421,d_year#17422,d_dow#17423,d_moy#17424,d_dom#17425,d_qoy#17426,d_fy_year#17427,d_fy_quarter_seq#17428,d_fy_week_seq#17429,d_day_name#17430,d_quarter_name#17431,d_holiday#17432,d_weekend#17433,d_following_holiday#17434,d_first_dom#17435,d_last_dom#17436,d_same_day_ly#17437,d_same_day_lq#17438,d_current_day#17439,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17175L,ss_item_sk#17176L,ss_customer_sk#17177L,ss_cdemo_sk#17178L,ss_hdemo_sk#17179L,ss_addr_sk#17180L,ss_store_sk#17181L,ss_promo_sk#17182L,ss_ticket_number#17183L,ss_quantity#17184,ss_wholesale_cost#17185,ss_list_price#17186,ss_sales_price#17187,ss_ext_discount_amt#17188,ss_ext_sales_price#17189,ss_ext_wholesale_cost#17190,ss_ext_list_price#17191,ss_ext_tax#17192,ss_coupon_amt#17193,ss_net_paid#17194,ss_net_paid_inc_tax#17195,ss_net_profit#17196,ss_sold_date_sk#17197L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17198L,i_item_id#17199,i_rec_start_date#17200,i_rec_end_date#17201,i_item_desc#17202,i_current_price#17203,i_wholesale_cost#17204,i_brand_id#17205,i_brand#17206,i_class_id#17207,i_class#17208,i_category_id#17209,i_category#17210,i_manufact_id#17211,i_manufact#17212,i_size#17213,i_formulation#17214,i_color#17215,i_units#17216,i_container#17217,i_manager_id#17218,i_product_name#17219] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17220L,d_date_id#17221,d_date#17222,d_month_seq#17223,d_week_seq#17224,d_quarter_seq#17225,d_year#17226,d_dow#17227,d_moy#17228,d_dom#17229,d_qoy#17230,d_fy_year#17231,d_fy_quarter_seq#17232,d_fy_week_seq#17233,d_day_name#17234,d_quarter_name#17235,d_holiday#17236,d_weekend#17237,d_following_holiday#17238,d_first_dom#17239,d_last_dom#17240,d_same_day_ly#17241,d_same_day_lq#17242,d_current_day#17243,... 4 more fields] orc
:- CTERelationDef 40
:  +- SubqueryAlias cs_items
:     +- Aggregate [i_item_id#17283], [i_item_id#17283 AS item_id#17167, sum(cs_ext_sales_price#17270) AS cs_item_rev#17168]
:        +- Filter (((cs_item_sk#17262L = i_item_sk#17282L) AND d_date#17306 IN (list#17170 [])) AND (cs_sold_date_sk#17281L = d_date_sk#17304L))
:           :  +- Project [d_date#17474]
:           :     +- Filter (d_week_seq#17476 = scalar-subquery#17169 [])
:           :        :  +- Project [d_week_seq#17504]
:           :        :     +- Filter (d_date#17502 = cast(1998-02-19 as date))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17500L,d_date_id#17501,d_date#17502,d_month_seq#17503,d_week_seq#17504,d_quarter_seq#17505,d_year#17506,d_dow#17507,d_moy#17508,d_dom#17509,d_qoy#17510,d_fy_year#17511,d_fy_quarter_seq#17512,d_fy_week_seq#17513,d_day_name#17514,d_quarter_name#17515,d_holiday#17516,d_weekend#17517,d_following_holiday#17518,d_first_dom#17519,d_last_dom#17520,d_same_day_ly#17521,d_same_day_lq#17522,d_current_day#17523,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17472L,d_date_id#17473,d_date#17474,d_month_seq#17475,d_week_seq#17476,d_quarter_seq#17477,d_year#17478,d_dow#17479,d_moy#17480,d_dom#17481,d_qoy#17482,d_fy_year#17483,d_fy_quarter_seq#17484,d_fy_week_seq#17485,d_day_name#17486,d_quarter_name#17487,d_holiday#17488,d_weekend#17489,d_following_holiday#17490,d_first_dom#17491,d_last_dom#17492,d_same_day_ly#17493,d_same_day_lq#17494,d_current_day#17495,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#17248L,cs_ship_date_sk#17249L,cs_bill_customer_sk#17250L,cs_bill_cdemo_sk#17251L,cs_bill_hdemo_sk#17252L,cs_bill_addr_sk#17253L,cs_ship_customer_sk#17254L,cs_ship_cdemo_sk#17255L,cs_ship_hdemo_sk#17256L,cs_ship_addr_sk#17257L,cs_call_center_sk#17258L,cs_catalog_page_sk#17259L,cs_ship_mode_sk#17260L,cs_warehouse_sk#17261L,cs_item_sk#17262L,cs_promo_sk#17263L,cs_order_number#17264L,cs_quantity#17265,cs_wholesale_cost#17266,cs_list_price#17267,cs_sales_price#17268,cs_ext_discount_amt#17269,cs_ext_sales_price#17270,cs_ext_wholesale_cost#17271,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17282L,i_item_id#17283,i_rec_start_date#17284,i_rec_end_date#17285,i_item_desc#17286,i_current_price#17287,i_wholesale_cost#17288,i_brand_id#17289,i_brand#17290,i_class_id#17291,i_class#17292,i_category_id#17293,i_category#17294,i_manufact_id#17295,i_manufact#17296,i_size#17297,i_formulation#17298,i_color#17299,i_units#17300,i_container#17301,i_manager_id#17302,i_product_name#17303] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17304L,d_date_id#17305,d_date#17306,d_month_seq#17307,d_week_seq#17308,d_quarter_seq#17309,d_year#17310,d_dow#17311,d_moy#17312,d_dom#17313,d_qoy#17314,d_fy_year#17315,d_fy_quarter_seq#17316,d_fy_week_seq#17317,d_day_name#17318,d_quarter_name#17319,d_holiday#17320,d_weekend#17321,d_following_holiday#17322,d_first_dom#17323,d_last_dom#17324,d_same_day_ly#17325,d_same_day_lq#17326,d_current_day#17327,... 4 more fields] orc
:- CTERelationDef 41
:  +- SubqueryAlias ws_items
:     +- Aggregate [i_item_id#17367], [i_item_id#17367 AS item_id#17171, sum(ws_ext_sales_price#17354) AS ws_item_rev#17172]
:        +- Filter (((ws_item_sk#17334L = i_item_sk#17366L) AND d_date#17390 IN (list#17174 [])) AND (ws_sold_date_sk#17365L = d_date_sk#17388L))
:           :  +- Project [d_date#17530]
:           :     +- Filter (d_week_seq#17532 = scalar-subquery#17173 [])
:           :        :  +- Project [d_week_seq#17560]
:           :        :     +- Filter (d_date#17558 = cast(1998-02-19 as date))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17556L,d_date_id#17557,d_date#17558,d_month_seq#17559,d_week_seq#17560,d_quarter_seq#17561,d_year#17562,d_dow#17563,d_moy#17564,d_dom#17565,d_qoy#17566,d_fy_year#17567,d_fy_quarter_seq#17568,d_fy_week_seq#17569,d_day_name#17570,d_quarter_name#17571,d_holiday#17572,d_weekend#17573,d_following_holiday#17574,d_first_dom#17575,d_last_dom#17576,d_same_day_ly#17577,d_same_day_lq#17578,d_current_day#17579,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17528L,d_date_id#17529,d_date#17530,d_month_seq#17531,d_week_seq#17532,d_quarter_seq#17533,d_year#17534,d_dow#17535,d_moy#17536,d_dom#17537,d_qoy#17538,d_fy_year#17539,d_fy_quarter_seq#17540,d_fy_week_seq#17541,d_day_name#17542,d_quarter_name#17543,d_holiday#17544,d_weekend#17545,d_following_holiday#17546,d_first_dom#17547,d_last_dom#17548,d_same_day_ly#17549,d_same_day_lq#17550,d_current_day#17551,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#17332L,ws_ship_date_sk#17333L,ws_item_sk#17334L,ws_bill_customer_sk#17335L,ws_bill_cdemo_sk#17336L,ws_bill_hdemo_sk#17337L,ws_bill_addr_sk#17338L,ws_ship_customer_sk#17339L,ws_ship_cdemo_sk#17340L,ws_ship_hdemo_sk#17341L,ws_ship_addr_sk#17342L,ws_web_page_sk#17343L,ws_web_site_sk#17344L,ws_ship_mode_sk#17345L,ws_warehouse_sk#17346L,ws_promo_sk#17347L,ws_order_number#17348L,ws_quantity#17349,ws_wholesale_cost#17350,ws_list_price#17351,ws_sales_price#17352,ws_ext_discount_amt#17353,ws_ext_sales_price#17354,ws_ext_wholesale_cost#17355,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17366L,i_item_id#17367,i_rec_start_date#17368,i_rec_end_date#17369,i_item_desc#17370,i_current_price#17371,i_wholesale_cost#17372,i_brand_id#17373,i_brand#17374,i_class_id#17375,i_class#17376,i_category_id#17377,i_category#17378,i_manufact_id#17379,i_manufact#17380,i_size#17381,i_formulation#17382,i_color#17383,i_units#17384,i_container#17385,i_manager_id#17386,i_product_name#17387] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17388L,d_date_id#17389,d_date#17390,d_month_seq#17391,d_week_seq#17392,d_quarter_seq#17393,d_year#17394,d_dow#17395,d_moy#17396,d_dom#17397,d_qoy#17398,d_fy_year#17399,d_fy_quarter_seq#17400,d_fy_week_seq#17401,d_day_name#17402,d_quarter_name#17403,d_holiday#17404,d_weekend#17405,d_following_holiday#17406,d_first_dom#17407,d_last_dom#17408,d_same_day_ly#17409,d_same_day_lq#17410,d_current_day#17411,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [item_id#17163 ASC NULLS FIRST, ss_item_rev#17164 ASC NULLS FIRST], true
         +- Project [item_id#17163, ss_item_rev#17164, (((ss_item_rev#17164 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / cast(3 as double)) * cast(100 as double)) AS ss_dev#17159, cs_item_rev#17168, (((cs_item_rev#17168 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / cast(3 as double)) * cast(100 as double)) AS cs_dev#17160, ws_item_rev#17172, (((ws_item_rev#17172 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / cast(3 as double)) * cast(100 as double)) AS ws_dev#17161, (((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172) / cast(3 as double)) AS average#17162]
            +- Filter ((((item_id#17163 = item_id#17167) AND (item_id#17163 = item_id#17171)) AND (((ss_item_rev#17164 >= (cast(0.9 as double) * cs_item_rev#17168)) AND (ss_item_rev#17164 <= (cast(1.1 as double) * cs_item_rev#17168))) AND ((ss_item_rev#17164 >= (cast(0.9 as double) * ws_item_rev#17172)) AND (ss_item_rev#17164 <= (cast(1.1 as double) * ws_item_rev#17172))))) AND ((((cs_item_rev#17168 >= (cast(0.9 as double) * ss_item_rev#17164)) AND (cs_item_rev#17168 <= (cast(1.1 as double) * ss_item_rev#17164))) AND ((cs_item_rev#17168 >= (cast(0.9 as double) * ws_item_rev#17172)) AND (cs_item_rev#17168 <= (cast(1.1 as double) * ws_item_rev#17172)))) AND (((ws_item_rev#17172 >= (cast(0.9 as double) * ss_item_rev#17164)) AND (ws_item_rev#17172 <= (cast(1.1 as double) * ss_item_rev#17164))) AND ((ws_item_rev#17172 >= (cast(0.9 as double) * cs_item_rev#17168)) AND (ws_item_rev#17172 <= (cast(1.1 as double) * cs_item_rev#17168))))))
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias ss_items
                  :  :  +- CTERelationRef 39, true, [item_id#17163, ss_item_rev#17164]
                  :  +- SubqueryAlias cs_items
                  :     +- CTERelationRef 40, true, [item_id#17167, cs_item_rev#17168]
                  +- SubqueryAlias ws_items
                     +- CTERelationRef 41, true, [item_id#17171, ws_item_rev#17172]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [item_id#17163 ASC NULLS FIRST, ss_item_rev#17164 ASC NULLS FIRST], true
      +- Project [item_id#17163, ss_item_rev#17164, (((ss_item_rev#17164 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS ss_dev#17159, cs_item_rev#17168, (((cs_item_rev#17168 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS cs_dev#17160, ws_item_rev#17172, (((ws_item_rev#17172 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS ws_dev#17161, (((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172) / 3.0) AS average#17162]
         +- Join Inner, (((((((((item_id#17163 = item_id#17171) AND (ss_item_rev#17164 >= (0.9 * ws_item_rev#17172))) AND (ss_item_rev#17164 <= (1.1 * ws_item_rev#17172))) AND (cs_item_rev#17168 >= (0.9 * ws_item_rev#17172))) AND (cs_item_rev#17168 <= (1.1 * ws_item_rev#17172))) AND (ws_item_rev#17172 >= (0.9 * ss_item_rev#17164))) AND (ws_item_rev#17172 <= (1.1 * ss_item_rev#17164))) AND (ws_item_rev#17172 >= (0.9 * cs_item_rev#17168))) AND (ws_item_rev#17172 <= (1.1 * cs_item_rev#17168)))
            :- Project [item_id#17163, ss_item_rev#17164, cs_item_rev#17168]
            :  +- Join Inner, (((((item_id#17163 = item_id#17167) AND (ss_item_rev#17164 >= (0.9 * cs_item_rev#17168))) AND (ss_item_rev#17164 <= (1.1 * cs_item_rev#17168))) AND (cs_item_rev#17168 >= (0.9 * ss_item_rev#17164))) AND (cs_item_rev#17168 <= (1.1 * ss_item_rev#17164)))
            :     :- Filter isnotnull(ss_item_rev#17164)
            :     :  +- Aggregate [i_item_id#17199], [i_item_id#17199 AS item_id#17163, sum(ss_ext_sales_price#17189) AS ss_item_rev#17164]
            :     :     +- Project [ss_ext_sales_price#17189, i_item_id#17199]
            :     :        +- Join Inner, (ss_item_sk#17176L = i_item_sk#17198L)
            :     :           :- Project [ss_item_sk#17176L, ss_ext_sales_price#17189]
            :     :           :  +- Join Inner, (ss_sold_date_sk#17197L = d_date_sk#17220L)
            :     :           :     :- Project [ss_item_sk#17176L, ss_ext_sales_price#17189, ss_sold_date_sk#17197L]
            :     :           :     :  +- Filter ((isnotnull(ss_item_sk#17176L) AND isnotnull(ss_sold_date_sk#17197L)) AND dynamicpruning#17595 [ss_sold_date_sk#17197L])
            :     :           :     :     :  +- Project [d_date_sk#17220L]
            :     :           :     :     :     +- Join LeftSemi, (d_date#17222 = d_date#17418)
            :     :           :     :     :        :- Project [d_date_sk#17220L, d_date#17222]
            :     :           :     :     :        :  +- Filter isnotnull(d_date_sk#17220L)
            :     :           :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17220L,d_date_id#17221,d_date#17222,d_month_seq#17223,d_week_seq#17224,d_quarter_seq#17225,d_year#17226,d_dow#17227,d_moy#17228,d_dom#17229,d_qoy#17230,d_fy_year#17231,d_fy_quarter_seq#17232,d_fy_week_seq#17233,d_day_name#17234,d_quarter_name#17235,d_holiday#17236,d_weekend#17237,d_following_holiday#17238,d_first_dom#17239,d_last_dom#17240,d_same_day_ly#17241,d_same_day_lq#17242,d_current_day#17243,... 4 more fields] orc
            :     :           :     :     :        +- Project [d_date#17418]
            :     :           :     :     :           +- Filter (isnotnull(d_week_seq#17420) AND (d_week_seq#17420 = scalar-subquery#17165 []))
            :     :           :     :     :              :  +- Project [d_week_seq#17448]
            :     :           :     :     :              :     +- Filter (isnotnull(d_date#17446) AND (d_date#17446 = 1998-02-19))
            :     :           :     :     :              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17444L,d_date_id#17445,d_date#17446,d_month_seq#17447,d_week_seq#17448,d_quarter_seq#17449,d_year#17450,d_dow#17451,d_moy#17452,d_dom#17453,d_qoy#17454,d_fy_year#17455,d_fy_quarter_seq#17456,d_fy_week_seq#17457,d_day_name#17458,d_quarter_name#17459,d_holiday#17460,d_weekend#17461,d_following_holiday#17462,d_first_dom#17463,d_last_dom#17464,d_same_day_ly#17465,d_same_day_lq#17466,d_current_day#17467,... 4 more fields] orc
            :     :           :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17416L,d_date_id#17417,d_date#17418,d_month_seq#17419,d_week_seq#17420,d_quarter_seq#17421,d_year#17422,d_dow#17423,d_moy#17424,d_dom#17425,d_qoy#17426,d_fy_year#17427,d_fy_quarter_seq#17428,d_fy_week_seq#17429,d_day_name#17430,d_quarter_name#17431,d_holiday#17432,d_weekend#17433,d_following_holiday#17434,d_first_dom#17435,d_last_dom#17436,d_same_day_ly#17437,d_same_day_lq#17438,d_current_day#17439,... 4 more fields] orc
            :     :           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17175L,ss_item_sk#17176L,ss_customer_sk#17177L,ss_cdemo_sk#17178L,ss_hdemo_sk#17179L,ss_addr_sk#17180L,ss_store_sk#17181L,ss_promo_sk#17182L,ss_ticket_number#17183L,ss_quantity#17184,ss_wholesale_cost#17185,ss_list_price#17186,ss_sales_price#17187,ss_ext_discount_amt#17188,ss_ext_sales_price#17189,ss_ext_wholesale_cost#17190,ss_ext_list_price#17191,ss_ext_tax#17192,ss_coupon_amt#17193,ss_net_paid#17194,ss_net_paid_inc_tax#17195,ss_net_profit#17196,ss_sold_date_sk#17197L] orc
            :     :           :     +- Project [d_date_sk#17220L]
            :     :           :        +- Join LeftSemi, (d_date#17222 = d_date#17418)
            :     :           :           :- Project [d_date_sk#17220L, d_date#17222]
            :     :           :           :  +- Filter isnotnull(d_date_sk#17220L)
            :     :           :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17220L,d_date_id#17221,d_date#17222,d_month_seq#17223,d_week_seq#17224,d_quarter_seq#17225,d_year#17226,d_dow#17227,d_moy#17228,d_dom#17229,d_qoy#17230,d_fy_year#17231,d_fy_quarter_seq#17232,d_fy_week_seq#17233,d_day_name#17234,d_quarter_name#17235,d_holiday#17236,d_weekend#17237,d_following_holiday#17238,d_first_dom#17239,d_last_dom#17240,d_same_day_ly#17241,d_same_day_lq#17242,d_current_day#17243,... 4 more fields] orc
            :     :           :           +- Project [d_date#17418]
            :     :           :              +- Filter (isnotnull(d_week_seq#17420) AND (d_week_seq#17420 = scalar-subquery#17165 []))
            :     :           :                 :  +- Project [d_week_seq#17448]
            :     :           :                 :     +- Filter (isnotnull(d_date#17446) AND (d_date#17446 = 1998-02-19))
            :     :           :                 :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17444L,d_date_id#17445,d_date#17446,d_month_seq#17447,d_week_seq#17448,d_quarter_seq#17449,d_year#17450,d_dow#17451,d_moy#17452,d_dom#17453,d_qoy#17454,d_fy_year#17455,d_fy_quarter_seq#17456,d_fy_week_seq#17457,d_day_name#17458,d_quarter_name#17459,d_holiday#17460,d_weekend#17461,d_following_holiday#17462,d_first_dom#17463,d_last_dom#17464,d_same_day_ly#17465,d_same_day_lq#17466,d_current_day#17467,... 4 more fields] orc
            :     :           :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17416L,d_date_id#17417,d_date#17418,d_month_seq#17419,d_week_seq#17420,d_quarter_seq#17421,d_year#17422,d_dow#17423,d_moy#17424,d_dom#17425,d_qoy#17426,d_fy_year#17427,d_fy_quarter_seq#17428,d_fy_week_seq#17429,d_day_name#17430,d_quarter_name#17431,d_holiday#17432,d_weekend#17433,d_following_holiday#17434,d_first_dom#17435,d_last_dom#17436,d_same_day_ly#17437,d_same_day_lq#17438,d_current_day#17439,... 4 more fields] orc
            :     :           +- Project [i_item_sk#17198L, i_item_id#17199]
            :     :              +- Filter (isnotnull(i_item_sk#17198L) AND isnotnull(i_item_id#17199))
            :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17198L,i_item_id#17199,i_rec_start_date#17200,i_rec_end_date#17201,i_item_desc#17202,i_current_price#17203,i_wholesale_cost#17204,i_brand_id#17205,i_brand#17206,i_class_id#17207,i_class#17208,i_category_id#17209,i_category#17210,i_manufact_id#17211,i_manufact#17212,i_size#17213,i_formulation#17214,i_color#17215,i_units#17216,i_container#17217,i_manager_id#17218,i_product_name#17219] orc
            :     +- Filter isnotnull(cs_item_rev#17168)
            :        +- Aggregate [i_item_id#17283], [i_item_id#17283 AS item_id#17167, sum(cs_ext_sales_price#17270) AS cs_item_rev#17168]
            :           +- Project [cs_ext_sales_price#17270, i_item_id#17283]
            :              +- Join Inner, (cs_item_sk#17262L = i_item_sk#17282L)
            :                 :- Project [cs_item_sk#17262L, cs_ext_sales_price#17270]
            :                 :  +- Join Inner, (cs_sold_date_sk#17281L = d_date_sk#17304L)
            :                 :     :- Project [cs_item_sk#17262L, cs_ext_sales_price#17270, cs_sold_date_sk#17281L]
            :                 :     :  +- Filter ((isnotnull(cs_item_sk#17262L) AND isnotnull(cs_sold_date_sk#17281L)) AND dynamicpruning#17596 [cs_sold_date_sk#17281L])
            :                 :     :     :  +- Project [d_date_sk#17304L]
            :                 :     :     :     +- Join LeftSemi, (d_date#17306 = d_date#17474)
            :                 :     :     :        :- Project [d_date_sk#17304L, d_date#17306]
            :                 :     :     :        :  +- Filter isnotnull(d_date_sk#17304L)
            :                 :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17304L,d_date_id#17305,d_date#17306,d_month_seq#17307,d_week_seq#17308,d_quarter_seq#17309,d_year#17310,d_dow#17311,d_moy#17312,d_dom#17313,d_qoy#17314,d_fy_year#17315,d_fy_quarter_seq#17316,d_fy_week_seq#17317,d_day_name#17318,d_quarter_name#17319,d_holiday#17320,d_weekend#17321,d_following_holiday#17322,d_first_dom#17323,d_last_dom#17324,d_same_day_ly#17325,d_same_day_lq#17326,d_current_day#17327,... 4 more fields] orc
            :                 :     :     :        +- Project [d_date#17474]
            :                 :     :     :           +- Filter (isnotnull(d_week_seq#17476) AND (d_week_seq#17476 = scalar-subquery#17169 []))
            :                 :     :     :              :  +- Project [d_week_seq#17504]
            :                 :     :     :              :     +- Filter (isnotnull(d_date#17502) AND (d_date#17502 = 1998-02-19))
            :                 :     :     :              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17500L,d_date_id#17501,d_date#17502,d_month_seq#17503,d_week_seq#17504,d_quarter_seq#17505,d_year#17506,d_dow#17507,d_moy#17508,d_dom#17509,d_qoy#17510,d_fy_year#17511,d_fy_quarter_seq#17512,d_fy_week_seq#17513,d_day_name#17514,d_quarter_name#17515,d_holiday#17516,d_weekend#17517,d_following_holiday#17518,d_first_dom#17519,d_last_dom#17520,d_same_day_ly#17521,d_same_day_lq#17522,d_current_day#17523,... 4 more fields] orc
            :                 :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17472L,d_date_id#17473,d_date#17474,d_month_seq#17475,d_week_seq#17476,d_quarter_seq#17477,d_year#17478,d_dow#17479,d_moy#17480,d_dom#17481,d_qoy#17482,d_fy_year#17483,d_fy_quarter_seq#17484,d_fy_week_seq#17485,d_day_name#17486,d_quarter_name#17487,d_holiday#17488,d_weekend#17489,d_following_holiday#17490,d_first_dom#17491,d_last_dom#17492,d_same_day_ly#17493,d_same_day_lq#17494,d_current_day#17495,... 4 more fields] orc
            :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#17248L,cs_ship_date_sk#17249L,cs_bill_customer_sk#17250L,cs_bill_cdemo_sk#17251L,cs_bill_hdemo_sk#17252L,cs_bill_addr_sk#17253L,cs_ship_customer_sk#17254L,cs_ship_cdemo_sk#17255L,cs_ship_hdemo_sk#17256L,cs_ship_addr_sk#17257L,cs_call_center_sk#17258L,cs_catalog_page_sk#17259L,cs_ship_mode_sk#17260L,cs_warehouse_sk#17261L,cs_item_sk#17262L,cs_promo_sk#17263L,cs_order_number#17264L,cs_quantity#17265,cs_wholesale_cost#17266,cs_list_price#17267,cs_sales_price#17268,cs_ext_discount_amt#17269,cs_ext_sales_price#17270,cs_ext_wholesale_cost#17271,... 10 more fields] orc
            :                 :     +- Project [d_date_sk#17304L]
            :                 :        +- Join LeftSemi, (d_date#17306 = d_date#17474)
            :                 :           :- Project [d_date_sk#17304L, d_date#17306]
            :                 :           :  +- Filter isnotnull(d_date_sk#17304L)
            :                 :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17304L,d_date_id#17305,d_date#17306,d_month_seq#17307,d_week_seq#17308,d_quarter_seq#17309,d_year#17310,d_dow#17311,d_moy#17312,d_dom#17313,d_qoy#17314,d_fy_year#17315,d_fy_quarter_seq#17316,d_fy_week_seq#17317,d_day_name#17318,d_quarter_name#17319,d_holiday#17320,d_weekend#17321,d_following_holiday#17322,d_first_dom#17323,d_last_dom#17324,d_same_day_ly#17325,d_same_day_lq#17326,d_current_day#17327,... 4 more fields] orc
            :                 :           +- Project [d_date#17474]
            :                 :              +- Filter (isnotnull(d_week_seq#17476) AND (d_week_seq#17476 = scalar-subquery#17169 []))
            :                 :                 :  +- Project [d_week_seq#17504]
            :                 :                 :     +- Filter (isnotnull(d_date#17502) AND (d_date#17502 = 1998-02-19))
            :                 :                 :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17500L,d_date_id#17501,d_date#17502,d_month_seq#17503,d_week_seq#17504,d_quarter_seq#17505,d_year#17506,d_dow#17507,d_moy#17508,d_dom#17509,d_qoy#17510,d_fy_year#17511,d_fy_quarter_seq#17512,d_fy_week_seq#17513,d_day_name#17514,d_quarter_name#17515,d_holiday#17516,d_weekend#17517,d_following_holiday#17518,d_first_dom#17519,d_last_dom#17520,d_same_day_ly#17521,d_same_day_lq#17522,d_current_day#17523,... 4 more fields] orc
            :                 :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17472L,d_date_id#17473,d_date#17474,d_month_seq#17475,d_week_seq#17476,d_quarter_seq#17477,d_year#17478,d_dow#17479,d_moy#17480,d_dom#17481,d_qoy#17482,d_fy_year#17483,d_fy_quarter_seq#17484,d_fy_week_seq#17485,d_day_name#17486,d_quarter_name#17487,d_holiday#17488,d_weekend#17489,d_following_holiday#17490,d_first_dom#17491,d_last_dom#17492,d_same_day_ly#17493,d_same_day_lq#17494,d_current_day#17495,... 4 more fields] orc
            :                 +- Project [i_item_sk#17282L, i_item_id#17283]
            :                    +- Filter (isnotnull(i_item_sk#17282L) AND isnotnull(i_item_id#17283))
            :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17282L,i_item_id#17283,i_rec_start_date#17284,i_rec_end_date#17285,i_item_desc#17286,i_current_price#17287,i_wholesale_cost#17288,i_brand_id#17289,i_brand#17290,i_class_id#17291,i_class#17292,i_category_id#17293,i_category#17294,i_manufact_id#17295,i_manufact#17296,i_size#17297,i_formulation#17298,i_color#17299,i_units#17300,i_container#17301,i_manager_id#17302,i_product_name#17303] orc
            +- Filter isnotnull(ws_item_rev#17172)
               +- Aggregate [i_item_id#17367], [i_item_id#17367 AS item_id#17171, sum(ws_ext_sales_price#17354) AS ws_item_rev#17172]
                  +- Project [ws_ext_sales_price#17354, i_item_id#17367]
                     +- Join Inner, (ws_item_sk#17334L = i_item_sk#17366L)
                        :- Project [ws_item_sk#17334L, ws_ext_sales_price#17354]
                        :  +- Join Inner, (ws_sold_date_sk#17365L = d_date_sk#17388L)
                        :     :- Project [ws_item_sk#17334L, ws_ext_sales_price#17354, ws_sold_date_sk#17365L]
                        :     :  +- Filter ((isnotnull(ws_item_sk#17334L) AND isnotnull(ws_sold_date_sk#17365L)) AND dynamicpruning#17597 [ws_sold_date_sk#17365L])
                        :     :     :  +- Project [d_date_sk#17388L]
                        :     :     :     +- Join LeftSemi, (d_date#17390 = d_date#17530)
                        :     :     :        :- Project [d_date_sk#17388L, d_date#17390]
                        :     :     :        :  +- Filter isnotnull(d_date_sk#17388L)
                        :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17388L,d_date_id#17389,d_date#17390,d_month_seq#17391,d_week_seq#17392,d_quarter_seq#17393,d_year#17394,d_dow#17395,d_moy#17396,d_dom#17397,d_qoy#17398,d_fy_year#17399,d_fy_quarter_seq#17400,d_fy_week_seq#17401,d_day_name#17402,d_quarter_name#17403,d_holiday#17404,d_weekend#17405,d_following_holiday#17406,d_first_dom#17407,d_last_dom#17408,d_same_day_ly#17409,d_same_day_lq#17410,d_current_day#17411,... 4 more fields] orc
                        :     :     :        +- Project [d_date#17530]
                        :     :     :           +- Filter (isnotnull(d_week_seq#17532) AND (d_week_seq#17532 = scalar-subquery#17173 []))
                        :     :     :              :  +- Project [d_week_seq#17560]
                        :     :     :              :     +- Filter (isnotnull(d_date#17558) AND (d_date#17558 = 1998-02-19))
                        :     :     :              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17556L,d_date_id#17557,d_date#17558,d_month_seq#17559,d_week_seq#17560,d_quarter_seq#17561,d_year#17562,d_dow#17563,d_moy#17564,d_dom#17565,d_qoy#17566,d_fy_year#17567,d_fy_quarter_seq#17568,d_fy_week_seq#17569,d_day_name#17570,d_quarter_name#17571,d_holiday#17572,d_weekend#17573,d_following_holiday#17574,d_first_dom#17575,d_last_dom#17576,d_same_day_ly#17577,d_same_day_lq#17578,d_current_day#17579,... 4 more fields] orc
                        :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17528L,d_date_id#17529,d_date#17530,d_month_seq#17531,d_week_seq#17532,d_quarter_seq#17533,d_year#17534,d_dow#17535,d_moy#17536,d_dom#17537,d_qoy#17538,d_fy_year#17539,d_fy_quarter_seq#17540,d_fy_week_seq#17541,d_day_name#17542,d_quarter_name#17543,d_holiday#17544,d_weekend#17545,d_following_holiday#17546,d_first_dom#17547,d_last_dom#17548,d_same_day_ly#17549,d_same_day_lq#17550,d_current_day#17551,... 4 more fields] orc
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#17332L,ws_ship_date_sk#17333L,ws_item_sk#17334L,ws_bill_customer_sk#17335L,ws_bill_cdemo_sk#17336L,ws_bill_hdemo_sk#17337L,ws_bill_addr_sk#17338L,ws_ship_customer_sk#17339L,ws_ship_cdemo_sk#17340L,ws_ship_hdemo_sk#17341L,ws_ship_addr_sk#17342L,ws_web_page_sk#17343L,ws_web_site_sk#17344L,ws_ship_mode_sk#17345L,ws_warehouse_sk#17346L,ws_promo_sk#17347L,ws_order_number#17348L,ws_quantity#17349,ws_wholesale_cost#17350,ws_list_price#17351,ws_sales_price#17352,ws_ext_discount_amt#17353,ws_ext_sales_price#17354,ws_ext_wholesale_cost#17355,... 10 more fields] orc
                        :     +- Project [d_date_sk#17388L]
                        :        +- Join LeftSemi, (d_date#17390 = d_date#17530)
                        :           :- Project [d_date_sk#17388L, d_date#17390]
                        :           :  +- Filter isnotnull(d_date_sk#17388L)
                        :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17388L,d_date_id#17389,d_date#17390,d_month_seq#17391,d_week_seq#17392,d_quarter_seq#17393,d_year#17394,d_dow#17395,d_moy#17396,d_dom#17397,d_qoy#17398,d_fy_year#17399,d_fy_quarter_seq#17400,d_fy_week_seq#17401,d_day_name#17402,d_quarter_name#17403,d_holiday#17404,d_weekend#17405,d_following_holiday#17406,d_first_dom#17407,d_last_dom#17408,d_same_day_ly#17409,d_same_day_lq#17410,d_current_day#17411,... 4 more fields] orc
                        :           +- Project [d_date#17530]
                        :              +- Filter (isnotnull(d_week_seq#17532) AND (d_week_seq#17532 = scalar-subquery#17173 []))
                        :                 :  +- Project [d_week_seq#17560]
                        :                 :     +- Filter (isnotnull(d_date#17558) AND (d_date#17558 = 1998-02-19))
                        :                 :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17556L,d_date_id#17557,d_date#17558,d_month_seq#17559,d_week_seq#17560,d_quarter_seq#17561,d_year#17562,d_dow#17563,d_moy#17564,d_dom#17565,d_qoy#17566,d_fy_year#17567,d_fy_quarter_seq#17568,d_fy_week_seq#17569,d_day_name#17570,d_quarter_name#17571,d_holiday#17572,d_weekend#17573,d_following_holiday#17574,d_first_dom#17575,d_last_dom#17576,d_same_day_ly#17577,d_same_day_lq#17578,d_current_day#17579,... 4 more fields] orc
                        :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17528L,d_date_id#17529,d_date#17530,d_month_seq#17531,d_week_seq#17532,d_quarter_seq#17533,d_year#17534,d_dow#17535,d_moy#17536,d_dom#17537,d_qoy#17538,d_fy_year#17539,d_fy_quarter_seq#17540,d_fy_week_seq#17541,d_day_name#17542,d_quarter_name#17543,d_holiday#17544,d_weekend#17545,d_following_holiday#17546,d_first_dom#17547,d_last_dom#17548,d_same_day_ly#17549,d_same_day_lq#17550,d_current_day#17551,... 4 more fields] orc
                        +- Project [i_item_sk#17366L, i_item_id#17367]
                           +- Filter (isnotnull(i_item_sk#17366L) AND isnotnull(i_item_id#17367))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17366L,i_item_id#17367,i_rec_start_date#17368,i_rec_end_date#17369,i_item_desc#17370,i_current_price#17371,i_wholesale_cost#17372,i_brand_id#17373,i_brand#17374,i_class_id#17375,i_class#17376,i_category_id#17377,i_category#17378,i_manufact_id#17379,i_manufact#17380,i_size#17381,i_formulation#17382,i_color#17383,i_units#17384,i_container#17385,i_manager_id#17386,i_product_name#17387] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[item_id#17163 ASC NULLS FIRST,ss_item_rev#17164 ASC NULLS FIRST], output=[item_id#17163,ss_item_rev#17164,ss_dev#17159,cs_item_rev#17168,cs_dev#17160,ws_item_rev#17172,ws_dev#17161,average#17162])
   +- Project [item_id#17163, ss_item_rev#17164, (((ss_item_rev#17164 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS ss_dev#17159, cs_item_rev#17168, (((cs_item_rev#17168 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS cs_dev#17160, ws_item_rev#17172, (((ws_item_rev#17172 / ((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172)) / 3.0) * 100.0) AS ws_dev#17161, (((ss_item_rev#17164 + cs_item_rev#17168) + ws_item_rev#17172) / 3.0) AS average#17162]
      +- BroadcastHashJoin [item_id#17163], [item_id#17171], Inner, BuildRight, ((((((((ss_item_rev#17164 >= (0.9 * ws_item_rev#17172)) AND (ss_item_rev#17164 <= (1.1 * ws_item_rev#17172))) AND (cs_item_rev#17168 >= (0.9 * ws_item_rev#17172))) AND (cs_item_rev#17168 <= (1.1 * ws_item_rev#17172))) AND (ws_item_rev#17172 >= (0.9 * ss_item_rev#17164))) AND (ws_item_rev#17172 <= (1.1 * ss_item_rev#17164))) AND (ws_item_rev#17172 >= (0.9 * cs_item_rev#17168))) AND (ws_item_rev#17172 <= (1.1 * cs_item_rev#17168))), false
         :- Project [item_id#17163, ss_item_rev#17164, cs_item_rev#17168]
         :  +- BroadcastHashJoin [item_id#17163], [item_id#17167], Inner, BuildRight, ((((ss_item_rev#17164 >= (0.9 * cs_item_rev#17168)) AND (ss_item_rev#17164 <= (1.1 * cs_item_rev#17168))) AND (cs_item_rev#17168 >= (0.9 * ss_item_rev#17164))) AND (cs_item_rev#17168 <= (1.1 * ss_item_rev#17164))), false
         :     :- Filter isnotnull(ss_item_rev#17164)
         :     :  +- HashAggregate(keys=[i_item_id#17199], functions=[sum(ss_ext_sales_price#17189)], output=[item_id#17163, ss_item_rev#17164])
         :     :     +- Exchange hashpartitioning(i_item_id#17199, 3000), ENSURE_REQUIREMENTS, [id=#18393]
         :     :        +- HashAggregate(keys=[i_item_id#17199], functions=[partial_sum(ss_ext_sales_price#17189)], output=[i_item_id#17199, sum#17599])
         :     :           +- Project [ss_ext_sales_price#17189, i_item_id#17199]
         :     :              +- SortMergeJoin [ss_item_sk#17176L], [i_item_sk#17198L], Inner
         :     :                 :- Sort [ss_item_sk#17176L ASC NULLS FIRST], false, 0
         :     :                 :  +- Exchange hashpartitioning(ss_item_sk#17176L, 3000), ENSURE_REQUIREMENTS, [id=#18385]
         :     :                 :     +- Project [ss_item_sk#17176L, ss_ext_sales_price#17189]
         :     :                 :        +- BroadcastHashJoin [ss_sold_date_sk#17197L], [d_date_sk#17220L], Inner, BuildRight, false
         :     :                 :           :- Filter isnotnull(ss_item_sk#17176L)
         :     :                 :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#17176L,ss_ext_sales_price#17189,ss_sold_date_sk#17197L] Batched: true, DataFilters: [isnotnull(ss_item_sk#17176L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#17197L), dynamicpruningexpression(ss_sold_date_sk#17197L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
         :     :                 :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#17595, 0, true, Project [d_date_sk#17220L], [d_date_sk#17220L]
         :     :                 :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                 :           :              +- Project [d_date_sk#17220L]
         :     :                 :           :                 +- BroadcastHashJoin [d_date#17222], [d_date#17418], LeftSemi, BuildRight, false
         :     :                 :           :                    :- Filter isnotnull(d_date_sk#17220L)
         :     :                 :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17220L,d_date#17222] Batched: true, DataFilters: [isnotnull(d_date_sk#17220L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :     :                 :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18210]
         :     :                 :           :                       +- Project [d_date#17418]
         :     :                 :           :                          +- Filter (isnotnull(d_week_seq#17420) AND (d_week_seq#17420 = Subquery subquery#17165, [id=#18202]))
         :     :                 :           :                             :  +- Subquery subquery#17165, [id=#18202]
         :     :                 :           :                             :     +- AdaptiveSparkPlan isFinalPlan=false
         :     :                 :           :                             :        +- Project [d_week_seq#17448]
         :     :                 :           :                             :           +- Filter (isnotnull(d_date#17446) AND (d_date#17446 = 1998-02-19))
         :     :                 :           :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17446,d_week_seq#17448] Batched: true, DataFilters: [isnotnull(d_date#17446), (d_date#17446 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :                 :           :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17418,d_week_seq#17420] Batched: true, DataFilters: [isnotnull(d_week_seq#17420)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#18380]
         :     :                 :              +- Project [d_date_sk#17220L]
         :     :                 :                 +- BroadcastHashJoin [d_date#17222], [d_date#17418], LeftSemi, BuildRight, false
         :     :                 :                    :- Filter isnotnull(d_date_sk#17220L)
         :     :                 :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17220L,d_date#17222] Batched: true, DataFilters: [isnotnull(d_date_sk#17220L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :     :                 :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18376]
         :     :                 :                       +- Project [d_date#17418]
         :     :                 :                          +- Filter (isnotnull(d_week_seq#17420) AND (d_week_seq#17420 = Subquery subquery#17165, [id=#18219]))
         :     :                 :                             :  +- Subquery subquery#17165, [id=#18219]
         :     :                 :                             :     +- AdaptiveSparkPlan isFinalPlan=false
         :     :                 :                             :        +- Project [d_week_seq#17448]
         :     :                 :                             :           +- Filter (isnotnull(d_date#17446) AND (d_date#17446 = 1998-02-19))
         :     :                 :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17446,d_week_seq#17448] Batched: true, DataFilters: [isnotnull(d_date#17446), (d_date#17446 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :                 :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17418,d_week_seq#17420] Batched: true, DataFilters: [isnotnull(d_week_seq#17420)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :                 +- Sort [i_item_sk#17198L ASC NULLS FIRST], false, 0
         :     :                    +- Exchange hashpartitioning(i_item_sk#17198L, 3000), ENSURE_REQUIREMENTS, [id=#18386]
         :     :                       +- Filter (isnotnull(i_item_sk#17198L) AND isnotnull(i_item_id#17199))
         :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17198L,i_item_id#17199] Batched: true, DataFilters: [isnotnull(i_item_sk#17198L), isnotnull(i_item_id#17199)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
         :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#18417]
         :        +- Filter isnotnull(cs_item_rev#17168)
         :           +- HashAggregate(keys=[i_item_id#17283], functions=[sum(cs_ext_sales_price#17270)], output=[item_id#17167, cs_item_rev#17168])
         :              +- Exchange hashpartitioning(i_item_id#17283, 3000), ENSURE_REQUIREMENTS, [id=#18413]
         :                 +- HashAggregate(keys=[i_item_id#17283], functions=[partial_sum(cs_ext_sales_price#17270)], output=[i_item_id#17283, sum#17601])
         :                    +- Project [cs_ext_sales_price#17270, i_item_id#17283]
         :                       +- SortMergeJoin [cs_item_sk#17262L], [i_item_sk#17282L], Inner
         :                          :- Sort [cs_item_sk#17262L ASC NULLS FIRST], false, 0
         :                          :  +- Exchange hashpartitioning(cs_item_sk#17262L, 3000), ENSURE_REQUIREMENTS, [id=#18405]
         :                          :     +- Project [cs_item_sk#17262L, cs_ext_sales_price#17270]
         :                          :        +- BroadcastHashJoin [cs_sold_date_sk#17281L], [d_date_sk#17304L], Inner, BuildRight, false
         :                          :           :- Filter isnotnull(cs_item_sk#17262L)
         :                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#17262L,cs_ext_sales_price#17270,cs_sold_date_sk#17281L] Batched: true, DataFilters: [isnotnull(cs_item_sk#17262L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#17281L), dynamicpruningexpression(cs_sold_date_sk#17281L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_ext_sales_price:double>
         :                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#17596, 0, true, Project [d_date_sk#17304L], [d_date_sk#17304L]
         :                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                          :           :              +- Project [d_date_sk#17304L]
         :                          :           :                 +- BroadcastHashJoin [d_date#17306], [d_date#17474], LeftSemi, BuildRight, false
         :                          :           :                    :- Filter isnotnull(d_date_sk#17304L)
         :                          :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17304L,d_date#17306] Batched: true, DataFilters: [isnotnull(d_date_sk#17304L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :                          :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18248]
         :                          :           :                       +- Project [d_date#17474]
         :                          :           :                          +- Filter (isnotnull(d_week_seq#17476) AND (d_week_seq#17476 = Subquery subquery#17169, [id=#18240]))
         :                          :           :                             :  +- Subquery subquery#17169, [id=#18240]
         :                          :           :                             :     +- AdaptiveSparkPlan isFinalPlan=false
         :                          :           :                             :        +- Project [d_week_seq#17504]
         :                          :           :                             :           +- Filter (isnotnull(d_date#17502) AND (d_date#17502 = 1998-02-19))
         :                          :           :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17502,d_week_seq#17504] Batched: true, DataFilters: [isnotnull(d_date#17502), (d_date#17502 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                          :           :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17474,d_week_seq#17476] Batched: true, DataFilters: [isnotnull(d_week_seq#17476)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#18400]
         :                          :              +- Project [d_date_sk#17304L]
         :                          :                 +- BroadcastHashJoin [d_date#17306], [d_date#17474], LeftSemi, BuildRight, false
         :                          :                    :- Filter isnotnull(d_date_sk#17304L)
         :                          :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17304L,d_date#17306] Batched: true, DataFilters: [isnotnull(d_date_sk#17304L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :                          :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18396]
         :                          :                       +- Project [d_date#17474]
         :                          :                          +- Filter (isnotnull(d_week_seq#17476) AND (d_week_seq#17476 = Subquery subquery#17169, [id=#18257]))
         :                          :                             :  +- Subquery subquery#17169, [id=#18257]
         :                          :                             :     +- AdaptiveSparkPlan isFinalPlan=false
         :                          :                             :        +- Project [d_week_seq#17504]
         :                          :                             :           +- Filter (isnotnull(d_date#17502) AND (d_date#17502 = 1998-02-19))
         :                          :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17502,d_week_seq#17504] Batched: true, DataFilters: [isnotnull(d_date#17502), (d_date#17502 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                          :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17474,d_week_seq#17476] Batched: true, DataFilters: [isnotnull(d_week_seq#17476)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                          +- Sort [i_item_sk#17282L ASC NULLS FIRST], false, 0
         :                             +- Exchange hashpartitioning(i_item_sk#17282L, 3000), ENSURE_REQUIREMENTS, [id=#18406]
         :                                +- Filter (isnotnull(i_item_sk#17282L) AND isnotnull(i_item_id#17283))
         :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17282L,i_item_id#17283] Batched: true, DataFilters: [isnotnull(i_item_sk#17282L), isnotnull(i_item_id#17283)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
         +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#18441]
            +- Filter isnotnull(ws_item_rev#17172)
               +- HashAggregate(keys=[i_item_id#17367], functions=[sum(ws_ext_sales_price#17354)], output=[item_id#17171, ws_item_rev#17172])
                  +- Exchange hashpartitioning(i_item_id#17367, 3000), ENSURE_REQUIREMENTS, [id=#18437]
                     +- HashAggregate(keys=[i_item_id#17367], functions=[partial_sum(ws_ext_sales_price#17354)], output=[i_item_id#17367, sum#17603])
                        +- Project [ws_ext_sales_price#17354, i_item_id#17367]
                           +- SortMergeJoin [ws_item_sk#17334L], [i_item_sk#17366L], Inner
                              :- Sort [ws_item_sk#17334L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_item_sk#17334L, 3000), ENSURE_REQUIREMENTS, [id=#18429]
                              :     +- Project [ws_item_sk#17334L, ws_ext_sales_price#17354]
                              :        +- BroadcastHashJoin [ws_sold_date_sk#17365L], [d_date_sk#17388L], Inner, BuildRight, false
                              :           :- Filter isnotnull(ws_item_sk#17334L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#17334L,ws_ext_sales_price#17354,ws_sold_date_sk#17365L] Batched: true, DataFilters: [isnotnull(ws_item_sk#17334L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#17365L), dynamicpruningexpression(ws_sold_date_sk#17365L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_ext_sales_price:double>
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#17597, 0, true, Project [d_date_sk#17388L], [d_date_sk#17388L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Project [d_date_sk#17388L]
                              :           :                 +- BroadcastHashJoin [d_date#17390], [d_date#17530], LeftSemi, BuildRight, false
                              :           :                    :- Filter isnotnull(d_date_sk#17388L)
                              :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17388L,d_date#17390] Batched: true, DataFilters: [isnotnull(d_date_sk#17388L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18286]
                              :           :                       +- Project [d_date#17530]
                              :           :                          +- Filter (isnotnull(d_week_seq#17532) AND (d_week_seq#17532 = Subquery subquery#17173, [id=#18278]))
                              :           :                             :  +- Subquery subquery#17173, [id=#18278]
                              :           :                             :     +- AdaptiveSparkPlan isFinalPlan=false
                              :           :                             :        +- Project [d_week_seq#17560]
                              :           :                             :           +- Filter (isnotnull(d_date#17558) AND (d_date#17558 = 1998-02-19))
                              :           :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17558,d_week_seq#17560] Batched: true, DataFilters: [isnotnull(d_date#17558), (d_date#17558 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
                              :           :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17530,d_week_seq#17532] Batched: true, DataFilters: [isnotnull(d_week_seq#17532)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#18424]
                              :              +- Project [d_date_sk#17388L]
                              :                 +- BroadcastHashJoin [d_date#17390], [d_date#17530], LeftSemi, BuildRight, false
                              :                    :- Filter isnotnull(d_date_sk#17388L)
                              :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17388L,d_date#17390] Batched: true, DataFilters: [isnotnull(d_date_sk#17388L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
                              :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#18420]
                              :                       +- Project [d_date#17530]
                              :                          +- Filter (isnotnull(d_week_seq#17532) AND (d_week_seq#17532 = Subquery subquery#17173, [id=#18295]))
                              :                             :  +- Subquery subquery#17173, [id=#18295]
                              :                             :     +- AdaptiveSparkPlan isFinalPlan=false
                              :                             :        +- Project [d_week_seq#17560]
                              :                             :           +- Filter (isnotnull(d_date#17558) AND (d_date#17558 = 1998-02-19))
                              :                             :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17558,d_week_seq#17560] Batched: true, DataFilters: [isnotnull(d_date#17558), (d_date#17558 = 1998-02-19)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,1998-02-19)], ReadSchema: struct<d_date:date,d_week_seq:int>
                              :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#17530,d_week_seq#17532] Batched: true, DataFilters: [isnotnull(d_week_seq#17532)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>
                              +- Sort [i_item_sk#17366L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(i_item_sk#17366L, 3000), ENSURE_REQUIREMENTS, [id=#18430]
                                    +- Filter (isnotnull(i_item_sk#17366L) AND isnotnull(i_item_id#17367))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17366L,i_item_id#17367] Batched: true, DataFilters: [isnotnull(i_item_sk#17366L), isnotnull(i_item_id#17367)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q59.sql
explain query: q59
== Parsed Logical Plan ==
CTE [wss]
:  +- 'SubqueryAlias wss
:     +- 'Aggregate ['d_week_seq, 'ss_store_sk], ['d_week_seq, 'ss_store_sk, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'ss_sales_price ELSE null END) AS sun_sales#17624, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'ss_sales_price ELSE null END) AS mon_sales#17625, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'ss_sales_price ELSE null END) AS tue_sales#17626, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'ss_sales_price ELSE null END) AS wed_sales#17627, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'ss_sales_price ELSE null END) AS thu_sales#17628, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'ss_sales_price ELSE null END) AS fri_sales#17629, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'ss_sales_price ELSE null END) AS sat_sales#17630]
:        +- 'Filter ('d_date_sk = 'ss_sold_date_sk)
:           +- 'Join Inner
:              :- 'UnresolvedRelation [store_sales], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['s_store_name1 ASC NULLS FIRST, 's_store_id1 ASC NULLS FIRST, 'd_week_seq1 ASC NULLS FIRST], true
         +- 'Project ['s_store_name1, 's_store_id1, 'd_week_seq1, unresolvedalias(('sun_sales1 / 'sun_sales2), None), unresolvedalias(('mon_sales1 / 'mon_sales2), None), unresolvedalias(('tue_sales1 / 'tue_sales1), None), unresolvedalias(('wed_sales1 / 'wed_sales2), None), unresolvedalias(('thu_sales1 / 'thu_sales2), None), unresolvedalias(('fri_sales1 / 'fri_sales2), None), unresolvedalias(('sat_sales1 / 'sat_sales2), None)]
            +- 'Filter (('s_store_id1 = 's_store_id2) AND ('d_week_seq1 = ('d_week_seq2 - 52)))
               +- 'Join Inner
                  :- 'SubqueryAlias y
                  :  +- 'Project ['s_store_name AS s_store_name1#17604, 'wss.d_week_seq AS d_week_seq1#17605, 's_store_id AS s_store_id1#17606, 'sun_sales AS sun_sales1#17607, 'mon_sales AS mon_sales1#17608, 'tue_sales AS tue_sales1#17609, 'wed_sales AS wed_sales1#17610, 'thu_sales AS thu_sales1#17611, 'fri_sales AS fri_sales1#17612, 'sat_sales AS sat_sales1#17613]
                  :     +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) AND ('ss_store_sk = 's_store_sk)) AND (('d_month_seq >= 1185) AND ('d_month_seq <= (1185 + 11))))
                  :        +- 'Join Inner
                  :           :- 'Join Inner
                  :           :  :- 'UnresolvedRelation [wss], [], false
                  :           :  +- 'UnresolvedRelation [store], [], false
                  :           +- 'SubqueryAlias d
                  :              +- 'UnresolvedRelation [date_dim], [], false
                  +- 'SubqueryAlias x
                     +- 'Project ['s_store_name AS s_store_name2#17614, 'wss.d_week_seq AS d_week_seq2#17615, 's_store_id AS s_store_id2#17616, 'sun_sales AS sun_sales2#17617, 'mon_sales AS mon_sales2#17618, 'tue_sales AS tue_sales2#17619, 'wed_sales AS wed_sales2#17620, 'thu_sales AS thu_sales2#17621, 'fri_sales AS fri_sales2#17622, 'sat_sales AS sat_sales2#17623]
                        +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) AND ('ss_store_sk = 's_store_sk)) AND (('d_month_seq >= (1185 + 12)) AND ('d_month_seq <= (1185 + 23))))
                           +- 'Join Inner
                              :- 'Join Inner
                              :  :- 'UnresolvedRelation [wss], [], false
                              :  +- 'UnresolvedRelation [store], [], false
                              +- 'SubqueryAlias d
                                 +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
s_store_name1: string, s_store_id1: string, d_week_seq1: int, (sun_sales1 / sun_sales2): double, (mon_sales1 / mon_sales2): double, (tue_sales1 / tue_sales1): double, (wed_sales1 / wed_sales2): double, (thu_sales1 / thu_sales2): double, (fri_sales1 / fri_sales2): double, (sat_sales1 / sat_sales2): double
WithCTE
:- CTERelationDef 42
:  +- SubqueryAlias wss
:     +- Aggregate [d_week_seq#17658, ss_store_sk#17637L], [d_week_seq#17658, ss_store_sk#17637L, sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS sun_sales#17624, sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS mon_sales#17625, sum(CASE WHEN (d_day_name#17668 = Tuesday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS tue_sales#17626, sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS wed_sales#17627, sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS thu_sales#17628, sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS fri_sales#17629, sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 ELSE cast(null as double) END) AS sat_sales#17630]
:        +- Filter (d_date_sk#17654L = ss_sold_date_sk#17653L)
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17631L,ss_item_sk#17632L,ss_customer_sk#17633L,ss_cdemo_sk#17634L,ss_hdemo_sk#17635L,ss_addr_sk#17636L,ss_store_sk#17637L,ss_promo_sk#17638L,ss_ticket_number#17639L,ss_quantity#17640,ss_wholesale_cost#17641,ss_list_price#17642,ss_sales_price#17643,ss_ext_discount_amt#17644,ss_ext_sales_price#17645,ss_ext_wholesale_cost#17646,ss_ext_list_price#17647,ss_ext_tax#17648,ss_coupon_amt#17649,ss_net_paid#17650,ss_net_paid_inc_tax#17651,ss_net_profit#17652,ss_sold_date_sk#17653L] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17654L,d_date_id#17655,d_date#17656,d_month_seq#17657,d_week_seq#17658,d_quarter_seq#17659,d_year#17660,d_dow#17661,d_moy#17662,d_dom#17663,d_qoy#17664,d_fy_year#17665,d_fy_quarter_seq#17666,d_fy_week_seq#17667,d_day_name#17668,d_quarter_name#17669,d_holiday#17670,d_weekend#17671,d_following_holiday#17672,d_first_dom#17673,d_last_dom#17674,d_same_day_ly#17675,d_same_day_lq#17676,d_current_day#17677,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [s_store_name1#17604 ASC NULLS FIRST, s_store_id1#17606 ASC NULLS FIRST, d_week_seq1#17605 ASC NULLS FIRST], true
         +- Project [s_store_name1#17604, s_store_id1#17606, d_week_seq1#17605, (sun_sales1#17607 / sun_sales2#17617) AS (sun_sales1 / sun_sales2)#17803, (mon_sales1#17608 / mon_sales2#17618) AS (mon_sales1 / mon_sales2)#17804, (tue_sales1#17609 / tue_sales1#17609) AS (tue_sales1 / tue_sales1)#17805, (wed_sales1#17610 / wed_sales2#17620) AS (wed_sales1 / wed_sales2)#17806, (thu_sales1#17611 / thu_sales2#17621) AS (thu_sales1 / thu_sales2)#17807, (fri_sales1#17612 / fri_sales2#17622) AS (fri_sales1 / fri_sales2)#17808, (sat_sales1#17613 / sat_sales2#17623) AS (sat_sales1 / sat_sales2)#17809]
            +- Filter ((s_store_id1#17606 = s_store_id2#17616) AND (d_week_seq1#17605 = (d_week_seq2#17615 - 52)))
               +- Join Inner
                  :- SubqueryAlias y
                  :  +- Project [s_store_name#17687 AS s_store_name1#17604, d_week_seq#17658 AS d_week_seq1#17605, s_store_id#17683 AS s_store_id1#17606, sun_sales#17624 AS sun_sales1#17607, mon_sales#17625 AS mon_sales1#17608, tue_sales#17626 AS tue_sales1#17609, wed_sales#17627 AS wed_sales1#17610, thu_sales#17628 AS thu_sales1#17611, fri_sales#17629 AS fri_sales1#17612, sat_sales#17630 AS sat_sales1#17613]
                  :     +- Filter (((d_week_seq#17715 = d_week_seq#17658) AND (ss_store_sk#17637L = s_store_sk#17682L)) AND ((d_month_seq#17714 >= 1185) AND (d_month_seq#17714 <= (1185 + 11))))
                  :        +- Join Inner
                  :           :- Join Inner
                  :           :  :- SubqueryAlias wss
                  :           :  :  +- CTERelationRef 42, true, [d_week_seq#17658, ss_store_sk#17637L, sun_sales#17624, mon_sales#17625, tue_sales#17626, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630]
                  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17682L,s_store_id#17683,s_rec_start_date#17684,s_rec_end_date#17685,s_closed_date_sk#17686L,s_store_name#17687,s_number_employees#17688,s_floor_space#17689,s_hours#17690,s_manager#17691,s_market_id#17692,s_geography_class#17693,s_market_desc#17694,s_market_manager#17695,s_division_id#17696,s_division_name#17697,s_company_id#17698,s_company_name#17699,s_street_number#17700,s_street_name#17701,s_street_type#17702,s_suite_number#17703,s_city#17704,s_county#17705,... 5 more fields] orc
                  :           +- SubqueryAlias d
                  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17711L,d_date_id#17712,d_date#17713,d_month_seq#17714,d_week_seq#17715,d_quarter_seq#17716,d_year#17717,d_dow#17718,d_moy#17719,d_dom#17720,d_qoy#17721,d_fy_year#17722,d_fy_quarter_seq#17723,d_fy_week_seq#17724,d_day_name#17725,d_quarter_name#17726,d_holiday#17727,d_weekend#17728,d_following_holiday#17729,d_first_dom#17730,d_last_dom#17731,d_same_day_ly#17732,d_same_day_lq#17733,d_current_day#17734,... 4 more fields] orc
                  +- SubqueryAlias x
                     +- Project [s_store_name#17744 AS s_store_name2#17614, d_week_seq#17658 AS d_week_seq2#17615, s_store_id#17740 AS s_store_id2#17616, sun_sales#17624 AS sun_sales2#17617, mon_sales#17625 AS mon_sales2#17618, tue_sales#17626 AS tue_sales2#17619, wed_sales#17627 AS wed_sales2#17620, thu_sales#17628 AS thu_sales2#17621, fri_sales#17629 AS fri_sales2#17622, sat_sales#17630 AS sat_sales2#17623]
                        +- Filter (((d_week_seq#17772 = d_week_seq#17658) AND (ss_store_sk#17637L = s_store_sk#17739L)) AND ((d_month_seq#17771 >= (1185 + 12)) AND (d_month_seq#17771 <= (1185 + 23))))
                           +- Join Inner
                              :- Join Inner
                              :  :- SubqueryAlias wss
                              :  :  +- CTERelationRef 42, true, [d_week_seq#17658, ss_store_sk#17637L, sun_sales#17624, mon_sales#17625, tue_sales#17626, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630]
                              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17739L,s_store_id#17740,s_rec_start_date#17741,s_rec_end_date#17742,s_closed_date_sk#17743L,s_store_name#17744,s_number_employees#17745,s_floor_space#17746,s_hours#17747,s_manager#17748,s_market_id#17749,s_geography_class#17750,s_market_desc#17751,s_market_manager#17752,s_division_id#17753,s_division_name#17754,s_company_id#17755,s_company_name#17756,s_street_number#17757,s_street_name#17758,s_street_type#17759,s_suite_number#17760,s_city#17761,s_county#17762,... 5 more fields] orc
                              +- SubqueryAlias d
                                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17768L,d_date_id#17769,d_date#17770,d_month_seq#17771,d_week_seq#17772,d_quarter_seq#17773,d_year#17774,d_dow#17775,d_moy#17776,d_dom#17777,d_qoy#17778,d_fy_year#17779,d_fy_quarter_seq#17780,d_fy_week_seq#17781,d_day_name#17782,d_quarter_name#17783,d_holiday#17784,d_weekend#17785,d_following_holiday#17786,d_first_dom#17787,d_last_dom#17788,d_same_day_ly#17789,d_same_day_lq#17790,d_current_day#17791,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name1#17604 ASC NULLS FIRST, s_store_id1#17606 ASC NULLS FIRST, d_week_seq1#17605 ASC NULLS FIRST], true
      +- Project [s_store_name1#17604, s_store_id1#17606, d_week_seq1#17605, (sun_sales1#17607 / sun_sales2#17617) AS (sun_sales1 / sun_sales2)#17803, (mon_sales1#17608 / mon_sales2#17618) AS (mon_sales1 / mon_sales2)#17804, (tue_sales1#17609 / tue_sales1#17609) AS (tue_sales1 / tue_sales1)#17805, (wed_sales1#17610 / wed_sales2#17620) AS (wed_sales1 / wed_sales2)#17806, (thu_sales1#17611 / thu_sales2#17621) AS (thu_sales1 / thu_sales2)#17807, (fri_sales1#17612 / fri_sales2#17622) AS (fri_sales1 / fri_sales2)#17808, (sat_sales1#17613 / sat_sales2#17623) AS (sat_sales1 / sat_sales2)#17809]
         +- Join Inner, ((s_store_id1#17606 = s_store_id2#17616) AND (d_week_seq1#17605 = (d_week_seq2#17615 - 52)))
            :- Project [s_store_name#17687 AS s_store_name1#17604, d_week_seq#17658 AS d_week_seq1#17605, s_store_id#17683 AS s_store_id1#17606, sun_sales#17624 AS sun_sales1#17607, mon_sales#17625 AS mon_sales1#17608, tue_sales#17626 AS tue_sales1#17609, wed_sales#17627 AS wed_sales1#17610, thu_sales#17628 AS thu_sales1#17611, fri_sales#17629 AS fri_sales1#17612, sat_sales#17630 AS sat_sales1#17613]
            :  +- Join Inner, (d_week_seq#17715 = d_week_seq#17658)
            :     :- Project [d_week_seq#17658, sun_sales#17624, mon_sales#17625, tue_sales#17626, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630, s_store_id#17683, s_store_name#17687]
            :     :  +- Join Inner, (ss_store_sk#17637L = s_store_sk#17682L)
            :     :     :- Aggregate [d_week_seq#17658, ss_store_sk#17637L], [d_week_seq#17658, ss_store_sk#17637L, sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END) AS sun_sales#17624, sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END) AS mon_sales#17625, sum(CASE WHEN (d_day_name#17668 = Tuesday) THEN ss_sales_price#17643 END) AS tue_sales#17626, sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END) AS wed_sales#17627, sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END) AS thu_sales#17628, sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END) AS fri_sales#17629, sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END) AS sat_sales#17630]
            :     :     :  +- Project [ss_store_sk#17637L, ss_sales_price#17643, d_week_seq#17658, d_day_name#17668]
            :     :     :     +- Join Inner, (d_date_sk#17654L = ss_sold_date_sk#17653L)
            :     :     :        :- Project [ss_store_sk#17637L, ss_sales_price#17643, ss_sold_date_sk#17653L]
            :     :     :        :  +- Filter (isnotnull(ss_sold_date_sk#17653L) AND isnotnull(ss_store_sk#17637L))
            :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17631L,ss_item_sk#17632L,ss_customer_sk#17633L,ss_cdemo_sk#17634L,ss_hdemo_sk#17635L,ss_addr_sk#17636L,ss_store_sk#17637L,ss_promo_sk#17638L,ss_ticket_number#17639L,ss_quantity#17640,ss_wholesale_cost#17641,ss_list_price#17642,ss_sales_price#17643,ss_ext_discount_amt#17644,ss_ext_sales_price#17645,ss_ext_wholesale_cost#17646,ss_ext_list_price#17647,ss_ext_tax#17648,ss_coupon_amt#17649,ss_net_paid#17650,ss_net_paid_inc_tax#17651,ss_net_profit#17652,ss_sold_date_sk#17653L] orc
            :     :     :        +- Project [d_date_sk#17654L, d_week_seq#17658, d_day_name#17668]
            :     :     :           +- Filter (isnotnull(d_date_sk#17654L) AND isnotnull(d_week_seq#17658))
            :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17654L,d_date_id#17655,d_date#17656,d_month_seq#17657,d_week_seq#17658,d_quarter_seq#17659,d_year#17660,d_dow#17661,d_moy#17662,d_dom#17663,d_qoy#17664,d_fy_year#17665,d_fy_quarter_seq#17666,d_fy_week_seq#17667,d_day_name#17668,d_quarter_name#17669,d_holiday#17670,d_weekend#17671,d_following_holiday#17672,d_first_dom#17673,d_last_dom#17674,d_same_day_ly#17675,d_same_day_lq#17676,d_current_day#17677,... 4 more fields] orc
            :     :     +- Project [s_store_sk#17682L, s_store_id#17683, s_store_name#17687]
            :     :        +- Filter (isnotnull(s_store_sk#17682L) AND isnotnull(s_store_id#17683))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17682L,s_store_id#17683,s_rec_start_date#17684,s_rec_end_date#17685,s_closed_date_sk#17686L,s_store_name#17687,s_number_employees#17688,s_floor_space#17689,s_hours#17690,s_manager#17691,s_market_id#17692,s_geography_class#17693,s_market_desc#17694,s_market_manager#17695,s_division_id#17696,s_division_name#17697,s_company_id#17698,s_company_name#17699,s_street_number#17700,s_street_name#17701,s_street_type#17702,s_suite_number#17703,s_city#17704,s_county#17705,... 5 more fields] orc
            :     +- Project [d_week_seq#17715]
            :        +- Filter ((isnotnull(d_month_seq#17714) AND ((d_month_seq#17714 >= 1185) AND (d_month_seq#17714 <= 1196))) AND isnotnull(d_week_seq#17715))
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17711L,d_date_id#17712,d_date#17713,d_month_seq#17714,d_week_seq#17715,d_quarter_seq#17716,d_year#17717,d_dow#17718,d_moy#17719,d_dom#17720,d_qoy#17721,d_fy_year#17722,d_fy_quarter_seq#17723,d_fy_week_seq#17724,d_day_name#17725,d_quarter_name#17726,d_holiday#17727,d_weekend#17728,d_following_holiday#17729,d_first_dom#17730,d_last_dom#17731,d_same_day_ly#17732,d_same_day_lq#17733,d_current_day#17734,... 4 more fields] orc
            +- Project [d_week_seq#17658 AS d_week_seq2#17615, s_store_id#17740 AS s_store_id2#17616, sun_sales#17624 AS sun_sales2#17617, mon_sales#17625 AS mon_sales2#17618, wed_sales#17627 AS wed_sales2#17620, thu_sales#17628 AS thu_sales2#17621, fri_sales#17629 AS fri_sales2#17622, sat_sales#17630 AS sat_sales2#17623]
               +- Join Inner, (d_week_seq#17772 = d_week_seq#17658)
                  :- Project [d_week_seq#17658, sun_sales#17624, mon_sales#17625, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630, s_store_id#17740]
                  :  +- Join Inner, (ss_store_sk#17637L = s_store_sk#17739L)
                  :     :- Aggregate [d_week_seq#17658, ss_store_sk#17637L], [d_week_seq#17658, ss_store_sk#17637L, sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END) AS sun_sales#17624, sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END) AS mon_sales#17625, sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END) AS wed_sales#17627, sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END) AS thu_sales#17628, sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END) AS fri_sales#17629, sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END) AS sat_sales#17630]
                  :     :  +- Project [ss_store_sk#17637L, ss_sales_price#17643, d_week_seq#17658, d_day_name#17668]
                  :     :     +- Join Inner, (d_date_sk#17654L = ss_sold_date_sk#17653L)
                  :     :        :- Project [ss_store_sk#17637L, ss_sales_price#17643, ss_sold_date_sk#17653L]
                  :     :        :  +- Filter (isnotnull(ss_sold_date_sk#17653L) AND isnotnull(ss_store_sk#17637L))
                  :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17631L,ss_item_sk#17632L,ss_customer_sk#17633L,ss_cdemo_sk#17634L,ss_hdemo_sk#17635L,ss_addr_sk#17636L,ss_store_sk#17637L,ss_promo_sk#17638L,ss_ticket_number#17639L,ss_quantity#17640,ss_wholesale_cost#17641,ss_list_price#17642,ss_sales_price#17643,ss_ext_discount_amt#17644,ss_ext_sales_price#17645,ss_ext_wholesale_cost#17646,ss_ext_list_price#17647,ss_ext_tax#17648,ss_coupon_amt#17649,ss_net_paid#17650,ss_net_paid_inc_tax#17651,ss_net_profit#17652,ss_sold_date_sk#17653L] orc
                  :     :        +- Project [d_date_sk#17654L, d_week_seq#17658, d_day_name#17668]
                  :     :           +- Filter (isnotnull(d_date_sk#17654L) AND isnotnull(d_week_seq#17658))
                  :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17654L,d_date_id#17655,d_date#17656,d_month_seq#17657,d_week_seq#17658,d_quarter_seq#17659,d_year#17660,d_dow#17661,d_moy#17662,d_dom#17663,d_qoy#17664,d_fy_year#17665,d_fy_quarter_seq#17666,d_fy_week_seq#17667,d_day_name#17668,d_quarter_name#17669,d_holiday#17670,d_weekend#17671,d_following_holiday#17672,d_first_dom#17673,d_last_dom#17674,d_same_day_ly#17675,d_same_day_lq#17676,d_current_day#17677,... 4 more fields] orc
                  :     +- Project [s_store_sk#17739L, s_store_id#17740]
                  :        +- Filter (isnotnull(s_store_sk#17739L) AND isnotnull(s_store_id#17740))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17739L,s_store_id#17740,s_rec_start_date#17741,s_rec_end_date#17742,s_closed_date_sk#17743L,s_store_name#17744,s_number_employees#17745,s_floor_space#17746,s_hours#17747,s_manager#17748,s_market_id#17749,s_geography_class#17750,s_market_desc#17751,s_market_manager#17752,s_division_id#17753,s_division_name#17754,s_company_id#17755,s_company_name#17756,s_street_number#17757,s_street_name#17758,s_street_type#17759,s_suite_number#17760,s_city#17761,s_county#17762,... 5 more fields] orc
                  +- Project [d_week_seq#17772]
                     +- Filter ((isnotnull(d_month_seq#17771) AND ((d_month_seq#17771 >= 1197) AND (d_month_seq#17771 <= 1208))) AND isnotnull(d_week_seq#17772))
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17768L,d_date_id#17769,d_date#17770,d_month_seq#17771,d_week_seq#17772,d_quarter_seq#17773,d_year#17774,d_dow#17775,d_moy#17776,d_dom#17777,d_qoy#17778,d_fy_year#17779,d_fy_quarter_seq#17780,d_fy_week_seq#17781,d_day_name#17782,d_quarter_name#17783,d_holiday#17784,d_weekend#17785,d_following_holiday#17786,d_first_dom#17787,d_last_dom#17788,d_same_day_ly#17789,d_same_day_lq#17790,d_current_day#17791,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name1#17604 ASC NULLS FIRST,s_store_id1#17606 ASC NULLS FIRST,d_week_seq1#17605 ASC NULLS FIRST], output=[s_store_name1#17604,s_store_id1#17606,d_week_seq1#17605,(sun_sales1 / sun_sales2)#17803,(mon_sales1 / mon_sales2)#17804,(tue_sales1 / tue_sales1)#17805,(wed_sales1 / wed_sales2)#17806,(thu_sales1 / thu_sales2)#17807,(fri_sales1 / fri_sales2)#17808,(sat_sales1 / sat_sales2)#17809])
   +- Project [s_store_name1#17604, s_store_id1#17606, d_week_seq1#17605, (sun_sales1#17607 / sun_sales2#17617) AS (sun_sales1 / sun_sales2)#17803, (mon_sales1#17608 / mon_sales2#17618) AS (mon_sales1 / mon_sales2)#17804, (tue_sales1#17609 / tue_sales1#17609) AS (tue_sales1 / tue_sales1)#17805, (wed_sales1#17610 / wed_sales2#17620) AS (wed_sales1 / wed_sales2)#17806, (thu_sales1#17611 / thu_sales2#17621) AS (thu_sales1 / thu_sales2)#17807, (fri_sales1#17612 / fri_sales2#17622) AS (fri_sales1 / fri_sales2)#17808, (sat_sales1#17613 / sat_sales2#17623) AS (sat_sales1 / sat_sales2)#17809]
      +- SortMergeJoin [s_store_id1#17606, d_week_seq1#17605], [s_store_id2#17616, (d_week_seq2#17615 - 52)], Inner
         :- Sort [s_store_id1#17606 ASC NULLS FIRST, d_week_seq1#17605 ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(s_store_id1#17606, d_week_seq1#17605, 3000), ENSURE_REQUIREMENTS, [id=#18633]
         :     +- Project [s_store_name#17687 AS s_store_name1#17604, d_week_seq#17658 AS d_week_seq1#17605, s_store_id#17683 AS s_store_id1#17606, sun_sales#17624 AS sun_sales1#17607, mon_sales#17625 AS mon_sales1#17608, tue_sales#17626 AS tue_sales1#17609, wed_sales#17627 AS wed_sales1#17610, thu_sales#17628 AS thu_sales1#17611, fri_sales#17629 AS fri_sales1#17612, sat_sales#17630 AS sat_sales1#17613]
         :        +- BroadcastHashJoin [d_week_seq#17658], [d_week_seq#17715], Inner, BuildRight, false
         :           :- Project [d_week_seq#17658, sun_sales#17624, mon_sales#17625, tue_sales#17626, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630, s_store_id#17683, s_store_name#17687]
         :           :  +- BroadcastHashJoin [ss_store_sk#17637L], [s_store_sk#17682L], Inner, BuildRight, false
         :           :     :- HashAggregate(keys=[d_week_seq#17658, ss_store_sk#17637L], functions=[sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Tuesday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END)], output=[d_week_seq#17658, ss_store_sk#17637L, sun_sales#17624, mon_sales#17625, tue_sales#17626, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630])
         :           :     :  +- Exchange hashpartitioning(d_week_seq#17658, ss_store_sk#17637L, 3000), ENSURE_REQUIREMENTS, [id=#18606]
         :           :     :     +- HashAggregate(keys=[d_week_seq#17658, ss_store_sk#17637L], functions=[partial_sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Tuesday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END)], output=[d_week_seq#17658, ss_store_sk#17637L, sum#17827, sum#17828, sum#17829, sum#17830, sum#17831, sum#17832, sum#17833])
         :           :     :        +- Project [ss_store_sk#17637L, ss_sales_price#17643, d_week_seq#17658, d_day_name#17668]
         :           :     :           +- BroadcastHashJoin [ss_sold_date_sk#17653L], [d_date_sk#17654L], Inner, BuildRight, false
         :           :     :              :- Filter isnotnull(ss_store_sk#17637L)
         :           :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#17637L,ss_sales_price#17643,ss_sold_date_sk#17653L] Batched: true, DataFilters: [isnotnull(ss_store_sk#17637L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#17653L)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_sales_price:double>
         :           :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#18601]
         :           :     :                 +- Filter (isnotnull(d_date_sk#17654L) AND isnotnull(d_week_seq#17658))
         :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17654L,d_week_seq#17658,d_day_name#17668] Batched: true, DataFilters: [isnotnull(d_date_sk#17654L), isnotnull(d_week_seq#17658)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int,d_day_name:string>
         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#18609]
         :           :        +- Filter (isnotnull(s_store_sk#17682L) AND isnotnull(s_store_id#17683))
         :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17682L,s_store_id#17683,s_store_name#17687] Batched: true, DataFilters: [isnotnull(s_store_sk#17682L), isnotnull(s_store_id#17683)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string,s_store_name:string>
         :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#18613]
         :              +- Project [d_week_seq#17715]
         :                 +- Filter (((isnotnull(d_month_seq#17714) AND (d_month_seq#17714 >= 1185)) AND (d_month_seq#17714 <= 1196)) AND isnotnull(d_week_seq#17715))
         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#17714,d_week_seq#17715] Batched: true, DataFilters: [isnotnull(d_month_seq#17714), (d_month_seq#17714 >= 1185), (d_month_seq#17714 <= 1196), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1185), LessThanOrEqual(d_month_seq,1196),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>
         +- Sort [s_store_id2#17616 ASC NULLS FIRST, (d_week_seq2#17615 - 52) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(s_store_id2#17616, (d_week_seq2#17615 - 52), 3000), ENSURE_REQUIREMENTS, [id=#18634]
               +- Project [d_week_seq#17658 AS d_week_seq2#17615, s_store_id#17740 AS s_store_id2#17616, sun_sales#17624 AS sun_sales2#17617, mon_sales#17625 AS mon_sales2#17618, wed_sales#17627 AS wed_sales2#17620, thu_sales#17628 AS thu_sales2#17621, fri_sales#17629 AS fri_sales2#17622, sat_sales#17630 AS sat_sales2#17623]
                  +- BroadcastHashJoin [d_week_seq#17658], [d_week_seq#17772], Inner, BuildRight, false
                     :- Project [d_week_seq#17658, sun_sales#17624, mon_sales#17625, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630, s_store_id#17740]
                     :  +- BroadcastHashJoin [ss_store_sk#17637L], [s_store_sk#17739L], Inner, BuildRight, false
                     :     :- HashAggregate(keys=[d_week_seq#17658, ss_store_sk#17637L], functions=[sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END), sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END)], output=[d_week_seq#17658, ss_store_sk#17637L, sun_sales#17624, mon_sales#17625, wed_sales#17627, thu_sales#17628, fri_sales#17629, sat_sales#17630])
                     :     :  +- Exchange hashpartitioning(d_week_seq#17658, ss_store_sk#17637L, 3000), ENSURE_REQUIREMENTS, [id=#18621]
                     :     :     +- HashAggregate(keys=[d_week_seq#17658, ss_store_sk#17637L], functions=[partial_sum(CASE WHEN (d_day_name#17668 = Sunday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Monday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Wednesday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Thursday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Friday) THEN ss_sales_price#17643 END), partial_sum(CASE WHEN (d_day_name#17668 = Saturday) THEN ss_sales_price#17643 END)], output=[d_week_seq#17658, ss_store_sk#17637L, sum#17840, sum#17841, sum#17842, sum#17843, sum#17844, sum#17845])
                     :     :        +- Project [ss_store_sk#17637L, ss_sales_price#17643, d_week_seq#17658, d_day_name#17668]
                     :     :           +- BroadcastHashJoin [ss_sold_date_sk#17653L], [d_date_sk#17654L], Inner, BuildRight, false
                     :     :              :- Filter isnotnull(ss_store_sk#17637L)
                     :     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#17637L,ss_sales_price#17643,ss_sold_date_sk#17653L] Batched: true, DataFilters: [isnotnull(ss_store_sk#17637L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#17653L)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_sales_price:double>
                     :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#18616]
                     :     :                 +- Filter (isnotnull(d_date_sk#17654L) AND isnotnull(d_week_seq#17658))
                     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17654L,d_week_seq#17658,d_day_name#17668] Batched: true, DataFilters: [isnotnull(d_date_sk#17654L), isnotnull(d_week_seq#17658)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int,d_day_name:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#18624]
                     :        +- Filter (isnotnull(s_store_sk#17739L) AND isnotnull(s_store_id#17740))
                     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#17739L,s_store_id#17740] Batched: true, DataFilters: [isnotnull(s_store_sk#17739L), isnotnull(s_store_id#17740)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#18628]
                        +- Project [d_week_seq#17772]
                           +- Filter (((isnotnull(d_month_seq#17771) AND (d_month_seq#17771 >= 1197)) AND (d_month_seq#17771 <= 1208)) AND isnotnull(d_week_seq#17772))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_month_seq#17771,d_week_seq#17772] Batched: true, DataFilters: [isnotnull(d_month_seq#17771), (d_month_seq#17771 >= 1197), (d_month_seq#17771 <= 1208), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1197), LessThanOrEqual(d_month_seq,1208),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>

read query: spark_queries/q60.sql
explain query: q60
== Parsed Logical Plan ==
CTE [ss, cs, ws]
:  :- 'SubqueryAlias ss
:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ss_ext_sales_price) AS total_sales#17847]
:  :     +- 'Filter ((('i_item_id IN (list#17848 []) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 9) AND ('ss_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:  :        :  +- 'Project ['i_item_id]
:  :        :     +- 'Filter 'i_category IN (Children)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  :- 'SubqueryAlias cs
:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('cs_ext_sales_price) AS total_sales#17849]
:  :     +- 'Filter ((('i_item_id IN (list#17850 []) AND ('cs_item_sk = 'i_item_sk)) AND (('cs_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 9) AND ('cs_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:  :        :  +- 'Project ['i_item_id]
:  :        :     +- 'Filter 'i_category IN (Children)
:  :        :        +- 'UnresolvedRelation [item], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  +- 'UnresolvedRelation [customer_address], [], false
:  :           +- 'UnresolvedRelation [item], [], false
:  +- 'SubqueryAlias ws
:     +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ws_ext_sales_price) AS total_sales#17851]
:        +- 'Filter ((('i_item_id IN (list#17852 []) AND ('ws_item_sk = 'i_item_sk)) AND (('ws_sold_date_sk = 'd_date_sk) AND ('d_year = 1999))) AND ((('d_moy = 9) AND ('ws_bill_addr_sk = 'ca_address_sk)) AND ('ca_gmt_offset = -6)))
:           :  +- 'Project ['i_item_id]
:           :     +- 'Filter 'i_category IN (Children)
:           :        +- 'UnresolvedRelation [item], [], false
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'UnresolvedRelation [web_sales], [], false
:              :  :  +- 'UnresolvedRelation [date_dim], [], false
:              :  +- 'UnresolvedRelation [customer_address], [], false
:              +- 'UnresolvedRelation [item], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['i_item_id ASC NULLS FIRST, 'total_sales ASC NULLS FIRST], true
         +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('total_sales) AS total_sales#17846]
            +- 'SubqueryAlias tmp1
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [*]
                  :  :  +- 'UnresolvedRelation [ss], [], false
                  :  +- 'Project [*]
                  :     +- 'UnresolvedRelation [cs], [], false
                  +- 'Project [*]
                     +- 'UnresolvedRelation [ws], [], false

== Analyzed Logical Plan ==
i_item_id: string, total_sales: double
WithCTE
:- CTERelationDef 43
:  +- SubqueryAlias ss
:     +- Aggregate [i_item_id#17918], [i_item_id#17918, sum(ss_ext_sales_price#17867) AS total_sales#17847]
:        +- Filter (((i_item_id#17918 IN (list#17848 []) AND (ss_item_sk#17854L = i_item_sk#17917L)) AND ((ss_sold_date_sk#17875L = d_date_sk#17876L) AND (d_year#17882 = 1999))) AND (((d_moy#17884 = 9) AND (ss_addr_sk#17858L = ca_address_sk#17904L)) AND (ca_gmt_offset#17915 = cast(-6 as double))))
:           :  +- Project [i_item_id#18134]
:           :     +- Filter i_category#18145 IN (Children)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18133L,i_item_id#18134,i_rec_start_date#18135,i_rec_end_date#18136,i_item_desc#18137,i_current_price#18138,i_wholesale_cost#18139,i_brand_id#18140,i_brand#18141,i_class_id#18142,i_class#18143,i_category_id#18144,i_category#18145,i_manufact_id#18146,i_manufact#18147,i_size#18148,i_formulation#18149,i_color#18150,i_units#18151,i_container#18152,i_manager_id#18153,i_product_name#18154] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17853L,ss_item_sk#17854L,ss_customer_sk#17855L,ss_cdemo_sk#17856L,ss_hdemo_sk#17857L,ss_addr_sk#17858L,ss_store_sk#17859L,ss_promo_sk#17860L,ss_ticket_number#17861L,ss_quantity#17862,ss_wholesale_cost#17863,ss_list_price#17864,ss_sales_price#17865,ss_ext_discount_amt#17866,ss_ext_sales_price#17867,ss_ext_wholesale_cost#17868,ss_ext_list_price#17869,ss_ext_tax#17870,ss_coupon_amt#17871,ss_net_paid#17872,ss_net_paid_inc_tax#17873,ss_net_profit#17874,ss_sold_date_sk#17875L] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17876L,d_date_id#17877,d_date#17878,d_month_seq#17879,d_week_seq#17880,d_quarter_seq#17881,d_year#17882,d_dow#17883,d_moy#17884,d_dom#17885,d_qoy#17886,d_fy_year#17887,d_fy_quarter_seq#17888,d_fy_week_seq#17889,d_day_name#17890,d_quarter_name#17891,d_holiday#17892,d_weekend#17893,d_following_holiday#17894,d_first_dom#17895,d_last_dom#17896,d_same_day_ly#17897,d_same_day_lq#17898,d_current_day#17899,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#17904L,ca_address_id#17905,ca_street_number#17906,ca_street_name#17907,ca_street_type#17908,ca_suite_number#17909,ca_city#17910,ca_county#17911,ca_state#17912,ca_zip#17913,ca_country#17914,ca_gmt_offset#17915,ca_location_type#17916] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17917L,i_item_id#17918,i_rec_start_date#17919,i_rec_end_date#17920,i_item_desc#17921,i_current_price#17922,i_wholesale_cost#17923,i_brand_id#17924,i_brand#17925,i_class_id#17926,i_class#17927,i_category_id#17928,i_category#17929,i_manufact_id#17930,i_manufact#17931,i_size#17932,i_formulation#17933,i_color#17934,i_units#17935,i_container#17936,i_manager_id#17937,i_product_name#17938] orc
:- CTERelationDef 44
:  +- SubqueryAlias cs
:     +- Aggregate [i_item_id#18015], [i_item_id#18015, sum(cs_ext_sales_price#17961) AS total_sales#17849]
:        +- Filter (((i_item_id#18015 IN (list#17850 []) AND (cs_item_sk#17953L = i_item_sk#18014L)) AND ((cs_sold_date_sk#17972L = d_date_sk#17973L) AND (d_year#17979 = 1999))) AND (((d_moy#17981 = 9) AND (cs_bill_addr_sk#17944L = ca_address_sk#18001L)) AND (ca_gmt_offset#18012 = cast(-6 as double))))
:           :  +- Project [i_item_id#18156]
:           :     +- Filter i_category#18167 IN (Children)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18155L,i_item_id#18156,i_rec_start_date#18157,i_rec_end_date#18158,i_item_desc#18159,i_current_price#18160,i_wholesale_cost#18161,i_brand_id#18162,i_brand#18163,i_class_id#18164,i_class#18165,i_category_id#18166,i_category#18167,i_manufact_id#18168,i_manufact#18169,i_size#18170,i_formulation#18171,i_color#18172,i_units#18173,i_container#18174,i_manager_id#18175,i_product_name#18176] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#17939L,cs_ship_date_sk#17940L,cs_bill_customer_sk#17941L,cs_bill_cdemo_sk#17942L,cs_bill_hdemo_sk#17943L,cs_bill_addr_sk#17944L,cs_ship_customer_sk#17945L,cs_ship_cdemo_sk#17946L,cs_ship_hdemo_sk#17947L,cs_ship_addr_sk#17948L,cs_call_center_sk#17949L,cs_catalog_page_sk#17950L,cs_ship_mode_sk#17951L,cs_warehouse_sk#17952L,cs_item_sk#17953L,cs_promo_sk#17954L,cs_order_number#17955L,cs_quantity#17956,cs_wholesale_cost#17957,cs_list_price#17958,cs_sales_price#17959,cs_ext_discount_amt#17960,cs_ext_sales_price#17961,cs_ext_wholesale_cost#17962,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17973L,d_date_id#17974,d_date#17975,d_month_seq#17976,d_week_seq#17977,d_quarter_seq#17978,d_year#17979,d_dow#17980,d_moy#17981,d_dom#17982,d_qoy#17983,d_fy_year#17984,d_fy_quarter_seq#17985,d_fy_week_seq#17986,d_day_name#17987,d_quarter_name#17988,d_holiday#17989,d_weekend#17990,d_following_holiday#17991,d_first_dom#17992,d_last_dom#17993,d_same_day_ly#17994,d_same_day_lq#17995,d_current_day#17996,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18001L,ca_address_id#18002,ca_street_number#18003,ca_street_name#18004,ca_street_type#18005,ca_suite_number#18006,ca_city#18007,ca_county#18008,ca_state#18009,ca_zip#18010,ca_country#18011,ca_gmt_offset#18012,ca_location_type#18013] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18014L,i_item_id#18015,i_rec_start_date#18016,i_rec_end_date#18017,i_item_desc#18018,i_current_price#18019,i_wholesale_cost#18020,i_brand_id#18021,i_brand#18022,i_class_id#18023,i_class#18024,i_category_id#18025,i_category#18026,i_manufact_id#18027,i_manufact#18028,i_size#18029,i_formulation#18030,i_color#18031,i_units#18032,i_container#18033,i_manager_id#18034,i_product_name#18035] orc
:- CTERelationDef 45
:  +- SubqueryAlias ws
:     +- Aggregate [i_item_id#18112], [i_item_id#18112, sum(ws_ext_sales_price#18058) AS total_sales#17851]
:        +- Filter (((i_item_id#18112 IN (list#17852 []) AND (ws_item_sk#18038L = i_item_sk#18111L)) AND ((ws_sold_date_sk#18069L = d_date_sk#18070L) AND (d_year#18076 = 1999))) AND (((d_moy#18078 = 9) AND (ws_bill_addr_sk#18042L = ca_address_sk#18098L)) AND (ca_gmt_offset#18109 = cast(-6 as double))))
:           :  +- Project [i_item_id#18178]
:           :     +- Filter i_category#18189 IN (Children)
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18177L,i_item_id#18178,i_rec_start_date#18179,i_rec_end_date#18180,i_item_desc#18181,i_current_price#18182,i_wholesale_cost#18183,i_brand_id#18184,i_brand#18185,i_class_id#18186,i_class#18187,i_category_id#18188,i_category#18189,i_manufact_id#18190,i_manufact#18191,i_size#18192,i_formulation#18193,i_color#18194,i_units#18195,i_container#18196,i_manager_id#18197,i_product_name#18198] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#18036L,ws_ship_date_sk#18037L,ws_item_sk#18038L,ws_bill_customer_sk#18039L,ws_bill_cdemo_sk#18040L,ws_bill_hdemo_sk#18041L,ws_bill_addr_sk#18042L,ws_ship_customer_sk#18043L,ws_ship_cdemo_sk#18044L,ws_ship_hdemo_sk#18045L,ws_ship_addr_sk#18046L,ws_web_page_sk#18047L,ws_web_site_sk#18048L,ws_ship_mode_sk#18049L,ws_warehouse_sk#18050L,ws_promo_sk#18051L,ws_order_number#18052L,ws_quantity#18053,ws_wholesale_cost#18054,ws_list_price#18055,ws_sales_price#18056,ws_ext_discount_amt#18057,ws_ext_sales_price#18058,ws_ext_wholesale_cost#18059,... 10 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18070L,d_date_id#18071,d_date#18072,d_month_seq#18073,d_week_seq#18074,d_quarter_seq#18075,d_year#18076,d_dow#18077,d_moy#18078,d_dom#18079,d_qoy#18080,d_fy_year#18081,d_fy_quarter_seq#18082,d_fy_week_seq#18083,d_day_name#18084,d_quarter_name#18085,d_holiday#18086,d_weekend#18087,d_following_holiday#18088,d_first_dom#18089,d_last_dom#18090,d_same_day_ly#18091,d_same_day_lq#18092,d_current_day#18093,... 4 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18098L,ca_address_id#18099,ca_street_number#18100,ca_street_name#18101,ca_street_type#18102,ca_suite_number#18103,ca_city#18104,ca_county#18105,ca_state#18106,ca_zip#18107,ca_country#18108,ca_gmt_offset#18109,ca_location_type#18110] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18111L,i_item_id#18112,i_rec_start_date#18113,i_rec_end_date#18114,i_item_desc#18115,i_current_price#18116,i_wholesale_cost#18117,i_brand_id#18118,i_brand#18119,i_class_id#18120,i_class#18121,i_category_id#18122,i_category#18123,i_manufact_id#18124,i_manufact#18125,i_size#18126,i_formulation#18127,i_color#18128,i_units#18129,i_container#18130,i_manager_id#18131,i_product_name#18132] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [i_item_id#17918 ASC NULLS FIRST, total_sales#17846 ASC NULLS FIRST], true
         +- Aggregate [i_item_id#17918], [i_item_id#17918, sum(total_sales#17847) AS total_sales#17846]
            +- SubqueryAlias tmp1
               +- Union false, false
                  :- Union false, false
                  :  :- Project [i_item_id#17918, total_sales#17847]
                  :  :  +- SubqueryAlias ss
                  :  :     +- CTERelationRef 43, true, [i_item_id#17918, total_sales#17847]
                  :  +- Project [i_item_id#18015, total_sales#17849]
                  :     +- SubqueryAlias cs
                  :        +- CTERelationRef 44, true, [i_item_id#18015, total_sales#17849]
                  +- Project [i_item_id#18112, total_sales#17851]
                     +- SubqueryAlias ws
                        +- CTERelationRef 45, true, [i_item_id#18112, total_sales#17851]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#17918 ASC NULLS FIRST, total_sales#17846 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#17918], [i_item_id#17918, sum(total_sales#17847) AS total_sales#17846]
         +- Union false, false
            :- Aggregate [i_item_id#17918], [i_item_id#17918, sum(ss_ext_sales_price#17867) AS total_sales#17847]
            :  +- Project [ss_ext_sales_price#17867, i_item_id#17918]
            :     +- Join Inner, (ss_item_sk#17854L = i_item_sk#17917L)
            :        :- Project [ss_item_sk#17854L, ss_ext_sales_price#17867]
            :        :  +- Join Inner, (ss_addr_sk#17858L = ca_address_sk#17904L)
            :        :     :- Project [ss_item_sk#17854L, ss_addr_sk#17858L, ss_ext_sales_price#17867]
            :        :     :  +- Join Inner, (ss_sold_date_sk#17875L = d_date_sk#17876L)
            :        :     :     :- Project [ss_item_sk#17854L, ss_addr_sk#17858L, ss_ext_sales_price#17867, ss_sold_date_sk#17875L]
            :        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#17875L) AND isnotnull(ss_addr_sk#17858L)) AND isnotnull(ss_item_sk#17854L)) AND dynamicpruning#18205 [ss_sold_date_sk#17875L])
            :        :     :     :     :  +- Project [d_date_sk#17876L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#17882) AND isnotnull(d_moy#17884)) AND ((d_year#17882 = 1999) AND (d_moy#17884 = 9))) AND isnotnull(d_date_sk#17876L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17876L,d_date_id#17877,d_date#17878,d_month_seq#17879,d_week_seq#17880,d_quarter_seq#17881,d_year#17882,d_dow#17883,d_moy#17884,d_dom#17885,d_qoy#17886,d_fy_year#17887,d_fy_quarter_seq#17888,d_fy_week_seq#17889,d_day_name#17890,d_quarter_name#17891,d_holiday#17892,d_weekend#17893,d_following_holiday#17894,d_first_dom#17895,d_last_dom#17896,d_same_day_ly#17897,d_same_day_lq#17898,d_current_day#17899,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#17853L,ss_item_sk#17854L,ss_customer_sk#17855L,ss_cdemo_sk#17856L,ss_hdemo_sk#17857L,ss_addr_sk#17858L,ss_store_sk#17859L,ss_promo_sk#17860L,ss_ticket_number#17861L,ss_quantity#17862,ss_wholesale_cost#17863,ss_list_price#17864,ss_sales_price#17865,ss_ext_discount_amt#17866,ss_ext_sales_price#17867,ss_ext_wholesale_cost#17868,ss_ext_list_price#17869,ss_ext_tax#17870,ss_coupon_amt#17871,ss_net_paid#17872,ss_net_paid_inc_tax#17873,ss_net_profit#17874,ss_sold_date_sk#17875L] orc
            :        :     :     +- Project [d_date_sk#17876L]
            :        :     :        +- Filter (((isnotnull(d_year#17882) AND isnotnull(d_moy#17884)) AND ((d_year#17882 = 1999) AND (d_moy#17884 = 9))) AND isnotnull(d_date_sk#17876L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17876L,d_date_id#17877,d_date#17878,d_month_seq#17879,d_week_seq#17880,d_quarter_seq#17881,d_year#17882,d_dow#17883,d_moy#17884,d_dom#17885,d_qoy#17886,d_fy_year#17887,d_fy_quarter_seq#17888,d_fy_week_seq#17889,d_day_name#17890,d_quarter_name#17891,d_holiday#17892,d_weekend#17893,d_following_holiday#17894,d_first_dom#17895,d_last_dom#17896,d_same_day_ly#17897,d_same_day_lq#17898,d_current_day#17899,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#17904L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#17915) AND (ca_gmt_offset#17915 = -6.0)) AND isnotnull(ca_address_sk#17904L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#17904L,ca_address_id#17905,ca_street_number#17906,ca_street_name#17907,ca_street_type#17908,ca_suite_number#17909,ca_city#17910,ca_county#17911,ca_state#17912,ca_zip#17913,ca_country#17914,ca_gmt_offset#17915,ca_location_type#17916] orc
            :        +- Join LeftSemi, (i_item_id#17918 = i_item_id#18134)
            :           :- Project [i_item_sk#17917L, i_item_id#17918]
            :           :  +- Filter isnotnull(i_item_sk#17917L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17917L,i_item_id#17918,i_rec_start_date#17919,i_rec_end_date#17920,i_item_desc#17921,i_current_price#17922,i_wholesale_cost#17923,i_brand_id#17924,i_brand#17925,i_class_id#17926,i_class#17927,i_category_id#17928,i_category#17929,i_manufact_id#17930,i_manufact#17931,i_size#17932,i_formulation#17933,i_color#17934,i_units#17935,i_container#17936,i_manager_id#17937,i_product_name#17938] orc
            :           +- Project [i_item_id#18134]
            :              +- Filter (isnotnull(i_category#18145) AND (i_category#18145 = Children))
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18133L,i_item_id#18134,i_rec_start_date#18135,i_rec_end_date#18136,i_item_desc#18137,i_current_price#18138,i_wholesale_cost#18139,i_brand_id#18140,i_brand#18141,i_class_id#18142,i_class#18143,i_category_id#18144,i_category#18145,i_manufact_id#18146,i_manufact#18147,i_size#18148,i_formulation#18149,i_color#18150,i_units#18151,i_container#18152,i_manager_id#18153,i_product_name#18154] orc
            :- Aggregate [i_item_id#18015], [i_item_id#18015, sum(cs_ext_sales_price#17961) AS total_sales#17849]
            :  +- Project [cs_ext_sales_price#17961, i_item_id#18015]
            :     +- Join Inner, (cs_item_sk#17953L = i_item_sk#18014L)
            :        :- Project [cs_item_sk#17953L, cs_ext_sales_price#17961]
            :        :  +- Join Inner, (cs_bill_addr_sk#17944L = ca_address_sk#18001L)
            :        :     :- Project [cs_bill_addr_sk#17944L, cs_item_sk#17953L, cs_ext_sales_price#17961]
            :        :     :  +- Join Inner, (cs_sold_date_sk#17972L = d_date_sk#17973L)
            :        :     :     :- Project [cs_bill_addr_sk#17944L, cs_item_sk#17953L, cs_ext_sales_price#17961, cs_sold_date_sk#17972L]
            :        :     :     :  +- Filter (((isnotnull(cs_sold_date_sk#17972L) AND isnotnull(cs_bill_addr_sk#17944L)) AND isnotnull(cs_item_sk#17953L)) AND dynamicpruning#18206 [cs_sold_date_sk#17972L])
            :        :     :     :     :  +- Project [d_date_sk#17973L]
            :        :     :     :     :     +- Filter (((isnotnull(d_year#17979) AND isnotnull(d_moy#17981)) AND ((d_year#17979 = 1999) AND (d_moy#17981 = 9))) AND isnotnull(d_date_sk#17973L))
            :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17973L,d_date_id#17974,d_date#17975,d_month_seq#17976,d_week_seq#17977,d_quarter_seq#17978,d_year#17979,d_dow#17980,d_moy#17981,d_dom#17982,d_qoy#17983,d_fy_year#17984,d_fy_quarter_seq#17985,d_fy_week_seq#17986,d_day_name#17987,d_quarter_name#17988,d_holiday#17989,d_weekend#17990,d_following_holiday#17991,d_first_dom#17992,d_last_dom#17993,d_same_day_ly#17994,d_same_day_lq#17995,d_current_day#17996,... 4 more fields] orc
            :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#17939L,cs_ship_date_sk#17940L,cs_bill_customer_sk#17941L,cs_bill_cdemo_sk#17942L,cs_bill_hdemo_sk#17943L,cs_bill_addr_sk#17944L,cs_ship_customer_sk#17945L,cs_ship_cdemo_sk#17946L,cs_ship_hdemo_sk#17947L,cs_ship_addr_sk#17948L,cs_call_center_sk#17949L,cs_catalog_page_sk#17950L,cs_ship_mode_sk#17951L,cs_warehouse_sk#17952L,cs_item_sk#17953L,cs_promo_sk#17954L,cs_order_number#17955L,cs_quantity#17956,cs_wholesale_cost#17957,cs_list_price#17958,cs_sales_price#17959,cs_ext_discount_amt#17960,cs_ext_sales_price#17961,cs_ext_wholesale_cost#17962,... 10 more fields] orc
            :        :     :     +- Project [d_date_sk#17973L]
            :        :     :        +- Filter (((isnotnull(d_year#17979) AND isnotnull(d_moy#17981)) AND ((d_year#17979 = 1999) AND (d_moy#17981 = 9))) AND isnotnull(d_date_sk#17973L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17973L,d_date_id#17974,d_date#17975,d_month_seq#17976,d_week_seq#17977,d_quarter_seq#17978,d_year#17979,d_dow#17980,d_moy#17981,d_dom#17982,d_qoy#17983,d_fy_year#17984,d_fy_quarter_seq#17985,d_fy_week_seq#17986,d_day_name#17987,d_quarter_name#17988,d_holiday#17989,d_weekend#17990,d_following_holiday#17991,d_first_dom#17992,d_last_dom#17993,d_same_day_ly#17994,d_same_day_lq#17995,d_current_day#17996,... 4 more fields] orc
            :        :     +- Project [ca_address_sk#18001L]
            :        :        +- Filter ((isnotnull(ca_gmt_offset#18012) AND (ca_gmt_offset#18012 = -6.0)) AND isnotnull(ca_address_sk#18001L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18001L,ca_address_id#18002,ca_street_number#18003,ca_street_name#18004,ca_street_type#18005,ca_suite_number#18006,ca_city#18007,ca_county#18008,ca_state#18009,ca_zip#18010,ca_country#18011,ca_gmt_offset#18012,ca_location_type#18013] orc
            :        +- Join LeftSemi, (i_item_id#18015 = i_item_id#18156)
            :           :- Project [i_item_sk#18014L, i_item_id#18015]
            :           :  +- Filter isnotnull(i_item_sk#18014L)
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18014L,i_item_id#18015,i_rec_start_date#18016,i_rec_end_date#18017,i_item_desc#18018,i_current_price#18019,i_wholesale_cost#18020,i_brand_id#18021,i_brand#18022,i_class_id#18023,i_class#18024,i_category_id#18025,i_category#18026,i_manufact_id#18027,i_manufact#18028,i_size#18029,i_formulation#18030,i_color#18031,i_units#18032,i_container#18033,i_manager_id#18034,i_product_name#18035] orc
            :           +- Project [i_item_id#18156]
            :              +- Filter (isnotnull(i_category#18167) AND (i_category#18167 = Children))
            :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18155L,i_item_id#18156,i_rec_start_date#18157,i_rec_end_date#18158,i_item_desc#18159,i_current_price#18160,i_wholesale_cost#18161,i_brand_id#18162,i_brand#18163,i_class_id#18164,i_class#18165,i_category_id#18166,i_category#18167,i_manufact_id#18168,i_manufact#18169,i_size#18170,i_formulation#18171,i_color#18172,i_units#18173,i_container#18174,i_manager_id#18175,i_product_name#18176] orc
            +- Aggregate [i_item_id#18112], [i_item_id#18112, sum(ws_ext_sales_price#18058) AS total_sales#17851]
               +- Project [ws_ext_sales_price#18058, i_item_id#18112]
                  +- Join Inner, (ws_item_sk#18038L = i_item_sk#18111L)
                     :- Project [ws_item_sk#18038L, ws_ext_sales_price#18058]
                     :  +- Join Inner, (ws_bill_addr_sk#18042L = ca_address_sk#18098L)
                     :     :- Project [ws_item_sk#18038L, ws_bill_addr_sk#18042L, ws_ext_sales_price#18058]
                     :     :  +- Join Inner, (ws_sold_date_sk#18069L = d_date_sk#18070L)
                     :     :     :- Project [ws_item_sk#18038L, ws_bill_addr_sk#18042L, ws_ext_sales_price#18058, ws_sold_date_sk#18069L]
                     :     :     :  +- Filter (((isnotnull(ws_sold_date_sk#18069L) AND isnotnull(ws_bill_addr_sk#18042L)) AND isnotnull(ws_item_sk#18038L)) AND dynamicpruning#18207 [ws_sold_date_sk#18069L])
                     :     :     :     :  +- Project [d_date_sk#18070L]
                     :     :     :     :     +- Filter (((isnotnull(d_year#18076) AND isnotnull(d_moy#18078)) AND ((d_year#18076 = 1999) AND (d_moy#18078 = 9))) AND isnotnull(d_date_sk#18070L))
                     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18070L,d_date_id#18071,d_date#18072,d_month_seq#18073,d_week_seq#18074,d_quarter_seq#18075,d_year#18076,d_dow#18077,d_moy#18078,d_dom#18079,d_qoy#18080,d_fy_year#18081,d_fy_quarter_seq#18082,d_fy_week_seq#18083,d_day_name#18084,d_quarter_name#18085,d_holiday#18086,d_weekend#18087,d_following_holiday#18088,d_first_dom#18089,d_last_dom#18090,d_same_day_ly#18091,d_same_day_lq#18092,d_current_day#18093,... 4 more fields] orc
                     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#18036L,ws_ship_date_sk#18037L,ws_item_sk#18038L,ws_bill_customer_sk#18039L,ws_bill_cdemo_sk#18040L,ws_bill_hdemo_sk#18041L,ws_bill_addr_sk#18042L,ws_ship_customer_sk#18043L,ws_ship_cdemo_sk#18044L,ws_ship_hdemo_sk#18045L,ws_ship_addr_sk#18046L,ws_web_page_sk#18047L,ws_web_site_sk#18048L,ws_ship_mode_sk#18049L,ws_warehouse_sk#18050L,ws_promo_sk#18051L,ws_order_number#18052L,ws_quantity#18053,ws_wholesale_cost#18054,ws_list_price#18055,ws_sales_price#18056,ws_ext_discount_amt#18057,ws_ext_sales_price#18058,ws_ext_wholesale_cost#18059,... 10 more fields] orc
                     :     :     +- Project [d_date_sk#18070L]
                     :     :        +- Filter (((isnotnull(d_year#18076) AND isnotnull(d_moy#18078)) AND ((d_year#18076 = 1999) AND (d_moy#18078 = 9))) AND isnotnull(d_date_sk#18070L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18070L,d_date_id#18071,d_date#18072,d_month_seq#18073,d_week_seq#18074,d_quarter_seq#18075,d_year#18076,d_dow#18077,d_moy#18078,d_dom#18079,d_qoy#18080,d_fy_year#18081,d_fy_quarter_seq#18082,d_fy_week_seq#18083,d_day_name#18084,d_quarter_name#18085,d_holiday#18086,d_weekend#18087,d_following_holiday#18088,d_first_dom#18089,d_last_dom#18090,d_same_day_ly#18091,d_same_day_lq#18092,d_current_day#18093,... 4 more fields] orc
                     :     +- Project [ca_address_sk#18098L]
                     :        +- Filter ((isnotnull(ca_gmt_offset#18109) AND (ca_gmt_offset#18109 = -6.0)) AND isnotnull(ca_address_sk#18098L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18098L,ca_address_id#18099,ca_street_number#18100,ca_street_name#18101,ca_street_type#18102,ca_suite_number#18103,ca_city#18104,ca_county#18105,ca_state#18106,ca_zip#18107,ca_country#18108,ca_gmt_offset#18109,ca_location_type#18110] orc
                     +- Join LeftSemi, (i_item_id#18112 = i_item_id#18178)
                        :- Project [i_item_sk#18111L, i_item_id#18112]
                        :  +- Filter isnotnull(i_item_sk#18111L)
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18111L,i_item_id#18112,i_rec_start_date#18113,i_rec_end_date#18114,i_item_desc#18115,i_current_price#18116,i_wholesale_cost#18117,i_brand_id#18118,i_brand#18119,i_class_id#18120,i_class#18121,i_category_id#18122,i_category#18123,i_manufact_id#18124,i_manufact#18125,i_size#18126,i_formulation#18127,i_color#18128,i_units#18129,i_container#18130,i_manager_id#18131,i_product_name#18132] orc
                        +- Project [i_item_id#18178]
                           +- Filter (isnotnull(i_category#18189) AND (i_category#18189 = Children))
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18177L,i_item_id#18178,i_rec_start_date#18179,i_rec_end_date#18180,i_item_desc#18181,i_current_price#18182,i_wholesale_cost#18183,i_brand_id#18184,i_brand#18185,i_class_id#18186,i_class#18187,i_category_id#18188,i_category#18189,i_manufact_id#18190,i_manufact#18191,i_size#18192,i_formulation#18193,i_color#18194,i_units#18195,i_container#18196,i_manager_id#18197,i_product_name#18198] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#17918 ASC NULLS FIRST,total_sales#17846 ASC NULLS FIRST], output=[i_item_id#17918,total_sales#17846])
   +- HashAggregate(keys=[i_item_id#17918], functions=[sum(total_sales#17847)], output=[i_item_id#17918, total_sales#17846])
      +- Exchange hashpartitioning(i_item_id#17918, 3000), ENSURE_REQUIREMENTS, [id=#19043]
         +- HashAggregate(keys=[i_item_id#17918], functions=[partial_sum(total_sales#17847)], output=[i_item_id#17918, sum#18209])
            +- Union
               :- HashAggregate(keys=[i_item_id#17918], functions=[sum(ss_ext_sales_price#17867)], output=[i_item_id#17918, total_sales#17847])
               :  +- Exchange hashpartitioning(i_item_id#17918, 3000), ENSURE_REQUIREMENTS, [id=#18988]
               :     +- HashAggregate(keys=[i_item_id#17918], functions=[partial_sum(ss_ext_sales_price#17867)], output=[i_item_id#17918, sum#18211])
               :        +- Project [ss_ext_sales_price#17867, i_item_id#17918]
               :           +- SortMergeJoin [ss_item_sk#17854L], [i_item_sk#17917L], Inner
               :              :- Sort [ss_item_sk#17854L ASC NULLS FIRST], false, 0
               :              :  +- Exchange hashpartitioning(ss_item_sk#17854L, 3000), ENSURE_REQUIREMENTS, [id=#18980]
               :              :     +- Project [ss_item_sk#17854L, ss_ext_sales_price#17867]
               :              :        +- SortMergeJoin [ss_addr_sk#17858L], [ca_address_sk#17904L], Inner
               :              :           :- Sort [ss_addr_sk#17858L ASC NULLS FIRST], false, 0
               :              :           :  +- Exchange hashpartitioning(ss_addr_sk#17858L, 3000), ENSURE_REQUIREMENTS, [id=#18970]
               :              :           :     +- Project [ss_item_sk#17854L, ss_addr_sk#17858L, ss_ext_sales_price#17867]
               :              :           :        +- BroadcastHashJoin [ss_sold_date_sk#17875L], [d_date_sk#17876L], Inner, BuildRight, false
               :              :           :           :- Filter (isnotnull(ss_addr_sk#17858L) AND isnotnull(ss_item_sk#17854L))
               :              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#17854L,ss_addr_sk#17858L,ss_ext_sales_price#17867,ss_sold_date_sk#17875L] Batched: true, DataFilters: [isnotnull(ss_addr_sk#17858L), isnotnull(ss_item_sk#17854L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#17875L), dynamicpruningexpression(ss_sold_date_sk#17875L IN dynamicpru..., PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_addr_sk:bigint,ss_ext_sales_price:double>
               :              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#18205, 0, true, Project [d_date_sk#17876L], [d_date_sk#17876L]
               :              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :           :           :              +- Project [d_date_sk#17876L]
               :              :           :           :                 +- Filter ((((isnotnull(d_year#17882) AND isnotnull(d_moy#17884)) AND (d_year#17882 = 1999)) AND (d_moy#17884 = 9)) AND isnotnull(d_date_sk#17876L))
               :              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17876L,d_year#17882,d_moy#17884] Batched: true, DataFilters: [isnotnull(d_year#17882), isnotnull(d_moy#17884), (d_year#17882 = 1999), (d_moy#17884 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#18965]
               :              :           :              +- Project [d_date_sk#17876L]
               :              :           :                 +- Filter ((((isnotnull(d_year#17882) AND isnotnull(d_moy#17884)) AND (d_year#17882 = 1999)) AND (d_moy#17884 = 9)) AND isnotnull(d_date_sk#17876L))
               :              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17876L,d_year#17882,d_moy#17884] Batched: true, DataFilters: [isnotnull(d_year#17882), isnotnull(d_moy#17884), (d_year#17882 = 1999), (d_moy#17884 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           +- Sort [ca_address_sk#17904L ASC NULLS FIRST], false, 0
               :              :              +- Exchange hashpartitioning(ca_address_sk#17904L, 3000), ENSURE_REQUIREMENTS, [id=#18971]
               :              :                 +- Project [ca_address_sk#17904L]
               :              :                    +- Filter ((isnotnull(ca_gmt_offset#17915) AND (ca_gmt_offset#17915 = -6.0)) AND isnotnull(ca_address_sk#17904L))
               :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#17904L,ca_gmt_offset#17915] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#17915), (ca_gmt_offset#17915 = -6.0), isnotnull(ca_address_sk#17904L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- Sort [i_item_sk#17917L ASC NULLS FIRST], false, 0
               :                 +- Exchange hashpartitioning(i_item_sk#17917L, 3000), ENSURE_REQUIREMENTS, [id=#18981]
               :                    +- BroadcastHashJoin [i_item_id#17918], [i_item_id#18134], LeftSemi, BuildRight, false
               :                       :- Filter isnotnull(i_item_sk#17917L)
               :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#17917L,i_item_id#17918] Batched: true, DataFilters: [isnotnull(i_item_sk#17917L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
               :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#18976]
               :                          +- Project [i_item_id#18134]
               :                             +- Filter (isnotnull(i_category#18145) AND (i_category#18145 = Children))
               :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#18134,i_category#18145] Batched: true, DataFilters: [isnotnull(i_category#18145), (i_category#18145 = Children)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Children)], ReadSchema: struct<i_item_id:string,i_category:string>
               :- HashAggregate(keys=[i_item_id#18015], functions=[sum(cs_ext_sales_price#17961)], output=[i_item_id#18015, total_sales#17849])
               :  +- Exchange hashpartitioning(i_item_id#18015, 3000), ENSURE_REQUIREMENTS, [id=#19013]
               :     +- HashAggregate(keys=[i_item_id#18015], functions=[partial_sum(cs_ext_sales_price#17961)], output=[i_item_id#18015, sum#18213])
               :        +- Project [cs_ext_sales_price#17961, i_item_id#18015]
               :           +- SortMergeJoin [cs_item_sk#17953L], [i_item_sk#18014L], Inner
               :              :- Sort [cs_item_sk#17953L ASC NULLS FIRST], false, 0
               :              :  +- Exchange hashpartitioning(cs_item_sk#17953L, 3000), ENSURE_REQUIREMENTS, [id=#19005]
               :              :     +- Project [cs_item_sk#17953L, cs_ext_sales_price#17961]
               :              :        +- SortMergeJoin [cs_bill_addr_sk#17944L], [ca_address_sk#18001L], Inner
               :              :           :- Sort [cs_bill_addr_sk#17944L ASC NULLS FIRST], false, 0
               :              :           :  +- Exchange hashpartitioning(cs_bill_addr_sk#17944L, 3000), ENSURE_REQUIREMENTS, [id=#18995]
               :              :           :     +- Project [cs_bill_addr_sk#17944L, cs_item_sk#17953L, cs_ext_sales_price#17961]
               :              :           :        +- BroadcastHashJoin [cs_sold_date_sk#17972L], [d_date_sk#17973L], Inner, BuildRight, false
               :              :           :           :- Filter (isnotnull(cs_bill_addr_sk#17944L) AND isnotnull(cs_item_sk#17953L))
               :              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_addr_sk#17944L,cs_item_sk#17953L,cs_ext_sales_price#17961,cs_sold_date_sk#17972L] Batched: true, DataFilters: [isnotnull(cs_bill_addr_sk#17944L), isnotnull(cs_item_sk#17953L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#17972L), dynamicpruningexpression(cs_sold_date_sk#17972L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:bigint,cs_item_sk:bigint,cs_ext_sales_price:double>
               :              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#18206, 0, true, Project [d_date_sk#17973L], [d_date_sk#17973L]
               :              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :           :           :              +- Project [d_date_sk#17973L]
               :              :           :           :                 +- Filter ((((isnotnull(d_year#17979) AND isnotnull(d_moy#17981)) AND (d_year#17979 = 1999)) AND (d_moy#17981 = 9)) AND isnotnull(d_date_sk#17973L))
               :              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17973L,d_year#17979,d_moy#17981] Batched: true, DataFilters: [isnotnull(d_year#17979), isnotnull(d_moy#17981), (d_year#17979 = 1999), (d_moy#17981 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#18990]
               :              :           :              +- Project [d_date_sk#17973L]
               :              :           :                 +- Filter ((((isnotnull(d_year#17979) AND isnotnull(d_moy#17981)) AND (d_year#17979 = 1999)) AND (d_moy#17981 = 9)) AND isnotnull(d_date_sk#17973L))
               :              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#17973L,d_year#17979,d_moy#17981] Batched: true, DataFilters: [isnotnull(d_year#17979), isnotnull(d_moy#17981), (d_year#17979 = 1999), (d_moy#17981 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :           +- Sort [ca_address_sk#18001L ASC NULLS FIRST], false, 0
               :              :              +- Exchange hashpartitioning(ca_address_sk#18001L, 3000), ENSURE_REQUIREMENTS, [id=#18996]
               :              :                 +- Project [ca_address_sk#18001L]
               :              :                    +- Filter ((isnotnull(ca_gmt_offset#18012) AND (ca_gmt_offset#18012 = -6.0)) AND isnotnull(ca_address_sk#18001L))
               :              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18001L,ca_gmt_offset#18012] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#18012), (ca_gmt_offset#18012 = -6.0), isnotnull(ca_address_sk#18001L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
               :              +- Sort [i_item_sk#18014L ASC NULLS FIRST], false, 0
               :                 +- Exchange hashpartitioning(i_item_sk#18014L, 3000), ENSURE_REQUIREMENTS, [id=#19006]
               :                    +- BroadcastHashJoin [i_item_id#18015], [i_item_id#18156], LeftSemi, BuildRight, false
               :                       :- Filter isnotnull(i_item_sk#18014L)
               :                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18014L,i_item_id#18015] Batched: true, DataFilters: [isnotnull(i_item_sk#18014L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
               :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#19001]
               :                          +- Project [i_item_id#18156]
               :                             +- Filter (isnotnull(i_category#18167) AND (i_category#18167 = Children))
               :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#18156,i_category#18167] Batched: true, DataFilters: [isnotnull(i_category#18167), (i_category#18167 = Children)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Children)], ReadSchema: struct<i_item_id:string,i_category:string>
               +- HashAggregate(keys=[i_item_id#18112], functions=[sum(ws_ext_sales_price#18058)], output=[i_item_id#18112, total_sales#17851])
                  +- Exchange hashpartitioning(i_item_id#18112, 3000), ENSURE_REQUIREMENTS, [id=#19038]
                     +- HashAggregate(keys=[i_item_id#18112], functions=[partial_sum(ws_ext_sales_price#18058)], output=[i_item_id#18112, sum#18215])
                        +- Project [ws_ext_sales_price#18058, i_item_id#18112]
                           +- SortMergeJoin [ws_item_sk#18038L], [i_item_sk#18111L], Inner
                              :- Sort [ws_item_sk#18038L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_item_sk#18038L, 3000), ENSURE_REQUIREMENTS, [id=#19030]
                              :     +- Project [ws_item_sk#18038L, ws_ext_sales_price#18058]
                              :        +- SortMergeJoin [ws_bill_addr_sk#18042L], [ca_address_sk#18098L], Inner
                              :           :- Sort [ws_bill_addr_sk#18042L ASC NULLS FIRST], false, 0
                              :           :  +- Exchange hashpartitioning(ws_bill_addr_sk#18042L, 3000), ENSURE_REQUIREMENTS, [id=#19020]
                              :           :     +- Project [ws_item_sk#18038L, ws_bill_addr_sk#18042L, ws_ext_sales_price#18058]
                              :           :        +- BroadcastHashJoin [ws_sold_date_sk#18069L], [d_date_sk#18070L], Inner, BuildRight, false
                              :           :           :- Filter (isnotnull(ws_bill_addr_sk#18042L) AND isnotnull(ws_item_sk#18038L))
                              :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#18038L,ws_bill_addr_sk#18042L,ws_ext_sales_price#18058,ws_sold_date_sk#18069L] Batched: true, DataFilters: [isnotnull(ws_bill_addr_sk#18042L), isnotnull(ws_item_sk#18038L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#18069L), dynamicpruningexpression(ws_sold_date_sk#18069L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_addr_sk:bigint,ws_ext_sales_price:double>
                              :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#18207, 0, true, Project [d_date_sk#18070L], [d_date_sk#18070L]
                              :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :           :              +- Project [d_date_sk#18070L]
                              :           :           :                 +- Filter ((((isnotnull(d_year#18076) AND isnotnull(d_moy#18078)) AND (d_year#18076 = 1999)) AND (d_moy#18078 = 9)) AND isnotnull(d_date_sk#18070L))
                              :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18070L,d_year#18076,d_moy#18078] Batched: true, DataFilters: [isnotnull(d_year#18076), isnotnull(d_moy#18078), (d_year#18076 = 1999), (d_moy#18078 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19015]
                              :           :              +- Project [d_date_sk#18070L]
                              :           :                 +- Filter ((((isnotnull(d_year#18076) AND isnotnull(d_moy#18078)) AND (d_year#18076 = 1999)) AND (d_moy#18078 = 9)) AND isnotnull(d_date_sk#18070L))
                              :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18070L,d_year#18076,d_moy#18078] Batched: true, DataFilters: [isnotnull(d_year#18076), isnotnull(d_moy#18078), (d_year#18076 = 1999), (d_moy#18078 = 9), isnot..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :           +- Sort [ca_address_sk#18098L ASC NULLS FIRST], false, 0
                              :              +- Exchange hashpartitioning(ca_address_sk#18098L, 3000), ENSURE_REQUIREMENTS, [id=#19021]
                              :                 +- Project [ca_address_sk#18098L]
                              :                    +- Filter ((isnotnull(ca_gmt_offset#18109) AND (ca_gmt_offset#18109 = -6.0)) AND isnotnull(ca_address_sk#18098L))
                              :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18098L,ca_gmt_offset#18109] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#18109), (ca_gmt_offset#18109 = -6.0), isnotnull(ca_address_sk#18098L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-6.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
                              +- Sort [i_item_sk#18111L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(i_item_sk#18111L, 3000), ENSURE_REQUIREMENTS, [id=#19031]
                                    +- BroadcastHashJoin [i_item_id#18112], [i_item_id#18178], LeftSemi, BuildRight, false
                                       :- Filter isnotnull(i_item_sk#18111L)
                                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18111L,i_item_id#18112] Batched: true, DataFilters: [isnotnull(i_item_sk#18111L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
                                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#19026]
                                          +- Project [i_item_id#18178]
                                             +- Filter (isnotnull(i_category#18189) AND (i_category#18189 = Children))
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_id#18178,i_category#18189] Batched: true, DataFilters: [isnotnull(i_category#18189), (i_category#18189 = Children)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Children)], ReadSchema: struct<i_item_id:string,i_category:string>

read query: spark_queries/q61.sql
explain query: q61
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['promotions ASC NULLS FIRST, 'total ASC NULLS FIRST], true
      +- 'Project ['promotions, 'total, unresolvedalias(((cast('promotions as decimal(15,4)) / cast('total as decimal(15,4))) * 100), None)]
         +- 'Join Inner
            :- 'SubqueryAlias promotional_sales
            :  +- 'Project ['sum('ss_ext_sales_price) AS promotions#18216]
            :     +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) AND ('ss_store_sk = 's_store_sk)) AND ('ss_promo_sk = 'p_promo_sk)) AND ((('ss_customer_sk = 'c_customer_sk) AND ('ca_address_sk = 'c_current_addr_sk)) AND ('ss_item_sk = 'i_item_sk))) AND (((('ca_gmt_offset = -7) AND ('i_category = Electronics)) AND ((('p_channel_dmail = Y) OR ('p_channel_email = Y)) OR ('p_channel_tv = Y))) AND ((('s_gmt_offset = -7) AND ('d_year = 1999)) AND ('d_moy = 11))))
            :        +- 'Join Inner
            :           :- 'Join Inner
            :           :  :- 'Join Inner
            :           :  :  :- 'Join Inner
            :           :  :  :  :- 'Join Inner
            :           :  :  :  :  :- 'Join Inner
            :           :  :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
            :           :  :  :  :  :  +- 'UnresolvedRelation [store], [], false
            :           :  :  :  :  +- 'UnresolvedRelation [promotion], [], false
            :           :  :  :  +- 'UnresolvedRelation [date_dim], [], false
            :           :  :  +- 'UnresolvedRelation [customer], [], false
            :           :  +- 'UnresolvedRelation [customer_address], [], false
            :           +- 'UnresolvedRelation [item], [], false
            +- 'SubqueryAlias all_sales
               +- 'Project ['sum('ss_ext_sales_price) AS total#18217]
                  +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) AND ('ss_store_sk = 's_store_sk)) AND ('ss_customer_sk = 'c_customer_sk)) AND (('ca_address_sk = 'c_current_addr_sk) AND ('ss_item_sk = 'i_item_sk))) AND (((('ca_gmt_offset = -7) AND ('i_category = Electronics)) AND ('s_gmt_offset = -7)) AND (('d_year = 1999) AND ('d_moy = 11))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'Join Inner
                        :  :  :  :- 'Join Inner
                        :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
                        :  :  :  :  +- 'UnresolvedRelation [store], [], false
                        :  :  :  +- 'UnresolvedRelation [date_dim], [], false
                        :  :  +- 'UnresolvedRelation [customer], [], false
                        :  +- 'UnresolvedRelation [customer_address], [], false
                        +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
promotions: double, total: double, ((CAST(promotions AS DECIMAL(15,4)) / CAST(total AS DECIMAL(15,4))) * 100): decimal(38,19)
GlobalLimit 100
+- LocalLimit 100
   +- Sort [promotions#18216 ASC NULLS FIRST, total#18217 ASC NULLS FIRST], true
      +- Project [promotions#18216, total#18217, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(promotions#18216 as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(total#18217 as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) as decimal(35,20))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(35,20)))), DecimalType(38,19), true) AS ((CAST(promotions AS DECIMAL(15,4)) / CAST(total AS DECIMAL(15,4))) * 100)#18505]
         +- Join Inner
            :- SubqueryAlias promotional_sales
            :  +- Aggregate [sum(ss_ext_sales_price#18232) AS promotions#18216]
            :     +- Filter (((((ss_sold_date_sk#18240L = d_date_sk#18289L) AND (ss_store_sk#18224L = s_store_sk#18241L)) AND (ss_promo_sk#18225L = p_promo_sk#18270L)) AND (((ss_customer_sk#18220L = c_customer_sk#18317L) AND (ca_address_sk#18335L = c_current_addr_sk#18321L)) AND (ss_item_sk#18219L = i_item_sk#18348L))) AND ((((ca_gmt_offset#18346 = cast(-7 as double)) AND (i_category#18360 = Electronics)) AND (((p_channel_dmail#18278 = Y) OR (p_channel_email#18279 = Y)) OR (p_channel_tv#18281 = Y))) AND (((s_gmt_offset#18268 = cast(-7 as double)) AND (d_year#18295 = 1999)) AND (d_moy#18297 = 11))))
            :        +- Join Inner
            :           :- Join Inner
            :           :  :- Join Inner
            :           :  :  :- Join Inner
            :           :  :  :  :- Join Inner
            :           :  :  :  :  :- Join Inner
            :           :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
            :           :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18218L,ss_item_sk#18219L,ss_customer_sk#18220L,ss_cdemo_sk#18221L,ss_hdemo_sk#18222L,ss_addr_sk#18223L,ss_store_sk#18224L,ss_promo_sk#18225L,ss_ticket_number#18226L,ss_quantity#18227,ss_wholesale_cost#18228,ss_list_price#18229,ss_sales_price#18230,ss_ext_discount_amt#18231,ss_ext_sales_price#18232,ss_ext_wholesale_cost#18233,ss_ext_list_price#18234,ss_ext_tax#18235,ss_coupon_amt#18236,ss_net_paid#18237,ss_net_paid_inc_tax#18238,ss_net_profit#18239,ss_sold_date_sk#18240L] orc
            :           :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
            :           :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18241L,s_store_id#18242,s_rec_start_date#18243,s_rec_end_date#18244,s_closed_date_sk#18245L,s_store_name#18246,s_number_employees#18247,s_floor_space#18248,s_hours#18249,s_manager#18250,s_market_id#18251,s_geography_class#18252,s_market_desc#18253,s_market_manager#18254,s_division_id#18255,s_division_name#18256,s_company_id#18257,s_company_name#18258,s_street_number#18259,s_street_name#18260,s_street_type#18261,s_suite_number#18262,s_city#18263,s_county#18264,... 5 more fields] orc
            :           :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
            :           :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#18270L,p_promo_id#18271,p_start_date_sk#18272L,p_end_date_sk#18273L,p_item_sk#18274L,p_cost#18275,p_response_target#18276,p_promo_name#18277,p_channel_dmail#18278,p_channel_email#18279,p_channel_catalog#18280,p_channel_tv#18281,p_channel_radio#18282,p_channel_press#18283,p_channel_event#18284,p_channel_demo#18285,p_channel_details#18286,p_purpose#18287,p_discount_active#18288] orc
            :           :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :           :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18289L,d_date_id#18290,d_date#18291,d_month_seq#18292,d_week_seq#18293,d_quarter_seq#18294,d_year#18295,d_dow#18296,d_moy#18297,d_dom#18298,d_qoy#18299,d_fy_year#18300,d_fy_quarter_seq#18301,d_fy_week_seq#18302,d_day_name#18303,d_quarter_name#18304,d_holiday#18305,d_weekend#18306,d_following_holiday#18307,d_first_dom#18308,d_last_dom#18309,d_same_day_ly#18310,d_same_day_lq#18311,d_current_day#18312,... 4 more fields] orc
            :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
            :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18317L,c_customer_id#18318,c_current_cdemo_sk#18319L,c_current_hdemo_sk#18320L,c_current_addr_sk#18321L,c_first_shipto_date_sk#18322L,c_first_sales_date_sk#18323L,c_salutation#18324,c_first_name#18325,c_last_name#18326,c_preferred_cust_flag#18327,c_birth_day#18328,c_birth_month#18329,c_birth_year#18330,c_birth_country#18331,c_login#18332,c_email_address#18333,c_last_review_date#18334] orc
            :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18335L,ca_address_id#18336,ca_street_number#18337,ca_street_name#18338,ca_street_type#18339,ca_suite_number#18340,ca_city#18341,ca_county#18342,ca_state#18343,ca_zip#18344,ca_country#18345,ca_gmt_offset#18346,ca_location_type#18347] orc
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18348L,i_item_id#18349,i_rec_start_date#18350,i_rec_end_date#18351,i_item_desc#18352,i_current_price#18353,i_wholesale_cost#18354,i_brand_id#18355,i_brand#18356,i_class_id#18357,i_class#18358,i_category_id#18359,i_category#18360,i_manufact_id#18361,i_manufact#18362,i_size#18363,i_formulation#18364,i_color#18365,i_units#18366,i_container#18367,i_manager_id#18368,i_product_name#18369] orc
            +- SubqueryAlias all_sales
               +- Aggregate [sum(ss_ext_sales_price#18384) AS total#18217]
                  +- Filter (((((ss_sold_date_sk#18392L = d_date_sk#18422L) AND (ss_store_sk#18376L = s_store_sk#18393L)) AND (ss_customer_sk#18372L = c_customer_sk#18450L)) AND ((ca_address_sk#18468L = c_current_addr_sk#18454L) AND (ss_item_sk#18371L = i_item_sk#18481L))) AND ((((ca_gmt_offset#18479 = cast(-7 as double)) AND (i_category#18493 = Electronics)) AND (s_gmt_offset#18420 = cast(-7 as double))) AND ((d_year#18428 = 1999) AND (d_moy#18430 = 11))))
                     +- Join Inner
                        :- Join Inner
                        :  :- Join Inner
                        :  :  :- Join Inner
                        :  :  :  :- Join Inner
                        :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                        :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18370L,ss_item_sk#18371L,ss_customer_sk#18372L,ss_cdemo_sk#18373L,ss_hdemo_sk#18374L,ss_addr_sk#18375L,ss_store_sk#18376L,ss_promo_sk#18377L,ss_ticket_number#18378L,ss_quantity#18379,ss_wholesale_cost#18380,ss_list_price#18381,ss_sales_price#18382,ss_ext_discount_amt#18383,ss_ext_sales_price#18384,ss_ext_wholesale_cost#18385,ss_ext_list_price#18386,ss_ext_tax#18387,ss_coupon_amt#18388,ss_net_paid#18389,ss_net_paid_inc_tax#18390,ss_net_profit#18391,ss_sold_date_sk#18392L] orc
                        :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                        :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18393L,s_store_id#18394,s_rec_start_date#18395,s_rec_end_date#18396,s_closed_date_sk#18397L,s_store_name#18398,s_number_employees#18399,s_floor_space#18400,s_hours#18401,s_manager#18402,s_market_id#18403,s_geography_class#18404,s_market_desc#18405,s_market_manager#18406,s_division_id#18407,s_division_name#18408,s_company_id#18409,s_company_name#18410,s_street_number#18411,s_street_name#18412,s_street_type#18413,s_suite_number#18414,s_city#18415,s_county#18416,... 5 more fields] orc
                        :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18422L,d_date_id#18423,d_date#18424,d_month_seq#18425,d_week_seq#18426,d_quarter_seq#18427,d_year#18428,d_dow#18429,d_moy#18430,d_dom#18431,d_qoy#18432,d_fy_year#18433,d_fy_quarter_seq#18434,d_fy_week_seq#18435,d_day_name#18436,d_quarter_name#18437,d_holiday#18438,d_weekend#18439,d_following_holiday#18440,d_first_dom#18441,d_last_dom#18442,d_same_day_ly#18443,d_same_day_lq#18444,d_current_day#18445,... 4 more fields] orc
                        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18450L,c_customer_id#18451,c_current_cdemo_sk#18452L,c_current_hdemo_sk#18453L,c_current_addr_sk#18454L,c_first_shipto_date_sk#18455L,c_first_sales_date_sk#18456L,c_salutation#18457,c_first_name#18458,c_last_name#18459,c_preferred_cust_flag#18460,c_birth_day#18461,c_birth_month#18462,c_birth_year#18463,c_birth_country#18464,c_login#18465,c_email_address#18466,c_last_review_date#18467] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18468L,ca_address_id#18469,ca_street_number#18470,ca_street_name#18471,ca_street_type#18472,ca_suite_number#18473,ca_city#18474,ca_county#18475,ca_state#18476,ca_zip#18477,ca_country#18478,ca_gmt_offset#18479,ca_location_type#18480] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18481L,i_item_id#18482,i_rec_start_date#18483,i_rec_end_date#18484,i_item_desc#18485,i_current_price#18486,i_wholesale_cost#18487,i_brand_id#18488,i_brand#18489,i_class_id#18490,i_class#18491,i_category_id#18492,i_category#18493,i_manufact_id#18494,i_manufact#18495,i_size#18496,i_formulation#18497,i_color#18498,i_units#18499,i_container#18500,i_manager_id#18501,i_product_name#18502] orc

== Optimized Logical Plan ==
Project [promotions#18216, total#18217, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(promotions#18216 as decimal(15,4))) / promote_precision(cast(total#18217 as decimal(15,4)))), DecimalType(35,20), true)) * 100.00000000000000000000), DecimalType(38,19), true) AS ((CAST(promotions AS DECIMAL(15,4)) / CAST(total AS DECIMAL(15,4))) * 100)#18505]
+- Join Inner
   :- Aggregate [sum(ss_ext_sales_price#18232) AS promotions#18216]
   :  +- Project [ss_ext_sales_price#18232]
   :     +- Join Inner, (ss_store_sk#18224L = s_store_sk#18241L)
   :        :- Project [ss_store_sk#18224L, ss_ext_sales_price#18232]
   :        :  +- Join Inner, (ss_item_sk#18219L = i_item_sk#18348L)
   :        :     :- Project [ss_item_sk#18219L, ss_store_sk#18224L, ss_ext_sales_price#18232]
   :        :     :  +- Join Inner, (ss_promo_sk#18225L = p_promo_sk#18270L)
   :        :     :     :- Project [ss_item_sk#18219L, ss_store_sk#18224L, ss_promo_sk#18225L, ss_ext_sales_price#18232]
   :        :     :     :  +- Join Inner, (ss_customer_sk#18220L = c_customer_sk#18317L)
   :        :     :     :     :- Project [ss_item_sk#18219L, ss_customer_sk#18220L, ss_store_sk#18224L, ss_promo_sk#18225L, ss_ext_sales_price#18232]
   :        :     :     :     :  +- Join Inner, (ss_sold_date_sk#18240L = d_date_sk#18289L)
   :        :     :     :     :     :- Project [ss_item_sk#18219L, ss_customer_sk#18220L, ss_store_sk#18224L, ss_promo_sk#18225L, ss_ext_sales_price#18232, ss_sold_date_sk#18240L]
   :        :     :     :     :     :  +- Filter (((((isnotnull(ss_store_sk#18224L) AND isnotnull(ss_promo_sk#18225L)) AND isnotnull(ss_sold_date_sk#18240L)) AND isnotnull(ss_customer_sk#18220L)) AND isnotnull(ss_item_sk#18219L)) AND dynamicpruning#18509 [ss_sold_date_sk#18240L])
   :        :     :     :     :     :     :  +- Project [d_date_sk#18289L]
   :        :     :     :     :     :     :     +- Filter (((isnotnull(d_year#18295) AND isnotnull(d_moy#18297)) AND ((d_year#18295 = 1999) AND (d_moy#18297 = 11))) AND isnotnull(d_date_sk#18289L))
   :        :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18289L,d_date_id#18290,d_date#18291,d_month_seq#18292,d_week_seq#18293,d_quarter_seq#18294,d_year#18295,d_dow#18296,d_moy#18297,d_dom#18298,d_qoy#18299,d_fy_year#18300,d_fy_quarter_seq#18301,d_fy_week_seq#18302,d_day_name#18303,d_quarter_name#18304,d_holiday#18305,d_weekend#18306,d_following_holiday#18307,d_first_dom#18308,d_last_dom#18309,d_same_day_ly#18310,d_same_day_lq#18311,d_current_day#18312,... 4 more fields] orc
   :        :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18218L,ss_item_sk#18219L,ss_customer_sk#18220L,ss_cdemo_sk#18221L,ss_hdemo_sk#18222L,ss_addr_sk#18223L,ss_store_sk#18224L,ss_promo_sk#18225L,ss_ticket_number#18226L,ss_quantity#18227,ss_wholesale_cost#18228,ss_list_price#18229,ss_sales_price#18230,ss_ext_discount_amt#18231,ss_ext_sales_price#18232,ss_ext_wholesale_cost#18233,ss_ext_list_price#18234,ss_ext_tax#18235,ss_coupon_amt#18236,ss_net_paid#18237,ss_net_paid_inc_tax#18238,ss_net_profit#18239,ss_sold_date_sk#18240L] orc
   :        :     :     :     :     +- Project [d_date_sk#18289L]
   :        :     :     :     :        +- Filter (((isnotnull(d_year#18295) AND isnotnull(d_moy#18297)) AND ((d_year#18295 = 1999) AND (d_moy#18297 = 11))) AND isnotnull(d_date_sk#18289L))
   :        :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18289L,d_date_id#18290,d_date#18291,d_month_seq#18292,d_week_seq#18293,d_quarter_seq#18294,d_year#18295,d_dow#18296,d_moy#18297,d_dom#18298,d_qoy#18299,d_fy_year#18300,d_fy_quarter_seq#18301,d_fy_week_seq#18302,d_day_name#18303,d_quarter_name#18304,d_holiday#18305,d_weekend#18306,d_following_holiday#18307,d_first_dom#18308,d_last_dom#18309,d_same_day_ly#18310,d_same_day_lq#18311,d_current_day#18312,... 4 more fields] orc
   :        :     :     :     +- Project [c_customer_sk#18317L]
   :        :     :     :        +- Join Inner, (ca_address_sk#18335L = c_current_addr_sk#18321L)
   :        :     :     :           :- Project [c_customer_sk#18317L, c_current_addr_sk#18321L]
   :        :     :     :           :  +- Filter (isnotnull(c_customer_sk#18317L) AND isnotnull(c_current_addr_sk#18321L))
   :        :     :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18317L,c_customer_id#18318,c_current_cdemo_sk#18319L,c_current_hdemo_sk#18320L,c_current_addr_sk#18321L,c_first_shipto_date_sk#18322L,c_first_sales_date_sk#18323L,c_salutation#18324,c_first_name#18325,c_last_name#18326,c_preferred_cust_flag#18327,c_birth_day#18328,c_birth_month#18329,c_birth_year#18330,c_birth_country#18331,c_login#18332,c_email_address#18333,c_last_review_date#18334] orc
   :        :     :     :           +- Project [ca_address_sk#18335L]
   :        :     :     :              +- Filter ((isnotnull(ca_gmt_offset#18346) AND (ca_gmt_offset#18346 = -7.0)) AND isnotnull(ca_address_sk#18335L))
   :        :     :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18335L,ca_address_id#18336,ca_street_number#18337,ca_street_name#18338,ca_street_type#18339,ca_suite_number#18340,ca_city#18341,ca_county#18342,ca_state#18343,ca_zip#18344,ca_country#18345,ca_gmt_offset#18346,ca_location_type#18347] orc
   :        :     :     +- Project [p_promo_sk#18270L]
   :        :     :        +- Filter ((((p_channel_dmail#18278 = Y) OR (p_channel_email#18279 = Y)) OR (p_channel_tv#18281 = Y)) AND isnotnull(p_promo_sk#18270L))
   :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#18270L,p_promo_id#18271,p_start_date_sk#18272L,p_end_date_sk#18273L,p_item_sk#18274L,p_cost#18275,p_response_target#18276,p_promo_name#18277,p_channel_dmail#18278,p_channel_email#18279,p_channel_catalog#18280,p_channel_tv#18281,p_channel_radio#18282,p_channel_press#18283,p_channel_event#18284,p_channel_demo#18285,p_channel_details#18286,p_purpose#18287,p_discount_active#18288] orc
   :        :     +- Project [i_item_sk#18348L]
   :        :        +- Filter ((isnotnull(i_category#18360) AND (i_category#18360 = Electronics)) AND isnotnull(i_item_sk#18348L))
   :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18348L,i_item_id#18349,i_rec_start_date#18350,i_rec_end_date#18351,i_item_desc#18352,i_current_price#18353,i_wholesale_cost#18354,i_brand_id#18355,i_brand#18356,i_class_id#18357,i_class#18358,i_category_id#18359,i_category#18360,i_manufact_id#18361,i_manufact#18362,i_size#18363,i_formulation#18364,i_color#18365,i_units#18366,i_container#18367,i_manager_id#18368,i_product_name#18369] orc
   :        +- Project [s_store_sk#18241L]
   :           +- Filter ((isnotnull(s_gmt_offset#18268) AND (s_gmt_offset#18268 = -7.0)) AND isnotnull(s_store_sk#18241L))
   :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18241L,s_store_id#18242,s_rec_start_date#18243,s_rec_end_date#18244,s_closed_date_sk#18245L,s_store_name#18246,s_number_employees#18247,s_floor_space#18248,s_hours#18249,s_manager#18250,s_market_id#18251,s_geography_class#18252,s_market_desc#18253,s_market_manager#18254,s_division_id#18255,s_division_name#18256,s_company_id#18257,s_company_name#18258,s_street_number#18259,s_street_name#18260,s_street_type#18261,s_suite_number#18262,s_city#18263,s_county#18264,... 5 more fields] orc
   +- Aggregate [sum(ss_ext_sales_price#18384) AS total#18217]
      +- Project [ss_ext_sales_price#18384]
         +- Join Inner, (ss_store_sk#18376L = s_store_sk#18393L)
            :- Project [ss_store_sk#18376L, ss_ext_sales_price#18384]
            :  +- Join Inner, (ss_item_sk#18371L = i_item_sk#18481L)
            :     :- Project [ss_item_sk#18371L, ss_store_sk#18376L, ss_ext_sales_price#18384]
            :     :  +- Join Inner, (ss_customer_sk#18372L = c_customer_sk#18450L)
            :     :     :- Project [ss_item_sk#18371L, ss_customer_sk#18372L, ss_store_sk#18376L, ss_ext_sales_price#18384]
            :     :     :  +- Join Inner, (ss_sold_date_sk#18392L = d_date_sk#18422L)
            :     :     :     :- Project [ss_item_sk#18371L, ss_customer_sk#18372L, ss_store_sk#18376L, ss_ext_sales_price#18384, ss_sold_date_sk#18392L]
            :     :     :     :  +- Filter ((((isnotnull(ss_store_sk#18376L) AND isnotnull(ss_sold_date_sk#18392L)) AND isnotnull(ss_customer_sk#18372L)) AND isnotnull(ss_item_sk#18371L)) AND dynamicpruning#18510 [ss_sold_date_sk#18392L])
            :     :     :     :     :  +- Project [d_date_sk#18422L]
            :     :     :     :     :     +- Filter (((isnotnull(d_year#18428) AND isnotnull(d_moy#18430)) AND ((d_year#18428 = 1999) AND (d_moy#18430 = 11))) AND isnotnull(d_date_sk#18422L))
            :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18422L,d_date_id#18423,d_date#18424,d_month_seq#18425,d_week_seq#18426,d_quarter_seq#18427,d_year#18428,d_dow#18429,d_moy#18430,d_dom#18431,d_qoy#18432,d_fy_year#18433,d_fy_quarter_seq#18434,d_fy_week_seq#18435,d_day_name#18436,d_quarter_name#18437,d_holiday#18438,d_weekend#18439,d_following_holiday#18440,d_first_dom#18441,d_last_dom#18442,d_same_day_ly#18443,d_same_day_lq#18444,d_current_day#18445,... 4 more fields] orc
            :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18370L,ss_item_sk#18371L,ss_customer_sk#18372L,ss_cdemo_sk#18373L,ss_hdemo_sk#18374L,ss_addr_sk#18375L,ss_store_sk#18376L,ss_promo_sk#18377L,ss_ticket_number#18378L,ss_quantity#18379,ss_wholesale_cost#18380,ss_list_price#18381,ss_sales_price#18382,ss_ext_discount_amt#18383,ss_ext_sales_price#18384,ss_ext_wholesale_cost#18385,ss_ext_list_price#18386,ss_ext_tax#18387,ss_coupon_amt#18388,ss_net_paid#18389,ss_net_paid_inc_tax#18390,ss_net_profit#18391,ss_sold_date_sk#18392L] orc
            :     :     :     +- Project [d_date_sk#18422L]
            :     :     :        +- Filter (((isnotnull(d_year#18428) AND isnotnull(d_moy#18430)) AND ((d_year#18428 = 1999) AND (d_moy#18430 = 11))) AND isnotnull(d_date_sk#18422L))
            :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18422L,d_date_id#18423,d_date#18424,d_month_seq#18425,d_week_seq#18426,d_quarter_seq#18427,d_year#18428,d_dow#18429,d_moy#18430,d_dom#18431,d_qoy#18432,d_fy_year#18433,d_fy_quarter_seq#18434,d_fy_week_seq#18435,d_day_name#18436,d_quarter_name#18437,d_holiday#18438,d_weekend#18439,d_following_holiday#18440,d_first_dom#18441,d_last_dom#18442,d_same_day_ly#18443,d_same_day_lq#18444,d_current_day#18445,... 4 more fields] orc
            :     :     +- Project [c_customer_sk#18450L]
            :     :        +- Join Inner, (ca_address_sk#18468L = c_current_addr_sk#18454L)
            :     :           :- Project [c_customer_sk#18450L, c_current_addr_sk#18454L]
            :     :           :  +- Filter (isnotnull(c_customer_sk#18450L) AND isnotnull(c_current_addr_sk#18454L))
            :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18450L,c_customer_id#18451,c_current_cdemo_sk#18452L,c_current_hdemo_sk#18453L,c_current_addr_sk#18454L,c_first_shipto_date_sk#18455L,c_first_sales_date_sk#18456L,c_salutation#18457,c_first_name#18458,c_last_name#18459,c_preferred_cust_flag#18460,c_birth_day#18461,c_birth_month#18462,c_birth_year#18463,c_birth_country#18464,c_login#18465,c_email_address#18466,c_last_review_date#18467] orc
            :     :           +- Project [ca_address_sk#18468L]
            :     :              +- Filter ((isnotnull(ca_gmt_offset#18479) AND (ca_gmt_offset#18479 = -7.0)) AND isnotnull(ca_address_sk#18468L))
            :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18468L,ca_address_id#18469,ca_street_number#18470,ca_street_name#18471,ca_street_type#18472,ca_suite_number#18473,ca_city#18474,ca_county#18475,ca_state#18476,ca_zip#18477,ca_country#18478,ca_gmt_offset#18479,ca_location_type#18480] orc
            :     +- Project [i_item_sk#18481L]
            :        +- Filter ((isnotnull(i_category#18493) AND (i_category#18493 = Electronics)) AND isnotnull(i_item_sk#18481L))
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18481L,i_item_id#18482,i_rec_start_date#18483,i_rec_end_date#18484,i_item_desc#18485,i_current_price#18486,i_wholesale_cost#18487,i_brand_id#18488,i_brand#18489,i_class_id#18490,i_class#18491,i_category_id#18492,i_category#18493,i_manufact_id#18494,i_manufact#18495,i_size#18496,i_formulation#18497,i_color#18498,i_units#18499,i_container#18500,i_manager_id#18501,i_product_name#18502] orc
            +- Project [s_store_sk#18393L]
               +- Filter ((isnotnull(s_gmt_offset#18420) AND (s_gmt_offset#18420 = -7.0)) AND isnotnull(s_store_sk#18393L))
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18393L,s_store_id#18394,s_rec_start_date#18395,s_rec_end_date#18396,s_closed_date_sk#18397L,s_store_name#18398,s_number_employees#18399,s_floor_space#18400,s_hours#18401,s_manager#18402,s_market_id#18403,s_geography_class#18404,s_market_desc#18405,s_market_manager#18406,s_division_id#18407,s_division_name#18408,s_company_id#18409,s_company_name#18410,s_street_number#18411,s_street_name#18412,s_street_type#18413,s_suite_number#18414,s_city#18415,s_county#18416,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Project [promotions#18216, total#18217, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(promotions#18216 as decimal(15,4))) / promote_precision(cast(total#18217 as decimal(15,4)))), DecimalType(35,20), true)) * 100.00000000000000000000), DecimalType(38,19), true) AS ((CAST(promotions AS DECIMAL(15,4)) / CAST(total AS DECIMAL(15,4))) * 100)#18505]
   +- BroadcastNestedLoopJoin BuildRight, Inner
      :- HashAggregate(keys=[], functions=[sum(ss_ext_sales_price#18232)], output=[promotions#18216])
      :  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#19362]
      :     +- HashAggregate(keys=[], functions=[partial_sum(ss_ext_sales_price#18232)], output=[sum#18512])
      :        +- Project [ss_ext_sales_price#18232]
      :           +- BroadcastHashJoin [ss_store_sk#18224L], [s_store_sk#18241L], Inner, BuildRight, false
      :              :- Project [ss_store_sk#18224L, ss_ext_sales_price#18232]
      :              :  +- BroadcastHashJoin [ss_item_sk#18219L], [i_item_sk#18348L], Inner, BuildRight, false
      :              :     :- Project [ss_item_sk#18219L, ss_store_sk#18224L, ss_ext_sales_price#18232]
      :              :     :  +- BroadcastHashJoin [ss_promo_sk#18225L], [p_promo_sk#18270L], Inner, BuildRight, false
      :              :     :     :- Project [ss_item_sk#18219L, ss_store_sk#18224L, ss_promo_sk#18225L, ss_ext_sales_price#18232]
      :              :     :     :  +- SortMergeJoin [ss_customer_sk#18220L], [c_customer_sk#18317L], Inner
      :              :     :     :     :- Sort [ss_customer_sk#18220L ASC NULLS FIRST], false, 0
      :              :     :     :     :  +- Exchange hashpartitioning(ss_customer_sk#18220L, 3000), ENSURE_REQUIREMENTS, [id=#19342]
      :              :     :     :     :     +- Project [ss_item_sk#18219L, ss_customer_sk#18220L, ss_store_sk#18224L, ss_promo_sk#18225L, ss_ext_sales_price#18232]
      :              :     :     :     :        +- BroadcastHashJoin [ss_sold_date_sk#18240L], [d_date_sk#18289L], Inner, BuildRight, false
      :              :     :     :     :           :- Filter (((isnotnull(ss_store_sk#18224L) AND isnotnull(ss_promo_sk#18225L)) AND isnotnull(ss_customer_sk#18220L)) AND isnotnull(ss_item_sk#18219L))
      :              :     :     :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#18219L,ss_customer_sk#18220L,ss_store_sk#18224L,ss_promo_sk#18225L,ss_ext_sales_price#18232,ss_sold_date_sk#18240L] Batched: true, DataFilters: [isnotnull(ss_store_sk#18224L), isnotnull(ss_promo_sk#18225L), isnotnull(ss_customer_sk#18220L), ..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#18240L), dynamicpruningexpression(ss_sold_date_sk#18240L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_promo_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_promo_sk:bigint,ss_ext_sales...
      :              :     :     :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#18509, 0, true, Project [d_date_sk#18289L], [d_date_sk#18289L]
      :              :     :     :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
      :              :     :     :     :           :              +- Project [d_date_sk#18289L]
      :              :     :     :     :           :                 +- Filter ((((isnotnull(d_year#18295) AND isnotnull(d_moy#18297)) AND (d_year#18295 = 1999)) AND (d_moy#18297 = 11)) AND isnotnull(d_date_sk#18289L))
      :              :     :     :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18289L,d_year#18295,d_moy#18297] Batched: true, DataFilters: [isnotnull(d_year#18295), isnotnull(d_moy#18297), (d_year#18295 = 1999), (d_moy#18297 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
      :              :     :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19330]
      :              :     :     :     :              +- Project [d_date_sk#18289L]
      :              :     :     :     :                 +- Filter ((((isnotnull(d_year#18295) AND isnotnull(d_moy#18297)) AND (d_year#18295 = 1999)) AND (d_moy#18297 = 11)) AND isnotnull(d_date_sk#18289L))
      :              :     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18289L,d_year#18295,d_moy#18297] Batched: true, DataFilters: [isnotnull(d_year#18295), isnotnull(d_moy#18297), (d_year#18295 = 1999), (d_moy#18297 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
      :              :     :     :     +- Sort [c_customer_sk#18317L ASC NULLS FIRST], false, 0
      :              :     :     :        +- Exchange hashpartitioning(c_customer_sk#18317L, 3000), ENSURE_REQUIREMENTS, [id=#19343]
      :              :     :     :           +- Project [c_customer_sk#18317L]
      :              :     :     :              +- SortMergeJoin [c_current_addr_sk#18321L], [ca_address_sk#18335L], Inner
      :              :     :     :                 :- Sort [c_current_addr_sk#18321L ASC NULLS FIRST], false, 0
      :              :     :     :                 :  +- Exchange hashpartitioning(c_current_addr_sk#18321L, 3000), ENSURE_REQUIREMENTS, [id=#19334]
      :              :     :     :                 :     +- Filter (isnotnull(c_customer_sk#18317L) AND isnotnull(c_current_addr_sk#18321L))
      :              :     :     :                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18317L,c_current_addr_sk#18321L] Batched: true, DataFilters: [isnotnull(c_customer_sk#18317L), isnotnull(c_current_addr_sk#18321L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
      :              :     :     :                 +- Sort [ca_address_sk#18335L ASC NULLS FIRST], false, 0
      :              :     :     :                    +- Exchange hashpartitioning(ca_address_sk#18335L, 3000), ENSURE_REQUIREMENTS, [id=#19335]
      :              :     :     :                       +- Project [ca_address_sk#18335L]
      :              :     :     :                          +- Filter ((isnotnull(ca_gmt_offset#18346) AND (ca_gmt_offset#18346 = -7.0)) AND isnotnull(ca_address_sk#18335L))
      :              :     :     :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18335L,ca_gmt_offset#18346] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#18346), (ca_gmt_offset#18346 = -7.0), isnotnull(ca_address_sk#18335L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-7.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
      :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19349]
      :              :     :        +- Project [p_promo_sk#18270L]
      :              :     :           +- Filter ((((p_channel_dmail#18278 = Y) OR (p_channel_email#18279 = Y)) OR (p_channel_tv#18281 = Y)) AND isnotnull(p_promo_sk#18270L))
      :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#18270L,p_channel_dmail#18278,p_channel_email#18279,p_channel_tv#18281] Batched: true, DataFilters: [(((p_channel_dmail#18278 = Y) OR (p_channel_email#18279 = Y)) OR (p_channel_tv#18281 = Y)), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(p_channel_dmail,Y),EqualTo(p_channel_email,Y)),EqualTo(p_channel_tv,Y)), IsNotNull..., ReadSchema: struct<p_promo_sk:bigint,p_channel_dmail:string,p_channel_email:string,p_channel_tv:string>
      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19353]
      :              :        +- Project [i_item_sk#18348L]
      :              :           +- Filter ((isnotnull(i_category#18360) AND (i_category#18360 = Electronics)) AND isnotnull(i_item_sk#18348L))
      :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18348L,i_category#18360] Batched: true, DataFilters: [isnotnull(i_category#18360), (i_category#18360 = Electronics), isnotnull(i_item_sk#18348L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Electronics), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category:string>
      :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19357]
      :                 +- Project [s_store_sk#18241L]
      :                    +- Filter ((isnotnull(s_gmt_offset#18268) AND (s_gmt_offset#18268 = -7.0)) AND isnotnull(s_store_sk#18241L))
      :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18241L,s_gmt_offset#18268] Batched: true, DataFilters: [isnotnull(s_gmt_offset#18268), (s_gmt_offset#18268 = -7.0), isnotnull(s_store_sk#18241L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_gmt_offset), EqualTo(s_gmt_offset,-7.0), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_gmt_offset:double>
      +- BroadcastExchange IdentityBroadcastMode, [id=#19395]
         +- HashAggregate(keys=[], functions=[sum(ss_ext_sales_price#18384)], output=[total#18217])
            +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#19392]
               +- HashAggregate(keys=[], functions=[partial_sum(ss_ext_sales_price#18384)], output=[sum#18514])
                  +- Project [ss_ext_sales_price#18384]
                     +- BroadcastHashJoin [ss_store_sk#18376L], [s_store_sk#18393L], Inner, BuildRight, false
                        :- Project [ss_store_sk#18376L, ss_ext_sales_price#18384]
                        :  +- BroadcastHashJoin [ss_item_sk#18371L], [i_item_sk#18481L], Inner, BuildRight, false
                        :     :- Project [ss_item_sk#18371L, ss_store_sk#18376L, ss_ext_sales_price#18384]
                        :     :  +- SortMergeJoin [ss_customer_sk#18372L], [c_customer_sk#18450L], Inner
                        :     :     :- Sort [ss_customer_sk#18372L ASC NULLS FIRST], false, 0
                        :     :     :  +- Exchange hashpartitioning(ss_customer_sk#18372L, 3000), ENSURE_REQUIREMENTS, [id=#19376]
                        :     :     :     +- Project [ss_item_sk#18371L, ss_customer_sk#18372L, ss_store_sk#18376L, ss_ext_sales_price#18384]
                        :     :     :        +- BroadcastHashJoin [ss_sold_date_sk#18392L], [d_date_sk#18422L], Inner, BuildRight, false
                        :     :     :           :- Filter ((isnotnull(ss_store_sk#18376L) AND isnotnull(ss_customer_sk#18372L)) AND isnotnull(ss_item_sk#18371L))
                        :     :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#18371L,ss_customer_sk#18372L,ss_store_sk#18376L,ss_ext_sales_price#18384,ss_sold_date_sk#18392L] Batched: true, DataFilters: [isnotnull(ss_store_sk#18376L), isnotnull(ss_customer_sk#18372L), isnotnull(ss_item_sk#18371L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#18392L), dynamicpruningexpression(ss_sold_date_sk#18392L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_store_sk:bigint,ss_ext_sales_price:double>
                        :     :     :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#18510, 0, true, Project [d_date_sk#18422L], [d_date_sk#18422L]
                        :     :     :           :           +- AdaptiveSparkPlan isFinalPlan=false
                        :     :     :           :              +- Project [d_date_sk#18422L]
                        :     :     :           :                 +- Filter ((((isnotnull(d_year#18428) AND isnotnull(d_moy#18430)) AND (d_year#18428 = 1999)) AND (d_moy#18430 = 11)) AND isnotnull(d_date_sk#18422L))
                        :     :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18422L,d_year#18428,d_moy#18430] Batched: true, DataFilters: [isnotnull(d_year#18428), isnotnull(d_moy#18430), (d_year#18428 = 1999), (d_moy#18430 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                        :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19364]
                        :     :     :              +- Project [d_date_sk#18422L]
                        :     :     :                 +- Filter ((((isnotnull(d_year#18428) AND isnotnull(d_moy#18430)) AND (d_year#18428 = 1999)) AND (d_moy#18430 = 11)) AND isnotnull(d_date_sk#18422L))
                        :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18422L,d_year#18428,d_moy#18430] Batched: true, DataFilters: [isnotnull(d_year#18428), isnotnull(d_moy#18430), (d_year#18428 = 1999), (d_moy#18430 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                        :     :     +- Sort [c_customer_sk#18450L ASC NULLS FIRST], false, 0
                        :     :        +- Exchange hashpartitioning(c_customer_sk#18450L, 3000), ENSURE_REQUIREMENTS, [id=#19377]
                        :     :           +- Project [c_customer_sk#18450L]
                        :     :              +- SortMergeJoin [c_current_addr_sk#18454L], [ca_address_sk#18468L], Inner
                        :     :                 :- Sort [c_current_addr_sk#18454L ASC NULLS FIRST], false, 0
                        :     :                 :  +- Exchange hashpartitioning(c_current_addr_sk#18454L, 3000), ENSURE_REQUIREMENTS, [id=#19368]
                        :     :                 :     +- Filter (isnotnull(c_customer_sk#18450L) AND isnotnull(c_current_addr_sk#18454L))
                        :     :                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#18450L,c_current_addr_sk#18454L] Batched: true, DataFilters: [isnotnull(c_customer_sk#18450L), isnotnull(c_current_addr_sk#18454L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint>
                        :     :                 +- Sort [ca_address_sk#18468L ASC NULLS FIRST], false, 0
                        :     :                    +- Exchange hashpartitioning(ca_address_sk#18468L, 3000), ENSURE_REQUIREMENTS, [id=#19369]
                        :     :                       +- Project [ca_address_sk#18468L]
                        :     :                          +- Filter ((isnotnull(ca_gmt_offset#18479) AND (ca_gmt_offset#18479 = -7.0)) AND isnotnull(ca_address_sk#18468L))
                        :     :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#18468L,ca_gmt_offset#18479] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#18479), (ca_gmt_offset#18479 = -7.0), isnotnull(ca_address_sk#18468L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-7.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
                        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19383]
                        :        +- Project [i_item_sk#18481L]
                        :           +- Filter ((isnotnull(i_category#18493) AND (i_category#18493 = Electronics)) AND isnotnull(i_item_sk#18481L))
                        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18481L,i_category#18493] Batched: true, DataFilters: [isnotnull(i_category#18493), (i_category#18493 = Electronics), isnotnull(i_item_sk#18481L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Electronics), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category:string>
                        +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19387]
                           +- Project [s_store_sk#18393L]
                              +- Filter ((isnotnull(s_gmt_offset#18420) AND (s_gmt_offset#18420 = -7.0)) AND isnotnull(s_store_sk#18393L))
                                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18393L,s_gmt_offset#18420] Batched: true, DataFilters: [isnotnull(s_gmt_offset#18420), (s_gmt_offset#18420 = -7.0), isnotnull(s_store_sk#18393L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_gmt_offset), EqualTo(s_gmt_offset,-7.0), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_gmt_offset:double>

read query: spark_queries/q62.sql
explain query: q62
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['substr('w_warehouse_name, 1, 20) ASC NULLS FIRST, 'sm_type ASC NULLS FIRST, 'web_name ASC NULLS FIRST], true
      +- 'Aggregate ['substr('w_warehouse_name, 1, 20), 'sm_type, 'web_name], [unresolvedalias('substr('w_warehouse_name, 1, 20), None), 'sm_type, 'web_name, 'sum(CASE WHEN (('ws_ship_date_sk - 'ws_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#18515, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 30) AND (('ws_ship_date_sk - 'ws_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#18516, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 60) AND (('ws_ship_date_sk - 'ws_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#18517, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 90) AND (('ws_ship_date_sk - 'ws_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#18518, 'sum(CASE WHEN (('ws_ship_date_sk - 'ws_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#18519]
         +- 'Filter ((((('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))) AND ('ws_ship_date_sk = 'd_date_sk)) AND ('ws_warehouse_sk = 'w_warehouse_sk)) AND (('ws_ship_mode_sk = 'sm_ship_mode_sk) AND ('ws_web_site_sk = 'web_site_sk)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [web_sales], [], false
               :  :  :  +- 'UnresolvedRelation [warehouse], [], false
               :  :  +- 'UnresolvedRelation [ship_mode], [], false
               :  +- 'UnresolvedRelation [web_site], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
substr(w_warehouse_name, 1, 20): string, sm_type: string, web_name: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(w_warehouse_name, 1, 20)#18628 ASC NULLS FIRST, sm_type#18570 ASC NULLS FIRST, web_name#18578 ASC NULLS FIRST], true
      +- Aggregate [substr(w_warehouse_name#18556, 1, 20), sm_type#18570, web_name#18578], [substr(w_warehouse_name#18556, 1, 20) AS substr(w_warehouse_name, 1, 20)#18628, sm_type#18570, web_name#18578, sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= cast(30 as bigint)) THEN 1 ELSE 0 END) AS 30 days#18515L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > cast(30 as bigint)) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= cast(60 as bigint))) THEN 1 ELSE 0 END) AS 31-60 days#18516L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > cast(60 as bigint)) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= cast(90 as bigint))) THEN 1 ELSE 0 END) AS 61-90 days#18517L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > cast(90 as bigint)) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= cast(120 as bigint))) THEN 1 ELSE 0 END) AS 91-120 days#18518L, sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > cast(120 as bigint)) THEN 1 ELSE 0 END) AS >120 days#18519L]
         +- Filter (((((d_month_seq#18603 >= 1212) AND (d_month_seq#18603 <= (1212 + 11))) AND (ws_ship_date_sk#18521L = d_date_sk#18600L)) AND (ws_warehouse_sk#18534L = w_warehouse_sk#18554L)) AND ((ws_ship_mode_sk#18533L = sm_ship_mode_sk#18568L) AND (ws_web_site_sk#18532L = web_site_sk#18574L)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#18520L,ws_ship_date_sk#18521L,ws_item_sk#18522L,ws_bill_customer_sk#18523L,ws_bill_cdemo_sk#18524L,ws_bill_hdemo_sk#18525L,ws_bill_addr_sk#18526L,ws_ship_customer_sk#18527L,ws_ship_cdemo_sk#18528L,ws_ship_hdemo_sk#18529L,ws_ship_addr_sk#18530L,ws_web_page_sk#18531L,ws_web_site_sk#18532L,ws_ship_mode_sk#18533L,ws_warehouse_sk#18534L,ws_promo_sk#18535L,ws_order_number#18536L,ws_quantity#18537,ws_wholesale_cost#18538,ws_list_price#18539,ws_sales_price#18540,ws_ext_discount_amt#18541,ws_ext_sales_price#18542,ws_ext_wholesale_cost#18543,... 10 more fields] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#18554L,w_warehouse_id#18555,w_warehouse_name#18556,w_warehouse_sq_ft#18557,w_street_number#18558,w_street_name#18559,w_street_type#18560,w_suite_number#18561,w_city#18562,w_county#18563,w_state#18564,w_zip#18565,w_country#18566,w_gmt_offset#18567] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.ship_mode
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#18568L,sm_ship_mode_id#18569,sm_type#18570,sm_code#18571,sm_carrier#18572,sm_contract#18573] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_site
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#18574L,web_site_id#18575,web_rec_start_date#18576,web_rec_end_date#18577,web_name#18578,web_open_date_sk#18579L,web_close_date_sk#18580L,web_class#18581,web_manager#18582,web_mkt_id#18583,web_mkt_class#18584,web_mkt_desc#18585,web_market_manager#18586,web_company_id#18587,web_company_name#18588,web_street_number#18589,web_street_name#18590,web_street_type#18591,web_suite_number#18592,web_city#18593,web_county#18594,web_state#18595,web_zip#18596,web_country#18597,... 2 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18600L,d_date_id#18601,d_date#18602,d_month_seq#18603,d_week_seq#18604,d_quarter_seq#18605,d_year#18606,d_dow#18607,d_moy#18608,d_dom#18609,d_qoy#18610,d_fy_year#18611,d_fy_quarter_seq#18612,d_fy_week_seq#18613,d_day_name#18614,d_quarter_name#18615,d_holiday#18616,d_weekend#18617,d_following_holiday#18618,d_first_dom#18619,d_last_dom#18620,d_same_day_ly#18621,d_same_day_lq#18622,d_current_day#18623,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(w_warehouse_name, 1, 20)#18628 ASC NULLS FIRST, sm_type#18570 ASC NULLS FIRST, web_name#18578 ASC NULLS FIRST], true
      +- Aggregate [_groupingexpression#18642, sm_type#18570, web_name#18578], [_groupingexpression#18642 AS substr(w_warehouse_name, 1, 20)#18628, sm_type#18570, web_name#18578, sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 30) THEN 1 ELSE 0 END) AS 30 days#18515L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 30) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#18516L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 60) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#18517L, sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 90) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#18518L, sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 120) THEN 1 ELSE 0 END) AS >120 days#18519L]
         +- Project [ws_ship_date_sk#18521L, ws_sold_date_sk#18553L, sm_type#18570, web_name#18578, substr(w_warehouse_name#18556, 1, 20) AS _groupingexpression#18642]
            +- Join Inner, (ws_warehouse_sk#18534L = w_warehouse_sk#18554L)
               :- Project [ws_ship_date_sk#18521L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L, web_name#18578, sm_type#18570]
               :  +- Join Inner, (ws_ship_mode_sk#18533L = sm_ship_mode_sk#18568L)
               :     :- Project [ws_ship_date_sk#18521L, ws_ship_mode_sk#18533L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L, web_name#18578]
               :     :  +- Join Inner, (ws_web_site_sk#18532L = web_site_sk#18574L)
               :     :     :- Project [ws_ship_date_sk#18521L, ws_web_site_sk#18532L, ws_ship_mode_sk#18533L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L]
               :     :     :  +- Join Inner, (ws_ship_date_sk#18521L = d_date_sk#18600L)
               :     :     :     :- Project [ws_ship_date_sk#18521L, ws_web_site_sk#18532L, ws_ship_mode_sk#18533L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L]
               :     :     :     :  +- Filter ((isnotnull(ws_warehouse_sk#18534L) AND isnotnull(ws_ship_mode_sk#18533L)) AND (isnotnull(ws_web_site_sk#18532L) AND isnotnull(ws_ship_date_sk#18521L)))
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#18520L,ws_ship_date_sk#18521L,ws_item_sk#18522L,ws_bill_customer_sk#18523L,ws_bill_cdemo_sk#18524L,ws_bill_hdemo_sk#18525L,ws_bill_addr_sk#18526L,ws_ship_customer_sk#18527L,ws_ship_cdemo_sk#18528L,ws_ship_hdemo_sk#18529L,ws_ship_addr_sk#18530L,ws_web_page_sk#18531L,ws_web_site_sk#18532L,ws_ship_mode_sk#18533L,ws_warehouse_sk#18534L,ws_promo_sk#18535L,ws_order_number#18536L,ws_quantity#18537,ws_wholesale_cost#18538,ws_list_price#18539,ws_sales_price#18540,ws_ext_discount_amt#18541,ws_ext_sales_price#18542,ws_ext_wholesale_cost#18543,... 10 more fields] orc
               :     :     :     +- Project [d_date_sk#18600L]
               :     :     :        +- Filter ((isnotnull(d_month_seq#18603) AND ((d_month_seq#18603 >= 1212) AND (d_month_seq#18603 <= 1223))) AND isnotnull(d_date_sk#18600L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18600L,d_date_id#18601,d_date#18602,d_month_seq#18603,d_week_seq#18604,d_quarter_seq#18605,d_year#18606,d_dow#18607,d_moy#18608,d_dom#18609,d_qoy#18610,d_fy_year#18611,d_fy_quarter_seq#18612,d_fy_week_seq#18613,d_day_name#18614,d_quarter_name#18615,d_holiday#18616,d_weekend#18617,d_following_holiday#18618,d_first_dom#18619,d_last_dom#18620,d_same_day_ly#18621,d_same_day_lq#18622,d_current_day#18623,... 4 more fields] orc
               :     :     +- Project [web_site_sk#18574L, web_name#18578]
               :     :        +- Filter isnotnull(web_site_sk#18574L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#18574L,web_site_id#18575,web_rec_start_date#18576,web_rec_end_date#18577,web_name#18578,web_open_date_sk#18579L,web_close_date_sk#18580L,web_class#18581,web_manager#18582,web_mkt_id#18583,web_mkt_class#18584,web_mkt_desc#18585,web_market_manager#18586,web_company_id#18587,web_company_name#18588,web_street_number#18589,web_street_name#18590,web_street_type#18591,web_suite_number#18592,web_city#18593,web_county#18594,web_state#18595,web_zip#18596,web_country#18597,... 2 more fields] orc
               :     +- Project [sm_ship_mode_sk#18568L, sm_type#18570]
               :        +- Filter isnotnull(sm_ship_mode_sk#18568L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#18568L,sm_ship_mode_id#18569,sm_type#18570,sm_code#18571,sm_carrier#18572,sm_contract#18573] orc
               +- Project [w_warehouse_sk#18554L, w_warehouse_name#18556]
                  +- Filter isnotnull(w_warehouse_sk#18554L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#18554L,w_warehouse_id#18555,w_warehouse_name#18556,w_warehouse_sq_ft#18557,w_street_number#18558,w_street_name#18559,w_street_type#18560,w_suite_number#18561,w_city#18562,w_county#18563,w_state#18564,w_zip#18565,w_country#18566,w_gmt_offset#18567] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#18628 ASC NULLS FIRST,sm_type#18570 ASC NULLS FIRST,web_name#18578 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#18628,sm_type#18570,web_name#18578,30 days#18515L,31-60 days#18516L,61-90 days#18517L,91-120 days#18518L,>120 days#18519L])
   +- HashAggregate(keys=[_groupingexpression#18642, sm_type#18570, web_name#18578], functions=[sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 30) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 60) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 90) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#18628, sm_type#18570, web_name#18578, 30 days#18515L, 31-60 days#18516L, 61-90 days#18517L, 91-120 days#18518L, >120 days#18519L])
      +- Exchange hashpartitioning(_groupingexpression#18642, sm_type#18570, web_name#18578, 3000), ENSURE_REQUIREMENTS, [id=#19508]
         +- HashAggregate(keys=[_groupingexpression#18642, sm_type#18570, web_name#18578], functions=[partial_sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 30) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 60) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 90) AND ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((ws_ship_date_sk#18521L - ws_sold_date_sk#18553L) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#18642, sm_type#18570, web_name#18578, sum#18648L, sum#18649L, sum#18650L, sum#18651L, sum#18652L])
            +- Project [ws_ship_date_sk#18521L, ws_sold_date_sk#18553L, sm_type#18570, web_name#18578, substr(w_warehouse_name#18556, 1, 20) AS _groupingexpression#18642]
               +- BroadcastHashJoin [ws_warehouse_sk#18534L], [w_warehouse_sk#18554L], Inner, BuildRight, false
                  :- Project [ws_ship_date_sk#18521L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L, web_name#18578, sm_type#18570]
                  :  +- BroadcastHashJoin [ws_ship_mode_sk#18533L], [sm_ship_mode_sk#18568L], Inner, BuildRight, false
                  :     :- Project [ws_ship_date_sk#18521L, ws_ship_mode_sk#18533L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L, web_name#18578]
                  :     :  +- BroadcastHashJoin [ws_web_site_sk#18532L], [web_site_sk#18574L], Inner, BuildRight, false
                  :     :     :- Project [ws_ship_date_sk#18521L, ws_web_site_sk#18532L, ws_ship_mode_sk#18533L, ws_warehouse_sk#18534L, ws_sold_date_sk#18553L]
                  :     :     :  +- BroadcastHashJoin [ws_ship_date_sk#18521L], [d_date_sk#18600L], Inner, BuildRight, false
                  :     :     :     :- Filter (((isnotnull(ws_warehouse_sk#18534L) AND isnotnull(ws_ship_mode_sk#18533L)) AND isnotnull(ws_web_site_sk#18532L)) AND isnotnull(ws_ship_date_sk#18521L))
                  :     :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_ship_date_sk#18521L,ws_web_site_sk#18532L,ws_ship_mode_sk#18533L,ws_warehouse_sk#18534L,ws_sold_date_sk#18553L] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#18534L), isnotnull(ws_ship_mode_sk#18533L), isnotnull(ws_web_site_sk#1..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_ship_date_sk:bigint,ws_web_site_sk:bigint,ws_ship_mode_sk:bigint,ws_warehouse_sk:bigint>
                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19491]
                  :     :     :        +- Project [d_date_sk#18600L]
                  :     :     :           +- Filter (((isnotnull(d_month_seq#18603) AND (d_month_seq#18603 >= 1212)) AND (d_month_seq#18603 <= 1223)) AND isnotnull(d_date_sk#18600L))
                  :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18600L,d_month_seq#18603] Batched: true, DataFilters: [isnotnull(d_month_seq#18603), (d_month_seq#18603 >= 1212), (d_month_seq#18603 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#19495]
                  :     :        +- Filter isnotnull(web_site_sk#18574L)
                  :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#18574L,web_name#18578] Batched: true, DataFilters: [isnotnull(web_site_sk#18574L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:bigint,web_name:string>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#19499]
                  :        +- Filter isnotnull(sm_ship_mode_sk#18568L)
                  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#18568L,sm_type#18570] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#18568L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:bigint,sm_type:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#19503]
                     +- Filter isnotnull(w_warehouse_sk#18554L)
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#18554L,w_warehouse_name#18556] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#18554L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>

read query: spark_queries/q63.sql
explain query: q63
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_manager_id ASC NULLS FIRST, 'avg_monthly_sales ASC NULLS FIRST, 'sum_sales ASC NULLS FIRST], true
      +- 'Project [*]
         +- 'Filter (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1)
            +- 'SubqueryAlias tmp1
               +- 'Aggregate ['i_manager_id, 'd_moy], ['i_manager_id, 'sum('ss_sales_price) AS sum_sales#18653, 'avg('sum('ss_sales_price)) windowspecdefinition('i_manager_id, unspecifiedframe$()) AS avg_monthly_sales#18654]
                  +- 'Filter (((('ss_item_sk = 'i_item_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('ss_store_sk = 's_store_sk)) AND ('d_month_seq IN (1212,(1212 + 1),(1212 + 2),(1212 + 3),(1212 + 4),(1212 + 5),(1212 + 6),(1212 + 7),(1212 + 8),(1212 + 9),(1212 + 10),(1212 + 11)) AND ((('i_category IN (Books,Children,Electronics) AND 'i_class IN (personal,portable,refernece,self-help)) AND 'i_brand IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR (('i_category IN (Women,Music,Men) AND 'i_class IN (accessories,classical,fragrances,pants)) AND 'i_brand IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'UnresolvedRelation [item], [], false
                        :  :  +- 'UnresolvedRelation [store_sales], [], false
                        :  +- 'UnresolvedRelation [date_dim], [], false
                        +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
i_manager_id: int, sum_sales: double, avg_monthly_sales: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_manager_id#18675 ASC NULLS FIRST, avg_monthly_sales#18654 ASC NULLS FIRST, sum_sales#18653 ASC NULLS FIRST], true
      +- Project [i_manager_id#18675, sum_sales#18653, avg_monthly_sales#18654]
         +- Filter (CASE WHEN (avg_monthly_sales#18654 > cast(0 as double)) THEN (abs((sum_sales#18653 - avg_monthly_sales#18654), false) / avg_monthly_sales#18654) ELSE cast(null as double) END > cast(0.1 as double))
            +- SubqueryAlias tmp1
               +- Project [i_manager_id#18675, sum_sales#18653, avg_monthly_sales#18654]
                  +- Project [i_manager_id#18675, sum_sales#18653, _w0#18760, avg_monthly_sales#18654, avg_monthly_sales#18654]
                     +- Window [avg(_w0#18760) windowspecdefinition(i_manager_id#18675, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#18654], [i_manager_id#18675]
                        +- Aggregate [i_manager_id#18675, d_moy#18708], [i_manager_id#18675, sum(ss_sales_price#18689) AS sum_sales#18653, sum(ss_sales_price#18689) AS _w0#18760]
                           +- Filter ((((ss_item_sk#18678L = i_item_sk#18655L) AND (ss_sold_date_sk#18699L = d_date_sk#18700L)) AND (ss_store_sk#18683L = s_store_sk#18728L)) AND (d_month_seq#18703 IN (1212,(1212 + 1),(1212 + 2),(1212 + 3),(1212 + 4),(1212 + 5),(1212 + 6),(1212 + 7),(1212 + 8),(1212 + 9),(1212 + 10),(1212 + 11)) AND (((i_category#18667 IN (Books,Children,Electronics) AND i_class#18665 IN (personal,portable,refernece,self-help)) AND i_brand#18663 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#18667 IN (Women,Music,Men) AND i_class#18665 IN (accessories,classical,fragrances,pants)) AND i_brand#18663 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))
                              +- Join Inner
                                 :- Join Inner
                                 :  :- Join Inner
                                 :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                 :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18655L,i_item_id#18656,i_rec_start_date#18657,i_rec_end_date#18658,i_item_desc#18659,i_current_price#18660,i_wholesale_cost#18661,i_brand_id#18662,i_brand#18663,i_class_id#18664,i_class#18665,i_category_id#18666,i_category#18667,i_manufact_id#18668,i_manufact#18669,i_size#18670,i_formulation#18671,i_color#18672,i_units#18673,i_container#18674,i_manager_id#18675,i_product_name#18676] orc
                                 :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                 :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18677L,ss_item_sk#18678L,ss_customer_sk#18679L,ss_cdemo_sk#18680L,ss_hdemo_sk#18681L,ss_addr_sk#18682L,ss_store_sk#18683L,ss_promo_sk#18684L,ss_ticket_number#18685L,ss_quantity#18686,ss_wholesale_cost#18687,ss_list_price#18688,ss_sales_price#18689,ss_ext_discount_amt#18690,ss_ext_sales_price#18691,ss_ext_wholesale_cost#18692,ss_ext_list_price#18693,ss_ext_tax#18694,ss_coupon_amt#18695,ss_net_paid#18696,ss_net_paid_inc_tax#18697,ss_net_profit#18698,ss_sold_date_sk#18699L] orc
                                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18700L,d_date_id#18701,d_date#18702,d_month_seq#18703,d_week_seq#18704,d_quarter_seq#18705,d_year#18706,d_dow#18707,d_moy#18708,d_dom#18709,d_qoy#18710,d_fy_year#18711,d_fy_quarter_seq#18712,d_fy_week_seq#18713,d_day_name#18714,d_quarter_name#18715,d_holiday#18716,d_weekend#18717,d_following_holiday#18718,d_first_dom#18719,d_last_dom#18720,d_same_day_ly#18721,d_same_day_lq#18722,d_current_day#18723,... 4 more fields] orc
                                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18728L,s_store_id#18729,s_rec_start_date#18730,s_rec_end_date#18731,s_closed_date_sk#18732L,s_store_name#18733,s_number_employees#18734,s_floor_space#18735,s_hours#18736,s_manager#18737,s_market_id#18738,s_geography_class#18739,s_market_desc#18740,s_market_manager#18741,s_division_id#18742,s_division_name#18743,s_company_id#18744,s_company_name#18745,s_street_number#18746,s_street_name#18747,s_street_type#18748,s_suite_number#18749,s_city#18750,s_county#18751,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_manager_id#18675 ASC NULLS FIRST, avg_monthly_sales#18654 ASC NULLS FIRST, sum_sales#18653 ASC NULLS FIRST], true
      +- Project [i_manager_id#18675, sum_sales#18653, avg_monthly_sales#18654]
         +- Filter ((isnotnull(avg_monthly_sales#18654) AND isnotnull(sum_sales#18653)) AND ((avg_monthly_sales#18654 > 0.0) AND ((abs((sum_sales#18653 - avg_monthly_sales#18654), false) / avg_monthly_sales#18654) > 0.1)))
            +- Window [avg(_w0#18760) windowspecdefinition(i_manager_id#18675, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#18654], [i_manager_id#18675]
               +- Aggregate [i_manager_id#18675, d_moy#18708], [i_manager_id#18675, sum(ss_sales_price#18689) AS sum_sales#18653, sum(ss_sales_price#18689) AS _w0#18760]
                  +- Project [i_manager_id#18675, ss_sales_price#18689, d_moy#18708]
                     +- Join Inner, (ss_store_sk#18683L = s_store_sk#18728L)
                        :- Project [i_manager_id#18675, ss_store_sk#18683L, ss_sales_price#18689, d_moy#18708]
                        :  +- Join Inner, (ss_sold_date_sk#18699L = d_date_sk#18700L)
                        :     :- Project [i_manager_id#18675, ss_store_sk#18683L, ss_sales_price#18689, ss_sold_date_sk#18699L]
                        :     :  +- Join Inner, (ss_item_sk#18678L = i_item_sk#18655L)
                        :     :     :- Project [i_item_sk#18655L, i_manager_id#18675]
                        :     :     :  +- Filter ((((i_category#18667 IN (Books,Children,Electronics) AND i_class#18665 IN (personal,portable,refernece,self-help)) AND i_brand#18663 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#18667 IN (Women,Music,Men) AND i_class#18665 IN (accessories,classical,fragrances,pants)) AND i_brand#18663 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) AND isnotnull(i_item_sk#18655L))
                        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18655L,i_item_id#18656,i_rec_start_date#18657,i_rec_end_date#18658,i_item_desc#18659,i_current_price#18660,i_wholesale_cost#18661,i_brand_id#18662,i_brand#18663,i_class_id#18664,i_class#18665,i_category_id#18666,i_category#18667,i_manufact_id#18668,i_manufact#18669,i_size#18670,i_formulation#18671,i_color#18672,i_units#18673,i_container#18674,i_manager_id#18675,i_product_name#18676] orc
                        :     :     +- Project [ss_item_sk#18678L, ss_store_sk#18683L, ss_sales_price#18689, ss_sold_date_sk#18699L]
                        :     :        +- Filter (((isnotnull(ss_item_sk#18678L) AND isnotnull(ss_sold_date_sk#18699L)) AND isnotnull(ss_store_sk#18683L)) AND dynamicpruning#18764 [ss_sold_date_sk#18699L])
                        :     :           :  +- Project [d_date_sk#18700L, d_moy#18708]
                        :     :           :     +- Filter (d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#18700L))
                        :     :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18700L,d_date_id#18701,d_date#18702,d_month_seq#18703,d_week_seq#18704,d_quarter_seq#18705,d_year#18706,d_dow#18707,d_moy#18708,d_dom#18709,d_qoy#18710,d_fy_year#18711,d_fy_quarter_seq#18712,d_fy_week_seq#18713,d_day_name#18714,d_quarter_name#18715,d_holiday#18716,d_weekend#18717,d_following_holiday#18718,d_first_dom#18719,d_last_dom#18720,d_same_day_ly#18721,d_same_day_lq#18722,d_current_day#18723,... 4 more fields] orc
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18677L,ss_item_sk#18678L,ss_customer_sk#18679L,ss_cdemo_sk#18680L,ss_hdemo_sk#18681L,ss_addr_sk#18682L,ss_store_sk#18683L,ss_promo_sk#18684L,ss_ticket_number#18685L,ss_quantity#18686,ss_wholesale_cost#18687,ss_list_price#18688,ss_sales_price#18689,ss_ext_discount_amt#18690,ss_ext_sales_price#18691,ss_ext_wholesale_cost#18692,ss_ext_list_price#18693,ss_ext_tax#18694,ss_coupon_amt#18695,ss_net_paid#18696,ss_net_paid_inc_tax#18697,ss_net_profit#18698,ss_sold_date_sk#18699L] orc
                        :     +- Project [d_date_sk#18700L, d_moy#18708]
                        :        +- Filter (d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#18700L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18700L,d_date_id#18701,d_date#18702,d_month_seq#18703,d_week_seq#18704,d_quarter_seq#18705,d_year#18706,d_dow#18707,d_moy#18708,d_dom#18709,d_qoy#18710,d_fy_year#18711,d_fy_quarter_seq#18712,d_fy_week_seq#18713,d_day_name#18714,d_quarter_name#18715,d_holiday#18716,d_weekend#18717,d_following_holiday#18718,d_first_dom#18719,d_last_dom#18720,d_same_day_ly#18721,d_same_day_lq#18722,d_current_day#18723,... 4 more fields] orc
                        +- Project [s_store_sk#18728L]
                           +- Filter isnotnull(s_store_sk#18728L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18728L,s_store_id#18729,s_rec_start_date#18730,s_rec_end_date#18731,s_closed_date_sk#18732L,s_store_name#18733,s_number_employees#18734,s_floor_space#18735,s_hours#18736,s_manager#18737,s_market_id#18738,s_geography_class#18739,s_market_desc#18740,s_market_manager#18741,s_division_id#18742,s_division_name#18743,s_company_id#18744,s_company_name#18745,s_street_number#18746,s_street_name#18747,s_street_type#18748,s_suite_number#18749,s_city#18750,s_county#18751,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_manager_id#18675 ASC NULLS FIRST,avg_monthly_sales#18654 ASC NULLS FIRST,sum_sales#18653 ASC NULLS FIRST], output=[i_manager_id#18675,sum_sales#18653,avg_monthly_sales#18654])
   +- Project [i_manager_id#18675, sum_sales#18653, avg_monthly_sales#18654]
      +- Filter ((isnotnull(avg_monthly_sales#18654) AND isnotnull(sum_sales#18653)) AND ((avg_monthly_sales#18654 > 0.0) AND ((abs((sum_sales#18653 - avg_monthly_sales#18654), false) / avg_monthly_sales#18654) > 0.1)))
         +- Window [avg(_w0#18760) windowspecdefinition(i_manager_id#18675, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#18654], [i_manager_id#18675]
            +- Sort [i_manager_id#18675 ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(i_manager_id#18675, 3000), ENSURE_REQUIREMENTS, [id=#19638]
                  +- HashAggregate(keys=[i_manager_id#18675, d_moy#18708], functions=[sum(ss_sales_price#18689)], output=[i_manager_id#18675, sum_sales#18653, _w0#18760])
                     +- Exchange hashpartitioning(i_manager_id#18675, d_moy#18708, 3000), ENSURE_REQUIREMENTS, [id=#19635]
                        +- HashAggregate(keys=[i_manager_id#18675, d_moy#18708], functions=[partial_sum(ss_sales_price#18689)], output=[i_manager_id#18675, d_moy#18708, sum#18766])
                           +- Project [i_manager_id#18675, ss_sales_price#18689, d_moy#18708]
                              +- BroadcastHashJoin [ss_store_sk#18683L], [s_store_sk#18728L], Inner, BuildRight, false
                                 :- Project [i_manager_id#18675, ss_store_sk#18683L, ss_sales_price#18689, d_moy#18708]
                                 :  +- BroadcastHashJoin [ss_sold_date_sk#18699L], [d_date_sk#18700L], Inner, BuildRight, false
                                 :     :- Project [i_manager_id#18675, ss_store_sk#18683L, ss_sales_price#18689, ss_sold_date_sk#18699L]
                                 :     :  +- BroadcastHashJoin [i_item_sk#18655L], [ss_item_sk#18678L], Inner, BuildLeft, false
                                 :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19622]
                                 :     :     :  +- Project [i_item_sk#18655L, i_manager_id#18675]
                                 :     :     :     +- Filter ((((i_category#18667 IN (Books,Children,Electronics) AND i_class#18665 IN (personal,portable,refernece,self-help)) AND i_brand#18663 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) OR ((i_category#18667 IN (Women,Music,Men) AND i_class#18665 IN (accessories,classical,fragrances,pants)) AND i_brand#18663 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) AND isnotnull(i_item_sk#18655L))
                                 :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#18655L,i_brand#18663,i_class#18665,i_category#18667,i_manager_id#18675] Batched: true, DataFilters: [(((i_category#18667 IN (Books,Children,Electronics) AND i_class#18665 IN (personal,portable,refe..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(And(In(i_category, [Books,Children,Electronics]),In(i_class, [personal,portable,refernece..., ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_class:string,i_category:string,i_manager_id:int>
                                 :     :     +- Filter (isnotnull(ss_item_sk#18678L) AND isnotnull(ss_store_sk#18683L))
                                 :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#18678L,ss_store_sk#18683L,ss_sales_price#18689,ss_sold_date_sk#18699L] Batched: true, DataFilters: [isnotnull(ss_item_sk#18678L), isnotnull(ss_store_sk#18683L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#18699L), dynamicpruningexpression(ss_sold_date_sk#18699L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
                                 :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#18764, 0, true, Project [d_date_sk#18700L, d_moy#18708], [d_date_sk#18700L]
                                 :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :                    +- Project [d_date_sk#18700L, d_moy#18708]
                                 :     :                       +- Filter (d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#18700L))
                                 :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18700L,d_month_seq#18703,d_moy#18708] Batched: true, DataFilters: [d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_month_seq, [1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_moy:int>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#19626]
                                 :        +- Project [d_date_sk#18700L, d_moy#18708]
                                 :           +- Filter (d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223 AND isnotnull(d_date_sk#18700L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18700L,d_month_seq#18703,d_moy#18708] Batched: true, DataFilters: [d_month_seq#18703 INSET 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(d_month_seq, [1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_moy:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#19630]
                                    +- Filter isnotnull(s_store_sk#18728L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18728L] Batched: true, DataFilters: [isnotnull(s_store_sk#18728L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>

read query: spark_queries/q64.sql
explain query: q64
== Parsed Logical Plan ==
CTE [cs_ui, cross_sales]
:  :- 'SubqueryAlias cs_ui
:  :  +- 'UnresolvedHaving ('sum('cs_ext_list_price) > (2 * 'sum((('cr_refunded_cash + 'cr_reversed_charge) + 'cr_store_credit))))
:  :     +- 'Aggregate ['cs_item_sk], ['cs_item_sk, 'sum('cs_ext_list_price) AS sale#18767, 'sum((('cr_refunded_cash + 'cr_reversed_charge) + 'cr_store_credit)) AS refund#18768]
:  :        +- 'Filter (('cs_item_sk = 'cr_item_sk) AND ('cs_order_number = 'cr_order_number))
:  :           +- 'Join Inner
:  :              :- 'UnresolvedRelation [catalog_sales], [], false
:  :              +- 'UnresolvedRelation [catalog_returns], [], false
:  +- 'SubqueryAlias cross_sales
:     +- 'Aggregate ['i_product_name, 'i_item_sk, 's_store_name, 's_zip, 'ad1.ca_street_number, 'ad1.ca_street_name, 'ad1.ca_city, 'ad1.ca_zip, 'ad2.ca_street_number, 'ad2.ca_street_name, 'ad2.ca_city, 'ad2.ca_zip, 'd1.d_year, 'd2.d_year, 'd3.d_year], ['i_product_name AS product_name#18769, 'i_item_sk AS item_sk#18770, 's_store_name AS store_name#18771, 's_zip AS store_zip#18772, 'ad1.ca_street_number AS b_street_number#18773, 'ad1.ca_street_name AS b_streen_name#18774, 'ad1.ca_city AS b_city#18775, 'ad1.ca_zip AS b_zip#18776, 'ad2.ca_street_number AS c_street_number#18777, 'ad2.ca_street_name AS c_street_name#18778, 'ad2.ca_city AS c_city#18779, 'ad2.ca_zip AS c_zip#18780, 'd1.d_year AS syear#18781, 'd2.d_year AS fsyear#18782, 'd3.d_year AS s2year#18783, 'count(1) AS cnt#18784, 'sum('ss_wholesale_cost) AS s1#18785, 'sum('ss_list_price) AS s2#18786, 'sum('ss_coupon_amt) AS s3#18787]
:        +- 'Filter (((((('ss_store_sk = 's_store_sk) AND ('ss_sold_date_sk = 'd1.d_date_sk)) AND ('ss_customer_sk = 'c_customer_sk)) AND ((('ss_cdemo_sk = 'cd1.cd_demo_sk) AND ('ss_hdemo_sk = 'hd1.hd_demo_sk)) AND ('ss_addr_sk = 'ad1.ca_address_sk))) AND (((('ss_item_sk = 'i_item_sk) AND ('ss_item_sk = 'sr_item_sk)) AND ('ss_ticket_number = 'sr_ticket_number)) AND (('ss_item_sk = 'cs_ui.cs_item_sk) AND ('c_current_cdemo_sk = 'cd2.cd_demo_sk)))) AND ((((('c_current_hdemo_sk = 'hd2.hd_demo_sk) AND ('c_current_addr_sk = 'ad2.ca_address_sk)) AND ('c_first_sales_date_sk = 'd2.d_date_sk)) AND ((('c_first_shipto_date_sk = 'd3.d_date_sk) AND ('ss_promo_sk = 'p_promo_sk)) AND ('hd1.hd_income_band_sk = 'ib1.ib_income_band_sk))) AND (((('hd2.hd_income_band_sk = 'ib2.ib_income_band_sk) AND NOT ('cd1.cd_marital_status = 'cd2.cd_marital_status)) AND 'i_color IN (maroon,burnished,dim,steel,navajo,chocolate)) AND ((('i_current_price >= 35) AND ('i_current_price <= (35 + 10))) AND (('i_current_price >= (35 + 1)) AND ('i_current_price <= (35 + 15)))))))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'Join Inner
:              :  :  :  :- 'Join Inner
:              :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [cs_ui], [], false
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d1
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
:              :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d2
:              :  :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
:              :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d3
:              :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
:              :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [store], [], false
:              :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [customer], [], false
:              :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias cd1
:              :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
:              :  :  :  :  :  :  :  :  +- 'SubqueryAlias cd2
:              :  :  :  :  :  :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
:              :  :  :  :  :  :  :  +- 'UnresolvedRelation [promotion], [], false
:              :  :  :  :  :  :  +- 'SubqueryAlias hd1
:              :  :  :  :  :  :     +- 'UnresolvedRelation [household_demographics], [], false
:              :  :  :  :  :  +- 'SubqueryAlias hd2
:              :  :  :  :  :     +- 'UnresolvedRelation [household_demographics], [], false
:              :  :  :  :  +- 'SubqueryAlias ad1
:              :  :  :  :     +- 'UnresolvedRelation [customer_address], [], false
:              :  :  :  +- 'SubqueryAlias ad2
:              :  :  :     +- 'UnresolvedRelation [customer_address], [], false
:              :  :  +- 'SubqueryAlias ib1
:              :  :     +- 'UnresolvedRelation [income_band], [], false
:              :  +- 'SubqueryAlias ib2
:              :     +- 'UnresolvedRelation [income_band], [], false
:              +- 'UnresolvedRelation [item], [], false
+- 'Sort ['cs1.product_name ASC NULLS FIRST, 'cs1.store_name ASC NULLS FIRST, 'cs2.cnt ASC NULLS FIRST], true
   +- 'Project ['cs1.product_name, 'cs1.store_name, 'cs1.store_zip, 'cs1.b_street_number, 'cs1.b_streen_name, 'cs1.b_city, 'cs1.b_zip, 'cs1.c_street_number, 'cs1.c_street_name, 'cs1.c_city, 'cs1.c_zip, 'cs1.syear, 'cs1.cnt, 'cs1.s1, 'cs1.s2, 'cs1.s3, 'cs2.s1, 'cs2.s2, 'cs2.s3, 'cs2.syear, 'cs2.cnt]
      +- 'Filter (((('cs1.item_sk = 'cs2.item_sk) AND ('cs1.syear = 2000)) AND ('cs2.syear = (2000 + 1))) AND ((('cs2.cnt <= 'cs1.cnt) AND ('cs1.store_name = 'cs2.store_name)) AND ('cs1.store_zip = 'cs2.store_zip)))
         +- 'Join Inner
            :- 'SubqueryAlias cs1
            :  +- 'UnresolvedRelation [cross_sales], [], false
            +- 'SubqueryAlias cs2
               +- 'UnresolvedRelation [cross_sales], [], false

== Analyzed Logical Plan ==
product_name: string, store_name: string, store_zip: string, b_street_number: string, b_streen_name: string, b_city: string, b_zip: string, c_street_number: string, c_street_name: string, c_city: string, c_zip: string, syear: int, cnt: bigint, s1: double, s2: double, s3: double, s1: double, s2: double, s3: double, syear: int, cnt: bigint
WithCTE
:- CTERelationDef 46
:  +- SubqueryAlias cs_ui
:     +- Filter (sale#18767 > (cast(2 as double) * refund#18768))
:        +- Aggregate [cs_item_sk#18803L], [cs_item_sk#18803L, sum(cs_ext_list_price#18813) AS sale#18767, sum(((cr_refunded_cash#18845 + cr_reversed_charge#18846) + cr_store_credit#18847)) AS refund#18768]
:           +- Filter ((cs_item_sk#18803L = cr_item_sk#18824L) AND (cs_order_number#18805L = cr_order_number#18838L))
:              +- Join Inner
:                 :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#18789L,cs_ship_date_sk#18790L,cs_bill_customer_sk#18791L,cs_bill_cdemo_sk#18792L,cs_bill_hdemo_sk#18793L,cs_bill_addr_sk#18794L,cs_ship_customer_sk#18795L,cs_ship_cdemo_sk#18796L,cs_ship_hdemo_sk#18797L,cs_ship_addr_sk#18798L,cs_call_center_sk#18799L,cs_catalog_page_sk#18800L,cs_ship_mode_sk#18801L,cs_warehouse_sk#18802L,cs_item_sk#18803L,cs_promo_sk#18804L,cs_order_number#18805L,cs_quantity#18806,cs_wholesale_cost#18807,cs_list_price#18808,cs_sales_price#18809,cs_ext_discount_amt#18810,cs_ext_sales_price#18811,cs_ext_wholesale_cost#18812,... 10 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#18823L,cr_item_sk#18824L,cr_refunded_customer_sk#18825L,cr_refunded_cdemo_sk#18826L,cr_refunded_hdemo_sk#18827L,cr_refunded_addr_sk#18828L,cr_returning_customer_sk#18829L,cr_returning_cdemo_sk#18830L,cr_returning_hdemo_sk#18831L,cr_returning_addr_sk#18832L,cr_call_center_sk#18833L,cr_catalog_page_sk#18834L,cr_ship_mode_sk#18835L,cr_warehouse_sk#18836L,cr_reason_sk#18837L,cr_order_number#18838L,cr_return_quantity#18839,cr_return_amount#18840,cr_return_tax#18841,cr_return_amt_inc_tax#18842,cr_fee#18843,cr_return_ship_cost#18844,cr_refunded_cash#18845,cr_reversed_charge#18846,... 3 more fields] orc
:- CTERelationDef 47
:  +- SubqueryAlias cross_sales
:     +- Aggregate [i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955], [i_product_name#19124 AS product_name#18769, i_item_sk#19103L AS item_sk#18770L, s_store_name#18982 AS store_name#18771, s_zip#19002 AS store_zip#18772, ca_street_number#19073 AS b_street_number#18773, ca_street_name#19074 AS b_streen_name#18774, ca_city#19077 AS b_city#18775, ca_zip#19080 AS b_zip#18776, ca_street_number#19086 AS c_street_number#18777, ca_street_name#19087 AS c_street_name#18778, ca_city#19090 AS c_city#18779, ca_zip#19093 AS c_zip#18780, d_year#18899 AS syear#18781, d_year#18927 AS fsyear#18782, d_year#18955 AS s2year#18783, count(1) AS cnt#18784L, sum(ss_wholesale_cost#18860) AS s1#18785, sum(ss_list_price#18861) AS s2#18786, sum(ss_coupon_amt#18868) AS s3#18787]
:        +- Filter ((((((ss_store_sk#18856L = s_store_sk#18977L) AND (ss_sold_date_sk#18872L = d_date_sk#18893L)) AND (ss_customer_sk#18852L = c_customer_sk#19006L)) AND (((ss_cdemo_sk#18853L = cd_demo_sk#19024L) AND (ss_hdemo_sk#18854L = hd_demo_sk#19061L)) AND (ss_addr_sk#18855L = ca_address_sk#19071L))) AND ((((ss_item_sk#18851L = i_item_sk#19103L) AND (ss_item_sk#18851L = sr_item_sk#18874L)) AND (ss_ticket_number#18858L = sr_ticket_number#18881L)) AND ((ss_item_sk#18851L = cs_item_sk#18803L) AND (c_current_cdemo_sk#19008L = cd_demo_sk#19033L)))) AND (((((c_current_hdemo_sk#19009L = hd_demo_sk#19066L) AND (c_current_addr_sk#19010L = ca_address_sk#19084L)) AND (c_first_sales_date_sk#19012L = d_date_sk#18921L)) AND (((c_first_shipto_date_sk#19011L = d_date_sk#18949L) AND (ss_promo_sk#18857L = p_promo_sk#19042L)) AND (hd_income_band_sk#19062L = ib_income_band_sk#19097L))) AND ((((hd_income_band_sk#19067L = ib_income_band_sk#19100L) AND NOT (cd_marital_status#19026 = cd_marital_status#19035)) AND i_color#19120 IN (maroon,burnished,dim,steel,navajo,chocolate)) AND (((i_current_price#19108 >= cast(35 as double)) AND (i_current_price#19108 <= cast((35 + 10) as double))) AND ((i_current_price#19108 >= cast((35 + 1) as double)) AND (i_current_price#19108 <= cast((35 + 15) as double)))))))
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- Join Inner
:              :  :  :  :  :- Join Inner
:              :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18850L,ss_item_sk#18851L,ss_customer_sk#18852L,ss_cdemo_sk#18853L,ss_hdemo_sk#18854L,ss_addr_sk#18855L,ss_store_sk#18856L,ss_promo_sk#18857L,ss_ticket_number#18858L,ss_quantity#18859,ss_wholesale_cost#18860,ss_list_price#18861,ss_sales_price#18862,ss_ext_discount_amt#18863,ss_ext_sales_price#18864,ss_ext_wholesale_cost#18865,ss_ext_list_price#18866,ss_ext_tax#18867,ss_coupon_amt#18868,ss_net_paid#18869,ss_net_paid_inc_tax#18870,ss_net_profit#18871,ss_sold_date_sk#18872L] orc
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#18873L,sr_item_sk#18874L,sr_customer_sk#18875L,sr_cdemo_sk#18876L,sr_hdemo_sk#18877L,sr_addr_sk#18878L,sr_store_sk#18879L,sr_reason_sk#18880L,sr_ticket_number#18881L,sr_return_quantity#18882,sr_return_amt#18883,sr_return_tax#18884,sr_return_amt_inc_tax#18885,sr_fee#18886,sr_return_ship_cost#18887,sr_refunded_cash#18888,sr_reversed_charge#18889,sr_store_credit#18890,sr_net_loss#18891,sr_returned_date_sk#18892L] orc
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias cs_ui
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- CTERelationRef 46, true, [cs_item_sk#18803L, sale#18767, refund#18768]
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d1
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18893L,d_date_id#18894,d_date#18895,d_month_seq#18896,d_week_seq#18897,d_quarter_seq#18898,d_year#18899,d_dow#18900,d_moy#18901,d_dom#18902,d_qoy#18903,d_fy_year#18904,d_fy_quarter_seq#18905,d_fy_week_seq#18906,d_day_name#18907,d_quarter_name#18908,d_holiday#18909,d_weekend#18910,d_following_holiday#18911,d_first_dom#18912,d_last_dom#18913,d_same_day_ly#18914,d_same_day_lq#18915,d_current_day#18916,... 4 more fields] orc
:              :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d2
:              :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18921L,d_date_id#18922,d_date#18923,d_month_seq#18924,d_week_seq#18925,d_quarter_seq#18926,d_year#18927,d_dow#18928,d_moy#18929,d_dom#18930,d_qoy#18931,d_fy_year#18932,d_fy_quarter_seq#18933,d_fy_week_seq#18934,d_day_name#18935,d_quarter_name#18936,d_holiday#18937,d_weekend#18938,d_following_holiday#18939,d_first_dom#18940,d_last_dom#18941,d_same_day_ly#18942,d_same_day_lq#18943,d_current_day#18944,... 4 more fields] orc
:              :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d3
:              :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :  :  :  :  :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18949L,d_date_id#18950,d_date#18951,d_month_seq#18952,d_week_seq#18953,d_quarter_seq#18954,d_year#18955,d_dow#18956,d_moy#18957,d_dom#18958,d_qoy#18959,d_fy_year#18960,d_fy_quarter_seq#18961,d_fy_week_seq#18962,d_day_name#18963,d_quarter_name#18964,d_holiday#18965,d_weekend#18966,d_following_holiday#18967,d_first_dom#18968,d_last_dom#18969,d_same_day_ly#18970,d_same_day_lq#18971,d_current_day#18972,... 4 more fields] orc
:              :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:              :  :  :  :  :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18977L,s_store_id#18978,s_rec_start_date#18979,s_rec_end_date#18980,s_closed_date_sk#18981L,s_store_name#18982,s_number_employees#18983,s_floor_space#18984,s_hours#18985,s_manager#18986,s_market_id#18987,s_geography_class#18988,s_market_desc#18989,s_market_manager#18990,s_division_id#18991,s_division_name#18992,s_company_id#18993,s_company_name#18994,s_street_number#18995,s_street_name#18996,s_street_type#18997,s_suite_number#18998,s_city#18999,s_county#19000,... 5 more fields] orc
:              :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:              :  :  :  :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#19006L,c_customer_id#19007,c_current_cdemo_sk#19008L,c_current_hdemo_sk#19009L,c_current_addr_sk#19010L,c_first_shipto_date_sk#19011L,c_first_sales_date_sk#19012L,c_salutation#19013,c_first_name#19014,c_last_name#19015,c_preferred_cust_flag#19016,c_birth_day#19017,c_birth_month#19018,c_birth_year#19019,c_birth_country#19020,c_login#19021,c_email_address#19022,c_last_review_date#19023] orc
:              :  :  :  :  :  :  :  :  :  +- SubqueryAlias cd1
:              :  :  :  :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
:              :  :  :  :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19024L,cd_gender#19025,cd_marital_status#19026,cd_education_status#19027,cd_purchase_estimate#19028,cd_credit_rating#19029,cd_dep_count#19030,cd_dep_employed_count#19031,cd_dep_college_count#19032] orc
:              :  :  :  :  :  :  :  :  +- SubqueryAlias cd2
:              :  :  :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
:              :  :  :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19033L,cd_gender#19034,cd_marital_status#19035,cd_education_status#19036,cd_purchase_estimate#19037,cd_credit_rating#19038,cd_dep_count#19039,cd_dep_employed_count#19040,cd_dep_college_count#19041] orc
:              :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
:              :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#19042L,p_promo_id#19043,p_start_date_sk#19044L,p_end_date_sk#19045L,p_item_sk#19046L,p_cost#19047,p_response_target#19048,p_promo_name#19049,p_channel_dmail#19050,p_channel_email#19051,p_channel_catalog#19052,p_channel_tv#19053,p_channel_radio#19054,p_channel_press#19055,p_channel_event#19056,p_channel_demo#19057,p_channel_details#19058,p_purpose#19059,p_discount_active#19060] orc
:              :  :  :  :  :  :  +- SubqueryAlias hd1
:              :  :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
:              :  :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19061L,hd_income_band_sk#19062L,hd_buy_potential#19063,hd_dep_count#19064,hd_vehicle_count#19065] orc
:              :  :  :  :  :  +- SubqueryAlias hd2
:              :  :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
:              :  :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19066L,hd_income_band_sk#19067L,hd_buy_potential#19068,hd_dep_count#19069,hd_vehicle_count#19070] orc
:              :  :  :  :  +- SubqueryAlias ad1
:              :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19071L,ca_address_id#19072,ca_street_number#19073,ca_street_name#19074,ca_street_type#19075,ca_suite_number#19076,ca_city#19077,ca_county#19078,ca_state#19079,ca_zip#19080,ca_country#19081,ca_gmt_offset#19082,ca_location_type#19083] orc
:              :  :  :  +- SubqueryAlias ad2
:              :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:              :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19084L,ca_address_id#19085,ca_street_number#19086,ca_street_name#19087,ca_street_type#19088,ca_suite_number#19089,ca_city#19090,ca_county#19091,ca_state#19092,ca_zip#19093,ca_country#19094,ca_gmt_offset#19095,ca_location_type#19096] orc
:              :  :  +- SubqueryAlias ib1
:              :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.income_band
:              :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19097L,ib_lower_bound#19098,ib_upper_bound#19099] orc
:              :  +- SubqueryAlias ib2
:              :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.income_band
:              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19100L,ib_lower_bound#19101,ib_upper_bound#19102] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19103L,i_item_id#19104,i_rec_start_date#19105,i_rec_end_date#19106,i_item_desc#19107,i_current_price#19108,i_wholesale_cost#19109,i_brand_id#19110,i_brand#19111,i_class_id#19112,i_class#19113,i_category_id#19114,i_category#19115,i_manufact_id#19116,i_manufact#19117,i_size#19118,i_formulation#19119,i_color#19120,i_units#19121,i_container#19122,i_manager_id#19123,i_product_name#19124] orc
+- Sort [product_name#18769 ASC NULLS FIRST, store_name#18771 ASC NULLS FIRST, cnt#19147L ASC NULLS FIRST], true
   +- Project [product_name#18769, store_name#18771, store_zip#18772, b_street_number#18773, b_streen_name#18774, b_city#18775, b_zip#18776, c_street_number#18777, c_street_name#18778, c_city#18779, c_zip#18780, syear#18781, cnt#18784L, s1#18785, s2#18786, s3#18787, s1#19148, s2#19149, s3#19150, syear#19144, cnt#19147L]
      +- Filter ((((item_sk#18770L = item_sk#19133L) AND (syear#18781 = 2000)) AND (syear#19144 = (2000 + 1))) AND (((cnt#19147L <= cnt#18784L) AND (store_name#18771 = store_name#19134)) AND (store_zip#18772 = store_zip#19135)))
         +- Join Inner
            :- SubqueryAlias cs1
            :  +- SubqueryAlias cross_sales
            :     +- CTERelationRef 47, true, [product_name#18769, item_sk#18770L, store_name#18771, store_zip#18772, b_street_number#18773, b_streen_name#18774, b_city#18775, b_zip#18776, c_street_number#18777, c_street_name#18778, c_city#18779, c_zip#18780, syear#18781, fsyear#18782, s2year#18783, cnt#18784L, s1#18785, s2#18786, s3#18787]
            +- SubqueryAlias cs2
               +- SubqueryAlias cross_sales
                  +- CTERelationRef 47, true, [product_name#19132, item_sk#19133L, store_name#19134, store_zip#19135, b_street_number#19136, b_streen_name#19137, b_city#19138, b_zip#19139, c_street_number#19140, c_street_name#19141, c_city#19142, c_zip#19143, syear#19144, fsyear#19145, s2year#19146, cnt#19147L, s1#19148, s2#19149, s3#19150]

== Optimized Logical Plan ==
Sort [product_name#18769 ASC NULLS FIRST, store_name#18771 ASC NULLS FIRST, cnt#19147L ASC NULLS FIRST], true
+- Project [product_name#18769, store_name#18771, store_zip#18772, b_street_number#18773, b_streen_name#18774, b_city#18775, b_zip#18776, c_street_number#18777, c_street_name#18778, c_city#18779, c_zip#18780, syear#18781, cnt#18784L, s1#18785, s2#18786, s3#18787, s1#19148, s2#19149, s3#19150, syear#19144, cnt#19147L]
   +- Join Inner, ((((item_sk#18770L = item_sk#19133L) AND (cnt#19147L <= cnt#18784L)) AND (store_name#18771 = store_name#19134)) AND (store_zip#18772 = store_zip#19135))
      :- Aggregate [i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955], [i_product_name#19124 AS product_name#18769, i_item_sk#19103L AS item_sk#18770L, s_store_name#18982 AS store_name#18771, s_zip#19002 AS store_zip#18772, ca_street_number#19073 AS b_street_number#18773, ca_street_name#19074 AS b_streen_name#18774, ca_city#19077 AS b_city#18775, ca_zip#19080 AS b_zip#18776, ca_street_number#19086 AS c_street_number#18777, ca_street_name#19087 AS c_street_name#18778, ca_city#19090 AS c_city#18779, ca_zip#19093 AS c_zip#18780, d_year#18899 AS syear#18781, count(1) AS cnt#18784L, sum(ss_wholesale_cost#18860) AS s1#18785, sum(ss_list_price#18861) AS s2#18786, sum(ss_coupon_amt#18868) AS s3#18787]
      :  +- Project [ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, d_year#18927, d_year#18955, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, i_item_sk#19103L, i_product_name#19124]
      :     +- Join Inner, (ss_item_sk#18851L = i_item_sk#19103L)
      :        :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
      :        :  +- Join Inner, (hd_income_band_sk#19067L = ib_income_band_sk#19100L)
      :        :     :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
      :        :     :  +- Join Inner, (hd_income_band_sk#19062L = ib_income_band_sk#19097L)
      :        :     :     :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
      :        :     :     :  +- Join Inner, (c_current_addr_sk#19010L = ca_address_sk#19084L)
      :        :     :     :     :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080]
      :        :     :     :     :  +- Join Inner, (ss_addr_sk#18855L = ca_address_sk#19071L)
      :        :     :     :     :     :- Project [ss_item_sk#18851L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L]
      :        :     :     :     :     :  +- Join Inner, (c_current_hdemo_sk#19009L = hd_demo_sk#19066L)
      :        :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L]
      :        :     :     :     :     :     :  +- Join Inner, (ss_hdemo_sk#18854L = hd_demo_sk#19061L)
      :        :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
      :        :     :     :     :     :     :     :  +- Join Inner, (ss_promo_sk#18857L = p_promo_sk#19042L)
      :        :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
      :        :     :     :     :     :     :     :     :  +- Join Inner, ((c_current_cdemo_sk#19008L = cd_demo_sk#19033L) AND NOT (cd_marital_status#19026 = cd_marital_status#19035))
      :        :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955, cd_marital_status#19026]
      :        :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_cdemo_sk#18853L = cd_demo_sk#19024L)
      :        :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
      :        :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_shipto_date_sk#19011L = d_date_sk#18949L)
      :        :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, c_first_shipto_date_sk#19011L, d_year#18927]
      :        :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_sales_date_sk#19012L = d_date_sk#18921L)
      :        :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, c_first_shipto_date_sk#19011L, c_first_sales_date_sk#19012L]
      :        :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_customer_sk#18852L = c_customer_sk#19006L)
      :        :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_store_sk#18856L = s_store_sk#18977L)
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_sold_date_sk#18872L = d_date_sk#18893L)
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, ss_sold_date_sk#18872L]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_item_sk#18851L = cs_item_sk#18803L)
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, ss_sold_date_sk#18872L]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, ((ss_item_sk#18851L = sr_item_sk#18874L) AND (ss_ticket_number#18858L = sr_ticket_number#18881L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_ticket_number#18858L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, ss_sold_date_sk#18872L]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Filter (((((((((isnotnull(ss_item_sk#18851L) AND isnotnull(ss_ticket_number#18858L)) AND isnotnull(ss_sold_date_sk#18872L)) AND isnotnull(ss_store_sk#18856L)) AND isnotnull(ss_customer_sk#18852L)) AND isnotnull(ss_cdemo_sk#18853L)) AND isnotnull(ss_promo_sk#18857L)) AND isnotnull(ss_hdemo_sk#18854L)) AND isnotnull(ss_addr_sk#18855L)) AND dynamicpruning#19527 [ss_sold_date_sk#18872L])
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Project [d_date_sk#18893L, d_year#18899]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Filter ((isnotnull(d_year#18899) AND (d_year#18899 = 2000)) AND isnotnull(d_date_sk#18893L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18893L,d_date_id#18894,d_date#18895,d_month_seq#18896,d_week_seq#18897,d_quarter_seq#18898,d_year#18899,d_dow#18900,d_moy#18901,d_dom#18902,d_qoy#18903,d_fy_year#18904,d_fy_quarter_seq#18905,d_fy_week_seq#18906,d_day_name#18907,d_quarter_name#18908,d_holiday#18909,d_weekend#18910,d_following_holiday#18911,d_first_dom#18912,d_last_dom#18913,d_same_day_ly#18914,d_same_day_lq#18915,d_current_day#18916,... 4 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#18850L,ss_item_sk#18851L,ss_customer_sk#18852L,ss_cdemo_sk#18853L,ss_hdemo_sk#18854L,ss_addr_sk#18855L,ss_store_sk#18856L,ss_promo_sk#18857L,ss_ticket_number#18858L,ss_quantity#18859,ss_wholesale_cost#18860,ss_list_price#18861,ss_sales_price#18862,ss_ext_discount_amt#18863,ss_ext_sales_price#18864,ss_ext_wholesale_cost#18865,ss_ext_list_price#18866,ss_ext_tax#18867,ss_coupon_amt#18868,ss_net_paid#18869,ss_net_paid_inc_tax#18870,ss_net_profit#18871,ss_sold_date_sk#18872L] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [sr_item_sk#18874L, sr_ticket_number#18881L]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sr_item_sk#18874L) AND isnotnull(sr_ticket_number#18881L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#18873L,sr_item_sk#18874L,sr_customer_sk#18875L,sr_cdemo_sk#18876L,sr_hdemo_sk#18877L,sr_addr_sk#18878L,sr_store_sk#18879L,sr_reason_sk#18880L,sr_ticket_number#18881L,sr_return_quantity#18882,sr_return_amt#18883,sr_return_tax#18884,sr_return_amt_inc_tax#18885,sr_fee#18886,sr_return_ship_cost#18887,sr_refunded_cash#18888,sr_reversed_charge#18889,sr_store_credit#18890,sr_net_loss#18891,sr_returned_date_sk#18892L] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [cs_item_sk#18803L]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(sale#18767) AND isnotnull(refund#18768)) AND (sale#18767 > (2.0 * refund#18768)))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Aggregate [cs_item_sk#18803L], [cs_item_sk#18803L, sum(cs_ext_list_price#18813) AS sale#18767, sum(((cr_refunded_cash#18845 + cr_reversed_charge#18846) + cr_store_credit#18847)) AS refund#18768]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- Project [cs_item_sk#18803L, cs_ext_list_price#18813, cr_refunded_cash#18845, cr_reversed_charge#18846, cr_store_credit#18847]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- Join Inner, ((cs_item_sk#18803L = cr_item_sk#18824L) AND (cs_order_number#18805L = cr_order_number#18838L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :- Project [cs_item_sk#18803L, cs_order_number#18805L, cs_ext_list_price#18813]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :  +- Filter (isnotnull(cs_item_sk#18803L) AND isnotnull(cs_order_number#18805L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#18789L,cs_ship_date_sk#18790L,cs_bill_customer_sk#18791L,cs_bill_cdemo_sk#18792L,cs_bill_hdemo_sk#18793L,cs_bill_addr_sk#18794L,cs_ship_customer_sk#18795L,cs_ship_cdemo_sk#18796L,cs_ship_hdemo_sk#18797L,cs_ship_addr_sk#18798L,cs_call_center_sk#18799L,cs_catalog_page_sk#18800L,cs_ship_mode_sk#18801L,cs_warehouse_sk#18802L,cs_item_sk#18803L,cs_promo_sk#18804L,cs_order_number#18805L,cs_quantity#18806,cs_wholesale_cost#18807,cs_list_price#18808,cs_sales_price#18809,cs_ext_discount_amt#18810,cs_ext_sales_price#18811,cs_ext_wholesale_cost#18812,... 10 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- Project [cr_item_sk#18824L, cr_order_number#18838L, cr_refunded_cash#18845, cr_reversed_charge#18846, cr_store_credit#18847]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- Filter (isnotnull(cr_item_sk#18824L) AND isnotnull(cr_order_number#18838L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#18823L,cr_item_sk#18824L,cr_refunded_customer_sk#18825L,cr_refunded_cdemo_sk#18826L,cr_refunded_hdemo_sk#18827L,cr_refunded_addr_sk#18828L,cr_returning_customer_sk#18829L,cr_returning_cdemo_sk#18830L,cr_returning_hdemo_sk#18831L,cr_returning_addr_sk#18832L,cr_call_center_sk#18833L,cr_catalog_page_sk#18834L,cr_ship_mode_sk#18835L,cr_warehouse_sk#18836L,cr_reason_sk#18837L,cr_order_number#18838L,cr_return_quantity#18839,cr_return_amount#18840,cr_return_tax#18841,cr_return_amt_inc_tax#18842,cr_fee#18843,cr_return_ship_cost#18844,cr_refunded_cash#18845,cr_reversed_charge#18846,... 3 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#18893L, d_year#18899]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(d_year#18899) AND (d_year#18899 = 2000)) AND isnotnull(d_date_sk#18893L))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18893L,d_date_id#18894,d_date#18895,d_month_seq#18896,d_week_seq#18897,d_quarter_seq#18898,d_year#18899,d_dow#18900,d_moy#18901,d_dom#18902,d_qoy#18903,d_fy_year#18904,d_fy_quarter_seq#18905,d_fy_week_seq#18906,d_day_name#18907,d_quarter_name#18908,d_holiday#18909,d_weekend#18910,d_following_holiday#18911,d_first_dom#18912,d_last_dom#18913,d_same_day_ly#18914,d_same_day_lq#18915,d_current_day#18916,... 4 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [s_store_sk#18977L, s_store_name#18982, s_zip#19002]
      :        :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(s_store_sk#18977L) AND (isnotnull(s_store_name#18982) AND isnotnull(s_zip#19002)))
      :        :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18977L,s_store_id#18978,s_rec_start_date#18979,s_rec_end_date#18980,s_closed_date_sk#18981L,s_store_name#18982,s_number_employees#18983,s_floor_space#18984,s_hours#18985,s_manager#18986,s_market_id#18987,s_geography_class#18988,s_market_desc#18989,s_market_manager#18990,s_division_id#18991,s_division_name#18992,s_company_id#18993,s_company_name#18994,s_street_number#18995,s_street_name#18996,s_street_type#18997,s_suite_number#18998,s_city#18999,s_county#19000,... 5 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     :     :     +- Project [c_customer_sk#19006L, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, c_first_shipto_date_sk#19011L, c_first_sales_date_sk#19012L]
      :        :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(c_customer_sk#19006L) AND ((isnotnull(c_first_sales_date_sk#19012L) AND isnotnull(c_first_shipto_date_sk#19011L)) AND isnotnull(c_current_cdemo_sk#19008L))) AND (isnotnull(c_current_hdemo_sk#19009L) AND isnotnull(c_current_addr_sk#19010L)))
      :        :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#19006L,c_customer_id#19007,c_current_cdemo_sk#19008L,c_current_hdemo_sk#19009L,c_current_addr_sk#19010L,c_first_shipto_date_sk#19011L,c_first_sales_date_sk#19012L,c_salutation#19013,c_first_name#19014,c_last_name#19015,c_preferred_cust_flag#19016,c_birth_day#19017,c_birth_month#19018,c_birth_year#19019,c_birth_country#19020,c_login#19021,c_email_address#19022,c_last_review_date#19023] orc
      :        :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#18921L, d_year#18927]
      :        :     :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#18921L)
      :        :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18921L,d_date_id#18922,d_date#18923,d_month_seq#18924,d_week_seq#18925,d_quarter_seq#18926,d_year#18927,d_dow#18928,d_moy#18929,d_dom#18930,d_qoy#18931,d_fy_year#18932,d_fy_quarter_seq#18933,d_fy_week_seq#18934,d_day_name#18935,d_quarter_name#18936,d_holiday#18937,d_weekend#18938,d_following_holiday#18939,d_first_dom#18940,d_last_dom#18941,d_same_day_ly#18942,d_same_day_lq#18943,d_current_day#18944,... 4 more fields] orc
      :        :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#18949L, d_year#18955]
      :        :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#18949L)
      :        :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18949L,d_date_id#18950,d_date#18951,d_month_seq#18952,d_week_seq#18953,d_quarter_seq#18954,d_year#18955,d_dow#18956,d_moy#18957,d_dom#18958,d_qoy#18959,d_fy_year#18960,d_fy_quarter_seq#18961,d_fy_week_seq#18962,d_day_name#18963,d_quarter_name#18964,d_holiday#18965,d_weekend#18966,d_following_holiday#18967,d_first_dom#18968,d_last_dom#18969,d_same_day_ly#18970,d_same_day_lq#18971,d_current_day#18972,... 4 more fields] orc
      :        :     :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#19024L, cd_marital_status#19026]
      :        :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#19024L) AND isnotnull(cd_marital_status#19026))
      :        :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19024L,cd_gender#19025,cd_marital_status#19026,cd_education_status#19027,cd_purchase_estimate#19028,cd_credit_rating#19029,cd_dep_count#19030,cd_dep_employed_count#19031,cd_dep_college_count#19032] orc
      :        :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#19033L, cd_marital_status#19035]
      :        :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#19033L) AND isnotnull(cd_marital_status#19035))
      :        :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19033L,cd_gender#19034,cd_marital_status#19035,cd_education_status#19036,cd_purchase_estimate#19037,cd_credit_rating#19038,cd_dep_count#19039,cd_dep_employed_count#19040,cd_dep_college_count#19041] orc
      :        :     :     :     :     :     :     :     +- Project [p_promo_sk#19042L]
      :        :     :     :     :     :     :     :        +- Filter isnotnull(p_promo_sk#19042L)
      :        :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#19042L,p_promo_id#19043,p_start_date_sk#19044L,p_end_date_sk#19045L,p_item_sk#19046L,p_cost#19047,p_response_target#19048,p_promo_name#19049,p_channel_dmail#19050,p_channel_email#19051,p_channel_catalog#19052,p_channel_tv#19053,p_channel_radio#19054,p_channel_press#19055,p_channel_event#19056,p_channel_demo#19057,p_channel_details#19058,p_purpose#19059,p_discount_active#19060] orc
      :        :     :     :     :     :     :     +- Project [hd_demo_sk#19061L, hd_income_band_sk#19062L]
      :        :     :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#19061L) AND isnotnull(hd_income_band_sk#19062L))
      :        :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19061L,hd_income_band_sk#19062L,hd_buy_potential#19063,hd_dep_count#19064,hd_vehicle_count#19065] orc
      :        :     :     :     :     :     +- Project [hd_demo_sk#19066L, hd_income_band_sk#19067L]
      :        :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#19066L) AND isnotnull(hd_income_band_sk#19067L))
      :        :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19066L,hd_income_band_sk#19067L,hd_buy_potential#19068,hd_dep_count#19069,hd_vehicle_count#19070] orc
      :        :     :     :     :     +- Project [ca_address_sk#19071L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080]
      :        :     :     :     :        +- Filter isnotnull(ca_address_sk#19071L)
      :        :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19071L,ca_address_id#19072,ca_street_number#19073,ca_street_name#19074,ca_street_type#19075,ca_suite_number#19076,ca_city#19077,ca_county#19078,ca_state#19079,ca_zip#19080,ca_country#19081,ca_gmt_offset#19082,ca_location_type#19083] orc
      :        :     :     :     +- Project [ca_address_sk#19084L, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
      :        :     :     :        +- Filter isnotnull(ca_address_sk#19084L)
      :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19084L,ca_address_id#19085,ca_street_number#19086,ca_street_name#19087,ca_street_type#19088,ca_suite_number#19089,ca_city#19090,ca_county#19091,ca_state#19092,ca_zip#19093,ca_country#19094,ca_gmt_offset#19095,ca_location_type#19096] orc
      :        :     :     +- Project [ib_income_band_sk#19097L]
      :        :     :        +- Filter isnotnull(ib_income_band_sk#19097L)
      :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19097L,ib_lower_bound#19098,ib_upper_bound#19099] orc
      :        :     +- Project [ib_income_band_sk#19100L]
      :        :        +- Filter isnotnull(ib_income_band_sk#19100L)
      :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19100L,ib_lower_bound#19101,ib_upper_bound#19102] orc
      :        +- Project [i_item_sk#19103L, i_product_name#19124]
      :           +- Filter ((isnotnull(i_current_price#19108) AND ((((i_color#19120 IN (maroon,burnished,dim,steel,navajo,chocolate) AND (i_current_price#19108 >= 35.0)) AND (i_current_price#19108 <= 45.0)) AND (i_current_price#19108 >= 36.0)) AND (i_current_price#19108 <= 50.0))) AND isnotnull(i_item_sk#19103L))
      :              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19103L,i_item_id#19104,i_rec_start_date#19105,i_rec_end_date#19106,i_item_desc#19107,i_current_price#19108,i_wholesale_cost#19109,i_brand_id#19110,i_brand#19111,i_class_id#19112,i_class#19113,i_category_id#19114,i_category#19115,i_manufact_id#19116,i_manufact#19117,i_size#19118,i_formulation#19119,i_color#19120,i_units#19121,i_container#19122,i_manager_id#19123,i_product_name#19124] orc
      +- Aggregate [i_product_name#19507, i_item_sk#19486L, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, d_year#19282, d_year#19310, d_year#19338], [i_item_sk#19486L AS item_sk#19133L, s_store_name#19365 AS store_name#19134, s_zip#19385 AS store_zip#19135, d_year#19282 AS syear#19144, count(1) AS cnt#19147L, sum(ss_wholesale_cost#19182) AS s1#19148, sum(ss_list_price#19183) AS s2#19149, sum(ss_coupon_amt#19190) AS s3#19150]
         +- Project [ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, d_year#19310, d_year#19338, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, i_item_sk#19486L, i_product_name#19507]
            +- Join Inner, (ss_item_sk#19173L = i_item_sk#19486L)
               :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
               :  +- Join Inner, (hd_income_band_sk#19450L = ib_income_band_sk#19483L)
               :     :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
               :     :  +- Join Inner, (hd_income_band_sk#19445L = ib_income_band_sk#19480L)
               :     :     :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
               :     :     :  +- Join Inner, (c_current_addr_sk#19393L = ca_address_sk#19467L)
               :     :     :     :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463]
               :     :     :     :  +- Join Inner, (ss_addr_sk#19177L = ca_address_sk#19454L)
               :     :     :     :     :- Project [ss_item_sk#19173L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L]
               :     :     :     :     :  +- Join Inner, (c_current_hdemo_sk#19392L = hd_demo_sk#19449L)
               :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L]
               :     :     :     :     :     :  +- Join Inner, (ss_hdemo_sk#19176L = hd_demo_sk#19444L)
               :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
               :     :     :     :     :     :     :  +- Join Inner, (ss_promo_sk#19179L = p_promo_sk#19425L)
               :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
               :     :     :     :     :     :     :     :  +- Join Inner, ((c_current_cdemo_sk#19391L = cd_demo_sk#19416L) AND NOT (cd_marital_status#19409 = cd_marital_status#19418))
               :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338, cd_marital_status#19409]
               :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_cdemo_sk#19175L = cd_demo_sk#19407L)
               :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
               :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_shipto_date_sk#19394L = d_date_sk#19332L)
               :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, c_first_shipto_date_sk#19394L, d_year#19310]
               :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_sales_date_sk#19395L = d_date_sk#19304L)
               :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, c_first_shipto_date_sk#19394L, c_first_sales_date_sk#19395L]
               :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_customer_sk#19174L = c_customer_sk#19389L)
               :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385]
               :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_store_sk#19178L = s_store_sk#19360L)
               :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_sold_date_sk#19194L = d_date_sk#19276L)
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, ss_sold_date_sk#19194L]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_item_sk#19173L = cs_item_sk#19229L)
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, ss_sold_date_sk#19194L]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, ((ss_item_sk#19173L = sr_item_sk#19196L) AND (ss_ticket_number#19180L = sr_ticket_number#19203L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_ticket_number#19180L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, ss_sold_date_sk#19194L]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Filter (((((((((isnotnull(ss_item_sk#19173L) AND isnotnull(ss_ticket_number#19180L)) AND isnotnull(ss_sold_date_sk#19194L)) AND isnotnull(ss_store_sk#19178L)) AND isnotnull(ss_customer_sk#19174L)) AND isnotnull(ss_cdemo_sk#19175L)) AND isnotnull(ss_promo_sk#19179L)) AND isnotnull(ss_hdemo_sk#19176L)) AND isnotnull(ss_addr_sk#19177L)) AND dynamicpruning#19528 [ss_sold_date_sk#19194L])
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Project [d_date_sk#19276L, d_year#19282]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Filter ((isnotnull(d_year#19282) AND (d_year#19282 = 2001)) AND isnotnull(d_date_sk#19276L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19276L,d_date_id#19277,d_date#19278,d_month_seq#19279,d_week_seq#19280,d_quarter_seq#19281,d_year#19282,d_dow#19283,d_moy#19284,d_dom#19285,d_qoy#19286,d_fy_year#19287,d_fy_quarter_seq#19288,d_fy_week_seq#19289,d_day_name#19290,d_quarter_name#19291,d_holiday#19292,d_weekend#19293,d_following_holiday#19294,d_first_dom#19295,d_last_dom#19296,d_same_day_ly#19297,d_same_day_lq#19298,d_current_day#19299,... 4 more fields] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#19172L,ss_item_sk#19173L,ss_customer_sk#19174L,ss_cdemo_sk#19175L,ss_hdemo_sk#19176L,ss_addr_sk#19177L,ss_store_sk#19178L,ss_promo_sk#19179L,ss_ticket_number#19180L,ss_quantity#19181,ss_wholesale_cost#19182,ss_list_price#19183,ss_sales_price#19184,ss_ext_discount_amt#19185,ss_ext_sales_price#19186,ss_ext_wholesale_cost#19187,ss_ext_list_price#19188,ss_ext_tax#19189,ss_coupon_amt#19190,ss_net_paid#19191,ss_net_paid_inc_tax#19192,ss_net_profit#19193,ss_sold_date_sk#19194L] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [sr_item_sk#19196L, sr_ticket_number#19203L]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sr_item_sk#19196L) AND isnotnull(sr_ticket_number#19203L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#19195L,sr_item_sk#19196L,sr_customer_sk#19197L,sr_cdemo_sk#19198L,sr_hdemo_sk#19199L,sr_addr_sk#19200L,sr_store_sk#19201L,sr_reason_sk#19202L,sr_ticket_number#19203L,sr_return_quantity#19204,sr_return_amt#19205,sr_return_tax#19206,sr_return_amt_inc_tax#19207,sr_fee#19208,sr_return_ship_cost#19209,sr_refunded_cash#19210,sr_reversed_charge#19211,sr_store_credit#19212,sr_net_loss#19213,sr_returned_date_sk#19214L] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [cs_item_sk#19229L]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(sale#18767) AND isnotnull(refund#18768)) AND (sale#18767 > (2.0 * refund#18768)))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Aggregate [cs_item_sk#19229L], [cs_item_sk#19229L, sum(cs_ext_list_price#19239) AS sale#18767, sum(((cr_refunded_cash#19271 + cr_reversed_charge#19272) + cr_store_credit#19273)) AS refund#18768]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- Project [cs_item_sk#19229L, cs_ext_list_price#19239, cr_refunded_cash#19271, cr_reversed_charge#19272, cr_store_credit#19273]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- Join Inner, ((cs_item_sk#19229L = cr_item_sk#19250L) AND (cs_order_number#19231L = cr_order_number#19264L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :- Project [cs_item_sk#19229L, cs_order_number#19231L, cs_ext_list_price#19239]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :  +- Filter (isnotnull(cs_item_sk#19229L) AND isnotnull(cs_order_number#19231L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#19215L,cs_ship_date_sk#19216L,cs_bill_customer_sk#19217L,cs_bill_cdemo_sk#19218L,cs_bill_hdemo_sk#19219L,cs_bill_addr_sk#19220L,cs_ship_customer_sk#19221L,cs_ship_cdemo_sk#19222L,cs_ship_hdemo_sk#19223L,cs_ship_addr_sk#19224L,cs_call_center_sk#19225L,cs_catalog_page_sk#19226L,cs_ship_mode_sk#19227L,cs_warehouse_sk#19228L,cs_item_sk#19229L,cs_promo_sk#19230L,cs_order_number#19231L,cs_quantity#19232,cs_wholesale_cost#19233,cs_list_price#19234,cs_sales_price#19235,cs_ext_discount_amt#19236,cs_ext_sales_price#19237,cs_ext_wholesale_cost#19238,... 10 more fields] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- Project [cr_item_sk#19250L, cr_order_number#19264L, cr_refunded_cash#19271, cr_reversed_charge#19272, cr_store_credit#19273]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- Filter (isnotnull(cr_item_sk#19250L) AND isnotnull(cr_order_number#19264L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#19249L,cr_item_sk#19250L,cr_refunded_customer_sk#19251L,cr_refunded_cdemo_sk#19252L,cr_refunded_hdemo_sk#19253L,cr_refunded_addr_sk#19254L,cr_returning_customer_sk#19255L,cr_returning_cdemo_sk#19256L,cr_returning_hdemo_sk#19257L,cr_returning_addr_sk#19258L,cr_call_center_sk#19259L,cr_catalog_page_sk#19260L,cr_ship_mode_sk#19261L,cr_warehouse_sk#19262L,cr_reason_sk#19263L,cr_order_number#19264L,cr_return_quantity#19265,cr_return_amount#19266,cr_return_tax#19267,cr_return_amt_inc_tax#19268,cr_fee#19269,cr_return_ship_cost#19270,cr_refunded_cash#19271,cr_reversed_charge#19272,... 3 more fields] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#19276L, d_year#19282]
               :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(d_year#19282) AND (d_year#19282 = 2001)) AND isnotnull(d_date_sk#19276L))
               :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19276L,d_date_id#19277,d_date#19278,d_month_seq#19279,d_week_seq#19280,d_quarter_seq#19281,d_year#19282,d_dow#19283,d_moy#19284,d_dom#19285,d_qoy#19286,d_fy_year#19287,d_fy_quarter_seq#19288,d_fy_week_seq#19289,d_day_name#19290,d_quarter_name#19291,d_holiday#19292,d_weekend#19293,d_following_holiday#19294,d_first_dom#19295,d_last_dom#19296,d_same_day_ly#19297,d_same_day_lq#19298,d_current_day#19299,... 4 more fields] orc
               :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [s_store_sk#19360L, s_store_name#19365, s_zip#19385]
               :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(s_store_sk#19360L) AND (isnotnull(s_store_name#19365) AND isnotnull(s_zip#19385)))
               :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#19360L,s_store_id#19361,s_rec_start_date#19362,s_rec_end_date#19363,s_closed_date_sk#19364L,s_store_name#19365,s_number_employees#19366,s_floor_space#19367,s_hours#19368,s_manager#19369,s_market_id#19370,s_geography_class#19371,s_market_desc#19372,s_market_manager#19373,s_division_id#19374,s_division_name#19375,s_company_id#19376,s_company_name#19377,s_street_number#19378,s_street_name#19379,s_street_type#19380,s_suite_number#19381,s_city#19382,s_county#19383,... 5 more fields] orc
               :     :     :     :     :     :     :     :     :     :     :     :     +- Project [c_customer_sk#19389L, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, c_first_shipto_date_sk#19394L, c_first_sales_date_sk#19395L]
               :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(c_customer_sk#19389L) AND ((isnotnull(c_first_sales_date_sk#19395L) AND isnotnull(c_first_shipto_date_sk#19394L)) AND isnotnull(c_current_cdemo_sk#19391L))) AND (isnotnull(c_current_hdemo_sk#19392L) AND isnotnull(c_current_addr_sk#19393L)))
               :     :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#19389L,c_customer_id#19390,c_current_cdemo_sk#19391L,c_current_hdemo_sk#19392L,c_current_addr_sk#19393L,c_first_shipto_date_sk#19394L,c_first_sales_date_sk#19395L,c_salutation#19396,c_first_name#19397,c_last_name#19398,c_preferred_cust_flag#19399,c_birth_day#19400,c_birth_month#19401,c_birth_year#19402,c_birth_country#19403,c_login#19404,c_email_address#19405,c_last_review_date#19406] orc
               :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#19304L, d_year#19310]
               :     :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#19304L)
               :     :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19304L,d_date_id#19305,d_date#19306,d_month_seq#19307,d_week_seq#19308,d_quarter_seq#19309,d_year#19310,d_dow#19311,d_moy#19312,d_dom#19313,d_qoy#19314,d_fy_year#19315,d_fy_quarter_seq#19316,d_fy_week_seq#19317,d_day_name#19318,d_quarter_name#19319,d_holiday#19320,d_weekend#19321,d_following_holiday#19322,d_first_dom#19323,d_last_dom#19324,d_same_day_ly#19325,d_same_day_lq#19326,d_current_day#19327,... 4 more fields] orc
               :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#19332L, d_year#19338]
               :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#19332L)
               :     :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19332L,d_date_id#19333,d_date#19334,d_month_seq#19335,d_week_seq#19336,d_quarter_seq#19337,d_year#19338,d_dow#19339,d_moy#19340,d_dom#19341,d_qoy#19342,d_fy_year#19343,d_fy_quarter_seq#19344,d_fy_week_seq#19345,d_day_name#19346,d_quarter_name#19347,d_holiday#19348,d_weekend#19349,d_following_holiday#19350,d_first_dom#19351,d_last_dom#19352,d_same_day_ly#19353,d_same_day_lq#19354,d_current_day#19355,... 4 more fields] orc
               :     :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#19407L, cd_marital_status#19409]
               :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#19407L) AND isnotnull(cd_marital_status#19409))
               :     :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19407L,cd_gender#19408,cd_marital_status#19409,cd_education_status#19410,cd_purchase_estimate#19411,cd_credit_rating#19412,cd_dep_count#19413,cd_dep_employed_count#19414,cd_dep_college_count#19415] orc
               :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#19416L, cd_marital_status#19418]
               :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#19416L) AND isnotnull(cd_marital_status#19418))
               :     :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19416L,cd_gender#19417,cd_marital_status#19418,cd_education_status#19419,cd_purchase_estimate#19420,cd_credit_rating#19421,cd_dep_count#19422,cd_dep_employed_count#19423,cd_dep_college_count#19424] orc
               :     :     :     :     :     :     :     +- Project [p_promo_sk#19425L]
               :     :     :     :     :     :     :        +- Filter isnotnull(p_promo_sk#19425L)
               :     :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#19425L,p_promo_id#19426,p_start_date_sk#19427L,p_end_date_sk#19428L,p_item_sk#19429L,p_cost#19430,p_response_target#19431,p_promo_name#19432,p_channel_dmail#19433,p_channel_email#19434,p_channel_catalog#19435,p_channel_tv#19436,p_channel_radio#19437,p_channel_press#19438,p_channel_event#19439,p_channel_demo#19440,p_channel_details#19441,p_purpose#19442,p_discount_active#19443] orc
               :     :     :     :     :     :     +- Project [hd_demo_sk#19444L, hd_income_band_sk#19445L]
               :     :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#19444L) AND isnotnull(hd_income_band_sk#19445L))
               :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19444L,hd_income_band_sk#19445L,hd_buy_potential#19446,hd_dep_count#19447,hd_vehicle_count#19448] orc
               :     :     :     :     :     +- Project [hd_demo_sk#19449L, hd_income_band_sk#19450L]
               :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#19449L) AND isnotnull(hd_income_band_sk#19450L))
               :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19449L,hd_income_band_sk#19450L,hd_buy_potential#19451,hd_dep_count#19452,hd_vehicle_count#19453] orc
               :     :     :     :     +- Project [ca_address_sk#19454L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463]
               :     :     :     :        +- Filter isnotnull(ca_address_sk#19454L)
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19454L,ca_address_id#19455,ca_street_number#19456,ca_street_name#19457,ca_street_type#19458,ca_suite_number#19459,ca_city#19460,ca_county#19461,ca_state#19462,ca_zip#19463,ca_country#19464,ca_gmt_offset#19465,ca_location_type#19466] orc
               :     :     :     +- Project [ca_address_sk#19467L, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
               :     :     :        +- Filter isnotnull(ca_address_sk#19467L)
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19467L,ca_address_id#19468,ca_street_number#19469,ca_street_name#19470,ca_street_type#19471,ca_suite_number#19472,ca_city#19473,ca_county#19474,ca_state#19475,ca_zip#19476,ca_country#19477,ca_gmt_offset#19478,ca_location_type#19479] orc
               :     :     +- Project [ib_income_band_sk#19480L]
               :     :        +- Filter isnotnull(ib_income_band_sk#19480L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19480L,ib_lower_bound#19481,ib_upper_bound#19482] orc
               :     +- Project [ib_income_band_sk#19483L]
               :        +- Filter isnotnull(ib_income_band_sk#19483L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19483L,ib_lower_bound#19484,ib_upper_bound#19485] orc
               +- Project [i_item_sk#19486L, i_product_name#19507]
                  +- Filter ((isnotnull(i_current_price#19491) AND ((((i_color#19503 IN (maroon,burnished,dim,steel,navajo,chocolate) AND (i_current_price#19491 >= 35.0)) AND (i_current_price#19491 <= 45.0)) AND (i_current_price#19491 >= 36.0)) AND (i_current_price#19491 <= 50.0))) AND isnotnull(i_item_sk#19486L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19486L,i_item_id#19487,i_rec_start_date#19488,i_rec_end_date#19489,i_item_desc#19490,i_current_price#19491,i_wholesale_cost#19492,i_brand_id#19493,i_brand#19494,i_class_id#19495,i_class#19496,i_category_id#19497,i_category#19498,i_manufact_id#19499,i_manufact#19500,i_size#19501,i_formulation#19502,i_color#19503,i_units#19504,i_container#19505,i_manager_id#19506,i_product_name#19507] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [product_name#18769 ASC NULLS FIRST, store_name#18771 ASC NULLS FIRST, cnt#19147L ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(product_name#18769 ASC NULLS FIRST, store_name#18771 ASC NULLS FIRST, cnt#19147L ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#20685]
      +- Project [product_name#18769, store_name#18771, store_zip#18772, b_street_number#18773, b_streen_name#18774, b_city#18775, b_zip#18776, c_street_number#18777, c_street_name#18778, c_city#18779, c_zip#18780, syear#18781, cnt#18784L, s1#18785, s2#18786, s3#18787, s1#19148, s2#19149, s3#19150, syear#19144, cnt#19147L]
         +- SortMergeJoin [item_sk#18770L, store_name#18771, store_zip#18772], [item_sk#19133L, store_name#19134, store_zip#19135], Inner, (cnt#19147L <= cnt#18784L)
            :- Sort [item_sk#18770L ASC NULLS FIRST, store_name#18771 ASC NULLS FIRST, store_zip#18772 ASC NULLS FIRST], false, 0
            :  +- Exchange hashpartitioning(item_sk#18770L, store_name#18771, store_zip#18772, 3000), ENSURE_REQUIREMENTS, [id=#20678]
            :     +- HashAggregate(keys=[i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955], functions=[count(1), sum(ss_wholesale_cost#18860), sum(ss_list_price#18861), sum(ss_coupon_amt#18868)], output=[product_name#18769, item_sk#18770L, store_name#18771, store_zip#18772, b_street_number#18773, b_streen_name#18774, b_city#18775, b_zip#18776, c_street_number#18777, c_street_name#18778, c_city#18779, c_zip#18780, syear#18781, cnt#18784L, s1#18785, s2#18786, s3#18787])
            :        +- Exchange hashpartitioning(i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955, 3000), ENSURE_REQUIREMENTS, [id=#20566]
            :           +- HashAggregate(keys=[i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955], functions=[partial_count(1), partial_sum(ss_wholesale_cost#18860), partial_sum(ss_list_price#18861), partial_sum(ss_coupon_amt#18868)], output=[i_product_name#19124, i_item_sk#19103L, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, d_year#18899, d_year#18927, d_year#18955, count#19533L, sum#19534, sum#19535, sum#19536])
            :              +- Project [ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, d_year#18927, d_year#18955, s_store_name#18982, s_zip#19002, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093, i_item_sk#19103L, i_product_name#19124]
            :                 +- BroadcastHashJoin [ss_item_sk#18851L], [i_item_sk#19103L], Inner, BuildRight, false
            :                    :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
            :                    :  +- BroadcastHashJoin [hd_income_band_sk#19067L], [ib_income_band_sk#19100L], Inner, BuildRight, false
            :                    :     :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
            :                    :     :  +- BroadcastHashJoin [hd_income_band_sk#19062L], [ib_income_band_sk#19097L], Inner, BuildRight, false
            :                    :     :     :- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080, ca_street_number#19086, ca_street_name#19087, ca_city#19090, ca_zip#19093]
            :                    :     :     :  +- SortMergeJoin [c_current_addr_sk#19010L], [ca_address_sk#19084L], Inner
            :                    :     :     :     :- Sort [c_current_addr_sk#19010L ASC NULLS FIRST], false, 0
            :                    :     :     :     :  +- Exchange hashpartitioning(c_current_addr_sk#19010L, 3000), ENSURE_REQUIREMENTS, [id=#20546]
            :                    :     :     :     :     +- Project [ss_item_sk#18851L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L, ca_street_number#19073, ca_street_name#19074, ca_city#19077, ca_zip#19080]
            :                    :     :     :     :        +- SortMergeJoin [ss_addr_sk#18855L], [ca_address_sk#19071L], Inner
            :                    :     :     :     :           :- Sort [ss_addr_sk#18855L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :  +- Exchange hashpartitioning(ss_addr_sk#18855L, 3000), ENSURE_REQUIREMENTS, [id=#20538]
            :                    :     :     :     :           :     +- Project [ss_item_sk#18851L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L, hd_income_band_sk#19067L]
            :                    :     :     :     :           :        +- BroadcastHashJoin [c_current_hdemo_sk#19009L], [hd_demo_sk#19066L], Inner, BuildRight, false
            :                    :     :     :     :           :           :- Project [ss_item_sk#18851L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955, hd_income_band_sk#19062L]
            :                    :     :     :     :           :           :  +- BroadcastHashJoin [ss_hdemo_sk#18854L], [hd_demo_sk#19061L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
            :                    :     :     :     :           :           :     :  +- BroadcastHashJoin [ss_promo_sk#18857L], [p_promo_sk#19042L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
            :                    :     :     :     :           :           :     :     :  +- SortMergeJoin [c_current_cdemo_sk#19008L], [cd_demo_sk#19033L], Inner, NOT (cd_marital_status#19026 = cd_marital_status#19035)
            :                    :     :     :     :           :           :     :     :     :- Sort [c_current_cdemo_sk#19008L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :  +- Exchange hashpartitioning(c_current_cdemo_sk#19008L, 3000), ENSURE_REQUIREMENTS, [id=#20518]
            :                    :     :     :     :           :           :     :     :     :     +- Project [ss_item_sk#18851L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955, cd_marital_status#19026]
            :                    :     :     :     :           :           :     :     :     :        +- SortMergeJoin [ss_cdemo_sk#18853L], [cd_demo_sk#19024L], Inner
            :                    :     :     :     :           :           :     :     :     :           :- Sort [ss_cdemo_sk#18853L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :  +- Exchange hashpartitioning(ss_cdemo_sk#18853L, 3000), ENSURE_REQUIREMENTS, [id=#20510]
            :                    :     :     :     :           :           :     :     :     :           :     +- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, d_year#18927, d_year#18955]
            :                    :     :     :     :           :           :     :     :     :           :        +- BroadcastHashJoin [c_first_shipto_date_sk#19011L], [d_date_sk#18949L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :     :           :           :- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, c_first_shipto_date_sk#19011L, d_year#18927]
            :                    :     :     :     :           :           :     :     :     :           :           :  +- BroadcastHashJoin [c_first_sales_date_sk#19012L], [d_date_sk#18921L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :     :           :           :     :- Project [ss_item_sk#18851L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002, c_current_cdemo_sk#19008L, c_current_hdemo_sk#19009L, c_current_addr_sk#19010L, c_first_shipto_date_sk#19011L, c_first_sales_date_sk#19012L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :  +- SortMergeJoin [ss_customer_sk#18852L], [c_customer_sk#19006L], Inner
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :- Sort [ss_customer_sk#18852L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :  +- Exchange hashpartitioning(ss_customer_sk#18852L, 3000), ENSURE_REQUIREMENTS, [id=#20494]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :     +- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899, s_store_name#18982, s_zip#19002]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :        +- BroadcastHashJoin [ss_store_sk#18856L], [s_store_sk#18977L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, d_year#18899]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :  +- BroadcastHashJoin [ss_sold_date_sk#18872L], [d_date_sk#18893L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, ss_sold_date_sk#18872L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :  +- BroadcastHashJoin [ss_item_sk#18851L], [cs_item_sk#18803L], Inner, BuildRight, false
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :- Project [ss_item_sk#18851L, ss_customer_sk#18852L, ss_cdemo_sk#18853L, ss_hdemo_sk#18854L, ss_addr_sk#18855L, ss_store_sk#18856L, ss_promo_sk#18857L, ss_wholesale_cost#18860, ss_list_price#18861, ss_coupon_amt#18868, ss_sold_date_sk#18872L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :  +- SortMergeJoin [ss_item_sk#18851L, ss_ticket_number#18858L], [sr_item_sk#18874L, sr_ticket_number#18881L], Inner
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :- Sort [ss_item_sk#18851L ASC NULLS FIRST, ss_ticket_number#18858L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :  +- Exchange hashpartitioning(ss_item_sk#18851L, ss_ticket_number#18858L, 3000), ENSURE_REQUIREMENTS, [id=#20461]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :     +- Filter (((((((isnotnull(ss_item_sk#18851L) AND isnotnull(ss_ticket_number#18858L)) AND isnotnull(ss_store_sk#18856L)) AND isnotnull(ss_customer_sk#18852L)) AND isnotnull(ss_cdemo_sk#18853L)) AND isnotnull(ss_promo_sk#18857L)) AND isnotnull(ss_hdemo_sk#18854L)) AND isnotnull(ss_addr_sk#18855L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#18851L,ss_customer_sk#18852L,ss_cdemo_sk#18853L,ss_hdemo_sk#18854L,ss_addr_sk#18855L,ss_store_sk#18856L,ss_promo_sk#18857L,ss_ticket_number#18858L,ss_wholesale_cost#18860,ss_list_price#18861,ss_coupon_amt#18868,ss_sold_date_sk#18872L] Batched: true, DataFilters: [isnotnull(ss_item_sk#18851L), isnotnull(ss_ticket_number#18858L), isnotnull(ss_store_sk#18856L),..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#18872L), dynamicpruningexpression(ss_sold_date_sk#18872L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_cdemo_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:b...
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#19527, 0, true, Project [d_date_sk#18893L, d_year#18899], [d_date_sk#18893L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                    +- Filter ((isnotnull(d_year#18899) AND (d_year#18899 = 2000)) AND isnotnull(d_date_sk#18893L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18893L,d_year#18899] Batched: true, DataFilters: [isnotnull(d_year#18899), (d_year#18899 = 2000), isnotnull(d_date_sk#18893L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     +- Sort [sr_item_sk#18874L ASC NULLS FIRST, sr_ticket_number#18881L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :        +- Exchange hashpartitioning(sr_item_sk#18874L, sr_ticket_number#18881L, 3000), ENSURE_REQUIREMENTS, [id=#20462]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :           +- Project [sr_item_sk#18874L, sr_ticket_number#18881L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :              +- Filter (isnotnull(sr_item_sk#18874L) AND isnotnull(sr_ticket_number#18881L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#18874L,sr_ticket_number#18881L,sr_returned_date_sk#18892L] Batched: true, DataFilters: [isnotnull(sr_item_sk#18874L), isnotnull(sr_ticket_number#18881L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint>
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20481]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :        +- Project [cs_item_sk#18803L]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :           +- Filter ((isnotnull(sale#18767) AND isnotnull(refund#18768)) AND (sale#18767 > (2.0 * refund#18768)))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :              +- HashAggregate(keys=[cs_item_sk#18803L], functions=[sum(cs_ext_list_price#18813), sum(((cr_refunded_cash#18845 + cr_reversed_charge#18846) + cr_store_credit#18847))], output=[cs_item_sk#18803L, sale#18767, refund#18768])
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                 +- Exchange hashpartitioning(cs_item_sk#18803L, 3000), ENSURE_REQUIREMENTS, [id=#20476]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                    +- HashAggregate(keys=[cs_item_sk#18803L], functions=[partial_sum(cs_ext_list_price#18813), partial_sum(((cr_refunded_cash#18845 + cr_reversed_charge#18846) + cr_store_credit#18847))], output=[cs_item_sk#18803L, sum#19539, sum#19540])
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                       +- Project [cs_item_sk#18803L, cs_ext_list_price#18813, cr_refunded_cash#18845, cr_reversed_charge#18846, cr_store_credit#18847]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                          +- SortMergeJoin [cs_item_sk#18803L, cs_order_number#18805L], [cr_item_sk#18824L, cr_order_number#18838L], Inner
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :- Sort [cs_item_sk#18803L ASC NULLS FIRST, cs_order_number#18805L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :  +- Exchange hashpartitioning(cs_item_sk#18803L, cs_order_number#18805L, 3000), ENSURE_REQUIREMENTS, [id=#20468]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :     +- Project [cs_item_sk#18803L, cs_order_number#18805L, cs_ext_list_price#18813]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :        +- Filter (isnotnull(cs_item_sk#18803L) AND isnotnull(cs_order_number#18805L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#18803L,cs_order_number#18805L,cs_ext_list_price#18813,cs_sold_date_sk#18822L] Batched: true, DataFilters: [isnotnull(cs_item_sk#18803L), isnotnull(cs_order_number#18805L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_order_number)], ReadSchema: struct<cs_item_sk:bigint,cs_order_number:bigint,cs_ext_list_price:double>
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             +- Sort [cr_item_sk#18824L ASC NULLS FIRST, cr_order_number#18838L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                +- Exchange hashpartitioning(cr_item_sk#18824L, cr_order_number#18838L, 3000), ENSURE_REQUIREMENTS, [id=#20469]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                   +- Project [cr_item_sk#18824L, cr_order_number#18838L, cr_refunded_cash#18845, cr_reversed_charge#18846, cr_store_credit#18847]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                      +- Filter (isnotnull(cr_item_sk#18824L) AND isnotnull(cr_order_number#18838L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#18824L,cr_order_number#18838L,cr_refunded_cash#18845,cr_reversed_charge#18846,cr_store_credit#18847,cr_returned_date_sk#18849L] Batched: true, DataFilters: [isnotnull(cr_item_sk#18824L), isnotnull(cr_order_number#18838L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_order_number)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_refunded_cash:double,cr_reversed_charge:double...
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20485]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :        +- Filter ((isnotnull(d_year#18899) AND (d_year#18899 = 2000)) AND isnotnull(d_date_sk#18893L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18893L,d_year#18899] Batched: true, DataFilters: [isnotnull(d_year#18899), (d_year#18899 = 2000), isnotnull(d_date_sk#18893L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20489]
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :              +- Filter ((isnotnull(s_store_sk#18977L) AND isnotnull(s_store_name#18982)) AND isnotnull(s_zip#19002))
            :                    :     :     :     :           :           :     :     :     :           :           :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#18977L,s_store_name#18982,s_zip#19002] Batched: true, DataFilters: [isnotnull(s_store_sk#18977L), isnotnull(s_store_name#18982), isnotnull(s_zip#19002)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_zip:string>
            :                    :     :     :     :           :           :     :     :     :           :           :     :     +- Sort [c_customer_sk#19006L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :           :           :     :        +- Exchange hashpartitioning(c_customer_sk#19006L, 3000), ENSURE_REQUIREMENTS, [id=#20495]
            :                    :     :     :     :           :           :     :     :     :           :           :     :           +- Filter (((((isnotnull(c_customer_sk#19006L) AND isnotnull(c_first_sales_date_sk#19012L)) AND isnotnull(c_first_shipto_date_sk#19011L)) AND isnotnull(c_current_cdemo_sk#19008L)) AND isnotnull(c_current_hdemo_sk#19009L)) AND isnotnull(c_current_addr_sk#19010L))
            :                    :     :     :     :           :           :     :     :     :           :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#19006L,c_current_cdemo_sk#19008L,c_current_hdemo_sk#19009L,c_current_addr_sk#19010L,c_first_shipto_date_sk#19011L,c_first_sales_date_sk#19012L] Batched: true, DataFilters: [isnotnull(c_customer_sk#19006L), isnotnull(c_first_sales_date_sk#19012L), isnotnull(c_first_ship..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_first_sales_date_sk), IsNotNull(c_first_shipto_date_sk), I..., ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_hdemo_sk:bigint,c_current_addr_sk...
            :                    :     :     :     :           :           :     :     :     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20501]
            :                    :     :     :     :           :           :     :     :     :           :           :        +- Filter isnotnull(d_date_sk#18921L)
            :                    :     :     :     :           :           :     :     :     :           :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18921L,d_year#18927] Batched: true, DataFilters: [isnotnull(d_date_sk#18921L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     :     :     :           :           :     :     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20505]
            :                    :     :     :     :           :           :     :     :     :           :              +- Filter isnotnull(d_date_sk#18949L)
            :                    :     :     :     :           :           :     :     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#18949L,d_year#18955] Batched: true, DataFilters: [isnotnull(d_date_sk#18949L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
            :                    :     :     :     :           :           :     :     :     :           +- Sort [cd_demo_sk#19024L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :     :              +- Exchange hashpartitioning(cd_demo_sk#19024L, 3000), ENSURE_REQUIREMENTS, [id=#20511]
            :                    :     :     :     :           :           :     :     :     :                 +- Filter (isnotnull(cd_demo_sk#19024L) AND isnotnull(cd_marital_status#19026))
            :                    :     :     :     :           :           :     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19024L,cd_marital_status#19026] Batched: true, DataFilters: [isnotnull(cd_demo_sk#19024L), isnotnull(cd_marital_status#19026)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string>
            :                    :     :     :     :           :           :     :     :     +- Sort [cd_demo_sk#19033L ASC NULLS FIRST], false, 0
            :                    :     :     :     :           :           :     :     :        +- Exchange hashpartitioning(cd_demo_sk#19033L, 3000), ENSURE_REQUIREMENTS, [id=#20519]
            :                    :     :     :     :           :           :     :     :           +- Filter (isnotnull(cd_demo_sk#19033L) AND isnotnull(cd_marital_status#19035))
            :                    :     :     :     :           :           :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19033L,cd_marital_status#19035] Batched: true, DataFilters: [isnotnull(cd_demo_sk#19033L), isnotnull(cd_marital_status#19035)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string>
            :                    :     :     :     :           :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20525]
            :                    :     :     :     :           :           :     :        +- Filter isnotnull(p_promo_sk#19042L)
            :                    :     :     :     :           :           :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#19042L] Batched: true, DataFilters: [isnotnull(p_promo_sk#19042L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint>
            :                    :     :     :     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20529]
            :                    :     :     :     :           :           :        +- Filter (isnotnull(hd_demo_sk#19061L) AND isnotnull(hd_income_band_sk#19062L))
            :                    :     :     :     :           :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19061L,hd_income_band_sk#19062L] Batched: true, DataFilters: [isnotnull(hd_demo_sk#19061L), isnotnull(hd_income_band_sk#19062L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_income_band_sk:bigint>
            :                    :     :     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20533]
            :                    :     :     :     :           :              +- Filter (isnotnull(hd_demo_sk#19066L) AND isnotnull(hd_income_band_sk#19067L))
            :                    :     :     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19066L,hd_income_band_sk#19067L] Batched: true, DataFilters: [isnotnull(hd_demo_sk#19066L), isnotnull(hd_income_band_sk#19067L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_income_band_sk:bigint>
            :                    :     :     :     :           +- Sort [ca_address_sk#19071L ASC NULLS FIRST], false, 0
            :                    :     :     :     :              +- Exchange hashpartitioning(ca_address_sk#19071L, 3000), ENSURE_REQUIREMENTS, [id=#20539]
            :                    :     :     :     :                 +- Filter isnotnull(ca_address_sk#19071L)
            :                    :     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19071L,ca_street_number#19073,ca_street_name#19074,ca_city#19077,ca_zip#19080] Batched: true, DataFilters: [isnotnull(ca_address_sk#19071L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_street_number:string,ca_street_name:string,ca_city:string,ca_zip:s...
            :                    :     :     :     +- Sort [ca_address_sk#19084L ASC NULLS FIRST], false, 0
            :                    :     :     :        +- Exchange hashpartitioning(ca_address_sk#19084L, 3000), ENSURE_REQUIREMENTS, [id=#20547]
            :                    :     :     :           +- Filter isnotnull(ca_address_sk#19084L)
            :                    :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19084L,ca_street_number#19086,ca_street_name#19087,ca_city#19090,ca_zip#19093] Batched: true, DataFilters: [isnotnull(ca_address_sk#19084L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_street_number:string,ca_street_name:string,ca_city:string,ca_zip:s...
            :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20553]
            :                    :     :        +- Filter isnotnull(ib_income_band_sk#19097L)
            :                    :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19097L] Batched: true, DataFilters: [isnotnull(ib_income_band_sk#19097L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ib_income_band_sk)], ReadSchema: struct<ib_income_band_sk:bigint>
            :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20557]
            :                    :        +- Filter isnotnull(ib_income_band_sk#19100L)
            :                    :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19100L] Batched: true, DataFilters: [isnotnull(ib_income_band_sk#19100L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ib_income_band_sk)], ReadSchema: struct<ib_income_band_sk:bigint>
            :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20561]
            :                       +- Project [i_item_sk#19103L, i_product_name#19124]
            :                          +- Filter ((((((isnotnull(i_current_price#19108) AND i_color#19120 IN (maroon,burnished,dim,steel,navajo,chocolate)) AND (i_current_price#19108 >= 35.0)) AND (i_current_price#19108 <= 45.0)) AND (i_current_price#19108 >= 36.0)) AND (i_current_price#19108 <= 50.0)) AND isnotnull(i_item_sk#19103L))
            :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19103L,i_current_price#19108,i_color#19120,i_product_name#19124] Batched: true, DataFilters: [isnotnull(i_current_price#19108), i_color#19120 IN (maroon,burnished,dim,steel,navajo,chocolate)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), In(i_color, [burnished,chocolate,dim,maroon,navajo,steel]), GreaterT..., ReadSchema: struct<i_item_sk:bigint,i_current_price:double,i_color:string,i_product_name:string>
            +- Sort [item_sk#19133L ASC NULLS FIRST, store_name#19134 ASC NULLS FIRST, store_zip#19135 ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(item_sk#19133L, store_name#19134, store_zip#19135, 3000), ENSURE_REQUIREMENTS, [id=#20679]
                  +- HashAggregate(keys=[i_product_name#19507, i_item_sk#19486L, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, d_year#19282, d_year#19310, d_year#19338], functions=[count(1), sum(ss_wholesale_cost#19182), sum(ss_list_price#19183), sum(ss_coupon_amt#19190)], output=[item_sk#19133L, store_name#19134, store_zip#19135, syear#19144, cnt#19147L, s1#19148, s2#19149, s3#19150])
                     +- Exchange hashpartitioning(i_product_name#19507, i_item_sk#19486L, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, d_year#19282, d_year#19310, d_year#19338, 3000), ENSURE_REQUIREMENTS, [id=#20674]
                        +- HashAggregate(keys=[i_product_name#19507, i_item_sk#19486L, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, d_year#19282, d_year#19310, d_year#19338], functions=[partial_count(1), partial_sum(ss_wholesale_cost#19182), partial_sum(ss_list_price#19183), partial_sum(ss_coupon_amt#19190)], output=[i_product_name#19507, i_item_sk#19486L, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, d_year#19282, d_year#19310, d_year#19338, count#19533L, sum#19544, sum#19545, sum#19546])
                           +- Project [ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, d_year#19310, d_year#19338, s_store_name#19365, s_zip#19385, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476, i_item_sk#19486L, i_product_name#19507]
                              +- BroadcastHashJoin [ss_item_sk#19173L], [i_item_sk#19486L], Inner, BuildRight, false
                                 :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
                                 :  +- BroadcastHashJoin [hd_income_band_sk#19450L], [ib_income_band_sk#19483L], Inner, BuildRight, false
                                 :     :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
                                 :     :  +- BroadcastHashJoin [hd_income_band_sk#19445L], [ib_income_band_sk#19480L], Inner, BuildRight, false
                                 :     :     :- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463, ca_street_number#19469, ca_street_name#19470, ca_city#19473, ca_zip#19476]
                                 :     :     :  +- SortMergeJoin [c_current_addr_sk#19393L], [ca_address_sk#19467L], Inner
                                 :     :     :     :- Sort [c_current_addr_sk#19393L ASC NULLS FIRST], false, 0
                                 :     :     :     :  +- Exchange hashpartitioning(c_current_addr_sk#19393L, 3000), ENSURE_REQUIREMENTS, [id=#20654]
                                 :     :     :     :     +- Project [ss_item_sk#19173L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L, ca_street_number#19456, ca_street_name#19457, ca_city#19460, ca_zip#19463]
                                 :     :     :     :        +- SortMergeJoin [ss_addr_sk#19177L], [ca_address_sk#19454L], Inner
                                 :     :     :     :           :- Sort [ss_addr_sk#19177L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :  +- Exchange hashpartitioning(ss_addr_sk#19177L, 3000), ENSURE_REQUIREMENTS, [id=#20646]
                                 :     :     :     :           :     +- Project [ss_item_sk#19173L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L, hd_income_band_sk#19450L]
                                 :     :     :     :           :        +- BroadcastHashJoin [c_current_hdemo_sk#19392L], [hd_demo_sk#19449L], Inner, BuildRight, false
                                 :     :     :     :           :           :- Project [ss_item_sk#19173L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338, hd_income_band_sk#19445L]
                                 :     :     :     :           :           :  +- BroadcastHashJoin [ss_hdemo_sk#19176L], [hd_demo_sk#19444L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
                                 :     :     :     :           :           :     :  +- BroadcastHashJoin [ss_promo_sk#19179L], [p_promo_sk#19425L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
                                 :     :     :     :           :           :     :     :  +- SortMergeJoin [c_current_cdemo_sk#19391L], [cd_demo_sk#19416L], Inner, NOT (cd_marital_status#19409 = cd_marital_status#19418)
                                 :     :     :     :           :           :     :     :     :- Sort [c_current_cdemo_sk#19391L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :  +- Exchange hashpartitioning(c_current_cdemo_sk#19391L, 3000), ENSURE_REQUIREMENTS, [id=#20626]
                                 :     :     :     :           :           :     :     :     :     +- Project [ss_item_sk#19173L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338, cd_marital_status#19409]
                                 :     :     :     :           :           :     :     :     :        +- SortMergeJoin [ss_cdemo_sk#19175L], [cd_demo_sk#19407L], Inner
                                 :     :     :     :           :           :     :     :     :           :- Sort [ss_cdemo_sk#19175L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :  +- Exchange hashpartitioning(ss_cdemo_sk#19175L, 3000), ENSURE_REQUIREMENTS, [id=#20618]
                                 :     :     :     :           :           :     :     :     :           :     +- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, d_year#19310, d_year#19338]
                                 :     :     :     :           :           :     :     :     :           :        +- BroadcastHashJoin [c_first_shipto_date_sk#19394L], [d_date_sk#19332L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :     :           :           :- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, c_first_shipto_date_sk#19394L, d_year#19310]
                                 :     :     :     :           :           :     :     :     :           :           :  +- BroadcastHashJoin [c_first_sales_date_sk#19395L], [d_date_sk#19304L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :     :           :           :     :- Project [ss_item_sk#19173L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385, c_current_cdemo_sk#19391L, c_current_hdemo_sk#19392L, c_current_addr_sk#19393L, c_first_shipto_date_sk#19394L, c_first_sales_date_sk#19395L]
                                 :     :     :     :           :           :     :     :     :           :           :     :  +- SortMergeJoin [ss_customer_sk#19174L], [c_customer_sk#19389L], Inner
                                 :     :     :     :           :           :     :     :     :           :           :     :     :- Sort [ss_customer_sk#19174L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :     :  +- Exchange hashpartitioning(ss_customer_sk#19174L, 3000), ENSURE_REQUIREMENTS, [id=#20602]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :     +- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282, s_store_name#19365, s_zip#19385]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :        +- BroadcastHashJoin [ss_store_sk#19178L], [s_store_sk#19360L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, d_year#19282]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :  +- BroadcastHashJoin [ss_sold_date_sk#19194L], [d_date_sk#19276L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, ss_sold_date_sk#19194L]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :  +- BroadcastHashJoin [ss_item_sk#19173L], [cs_item_sk#19229L], Inner, BuildRight, false
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :- Project [ss_item_sk#19173L, ss_customer_sk#19174L, ss_cdemo_sk#19175L, ss_hdemo_sk#19176L, ss_addr_sk#19177L, ss_store_sk#19178L, ss_promo_sk#19179L, ss_wholesale_cost#19182, ss_list_price#19183, ss_coupon_amt#19190, ss_sold_date_sk#19194L]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :  +- SortMergeJoin [ss_item_sk#19173L, ss_ticket_number#19180L], [sr_item_sk#19196L, sr_ticket_number#19203L], Inner
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :- Sort [ss_item_sk#19173L ASC NULLS FIRST, ss_ticket_number#19180L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :  +- Exchange hashpartitioning(ss_item_sk#19173L, ss_ticket_number#19180L, 3000), ENSURE_REQUIREMENTS, [id=#20569]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :     +- Filter (((((((isnotnull(ss_item_sk#19173L) AND isnotnull(ss_ticket_number#19180L)) AND isnotnull(ss_store_sk#19178L)) AND isnotnull(ss_customer_sk#19174L)) AND isnotnull(ss_cdemo_sk#19175L)) AND isnotnull(ss_promo_sk#19179L)) AND isnotnull(ss_hdemo_sk#19176L)) AND isnotnull(ss_addr_sk#19177L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#19173L,ss_customer_sk#19174L,ss_cdemo_sk#19175L,ss_hdemo_sk#19176L,ss_addr_sk#19177L,ss_store_sk#19178L,ss_promo_sk#19179L,ss_ticket_number#19180L,ss_wholesale_cost#19182,ss_list_price#19183,ss_coupon_amt#19190,ss_sold_date_sk#19194L] Batched: true, DataFilters: [isnotnull(ss_item_sk#19173L), isnotnull(ss_ticket_number#19180L), isnotnull(ss_store_sk#19178L),..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#19194L), dynamicpruningexpression(ss_sold_date_sk#19194L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_cdemo_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:b...
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#19528, 0, true, Project [d_date_sk#19276L, d_year#19282], [d_date_sk#19276L]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                    +- Filter ((isnotnull(d_year#19282) AND (d_year#19282 = 2001)) AND isnotnull(d_date_sk#19276L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19276L,d_year#19282] Batched: true, DataFilters: [isnotnull(d_year#19282), (d_year#19282 = 2001), isnotnull(d_date_sk#19276L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :     +- Sort [sr_item_sk#19196L ASC NULLS FIRST, sr_ticket_number#19203L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :        +- Exchange hashpartitioning(sr_item_sk#19196L, sr_ticket_number#19203L, 3000), ENSURE_REQUIREMENTS, [id=#20570]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :           +- Project [sr_item_sk#19196L, sr_ticket_number#19203L]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :              +- Filter (isnotnull(sr_item_sk#19196L) AND isnotnull(sr_ticket_number#19203L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#19196L,sr_ticket_number#19203L,sr_returned_date_sk#19214L] Batched: true, DataFilters: [isnotnull(sr_item_sk#19196L), isnotnull(sr_ticket_number#19203L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint>
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20589]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :        +- Project [cs_item_sk#19229L]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :           +- Filter ((isnotnull(sale#18767) AND isnotnull(refund#18768)) AND (sale#18767 > (2.0 * refund#18768)))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :              +- HashAggregate(keys=[cs_item_sk#19229L], functions=[sum(cs_ext_list_price#19239), sum(((cr_refunded_cash#19271 + cr_reversed_charge#19272) + cr_store_credit#19273))], output=[cs_item_sk#19229L, sale#18767, refund#18768])
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                 +- Exchange hashpartitioning(cs_item_sk#19229L, 3000), ENSURE_REQUIREMENTS, [id=#20584]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                    +- HashAggregate(keys=[cs_item_sk#19229L], functions=[partial_sum(cs_ext_list_price#19239), partial_sum(((cr_refunded_cash#19271 + cr_reversed_charge#19272) + cr_store_credit#19273))], output=[cs_item_sk#19229L, sum#19549, sum#19550])
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                       +- Project [cs_item_sk#19229L, cs_ext_list_price#19239, cr_refunded_cash#19271, cr_reversed_charge#19272, cr_store_credit#19273]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                          +- SortMergeJoin [cs_item_sk#19229L, cs_order_number#19231L], [cr_item_sk#19250L, cr_order_number#19264L], Inner
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :- Sort [cs_item_sk#19229L ASC NULLS FIRST, cs_order_number#19231L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :  +- Exchange hashpartitioning(cs_item_sk#19229L, cs_order_number#19231L, 3000), ENSURE_REQUIREMENTS, [id=#20576]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :     +- Project [cs_item_sk#19229L, cs_order_number#19231L, cs_ext_list_price#19239]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :        +- Filter (isnotnull(cs_item_sk#19229L) AND isnotnull(cs_order_number#19231L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#19229L,cs_order_number#19231L,cs_ext_list_price#19239,cs_sold_date_sk#19248L] Batched: true, DataFilters: [isnotnull(cs_item_sk#19229L), isnotnull(cs_order_number#19231L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_order_number)], ReadSchema: struct<cs_item_sk:bigint,cs_order_number:bigint,cs_ext_list_price:double>
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                             +- Sort [cr_item_sk#19250L ASC NULLS FIRST, cr_order_number#19264L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                +- Exchange hashpartitioning(cr_item_sk#19250L, cr_order_number#19264L, 3000), ENSURE_REQUIREMENTS, [id=#20577]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                   +- Project [cr_item_sk#19250L, cr_order_number#19264L, cr_refunded_cash#19271, cr_reversed_charge#19272, cr_store_credit#19273]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                      +- Filter (isnotnull(cr_item_sk#19250L) AND isnotnull(cr_order_number#19264L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#19250L,cr_order_number#19264L,cr_refunded_cash#19271,cr_reversed_charge#19272,cr_store_credit#19273,cr_returned_date_sk#19275L] Batched: true, DataFilters: [isnotnull(cr_item_sk#19250L), isnotnull(cr_order_number#19264L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_order_number)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_refunded_cash:double,cr_reversed_charge:double...
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20593]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :        +- Filter ((isnotnull(d_year#19282) AND (d_year#19282 = 2001)) AND isnotnull(d_date_sk#19276L))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19276L,d_year#19282] Batched: true, DataFilters: [isnotnull(d_year#19282), (d_year#19282 = 2001), isnotnull(d_date_sk#19276L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :     :     :     :           :           :     :     :     :           :           :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20597]
                                 :     :     :     :           :           :     :     :     :           :           :     :     :              +- Filter ((isnotnull(s_store_sk#19360L) AND isnotnull(s_store_name#19365)) AND isnotnull(s_zip#19385))
                                 :     :     :     :           :           :     :     :     :           :           :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#19360L,s_store_name#19365,s_zip#19385] Batched: true, DataFilters: [isnotnull(s_store_sk#19360L), isnotnull(s_store_name#19365), isnotnull(s_zip#19385)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_zip:string>
                                 :     :     :     :           :           :     :     :     :           :           :     :     +- Sort [c_customer_sk#19389L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :           :           :     :        +- Exchange hashpartitioning(c_customer_sk#19389L, 3000), ENSURE_REQUIREMENTS, [id=#20603]
                                 :     :     :     :           :           :     :     :     :           :           :     :           +- Filter (((((isnotnull(c_customer_sk#19389L) AND isnotnull(c_first_sales_date_sk#19395L)) AND isnotnull(c_first_shipto_date_sk#19394L)) AND isnotnull(c_current_cdemo_sk#19391L)) AND isnotnull(c_current_hdemo_sk#19392L)) AND isnotnull(c_current_addr_sk#19393L))
                                 :     :     :     :           :           :     :     :     :           :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#19389L,c_current_cdemo_sk#19391L,c_current_hdemo_sk#19392L,c_current_addr_sk#19393L,c_first_shipto_date_sk#19394L,c_first_sales_date_sk#19395L] Batched: true, DataFilters: [isnotnull(c_customer_sk#19389L), isnotnull(c_first_sales_date_sk#19395L), isnotnull(c_first_ship..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_first_sales_date_sk), IsNotNull(c_first_shipto_date_sk), I..., ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_hdemo_sk:bigint,c_current_addr_sk...
                                 :     :     :     :           :           :     :     :     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20609]
                                 :     :     :     :           :           :     :     :     :           :           :        +- Filter isnotnull(d_date_sk#19304L)
                                 :     :     :     :           :           :     :     :     :           :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19304L,d_year#19310] Batched: true, DataFilters: [isnotnull(d_date_sk#19304L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :     :     :     :           :           :     :     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20613]
                                 :     :     :     :           :           :     :     :     :           :              +- Filter isnotnull(d_date_sk#19332L)
                                 :     :     :     :           :           :     :     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19332L,d_year#19338] Batched: true, DataFilters: [isnotnull(d_date_sk#19332L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                 :     :     :     :           :           :     :     :     :           +- Sort [cd_demo_sk#19407L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :     :              +- Exchange hashpartitioning(cd_demo_sk#19407L, 3000), ENSURE_REQUIREMENTS, [id=#20619]
                                 :     :     :     :           :           :     :     :     :                 +- Filter (isnotnull(cd_demo_sk#19407L) AND isnotnull(cd_marital_status#19409))
                                 :     :     :     :           :           :     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19407L,cd_marital_status#19409] Batched: true, DataFilters: [isnotnull(cd_demo_sk#19407L), isnotnull(cd_marital_status#19409)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string>
                                 :     :     :     :           :           :     :     :     +- Sort [cd_demo_sk#19416L ASC NULLS FIRST], false, 0
                                 :     :     :     :           :           :     :     :        +- Exchange hashpartitioning(cd_demo_sk#19416L, 3000), ENSURE_REQUIREMENTS, [id=#20627]
                                 :     :     :     :           :           :     :     :           +- Filter (isnotnull(cd_demo_sk#19416L) AND isnotnull(cd_marital_status#19418))
                                 :     :     :     :           :           :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#19416L,cd_marital_status#19418] Batched: true, DataFilters: [isnotnull(cd_demo_sk#19416L), isnotnull(cd_marital_status#19418)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string>
                                 :     :     :     :           :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20633]
                                 :     :     :     :           :           :     :        +- Filter isnotnull(p_promo_sk#19425L)
                                 :     :     :     :           :           :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#19425L] Batched: true, DataFilters: [isnotnull(p_promo_sk#19425L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint>
                                 :     :     :     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20637]
                                 :     :     :     :           :           :        +- Filter (isnotnull(hd_demo_sk#19444L) AND isnotnull(hd_income_band_sk#19445L))
                                 :     :     :     :           :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19444L,hd_income_band_sk#19445L] Batched: true, DataFilters: [isnotnull(hd_demo_sk#19444L), isnotnull(hd_income_band_sk#19445L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_income_band_sk:bigint>
                                 :     :     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20641]
                                 :     :     :     :           :              +- Filter (isnotnull(hd_demo_sk#19449L) AND isnotnull(hd_income_band_sk#19450L))
                                 :     :     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#19449L,hd_income_band_sk#19450L] Batched: true, DataFilters: [isnotnull(hd_demo_sk#19449L), isnotnull(hd_income_band_sk#19450L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_income_band_sk:bigint>
                                 :     :     :     :           +- Sort [ca_address_sk#19454L ASC NULLS FIRST], false, 0
                                 :     :     :     :              +- Exchange hashpartitioning(ca_address_sk#19454L, 3000), ENSURE_REQUIREMENTS, [id=#20647]
                                 :     :     :     :                 +- Filter isnotnull(ca_address_sk#19454L)
                                 :     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19454L,ca_street_number#19456,ca_street_name#19457,ca_city#19460,ca_zip#19463] Batched: true, DataFilters: [isnotnull(ca_address_sk#19454L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_street_number:string,ca_street_name:string,ca_city:string,ca_zip:s...
                                 :     :     :     +- Sort [ca_address_sk#19467L ASC NULLS FIRST], false, 0
                                 :     :     :        +- Exchange hashpartitioning(ca_address_sk#19467L, 3000), ENSURE_REQUIREMENTS, [id=#20655]
                                 :     :     :           +- Filter isnotnull(ca_address_sk#19467L)
                                 :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#19467L,ca_street_number#19469,ca_street_name#19470,ca_city#19473,ca_zip#19476] Batched: true, DataFilters: [isnotnull(ca_address_sk#19467L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_street_number:string,ca_street_name:string,ca_city:string,ca_zip:s...
                                 :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20661]
                                 :     :        +- Filter isnotnull(ib_income_band_sk#19480L)
                                 :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19480L] Batched: true, DataFilters: [isnotnull(ib_income_band_sk#19480L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ib_income_band_sk)], ReadSchema: struct<ib_income_band_sk:bigint>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20665]
                                 :        +- Filter isnotnull(ib_income_band_sk#19483L)
                                 :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#19483L] Batched: true, DataFilters: [isnotnull(ib_income_band_sk#19483L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ib_income_band_sk)], ReadSchema: struct<ib_income_band_sk:bigint>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20669]
                                    +- Project [i_item_sk#19486L, i_product_name#19507]
                                       +- Filter ((((((isnotnull(i_current_price#19491) AND i_color#19503 IN (maroon,burnished,dim,steel,navajo,chocolate)) AND (i_current_price#19491 >= 35.0)) AND (i_current_price#19491 <= 45.0)) AND (i_current_price#19491 >= 36.0)) AND (i_current_price#19491 <= 50.0)) AND isnotnull(i_item_sk#19486L))
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19486L,i_current_price#19491,i_color#19503,i_product_name#19507] Batched: true, DataFilters: [isnotnull(i_current_price#19491), i_color#19503 IN (maroon,burnished,dim,steel,navajo,chocolate)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), In(i_color, [burnished,chocolate,dim,maroon,navajo,steel]), GreaterT..., ReadSchema: struct<i_item_sk:bigint,i_current_price:double,i_color:string,i_product_name:string>

read query: spark_queries/q65.sql
explain query: q65
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['s_store_name ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST], true
      +- 'Project ['s_store_name, 'i_item_desc, 'sc.revenue, 'i_current_price, 'i_wholesale_cost, 'i_brand]
         +- 'Filter ((('sb.ss_store_sk = 'sc.ss_store_sk) AND ('sc.revenue <= (0.1 * 'sb.ave))) AND (('s_store_sk = 'sc.ss_store_sk) AND ('i_item_sk = 'sc.ss_item_sk)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [store], [], false
               :  :  +- 'UnresolvedRelation [item], [], false
               :  +- 'SubqueryAlias sb
               :     +- 'Aggregate ['ss_store_sk], ['ss_store_sk, 'avg('revenue) AS ave#19552]
               :        +- 'SubqueryAlias sa
               :           +- 'Aggregate ['ss_store_sk, 'ss_item_sk], ['ss_store_sk, 'ss_item_sk, 'sum('ss_sales_price) AS revenue#19551]
               :              +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
               :                 +- 'Join Inner
               :                    :- 'UnresolvedRelation [store_sales], [], false
               :                    +- 'UnresolvedRelation [date_dim], [], false
               +- 'SubqueryAlias sc
                  +- 'Aggregate ['ss_store_sk, 'ss_item_sk], ['ss_store_sk, 'ss_item_sk, 'sum('ss_sales_price) AS revenue#19553]
                     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
                        +- 'Join Inner
                           :- 'UnresolvedRelation [store_sales], [], false
                           +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
s_store_name: string, i_item_desc: string, revenue: double, i_current_price: double, i_wholesale_cost: double, i_brand: string
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#19559 ASC NULLS FIRST, i_item_desc#19587 ASC NULLS FIRST], true
      +- Project [s_store_name#19559, i_item_desc#19587, revenue#19553, i_current_price#19588, i_wholesale_cost#19589, i_brand#19591]
         +- Filter (((ss_store_sk#19611L = ss_store_sk#19662L) AND (revenue#19553 <= (cast(0.1 as double) * ave#19552))) AND ((s_store_sk#19554L = ss_store_sk#19662L) AND (i_item_sk#19583L = ss_item_sk#19657L)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#19554L,s_store_id#19555,s_rec_start_date#19556,s_rec_end_date#19557,s_closed_date_sk#19558L,s_store_name#19559,s_number_employees#19560,s_floor_space#19561,s_hours#19562,s_manager#19563,s_market_id#19564,s_geography_class#19565,s_market_desc#19566,s_market_manager#19567,s_division_id#19568,s_division_name#19569,s_company_id#19570,s_company_name#19571,s_street_number#19572,s_street_name#19573,s_street_type#19574,s_suite_number#19575,s_city#19576,s_county#19577,... 5 more fields] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19583L,i_item_id#19584,i_rec_start_date#19585,i_rec_end_date#19586,i_item_desc#19587,i_current_price#19588,i_wholesale_cost#19589,i_brand_id#19590,i_brand#19591,i_class_id#19592,i_class#19593,i_category_id#19594,i_category#19595,i_manufact_id#19596,i_manufact#19597,i_size#19598,i_formulation#19599,i_color#19600,i_units#19601,i_container#19602,i_manager_id#19603,i_product_name#19604] orc
               :  +- SubqueryAlias sb
               :     +- Aggregate [ss_store_sk#19611L], [ss_store_sk#19611L, avg(revenue#19551) AS ave#19552]
               :        +- SubqueryAlias sa
               :           +- Aggregate [ss_store_sk#19611L, ss_item_sk#19606L], [ss_store_sk#19611L, ss_item_sk#19606L, sum(ss_sales_price#19617) AS revenue#19551]
               :              +- Filter ((ss_sold_date_sk#19627L = d_date_sk#19628L) AND ((d_month_seq#19631 >= 1212) AND (d_month_seq#19631 <= (1212 + 11))))
               :                 +- Join Inner
               :                    :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :                    :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#19605L,ss_item_sk#19606L,ss_customer_sk#19607L,ss_cdemo_sk#19608L,ss_hdemo_sk#19609L,ss_addr_sk#19610L,ss_store_sk#19611L,ss_promo_sk#19612L,ss_ticket_number#19613L,ss_quantity#19614,ss_wholesale_cost#19615,ss_list_price#19616,ss_sales_price#19617,ss_ext_discount_amt#19618,ss_ext_sales_price#19619,ss_ext_wholesale_cost#19620,ss_ext_list_price#19621,ss_ext_tax#19622,ss_coupon_amt#19623,ss_net_paid#19624,ss_net_paid_inc_tax#19625,ss_net_profit#19626,ss_sold_date_sk#19627L] orc
               :                    +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19628L,d_date_id#19629,d_date#19630,d_month_seq#19631,d_week_seq#19632,d_quarter_seq#19633,d_year#19634,d_dow#19635,d_moy#19636,d_dom#19637,d_qoy#19638,d_fy_year#19639,d_fy_quarter_seq#19640,d_fy_week_seq#19641,d_day_name#19642,d_quarter_name#19643,d_holiday#19644,d_weekend#19645,d_following_holiday#19646,d_first_dom#19647,d_last_dom#19648,d_same_day_ly#19649,d_same_day_lq#19650,d_current_day#19651,... 4 more fields] orc
               +- SubqueryAlias sc
                  +- Aggregate [ss_store_sk#19662L, ss_item_sk#19657L], [ss_store_sk#19662L, ss_item_sk#19657L, sum(ss_sales_price#19668) AS revenue#19553]
                     +- Filter ((ss_sold_date_sk#19678L = d_date_sk#19679L) AND ((d_month_seq#19682 >= 1212) AND (d_month_seq#19682 <= (1212 + 11))))
                        +- Join Inner
                           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#19656L,ss_item_sk#19657L,ss_customer_sk#19658L,ss_cdemo_sk#19659L,ss_hdemo_sk#19660L,ss_addr_sk#19661L,ss_store_sk#19662L,ss_promo_sk#19663L,ss_ticket_number#19664L,ss_quantity#19665,ss_wholesale_cost#19666,ss_list_price#19667,ss_sales_price#19668,ss_ext_discount_amt#19669,ss_ext_sales_price#19670,ss_ext_wholesale_cost#19671,ss_ext_list_price#19672,ss_ext_tax#19673,ss_coupon_amt#19674,ss_net_paid#19675,ss_net_paid_inc_tax#19676,ss_net_profit#19677,ss_sold_date_sk#19678L] orc
                           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19679L,d_date_id#19680,d_date#19681,d_month_seq#19682,d_week_seq#19683,d_quarter_seq#19684,d_year#19685,d_dow#19686,d_moy#19687,d_dom#19688,d_qoy#19689,d_fy_year#19690,d_fy_quarter_seq#19691,d_fy_week_seq#19692,d_day_name#19693,d_quarter_name#19694,d_holiday#19695,d_weekend#19696,d_following_holiday#19697,d_first_dom#19698,d_last_dom#19699,d_same_day_ly#19700,d_same_day_lq#19701,d_current_day#19702,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name#19559 ASC NULLS FIRST, i_item_desc#19587 ASC NULLS FIRST], true
      +- Project [s_store_name#19559, i_item_desc#19587, revenue#19553, i_current_price#19588, i_wholesale_cost#19589, i_brand#19591]
         +- Join Inner, (i_item_sk#19583L = ss_item_sk#19657L)
            :- Project [ss_item_sk#19657L, revenue#19553, s_store_name#19559]
            :  +- Join Inner, (s_store_sk#19554L = ss_store_sk#19662L)
            :     :- Project [ss_store_sk#19662L, ss_item_sk#19657L, revenue#19553]
            :     :  +- Join Inner, ((ss_store_sk#19611L = ss_store_sk#19662L) AND (revenue#19553 <= (0.1 * ave#19552)))
            :     :     :- Filter isnotnull(revenue#19553)
            :     :     :  +- Aggregate [ss_store_sk#19662L, ss_item_sk#19657L], [ss_store_sk#19662L, ss_item_sk#19657L, sum(ss_sales_price#19668) AS revenue#19553]
            :     :     :     +- Project [ss_item_sk#19657L, ss_store_sk#19662L, ss_sales_price#19668]
            :     :     :        +- Join Inner, (ss_sold_date_sk#19678L = d_date_sk#19679L)
            :     :     :           :- Project [ss_item_sk#19657L, ss_store_sk#19662L, ss_sales_price#19668, ss_sold_date_sk#19678L]
            :     :     :           :  +- Filter (((isnotnull(ss_sold_date_sk#19678L) AND isnotnull(ss_store_sk#19662L)) AND isnotnull(ss_item_sk#19657L)) AND dynamicpruning#19716 [ss_sold_date_sk#19678L])
            :     :     :           :     :  +- Project [d_date_sk#19679L]
            :     :     :           :     :     +- Filter ((isnotnull(d_month_seq#19682) AND ((d_month_seq#19682 >= 1212) AND (d_month_seq#19682 <= 1223))) AND isnotnull(d_date_sk#19679L))
            :     :     :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19679L,d_date_id#19680,d_date#19681,d_month_seq#19682,d_week_seq#19683,d_quarter_seq#19684,d_year#19685,d_dow#19686,d_moy#19687,d_dom#19688,d_qoy#19689,d_fy_year#19690,d_fy_quarter_seq#19691,d_fy_week_seq#19692,d_day_name#19693,d_quarter_name#19694,d_holiday#19695,d_weekend#19696,d_following_holiday#19697,d_first_dom#19698,d_last_dom#19699,d_same_day_ly#19700,d_same_day_lq#19701,d_current_day#19702,... 4 more fields] orc
            :     :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#19656L,ss_item_sk#19657L,ss_customer_sk#19658L,ss_cdemo_sk#19659L,ss_hdemo_sk#19660L,ss_addr_sk#19661L,ss_store_sk#19662L,ss_promo_sk#19663L,ss_ticket_number#19664L,ss_quantity#19665,ss_wholesale_cost#19666,ss_list_price#19667,ss_sales_price#19668,ss_ext_discount_amt#19669,ss_ext_sales_price#19670,ss_ext_wholesale_cost#19671,ss_ext_list_price#19672,ss_ext_tax#19673,ss_coupon_amt#19674,ss_net_paid#19675,ss_net_paid_inc_tax#19676,ss_net_profit#19677,ss_sold_date_sk#19678L] orc
            :     :     :           +- Project [d_date_sk#19679L]
            :     :     :              +- Filter ((isnotnull(d_month_seq#19682) AND ((d_month_seq#19682 >= 1212) AND (d_month_seq#19682 <= 1223))) AND isnotnull(d_date_sk#19679L))
            :     :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19679L,d_date_id#19680,d_date#19681,d_month_seq#19682,d_week_seq#19683,d_quarter_seq#19684,d_year#19685,d_dow#19686,d_moy#19687,d_dom#19688,d_qoy#19689,d_fy_year#19690,d_fy_quarter_seq#19691,d_fy_week_seq#19692,d_day_name#19693,d_quarter_name#19694,d_holiday#19695,d_weekend#19696,d_following_holiday#19697,d_first_dom#19698,d_last_dom#19699,d_same_day_ly#19700,d_same_day_lq#19701,d_current_day#19702,... 4 more fields] orc
            :     :     +- Filter isnotnull(ave#19552)
            :     :        +- Aggregate [ss_store_sk#19611L], [ss_store_sk#19611L, avg(revenue#19551) AS ave#19552]
            :     :           +- Aggregate [ss_store_sk#19611L, ss_item_sk#19606L], [ss_store_sk#19611L, sum(ss_sales_price#19617) AS revenue#19551]
            :     :              +- Project [ss_item_sk#19606L, ss_store_sk#19611L, ss_sales_price#19617]
            :     :                 +- Join Inner, (ss_sold_date_sk#19627L = d_date_sk#19628L)
            :     :                    :- Project [ss_item_sk#19606L, ss_store_sk#19611L, ss_sales_price#19617, ss_sold_date_sk#19627L]
            :     :                    :  +- Filter ((isnotnull(ss_sold_date_sk#19627L) AND isnotnull(ss_store_sk#19611L)) AND dynamicpruning#19717 [ss_sold_date_sk#19627L])
            :     :                    :     :  +- Project [d_date_sk#19628L]
            :     :                    :     :     +- Filter ((isnotnull(d_month_seq#19631) AND ((d_month_seq#19631 >= 1212) AND (d_month_seq#19631 <= 1223))) AND isnotnull(d_date_sk#19628L))
            :     :                    :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19628L,d_date_id#19629,d_date#19630,d_month_seq#19631,d_week_seq#19632,d_quarter_seq#19633,d_year#19634,d_dow#19635,d_moy#19636,d_dom#19637,d_qoy#19638,d_fy_year#19639,d_fy_quarter_seq#19640,d_fy_week_seq#19641,d_day_name#19642,d_quarter_name#19643,d_holiday#19644,d_weekend#19645,d_following_holiday#19646,d_first_dom#19647,d_last_dom#19648,d_same_day_ly#19649,d_same_day_lq#19650,d_current_day#19651,... 4 more fields] orc
            :     :                    :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#19605L,ss_item_sk#19606L,ss_customer_sk#19607L,ss_cdemo_sk#19608L,ss_hdemo_sk#19609L,ss_addr_sk#19610L,ss_store_sk#19611L,ss_promo_sk#19612L,ss_ticket_number#19613L,ss_quantity#19614,ss_wholesale_cost#19615,ss_list_price#19616,ss_sales_price#19617,ss_ext_discount_amt#19618,ss_ext_sales_price#19619,ss_ext_wholesale_cost#19620,ss_ext_list_price#19621,ss_ext_tax#19622,ss_coupon_amt#19623,ss_net_paid#19624,ss_net_paid_inc_tax#19625,ss_net_profit#19626,ss_sold_date_sk#19627L] orc
            :     :                    +- Project [d_date_sk#19628L]
            :     :                       +- Filter ((isnotnull(d_month_seq#19631) AND ((d_month_seq#19631 >= 1212) AND (d_month_seq#19631 <= 1223))) AND isnotnull(d_date_sk#19628L))
            :     :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19628L,d_date_id#19629,d_date#19630,d_month_seq#19631,d_week_seq#19632,d_quarter_seq#19633,d_year#19634,d_dow#19635,d_moy#19636,d_dom#19637,d_qoy#19638,d_fy_year#19639,d_fy_quarter_seq#19640,d_fy_week_seq#19641,d_day_name#19642,d_quarter_name#19643,d_holiday#19644,d_weekend#19645,d_following_holiday#19646,d_first_dom#19647,d_last_dom#19648,d_same_day_ly#19649,d_same_day_lq#19650,d_current_day#19651,... 4 more fields] orc
            :     +- Project [s_store_sk#19554L, s_store_name#19559]
            :        +- Filter isnotnull(s_store_sk#19554L)
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#19554L,s_store_id#19555,s_rec_start_date#19556,s_rec_end_date#19557,s_closed_date_sk#19558L,s_store_name#19559,s_number_employees#19560,s_floor_space#19561,s_hours#19562,s_manager#19563,s_market_id#19564,s_geography_class#19565,s_market_desc#19566,s_market_manager#19567,s_division_id#19568,s_division_name#19569,s_company_id#19570,s_company_name#19571,s_street_number#19572,s_street_name#19573,s_street_type#19574,s_suite_number#19575,s_city#19576,s_county#19577,... 5 more fields] orc
            +- Project [i_item_sk#19583L, i_item_desc#19587, i_current_price#19588, i_wholesale_cost#19589, i_brand#19591]
               +- Filter isnotnull(i_item_sk#19583L)
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19583L,i_item_id#19584,i_rec_start_date#19585,i_rec_end_date#19586,i_item_desc#19587,i_current_price#19588,i_wholesale_cost#19589,i_brand_id#19590,i_brand#19591,i_class_id#19592,i_class#19593,i_category_id#19594,i_category#19595,i_manufact_id#19596,i_manufact#19597,i_size#19598,i_formulation#19599,i_color#19600,i_units#19601,i_container#19602,i_manager_id#19603,i_product_name#19604] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name#19559 ASC NULLS FIRST,i_item_desc#19587 ASC NULLS FIRST], output=[s_store_name#19559,i_item_desc#19587,revenue#19553,i_current_price#19588,i_wholesale_cost#19589,i_brand#19591])
   +- Project [s_store_name#19559, i_item_desc#19587, revenue#19553, i_current_price#19588, i_wholesale_cost#19589, i_brand#19591]
      +- SortMergeJoin [ss_item_sk#19657L], [i_item_sk#19583L], Inner
         :- Sort [ss_item_sk#19657L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(ss_item_sk#19657L, 3000), ENSURE_REQUIREMENTS, [id=#20893]
         :     +- Project [ss_item_sk#19657L, revenue#19553, s_store_name#19559]
         :        +- BroadcastHashJoin [ss_store_sk#19662L], [s_store_sk#19554L], Inner, BuildRight, false
         :           :- Project [ss_store_sk#19662L, ss_item_sk#19657L, revenue#19553]
         :           :  +- BroadcastHashJoin [ss_store_sk#19662L], [ss_store_sk#19611L], Inner, BuildRight, (revenue#19553 <= (0.1 * ave#19552)), false
         :           :     :- Filter isnotnull(revenue#19553)
         :           :     :  +- HashAggregate(keys=[ss_store_sk#19662L, ss_item_sk#19657L], functions=[sum(ss_sales_price#19668)], output=[ss_store_sk#19662L, ss_item_sk#19657L, revenue#19553])
         :           :     :     +- Exchange hashpartitioning(ss_store_sk#19662L, ss_item_sk#19657L, 3000), ENSURE_REQUIREMENTS, [id=#20868]
         :           :     :        +- HashAggregate(keys=[ss_store_sk#19662L, ss_item_sk#19657L], functions=[partial_sum(ss_sales_price#19668)], output=[ss_store_sk#19662L, ss_item_sk#19657L, sum#19719])
         :           :     :           +- Project [ss_item_sk#19657L, ss_store_sk#19662L, ss_sales_price#19668]
         :           :     :              +- BroadcastHashJoin [ss_sold_date_sk#19678L], [d_date_sk#19679L], Inner, BuildRight, false
         :           :     :                 :- Filter (isnotnull(ss_store_sk#19662L) AND isnotnull(ss_item_sk#19657L))
         :           :     :                 :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#19657L,ss_store_sk#19662L,ss_sales_price#19668,ss_sold_date_sk#19678L] Batched: true, DataFilters: [isnotnull(ss_store_sk#19662L), isnotnull(ss_item_sk#19657L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#19678L), dynamicpruningexpression(ss_sold_date_sk#19678L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
         :           :     :                 :        +- SubqueryAdaptiveBroadcast dynamicpruning#19716, 0, true, Project [d_date_sk#19679L], [d_date_sk#19679L]
         :           :     :                 :           +- AdaptiveSparkPlan isFinalPlan=false
         :           :     :                 :              +- Project [d_date_sk#19679L]
         :           :     :                 :                 +- Filter (((isnotnull(d_month_seq#19682) AND (d_month_seq#19682 >= 1212)) AND (d_month_seq#19682 <= 1223)) AND isnotnull(d_date_sk#19679L))
         :           :     :                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19679L,d_month_seq#19682] Batched: true, DataFilters: [isnotnull(d_month_seq#19682), (d_month_seq#19682 >= 1212), (d_month_seq#19682 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
         :           :     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20863]
         :           :     :                    +- Project [d_date_sk#19679L]
         :           :     :                       +- Filter (((isnotnull(d_month_seq#19682) AND (d_month_seq#19682 >= 1212)) AND (d_month_seq#19682 <= 1223)) AND isnotnull(d_date_sk#19679L))
         :           :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19679L,d_month_seq#19682] Batched: true, DataFilters: [isnotnull(d_month_seq#19682), (d_month_seq#19682 >= 1212), (d_month_seq#19682 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20884]
         :           :        +- Filter isnotnull(ave#19552)
         :           :           +- HashAggregate(keys=[ss_store_sk#19611L], functions=[avg(revenue#19551)], output=[ss_store_sk#19611L, ave#19552])
         :           :              +- Exchange hashpartitioning(ss_store_sk#19611L, 3000), ENSURE_REQUIREMENTS, [id=#20880]
         :           :                 +- HashAggregate(keys=[ss_store_sk#19611L], functions=[partial_avg(revenue#19551)], output=[ss_store_sk#19611L, sum#19722, count#19723L])
         :           :                    +- HashAggregate(keys=[ss_store_sk#19611L, ss_item_sk#19606L], functions=[sum(ss_sales_price#19617)], output=[ss_store_sk#19611L, revenue#19551])
         :           :                       +- Exchange hashpartitioning(ss_store_sk#19611L, ss_item_sk#19606L, 3000), ENSURE_REQUIREMENTS, [id=#20876]
         :           :                          +- HashAggregate(keys=[ss_store_sk#19611L, ss_item_sk#19606L], functions=[partial_sum(ss_sales_price#19617)], output=[ss_store_sk#19611L, ss_item_sk#19606L, sum#19725])
         :           :                             +- Project [ss_item_sk#19606L, ss_store_sk#19611L, ss_sales_price#19617]
         :           :                                +- BroadcastHashJoin [ss_sold_date_sk#19627L], [d_date_sk#19628L], Inner, BuildRight, false
         :           :                                   :- Filter isnotnull(ss_store_sk#19611L)
         :           :                                   :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#19606L,ss_store_sk#19611L,ss_sales_price#19617,ss_sold_date_sk#19627L] Batched: true, DataFilters: [isnotnull(ss_store_sk#19611L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#19627L), dynamicpruningexpression(ss_sold_date_sk#19627L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
         :           :                                   :        +- SubqueryAdaptiveBroadcast dynamicpruning#19717, 0, true, Project [d_date_sk#19628L], [d_date_sk#19628L]
         :           :                                   :           +- AdaptiveSparkPlan isFinalPlan=false
         :           :                                   :              +- Project [d_date_sk#19628L]
         :           :                                   :                 +- Filter (((isnotnull(d_month_seq#19631) AND (d_month_seq#19631 >= 1212)) AND (d_month_seq#19631 <= 1223)) AND isnotnull(d_date_sk#19628L))
         :           :                                   :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19628L,d_month_seq#19631] Batched: true, DataFilters: [isnotnull(d_month_seq#19631), (d_month_seq#19631 >= 1212), (d_month_seq#19631 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
         :           :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#20871]
         :           :                                      +- Project [d_date_sk#19628L]
         :           :                                         +- Filter (((isnotnull(d_month_seq#19631) AND (d_month_seq#19631 >= 1212)) AND (d_month_seq#19631 <= 1223)) AND isnotnull(d_date_sk#19628L))
         :           :                                            +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19628L,d_month_seq#19631] Batched: true, DataFilters: [isnotnull(d_month_seq#19631), (d_month_seq#19631 >= 1212), (d_month_seq#19631 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
         :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#20888]
         :              +- Filter isnotnull(s_store_sk#19554L)
         :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#19554L,s_store_name#19559] Batched: true, DataFilters: [isnotnull(s_store_sk#19554L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
         +- Sort [i_item_sk#19583L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_item_sk#19583L, 3000), ENSURE_REQUIREMENTS, [id=#20894]
               +- Filter isnotnull(i_item_sk#19583L)
                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#19583L,i_item_desc#19587,i_current_price#19588,i_wholesale_cost#19589,i_brand#19591] Batched: true, DataFilters: [isnotnull(i_item_sk#19583L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string,i_current_price:double,i_wholesale_cost:double,i_brand...

read query: spark_queries/q66.sql
explain query: q66
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['w_warehouse_name ASC NULLS FIRST], true
      +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'ship_carriers, 'year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'ship_carriers, 'year, 'sum('jan_sales) AS jan_sales#19778, 'sum('feb_sales) AS feb_sales#19779, 'sum('mar_sales) AS mar_sales#19780, 'sum('apr_sales) AS apr_sales#19781, 'sum('may_sales) AS may_sales#19782, 'sum('jun_sales) AS jun_sales#19783, 'sum('jul_sales) AS jul_sales#19784, 'sum('aug_sales) AS aug_sales#19785, 'sum('sep_sales) AS sep_sales#19786, 'sum('oct_sales) AS oct_sales#19787, 'sum('nov_sales) AS nov_sales#19788, 'sum('dec_sales) AS dec_sales#19789, 'sum(('jan_sales / 'w_warehouse_sq_ft)) AS jan_sales_per_sq_foot#19790, 'sum(('feb_sales / 'w_warehouse_sq_ft)) AS feb_sales_per_sq_foot#19791, 'sum(('mar_sales / 'w_warehouse_sq_ft)) AS mar_sales_per_sq_foot#19792, 'sum(('apr_sales / 'w_warehouse_sq_ft)) AS apr_sales_per_sq_foot#19793, ... 20 more fields]
         +- 'SubqueryAlias x
            +- 'Union false, false
               :- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'd_year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'concat(DIAMOND, ,, AIRBORNE) AS ship_carriers#19726, 'd_year AS year#19727, 'sum(CASE WHEN ('d_moy = 1) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jan_sales#19728, 'sum(CASE WHEN ('d_moy = 2) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS feb_sales#19729, 'sum(CASE WHEN ('d_moy = 3) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS mar_sales#19730, 'sum(CASE WHEN ('d_moy = 4) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS apr_sales#19731, 'sum(CASE WHEN ('d_moy = 5) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS may_sales#19732, 'sum(CASE WHEN ('d_moy = 6) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jun_sales#19733, 'sum(CASE WHEN ('d_moy = 7) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jul_sales#19734, 'sum(CASE WHEN ('d_moy = 8) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS aug_sales#19735, 'sum(CASE WHEN ('d_moy = 9) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS sep_sales#19736, 'sum(CASE WHEN ('d_moy = 10) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS oct_sales#19737, 'sum(CASE WHEN ('d_moy = 11) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS nov_sales#19738, 'sum(CASE WHEN ('d_moy = 12) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS dec_sales#19739, 'sum(CASE WHEN ('d_moy = 1) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS jan_net#19740, 'sum(CASE WHEN ('d_moy = 2) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS feb_net#19741, 'sum(CASE WHEN ('d_moy = 3) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS mar_net#19742, 'sum(CASE WHEN ('d_moy = 4) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS apr_net#19743, ... 8 more fields]
               :  +- 'Filter (((('ws_warehouse_sk = 'w_warehouse_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('ws_sold_time_sk = 't_time_sk) AND ('ws_ship_mode_sk = 'sm_ship_mode_sk))) AND ((('d_year = 2002) AND (('t_time >= 49530) AND ('t_time <= (49530 + 28800)))) AND 'sm_carrier IN (DIAMOND,AIRBORNE)))
               :     +- 'Join Inner
               :        :- 'Join Inner
               :        :  :- 'Join Inner
               :        :  :  :- 'Join Inner
               :        :  :  :  :- 'UnresolvedRelation [web_sales], [], false
               :        :  :  :  +- 'UnresolvedRelation [warehouse], [], false
               :        :  :  +- 'UnresolvedRelation [date_dim], [], false
               :        :  +- 'UnresolvedRelation [time_dim], [], false
               :        +- 'UnresolvedRelation [ship_mode], [], false
               +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'd_year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'concat(DIAMOND, ,, AIRBORNE) AS ship_carriers#19752, 'd_year AS year#19753, 'sum(CASE WHEN ('d_moy = 1) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jan_sales#19754, 'sum(CASE WHEN ('d_moy = 2) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS feb_sales#19755, 'sum(CASE WHEN ('d_moy = 3) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS mar_sales#19756, 'sum(CASE WHEN ('d_moy = 4) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS apr_sales#19757, 'sum(CASE WHEN ('d_moy = 5) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS may_sales#19758, 'sum(CASE WHEN ('d_moy = 6) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jun_sales#19759, 'sum(CASE WHEN ('d_moy = 7) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jul_sales#19760, 'sum(CASE WHEN ('d_moy = 8) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS aug_sales#19761, 'sum(CASE WHEN ('d_moy = 9) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS sep_sales#19762, 'sum(CASE WHEN ('d_moy = 10) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS oct_sales#19763, 'sum(CASE WHEN ('d_moy = 11) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS nov_sales#19764, 'sum(CASE WHEN ('d_moy = 12) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS dec_sales#19765, 'sum(CASE WHEN ('d_moy = 1) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS jan_net#19766, 'sum(CASE WHEN ('d_moy = 2) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS feb_net#19767, 'sum(CASE WHEN ('d_moy = 3) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS mar_net#19768, 'sum(CASE WHEN ('d_moy = 4) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS apr_net#19769, ... 8 more fields]
                  +- 'Filter (((('cs_warehouse_sk = 'w_warehouse_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('cs_sold_time_sk = 't_time_sk) AND ('cs_ship_mode_sk = 'sm_ship_mode_sk))) AND ((('d_year = 2002) AND (('t_time >= 49530) AND ('t_time <= (49530 + 28800)))) AND 'sm_carrier IN (DIAMOND,AIRBORNE)))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'Join Inner
                        :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
                        :  :  :  +- 'UnresolvedRelation [warehouse], [], false
                        :  :  +- 'UnresolvedRelation [date_dim], [], false
                        :  +- 'UnresolvedRelation [time_dim], [], false
                        +- 'UnresolvedRelation [ship_mode], [], false

== Analyzed Logical Plan ==
w_warehouse_name: string, w_warehouse_sq_ft: int, w_city: string, w_county: string, w_state: string, w_country: string, ship_carriers: string, year: int, jan_sales: double, feb_sales: double, mar_sales: double, apr_sales: double, may_sales: double, jun_sales: double, jul_sales: double, aug_sales: double, sep_sales: double, oct_sales: double, nov_sales: double, dec_sales: double, jan_sales_per_sq_foot: double, feb_sales_per_sq_foot: double, mar_sales_per_sq_foot: double, apr_sales_per_sq_foot: double, ... 20 more fields
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_warehouse_name#19850 ASC NULLS FIRST], true
      +- Aggregate [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727], [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, sum(jan_sales#19728) AS jan_sales#19778, sum(feb_sales#19729) AS feb_sales#19779, sum(mar_sales#19730) AS mar_sales#19780, sum(apr_sales#19731) AS apr_sales#19781, sum(may_sales#19732) AS may_sales#19782, sum(jun_sales#19733) AS jun_sales#19783, sum(jul_sales#19734) AS jul_sales#19784, sum(aug_sales#19735) AS aug_sales#19785, sum(sep_sales#19736) AS sep_sales#19786, sum(oct_sales#19737) AS oct_sales#19787, sum(nov_sales#19738) AS nov_sales#19788, sum(dec_sales#19739) AS dec_sales#19789, sum((jan_sales#19728 / cast(w_warehouse_sq_ft#19851 as double))) AS jan_sales_per_sq_foot#19790, sum((feb_sales#19729 / cast(w_warehouse_sq_ft#19851 as double))) AS feb_sales_per_sq_foot#19791, sum((mar_sales#19730 / cast(w_warehouse_sq_ft#19851 as double))) AS mar_sales_per_sq_foot#19792, sum((apr_sales#19731 / cast(w_warehouse_sq_ft#19851 as double))) AS apr_sales_per_sq_foot#19793, ... 20 more fields]
         +- SubqueryAlias x
            +- Union false, false
               :- Aggregate [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868], [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, concat(DIAMOND, ,, AIRBORNE) AS ship_carriers#19726, d_year#19868 AS year#19727, sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS jan_sales#19728, sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS feb_sales#19729, sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS mar_sales#19730, sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS apr_sales#19731, sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS may_sales#19732, sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS jun_sales#19733, sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS jul_sales#19734, sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS aug_sales#19735, sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS sep_sales#19736, sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS oct_sales#19737, sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS nov_sales#19738, sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS dec_sales#19739, sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS jan_net#19740, sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS feb_net#19741, sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS mar_net#19742, sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE cast(0 as double) END) AS apr_net#19743, ... 8 more fields]
               :  +- Filter ((((ws_warehouse_sk#19828L = w_warehouse_sk#19848L) AND (ws_sold_date_sk#19847L = d_date_sk#19862L)) AND ((ws_sold_time_sk#19814L = t_time_sk#19890L) AND (ws_ship_mode_sk#19827L = sm_ship_mode_sk#19900L))) AND (((d_year#19868 = 2002) AND ((t_time#19892 >= 49530) AND (t_time#19892 <= (49530 + 28800)))) AND sm_carrier#19904 IN (DIAMOND,AIRBORNE)))
               :     +- Join Inner
               :        :- Join Inner
               :        :  :- Join Inner
               :        :  :  :- Join Inner
               :        :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :        :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#19814L,ws_ship_date_sk#19815L,ws_item_sk#19816L,ws_bill_customer_sk#19817L,ws_bill_cdemo_sk#19818L,ws_bill_hdemo_sk#19819L,ws_bill_addr_sk#19820L,ws_ship_customer_sk#19821L,ws_ship_cdemo_sk#19822L,ws_ship_hdemo_sk#19823L,ws_ship_addr_sk#19824L,ws_web_page_sk#19825L,ws_web_site_sk#19826L,ws_ship_mode_sk#19827L,ws_warehouse_sk#19828L,ws_promo_sk#19829L,ws_order_number#19830L,ws_quantity#19831,ws_wholesale_cost#19832,ws_list_price#19833,ws_sales_price#19834,ws_ext_discount_amt#19835,ws_ext_sales_price#19836,ws_ext_wholesale_cost#19837,... 10 more fields] orc
               :        :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
               :        :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19848L,w_warehouse_id#19849,w_warehouse_name#19850,w_warehouse_sq_ft#19851,w_street_number#19852,w_street_name#19853,w_street_type#19854,w_suite_number#19855,w_city#19856,w_county#19857,w_state#19858,w_zip#19859,w_country#19860,w_gmt_offset#19861] orc
               :        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19862L,d_date_id#19863,d_date#19864,d_month_seq#19865,d_week_seq#19866,d_quarter_seq#19867,d_year#19868,d_dow#19869,d_moy#19870,d_dom#19871,d_qoy#19872,d_fy_year#19873,d_fy_quarter_seq#19874,d_fy_week_seq#19875,d_day_name#19876,d_quarter_name#19877,d_holiday#19878,d_weekend#19879,d_following_holiday#19880,d_first_dom#19881,d_last_dom#19882,d_same_day_ly#19883,d_same_day_lq#19884,d_current_day#19885,... 4 more fields] orc
               :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
               :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19890L,t_time_id#19891,t_time#19892,t_hour#19893,t_minute#19894,t_second#19895,t_am_pm#19896,t_shift#19897,t_sub_shift#19898,t_meal_time#19899] orc
               :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.ship_mode
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19900L,sm_ship_mode_id#19901,sm_type#19902,sm_code#19903,sm_carrier#19904,sm_contract#19905] orc
               +- Aggregate [w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960], [w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, concat(DIAMOND, ,, AIRBORNE) AS ship_carriers#19752, d_year#19960 AS year#19753, sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS jan_sales#19754, sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS feb_sales#19755, sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS mar_sales#19756, sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS apr_sales#19757, sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS may_sales#19758, sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS jun_sales#19759, sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS jul_sales#19760, sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS aug_sales#19761, sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS sep_sales#19762, sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS oct_sales#19763, sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS nov_sales#19764, sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS dec_sales#19765, sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS jan_net#19766, sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS feb_net#19767, sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS mar_net#19768, sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE cast(0 as double) END) AS apr_net#19769, ... 8 more fields]
                  +- Filter ((((cs_warehouse_sk#19919L = w_warehouse_sk#19940L) AND (cs_sold_date_sk#19939L = d_date_sk#19954L)) AND ((cs_sold_time_sk#19906L = t_time_sk#19982L) AND (cs_ship_mode_sk#19918L = sm_ship_mode_sk#19992L))) AND (((d_year#19960 = 2002) AND ((t_time#19984 >= 49530) AND (t_time#19984 <= (49530 + 28800)))) AND sm_carrier#19996 IN (DIAMOND,AIRBORNE)))
                     +- Join Inner
                        :- Join Inner
                        :  :- Join Inner
                        :  :  :- Join Inner
                        :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                        :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#19906L,cs_ship_date_sk#19907L,cs_bill_customer_sk#19908L,cs_bill_cdemo_sk#19909L,cs_bill_hdemo_sk#19910L,cs_bill_addr_sk#19911L,cs_ship_customer_sk#19912L,cs_ship_cdemo_sk#19913L,cs_ship_hdemo_sk#19914L,cs_ship_addr_sk#19915L,cs_call_center_sk#19916L,cs_catalog_page_sk#19917L,cs_ship_mode_sk#19918L,cs_warehouse_sk#19919L,cs_item_sk#19920L,cs_promo_sk#19921L,cs_order_number#19922L,cs_quantity#19923,cs_wholesale_cost#19924,cs_list_price#19925,cs_sales_price#19926,cs_ext_discount_amt#19927,cs_ext_sales_price#19928,cs_ext_wholesale_cost#19929,... 10 more fields] orc
                        :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
                        :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19940L,w_warehouse_id#19941,w_warehouse_name#19942,w_warehouse_sq_ft#19943,w_street_number#19944,w_street_name#19945,w_street_type#19946,w_suite_number#19947,w_city#19948,w_county#19949,w_state#19950,w_zip#19951,w_country#19952,w_gmt_offset#19953] orc
                        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19954L,d_date_id#19955,d_date#19956,d_month_seq#19957,d_week_seq#19958,d_quarter_seq#19959,d_year#19960,d_dow#19961,d_moy#19962,d_dom#19963,d_qoy#19964,d_fy_year#19965,d_fy_quarter_seq#19966,d_fy_week_seq#19967,d_day_name#19968,d_quarter_name#19969,d_holiday#19970,d_weekend#19971,d_following_holiday#19972,d_first_dom#19973,d_last_dom#19974,d_same_day_ly#19975,d_same_day_lq#19976,d_current_day#19977,... 4 more fields] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19982L,t_time_id#19983,t_time#19984,t_hour#19985,t_minute#19986,t_second#19987,t_am_pm#19988,t_shift#19989,t_sub_shift#19990,t_meal_time#19991] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.ship_mode
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19992L,sm_ship_mode_id#19993,sm_type#19994,sm_code#19995,sm_carrier#19996,sm_contract#19997] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [w_warehouse_name#19850 ASC NULLS FIRST], true
      +- Aggregate [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727], [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, sum(jan_sales#19728) AS jan_sales#19778, sum(feb_sales#19729) AS feb_sales#19779, sum(mar_sales#19730) AS mar_sales#19780, sum(apr_sales#19731) AS apr_sales#19781, sum(may_sales#19732) AS may_sales#19782, sum(jun_sales#19733) AS jun_sales#19783, sum(jul_sales#19734) AS jul_sales#19784, sum(aug_sales#19735) AS aug_sales#19785, sum(sep_sales#19736) AS sep_sales#19786, sum(oct_sales#19737) AS oct_sales#19787, sum(nov_sales#19738) AS nov_sales#19788, sum(dec_sales#19739) AS dec_sales#19789, sum((jan_sales#19728 / cast(w_warehouse_sq_ft#19851 as double))) AS jan_sales_per_sq_foot#19790, sum((feb_sales#19729 / cast(w_warehouse_sq_ft#19851 as double))) AS feb_sales_per_sq_foot#19791, sum((mar_sales#19730 / cast(w_warehouse_sq_ft#19851 as double))) AS mar_sales_per_sq_foot#19792, sum((apr_sales#19731 / cast(w_warehouse_sq_ft#19851 as double))) AS apr_sales_per_sq_foot#19793, ... 20 more fields]
         +- Union false, false
            :- Aggregate [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868], [w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, DIAMOND,AIRBORNE AS ship_carriers#19726, d_year#19868 AS year#19727, sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS jan_sales#19728, sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS feb_sales#19729, sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS mar_sales#19730, sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS apr_sales#19731, sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS may_sales#19732, sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS jun_sales#19733, sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS jul_sales#19734, sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS aug_sales#19735, sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS sep_sales#19736, sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS oct_sales#19737, sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS nov_sales#19738, sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS dec_sales#19739, sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS jan_net#19740, sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS feb_net#19741, sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS mar_net#19742, sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END) AS apr_net#19743, ... 8 more fields]
            :  +- Project [ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868, d_moy#19870]
            :     +- Join Inner, (ws_warehouse_sk#19828L = w_warehouse_sk#19848L)
            :        :- Project [ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, d_year#19868, d_moy#19870]
            :        :  +- Join Inner, (ws_sold_date_sk#19847L = d_date_sk#19862L)
            :        :     :- Project [ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, ws_sold_date_sk#19847L]
            :        :     :  +- Join Inner, (ws_sold_time_sk#19814L = t_time_sk#19890L)
            :        :     :     :- Project [ws_sold_time_sk#19814L, ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, ws_sold_date_sk#19847L]
            :        :     :     :  +- Join Inner, (ws_ship_mode_sk#19827L = sm_ship_mode_sk#19900L)
            :        :     :     :     :- Project [ws_sold_time_sk#19814L, ws_ship_mode_sk#19827L, ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, ws_sold_date_sk#19847L]
            :        :     :     :     :  +- Filter ((((isnotnull(ws_warehouse_sk#19828L) AND isnotnull(ws_sold_date_sk#19847L)) AND isnotnull(ws_sold_time_sk#19814L)) AND isnotnull(ws_ship_mode_sk#19827L)) AND dynamicpruning#20126 [ws_sold_date_sk#19847L])
            :        :     :     :     :     :  +- Project [d_date_sk#19862L, d_year#19868, d_moy#19870]
            :        :     :     :     :     :     +- Filter ((isnotnull(d_year#19868) AND (d_year#19868 = 2002)) AND isnotnull(d_date_sk#19862L))
            :        :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19862L,d_date_id#19863,d_date#19864,d_month_seq#19865,d_week_seq#19866,d_quarter_seq#19867,d_year#19868,d_dow#19869,d_moy#19870,d_dom#19871,d_qoy#19872,d_fy_year#19873,d_fy_quarter_seq#19874,d_fy_week_seq#19875,d_day_name#19876,d_quarter_name#19877,d_holiday#19878,d_weekend#19879,d_following_holiday#19880,d_first_dom#19881,d_last_dom#19882,d_same_day_ly#19883,d_same_day_lq#19884,d_current_day#19885,... 4 more fields] orc
            :        :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#19814L,ws_ship_date_sk#19815L,ws_item_sk#19816L,ws_bill_customer_sk#19817L,ws_bill_cdemo_sk#19818L,ws_bill_hdemo_sk#19819L,ws_bill_addr_sk#19820L,ws_ship_customer_sk#19821L,ws_ship_cdemo_sk#19822L,ws_ship_hdemo_sk#19823L,ws_ship_addr_sk#19824L,ws_web_page_sk#19825L,ws_web_site_sk#19826L,ws_ship_mode_sk#19827L,ws_warehouse_sk#19828L,ws_promo_sk#19829L,ws_order_number#19830L,ws_quantity#19831,ws_wholesale_cost#19832,ws_list_price#19833,ws_sales_price#19834,ws_ext_discount_amt#19835,ws_ext_sales_price#19836,ws_ext_wholesale_cost#19837,... 10 more fields] orc
            :        :     :     :     +- Project [sm_ship_mode_sk#19900L]
            :        :     :     :        +- Filter (sm_carrier#19904 IN (DIAMOND,AIRBORNE) AND isnotnull(sm_ship_mode_sk#19900L))
            :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19900L,sm_ship_mode_id#19901,sm_type#19902,sm_code#19903,sm_carrier#19904,sm_contract#19905] orc
            :        :     :     +- Project [t_time_sk#19890L]
            :        :     :        +- Filter ((isnotnull(t_time#19892) AND ((t_time#19892 >= 49530) AND (t_time#19892 <= 78330))) AND isnotnull(t_time_sk#19890L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19890L,t_time_id#19891,t_time#19892,t_hour#19893,t_minute#19894,t_second#19895,t_am_pm#19896,t_shift#19897,t_sub_shift#19898,t_meal_time#19899] orc
            :        :     +- Project [d_date_sk#19862L, d_year#19868, d_moy#19870]
            :        :        +- Filter ((isnotnull(d_year#19868) AND (d_year#19868 = 2002)) AND isnotnull(d_date_sk#19862L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19862L,d_date_id#19863,d_date#19864,d_month_seq#19865,d_week_seq#19866,d_quarter_seq#19867,d_year#19868,d_dow#19869,d_moy#19870,d_dom#19871,d_qoy#19872,d_fy_year#19873,d_fy_quarter_seq#19874,d_fy_week_seq#19875,d_day_name#19876,d_quarter_name#19877,d_holiday#19878,d_weekend#19879,d_following_holiday#19880,d_first_dom#19881,d_last_dom#19882,d_same_day_ly#19883,d_same_day_lq#19884,d_current_day#19885,... 4 more fields] orc
            :        +- Project [w_warehouse_sk#19848L, w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860]
            :           +- Filter isnotnull(w_warehouse_sk#19848L)
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19848L,w_warehouse_id#19849,w_warehouse_name#19850,w_warehouse_sq_ft#19851,w_street_number#19852,w_street_name#19853,w_street_type#19854,w_suite_number#19855,w_city#19856,w_county#19857,w_state#19858,w_zip#19859,w_country#19860,w_gmt_offset#19861] orc
            +- Aggregate [w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960], [w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, DIAMOND,AIRBORNE AS ship_carriers#19752, d_year#19960 AS year#19753, sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS jan_sales#19754, sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS feb_sales#19755, sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS mar_sales#19756, sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS apr_sales#19757, sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS may_sales#19758, sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS jun_sales#19759, sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS jul_sales#19760, sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS aug_sales#19761, sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS sep_sales#19762, sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS oct_sales#19763, sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS nov_sales#19764, sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS dec_sales#19765, sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS jan_net#19766, sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS feb_net#19767, sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS mar_net#19768, sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END) AS apr_net#19769, ... 8 more fields]
               +- Project [cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960, d_moy#19962]
                  +- Join Inner, (cs_warehouse_sk#19919L = w_warehouse_sk#19940L)
                     :- Project [cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, d_year#19960, d_moy#19962]
                     :  +- Join Inner, (cs_sold_date_sk#19939L = d_date_sk#19954L)
                     :     :- Project [cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, cs_sold_date_sk#19939L]
                     :     :  +- Join Inner, (cs_sold_time_sk#19906L = t_time_sk#19982L)
                     :     :     :- Project [cs_sold_time_sk#19906L, cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, cs_sold_date_sk#19939L]
                     :     :     :  +- Join Inner, (cs_ship_mode_sk#19918L = sm_ship_mode_sk#19992L)
                     :     :     :     :- Project [cs_sold_time_sk#19906L, cs_ship_mode_sk#19918L, cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, cs_sold_date_sk#19939L]
                     :     :     :     :  +- Filter ((((isnotnull(cs_warehouse_sk#19919L) AND isnotnull(cs_sold_date_sk#19939L)) AND isnotnull(cs_sold_time_sk#19906L)) AND isnotnull(cs_ship_mode_sk#19918L)) AND dynamicpruning#20127 [cs_sold_date_sk#19939L])
                     :     :     :     :     :  +- Project [d_date_sk#19954L, d_year#19960, d_moy#19962]
                     :     :     :     :     :     +- Filter ((isnotnull(d_year#19960) AND (d_year#19960 = 2002)) AND isnotnull(d_date_sk#19954L))
                     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19954L,d_date_id#19955,d_date#19956,d_month_seq#19957,d_week_seq#19958,d_quarter_seq#19959,d_year#19960,d_dow#19961,d_moy#19962,d_dom#19963,d_qoy#19964,d_fy_year#19965,d_fy_quarter_seq#19966,d_fy_week_seq#19967,d_day_name#19968,d_quarter_name#19969,d_holiday#19970,d_weekend#19971,d_following_holiday#19972,d_first_dom#19973,d_last_dom#19974,d_same_day_ly#19975,d_same_day_lq#19976,d_current_day#19977,... 4 more fields] orc
                     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#19906L,cs_ship_date_sk#19907L,cs_bill_customer_sk#19908L,cs_bill_cdemo_sk#19909L,cs_bill_hdemo_sk#19910L,cs_bill_addr_sk#19911L,cs_ship_customer_sk#19912L,cs_ship_cdemo_sk#19913L,cs_ship_hdemo_sk#19914L,cs_ship_addr_sk#19915L,cs_call_center_sk#19916L,cs_catalog_page_sk#19917L,cs_ship_mode_sk#19918L,cs_warehouse_sk#19919L,cs_item_sk#19920L,cs_promo_sk#19921L,cs_order_number#19922L,cs_quantity#19923,cs_wholesale_cost#19924,cs_list_price#19925,cs_sales_price#19926,cs_ext_discount_amt#19927,cs_ext_sales_price#19928,cs_ext_wholesale_cost#19929,... 10 more fields] orc
                     :     :     :     +- Project [sm_ship_mode_sk#19992L]
                     :     :     :        +- Filter (sm_carrier#19996 IN (DIAMOND,AIRBORNE) AND isnotnull(sm_ship_mode_sk#19992L))
                     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19992L,sm_ship_mode_id#19993,sm_type#19994,sm_code#19995,sm_carrier#19996,sm_contract#19997] orc
                     :     :     +- Project [t_time_sk#19982L]
                     :     :        +- Filter ((isnotnull(t_time#19984) AND ((t_time#19984 >= 49530) AND (t_time#19984 <= 78330))) AND isnotnull(t_time_sk#19982L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19982L,t_time_id#19983,t_time#19984,t_hour#19985,t_minute#19986,t_second#19987,t_am_pm#19988,t_shift#19989,t_sub_shift#19990,t_meal_time#19991] orc
                     :     +- Project [d_date_sk#19954L, d_year#19960, d_moy#19962]
                     :        +- Filter ((isnotnull(d_year#19960) AND (d_year#19960 = 2002)) AND isnotnull(d_date_sk#19954L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19954L,d_date_id#19955,d_date#19956,d_month_seq#19957,d_week_seq#19958,d_quarter_seq#19959,d_year#19960,d_dow#19961,d_moy#19962,d_dom#19963,d_qoy#19964,d_fy_year#19965,d_fy_quarter_seq#19966,d_fy_week_seq#19967,d_day_name#19968,d_quarter_name#19969,d_holiday#19970,d_weekend#19971,d_following_holiday#19972,d_first_dom#19973,d_last_dom#19974,d_same_day_ly#19975,d_same_day_lq#19976,d_current_day#19977,... 4 more fields] orc
                     +- Project [w_warehouse_sk#19940L, w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952]
                        +- Filter isnotnull(w_warehouse_sk#19940L)
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19940L,w_warehouse_id#19941,w_warehouse_name#19942,w_warehouse_sq_ft#19943,w_street_number#19944,w_street_name#19945,w_street_type#19946,w_suite_number#19947,w_city#19948,w_county#19949,w_state#19950,w_zip#19951,w_country#19952,w_gmt_offset#19953] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[w_warehouse_name#19850 ASC NULLS FIRST], output=[w_warehouse_name#19850,w_warehouse_sq_ft#19851,w_city#19856,w_county#19857,w_state#19858,w_country#19860,ship_carriers#19726,year#19727,jan_sales#19778,feb_sales#19779,mar_sales#19780,apr_sales#19781,may_sales#19782,jun_sales#19783,jul_sales#19784,aug_sales#19785,sep_sales#19786,oct_sales#19787,nov_sales#19788,dec_sales#19789,jan_sales_per_sq_foot#19790,feb_sales_per_sq_foot#19791,mar_sales_per_sq_foot#19792,apr_sales_per_sq_foot#19793,... 20 more fields])
   +- HashAggregate(keys=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727], functions=[sum(jan_sales#19728), sum(feb_sales#19729), sum(mar_sales#19730), sum(apr_sales#19731), sum(may_sales#19732), sum(jun_sales#19733), sum(jul_sales#19734), sum(aug_sales#19735), sum(sep_sales#19736), sum(oct_sales#19737), sum(nov_sales#19738), sum(dec_sales#19739), sum((jan_sales#19728 / cast(w_warehouse_sq_ft#19851 as double))), sum((feb_sales#19729 / cast(w_warehouse_sq_ft#19851 as double))), sum((mar_sales#19730 / cast(w_warehouse_sq_ft#19851 as double))), sum((apr_sales#19731 / cast(w_warehouse_sq_ft#19851 as double))), sum((may_sales#19732 / cast(w_warehouse_sq_ft#19851 as double))), sum((jun_sales#19733 / cast(w_warehouse_sq_ft#19851 as double))), sum((jul_sales#19734 / cast(w_warehouse_sq_ft#19851 as double))), sum((aug_sales#19735 / cast(w_warehouse_sq_ft#19851 as double))), sum((sep_sales#19736 / cast(w_warehouse_sq_ft#19851 as double))), sum((oct_sales#19737 / cast(w_warehouse_sq_ft#19851 as double))), sum((nov_sales#19738 / cast(w_warehouse_sq_ft#19851 as double))), sum((dec_sales#19739 / cast(w_warehouse_sq_ft#19851 as double))), ... 12 more fields], output=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, jan_sales#19778, feb_sales#19779, mar_sales#19780, apr_sales#19781, may_sales#19782, jun_sales#19783, jul_sales#19784, aug_sales#19785, sep_sales#19786, oct_sales#19787, nov_sales#19788, dec_sales#19789, jan_sales_per_sq_foot#19790, feb_sales_per_sq_foot#19791, mar_sales_per_sq_foot#19792, apr_sales_per_sq_foot#19793, ... 20 more fields])
      +- Exchange hashpartitioning(w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, 3000), ENSURE_REQUIREMENTS, [id=#21179]
         +- HashAggregate(keys=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727], functions=[partial_sum(jan_sales#19728), partial_sum(feb_sales#19729), partial_sum(mar_sales#19730), partial_sum(apr_sales#19731), partial_sum(may_sales#19732), partial_sum(jun_sales#19733), partial_sum(jul_sales#19734), partial_sum(aug_sales#19735), partial_sum(sep_sales#19736), partial_sum(oct_sales#19737), partial_sum(nov_sales#19738), partial_sum(dec_sales#19739), partial_sum((jan_sales#19728 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((feb_sales#19729 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((mar_sales#19730 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((apr_sales#19731 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((may_sales#19732 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((jun_sales#19733 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((jul_sales#19734 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((aug_sales#19735 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((sep_sales#19736 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((oct_sales#19737 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((nov_sales#19738 / cast(w_warehouse_sq_ft#19851 as double))), partial_sum((dec_sales#19739 / cast(w_warehouse_sq_ft#19851 as double))), ... 12 more fields], output=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, sum#20164, sum#20165, sum#20166, sum#20167, sum#20168, sum#20169, sum#20170, sum#20171, sum#20172, sum#20173, sum#20174, sum#20175, sum#20176, sum#20177, sum#20178, sum#20179, ... 20 more fields])
            +- Union
               :- HashAggregate(keys=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868], functions=[sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END)], output=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, ship_carriers#19726, year#19727, jan_sales#19728, feb_sales#19729, mar_sales#19730, apr_sales#19731, may_sales#19732, jun_sales#19733, jul_sales#19734, aug_sales#19735, sep_sales#19736, oct_sales#19737, nov_sales#19738, dec_sales#19739, jan_net#19740, feb_net#19741, mar_net#19742, apr_net#19743, ... 8 more fields])
               :  +- Exchange hashpartitioning(w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868, 3000), ENSURE_REQUIREMENTS, [id=#21155]
               :     +- HashAggregate(keys=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868], functions=[partial_sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_ext_sales_price#19836 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 1) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 2) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 3) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 4) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 5) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 6) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 7) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 8) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 9) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 10) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 11) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19870 = 12) THEN (ws_net_paid#19842 * cast(ws_quantity#19831 as double)) ELSE 0.0 END)], output=[w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868, sum#20224, sum#20225, sum#20226, sum#20227, sum#20228, sum#20229, sum#20230, sum#20231, sum#20232, sum#20233, sum#20234, sum#20235, sum#20236, sum#20237, sum#20238, sum#20239, sum#20240, ... 7 more fields])
               :        +- Project [ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, w_warehouse_name#19850, w_warehouse_sq_ft#19851, w_city#19856, w_county#19857, w_state#19858, w_country#19860, d_year#19868, d_moy#19870]
               :           +- BroadcastHashJoin [ws_warehouse_sk#19828L], [w_warehouse_sk#19848L], Inner, BuildRight, false
               :              :- Project [ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, d_year#19868, d_moy#19870]
               :              :  +- BroadcastHashJoin [ws_sold_date_sk#19847L], [d_date_sk#19862L], Inner, BuildRight, false
               :              :     :- Project [ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, ws_sold_date_sk#19847L]
               :              :     :  +- BroadcastHashJoin [ws_sold_time_sk#19814L], [t_time_sk#19890L], Inner, BuildRight, false
               :              :     :     :- Project [ws_sold_time_sk#19814L, ws_warehouse_sk#19828L, ws_quantity#19831, ws_ext_sales_price#19836, ws_net_paid#19842, ws_sold_date_sk#19847L]
               :              :     :     :  +- BroadcastHashJoin [ws_ship_mode_sk#19827L], [sm_ship_mode_sk#19900L], Inner, BuildRight, false
               :              :     :     :     :- Filter ((isnotnull(ws_warehouse_sk#19828L) AND isnotnull(ws_sold_time_sk#19814L)) AND isnotnull(ws_ship_mode_sk#19827L))
               :              :     :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#19814L,ws_ship_mode_sk#19827L,ws_warehouse_sk#19828L,ws_quantity#19831,ws_ext_sales_price#19836,ws_net_paid#19842,ws_sold_date_sk#19847L] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#19828L), isnotnull(ws_sold_time_sk#19814L), isnotnull(ws_ship_mode_sk#..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#19847L), dynamicpruningexpression(ws_sold_date_sk#19847L IN dynamicpru..., PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_ship_mode_sk)], ReadSchema: struct<ws_sold_time_sk:bigint,ws_ship_mode_sk:bigint,ws_warehouse_sk:bigint,ws_quantity:int,ws_ex...
               :              :     :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#20126, 0, true, Project [d_date_sk#19862L, d_year#19868, d_moy#19870], [d_date_sk#19862L]
               :              :     :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
               :              :     :     :     :              +- Filter ((isnotnull(d_year#19868) AND (d_year#19868 = 2002)) AND isnotnull(d_date_sk#19862L))
               :              :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19862L,d_year#19868,d_moy#19870] Batched: true, DataFilters: [isnotnull(d_year#19868), (d_year#19868 = 2002), isnotnull(d_date_sk#19862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21138]
               :              :     :     :        +- Project [sm_ship_mode_sk#19900L]
               :              :     :     :           +- Filter (sm_carrier#19904 IN (DIAMOND,AIRBORNE) AND isnotnull(sm_ship_mode_sk#19900L))
               :              :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19900L,sm_carrier#19904] Batched: true, DataFilters: [sm_carrier#19904 IN (DIAMOND,AIRBORNE), isnotnull(sm_ship_mode_sk#19900L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(sm_carrier, [AIRBORNE,DIAMOND]), IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:bigint,sm_carrier:string>
               :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21142]
               :              :     :        +- Project [t_time_sk#19890L]
               :              :     :           +- Filter (((isnotnull(t_time#19892) AND (t_time#19892 >= 49530)) AND (t_time#19892 <= 78330)) AND isnotnull(t_time_sk#19890L))
               :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19890L,t_time#19892] Batched: true, DataFilters: [isnotnull(t_time#19892), (t_time#19892 >= 49530), (t_time#19892 <= 78330), isnotnull(t_time_sk#1..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_time), GreaterThanOrEqual(t_time,49530), LessThanOrEqual(t_time,78330), IsNotNull(t_..., ReadSchema: struct<t_time_sk:bigint,t_time:int>
               :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21146]
               :              :        +- Filter ((isnotnull(d_year#19868) AND (d_year#19868 = 2002)) AND isnotnull(d_date_sk#19862L))
               :              :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19862L,d_year#19868,d_moy#19870] Batched: true, DataFilters: [isnotnull(d_year#19868), (d_year#19868 = 2002), isnotnull(d_date_sk#19862L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
               :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21150]
               :                 +- Filter isnotnull(w_warehouse_sk#19848L)
               :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19848L,w_warehouse_name#19850,w_warehouse_sq_ft#19851,w_city#19856,w_county#19857,w_state#19858,w_country#19860] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#19848L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string,w_warehouse_sq_ft:int,w_city:string,w_county...
               +- HashAggregate(keys=[w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960], functions=[sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END)], output=[w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, ship_carriers#19752, year#19753, jan_sales#19754, feb_sales#19755, mar_sales#19756, apr_sales#19757, may_sales#19758, jun_sales#19759, jul_sales#19760, aug_sales#19761, sep_sales#19762, oct_sales#19763, nov_sales#19764, dec_sales#19765, jan_net#19766, feb_net#19767, mar_net#19768, apr_net#19769, ... 8 more fields])
                  +- Exchange hashpartitioning(w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960, 3000), ENSURE_REQUIREMENTS, [id=#21174]
                     +- HashAggregate(keys=[w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960], functions=[partial_sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_sales_price#19926 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 1) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 2) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 3) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 4) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 5) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 6) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 7) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 8) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 9) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 10) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 11) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END), partial_sum(CASE WHEN (d_moy#19962 = 12) THEN (cs_net_paid_inc_tax#19935 * cast(cs_quantity#19923 as double)) ELSE 0.0 END)], output=[w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960, sum#20272, sum#20273, sum#20274, sum#20275, sum#20276, sum#20277, sum#20278, sum#20279, sum#20280, sum#20281, sum#20282, sum#20283, sum#20284, sum#20285, sum#20286, sum#20287, sum#20288, ... 7 more fields])
                        +- Project [cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, w_warehouse_name#19942, w_warehouse_sq_ft#19943, w_city#19948, w_county#19949, w_state#19950, w_country#19952, d_year#19960, d_moy#19962]
                           +- BroadcastHashJoin [cs_warehouse_sk#19919L], [w_warehouse_sk#19940L], Inner, BuildRight, false
                              :- Project [cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, d_year#19960, d_moy#19962]
                              :  +- BroadcastHashJoin [cs_sold_date_sk#19939L], [d_date_sk#19954L], Inner, BuildRight, false
                              :     :- Project [cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, cs_sold_date_sk#19939L]
                              :     :  +- BroadcastHashJoin [cs_sold_time_sk#19906L], [t_time_sk#19982L], Inner, BuildRight, false
                              :     :     :- Project [cs_sold_time_sk#19906L, cs_warehouse_sk#19919L, cs_quantity#19923, cs_sales_price#19926, cs_net_paid_inc_tax#19935, cs_sold_date_sk#19939L]
                              :     :     :  +- BroadcastHashJoin [cs_ship_mode_sk#19918L], [sm_ship_mode_sk#19992L], Inner, BuildRight, false
                              :     :     :     :- Filter ((isnotnull(cs_warehouse_sk#19919L) AND isnotnull(cs_sold_time_sk#19906L)) AND isnotnull(cs_ship_mode_sk#19918L))
                              :     :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#19906L,cs_ship_mode_sk#19918L,cs_warehouse_sk#19919L,cs_quantity#19923,cs_sales_price#19926,cs_net_paid_inc_tax#19935,cs_sold_date_sk#19939L] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#19919L), isnotnull(cs_sold_time_sk#19906L), isnotnull(cs_ship_mode_sk#..., Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#19939L), dynamicpruningexpression(cs_sold_date_sk#19939L IN dynamicpru..., PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_sold_time_sk), IsNotNull(cs_ship_mode_sk)], ReadSchema: struct<cs_sold_time_sk:bigint,cs_ship_mode_sk:bigint,cs_warehouse_sk:bigint,cs_quantity:int,cs_sa...
                              :     :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#20127, 0, true, Project [d_date_sk#19954L, d_year#19960, d_moy#19962], [d_date_sk#19954L]
                              :     :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                              :     :     :     :              +- Filter ((isnotnull(d_year#19960) AND (d_year#19960 = 2002)) AND isnotnull(d_date_sk#19954L))
                              :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19954L,d_year#19960,d_moy#19962] Batched: true, DataFilters: [isnotnull(d_year#19960), (d_year#19960 = 2002), isnotnull(d_date_sk#19954L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21157]
                              :     :     :        +- Project [sm_ship_mode_sk#19992L]
                              :     :     :           +- Filter (sm_carrier#19996 IN (DIAMOND,AIRBORNE) AND isnotnull(sm_ship_mode_sk#19992L))
                              :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#19992L,sm_carrier#19996] Batched: true, DataFilters: [sm_carrier#19996 IN (DIAMOND,AIRBORNE), isnotnull(sm_ship_mode_sk#19992L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(sm_carrier, [AIRBORNE,DIAMOND]), IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:bigint,sm_carrier:string>
                              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21161]
                              :     :        +- Project [t_time_sk#19982L]
                              :     :           +- Filter (((isnotnull(t_time#19984) AND (t_time#19984 >= 49530)) AND (t_time#19984 <= 78330)) AND isnotnull(t_time_sk#19982L))
                              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#19982L,t_time#19984] Batched: true, DataFilters: [isnotnull(t_time#19984), (t_time#19984 >= 49530), (t_time#19984 <= 78330), isnotnull(t_time_sk#1..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_time), GreaterThanOrEqual(t_time,49530), LessThanOrEqual(t_time,78330), IsNotNull(t_..., ReadSchema: struct<t_time_sk:bigint,t_time:int>
                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21165]
                              :        +- Filter ((isnotnull(d_year#19960) AND (d_year#19960 = 2002)) AND isnotnull(d_date_sk#19954L))
                              :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#19954L,d_year#19960,d_moy#19962] Batched: true, DataFilters: [isnotnull(d_year#19960), (d_year#19960 = 2002), isnotnull(d_date_sk#19954L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21169]
                                 +- Filter isnotnull(w_warehouse_sk#19940L)
                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#19940L,w_warehouse_name#19942,w_warehouse_sq_ft#19943,w_city#19948,w_county#19949,w_state#19950,w_country#19952] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#19940L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string,w_warehouse_sq_ft:int,w_city:string,w_county...

read query: spark_queries/q67.sql
explain query: q67
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_brand ASC NULLS FIRST, 'i_product_name ASC NULLS FIRST, 'd_year ASC NULLS FIRST, 'd_qoy ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 'sumsales ASC NULLS FIRST, 'rk ASC NULLS FIRST], true
      +- 'Project [*]
         +- 'Filter ('rk <= 100)
            +- 'SubqueryAlias dw2
               +- 'Project ['i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id, 'sumsales, 'rank() windowspecdefinition('i_category, 'sumsales DESC NULLS LAST, unspecifiedframe$()) AS rk#20297]
                  +- 'SubqueryAlias dw1
                     +- 'Aggregate [rollup(Vector(0), Vector(1), Vector(2), Vector(3), Vector(4), Vector(5), Vector(6), Vector(7), 'i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id)], ['i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id, 'sum('coalesce(('ss_sales_price * 'ss_quantity), 0)) AS sumsales#20296]
                        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND (('ss_store_sk = 's_store_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11)))))
                           +- 'Join Inner
                              :- 'Join Inner
                              :  :- 'Join Inner
                              :  :  :- 'UnresolvedRelation [store_sales], [], false
                              :  :  +- 'UnresolvedRelation [date_dim], [], false
                              :  +- 'UnresolvedRelation [store], [], false
                              +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
i_category: string, i_class: string, i_brand: string, i_product_name: string, d_year: int, d_qoy: int, d_moy: int, s_store_id: string, sumsales: double, rk: int
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_category#20412 ASC NULLS FIRST, i_class#20413 ASC NULLS FIRST, i_brand#20414 ASC NULLS FIRST, i_product_name#20415 ASC NULLS FIRST, d_year#20416 ASC NULLS FIRST, d_qoy#20417 ASC NULLS FIRST, d_moy#20418 ASC NULLS FIRST, s_store_id#20419 ASC NULLS FIRST, sumsales#20296 ASC NULLS FIRST, rk#20297 ASC NULLS FIRST], true
      +- Project [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sumsales#20296, rk#20297]
         +- Filter (rk#20297 <= 100)
            +- SubqueryAlias dw2
               +- Project [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sumsales#20296, rk#20297]
                  +- Project [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sumsales#20296, rk#20297, rk#20297]
                     +- Window [rank(sumsales#20296) windowspecdefinition(i_category#20412, sumsales#20296 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#20297], [i_category#20412], [sumsales#20296 DESC NULLS LAST]
                        +- Project [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sumsales#20296]
                           +- SubqueryAlias dw1
                              +- Aggregate [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L], [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sum(coalesce((ss_sales_price#20312 * cast(ss_quantity#20309 as double)), cast(0 as double))) AS sumsales#20296]
                                 +- Expand [[ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields]], [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 87 more fields]
                                    +- Project [ss_sold_time_sk#20300L, ss_item_sk#20301L, ss_customer_sk#20302L, ss_cdemo_sk#20303L, ss_hdemo_sk#20304L, ss_addr_sk#20305L, ss_store_sk#20306L, ss_promo_sk#20307L, ss_ticket_number#20308L, ss_quantity#20309, ss_wholesale_cost#20310, ss_list_price#20311, ss_sales_price#20312, ss_ext_discount_amt#20313, ss_ext_sales_price#20314, ss_ext_wholesale_cost#20315, ss_ext_list_price#20316, ss_ext_tax#20317, ss_coupon_amt#20318, ss_net_paid#20319, ss_net_paid_inc_tax#20320, ss_net_profit#20321, ss_sold_date_sk#20322L, d_date_sk#20323L, ... 86 more fields]
                                       +- Filter (((ss_sold_date_sk#20322L = d_date_sk#20323L) AND (ss_item_sk#20301L = i_item_sk#20380L)) AND ((ss_store_sk#20306L = s_store_sk#20351L) AND ((d_month_seq#20326 >= 1212) AND (d_month_seq#20326 <= (1212 + 11)))))
                                          +- Join Inner
                                             :- Join Inner
                                             :  :- Join Inner
                                             :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                             :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20300L,ss_item_sk#20301L,ss_customer_sk#20302L,ss_cdemo_sk#20303L,ss_hdemo_sk#20304L,ss_addr_sk#20305L,ss_store_sk#20306L,ss_promo_sk#20307L,ss_ticket_number#20308L,ss_quantity#20309,ss_wholesale_cost#20310,ss_list_price#20311,ss_sales_price#20312,ss_ext_discount_amt#20313,ss_ext_sales_price#20314,ss_ext_wholesale_cost#20315,ss_ext_list_price#20316,ss_ext_tax#20317,ss_coupon_amt#20318,ss_net_paid#20319,ss_net_paid_inc_tax#20320,ss_net_profit#20321,ss_sold_date_sk#20322L] orc
                                             :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                             :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20323L,d_date_id#20324,d_date#20325,d_month_seq#20326,d_week_seq#20327,d_quarter_seq#20328,d_year#20329,d_dow#20330,d_moy#20331,d_dom#20332,d_qoy#20333,d_fy_year#20334,d_fy_quarter_seq#20335,d_fy_week_seq#20336,d_day_name#20337,d_quarter_name#20338,d_holiday#20339,d_weekend#20340,d_following_holiday#20341,d_first_dom#20342,d_last_dom#20343,d_same_day_ly#20344,d_same_day_lq#20345,d_current_day#20346,... 4 more fields] orc
                                             :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                             :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20351L,s_store_id#20352,s_rec_start_date#20353,s_rec_end_date#20354,s_closed_date_sk#20355L,s_store_name#20356,s_number_employees#20357,s_floor_space#20358,s_hours#20359,s_manager#20360,s_market_id#20361,s_geography_class#20362,s_market_desc#20363,s_market_manager#20364,s_division_id#20365,s_division_name#20366,s_company_id#20367,s_company_name#20368,s_street_number#20369,s_street_name#20370,s_street_type#20371,s_suite_number#20372,s_city#20373,s_county#20374,... 5 more fields] orc
                                             +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                                +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#20380L,i_item_id#20381,i_rec_start_date#20382,i_rec_end_date#20383,i_item_desc#20384,i_current_price#20385,i_wholesale_cost#20386,i_brand_id#20387,i_brand#20388,i_class_id#20389,i_class#20390,i_category_id#20391,i_category#20392,i_manufact_id#20393,i_manufact#20394,i_size#20395,i_formulation#20396,i_color#20397,i_units#20398,i_container#20399,i_manager_id#20400,i_product_name#20401] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_category#20412 ASC NULLS FIRST, i_class#20413 ASC NULLS FIRST, i_brand#20414 ASC NULLS FIRST, i_product_name#20415 ASC NULLS FIRST, d_year#20416 ASC NULLS FIRST, d_qoy#20417 ASC NULLS FIRST, d_moy#20418 ASC NULLS FIRST, s_store_id#20419 ASC NULLS FIRST, sumsales#20296 ASC NULLS FIRST, rk#20297 ASC NULLS FIRST], true
      +- Filter (rk#20297 <= 100)
         +- Window [rank(sumsales#20296) windowspecdefinition(i_category#20412, sumsales#20296 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#20297], [i_category#20412], [sumsales#20296 DESC NULLS LAST]
            +- Aggregate [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L], [i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sum(coalesce((ss_sales_price#20312 * cast(ss_quantity#20309 as double)), 0.0)) AS sumsales#20296]
               +- Expand [[ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, s_store_id#20352, 0], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, null, 1], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, null, null, 3], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, null, null, null, 7], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, null, null, null, null, 15], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, null, null, null, null, null, 31], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, null, null, null, null, null, null, 63], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, null, null, null, null, null, null, null, 127], [ss_quantity#20309, ss_sales_price#20312, null, null, null, null, null, null, null, null, 255]], [ss_quantity#20309, ss_sales_price#20312, i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L]
                  +- Project [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, s_store_id#20352]
                     +- Join Inner, (ss_item_sk#20301L = i_item_sk#20380L)
                        :- Project [ss_item_sk#20301L, ss_quantity#20309, ss_sales_price#20312, d_year#20329, d_moy#20331, d_qoy#20333, s_store_id#20352]
                        :  +- Join Inner, (ss_store_sk#20306L = s_store_sk#20351L)
                        :     :- Project [ss_item_sk#20301L, ss_store_sk#20306L, ss_quantity#20309, ss_sales_price#20312, d_year#20329, d_moy#20331, d_qoy#20333]
                        :     :  +- Join Inner, (ss_sold_date_sk#20322L = d_date_sk#20323L)
                        :     :     :- Project [ss_item_sk#20301L, ss_store_sk#20306L, ss_quantity#20309, ss_sales_price#20312, ss_sold_date_sk#20322L]
                        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#20322L) AND isnotnull(ss_store_sk#20306L)) AND isnotnull(ss_item_sk#20301L)) AND dynamicpruning#20436 [ss_sold_date_sk#20322L])
                        :     :     :     :  +- Project [d_date_sk#20323L, d_year#20329, d_moy#20331, d_qoy#20333]
                        :     :     :     :     +- Filter ((isnotnull(d_month_seq#20326) AND ((d_month_seq#20326 >= 1212) AND (d_month_seq#20326 <= 1223))) AND isnotnull(d_date_sk#20323L))
                        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20323L,d_date_id#20324,d_date#20325,d_month_seq#20326,d_week_seq#20327,d_quarter_seq#20328,d_year#20329,d_dow#20330,d_moy#20331,d_dom#20332,d_qoy#20333,d_fy_year#20334,d_fy_quarter_seq#20335,d_fy_week_seq#20336,d_day_name#20337,d_quarter_name#20338,d_holiday#20339,d_weekend#20340,d_following_holiday#20341,d_first_dom#20342,d_last_dom#20343,d_same_day_ly#20344,d_same_day_lq#20345,d_current_day#20346,... 4 more fields] orc
                        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20300L,ss_item_sk#20301L,ss_customer_sk#20302L,ss_cdemo_sk#20303L,ss_hdemo_sk#20304L,ss_addr_sk#20305L,ss_store_sk#20306L,ss_promo_sk#20307L,ss_ticket_number#20308L,ss_quantity#20309,ss_wholesale_cost#20310,ss_list_price#20311,ss_sales_price#20312,ss_ext_discount_amt#20313,ss_ext_sales_price#20314,ss_ext_wholesale_cost#20315,ss_ext_list_price#20316,ss_ext_tax#20317,ss_coupon_amt#20318,ss_net_paid#20319,ss_net_paid_inc_tax#20320,ss_net_profit#20321,ss_sold_date_sk#20322L] orc
                        :     :     +- Project [d_date_sk#20323L, d_year#20329, d_moy#20331, d_qoy#20333]
                        :     :        +- Filter ((isnotnull(d_month_seq#20326) AND ((d_month_seq#20326 >= 1212) AND (d_month_seq#20326 <= 1223))) AND isnotnull(d_date_sk#20323L))
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20323L,d_date_id#20324,d_date#20325,d_month_seq#20326,d_week_seq#20327,d_quarter_seq#20328,d_year#20329,d_dow#20330,d_moy#20331,d_dom#20332,d_qoy#20333,d_fy_year#20334,d_fy_quarter_seq#20335,d_fy_week_seq#20336,d_day_name#20337,d_quarter_name#20338,d_holiday#20339,d_weekend#20340,d_following_holiday#20341,d_first_dom#20342,d_last_dom#20343,d_same_day_ly#20344,d_same_day_lq#20345,d_current_day#20346,... 4 more fields] orc
                        :     +- Project [s_store_sk#20351L, s_store_id#20352]
                        :        +- Filter isnotnull(s_store_sk#20351L)
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20351L,s_store_id#20352,s_rec_start_date#20353,s_rec_end_date#20354,s_closed_date_sk#20355L,s_store_name#20356,s_number_employees#20357,s_floor_space#20358,s_hours#20359,s_manager#20360,s_market_id#20361,s_geography_class#20362,s_market_desc#20363,s_market_manager#20364,s_division_id#20365,s_division_name#20366,s_company_id#20367,s_company_name#20368,s_street_number#20369,s_street_name#20370,s_street_type#20371,s_suite_number#20372,s_city#20373,s_county#20374,... 5 more fields] orc
                        +- Project [i_item_sk#20380L, i_brand#20388, i_class#20390, i_category#20392, i_product_name#20401]
                           +- Filter isnotnull(i_item_sk#20380L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#20380L,i_item_id#20381,i_rec_start_date#20382,i_rec_end_date#20383,i_item_desc#20384,i_current_price#20385,i_wholesale_cost#20386,i_brand_id#20387,i_brand#20388,i_class_id#20389,i_class#20390,i_category_id#20391,i_category#20392,i_manufact_id#20393,i_manufact#20394,i_size#20395,i_formulation#20396,i_color#20397,i_units#20398,i_container#20399,i_manager_id#20400,i_product_name#20401] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_category#20412 ASC NULLS FIRST,i_class#20413 ASC NULLS FIRST,i_brand#20414 ASC NULLS FIRST,i_product_name#20415 ASC NULLS FIRST,d_year#20416 ASC NULLS FIRST,d_qoy#20417 ASC NULLS FIRST,d_moy#20418 ASC NULLS FIRST,s_store_id#20419 ASC NULLS FIRST,sumsales#20296 ASC NULLS FIRST,rk#20297 ASC NULLS FIRST], output=[i_category#20412,i_class#20413,i_brand#20414,i_product_name#20415,d_year#20416,d_qoy#20417,d_moy#20418,s_store_id#20419,sumsales#20296,rk#20297])
   +- Filter (rk#20297 <= 100)
      +- Window [rank(sumsales#20296) windowspecdefinition(i_category#20412, sumsales#20296 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#20297], [i_category#20412], [sumsales#20296 DESC NULLS LAST]
         +- Sort [i_category#20412 ASC NULLS FIRST, sumsales#20296 DESC NULLS LAST], false, 0
            +- Exchange hashpartitioning(i_category#20412, 3000), ENSURE_REQUIREMENTS, [id=#21314]
               +- HashAggregate(keys=[i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L], functions=[sum(coalesce((ss_sales_price#20312 * cast(ss_quantity#20309 as double)), 0.0))], output=[i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, sumsales#20296])
                  +- Exchange hashpartitioning(i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L, 3000), ENSURE_REQUIREMENTS, [id=#21311]
                     +- HashAggregate(keys=[i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L], functions=[partial_sum(coalesce((ss_sales_price#20312 * cast(ss_quantity#20309 as double)), 0.0))], output=[i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L, sum#20438])
                        +- Expand [[ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, s_store_id#20352, 0], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, null, 1], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, null, null, 3], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, null, null, null, 7], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, null, null, null, null, 15], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, null, null, null, null, null, 31], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, null, null, null, null, null, null, 63], [ss_quantity#20309, ss_sales_price#20312, i_category#20392, null, null, null, null, null, null, null, 127], [ss_quantity#20309, ss_sales_price#20312, null, null, null, null, null, null, null, null, 255]], [ss_quantity#20309, ss_sales_price#20312, i_category#20412, i_class#20413, i_brand#20414, i_product_name#20415, d_year#20416, d_qoy#20417, d_moy#20418, s_store_id#20419, spark_grouping_id#20411L]
                           +- Project [ss_quantity#20309, ss_sales_price#20312, i_category#20392, i_class#20390, i_brand#20388, i_product_name#20401, d_year#20329, d_qoy#20333, d_moy#20331, s_store_id#20352]
                              +- SortMergeJoin [ss_item_sk#20301L], [i_item_sk#20380L], Inner
                                 :- Sort [ss_item_sk#20301L ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(ss_item_sk#20301L, 3000), ENSURE_REQUIREMENTS, [id=#21302]
                                 :     +- Project [ss_item_sk#20301L, ss_quantity#20309, ss_sales_price#20312, d_year#20329, d_moy#20331, d_qoy#20333, s_store_id#20352]
                                 :        +- BroadcastHashJoin [ss_store_sk#20306L], [s_store_sk#20351L], Inner, BuildRight, false
                                 :           :- Project [ss_item_sk#20301L, ss_store_sk#20306L, ss_quantity#20309, ss_sales_price#20312, d_year#20329, d_moy#20331, d_qoy#20333]
                                 :           :  +- BroadcastHashJoin [ss_sold_date_sk#20322L], [d_date_sk#20323L], Inner, BuildRight, false
                                 :           :     :- Filter (isnotnull(ss_store_sk#20306L) AND isnotnull(ss_item_sk#20301L))
                                 :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#20301L,ss_store_sk#20306L,ss_quantity#20309,ss_sales_price#20312,ss_sold_date_sk#20322L] Batched: true, DataFilters: [isnotnull(ss_store_sk#20306L), isnotnull(ss_item_sk#20301L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#20322L), dynamicpruningexpression(ss_sold_date_sk#20322L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_quantity:int,ss_sales_price:double>
                                 :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#20436, 0, true, Project [d_date_sk#20323L, d_year#20329, d_moy#20331, d_qoy#20333], [d_date_sk#20323L]
                                 :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                 :           :     :              +- Project [d_date_sk#20323L, d_year#20329, d_moy#20331, d_qoy#20333]
                                 :           :     :                 +- Filter (((isnotnull(d_month_seq#20326) AND (d_month_seq#20326 >= 1212)) AND (d_month_seq#20326 <= 1223)) AND isnotnull(d_date_sk#20323L))
                                 :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20323L,d_month_seq#20326,d_year#20329,d_moy#20331,d_qoy#20333] Batched: true, DataFilters: [isnotnull(d_month_seq#20326), (d_month_seq#20326 >= 1212), (d_month_seq#20326 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_year:int,d_moy:int,d_qoy:int>
                                 :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21293]
                                 :           :        +- Project [d_date_sk#20323L, d_year#20329, d_moy#20331, d_qoy#20333]
                                 :           :           +- Filter (((isnotnull(d_month_seq#20326) AND (d_month_seq#20326 >= 1212)) AND (d_month_seq#20326 <= 1223)) AND isnotnull(d_date_sk#20323L))
                                 :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20323L,d_month_seq#20326,d_year#20329,d_moy#20331,d_qoy#20333] Batched: true, DataFilters: [isnotnull(d_month_seq#20326), (d_month_seq#20326 >= 1212), (d_month_seq#20326 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int,d_year:int,d_moy:int,d_qoy:int>
                                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21297]
                                 :              +- Filter isnotnull(s_store_sk#20351L)
                                 :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20351L,s_store_id#20352] Batched: true, DataFilters: [isnotnull(s_store_sk#20351L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string>
                                 +- Sort [i_item_sk#20380L ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(i_item_sk#20380L, 3000), ENSURE_REQUIREMENTS, [id=#21303]
                                       +- Filter isnotnull(i_item_sk#20380L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#20380L,i_brand#20388,i_class#20390,i_category#20392,i_product_name#20401] Batched: true, DataFilters: [isnotnull(i_item_sk#20380L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_class:string,i_category:string,i_product_name:string>

read query: spark_queries/q68.sql
explain query: q68
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['c_last_name ASC NULLS FIRST, 'ss_ticket_number ASC NULLS FIRST], true
      +- 'Project ['c_last_name, 'c_first_name, 'ca_city, 'bought_city, 'ss_ticket_number, 'extended_price, 'extended_tax, 'list_price]
         +- 'Filter ((('ss_customer_sk = 'c_customer_sk) AND ('customer.c_current_addr_sk = 'current_addr.ca_address_sk)) AND NOT ('current_addr.ca_city = 'bought_city))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias dn
               :  :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'ca_city], ['ss_ticket_number, 'ss_customer_sk, 'ca_city AS bought_city#20439, 'sum('ss_ext_sales_price) AS extended_price#20440, 'sum('ss_ext_list_price) AS list_price#20441, 'sum('ss_ext_tax) AS extended_tax#20442]
               :  :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_store_sk = 'store.s_store_sk)) AND (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) AND ('store_sales.ss_addr_sk = 'customer_address.ca_address_sk))) AND (((('date_dim.d_dom >= 1) AND ('date_dim.d_dom <= 2)) AND (('household_demographics.hd_dep_count = 2) OR ('household_demographics.hd_vehicle_count = 1))) AND ('date_dim.d_year IN (1998,(1998 + 1),(1998 + 2)) AND 'store.s_city IN (Cedar Grove,Wildwood))))
               :  :        +- 'Join Inner
               :  :           :- 'Join Inner
               :  :           :  :- 'Join Inner
               :  :           :  :  :- 'Join Inner
               :  :           :  :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :           :  :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  :           :  :  +- 'UnresolvedRelation [store], [], false
               :  :           :  +- 'UnresolvedRelation [household_demographics], [], false
               :  :           +- 'UnresolvedRelation [customer_address], [], false
               :  +- 'UnresolvedRelation [customer], [], false
               +- 'SubqueryAlias current_addr
                  +- 'UnresolvedRelation [customer_address], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, ca_city: string, bought_city: string, ss_ticket_number: bigint, extended_price: double, extended_tax: double, list_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_last_name#20550 ASC NULLS FIRST, ss_ticket_number#20451L ASC NULLS FIRST], true
      +- Project [c_last_name#20550, c_first_name#20549, ca_city#20565, bought_city#20439, ss_ticket_number#20451L, extended_price#20440, extended_tax#20442, list_price#20441]
         +- Filter (((ss_customer_sk#20445L = c_customer_sk#20541L) AND (c_current_addr_sk#20545L = ca_address_sk#20559L)) AND NOT (ca_city#20565 = bought_city#20439))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias dn
               :  :  +- Aggregate [ss_ticket_number#20451L, ss_customer_sk#20445L, ss_addr_sk#20448L, ca_city#20534], [ss_ticket_number#20451L, ss_customer_sk#20445L, ca_city#20534 AS bought_city#20439, sum(ss_ext_sales_price#20457) AS extended_price#20440, sum(ss_ext_list_price#20459) AS list_price#20441, sum(ss_ext_tax#20460) AS extended_tax#20442]
               :  :     +- Filter ((((ss_sold_date_sk#20465L = d_date_sk#20466L) AND (ss_store_sk#20449L = s_store_sk#20494L)) AND ((ss_hdemo_sk#20447L = hd_demo_sk#20523L) AND (ss_addr_sk#20448L = ca_address_sk#20528L))) AND ((((d_dom#20475 >= 1) AND (d_dom#20475 <= 2)) AND ((hd_dep_count#20526 = 2) OR (hd_vehicle_count#20527 = 1))) AND (d_year#20472 IN (1998,(1998 + 1),(1998 + 2)) AND s_city#20516 IN (Cedar Grove,Wildwood))))
               :  :        +- Join Inner
               :  :           :- Join Inner
               :  :           :  :- Join Inner
               :  :           :  :  :- Join Inner
               :  :           :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :           :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20443L,ss_item_sk#20444L,ss_customer_sk#20445L,ss_cdemo_sk#20446L,ss_hdemo_sk#20447L,ss_addr_sk#20448L,ss_store_sk#20449L,ss_promo_sk#20450L,ss_ticket_number#20451L,ss_quantity#20452,ss_wholesale_cost#20453,ss_list_price#20454,ss_sales_price#20455,ss_ext_discount_amt#20456,ss_ext_sales_price#20457,ss_ext_wholesale_cost#20458,ss_ext_list_price#20459,ss_ext_tax#20460,ss_coupon_amt#20461,ss_net_paid#20462,ss_net_paid_inc_tax#20463,ss_net_profit#20464,ss_sold_date_sk#20465L] orc
               :  :           :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20466L,d_date_id#20467,d_date#20468,d_month_seq#20469,d_week_seq#20470,d_quarter_seq#20471,d_year#20472,d_dow#20473,d_moy#20474,d_dom#20475,d_qoy#20476,d_fy_year#20477,d_fy_quarter_seq#20478,d_fy_week_seq#20479,d_day_name#20480,d_quarter_name#20481,d_holiday#20482,d_weekend#20483,d_following_holiday#20484,d_first_dom#20485,d_last_dom#20486,d_same_day_ly#20487,d_same_day_lq#20488,d_current_day#20489,... 4 more fields] orc
               :  :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
               :  :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20494L,s_store_id#20495,s_rec_start_date#20496,s_rec_end_date#20497,s_closed_date_sk#20498L,s_store_name#20499,s_number_employees#20500,s_floor_space#20501,s_hours#20502,s_manager#20503,s_market_id#20504,s_geography_class#20505,s_market_desc#20506,s_market_manager#20507,s_division_id#20508,s_division_name#20509,s_company_id#20510,s_company_name#20511,s_street_number#20512,s_street_name#20513,s_street_type#20514,s_suite_number#20515,s_city#20516,s_county#20517,... 5 more fields] orc
               :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
               :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#20523L,hd_income_band_sk#20524L,hd_buy_potential#20525,hd_dep_count#20526,hd_vehicle_count#20527] orc
               :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20528L,ca_address_id#20529,ca_street_number#20530,ca_street_name#20531,ca_street_type#20532,ca_suite_number#20533,ca_city#20534,ca_county#20535,ca_state#20536,ca_zip#20537,ca_country#20538,ca_gmt_offset#20539,ca_location_type#20540] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20541L,c_customer_id#20542,c_current_cdemo_sk#20543L,c_current_hdemo_sk#20544L,c_current_addr_sk#20545L,c_first_shipto_date_sk#20546L,c_first_sales_date_sk#20547L,c_salutation#20548,c_first_name#20549,c_last_name#20550,c_preferred_cust_flag#20551,c_birth_day#20552,c_birth_month#20553,c_birth_year#20554,c_birth_country#20555,c_login#20556,c_email_address#20557,c_last_review_date#20558] orc
               +- SubqueryAlias current_addr
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20559L,ca_address_id#20560,ca_street_number#20561,ca_street_name#20562,ca_street_type#20563,ca_suite_number#20564,ca_city#20565,ca_county#20566,ca_state#20567,ca_zip#20568,ca_country#20569,ca_gmt_offset#20570,ca_location_type#20571] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_last_name#20550 ASC NULLS FIRST, ss_ticket_number#20451L ASC NULLS FIRST], true
      +- Project [c_last_name#20550, c_first_name#20549, ca_city#20565, bought_city#20439, ss_ticket_number#20451L, extended_price#20440, extended_tax#20442, list_price#20441]
         +- Join Inner, ((ss_customer_sk#20445L = c_customer_sk#20541L) AND NOT (ca_city#20565 = bought_city#20439))
            :- Project [c_customer_sk#20541L, c_first_name#20549, c_last_name#20550, ca_city#20565]
            :  +- Join Inner, (c_current_addr_sk#20545L = ca_address_sk#20559L)
            :     :- Project [c_customer_sk#20541L, c_current_addr_sk#20545L, c_first_name#20549, c_last_name#20550]
            :     :  +- Filter (isnotnull(c_customer_sk#20541L) AND isnotnull(c_current_addr_sk#20545L))
            :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20541L,c_customer_id#20542,c_current_cdemo_sk#20543L,c_current_hdemo_sk#20544L,c_current_addr_sk#20545L,c_first_shipto_date_sk#20546L,c_first_sales_date_sk#20547L,c_salutation#20548,c_first_name#20549,c_last_name#20550,c_preferred_cust_flag#20551,c_birth_day#20552,c_birth_month#20553,c_birth_year#20554,c_birth_country#20555,c_login#20556,c_email_address#20557,c_last_review_date#20558] orc
            :     +- Project [ca_address_sk#20559L, ca_city#20565]
            :        +- Filter (isnotnull(ca_address_sk#20559L) AND isnotnull(ca_city#20565))
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20559L,ca_address_id#20560,ca_street_number#20561,ca_street_name#20562,ca_street_type#20563,ca_suite_number#20564,ca_city#20565,ca_county#20566,ca_state#20567,ca_zip#20568,ca_country#20569,ca_gmt_offset#20570,ca_location_type#20571] orc
            +- Aggregate [ss_ticket_number#20451L, ss_customer_sk#20445L, ss_addr_sk#20448L, ca_city#20534], [ss_ticket_number#20451L, ss_customer_sk#20445L, ca_city#20534 AS bought_city#20439, sum(ss_ext_sales_price#20457) AS extended_price#20440, sum(ss_ext_list_price#20459) AS list_price#20441, sum(ss_ext_tax#20460) AS extended_tax#20442]
               +- Project [ss_customer_sk#20445L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460, ca_city#20534]
                  +- Join Inner, (ss_addr_sk#20448L = ca_address_sk#20528L)
                     :- Project [ss_customer_sk#20445L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                     :  +- Join Inner, (ss_hdemo_sk#20447L = hd_demo_sk#20523L)
                     :     :- Project [ss_customer_sk#20445L, ss_hdemo_sk#20447L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                     :     :  +- Join Inner, (ss_store_sk#20449L = s_store_sk#20494L)
                     :     :     :- Project [ss_customer_sk#20445L, ss_hdemo_sk#20447L, ss_addr_sk#20448L, ss_store_sk#20449L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                     :     :     :  +- Join Inner, (ss_sold_date_sk#20465L = d_date_sk#20466L)
                     :     :     :     :- Project [ss_customer_sk#20445L, ss_hdemo_sk#20447L, ss_addr_sk#20448L, ss_store_sk#20449L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460, ss_sold_date_sk#20465L]
                     :     :     :     :  +- Filter (((((isnotnull(ss_sold_date_sk#20465L) AND isnotnull(ss_store_sk#20449L)) AND isnotnull(ss_hdemo_sk#20447L)) AND isnotnull(ss_addr_sk#20448L)) AND isnotnull(ss_customer_sk#20445L)) AND dynamicpruning#20583 [ss_sold_date_sk#20465L])
                     :     :     :     :     :  +- Project [d_date_sk#20466L]
                     :     :     :     :     :     +- Filter ((isnotnull(d_dom#20475) AND (((d_dom#20475 >= 1) AND (d_dom#20475 <= 2)) AND d_year#20472 IN (1998,1999,2000))) AND isnotnull(d_date_sk#20466L))
                     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20466L,d_date_id#20467,d_date#20468,d_month_seq#20469,d_week_seq#20470,d_quarter_seq#20471,d_year#20472,d_dow#20473,d_moy#20474,d_dom#20475,d_qoy#20476,d_fy_year#20477,d_fy_quarter_seq#20478,d_fy_week_seq#20479,d_day_name#20480,d_quarter_name#20481,d_holiday#20482,d_weekend#20483,d_following_holiday#20484,d_first_dom#20485,d_last_dom#20486,d_same_day_ly#20487,d_same_day_lq#20488,d_current_day#20489,... 4 more fields] orc
                     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20443L,ss_item_sk#20444L,ss_customer_sk#20445L,ss_cdemo_sk#20446L,ss_hdemo_sk#20447L,ss_addr_sk#20448L,ss_store_sk#20449L,ss_promo_sk#20450L,ss_ticket_number#20451L,ss_quantity#20452,ss_wholesale_cost#20453,ss_list_price#20454,ss_sales_price#20455,ss_ext_discount_amt#20456,ss_ext_sales_price#20457,ss_ext_wholesale_cost#20458,ss_ext_list_price#20459,ss_ext_tax#20460,ss_coupon_amt#20461,ss_net_paid#20462,ss_net_paid_inc_tax#20463,ss_net_profit#20464,ss_sold_date_sk#20465L] orc
                     :     :     :     +- Project [d_date_sk#20466L]
                     :     :     :        +- Filter ((isnotnull(d_dom#20475) AND (((d_dom#20475 >= 1) AND (d_dom#20475 <= 2)) AND d_year#20472 IN (1998,1999,2000))) AND isnotnull(d_date_sk#20466L))
                     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20466L,d_date_id#20467,d_date#20468,d_month_seq#20469,d_week_seq#20470,d_quarter_seq#20471,d_year#20472,d_dow#20473,d_moy#20474,d_dom#20475,d_qoy#20476,d_fy_year#20477,d_fy_quarter_seq#20478,d_fy_week_seq#20479,d_day_name#20480,d_quarter_name#20481,d_holiday#20482,d_weekend#20483,d_following_holiday#20484,d_first_dom#20485,d_last_dom#20486,d_same_day_ly#20487,d_same_day_lq#20488,d_current_day#20489,... 4 more fields] orc
                     :     :     +- Project [s_store_sk#20494L]
                     :     :        +- Filter (s_city#20516 IN (Cedar Grove,Wildwood) AND isnotnull(s_store_sk#20494L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20494L,s_store_id#20495,s_rec_start_date#20496,s_rec_end_date#20497,s_closed_date_sk#20498L,s_store_name#20499,s_number_employees#20500,s_floor_space#20501,s_hours#20502,s_manager#20503,s_market_id#20504,s_geography_class#20505,s_market_desc#20506,s_market_manager#20507,s_division_id#20508,s_division_name#20509,s_company_id#20510,s_company_name#20511,s_street_number#20512,s_street_name#20513,s_street_type#20514,s_suite_number#20515,s_city#20516,s_county#20517,... 5 more fields] orc
                     :     +- Project [hd_demo_sk#20523L]
                     :        +- Filter (((hd_dep_count#20526 = 2) OR (hd_vehicle_count#20527 = 1)) AND isnotnull(hd_demo_sk#20523L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#20523L,hd_income_band_sk#20524L,hd_buy_potential#20525,hd_dep_count#20526,hd_vehicle_count#20527] orc
                     +- Project [ca_address_sk#20528L, ca_city#20534]
                        +- Filter (isnotnull(ca_address_sk#20528L) AND isnotnull(ca_city#20534))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20528L,ca_address_id#20529,ca_street_number#20530,ca_street_name#20531,ca_street_type#20532,ca_suite_number#20533,ca_city#20534,ca_county#20535,ca_state#20536,ca_zip#20537,ca_country#20538,ca_gmt_offset#20539,ca_location_type#20540] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_last_name#20550 ASC NULLS FIRST,ss_ticket_number#20451L ASC NULLS FIRST], output=[c_last_name#20550,c_first_name#20549,ca_city#20565,bought_city#20439,ss_ticket_number#20451L,extended_price#20440,extended_tax#20442,list_price#20441])
   +- Project [c_last_name#20550, c_first_name#20549, ca_city#20565, bought_city#20439, ss_ticket_number#20451L, extended_price#20440, extended_tax#20442, list_price#20441]
      +- SortMergeJoin [c_customer_sk#20541L], [ss_customer_sk#20445L], Inner, NOT (ca_city#20565 = bought_city#20439)
         :- Sort [c_customer_sk#20541L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(c_customer_sk#20541L, 3000), ENSURE_REQUIREMENTS, [id=#21500]
         :     +- Project [c_customer_sk#20541L, c_first_name#20549, c_last_name#20550, ca_city#20565]
         :        +- SortMergeJoin [c_current_addr_sk#20545L], [ca_address_sk#20559L], Inner
         :           :- Sort [c_current_addr_sk#20545L ASC NULLS FIRST], false, 0
         :           :  +- Exchange hashpartitioning(c_current_addr_sk#20545L, 3000), ENSURE_REQUIREMENTS, [id=#21471]
         :           :     +- Filter (isnotnull(c_customer_sk#20541L) AND isnotnull(c_current_addr_sk#20545L))
         :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20541L,c_current_addr_sk#20545L,c_first_name#20549,c_last_name#20550] Batched: true, DataFilters: [isnotnull(c_customer_sk#20541L), isnotnull(c_current_addr_sk#20545L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_addr_sk:bigint,c_first_name:string,c_last_name:string>
         :           +- Sort [ca_address_sk#20559L ASC NULLS FIRST], false, 0
         :              +- Exchange hashpartitioning(ca_address_sk#20559L, 3000), ENSURE_REQUIREMENTS, [id=#21472]
         :                 +- Filter (isnotnull(ca_address_sk#20559L) AND isnotnull(ca_city#20565))
         :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20559L,ca_city#20565] Batched: true, DataFilters: [isnotnull(ca_address_sk#20559L), isnotnull(ca_city#20565)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string>
         +- Sort [ss_customer_sk#20445L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(ss_customer_sk#20445L, 3000), ENSURE_REQUIREMENTS, [id=#21501]
               +- HashAggregate(keys=[ss_ticket_number#20451L, ss_customer_sk#20445L, ss_addr_sk#20448L, ca_city#20534], functions=[sum(ss_ext_sales_price#20457), sum(ss_ext_list_price#20459), sum(ss_ext_tax#20460)], output=[ss_ticket_number#20451L, ss_customer_sk#20445L, bought_city#20439, extended_price#20440, list_price#20441, extended_tax#20442])
                  +- HashAggregate(keys=[ss_ticket_number#20451L, ss_customer_sk#20445L, ss_addr_sk#20448L, ca_city#20534], functions=[partial_sum(ss_ext_sales_price#20457), partial_sum(ss_ext_list_price#20459), partial_sum(ss_ext_tax#20460)], output=[ss_ticket_number#20451L, ss_customer_sk#20445L, ss_addr_sk#20448L, ca_city#20534, sum#20587, sum#20588, sum#20589])
                     +- Project [ss_customer_sk#20445L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460, ca_city#20534]
                        +- SortMergeJoin [ss_addr_sk#20448L], [ca_address_sk#20528L], Inner
                           :- Sort [ss_addr_sk#20448L ASC NULLS FIRST], false, 0
                           :  +- Exchange hashpartitioning(ss_addr_sk#20448L, 3000), ENSURE_REQUIREMENTS, [id=#21490]
                           :     +- Project [ss_customer_sk#20445L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                           :        +- BroadcastHashJoin [ss_hdemo_sk#20447L], [hd_demo_sk#20523L], Inner, BuildRight, false
                           :           :- Project [ss_customer_sk#20445L, ss_hdemo_sk#20447L, ss_addr_sk#20448L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                           :           :  +- BroadcastHashJoin [ss_store_sk#20449L], [s_store_sk#20494L], Inner, BuildRight, false
                           :           :     :- Project [ss_customer_sk#20445L, ss_hdemo_sk#20447L, ss_addr_sk#20448L, ss_store_sk#20449L, ss_ticket_number#20451L, ss_ext_sales_price#20457, ss_ext_list_price#20459, ss_ext_tax#20460]
                           :           :     :  +- BroadcastHashJoin [ss_sold_date_sk#20465L], [d_date_sk#20466L], Inner, BuildRight, false
                           :           :     :     :- Filter (((isnotnull(ss_store_sk#20449L) AND isnotnull(ss_hdemo_sk#20447L)) AND isnotnull(ss_addr_sk#20448L)) AND isnotnull(ss_customer_sk#20445L))
                           :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#20445L,ss_hdemo_sk#20447L,ss_addr_sk#20448L,ss_store_sk#20449L,ss_ticket_number#20451L,ss_ext_sales_price#20457,ss_ext_list_price#20459,ss_ext_tax#20460,ss_sold_date_sk#20465L] Batched: true, DataFilters: [isnotnull(ss_store_sk#20449L), isnotnull(ss_hdemo_sk#20447L), isnotnull(ss_addr_sk#20448L), isno..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#20465L), dynamicpruningexpression(ss_sold_date_sk#20465L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:bigint,ss_store_sk:bigint,ss_ticket_nu...
                           :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#20583, 0, true, Project [d_date_sk#20466L], [d_date_sk#20466L]
                           :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                           :           :     :     :              +- Project [d_date_sk#20466L]
                           :           :     :     :                 +- Filter ((((isnotnull(d_dom#20475) AND (d_dom#20475 >= 1)) AND (d_dom#20475 <= 2)) AND d_year#20472 IN (1998,1999,2000)) AND isnotnull(d_date_sk#20466L))
                           :           :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20466L,d_year#20472,d_dom#20475] Batched: true, DataFilters: [isnotnull(d_dom#20475), (d_dom#20475 >= 1), (d_dom#20475 <= 2), d_year#20472 IN (1998,1999,2000)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [1998,1999,2..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
                           :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21477]
                           :           :     :        +- Project [d_date_sk#20466L]
                           :           :     :           +- Filter ((((isnotnull(d_dom#20475) AND (d_dom#20475 >= 1)) AND (d_dom#20475 <= 2)) AND d_year#20472 IN (1998,1999,2000)) AND isnotnull(d_date_sk#20466L))
                           :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20466L,d_year#20472,d_dom#20475] Batched: true, DataFilters: [isnotnull(d_dom#20475), (d_dom#20475 >= 1), (d_dom#20475 <= 2), d_year#20472 IN (1998,1999,2000)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [1998,1999,2..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
                           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21481]
                           :           :        +- Project [s_store_sk#20494L]
                           :           :           +- Filter (s_city#20516 IN (Cedar Grove,Wildwood) AND isnotnull(s_store_sk#20494L))
                           :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20494L,s_city#20516] Batched: true, DataFilters: [s_city#20516 IN (Cedar Grove,Wildwood), isnotnull(s_store_sk#20494L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_city, [Cedar Grove,Wildwood]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_city:string>
                           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21485]
                           :              +- Project [hd_demo_sk#20523L]
                           :                 +- Filter (((hd_dep_count#20526 = 2) OR (hd_vehicle_count#20527 = 1)) AND isnotnull(hd_demo_sk#20523L))
                           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#20523L,hd_dep_count#20526,hd_vehicle_count#20527] Batched: true, DataFilters: [((hd_dep_count#20526 = 2) OR (hd_vehicle_count#20527 = 1)), isnotnull(hd_demo_sk#20523L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,2),EqualTo(hd_vehicle_count,1)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
                           +- Sort [ca_address_sk#20528L ASC NULLS FIRST], false, 0
                              +- Exchange hashpartitioning(ca_address_sk#20528L, 3000), ENSURE_REQUIREMENTS, [id=#21491]
                                 +- Filter (isnotnull(ca_address_sk#20528L) AND isnotnull(ca_city#20534))
                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20528L,ca_city#20534] Batched: true, DataFilters: [isnotnull(ca_address_sk#20528L), isnotnull(ca_city#20534)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string>

read query: spark_queries/q69.sql
explain query: q69
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_education_status ASC NULLS FIRST, 'cd_purchase_estimate ASC NULLS FIRST, 'cd_credit_rating ASC NULLS FIRST], true
      +- 'Aggregate ['cd_gender, 'cd_marital_status, 'cd_education_status, 'cd_purchase_estimate, 'cd_credit_rating], ['cd_gender, 'cd_marital_status, 'cd_education_status, 'count(1) AS cnt1#20590, 'cd_purchase_estimate, 'count(1) AS cnt2#20591, 'cd_credit_rating, 'count(1) AS cnt3#20592]
         +- 'Filter (((('c.c_current_addr_sk = 'ca.ca_address_sk) AND 'ca_state IN (CO,IL,MN)) AND ('cd_demo_sk = 'c.c_current_cdemo_sk)) AND (exists#20593 [] AND (NOT exists#20594 [] AND NOT exists#20595 [])))
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND (('d_moy >= 1) AND ('d_moy <= (1 + 2)))))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [store_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  :- 'Project [*]
            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND (('d_moy >= 1) AND ('d_moy <= (1 + 2)))))
            :  :     +- 'Join Inner
            :  :        :- 'UnresolvedRelation [web_sales], [], false
            :  :        +- 'UnresolvedRelation [date_dim], [], false
            :  +- 'Project [*]
            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND (('d_year = 1999) AND (('d_moy >= 1) AND ('d_moy <= (1 + 2)))))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [catalog_sales], [], false
            :           +- 'UnresolvedRelation [date_dim], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'SubqueryAlias c
               :  :  +- 'UnresolvedRelation [customer], [], false
               :  +- 'SubqueryAlias ca
               :     +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [customer_demographics], [], false

== Analyzed Logical Plan ==
cd_gender: string, cd_marital_status: string, cd_education_status: string, cnt1: bigint, cd_purchase_estimate: int, cnt2: bigint, cd_credit_rating: string, cnt3: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cd_gender#20631 ASC NULLS FIRST, cd_marital_status#20632 ASC NULLS FIRST, cd_education_status#20633 ASC NULLS FIRST, cd_purchase_estimate#20634 ASC NULLS FIRST, cd_credit_rating#20635 ASC NULLS FIRST], true
      +- Aggregate [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635], [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, count(1) AS cnt1#20590L, cd_purchase_estimate#20634, count(1) AS cnt2#20591L, cd_credit_rating#20635, count(1) AS cnt3#20592L]
         +- Filter ((((c_current_addr_sk#20603L = ca_address_sk#20617L) AND ca_state#20625 IN (CO,IL,MN)) AND (cd_demo_sk#20630L = c_current_cdemo_sk#20601L)) AND (exists#20593 [c_customer_sk#20599L] AND (NOT exists#20594 [c_customer_sk#20599L] AND NOT exists#20595 [c_customer_sk#20599L])))
            :  :- Project [ss_sold_time_sk#20639L, ss_item_sk#20640L, ss_customer_sk#20641L, ss_cdemo_sk#20642L, ss_hdemo_sk#20643L, ss_addr_sk#20644L, ss_store_sk#20645L, ss_promo_sk#20646L, ss_ticket_number#20647L, ss_quantity#20648, ss_wholesale_cost#20649, ss_list_price#20650, ss_sales_price#20651, ss_ext_discount_amt#20652, ss_ext_sales_price#20653, ss_ext_wholesale_cost#20654, ss_ext_list_price#20655, ss_ext_tax#20656, ss_coupon_amt#20657, ss_net_paid#20658, ss_net_paid_inc_tax#20659, ss_net_profit#20660, ss_sold_date_sk#20661L, d_date_sk#20662L, ... 27 more fields]
            :  :  +- Filter (((outer(c_customer_sk#20599L) = ss_customer_sk#20641L) AND (ss_sold_date_sk#20661L = d_date_sk#20662L)) AND ((d_year#20668 = 1999) AND ((d_moy#20670 >= 1) AND (d_moy#20670 <= (1 + 2)))))
            :  :     +- Join Inner
            :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
            :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20639L,ss_item_sk#20640L,ss_customer_sk#20641L,ss_cdemo_sk#20642L,ss_hdemo_sk#20643L,ss_addr_sk#20644L,ss_store_sk#20645L,ss_promo_sk#20646L,ss_ticket_number#20647L,ss_quantity#20648,ss_wholesale_cost#20649,ss_list_price#20650,ss_sales_price#20651,ss_ext_discount_amt#20652,ss_ext_sales_price#20653,ss_ext_wholesale_cost#20654,ss_ext_list_price#20655,ss_ext_tax#20656,ss_coupon_amt#20657,ss_net_paid#20658,ss_net_paid_inc_tax#20659,ss_net_profit#20660,ss_sold_date_sk#20661L] orc
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20662L,d_date_id#20663,d_date#20664,d_month_seq#20665,d_week_seq#20666,d_quarter_seq#20667,d_year#20668,d_dow#20669,d_moy#20670,d_dom#20671,d_qoy#20672,d_fy_year#20673,d_fy_quarter_seq#20674,d_fy_week_seq#20675,d_day_name#20676,d_quarter_name#20677,d_holiday#20678,d_weekend#20679,d_following_holiday#20680,d_first_dom#20681,d_last_dom#20682,d_same_day_ly#20683,d_same_day_lq#20684,d_current_day#20685,... 4 more fields] orc
            :  :- Project [ws_sold_time_sk#20690L, ws_ship_date_sk#20691L, ws_item_sk#20692L, ws_bill_customer_sk#20693L, ws_bill_cdemo_sk#20694L, ws_bill_hdemo_sk#20695L, ws_bill_addr_sk#20696L, ws_ship_customer_sk#20697L, ws_ship_cdemo_sk#20698L, ws_ship_hdemo_sk#20699L, ws_ship_addr_sk#20700L, ws_web_page_sk#20701L, ws_web_site_sk#20702L, ws_ship_mode_sk#20703L, ws_warehouse_sk#20704L, ws_promo_sk#20705L, ws_order_number#20706L, ws_quantity#20707, ws_wholesale_cost#20708, ws_list_price#20709, ws_sales_price#20710, ws_ext_discount_amt#20711, ws_ext_sales_price#20712, ws_ext_wholesale_cost#20713, ... 38 more fields]
            :  :  +- Filter (((outer(c_customer_sk#20599L) = ws_bill_customer_sk#20693L) AND (ws_sold_date_sk#20723L = d_date_sk#20724L)) AND ((d_year#20730 = 1999) AND ((d_moy#20732 >= 1) AND (d_moy#20732 <= (1 + 2)))))
            :  :     +- Join Inner
            :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#20690L,ws_ship_date_sk#20691L,ws_item_sk#20692L,ws_bill_customer_sk#20693L,ws_bill_cdemo_sk#20694L,ws_bill_hdemo_sk#20695L,ws_bill_addr_sk#20696L,ws_ship_customer_sk#20697L,ws_ship_cdemo_sk#20698L,ws_ship_hdemo_sk#20699L,ws_ship_addr_sk#20700L,ws_web_page_sk#20701L,ws_web_site_sk#20702L,ws_ship_mode_sk#20703L,ws_warehouse_sk#20704L,ws_promo_sk#20705L,ws_order_number#20706L,ws_quantity#20707,ws_wholesale_cost#20708,ws_list_price#20709,ws_sales_price#20710,ws_ext_discount_amt#20711,ws_ext_sales_price#20712,ws_ext_wholesale_cost#20713,... 10 more fields] orc
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20724L,d_date_id#20725,d_date#20726,d_month_seq#20727,d_week_seq#20728,d_quarter_seq#20729,d_year#20730,d_dow#20731,d_moy#20732,d_dom#20733,d_qoy#20734,d_fy_year#20735,d_fy_quarter_seq#20736,d_fy_week_seq#20737,d_day_name#20738,d_quarter_name#20739,d_holiday#20740,d_weekend#20741,d_following_holiday#20742,d_first_dom#20743,d_last_dom#20744,d_same_day_ly#20745,d_same_day_lq#20746,d_current_day#20747,... 4 more fields] orc
            :  +- Project [cs_sold_time_sk#20752L, cs_ship_date_sk#20753L, cs_bill_customer_sk#20754L, cs_bill_cdemo_sk#20755L, cs_bill_hdemo_sk#20756L, cs_bill_addr_sk#20757L, cs_ship_customer_sk#20758L, cs_ship_cdemo_sk#20759L, cs_ship_hdemo_sk#20760L, cs_ship_addr_sk#20761L, cs_call_center_sk#20762L, cs_catalog_page_sk#20763L, cs_ship_mode_sk#20764L, cs_warehouse_sk#20765L, cs_item_sk#20766L, cs_promo_sk#20767L, cs_order_number#20768L, cs_quantity#20769, cs_wholesale_cost#20770, cs_list_price#20771, cs_sales_price#20772, cs_ext_discount_amt#20773, cs_ext_sales_price#20774, cs_ext_wholesale_cost#20775, ... 38 more fields]
            :     +- Filter (((outer(c_customer_sk#20599L) = cs_ship_customer_sk#20758L) AND (cs_sold_date_sk#20785L = d_date_sk#20786L)) AND ((d_year#20792 = 1999) AND ((d_moy#20794 >= 1) AND (d_moy#20794 <= (1 + 2)))))
            :        +- Join Inner
            :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
            :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#20752L,cs_ship_date_sk#20753L,cs_bill_customer_sk#20754L,cs_bill_cdemo_sk#20755L,cs_bill_hdemo_sk#20756L,cs_bill_addr_sk#20757L,cs_ship_customer_sk#20758L,cs_ship_cdemo_sk#20759L,cs_ship_hdemo_sk#20760L,cs_ship_addr_sk#20761L,cs_call_center_sk#20762L,cs_catalog_page_sk#20763L,cs_ship_mode_sk#20764L,cs_warehouse_sk#20765L,cs_item_sk#20766L,cs_promo_sk#20767L,cs_order_number#20768L,cs_quantity#20769,cs_wholesale_cost#20770,cs_list_price#20771,cs_sales_price#20772,cs_ext_discount_amt#20773,cs_ext_sales_price#20774,cs_ext_wholesale_cost#20775,... 10 more fields] orc
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20786L,d_date_id#20787,d_date#20788,d_month_seq#20789,d_week_seq#20790,d_quarter_seq#20791,d_year#20792,d_dow#20793,d_moy#20794,d_dom#20795,d_qoy#20796,d_fy_year#20797,d_fy_quarter_seq#20798,d_fy_week_seq#20799,d_day_name#20800,d_quarter_name#20801,d_holiday#20802,d_weekend#20803,d_following_holiday#20804,d_first_dom#20805,d_last_dom#20806,d_same_day_ly#20807,d_same_day_lq#20808,d_current_day#20809,... 4 more fields] orc
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias c
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20599L,c_customer_id#20600,c_current_cdemo_sk#20601L,c_current_hdemo_sk#20602L,c_current_addr_sk#20603L,c_first_shipto_date_sk#20604L,c_first_sales_date_sk#20605L,c_salutation#20606,c_first_name#20607,c_last_name#20608,c_preferred_cust_flag#20609,c_birth_day#20610,c_birth_month#20611,c_birth_year#20612,c_birth_country#20613,c_login#20614,c_email_address#20615,c_last_review_date#20616] orc
               :  +- SubqueryAlias ca
               :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20617L,ca_address_id#20618,ca_street_number#20619,ca_street_name#20620,ca_street_type#20621,ca_suite_number#20622,ca_city#20623,ca_county#20624,ca_state#20625,ca_zip#20626,ca_country#20627,ca_gmt_offset#20628,ca_location_type#20629] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#20630L,cd_gender#20631,cd_marital_status#20632,cd_education_status#20633,cd_purchase_estimate#20634,cd_credit_rating#20635,cd_dep_count#20636,cd_dep_employed_count#20637,cd_dep_college_count#20638] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [cd_gender#20631 ASC NULLS FIRST, cd_marital_status#20632 ASC NULLS FIRST, cd_education_status#20633 ASC NULLS FIRST, cd_purchase_estimate#20634 ASC NULLS FIRST, cd_credit_rating#20635 ASC NULLS FIRST], true
      +- Aggregate [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635], [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, count(1) AS cnt1#20590L, cd_purchase_estimate#20634, count(1) AS cnt2#20591L, cd_credit_rating#20635, count(1) AS cnt3#20592L]
         +- Project [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635]
            +- Join Inner, (cd_demo_sk#20630L = c_current_cdemo_sk#20601L)
               :- Project [c_current_cdemo_sk#20601L]
               :  +- Join Inner, (c_current_addr_sk#20603L = ca_address_sk#20617L)
               :     :- Project [c_current_cdemo_sk#20601L, c_current_addr_sk#20603L]
               :     :  +- Join LeftAnti, (c_customer_sk#20599L = cs_ship_customer_sk#20758L)
               :     :     :- Join LeftAnti, (c_customer_sk#20599L = ws_bill_customer_sk#20693L)
               :     :     :  :- Join LeftSemi, (c_customer_sk#20599L = ss_customer_sk#20641L)
               :     :     :  :  :- Project [c_customer_sk#20599L, c_current_cdemo_sk#20601L, c_current_addr_sk#20603L]
               :     :     :  :  :  +- Filter (isnotnull(c_current_addr_sk#20603L) AND isnotnull(c_current_cdemo_sk#20601L))
               :     :     :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20599L,c_customer_id#20600,c_current_cdemo_sk#20601L,c_current_hdemo_sk#20602L,c_current_addr_sk#20603L,c_first_shipto_date_sk#20604L,c_first_sales_date_sk#20605L,c_salutation#20606,c_first_name#20607,c_last_name#20608,c_preferred_cust_flag#20609,c_birth_day#20610,c_birth_month#20611,c_birth_year#20612,c_birth_country#20613,c_login#20614,c_email_address#20615,c_last_review_date#20616] orc
               :     :     :  :  +- Project [ss_customer_sk#20641L]
               :     :     :  :     +- Join Inner, (ss_sold_date_sk#20661L = d_date_sk#20662L)
               :     :     :  :        :- Project [ss_customer_sk#20641L, ss_sold_date_sk#20661L]
               :     :     :  :        :  +- Filter (isnotnull(ss_sold_date_sk#20661L) AND dynamicpruning#20822 [ss_sold_date_sk#20661L])
               :     :     :  :        :     :  +- Project [d_date_sk#20662L]
               :     :     :  :        :     :     +- Filter (((isnotnull(d_year#20668) AND isnotnull(d_moy#20670)) AND (((d_year#20668 = 1999) AND (d_moy#20670 >= 1)) AND (d_moy#20670 <= 3))) AND isnotnull(d_date_sk#20662L))
               :     :     :  :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20662L,d_date_id#20663,d_date#20664,d_month_seq#20665,d_week_seq#20666,d_quarter_seq#20667,d_year#20668,d_dow#20669,d_moy#20670,d_dom#20671,d_qoy#20672,d_fy_year#20673,d_fy_quarter_seq#20674,d_fy_week_seq#20675,d_day_name#20676,d_quarter_name#20677,d_holiday#20678,d_weekend#20679,d_following_holiday#20680,d_first_dom#20681,d_last_dom#20682,d_same_day_ly#20683,d_same_day_lq#20684,d_current_day#20685,... 4 more fields] orc
               :     :     :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20639L,ss_item_sk#20640L,ss_customer_sk#20641L,ss_cdemo_sk#20642L,ss_hdemo_sk#20643L,ss_addr_sk#20644L,ss_store_sk#20645L,ss_promo_sk#20646L,ss_ticket_number#20647L,ss_quantity#20648,ss_wholesale_cost#20649,ss_list_price#20650,ss_sales_price#20651,ss_ext_discount_amt#20652,ss_ext_sales_price#20653,ss_ext_wholesale_cost#20654,ss_ext_list_price#20655,ss_ext_tax#20656,ss_coupon_amt#20657,ss_net_paid#20658,ss_net_paid_inc_tax#20659,ss_net_profit#20660,ss_sold_date_sk#20661L] orc
               :     :     :  :        +- Project [d_date_sk#20662L]
               :     :     :  :           +- Filter (((isnotnull(d_year#20668) AND isnotnull(d_moy#20670)) AND (((d_year#20668 = 1999) AND (d_moy#20670 >= 1)) AND (d_moy#20670 <= 3))) AND isnotnull(d_date_sk#20662L))
               :     :     :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20662L,d_date_id#20663,d_date#20664,d_month_seq#20665,d_week_seq#20666,d_quarter_seq#20667,d_year#20668,d_dow#20669,d_moy#20670,d_dom#20671,d_qoy#20672,d_fy_year#20673,d_fy_quarter_seq#20674,d_fy_week_seq#20675,d_day_name#20676,d_quarter_name#20677,d_holiday#20678,d_weekend#20679,d_following_holiday#20680,d_first_dom#20681,d_last_dom#20682,d_same_day_ly#20683,d_same_day_lq#20684,d_current_day#20685,... 4 more fields] orc
               :     :     :  +- Project [ws_bill_customer_sk#20693L]
               :     :     :     +- Join Inner, (ws_sold_date_sk#20723L = d_date_sk#20724L)
               :     :     :        :- Project [ws_bill_customer_sk#20693L, ws_sold_date_sk#20723L]
               :     :     :        :  +- Filter (isnotnull(ws_sold_date_sk#20723L) AND dynamicpruning#20823 [ws_sold_date_sk#20723L])
               :     :     :        :     :  +- Project [d_date_sk#20724L]
               :     :     :        :     :     +- Filter (((isnotnull(d_year#20730) AND isnotnull(d_moy#20732)) AND (((d_year#20730 = 1999) AND (d_moy#20732 >= 1)) AND (d_moy#20732 <= 3))) AND isnotnull(d_date_sk#20724L))
               :     :     :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20724L,d_date_id#20725,d_date#20726,d_month_seq#20727,d_week_seq#20728,d_quarter_seq#20729,d_year#20730,d_dow#20731,d_moy#20732,d_dom#20733,d_qoy#20734,d_fy_year#20735,d_fy_quarter_seq#20736,d_fy_week_seq#20737,d_day_name#20738,d_quarter_name#20739,d_holiday#20740,d_weekend#20741,d_following_holiday#20742,d_first_dom#20743,d_last_dom#20744,d_same_day_ly#20745,d_same_day_lq#20746,d_current_day#20747,... 4 more fields] orc
               :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#20690L,ws_ship_date_sk#20691L,ws_item_sk#20692L,ws_bill_customer_sk#20693L,ws_bill_cdemo_sk#20694L,ws_bill_hdemo_sk#20695L,ws_bill_addr_sk#20696L,ws_ship_customer_sk#20697L,ws_ship_cdemo_sk#20698L,ws_ship_hdemo_sk#20699L,ws_ship_addr_sk#20700L,ws_web_page_sk#20701L,ws_web_site_sk#20702L,ws_ship_mode_sk#20703L,ws_warehouse_sk#20704L,ws_promo_sk#20705L,ws_order_number#20706L,ws_quantity#20707,ws_wholesale_cost#20708,ws_list_price#20709,ws_sales_price#20710,ws_ext_discount_amt#20711,ws_ext_sales_price#20712,ws_ext_wholesale_cost#20713,... 10 more fields] orc
               :     :     :        +- Project [d_date_sk#20724L]
               :     :     :           +- Filter (((isnotnull(d_year#20730) AND isnotnull(d_moy#20732)) AND (((d_year#20730 = 1999) AND (d_moy#20732 >= 1)) AND (d_moy#20732 <= 3))) AND isnotnull(d_date_sk#20724L))
               :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20724L,d_date_id#20725,d_date#20726,d_month_seq#20727,d_week_seq#20728,d_quarter_seq#20729,d_year#20730,d_dow#20731,d_moy#20732,d_dom#20733,d_qoy#20734,d_fy_year#20735,d_fy_quarter_seq#20736,d_fy_week_seq#20737,d_day_name#20738,d_quarter_name#20739,d_holiday#20740,d_weekend#20741,d_following_holiday#20742,d_first_dom#20743,d_last_dom#20744,d_same_day_ly#20745,d_same_day_lq#20746,d_current_day#20747,... 4 more fields] orc
               :     :     +- Project [cs_ship_customer_sk#20758L]
               :     :        +- Join Inner, (cs_sold_date_sk#20785L = d_date_sk#20786L)
               :     :           :- Project [cs_ship_customer_sk#20758L, cs_sold_date_sk#20785L]
               :     :           :  +- Filter (isnotnull(cs_sold_date_sk#20785L) AND dynamicpruning#20824 [cs_sold_date_sk#20785L])
               :     :           :     :  +- Project [d_date_sk#20786L]
               :     :           :     :     +- Filter (((isnotnull(d_year#20792) AND isnotnull(d_moy#20794)) AND (((d_year#20792 = 1999) AND (d_moy#20794 >= 1)) AND (d_moy#20794 <= 3))) AND isnotnull(d_date_sk#20786L))
               :     :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20786L,d_date_id#20787,d_date#20788,d_month_seq#20789,d_week_seq#20790,d_quarter_seq#20791,d_year#20792,d_dow#20793,d_moy#20794,d_dom#20795,d_qoy#20796,d_fy_year#20797,d_fy_quarter_seq#20798,d_fy_week_seq#20799,d_day_name#20800,d_quarter_name#20801,d_holiday#20802,d_weekend#20803,d_following_holiday#20804,d_first_dom#20805,d_last_dom#20806,d_same_day_ly#20807,d_same_day_lq#20808,d_current_day#20809,... 4 more fields] orc
               :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#20752L,cs_ship_date_sk#20753L,cs_bill_customer_sk#20754L,cs_bill_cdemo_sk#20755L,cs_bill_hdemo_sk#20756L,cs_bill_addr_sk#20757L,cs_ship_customer_sk#20758L,cs_ship_cdemo_sk#20759L,cs_ship_hdemo_sk#20760L,cs_ship_addr_sk#20761L,cs_call_center_sk#20762L,cs_catalog_page_sk#20763L,cs_ship_mode_sk#20764L,cs_warehouse_sk#20765L,cs_item_sk#20766L,cs_promo_sk#20767L,cs_order_number#20768L,cs_quantity#20769,cs_wholesale_cost#20770,cs_list_price#20771,cs_sales_price#20772,cs_ext_discount_amt#20773,cs_ext_sales_price#20774,cs_ext_wholesale_cost#20775,... 10 more fields] orc
               :     :           +- Project [d_date_sk#20786L]
               :     :              +- Filter (((isnotnull(d_year#20792) AND isnotnull(d_moy#20794)) AND (((d_year#20792 = 1999) AND (d_moy#20794 >= 1)) AND (d_moy#20794 <= 3))) AND isnotnull(d_date_sk#20786L))
               :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20786L,d_date_id#20787,d_date#20788,d_month_seq#20789,d_week_seq#20790,d_quarter_seq#20791,d_year#20792,d_dow#20793,d_moy#20794,d_dom#20795,d_qoy#20796,d_fy_year#20797,d_fy_quarter_seq#20798,d_fy_week_seq#20799,d_day_name#20800,d_quarter_name#20801,d_holiday#20802,d_weekend#20803,d_following_holiday#20804,d_first_dom#20805,d_last_dom#20806,d_same_day_ly#20807,d_same_day_lq#20808,d_current_day#20809,... 4 more fields] orc
               :     +- Project [ca_address_sk#20617L]
               :        +- Filter (ca_state#20625 IN (CO,IL,MN) AND isnotnull(ca_address_sk#20617L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20617L,ca_address_id#20618,ca_street_number#20619,ca_street_name#20620,ca_street_type#20621,ca_suite_number#20622,ca_city#20623,ca_county#20624,ca_state#20625,ca_zip#20626,ca_country#20627,ca_gmt_offset#20628,ca_location_type#20629] orc
               +- Project [cd_demo_sk#20630L, cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635]
                  +- Filter isnotnull(cd_demo_sk#20630L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#20630L,cd_gender#20631,cd_marital_status#20632,cd_education_status#20633,cd_purchase_estimate#20634,cd_credit_rating#20635,cd_dep_count#20636,cd_dep_employed_count#20637,cd_dep_college_count#20638] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[cd_gender#20631 ASC NULLS FIRST,cd_marital_status#20632 ASC NULLS FIRST,cd_education_status#20633 ASC NULLS FIRST,cd_purchase_estimate#20634 ASC NULLS FIRST,cd_credit_rating#20635 ASC NULLS FIRST], output=[cd_gender#20631,cd_marital_status#20632,cd_education_status#20633,cnt1#20590L,cd_purchase_estimate#20634,cnt2#20591L,cd_credit_rating#20635,cnt3#20592L])
   +- HashAggregate(keys=[cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635], functions=[count(1)], output=[cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cnt1#20590L, cd_purchase_estimate#20634, cnt2#20591L, cd_credit_rating#20635, cnt3#20592L])
      +- Exchange hashpartitioning(cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635, 3000), ENSURE_REQUIREMENTS, [id=#21727]
         +- HashAggregate(keys=[cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635], functions=[partial_count(1)], output=[cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635, count#20826L])
            +- Project [cd_gender#20631, cd_marital_status#20632, cd_education_status#20633, cd_purchase_estimate#20634, cd_credit_rating#20635]
               +- SortMergeJoin [c_current_cdemo_sk#20601L], [cd_demo_sk#20630L], Inner
                  :- Sort [c_current_cdemo_sk#20601L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(c_current_cdemo_sk#20601L, 3000), ENSURE_REQUIREMENTS, [id=#21719]
                  :     +- Project [c_current_cdemo_sk#20601L]
                  :        +- SortMergeJoin [c_current_addr_sk#20603L], [ca_address_sk#20617L], Inner
                  :           :- Sort [c_current_addr_sk#20603L ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(c_current_addr_sk#20603L, 3000), ENSURE_REQUIREMENTS, [id=#21711]
                  :           :     +- Project [c_current_cdemo_sk#20601L, c_current_addr_sk#20603L]
                  :           :        +- SortMergeJoin [c_customer_sk#20599L], [cs_ship_customer_sk#20758L], LeftAnti
                  :           :           :- SortMergeJoin [c_customer_sk#20599L], [ws_bill_customer_sk#20693L], LeftAnti
                  :           :           :  :- SortMergeJoin [c_customer_sk#20599L], [ss_customer_sk#20641L], LeftSemi
                  :           :           :  :  :- Sort [c_customer_sk#20599L ASC NULLS FIRST], false, 0
                  :           :           :  :  :  +- Exchange hashpartitioning(c_customer_sk#20599L, 3000), ENSURE_REQUIREMENTS, [id=#21687]
                  :           :           :  :  :     +- Filter (isnotnull(c_current_addr_sk#20603L) AND isnotnull(c_current_cdemo_sk#20601L))
                  :           :           :  :  :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#20599L,c_current_cdemo_sk#20601L,c_current_addr_sk#20603L] Batched: true, DataFilters: [isnotnull(c_current_addr_sk#20603L), isnotnull(c_current_cdemo_sk#20601L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_addr_sk:bigint>
                  :           :           :  :  +- Sort [ss_customer_sk#20641L ASC NULLS FIRST], false, 0
                  :           :           :  :     +- Exchange hashpartitioning(ss_customer_sk#20641L, 3000), ENSURE_REQUIREMENTS, [id=#21688]
                  :           :           :  :        +- Project [ss_customer_sk#20641L]
                  :           :           :  :           +- BroadcastHashJoin [ss_sold_date_sk#20661L], [d_date_sk#20662L], Inner, BuildRight, false
                  :           :           :  :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#20641L,ss_sold_date_sk#20661L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#20661L), dynamicpruningexpression(ss_sold_date_sk#20661L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<ss_customer_sk:bigint>
                  :           :           :  :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#20822, 0, true, Project [d_date_sk#20662L], [d_date_sk#20662L]
                  :           :           :  :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :           :  :              :           +- Project [d_date_sk#20662L]
                  :           :           :  :              :              +- Filter (((((isnotnull(d_year#20668) AND isnotnull(d_moy#20670)) AND (d_year#20668 = 1999)) AND (d_moy#20670 >= 1)) AND (d_moy#20670 <= 3)) AND isnotnull(d_date_sk#20662L))
                  :           :           :  :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20662L,d_year#20668,d_moy#20670] Batched: true, DataFilters: [isnotnull(d_year#20668), isnotnull(d_moy#20670), (d_year#20668 = 1999), (d_moy#20670 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21682]
                  :           :           :  :                 +- Project [d_date_sk#20662L]
                  :           :           :  :                    +- Filter (((((isnotnull(d_year#20668) AND isnotnull(d_moy#20670)) AND (d_year#20668 = 1999)) AND (d_moy#20670 >= 1)) AND (d_moy#20670 <= 3)) AND isnotnull(d_date_sk#20662L))
                  :           :           :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20662L,d_year#20668,d_moy#20670] Batched: true, DataFilters: [isnotnull(d_year#20668), isnotnull(d_moy#20670), (d_year#20668 = 1999), (d_moy#20670 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :  +- Sort [ws_bill_customer_sk#20693L ASC NULLS FIRST], false, 0
                  :           :           :     +- Exchange hashpartitioning(ws_bill_customer_sk#20693L, 3000), ENSURE_REQUIREMENTS, [id=#21697]
                  :           :           :        +- Project [ws_bill_customer_sk#20693L]
                  :           :           :           +- BroadcastHashJoin [ws_sold_date_sk#20723L], [d_date_sk#20724L], Inner, BuildRight, false
                  :           :           :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#20693L,ws_sold_date_sk#20723L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#20723L), dynamicpruningexpression(ws_sold_date_sk#20723L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:bigint>
                  :           :           :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#20823, 0, true, Project [d_date_sk#20724L], [d_date_sk#20724L]
                  :           :           :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :           :              :           +- Project [d_date_sk#20724L]
                  :           :           :              :              +- Filter (((((isnotnull(d_year#20730) AND isnotnull(d_moy#20732)) AND (d_year#20730 = 1999)) AND (d_moy#20732 >= 1)) AND (d_moy#20732 <= 3)) AND isnotnull(d_date_sk#20724L))
                  :           :           :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20724L,d_year#20730,d_moy#20732] Batched: true, DataFilters: [isnotnull(d_year#20730), isnotnull(d_moy#20732), (d_year#20730 = 1999), (d_moy#20732 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21692]
                  :           :           :                 +- Project [d_date_sk#20724L]
                  :           :           :                    +- Filter (((((isnotnull(d_year#20730) AND isnotnull(d_moy#20732)) AND (d_year#20730 = 1999)) AND (d_moy#20732 >= 1)) AND (d_moy#20732 <= 3)) AND isnotnull(d_date_sk#20724L))
                  :           :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20724L,d_year#20730,d_moy#20732] Batched: true, DataFilters: [isnotnull(d_year#20730), isnotnull(d_moy#20732), (d_year#20730 = 1999), (d_moy#20732 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :           +- Sort [cs_ship_customer_sk#20758L ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(cs_ship_customer_sk#20758L, 3000), ENSURE_REQUIREMENTS, [id=#21705]
                  :           :                 +- Project [cs_ship_customer_sk#20758L]
                  :           :                    +- BroadcastHashJoin [cs_sold_date_sk#20785L], [d_date_sk#20786L], Inner, BuildRight, false
                  :           :                       :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_customer_sk#20758L,cs_sold_date_sk#20785L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#20785L), dynamicpruningexpression(cs_sold_date_sk#20785L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:bigint>
                  :           :                       :     +- SubqueryAdaptiveBroadcast dynamicpruning#20824, 0, true, Project [d_date_sk#20786L], [d_date_sk#20786L]
                  :           :                       :        +- AdaptiveSparkPlan isFinalPlan=false
                  :           :                       :           +- Project [d_date_sk#20786L]
                  :           :                       :              +- Filter (((((isnotnull(d_year#20792) AND isnotnull(d_moy#20794)) AND (d_year#20792 = 1999)) AND (d_moy#20794 >= 1)) AND (d_moy#20794 <= 3)) AND isnotnull(d_date_sk#20786L))
                  :           :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20786L,d_year#20792,d_moy#20794] Batched: true, DataFilters: [isnotnull(d_year#20792), isnotnull(d_moy#20794), (d_year#20792 = 1999), (d_moy#20794 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21700]
                  :           :                          +- Project [d_date_sk#20786L]
                  :           :                             +- Filter (((((isnotnull(d_year#20792) AND isnotnull(d_moy#20794)) AND (d_year#20792 = 1999)) AND (d_moy#20794 >= 1)) AND (d_moy#20794 <= 3)) AND isnotnull(d_date_sk#20786L))
                  :           :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20786L,d_year#20792,d_moy#20794] Batched: true, DataFilters: [isnotnull(d_year#20792), isnotnull(d_moy#20794), (d_year#20792 = 1999), (d_moy#20794 >= 1), (d_m..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                  :           +- Sort [ca_address_sk#20617L ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(ca_address_sk#20617L, 3000), ENSURE_REQUIREMENTS, [id=#21712]
                  :                 +- Project [ca_address_sk#20617L]
                  :                    +- Filter (ca_state#20625 IN (CO,IL,MN) AND isnotnull(ca_address_sk#20617L))
                  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#20617L,ca_state#20625] Batched: true, DataFilters: [ca_state#20625 IN (CO,IL,MN), isnotnull(ca_address_sk#20617L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(ca_state, [CO,IL,MN]), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                  +- Sort [cd_demo_sk#20630L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cd_demo_sk#20630L, 3000), ENSURE_REQUIREMENTS, [id=#21720]
                        +- Filter isnotnull(cd_demo_sk#20630L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#20630L,cd_gender#20631,cd_marital_status#20632,cd_education_status#20633,cd_purchase_estimate#20634,cd_credit_rating#20635] Batched: true, DataFilters: [isnotnull(cd_demo_sk#20630L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint,cd_gender:string,cd_marital_status:string,cd_education_status:string,cd_...

read query: spark_queries/q70.sql
explain query: q70
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 's_state END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), 's_state, 's_county)], ['sum('ss_net_profit) AS total_sum#20827, 's_state, 's_county, ('grouping('s_state) + 'grouping('s_county)) AS lochierarchy#20828, 'rank() windowspecdefinition(('grouping('s_state) + 'grouping('s_county)), CASE WHEN ('grouping('s_county) = 0) THEN 's_state END, 'sum('ss_net_profit) DESC NULLS LAST, unspecifiedframe$()) AS rank_within_parent#20829]
         +- 'Filter (((('d1.d_month_seq >= 1212) AND ('d1.d_month_seq <= (1212 + 11))) AND ('d1.d_date_sk = 'ss_sold_date_sk)) AND (('s_store_sk = 'ss_store_sk) AND 's_state IN (list#20832 [])))
            :  +- 'Project ['s_state]
            :     +- 'Filter ('ranking <= 5)
            :        +- 'SubqueryAlias tmp1
            :           +- 'Aggregate ['s_state], ['s_state AS s_state#20830, 'rank() windowspecdefinition('s_state, 'sum('ss_net_profit) DESC NULLS LAST, unspecifiedframe$()) AS ranking#20831]
            :              +- 'Filter (((('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))) AND ('d_date_sk = 'ss_sold_date_sk)) AND ('s_store_sk = 'ss_store_sk))
            :                 +- 'Join Inner
            :                    :- 'Join Inner
            :                    :  :- 'UnresolvedRelation [store_sales], [], false
            :                    :  +- 'UnresolvedRelation [store], [], false
            :                    +- 'UnresolvedRelation [date_dim], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [store_sales], [], false
               :  +- 'SubqueryAlias d1
               :     +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
total_sum: double, s_state: string, s_county: string, lochierarchy: tinyint, rank_within_parent: int
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#20828 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#20828 as int) = 0) THEN s_state#21017 END ASC NULLS FIRST, rank_within_parent#20829 ASC NULLS FIRST], true
      +- Project [total_sum#20827, s_state#21017, s_county#21018, lochierarchy#20828, rank_within_parent#20829]
         +- Project [total_sum#20827, s_state#21017, s_county#21018, lochierarchy#20828, _w0#21027, _w1#21031, _w2#21032, _w3#21033, rank_within_parent#20829, rank_within_parent#20829]
            +- Window [rank(_w3#21033) windowspecdefinition(_w1#21031, _w2#21032, _w3#21033 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#20829], [_w1#21031, _w2#21032], [_w3#21033 DESC NULLS LAST]
               +- Aggregate [s_state#21017, s_county#21018, spark_grouping_id#21016L], [sum(ss_net_profit#20856) AS total_sum#20827, s_state#21017, s_county#21018, (cast((shiftright(spark_grouping_id#21016L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint)) AS lochierarchy#20828, sum(ss_net_profit#20856) AS _w0#21027, (cast((shiftright(spark_grouping_id#21016L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint)) AS _w1#21031, CASE WHEN (cast(cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint) as int) = 0) THEN s_state#21017 END AS _w2#21032, sum(ss_net_profit#20856) AS _w3#21033]
                  +- Expand [[ss_sold_time_sk#20835L, ss_item_sk#20836L, ss_customer_sk#20837L, ss_cdemo_sk#20838L, ss_hdemo_sk#20839L, ss_addr_sk#20840L, ss_store_sk#20841L, ss_promo_sk#20842L, ss_ticket_number#20843L, ss_quantity#20844, ss_wholesale_cost#20845, ss_list_price#20846, ss_sales_price#20847, ss_ext_discount_amt#20848, ss_ext_sales_price#20849, ss_ext_wholesale_cost#20850, ss_ext_list_price#20851, ss_ext_tax#20852, ss_coupon_amt#20853, ss_net_paid#20854, ss_net_paid_inc_tax#20855, ss_net_profit#20856, ss_sold_date_sk#20857L, d_date_sk#20858L, ... 59 more fields], [ss_sold_time_sk#20835L, ss_item_sk#20836L, ss_customer_sk#20837L, ss_cdemo_sk#20838L, ss_hdemo_sk#20839L, ss_addr_sk#20840L, ss_store_sk#20841L, ss_promo_sk#20842L, ss_ticket_number#20843L, ss_quantity#20844, ss_wholesale_cost#20845, ss_list_price#20846, ss_sales_price#20847, ss_ext_discount_amt#20848, ss_ext_sales_price#20849, ss_ext_wholesale_cost#20850, ss_ext_list_price#20851, ss_ext_tax#20852, ss_coupon_amt#20853, ss_net_paid#20854, ss_net_paid_inc_tax#20855, ss_net_profit#20856, ss_sold_date_sk#20857L, d_date_sk#20858L, ... 59 more fields], [ss_sold_time_sk#20835L, ss_item_sk#20836L, ss_customer_sk#20837L, ss_cdemo_sk#20838L, ss_hdemo_sk#20839L, ss_addr_sk#20840L, ss_store_sk#20841L, ss_promo_sk#20842L, ss_ticket_number#20843L, ss_quantity#20844, ss_wholesale_cost#20845, ss_list_price#20846, ss_sales_price#20847, ss_ext_discount_amt#20848, ss_ext_sales_price#20849, ss_ext_wholesale_cost#20850, ss_ext_list_price#20851, ss_ext_tax#20852, ss_coupon_amt#20853, ss_net_paid#20854, ss_net_paid_inc_tax#20855, ss_net_profit#20856, ss_sold_date_sk#20857L, d_date_sk#20858L, ... 59 more fields]], [ss_sold_time_sk#20835L, ss_item_sk#20836L, ss_customer_sk#20837L, ss_cdemo_sk#20838L, ss_hdemo_sk#20839L, ss_addr_sk#20840L, ss_store_sk#20841L, ss_promo_sk#20842L, ss_ticket_number#20843L, ss_quantity#20844, ss_wholesale_cost#20845, ss_list_price#20846, ss_sales_price#20847, ss_ext_discount_amt#20848, ss_ext_sales_price#20849, ss_ext_wholesale_cost#20850, ss_ext_list_price#20851, ss_ext_tax#20852, ss_coupon_amt#20853, ss_net_paid#20854, ss_net_paid_inc_tax#20855, ss_net_profit#20856, ss_sold_date_sk#20857L, d_date_sk#20858L, ... 59 more fields]
                     +- Project [ss_sold_time_sk#20835L, ss_item_sk#20836L, ss_customer_sk#20837L, ss_cdemo_sk#20838L, ss_hdemo_sk#20839L, ss_addr_sk#20840L, ss_store_sk#20841L, ss_promo_sk#20842L, ss_ticket_number#20843L, ss_quantity#20844, ss_wholesale_cost#20845, ss_list_price#20846, ss_sales_price#20847, ss_ext_discount_amt#20848, ss_ext_sales_price#20849, ss_ext_wholesale_cost#20850, ss_ext_list_price#20851, ss_ext_tax#20852, ss_coupon_amt#20853, ss_net_paid#20854, ss_net_paid_inc_tax#20855, ss_net_profit#20856, ss_sold_date_sk#20857L, d_date_sk#20858L, ... 58 more fields]
                        +- Filter ((((d_month_seq#20861 >= 1212) AND (d_month_seq#20861 <= (1212 + 11))) AND (d_date_sk#20858L = ss_sold_date_sk#20857L)) AND ((s_store_sk#20886L = ss_store_sk#20841L) AND s_state#20910 IN (list#20832 [])))
                           :  +- Project [s_state#20830]
                           :     +- Filter (ranking#20831 <= 5)
                           :        +- SubqueryAlias tmp1
                           :           +- Project [s_state#20830, ranking#20831]
                           :              +- Project [s_state#20830, _w0#21001, s_state#20964, _w2#21005, ranking#20831, ranking#20831]
                           :                 +- Window [rank(_w2#21005) windowspecdefinition(s_state#20964, _w2#21005 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#20831], [s_state#20964], [_w2#21005 DESC NULLS LAST]
                           :                    +- Aggregate [s_state#20964], [s_state#20964 AS s_state#20830, sum(ss_net_profit#20938) AS _w0#21001, s_state#20964, sum(ss_net_profit#20938) AS _w2#21005]
                           :                       +- Filter ((((d_month_seq#20972 >= 1212) AND (d_month_seq#20972 <= (1212 + 11))) AND (d_date_sk#20969L = ss_sold_date_sk#20939L)) AND (s_store_sk#20940L = ss_store_sk#20923L))
                           :                          +- Join Inner
                           :                             :- Join Inner
                           :                             :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                           :                             :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20917L,ss_item_sk#20918L,ss_customer_sk#20919L,ss_cdemo_sk#20920L,ss_hdemo_sk#20921L,ss_addr_sk#20922L,ss_store_sk#20923L,ss_promo_sk#20924L,ss_ticket_number#20925L,ss_quantity#20926,ss_wholesale_cost#20927,ss_list_price#20928,ss_sales_price#20929,ss_ext_discount_amt#20930,ss_ext_sales_price#20931,ss_ext_wholesale_cost#20932,ss_ext_list_price#20933,ss_ext_tax#20934,ss_coupon_amt#20935,ss_net_paid#20936,ss_net_paid_inc_tax#20937,ss_net_profit#20938,ss_sold_date_sk#20939L] orc
                           :                             :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                           :                             :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20940L,s_store_id#20941,s_rec_start_date#20942,s_rec_end_date#20943,s_closed_date_sk#20944L,s_store_name#20945,s_number_employees#20946,s_floor_space#20947,s_hours#20948,s_manager#20949,s_market_id#20950,s_geography_class#20951,s_market_desc#20952,s_market_manager#20953,s_division_id#20954,s_division_name#20955,s_company_id#20956,s_company_name#20957,s_street_number#20958,s_street_name#20959,s_street_type#20960,s_suite_number#20961,s_city#20962,s_county#20963,... 5 more fields] orc
                           :                             +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                           :                                +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20969L,d_date_id#20970,d_date#20971,d_month_seq#20972,d_week_seq#20973,d_quarter_seq#20974,d_year#20975,d_dow#20976,d_moy#20977,d_dom#20978,d_qoy#20979,d_fy_year#20980,d_fy_quarter_seq#20981,d_fy_week_seq#20982,d_day_name#20983,d_quarter_name#20984,d_holiday#20985,d_weekend#20986,d_following_holiday#20987,d_first_dom#20988,d_last_dom#20989,d_same_day_ly#20990,d_same_day_lq#20991,d_current_day#20992,... 4 more fields] orc
                           +- Join Inner
                              :- Join Inner
                              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20835L,ss_item_sk#20836L,ss_customer_sk#20837L,ss_cdemo_sk#20838L,ss_hdemo_sk#20839L,ss_addr_sk#20840L,ss_store_sk#20841L,ss_promo_sk#20842L,ss_ticket_number#20843L,ss_quantity#20844,ss_wholesale_cost#20845,ss_list_price#20846,ss_sales_price#20847,ss_ext_discount_amt#20848,ss_ext_sales_price#20849,ss_ext_wholesale_cost#20850,ss_ext_list_price#20851,ss_ext_tax#20852,ss_coupon_amt#20853,ss_net_paid#20854,ss_net_paid_inc_tax#20855,ss_net_profit#20856,ss_sold_date_sk#20857L] orc
                              :  +- SubqueryAlias d1
                              :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20858L,d_date_id#20859,d_date#20860,d_month_seq#20861,d_week_seq#20862,d_quarter_seq#20863,d_year#20864,d_dow#20865,d_moy#20866,d_dom#20867,d_qoy#20868,d_fy_year#20869,d_fy_quarter_seq#20870,d_fy_week_seq#20871,d_day_name#20872,d_quarter_name#20873,d_holiday#20874,d_weekend#20875,d_following_holiday#20876,d_first_dom#20877,d_last_dom#20878,d_same_day_ly#20879,d_same_day_lq#20880,d_current_day#20881,... 4 more fields] orc
                              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20886L,s_store_id#20887,s_rec_start_date#20888,s_rec_end_date#20889,s_closed_date_sk#20890L,s_store_name#20891,s_number_employees#20892,s_floor_space#20893,s_hours#20894,s_manager#20895,s_market_id#20896,s_geography_class#20897,s_market_desc#20898,s_market_manager#20899,s_division_id#20900,s_division_name#20901,s_company_id#20902,s_company_name#20903,s_street_number#20904,s_street_name#20905,s_street_type#20906,s_suite_number#20907,s_city#20908,s_county#20909,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#20828 DESC NULLS LAST, CASE WHEN (lochierarchy#20828 = 0) THEN s_state#21017 END ASC NULLS FIRST, rank_within_parent#20829 ASC NULLS FIRST], true
      +- Project [total_sum#20827, s_state#21017, s_county#21018, lochierarchy#20828, rank_within_parent#20829]
         +- Window [rank(_w3#21033) windowspecdefinition(_w1#21031, _w2#21032, _w3#21033 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#20829], [_w1#21031, _w2#21032], [_w3#21033 DESC NULLS LAST]
            +- Aggregate [s_state#21017, s_county#21018, spark_grouping_id#21016L], [sum(ss_net_profit#20856) AS total_sum#20827, s_state#21017, s_county#21018, (cast((shiftright(spark_grouping_id#21016L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint)) AS lochierarchy#20828, (cast((shiftright(spark_grouping_id#21016L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint)) AS _w1#21031, CASE WHEN (cast((shiftright(spark_grouping_id#21016L, 0) & 1) as tinyint) = 0) THEN s_state#21017 END AS _w2#21032, sum(ss_net_profit#20856) AS _w3#21033]
               +- Expand [[ss_net_profit#20856, s_state#20910, s_county#20909, 0], [ss_net_profit#20856, s_state#20910, null, 1], [ss_net_profit#20856, null, null, 3]], [ss_net_profit#20856, s_state#21017, s_county#21018, spark_grouping_id#21016L]
                  +- Project [ss_net_profit#20856, s_state#20910, s_county#20909]
                     +- Join Inner, (s_store_sk#20886L = ss_store_sk#20841L)
                        :- Project [ss_store_sk#20841L, ss_net_profit#20856]
                        :  +- Join Inner, (d_date_sk#20858L = ss_sold_date_sk#20857L)
                        :     :- Project [ss_store_sk#20841L, ss_net_profit#20856, ss_sold_date_sk#20857L]
                        :     :  +- Filter ((isnotnull(ss_sold_date_sk#20857L) AND isnotnull(ss_store_sk#20841L)) AND dynamicpruning#21052 [ss_sold_date_sk#20857L])
                        :     :     :  +- Project [d_date_sk#20858L]
                        :     :     :     +- Filter ((isnotnull(d_month_seq#20861) AND ((d_month_seq#20861 >= 1212) AND (d_month_seq#20861 <= 1223))) AND isnotnull(d_date_sk#20858L))
                        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20858L,d_date_id#20859,d_date#20860,d_month_seq#20861,d_week_seq#20862,d_quarter_seq#20863,d_year#20864,d_dow#20865,d_moy#20866,d_dom#20867,d_qoy#20868,d_fy_year#20869,d_fy_quarter_seq#20870,d_fy_week_seq#20871,d_day_name#20872,d_quarter_name#20873,d_holiday#20874,d_weekend#20875,d_following_holiday#20876,d_first_dom#20877,d_last_dom#20878,d_same_day_ly#20879,d_same_day_lq#20880,d_current_day#20881,... 4 more fields] orc
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20835L,ss_item_sk#20836L,ss_customer_sk#20837L,ss_cdemo_sk#20838L,ss_hdemo_sk#20839L,ss_addr_sk#20840L,ss_store_sk#20841L,ss_promo_sk#20842L,ss_ticket_number#20843L,ss_quantity#20844,ss_wholesale_cost#20845,ss_list_price#20846,ss_sales_price#20847,ss_ext_discount_amt#20848,ss_ext_sales_price#20849,ss_ext_wholesale_cost#20850,ss_ext_list_price#20851,ss_ext_tax#20852,ss_coupon_amt#20853,ss_net_paid#20854,ss_net_paid_inc_tax#20855,ss_net_profit#20856,ss_sold_date_sk#20857L] orc
                        :     +- Project [d_date_sk#20858L]
                        :        +- Filter ((isnotnull(d_month_seq#20861) AND ((d_month_seq#20861 >= 1212) AND (d_month_seq#20861 <= 1223))) AND isnotnull(d_date_sk#20858L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20858L,d_date_id#20859,d_date#20860,d_month_seq#20861,d_week_seq#20862,d_quarter_seq#20863,d_year#20864,d_dow#20865,d_moy#20866,d_dom#20867,d_qoy#20868,d_fy_year#20869,d_fy_quarter_seq#20870,d_fy_week_seq#20871,d_day_name#20872,d_quarter_name#20873,d_holiday#20874,d_weekend#20875,d_following_holiday#20876,d_first_dom#20877,d_last_dom#20878,d_same_day_ly#20879,d_same_day_lq#20880,d_current_day#20881,... 4 more fields] orc
                        +- Join LeftSemi, (s_state#20910 = s_state#20830)
                           :- Project [s_store_sk#20886L, s_county#20909, s_state#20910]
                           :  +- Filter isnotnull(s_store_sk#20886L)
                           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20886L,s_store_id#20887,s_rec_start_date#20888,s_rec_end_date#20889,s_closed_date_sk#20890L,s_store_name#20891,s_number_employees#20892,s_floor_space#20893,s_hours#20894,s_manager#20895,s_market_id#20896,s_geography_class#20897,s_market_desc#20898,s_market_manager#20899,s_division_id#20900,s_division_name#20901,s_company_id#20902,s_company_name#20903,s_street_number#20904,s_street_name#20905,s_street_type#20906,s_suite_number#20907,s_city#20908,s_county#20909,... 5 more fields] orc
                           +- Project [s_state#20830]
                              +- Filter (ranking#20831 <= 5)
                                 +- Window [rank(_w2#21005) windowspecdefinition(s_state#20964, _w2#21005 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#20831], [s_state#20964], [_w2#21005 DESC NULLS LAST]
                                    +- Aggregate [s_state#20964], [s_state#20964 AS s_state#20830, s_state#20964, sum(ss_net_profit#20938) AS _w2#21005]
                                       +- Project [ss_net_profit#20938, s_state#20964]
                                          +- Join Inner, (s_store_sk#20940L = ss_store_sk#20923L)
                                             :- Project [ss_store_sk#20923L, ss_net_profit#20938]
                                             :  +- Join Inner, (d_date_sk#20969L = ss_sold_date_sk#20939L)
                                             :     :- Project [ss_store_sk#20923L, ss_net_profit#20938, ss_sold_date_sk#20939L]
                                             :     :  +- Filter ((isnotnull(ss_store_sk#20923L) AND isnotnull(ss_sold_date_sk#20939L)) AND dynamicpruning#21045 [ss_sold_date_sk#20939L])
                                             :     :     :  +- Project [d_date_sk#20969L]
                                             :     :     :     +- Filter ((isnotnull(d_month_seq#20972) AND ((d_month_seq#20972 >= 1212) AND (d_month_seq#20972 <= 1223))) AND isnotnull(d_date_sk#20969L))
                                             :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20969L,d_date_id#20970,d_date#20971,d_month_seq#20972,d_week_seq#20973,d_quarter_seq#20974,d_year#20975,d_dow#20976,d_moy#20977,d_dom#20978,d_qoy#20979,d_fy_year#20980,d_fy_quarter_seq#20981,d_fy_week_seq#20982,d_day_name#20983,d_quarter_name#20984,d_holiday#20985,d_weekend#20986,d_following_holiday#20987,d_first_dom#20988,d_last_dom#20989,d_same_day_ly#20990,d_same_day_lq#20991,d_current_day#20992,... 4 more fields] orc
                                             :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#20917L,ss_item_sk#20918L,ss_customer_sk#20919L,ss_cdemo_sk#20920L,ss_hdemo_sk#20921L,ss_addr_sk#20922L,ss_store_sk#20923L,ss_promo_sk#20924L,ss_ticket_number#20925L,ss_quantity#20926,ss_wholesale_cost#20927,ss_list_price#20928,ss_sales_price#20929,ss_ext_discount_amt#20930,ss_ext_sales_price#20931,ss_ext_wholesale_cost#20932,ss_ext_list_price#20933,ss_ext_tax#20934,ss_coupon_amt#20935,ss_net_paid#20936,ss_net_paid_inc_tax#20937,ss_net_profit#20938,ss_sold_date_sk#20939L] orc
                                             :     +- Project [d_date_sk#20969L]
                                             :        +- Filter ((isnotnull(d_month_seq#20972) AND ((d_month_seq#20972 >= 1212) AND (d_month_seq#20972 <= 1223))) AND isnotnull(d_date_sk#20969L))
                                             :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20969L,d_date_id#20970,d_date#20971,d_month_seq#20972,d_week_seq#20973,d_quarter_seq#20974,d_year#20975,d_dow#20976,d_moy#20977,d_dom#20978,d_qoy#20979,d_fy_year#20980,d_fy_quarter_seq#20981,d_fy_week_seq#20982,d_day_name#20983,d_quarter_name#20984,d_holiday#20985,d_weekend#20986,d_following_holiday#20987,d_first_dom#20988,d_last_dom#20989,d_same_day_ly#20990,d_same_day_lq#20991,d_current_day#20992,... 4 more fields] orc
                                             +- Project [s_store_sk#20940L, s_state#20964]
                                                +- Filter isnotnull(s_store_sk#20940L)
                                                   +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20940L,s_store_id#20941,s_rec_start_date#20942,s_rec_end_date#20943,s_closed_date_sk#20944L,s_store_name#20945,s_number_employees#20946,s_floor_space#20947,s_hours#20948,s_manager#20949,s_market_id#20950,s_geography_class#20951,s_market_desc#20952,s_market_manager#20953,s_division_id#20954,s_division_name#20955,s_company_id#20956,s_company_name#20957,s_street_number#20958,s_street_name#20959,s_street_type#20960,s_suite_number#20961,s_city#20962,s_county#20963,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#20828 DESC NULLS LAST,CASE WHEN (lochierarchy#20828 = 0) THEN s_state#21017 END ASC NULLS FIRST,rank_within_parent#20829 ASC NULLS FIRST], output=[total_sum#20827,s_state#21017,s_county#21018,lochierarchy#20828,rank_within_parent#20829])
   +- Project [total_sum#20827, s_state#21017, s_county#21018, lochierarchy#20828, rank_within_parent#20829]
      +- Window [rank(_w3#21033) windowspecdefinition(_w1#21031, _w2#21032, _w3#21033 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#20829], [_w1#21031, _w2#21032], [_w3#21033 DESC NULLS LAST]
         +- Sort [_w1#21031 ASC NULLS FIRST, _w2#21032 ASC NULLS FIRST, _w3#21033 DESC NULLS LAST], false, 0
            +- Exchange hashpartitioning(_w1#21031, _w2#21032, 3000), ENSURE_REQUIREMENTS, [id=#21946]
               +- HashAggregate(keys=[s_state#21017, s_county#21018, spark_grouping_id#21016L], functions=[sum(ss_net_profit#20856)], output=[total_sum#20827, s_state#21017, s_county#21018, lochierarchy#20828, _w1#21031, _w2#21032, _w3#21033])
                  +- Exchange hashpartitioning(s_state#21017, s_county#21018, spark_grouping_id#21016L, 3000), ENSURE_REQUIREMENTS, [id=#21943]
                     +- HashAggregate(keys=[s_state#21017, s_county#21018, spark_grouping_id#21016L], functions=[partial_sum(ss_net_profit#20856)], output=[s_state#21017, s_county#21018, spark_grouping_id#21016L, sum#21055])
                        +- Expand [[ss_net_profit#20856, s_state#20910, s_county#20909, 0], [ss_net_profit#20856, s_state#20910, null, 1], [ss_net_profit#20856, null, null, 3]], [ss_net_profit#20856, s_state#21017, s_county#21018, spark_grouping_id#21016L]
                           +- Project [ss_net_profit#20856, s_state#20910, s_county#20909]
                              +- BroadcastHashJoin [ss_store_sk#20841L], [s_store_sk#20886L], Inner, BuildRight, false
                                 :- Project [ss_store_sk#20841L, ss_net_profit#20856]
                                 :  +- BroadcastHashJoin [ss_sold_date_sk#20857L], [d_date_sk#20858L], Inner, BuildRight, false
                                 :     :- Filter isnotnull(ss_store_sk#20841L)
                                 :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#20841L,ss_net_profit#20856,ss_sold_date_sk#20857L] Batched: true, DataFilters: [isnotnull(ss_store_sk#20841L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#20857L), dynamicpruningexpression(ss_sold_date_sk#20857L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_net_profit:double>
                                 :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21052, 0, true, Project [d_date_sk#20858L], [d_date_sk#20858L]
                                 :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :              +- Project [d_date_sk#20858L]
                                 :     :                 +- Filter (((isnotnull(d_month_seq#20861) AND (d_month_seq#20861 >= 1212)) AND (d_month_seq#20861 <= 1223)) AND isnotnull(d_date_sk#20858L))
                                 :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20858L,d_month_seq#20861] Batched: true, DataFilters: [isnotnull(d_month_seq#20861), (d_month_seq#20861 >= 1212), (d_month_seq#20861 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21913]
                                 :        +- Project [d_date_sk#20858L]
                                 :           +- Filter (((isnotnull(d_month_seq#20861) AND (d_month_seq#20861 >= 1212)) AND (d_month_seq#20861 <= 1223)) AND isnotnull(d_date_sk#20858L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20858L,d_month_seq#20861] Batched: true, DataFilters: [isnotnull(d_month_seq#20861), (d_month_seq#20861 >= 1212), (d_month_seq#20861 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21937]
                                    +- BroadcastHashJoin [s_state#20910], [s_state#20830], LeftSemi, BuildRight, false
                                       :- Filter isnotnull(s_store_sk#20886L)
                                       :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20886L,s_county#20909,s_state#20910] Batched: true, DataFilters: [isnotnull(s_store_sk#20886L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_county:string,s_state:string>
                                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#21934]
                                          +- Project [s_state#20830]
                                             +- Filter (ranking#20831 <= 5)
                                                +- Window [rank(_w2#21005) windowspecdefinition(s_state#20964, _w2#21005 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#20831], [s_state#20964], [_w2#21005 DESC NULLS LAST]
                                                   +- Sort [s_state#20964 ASC NULLS FIRST, _w2#21005 DESC NULLS LAST], false, 0
                                                      +- Exchange hashpartitioning(s_state#20964, 3000), ENSURE_REQUIREMENTS, [id=#21928]
                                                         +- HashAggregate(keys=[s_state#20964], functions=[sum(ss_net_profit#20938)], output=[s_state#20830, s_state#20964, _w2#21005])
                                                            +- Exchange hashpartitioning(s_state#20964, 3000), ENSURE_REQUIREMENTS, [id=#21925]
                                                               +- HashAggregate(keys=[s_state#20964], functions=[partial_sum(ss_net_profit#20938)], output=[s_state#20964, sum#21057])
                                                                  +- Project [ss_net_profit#20938, s_state#20964]
                                                                     +- BroadcastHashJoin [ss_store_sk#20923L], [s_store_sk#20940L], Inner, BuildRight, false
                                                                        :- Project [ss_store_sk#20923L, ss_net_profit#20938]
                                                                        :  +- BroadcastHashJoin [ss_sold_date_sk#20939L], [d_date_sk#20969L], Inner, BuildRight, false
                                                                        :     :- Filter isnotnull(ss_store_sk#20923L)
                                                                        :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#20923L,ss_net_profit#20938,ss_sold_date_sk#20939L] Batched: true, DataFilters: [isnotnull(ss_store_sk#20923L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#20939L), dynamicpruningexpression(ss_sold_date_sk#20939L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_net_profit:double>
                                                                        :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21045, 0, true, Project [d_date_sk#20969L], [d_date_sk#20969L]
                                                                        :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                                                        :     :              +- Project [d_date_sk#20969L]
                                                                        :     :                 +- Filter (((isnotnull(d_month_seq#20972) AND (d_month_seq#20972 >= 1212)) AND (d_month_seq#20972 <= 1223)) AND isnotnull(d_date_sk#20969L))
                                                                        :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20969L,d_month_seq#20972] Batched: true, DataFilters: [isnotnull(d_month_seq#20972), (d_month_seq#20972 >= 1212), (d_month_seq#20972 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                                                        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#21916]
                                                                        :        +- Project [d_date_sk#20969L]
                                                                        :           +- Filter (((isnotnull(d_month_seq#20972) AND (d_month_seq#20972 >= 1212)) AND (d_month_seq#20972 <= 1223)) AND isnotnull(d_date_sk#20969L))
                                                                        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#20969L,d_month_seq#20972] Batched: true, DataFilters: [isnotnull(d_month_seq#20972), (d_month_seq#20972 >= 1212), (d_month_seq#20972 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                                                        +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#21920]
                                                                           +- Filter isnotnull(s_store_sk#20940L)
                                                                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#20940L,s_state#20964] Batched: true, DataFilters: [isnotnull(s_store_sk#20940L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_state:string>

read query: spark_queries/q71.sql
explain query: q71
== Parsed Logical Plan ==
'Sort ['ext_price DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true
+- 'Aggregate ['i_brand, 'i_brand_id, 't_hour, 't_minute], ['i_brand_id AS brand_id#21070, 'i_brand AS brand#21071, 't_hour, 't_minute, 'sum('ext_price) AS ext_price#21072]
   +- 'Filter ((('sold_item_sk = 'i_item_sk) AND ('i_manager_id = 1)) AND (('time_sk = 't_time_sk) AND (('t_meal_time = breakfast) OR ('t_meal_time = dinner))))
      +- 'Join Inner
         :- 'Join Inner
         :  :- 'UnresolvedRelation [item], [], false
         :  +- 'SubqueryAlias tmp
         :     +- 'Union false, false
         :        :- 'Union false, false
         :        :  :- 'Project ['ws_ext_sales_price AS ext_price#21058, 'ws_sold_date_sk AS sold_date_sk#21059, 'ws_item_sk AS sold_item_sk#21060, 'ws_sold_time_sk AS time_sk#21061]
         :        :  :  +- 'Filter ((('d_date_sk = 'ws_sold_date_sk) AND ('d_moy = 12)) AND ('d_year = 2001))
         :        :  :     +- 'Join Inner
         :        :  :        :- 'UnresolvedRelation [web_sales], [], false
         :        :  :        +- 'UnresolvedRelation [date_dim], [], false
         :        :  +- 'Project ['cs_ext_sales_price AS ext_price#21062, 'cs_sold_date_sk AS sold_date_sk#21063, 'cs_item_sk AS sold_item_sk#21064, 'cs_sold_time_sk AS time_sk#21065]
         :        :     +- 'Filter ((('d_date_sk = 'cs_sold_date_sk) AND ('d_moy = 12)) AND ('d_year = 2001))
         :        :        +- 'Join Inner
         :        :           :- 'UnresolvedRelation [catalog_sales], [], false
         :        :           +- 'UnresolvedRelation [date_dim], [], false
         :        +- 'Project ['ss_ext_sales_price AS ext_price#21066, 'ss_sold_date_sk AS sold_date_sk#21067, 'ss_item_sk AS sold_item_sk#21068, 'ss_sold_time_sk AS time_sk#21069]
         :           +- 'Filter ((('d_date_sk = 'ss_sold_date_sk) AND ('d_moy = 12)) AND ('d_year = 2001))
         :              +- 'Join Inner
         :                 :- 'UnresolvedRelation [store_sales], [], false
         :                 +- 'UnresolvedRelation [date_dim], [], false
         +- 'UnresolvedRelation [time_dim], [], false

== Analyzed Logical Plan ==
brand_id: int, brand: string, t_hour: int, t_minute: int, ext_price: double
Sort [ext_price#21072 DESC NULLS LAST, brand_id#21070 ASC NULLS FIRST], true
+- Aggregate [i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274], [i_brand_id#21080 AS brand_id#21070, i_brand#21081 AS brand#21071, t_hour#21273, t_minute#21274, sum(ext_price#21058) AS ext_price#21072]
   +- Filter (((sold_item_sk#21060L = i_item_sk#21073L) AND (i_manager_id#21093 = 1)) AND ((time_sk#21061L = t_time_sk#21270L) AND ((t_meal_time#21279 = breakfast) OR (t_meal_time#21279 = dinner))))
      +- Join Inner
         :- Join Inner
         :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
         :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21073L,i_item_id#21074,i_rec_start_date#21075,i_rec_end_date#21076,i_item_desc#21077,i_current_price#21078,i_wholesale_cost#21079,i_brand_id#21080,i_brand#21081,i_class_id#21082,i_class#21083,i_category_id#21084,i_category#21085,i_manufact_id#21086,i_manufact#21087,i_size#21088,i_formulation#21089,i_color#21090,i_units#21091,i_container#21092,i_manager_id#21093,i_product_name#21094] orc
         :  +- SubqueryAlias tmp
         :     +- Union false, false
         :        :- Union false, false
         :        :  :- Project [ws_ext_sales_price#21117 AS ext_price#21058, ws_sold_date_sk#21128L AS sold_date_sk#21059L, ws_item_sk#21097L AS sold_item_sk#21060L, ws_sold_time_sk#21095L AS time_sk#21061L]
         :        :  :  +- Filter (((d_date_sk#21129L = ws_sold_date_sk#21128L) AND (d_moy#21137 = 12)) AND (d_year#21135 = 2001))
         :        :  :     +- Join Inner
         :        :  :        :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
         :        :  :        :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#21095L,ws_ship_date_sk#21096L,ws_item_sk#21097L,ws_bill_customer_sk#21098L,ws_bill_cdemo_sk#21099L,ws_bill_hdemo_sk#21100L,ws_bill_addr_sk#21101L,ws_ship_customer_sk#21102L,ws_ship_cdemo_sk#21103L,ws_ship_hdemo_sk#21104L,ws_ship_addr_sk#21105L,ws_web_page_sk#21106L,ws_web_site_sk#21107L,ws_ship_mode_sk#21108L,ws_warehouse_sk#21109L,ws_promo_sk#21110L,ws_order_number#21111L,ws_quantity#21112,ws_wholesale_cost#21113,ws_list_price#21114,ws_sales_price#21115,ws_ext_discount_amt#21116,ws_ext_sales_price#21117,ws_ext_wholesale_cost#21118,... 10 more fields] orc
         :        :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :        :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21129L,d_date_id#21130,d_date#21131,d_month_seq#21132,d_week_seq#21133,d_quarter_seq#21134,d_year#21135,d_dow#21136,d_moy#21137,d_dom#21138,d_qoy#21139,d_fy_year#21140,d_fy_quarter_seq#21141,d_fy_week_seq#21142,d_day_name#21143,d_quarter_name#21144,d_holiday#21145,d_weekend#21146,d_following_holiday#21147,d_first_dom#21148,d_last_dom#21149,d_same_day_ly#21150,d_same_day_lq#21151,d_current_day#21152,... 4 more fields] orc
         :        :  +- Project [cs_ext_sales_price#21179 AS ext_price#21062, cs_sold_date_sk#21190L AS sold_date_sk#21063L, cs_item_sk#21171L AS sold_item_sk#21064L, cs_sold_time_sk#21157L AS time_sk#21065L]
         :        :     +- Filter (((d_date_sk#21191L = cs_sold_date_sk#21190L) AND (d_moy#21199 = 12)) AND (d_year#21197 = 2001))
         :        :        +- Join Inner
         :        :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
         :        :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#21157L,cs_ship_date_sk#21158L,cs_bill_customer_sk#21159L,cs_bill_cdemo_sk#21160L,cs_bill_hdemo_sk#21161L,cs_bill_addr_sk#21162L,cs_ship_customer_sk#21163L,cs_ship_cdemo_sk#21164L,cs_ship_hdemo_sk#21165L,cs_ship_addr_sk#21166L,cs_call_center_sk#21167L,cs_catalog_page_sk#21168L,cs_ship_mode_sk#21169L,cs_warehouse_sk#21170L,cs_item_sk#21171L,cs_promo_sk#21172L,cs_order_number#21173L,cs_quantity#21174,cs_wholesale_cost#21175,cs_list_price#21176,cs_sales_price#21177,cs_ext_discount_amt#21178,cs_ext_sales_price#21179,cs_ext_wholesale_cost#21180,... 10 more fields] orc
         :        :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :        :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21191L,d_date_id#21192,d_date#21193,d_month_seq#21194,d_week_seq#21195,d_quarter_seq#21196,d_year#21197,d_dow#21198,d_moy#21199,d_dom#21200,d_qoy#21201,d_fy_year#21202,d_fy_quarter_seq#21203,d_fy_week_seq#21204,d_day_name#21205,d_quarter_name#21206,d_holiday#21207,d_weekend#21208,d_following_holiday#21209,d_first_dom#21210,d_last_dom#21211,d_same_day_ly#21212,d_same_day_lq#21213,d_current_day#21214,... 4 more fields] orc
         :        +- Project [ss_ext_sales_price#21233 AS ext_price#21066, ss_sold_date_sk#21241L AS sold_date_sk#21067L, ss_item_sk#21220L AS sold_item_sk#21068L, ss_sold_time_sk#21219L AS time_sk#21069L]
         :           +- Filter (((d_date_sk#21242L = ss_sold_date_sk#21241L) AND (d_moy#21250 = 12)) AND (d_year#21248 = 2001))
         :              +- Join Inner
         :                 :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21219L,ss_item_sk#21220L,ss_customer_sk#21221L,ss_cdemo_sk#21222L,ss_hdemo_sk#21223L,ss_addr_sk#21224L,ss_store_sk#21225L,ss_promo_sk#21226L,ss_ticket_number#21227L,ss_quantity#21228,ss_wholesale_cost#21229,ss_list_price#21230,ss_sales_price#21231,ss_ext_discount_amt#21232,ss_ext_sales_price#21233,ss_ext_wholesale_cost#21234,ss_ext_list_price#21235,ss_ext_tax#21236,ss_coupon_amt#21237,ss_net_paid#21238,ss_net_paid_inc_tax#21239,ss_net_profit#21240,ss_sold_date_sk#21241L] orc
         :                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21242L,d_date_id#21243,d_date#21244,d_month_seq#21245,d_week_seq#21246,d_quarter_seq#21247,d_year#21248,d_dow#21249,d_moy#21250,d_dom#21251,d_qoy#21252,d_fy_year#21253,d_fy_quarter_seq#21254,d_fy_week_seq#21255,d_day_name#21256,d_quarter_name#21257,d_holiday#21258,d_weekend#21259,d_following_holiday#21260,d_first_dom#21261,d_last_dom#21262,d_same_day_ly#21263,d_same_day_lq#21264,d_current_day#21265,... 4 more fields] orc
         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
            +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#21270L,t_time_id#21271,t_time#21272,t_hour#21273,t_minute#21274,t_second#21275,t_am_pm#21276,t_shift#21277,t_sub_shift#21278,t_meal_time#21279] orc

== Optimized Logical Plan ==
Sort [ext_price#21072 DESC NULLS LAST, brand_id#21070 ASC NULLS FIRST], true
+- Aggregate [i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274], [i_brand_id#21080 AS brand_id#21070, i_brand#21081 AS brand#21071, t_hour#21273, t_minute#21274, sum(ext_price#21058) AS ext_price#21072]
   +- Project [i_brand_id#21080, i_brand#21081, ext_price#21058, t_hour#21273, t_minute#21274]
      +- Join Inner, (time_sk#21061L = t_time_sk#21270L)
         :- Project [i_brand_id#21080, i_brand#21081, ext_price#21058, time_sk#21061L]
         :  +- Join Inner, (sold_item_sk#21060L = i_item_sk#21073L)
         :     :- Project [i_item_sk#21073L, i_brand_id#21080, i_brand#21081]
         :     :  +- Filter ((isnotnull(i_manager_id#21093) AND (i_manager_id#21093 = 1)) AND isnotnull(i_item_sk#21073L))
         :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21073L,i_item_id#21074,i_rec_start_date#21075,i_rec_end_date#21076,i_item_desc#21077,i_current_price#21078,i_wholesale_cost#21079,i_brand_id#21080,i_brand#21081,i_class_id#21082,i_class#21083,i_category_id#21084,i_category#21085,i_manufact_id#21086,i_manufact#21087,i_size#21088,i_formulation#21089,i_color#21090,i_units#21091,i_container#21092,i_manager_id#21093,i_product_name#21094] orc
         :     +- Union false, false
         :        :- Project [ws_ext_sales_price#21117 AS ext_price#21058, ws_item_sk#21097L AS sold_item_sk#21060L, ws_sold_time_sk#21095L AS time_sk#21061L]
         :        :  +- Join Inner, (d_date_sk#21129L = ws_sold_date_sk#21128L)
         :        :     :- Project [ws_sold_time_sk#21095L, ws_item_sk#21097L, ws_ext_sales_price#21117, ws_sold_date_sk#21128L]
         :        :     :  +- Filter (((isnotnull(ws_sold_date_sk#21128L) AND isnotnull(ws_item_sk#21097L)) AND isnotnull(ws_sold_time_sk#21095L)) AND dynamicpruning#21286 [ws_sold_date_sk#21128L])
         :        :     :     :  +- Project [d_date_sk#21129L]
         :        :     :     :     +- Filter (((isnotnull(d_moy#21137) AND isnotnull(d_year#21135)) AND ((d_moy#21137 = 12) AND (d_year#21135 = 2001))) AND isnotnull(d_date_sk#21129L))
         :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21129L,d_date_id#21130,d_date#21131,d_month_seq#21132,d_week_seq#21133,d_quarter_seq#21134,d_year#21135,d_dow#21136,d_moy#21137,d_dom#21138,d_qoy#21139,d_fy_year#21140,d_fy_quarter_seq#21141,d_fy_week_seq#21142,d_day_name#21143,d_quarter_name#21144,d_holiday#21145,d_weekend#21146,d_following_holiday#21147,d_first_dom#21148,d_last_dom#21149,d_same_day_ly#21150,d_same_day_lq#21151,d_current_day#21152,... 4 more fields] orc
         :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#21095L,ws_ship_date_sk#21096L,ws_item_sk#21097L,ws_bill_customer_sk#21098L,ws_bill_cdemo_sk#21099L,ws_bill_hdemo_sk#21100L,ws_bill_addr_sk#21101L,ws_ship_customer_sk#21102L,ws_ship_cdemo_sk#21103L,ws_ship_hdemo_sk#21104L,ws_ship_addr_sk#21105L,ws_web_page_sk#21106L,ws_web_site_sk#21107L,ws_ship_mode_sk#21108L,ws_warehouse_sk#21109L,ws_promo_sk#21110L,ws_order_number#21111L,ws_quantity#21112,ws_wholesale_cost#21113,ws_list_price#21114,ws_sales_price#21115,ws_ext_discount_amt#21116,ws_ext_sales_price#21117,ws_ext_wholesale_cost#21118,... 10 more fields] orc
         :        :     +- Project [d_date_sk#21129L]
         :        :        +- Filter (((isnotnull(d_moy#21137) AND isnotnull(d_year#21135)) AND ((d_moy#21137 = 12) AND (d_year#21135 = 2001))) AND isnotnull(d_date_sk#21129L))
         :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21129L,d_date_id#21130,d_date#21131,d_month_seq#21132,d_week_seq#21133,d_quarter_seq#21134,d_year#21135,d_dow#21136,d_moy#21137,d_dom#21138,d_qoy#21139,d_fy_year#21140,d_fy_quarter_seq#21141,d_fy_week_seq#21142,d_day_name#21143,d_quarter_name#21144,d_holiday#21145,d_weekend#21146,d_following_holiday#21147,d_first_dom#21148,d_last_dom#21149,d_same_day_ly#21150,d_same_day_lq#21151,d_current_day#21152,... 4 more fields] orc
         :        :- Project [cs_ext_sales_price#21179 AS ext_price#21062, cs_item_sk#21171L AS sold_item_sk#21064L, cs_sold_time_sk#21157L AS time_sk#21065L]
         :        :  +- Join Inner, (d_date_sk#21191L = cs_sold_date_sk#21190L)
         :        :     :- Project [cs_sold_time_sk#21157L, cs_item_sk#21171L, cs_ext_sales_price#21179, cs_sold_date_sk#21190L]
         :        :     :  +- Filter (((isnotnull(cs_sold_date_sk#21190L) AND isnotnull(cs_item_sk#21171L)) AND isnotnull(cs_sold_time_sk#21157L)) AND dynamicpruning#21287 [cs_sold_date_sk#21190L])
         :        :     :     :  +- Project [d_date_sk#21191L]
         :        :     :     :     +- Filter (((isnotnull(d_moy#21199) AND isnotnull(d_year#21197)) AND ((d_moy#21199 = 12) AND (d_year#21197 = 2001))) AND isnotnull(d_date_sk#21191L))
         :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21191L,d_date_id#21192,d_date#21193,d_month_seq#21194,d_week_seq#21195,d_quarter_seq#21196,d_year#21197,d_dow#21198,d_moy#21199,d_dom#21200,d_qoy#21201,d_fy_year#21202,d_fy_quarter_seq#21203,d_fy_week_seq#21204,d_day_name#21205,d_quarter_name#21206,d_holiday#21207,d_weekend#21208,d_following_holiday#21209,d_first_dom#21210,d_last_dom#21211,d_same_day_ly#21212,d_same_day_lq#21213,d_current_day#21214,... 4 more fields] orc
         :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#21157L,cs_ship_date_sk#21158L,cs_bill_customer_sk#21159L,cs_bill_cdemo_sk#21160L,cs_bill_hdemo_sk#21161L,cs_bill_addr_sk#21162L,cs_ship_customer_sk#21163L,cs_ship_cdemo_sk#21164L,cs_ship_hdemo_sk#21165L,cs_ship_addr_sk#21166L,cs_call_center_sk#21167L,cs_catalog_page_sk#21168L,cs_ship_mode_sk#21169L,cs_warehouse_sk#21170L,cs_item_sk#21171L,cs_promo_sk#21172L,cs_order_number#21173L,cs_quantity#21174,cs_wholesale_cost#21175,cs_list_price#21176,cs_sales_price#21177,cs_ext_discount_amt#21178,cs_ext_sales_price#21179,cs_ext_wholesale_cost#21180,... 10 more fields] orc
         :        :     +- Project [d_date_sk#21191L]
         :        :        +- Filter (((isnotnull(d_moy#21199) AND isnotnull(d_year#21197)) AND ((d_moy#21199 = 12) AND (d_year#21197 = 2001))) AND isnotnull(d_date_sk#21191L))
         :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21191L,d_date_id#21192,d_date#21193,d_month_seq#21194,d_week_seq#21195,d_quarter_seq#21196,d_year#21197,d_dow#21198,d_moy#21199,d_dom#21200,d_qoy#21201,d_fy_year#21202,d_fy_quarter_seq#21203,d_fy_week_seq#21204,d_day_name#21205,d_quarter_name#21206,d_holiday#21207,d_weekend#21208,d_following_holiday#21209,d_first_dom#21210,d_last_dom#21211,d_same_day_ly#21212,d_same_day_lq#21213,d_current_day#21214,... 4 more fields] orc
         :        +- Project [ss_ext_sales_price#21233 AS ext_price#21066, ss_item_sk#21220L AS sold_item_sk#21068L, ss_sold_time_sk#21219L AS time_sk#21069L]
         :           +- Join Inner, (d_date_sk#21242L = ss_sold_date_sk#21241L)
         :              :- Project [ss_sold_time_sk#21219L, ss_item_sk#21220L, ss_ext_sales_price#21233, ss_sold_date_sk#21241L]
         :              :  +- Filter (((isnotnull(ss_sold_date_sk#21241L) AND isnotnull(ss_item_sk#21220L)) AND isnotnull(ss_sold_time_sk#21219L)) AND dynamicpruning#21288 [ss_sold_date_sk#21241L])
         :              :     :  +- Project [d_date_sk#21242L]
         :              :     :     +- Filter (((isnotnull(d_moy#21250) AND isnotnull(d_year#21248)) AND ((d_moy#21250 = 12) AND (d_year#21248 = 2001))) AND isnotnull(d_date_sk#21242L))
         :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21242L,d_date_id#21243,d_date#21244,d_month_seq#21245,d_week_seq#21246,d_quarter_seq#21247,d_year#21248,d_dow#21249,d_moy#21250,d_dom#21251,d_qoy#21252,d_fy_year#21253,d_fy_quarter_seq#21254,d_fy_week_seq#21255,d_day_name#21256,d_quarter_name#21257,d_holiday#21258,d_weekend#21259,d_following_holiday#21260,d_first_dom#21261,d_last_dom#21262,d_same_day_ly#21263,d_same_day_lq#21264,d_current_day#21265,... 4 more fields] orc
         :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21219L,ss_item_sk#21220L,ss_customer_sk#21221L,ss_cdemo_sk#21222L,ss_hdemo_sk#21223L,ss_addr_sk#21224L,ss_store_sk#21225L,ss_promo_sk#21226L,ss_ticket_number#21227L,ss_quantity#21228,ss_wholesale_cost#21229,ss_list_price#21230,ss_sales_price#21231,ss_ext_discount_amt#21232,ss_ext_sales_price#21233,ss_ext_wholesale_cost#21234,ss_ext_list_price#21235,ss_ext_tax#21236,ss_coupon_amt#21237,ss_net_paid#21238,ss_net_paid_inc_tax#21239,ss_net_profit#21240,ss_sold_date_sk#21241L] orc
         :              +- Project [d_date_sk#21242L]
         :                 +- Filter (((isnotnull(d_moy#21250) AND isnotnull(d_year#21248)) AND ((d_moy#21250 = 12) AND (d_year#21248 = 2001))) AND isnotnull(d_date_sk#21242L))
         :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21242L,d_date_id#21243,d_date#21244,d_month_seq#21245,d_week_seq#21246,d_quarter_seq#21247,d_year#21248,d_dow#21249,d_moy#21250,d_dom#21251,d_qoy#21252,d_fy_year#21253,d_fy_quarter_seq#21254,d_fy_week_seq#21255,d_day_name#21256,d_quarter_name#21257,d_holiday#21258,d_weekend#21259,d_following_holiday#21260,d_first_dom#21261,d_last_dom#21262,d_same_day_ly#21263,d_same_day_lq#21264,d_current_day#21265,... 4 more fields] orc
         +- Project [t_time_sk#21270L, t_hour#21273, t_minute#21274]
            +- Filter (((t_meal_time#21279 = breakfast) OR (t_meal_time#21279 = dinner)) AND isnotnull(t_time_sk#21270L))
               +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#21270L,t_time_id#21271,t_time#21272,t_hour#21273,t_minute#21274,t_second#21275,t_am_pm#21276,t_shift#21277,t_sub_shift#21278,t_meal_time#21279] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [ext_price#21072 DESC NULLS LAST, brand_id#21070 ASC NULLS FIRST], true, 0
   +- Exchange rangepartitioning(ext_price#21072 DESC NULLS LAST, brand_id#21070 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#22148]
      +- HashAggregate(keys=[i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274], functions=[sum(ext_price#21058)], output=[brand_id#21070, brand#21071, t_hour#21273, t_minute#21274, ext_price#21072])
         +- Exchange hashpartitioning(i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274, 3000), ENSURE_REQUIREMENTS, [id=#22145]
            +- HashAggregate(keys=[i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274], functions=[partial_sum(ext_price#21058)], output=[i_brand#21081, i_brand_id#21080, t_hour#21273, t_minute#21274, sum#21290])
               +- Project [i_brand_id#21080, i_brand#21081, ext_price#21058, t_hour#21273, t_minute#21274]
                  +- BroadcastHashJoin [time_sk#21061L], [t_time_sk#21270L], Inner, BuildRight, false
                     :- Project [i_brand_id#21080, i_brand#21081, ext_price#21058, time_sk#21061L]
                     :  +- BroadcastHashJoin [i_item_sk#21073L], [sold_item_sk#21060L], Inner, BuildLeft, false
                     :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22136]
                     :     :  +- Project [i_item_sk#21073L, i_brand_id#21080, i_brand#21081]
                     :     :     +- Filter ((isnotnull(i_manager_id#21093) AND (i_manager_id#21093 = 1)) AND isnotnull(i_item_sk#21073L))
                     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21073L,i_brand_id#21080,i_brand#21081,i_manager_id#21093] Batched: true, DataFilters: [isnotnull(i_manager_id#21093), (i_manager_id#21093 = 1), isnotnull(i_item_sk#21073L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_brand:string,i_manager_id:int>
                     :     +- Union
                     :        :- Project [ws_ext_sales_price#21117 AS ext_price#21058, ws_item_sk#21097L AS sold_item_sk#21060L, ws_sold_time_sk#21095L AS time_sk#21061L]
                     :        :  +- BroadcastHashJoin [ws_sold_date_sk#21128L], [d_date_sk#21129L], Inner, BuildRight, false
                     :        :     :- Filter (isnotnull(ws_item_sk#21097L) AND isnotnull(ws_sold_time_sk#21095L))
                     :        :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#21095L,ws_item_sk#21097L,ws_ext_sales_price#21117,ws_sold_date_sk#21128L] Batched: true, DataFilters: [isnotnull(ws_item_sk#21097L), isnotnull(ws_sold_time_sk#21095L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#21128L), dynamicpruningexpression(ws_sold_date_sk#21128L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_time_sk)], ReadSchema: struct<ws_sold_time_sk:bigint,ws_item_sk:bigint,ws_ext_sales_price:double>
                     :        :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21286, 0, true, Project [d_date_sk#21129L], [d_date_sk#21129L]
                     :        :     :           +- AdaptiveSparkPlan isFinalPlan=false
                     :        :     :              +- Project [d_date_sk#21129L]
                     :        :     :                 +- Filter ((((isnotnull(d_moy#21137) AND isnotnull(d_year#21135)) AND (d_moy#21137 = 12)) AND (d_year#21135 = 2001)) AND isnotnull(d_date_sk#21129L))
                     :        :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21129L,d_year#21135,d_moy#21137] Batched: true, DataFilters: [isnotnull(d_moy#21137), isnotnull(d_year#21135), (d_moy#21137 = 12), (d_year#21135 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22125]
                     :        :        +- Project [d_date_sk#21129L]
                     :        :           +- Filter ((((isnotnull(d_moy#21137) AND isnotnull(d_year#21135)) AND (d_moy#21137 = 12)) AND (d_year#21135 = 2001)) AND isnotnull(d_date_sk#21129L))
                     :        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21129L,d_year#21135,d_moy#21137] Batched: true, DataFilters: [isnotnull(d_moy#21137), isnotnull(d_year#21135), (d_moy#21137 = 12), (d_year#21135 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :        :- Project [cs_ext_sales_price#21179 AS ext_price#21062, cs_item_sk#21171L AS sold_item_sk#21064L, cs_sold_time_sk#21157L AS time_sk#21065L]
                     :        :  +- BroadcastHashJoin [cs_sold_date_sk#21190L], [d_date_sk#21191L], Inner, BuildRight, false
                     :        :     :- Filter (isnotnull(cs_item_sk#21171L) AND isnotnull(cs_sold_time_sk#21157L))
                     :        :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#21157L,cs_item_sk#21171L,cs_ext_sales_price#21179,cs_sold_date_sk#21190L] Batched: true, DataFilters: [isnotnull(cs_item_sk#21171L), isnotnull(cs_sold_time_sk#21157L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#21190L), dynamicpruningexpression(cs_sold_date_sk#21190L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_time_sk)], ReadSchema: struct<cs_sold_time_sk:bigint,cs_item_sk:bigint,cs_ext_sales_price:double>
                     :        :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21287, 0, true, Project [d_date_sk#21191L], [d_date_sk#21191L]
                     :        :     :           +- AdaptiveSparkPlan isFinalPlan=false
                     :        :     :              +- Project [d_date_sk#21191L]
                     :        :     :                 +- Filter ((((isnotnull(d_moy#21199) AND isnotnull(d_year#21197)) AND (d_moy#21199 = 12)) AND (d_year#21197 = 2001)) AND isnotnull(d_date_sk#21191L))
                     :        :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21191L,d_year#21197,d_moy#21199] Batched: true, DataFilters: [isnotnull(d_moy#21199), isnotnull(d_year#21197), (d_moy#21199 = 12), (d_year#21197 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22128]
                     :        :        +- Project [d_date_sk#21191L]
                     :        :           +- Filter ((((isnotnull(d_moy#21199) AND isnotnull(d_year#21197)) AND (d_moy#21199 = 12)) AND (d_year#21197 = 2001)) AND isnotnull(d_date_sk#21191L))
                     :        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21191L,d_year#21197,d_moy#21199] Batched: true, DataFilters: [isnotnull(d_moy#21199), isnotnull(d_year#21197), (d_moy#21199 = 12), (d_year#21197 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :        +- Project [ss_ext_sales_price#21233 AS ext_price#21066, ss_item_sk#21220L AS sold_item_sk#21068L, ss_sold_time_sk#21219L AS time_sk#21069L]
                     :           +- BroadcastHashJoin [ss_sold_date_sk#21241L], [d_date_sk#21242L], Inner, BuildRight, false
                     :              :- Filter (isnotnull(ss_item_sk#21220L) AND isnotnull(ss_sold_time_sk#21219L))
                     :              :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21219L,ss_item_sk#21220L,ss_ext_sales_price#21233,ss_sold_date_sk#21241L] Batched: true, DataFilters: [isnotnull(ss_item_sk#21220L), isnotnull(ss_sold_time_sk#21219L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#21241L), dynamicpruningexpression(ss_sold_date_sk#21241L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_time_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_item_sk:bigint,ss_ext_sales_price:double>
                     :              :        +- SubqueryAdaptiveBroadcast dynamicpruning#21288, 0, true, Project [d_date_sk#21242L], [d_date_sk#21242L]
                     :              :           +- AdaptiveSparkPlan isFinalPlan=false
                     :              :              +- Project [d_date_sk#21242L]
                     :              :                 +- Filter ((((isnotnull(d_moy#21250) AND isnotnull(d_year#21248)) AND (d_moy#21250 = 12)) AND (d_year#21248 = 2001)) AND isnotnull(d_date_sk#21242L))
                     :              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21242L,d_year#21248,d_moy#21250] Batched: true, DataFilters: [isnotnull(d_moy#21250), isnotnull(d_year#21248), (d_moy#21250 = 12), (d_year#21248 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22131]
                     :                 +- Project [d_date_sk#21242L]
                     :                    +- Filter ((((isnotnull(d_moy#21250) AND isnotnull(d_year#21248)) AND (d_moy#21250 = 12)) AND (d_year#21248 = 2001)) AND isnotnull(d_date_sk#21242L))
                     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21242L,d_year#21248,d_moy#21250] Batched: true, DataFilters: [isnotnull(d_moy#21250), isnotnull(d_year#21248), (d_moy#21250 = 12), (d_year#21248 = 2001), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22140]
                        +- Project [t_time_sk#21270L, t_hour#21273, t_minute#21274]
                           +- Filter (((t_meal_time#21279 = breakfast) OR (t_meal_time#21279 = dinner)) AND isnotnull(t_time_sk#21270L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#21270L,t_hour#21273,t_minute#21274,t_meal_time#21279] Batched: true, DataFilters: [((t_meal_time#21279 = breakfast) OR (t_meal_time#21279 = dinner)), isnotnull(t_time_sk#21270L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(t_meal_time,breakfast),EqualTo(t_meal_time,dinner)), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int,t_meal_time:string>

read query: spark_queries/q72.sql
explain query: q72
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['total_cnt DESC NULLS LAST, 'i_item_desc ASC NULLS FIRST, 'w_warehouse_name ASC NULLS FIRST, 'd_week_seq ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_desc, 'w_warehouse_name, 'd1.d_week_seq], ['i_item_desc, 'w_warehouse_name, 'd1.d_week_seq, 'count(CASE WHEN isnull('p_promo_sk) THEN 1 ELSE 0 END) AS no_promo#21291, 'count(CASE WHEN isnotnull('p_promo_sk) THEN 1 ELSE 0 END) AS promo#21292, 'count(1) AS total_cnt#21293]
         +- 'Filter (((('d1.d_week_seq = 'd2.d_week_seq) AND ('inv_quantity_on_hand < 'cs_quantity)) AND (('d3.d_date > ('d1.d_date + INTERVAL '5' DAY)) AND ('hd_buy_potential = 1001-5000))) AND ((('d1.d_year = 2001) AND ('hd_buy_potential = 1001-5000)) AND (('cd_marital_status = M) AND ('d1.d_year = 2001))))
            +- 'Join LeftOuter, (('cr_item_sk = 'cs_item_sk) AND ('cr_order_number = 'cs_order_number))
               :- 'Join LeftOuter, ('cs_promo_sk = 'p_promo_sk)
               :  :- 'Join Inner, ('cs_ship_date_sk = 'd3.d_date_sk)
               :  :  :- 'Join Inner, ('inv_date_sk = 'd2.d_date_sk)
               :  :  :  :- 'Join Inner, ('cs_sold_date_sk = 'd1.d_date_sk)
               :  :  :  :  :- 'Join Inner, ('cs_bill_hdemo_sk = 'hd_demo_sk)
               :  :  :  :  :  :- 'Join Inner, ('cs_bill_cdemo_sk = 'cd_demo_sk)
               :  :  :  :  :  :  :- 'Join Inner, ('i_item_sk = 'cs_item_sk)
               :  :  :  :  :  :  :  :- 'Join Inner, ('w_warehouse_sk = 'inv_warehouse_sk)
               :  :  :  :  :  :  :  :  :- 'Join Inner, ('cs_item_sk = 'inv_item_sk)
               :  :  :  :  :  :  :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [inventory], [], false
               :  :  :  :  :  :  :  :  +- 'UnresolvedRelation [warehouse], [], false
               :  :  :  :  :  :  :  +- 'UnresolvedRelation [item], [], false
               :  :  :  :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  :  :  :  +- 'UnresolvedRelation [household_demographics], [], false
               :  :  :  :  +- 'SubqueryAlias d1
               :  :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  :  +- 'SubqueryAlias d2
               :  :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  :  +- 'SubqueryAlias d3
               :  :     +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [promotion], [], false
               +- 'UnresolvedRelation [catalog_returns], [], false

== Analyzed Logical Plan ==
i_item_desc: string, w_warehouse_name: string, d_week_seq: int, no_promo: bigint, promo: bigint, total_cnt: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [total_cnt#21293L DESC NULLS LAST, i_item_desc#21351 ASC NULLS FIRST, w_warehouse_name#21335 ASC NULLS FIRST, d_week_seq#21387 ASC NULLS FIRST], true
      +- Aggregate [i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387], [i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387, count(CASE WHEN isnull(p_promo_sk#21467L) THEN 1 ELSE 0 END) AS no_promo#21291L, count(CASE WHEN isnotnull(p_promo_sk#21467L) THEN 1 ELSE 0 END) AS promo#21292L, count(1) AS total_cnt#21293L]
         +- Filter ((((d_week_seq#21387 = d_week_seq#21415) AND (inv_quantity_on_hand#21332 < cs_quantity#21312)) AND ((d_date#21441 > date_add(d_date#21385, extractansiintervaldays(INTERVAL '5' DAY))) AND (hd_buy_potential#21380 = 1001-5000))) AND (((d_year#21389 = 2001) AND (hd_buy_potential#21380 = 1001-5000)) AND ((cd_marital_status#21371 = M) AND (d_year#21389 = 2001))))
            +- Join LeftOuter, ((cr_item_sk#21487L = cs_item_sk#21309L) AND (cr_order_number#21501L = cs_order_number#21311L))
               :- Join LeftOuter, (cs_promo_sk#21310L = p_promo_sk#21467L)
               :  :- Join Inner, (cs_ship_date_sk#21296L = d_date_sk#21439L)
               :  :  :- Join Inner, (inv_date_sk#21329L = d_date_sk#21411L)
               :  :  :  :- Join Inner, (cs_sold_date_sk#21328L = d_date_sk#21383L)
               :  :  :  :  :- Join Inner, (cs_bill_hdemo_sk#21299L = hd_demo_sk#21378L)
               :  :  :  :  :  :- Join Inner, (cs_bill_cdemo_sk#21298L = cd_demo_sk#21369L)
               :  :  :  :  :  :  :- Join Inner, (i_item_sk#21347L = cs_item_sk#21309L)
               :  :  :  :  :  :  :  :- Join Inner, (w_warehouse_sk#21333L = inv_warehouse_sk#21331L)
               :  :  :  :  :  :  :  :  :- Join Inner, (cs_item_sk#21309L = inv_item_sk#21330L)
               :  :  :  :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#21295L,cs_ship_date_sk#21296L,cs_bill_customer_sk#21297L,cs_bill_cdemo_sk#21298L,cs_bill_hdemo_sk#21299L,cs_bill_addr_sk#21300L,cs_ship_customer_sk#21301L,cs_ship_cdemo_sk#21302L,cs_ship_hdemo_sk#21303L,cs_ship_addr_sk#21304L,cs_call_center_sk#21305L,cs_catalog_page_sk#21306L,cs_ship_mode_sk#21307L,cs_warehouse_sk#21308L,cs_item_sk#21309L,cs_promo_sk#21310L,cs_order_number#21311L,cs_quantity#21312,cs_wholesale_cost#21313,cs_list_price#21314,cs_sales_price#21315,cs_ext_discount_amt#21316,cs_ext_sales_price#21317,cs_ext_wholesale_cost#21318,... 10 more fields] orc
               :  :  :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
               :  :  :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#21329L,inv_item_sk#21330L,inv_warehouse_sk#21331L,inv_quantity_on_hand#21332] orc
               :  :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
               :  :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#21333L,w_warehouse_id#21334,w_warehouse_name#21335,w_warehouse_sq_ft#21336,w_street_number#21337,w_street_name#21338,w_street_type#21339,w_suite_number#21340,w_city#21341,w_county#21342,w_state#21343,w_zip#21344,w_country#21345,w_gmt_offset#21346] orc
               :  :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21347L,i_item_id#21348,i_rec_start_date#21349,i_rec_end_date#21350,i_item_desc#21351,i_current_price#21352,i_wholesale_cost#21353,i_brand_id#21354,i_brand#21355,i_class_id#21356,i_class#21357,i_category_id#21358,i_category#21359,i_manufact_id#21360,i_manufact#21361,i_size#21362,i_formulation#21363,i_color#21364,i_units#21365,i_container#21366,i_manager_id#21367,i_product_name#21368] orc
               :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
               :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#21369L,cd_gender#21370,cd_marital_status#21371,cd_education_status#21372,cd_purchase_estimate#21373,cd_credit_rating#21374,cd_dep_count#21375,cd_dep_employed_count#21376,cd_dep_college_count#21377] orc
               :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
               :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21378L,hd_income_band_sk#21379L,hd_buy_potential#21380,hd_dep_count#21381,hd_vehicle_count#21382] orc
               :  :  :  :  +- SubqueryAlias d1
               :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21383L,d_date_id#21384,d_date#21385,d_month_seq#21386,d_week_seq#21387,d_quarter_seq#21388,d_year#21389,d_dow#21390,d_moy#21391,d_dom#21392,d_qoy#21393,d_fy_year#21394,d_fy_quarter_seq#21395,d_fy_week_seq#21396,d_day_name#21397,d_quarter_name#21398,d_holiday#21399,d_weekend#21400,d_following_holiday#21401,d_first_dom#21402,d_last_dom#21403,d_same_day_ly#21404,d_same_day_lq#21405,d_current_day#21406,... 4 more fields] orc
               :  :  :  +- SubqueryAlias d2
               :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21411L,d_date_id#21412,d_date#21413,d_month_seq#21414,d_week_seq#21415,d_quarter_seq#21416,d_year#21417,d_dow#21418,d_moy#21419,d_dom#21420,d_qoy#21421,d_fy_year#21422,d_fy_quarter_seq#21423,d_fy_week_seq#21424,d_day_name#21425,d_quarter_name#21426,d_holiday#21427,d_weekend#21428,d_following_holiday#21429,d_first_dom#21430,d_last_dom#21431,d_same_day_ly#21432,d_same_day_lq#21433,d_current_day#21434,... 4 more fields] orc
               :  :  +- SubqueryAlias d3
               :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21439L,d_date_id#21440,d_date#21441,d_month_seq#21442,d_week_seq#21443,d_quarter_seq#21444,d_year#21445,d_dow#21446,d_moy#21447,d_dom#21448,d_qoy#21449,d_fy_year#21450,d_fy_quarter_seq#21451,d_fy_week_seq#21452,d_day_name#21453,d_quarter_name#21454,d_holiday#21455,d_weekend#21456,d_following_holiday#21457,d_first_dom#21458,d_last_dom#21459,d_same_day_ly#21460,d_same_day_lq#21461,d_current_day#21462,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#21467L,p_promo_id#21468,p_start_date_sk#21469L,p_end_date_sk#21470L,p_item_sk#21471L,p_cost#21472,p_response_target#21473,p_promo_name#21474,p_channel_dmail#21475,p_channel_email#21476,p_channel_catalog#21477,p_channel_tv#21478,p_channel_radio#21479,p_channel_press#21480,p_channel_event#21481,p_channel_demo#21482,p_channel_details#21483,p_purpose#21484,p_discount_active#21485] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#21486L,cr_item_sk#21487L,cr_refunded_customer_sk#21488L,cr_refunded_cdemo_sk#21489L,cr_refunded_hdemo_sk#21490L,cr_refunded_addr_sk#21491L,cr_returning_customer_sk#21492L,cr_returning_cdemo_sk#21493L,cr_returning_hdemo_sk#21494L,cr_returning_addr_sk#21495L,cr_call_center_sk#21496L,cr_catalog_page_sk#21497L,cr_ship_mode_sk#21498L,cr_warehouse_sk#21499L,cr_reason_sk#21500L,cr_order_number#21501L,cr_return_quantity#21502,cr_return_amount#21503,cr_return_tax#21504,cr_return_amt_inc_tax#21505,cr_fee#21506,cr_return_ship_cost#21507,cr_refunded_cash#21508,cr_reversed_charge#21509,... 3 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [total_cnt#21293L DESC NULLS LAST, i_item_desc#21351 ASC NULLS FIRST, w_warehouse_name#21335 ASC NULLS FIRST, d_week_seq#21387 ASC NULLS FIRST], true
      +- Aggregate [i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387], [i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387, count(1) AS no_promo#21291L, count(1) AS promo#21292L, count(1) AS total_cnt#21293L]
         +- Project [w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
            +- Join LeftOuter, ((cr_item_sk#21487L = cs_item_sk#21309L) AND (cr_order_number#21501L = cs_order_number#21311L))
               :- Project [cs_item_sk#21309L, cs_order_number#21311L, w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
               :  +- Join LeftOuter, (cs_promo_sk#21310L = p_promo_sk#21467L)
               :     :- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
               :     :  +- Join Inner, ((((inv_quantity_on_hand#21332 < cs_quantity#21312) AND (cs_item_sk#21309L = inv_item_sk#21330L)) AND (cs_sold_date_sk#21328L = d_date_sk#21383L)) AND (d_date#21441 > date_add(d_date#21385, 5)))
               :     :     :- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441, i_item_desc#21351]
               :     :     :  +- Join Inner, (i_item_sk#21347L = cs_item_sk#21309L)
               :     :     :     :- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441]
               :     :     :     :  +- Join Inner, (cs_bill_cdemo_sk#21298L = cd_demo_sk#21369L)
               :     :     :     :     :- Project [cs_bill_cdemo_sk#21298L, cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441]
               :     :     :     :     :  +- Join Inner, (cs_ship_date_sk#21296L = d_date_sk#21439L)
               :     :     :     :     :     :- Project [cs_ship_date_sk#21296L, cs_bill_cdemo_sk#21298L, cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L]
               :     :     :     :     :     :  +- Join Inner, (cs_bill_hdemo_sk#21299L = hd_demo_sk#21378L)
               :     :     :     :     :     :     :- Project [cs_ship_date_sk#21296L, cs_bill_cdemo_sk#21298L, cs_bill_hdemo_sk#21299L, cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L]
               :     :     :     :     :     :     :  +- Filter ((((((isnotnull(cs_quantity#21312) AND isnotnull(cs_item_sk#21309L)) AND isnotnull(cs_bill_cdemo_sk#21298L)) AND isnotnull(cs_bill_hdemo_sk#21299L)) AND isnotnull(cs_sold_date_sk#21328L)) AND isnotnull(cs_ship_date_sk#21296L)) AND dynamicpruning#21521 [cs_sold_date_sk#21328L])
               :     :     :     :     :     :     :     :  +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_quantity_on_hand#21332, w_warehouse_name#21335]
               :     :     :     :     :     :     :     :     +- Join Inner, (w_warehouse_sk#21333L = inv_warehouse_sk#21331L)
               :     :     :     :     :     :     :     :        :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_warehouse_sk#21331L, inv_quantity_on_hand#21332]
               :     :     :     :     :     :     :     :        :  +- Join Inner, (inv_date_sk#21329L = d_date_sk#21411L)
               :     :     :     :     :     :     :     :        :     :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, d_date_sk#21411L]
               :     :     :     :     :     :     :     :        :     :  +- Join Inner, (d_week_seq#21387 = d_week_seq#21415)
               :     :     :     :     :     :     :     :        :     :     :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387]
               :     :     :     :     :     :     :     :        :     :     :  +- Filter (((isnotnull(d_year#21389) AND (d_year#21389 = 2001)) AND isnotnull(d_date_sk#21383L)) AND (isnotnull(d_week_seq#21387) AND isnotnull(d_date#21385)))
               :     :     :     :     :     :     :     :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21383L,d_date_id#21384,d_date#21385,d_month_seq#21386,d_week_seq#21387,d_quarter_seq#21388,d_year#21389,d_dow#21390,d_moy#21391,d_dom#21392,d_qoy#21393,d_fy_year#21394,d_fy_quarter_seq#21395,d_fy_week_seq#21396,d_day_name#21397,d_quarter_name#21398,d_holiday#21399,d_weekend#21400,d_following_holiday#21401,d_first_dom#21402,d_last_dom#21403,d_same_day_ly#21404,d_same_day_lq#21405,d_current_day#21406,... 4 more fields] orc
               :     :     :     :     :     :     :     :        :     :     +- Project [d_date_sk#21411L, d_week_seq#21415]
               :     :     :     :     :     :     :     :        :     :        +- Filter (isnotnull(d_week_seq#21415) AND isnotnull(d_date_sk#21411L))
               :     :     :     :     :     :     :     :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21411L,d_date_id#21412,d_date#21413,d_month_seq#21414,d_week_seq#21415,d_quarter_seq#21416,d_year#21417,d_dow#21418,d_moy#21419,d_dom#21420,d_qoy#21421,d_fy_year#21422,d_fy_quarter_seq#21423,d_fy_week_seq#21424,d_day_name#21425,d_quarter_name#21426,d_holiday#21427,d_weekend#21428,d_following_holiday#21429,d_first_dom#21430,d_last_dom#21431,d_same_day_ly#21432,d_same_day_lq#21433,d_current_day#21434,... 4 more fields] orc
               :     :     :     :     :     :     :     :        :     +- Filter (((isnotnull(inv_quantity_on_hand#21332) AND isnotnull(inv_item_sk#21330L)) AND isnotnull(inv_warehouse_sk#21331L)) AND isnotnull(inv_date_sk#21329L))
               :     :     :     :     :     :     :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#21329L,inv_item_sk#21330L,inv_warehouse_sk#21331L,inv_quantity_on_hand#21332] orc
               :     :     :     :     :     :     :     :        +- Project [w_warehouse_sk#21333L, w_warehouse_name#21335]
               :     :     :     :     :     :     :     :           +- Filter isnotnull(w_warehouse_sk#21333L)
               :     :     :     :     :     :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#21333L,w_warehouse_id#21334,w_warehouse_name#21335,w_warehouse_sq_ft#21336,w_street_number#21337,w_street_name#21338,w_street_type#21339,w_suite_number#21340,w_city#21341,w_county#21342,w_state#21343,w_zip#21344,w_country#21345,w_gmt_offset#21346] orc
               :     :     :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#21295L,cs_ship_date_sk#21296L,cs_bill_customer_sk#21297L,cs_bill_cdemo_sk#21298L,cs_bill_hdemo_sk#21299L,cs_bill_addr_sk#21300L,cs_ship_customer_sk#21301L,cs_ship_cdemo_sk#21302L,cs_ship_hdemo_sk#21303L,cs_ship_addr_sk#21304L,cs_call_center_sk#21305L,cs_catalog_page_sk#21306L,cs_ship_mode_sk#21307L,cs_warehouse_sk#21308L,cs_item_sk#21309L,cs_promo_sk#21310L,cs_order_number#21311L,cs_quantity#21312,cs_wholesale_cost#21313,cs_list_price#21314,cs_sales_price#21315,cs_ext_discount_amt#21316,cs_ext_sales_price#21317,cs_ext_wholesale_cost#21318,... 10 more fields] orc
               :     :     :     :     :     :     +- Project [hd_demo_sk#21378L]
               :     :     :     :     :     :        +- Filter ((isnotnull(hd_buy_potential#21380) AND (hd_buy_potential#21380 = 1001-5000)) AND isnotnull(hd_demo_sk#21378L))
               :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21378L,hd_income_band_sk#21379L,hd_buy_potential#21380,hd_dep_count#21381,hd_vehicle_count#21382] orc
               :     :     :     :     :     +- Project [d_date_sk#21439L, d_date#21441]
               :     :     :     :     :        +- Filter (isnotnull(d_date#21441) AND isnotnull(d_date_sk#21439L))
               :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21439L,d_date_id#21440,d_date#21441,d_month_seq#21442,d_week_seq#21443,d_quarter_seq#21444,d_year#21445,d_dow#21446,d_moy#21447,d_dom#21448,d_qoy#21449,d_fy_year#21450,d_fy_quarter_seq#21451,d_fy_week_seq#21452,d_day_name#21453,d_quarter_name#21454,d_holiday#21455,d_weekend#21456,d_following_holiday#21457,d_first_dom#21458,d_last_dom#21459,d_same_day_ly#21460,d_same_day_lq#21461,d_current_day#21462,... 4 more fields] orc
               :     :     :     :     +- Project [cd_demo_sk#21369L]
               :     :     :     :        +- Filter ((isnotnull(cd_marital_status#21371) AND (cd_marital_status#21371 = M)) AND isnotnull(cd_demo_sk#21369L))
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#21369L,cd_gender#21370,cd_marital_status#21371,cd_education_status#21372,cd_purchase_estimate#21373,cd_credit_rating#21374,cd_dep_count#21375,cd_dep_employed_count#21376,cd_dep_college_count#21377] orc
               :     :     :     +- Project [i_item_sk#21347L, i_item_desc#21351]
               :     :     :        +- Filter isnotnull(i_item_sk#21347L)
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21347L,i_item_id#21348,i_rec_start_date#21349,i_rec_end_date#21350,i_item_desc#21351,i_current_price#21352,i_wholesale_cost#21353,i_brand_id#21354,i_brand#21355,i_class_id#21356,i_class#21357,i_category_id#21358,i_category#21359,i_manufact_id#21360,i_manufact#21361,i_size#21362,i_formulation#21363,i_color#21364,i_units#21365,i_container#21366,i_manager_id#21367,i_product_name#21368] orc
               :     :     +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_quantity_on_hand#21332, w_warehouse_name#21335]
               :     :        +- Join Inner, (w_warehouse_sk#21333L = inv_warehouse_sk#21331L)
               :     :           :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_warehouse_sk#21331L, inv_quantity_on_hand#21332]
               :     :           :  +- Join Inner, (inv_date_sk#21329L = d_date_sk#21411L)
               :     :           :     :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, d_date_sk#21411L]
               :     :           :     :  +- Join Inner, (d_week_seq#21387 = d_week_seq#21415)
               :     :           :     :     :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387]
               :     :           :     :     :  +- Filter (((isnotnull(d_year#21389) AND (d_year#21389 = 2001)) AND isnotnull(d_date_sk#21383L)) AND (isnotnull(d_week_seq#21387) AND isnotnull(d_date#21385)))
               :     :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21383L,d_date_id#21384,d_date#21385,d_month_seq#21386,d_week_seq#21387,d_quarter_seq#21388,d_year#21389,d_dow#21390,d_moy#21391,d_dom#21392,d_qoy#21393,d_fy_year#21394,d_fy_quarter_seq#21395,d_fy_week_seq#21396,d_day_name#21397,d_quarter_name#21398,d_holiday#21399,d_weekend#21400,d_following_holiday#21401,d_first_dom#21402,d_last_dom#21403,d_same_day_ly#21404,d_same_day_lq#21405,d_current_day#21406,... 4 more fields] orc
               :     :           :     :     +- Project [d_date_sk#21411L, d_week_seq#21415]
               :     :           :     :        +- Filter (isnotnull(d_week_seq#21415) AND isnotnull(d_date_sk#21411L))
               :     :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21411L,d_date_id#21412,d_date#21413,d_month_seq#21414,d_week_seq#21415,d_quarter_seq#21416,d_year#21417,d_dow#21418,d_moy#21419,d_dom#21420,d_qoy#21421,d_fy_year#21422,d_fy_quarter_seq#21423,d_fy_week_seq#21424,d_day_name#21425,d_quarter_name#21426,d_holiday#21427,d_weekend#21428,d_following_holiday#21429,d_first_dom#21430,d_last_dom#21431,d_same_day_ly#21432,d_same_day_lq#21433,d_current_day#21434,... 4 more fields] orc
               :     :           :     +- Filter (((isnotnull(inv_quantity_on_hand#21332) AND isnotnull(inv_item_sk#21330L)) AND isnotnull(inv_warehouse_sk#21331L)) AND isnotnull(inv_date_sk#21329L))
               :     :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#21329L,inv_item_sk#21330L,inv_warehouse_sk#21331L,inv_quantity_on_hand#21332] orc
               :     :           +- Project [w_warehouse_sk#21333L, w_warehouse_name#21335]
               :     :              +- Filter isnotnull(w_warehouse_sk#21333L)
               :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#21333L,w_warehouse_id#21334,w_warehouse_name#21335,w_warehouse_sq_ft#21336,w_street_number#21337,w_street_name#21338,w_street_type#21339,w_suite_number#21340,w_city#21341,w_county#21342,w_state#21343,w_zip#21344,w_country#21345,w_gmt_offset#21346] orc
               :     +- Project [p_promo_sk#21467L]
               :        +- Filter isnotnull(p_promo_sk#21467L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#21467L,p_promo_id#21468,p_start_date_sk#21469L,p_end_date_sk#21470L,p_item_sk#21471L,p_cost#21472,p_response_target#21473,p_promo_name#21474,p_channel_dmail#21475,p_channel_email#21476,p_channel_catalog#21477,p_channel_tv#21478,p_channel_radio#21479,p_channel_press#21480,p_channel_event#21481,p_channel_demo#21482,p_channel_details#21483,p_purpose#21484,p_discount_active#21485] orc
               +- Project [cr_item_sk#21487L, cr_order_number#21501L]
                  +- Filter (isnotnull(cr_item_sk#21487L) AND isnotnull(cr_order_number#21501L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#21486L,cr_item_sk#21487L,cr_refunded_customer_sk#21488L,cr_refunded_cdemo_sk#21489L,cr_refunded_hdemo_sk#21490L,cr_refunded_addr_sk#21491L,cr_returning_customer_sk#21492L,cr_returning_cdemo_sk#21493L,cr_returning_hdemo_sk#21494L,cr_returning_addr_sk#21495L,cr_call_center_sk#21496L,cr_catalog_page_sk#21497L,cr_ship_mode_sk#21498L,cr_warehouse_sk#21499L,cr_reason_sk#21500L,cr_order_number#21501L,cr_return_quantity#21502,cr_return_amount#21503,cr_return_tax#21504,cr_return_amt_inc_tax#21505,cr_fee#21506,cr_return_ship_cost#21507,cr_refunded_cash#21508,cr_reversed_charge#21509,... 3 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[total_cnt#21293L DESC NULLS LAST,i_item_desc#21351 ASC NULLS FIRST,w_warehouse_name#21335 ASC NULLS FIRST,d_week_seq#21387 ASC NULLS FIRST], output=[i_item_desc#21351,w_warehouse_name#21335,d_week_seq#21387,no_promo#21291L,promo#21292L,total_cnt#21293L])
   +- HashAggregate(keys=[i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387], functions=[count(1)], output=[i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387, no_promo#21291L, promo#21292L, total_cnt#21293L])
      +- Exchange hashpartitioning(i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387, 3000), ENSURE_REQUIREMENTS, [id=#22479]
         +- HashAggregate(keys=[i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387], functions=[partial_count(1)], output=[i_item_desc#21351, w_warehouse_name#21335, d_week_seq#21387, count#21523L])
            +- Project [w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
               +- SortMergeJoin [cs_item_sk#21309L, cs_order_number#21311L], [cr_item_sk#21487L, cr_order_number#21501L], LeftOuter
                  :- Sort [cs_item_sk#21309L ASC NULLS FIRST, cs_order_number#21311L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_item_sk#21309L, cs_order_number#21311L, 3000), ENSURE_REQUIREMENTS, [id=#22471]
                  :     +- Project [cs_item_sk#21309L, cs_order_number#21311L, w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
                  :        +- BroadcastHashJoin [cs_promo_sk#21310L], [p_promo_sk#21467L], LeftOuter, BuildRight, false
                  :           :- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, w_warehouse_name#21335, i_item_desc#21351, d_week_seq#21387]
                  :           :  +- SortMergeJoin [cs_item_sk#21309L, cs_sold_date_sk#21328L], [inv_item_sk#21330L, d_date_sk#21383L], Inner, ((inv_quantity_on_hand#21332 < cs_quantity#21312) AND (d_date#21441 > date_add(d_date#21385, 5)))
                  :           :     :- Sort [cs_item_sk#21309L ASC NULLS FIRST, cs_sold_date_sk#21328L ASC NULLS FIRST], false, 0
                  :           :     :  +- Exchange hashpartitioning(cs_item_sk#21309L, cs_sold_date_sk#21328L, 3000), ENSURE_REQUIREMENTS, [id=#22459]
                  :           :     :     +- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441, i_item_desc#21351]
                  :           :     :        +- SortMergeJoin [cs_item_sk#21309L], [i_item_sk#21347L], Inner
                  :           :     :           :- Sort [cs_item_sk#21309L ASC NULLS FIRST], false, 0
                  :           :     :           :  +- Exchange hashpartitioning(cs_item_sk#21309L, 3000), ENSURE_REQUIREMENTS, [id=#22440]
                  :           :     :           :     +- Project [cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441]
                  :           :     :           :        +- BroadcastHashJoin [cs_bill_cdemo_sk#21298L], [cd_demo_sk#21369L], Inner, BuildRight, false
                  :           :     :           :           :- Project [cs_bill_cdemo_sk#21298L, cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L, d_date#21441]
                  :           :     :           :           :  +- BroadcastHashJoin [cs_ship_date_sk#21296L], [d_date_sk#21439L], Inner, BuildRight, false
                  :           :     :           :           :     :- Project [cs_ship_date_sk#21296L, cs_bill_cdemo_sk#21298L, cs_item_sk#21309L, cs_promo_sk#21310L, cs_order_number#21311L, cs_quantity#21312, cs_sold_date_sk#21328L]
                  :           :     :           :           :     :  +- BroadcastHashJoin [cs_bill_hdemo_sk#21299L], [hd_demo_sk#21378L], Inner, BuildRight, false
                  :           :     :           :           :     :     :- Filter ((((isnotnull(cs_quantity#21312) AND isnotnull(cs_item_sk#21309L)) AND isnotnull(cs_bill_cdemo_sk#21298L)) AND isnotnull(cs_bill_hdemo_sk#21299L)) AND isnotnull(cs_ship_date_sk#21296L))
                  :           :     :           :           :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_date_sk#21296L,cs_bill_cdemo_sk#21298L,cs_bill_hdemo_sk#21299L,cs_item_sk#21309L,cs_promo_sk#21310L,cs_order_number#21311L,cs_quantity#21312,cs_sold_date_sk#21328L] Batched: true, DataFilters: [isnotnull(cs_quantity#21312), isnotnull(cs_item_sk#21309L), isnotnull(cs_bill_cdemo_sk#21298L), ..., Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#21328L), dynamicpruningexpression(cs_sold_date_sk#21328L IN dynamicpru..., PushedFilters: [IsNotNull(cs_quantity), IsNotNull(cs_item_sk), IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_bill_hd..., ReadSchema: struct<cs_ship_date_sk:bigint,cs_bill_cdemo_sk:bigint,cs_bill_hdemo_sk:bigint,cs_item_sk:bigint,c...
                  :           :     :           :           :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21521, 1, true, Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_quantity_on_hand#21332, w_warehouse_name#21335], [inv_item_sk#21330L, d_date_sk#21383L]
                  :           :     :           :           :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :           :     :           :           :     :     :              +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_quantity_on_hand#21332, w_warehouse_name#21335]
                  :           :     :           :           :     :     :                 +- BroadcastHashJoin [inv_warehouse_sk#21331L], [w_warehouse_sk#21333L], Inner, BuildRight, false
                  :           :     :           :           :     :     :                    :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_warehouse_sk#21331L, inv_quantity_on_hand#21332]
                  :           :     :           :           :     :     :                    :  +- BroadcastHashJoin [d_date_sk#21411L], [inv_date_sk#21329L], Inner, BuildLeft, false
                  :           :     :           :           :     :     :                    :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[3, bigint, true]),false), [id=#22375]
                  :           :     :           :           :     :     :                    :     :  +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, d_date_sk#21411L]
                  :           :     :           :           :     :     :                    :     :     +- BroadcastHashJoin [d_week_seq#21387], [d_week_seq#21415], Inner, BuildLeft, false
                  :           :     :           :           :     :     :                    :     :        :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[2, int, true] as bigint)),false), [id=#22371]
                  :           :     :           :           :     :     :                    :     :        :  +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387]
                  :           :     :           :           :     :     :                    :     :        :     +- Filter ((((isnotnull(d_year#21389) AND (d_year#21389 = 2001)) AND isnotnull(d_date_sk#21383L)) AND isnotnull(d_week_seq#21387)) AND isnotnull(d_date#21385))
                  :           :     :           :           :     :     :                    :     :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21383L,d_date#21385,d_week_seq#21387,d_year#21389] Batched: true, DataFilters: [isnotnull(d_year#21389), (d_year#21389 = 2001), isnotnull(d_date_sk#21383L), isnotnull(d_week_se..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk), IsNotNull(d_week_seq), IsNotNull(..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_week_seq:int,d_year:int>
                  :           :     :           :           :     :     :                    :     :        +- Filter (isnotnull(d_week_seq#21415) AND isnotnull(d_date_sk#21411L))
                  :           :     :           :           :     :     :                    :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21411L,d_week_seq#21415] Batched: true, DataFilters: [isnotnull(d_week_seq#21415), isnotnull(d_date_sk#21411L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
                  :           :     :           :           :     :     :                    :     +- Filter (((isnotnull(inv_quantity_on_hand#21332) AND isnotnull(inv_item_sk#21330L)) AND isnotnull(inv_warehouse_sk#21331L)) AND isnotnull(inv_date_sk#21329L))
                  :           :     :           :           :     :     :                    :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#21329L,inv_item_sk#21330L,inv_warehouse_sk#21331L,inv_quantity_on_hand#21332] Batched: true, DataFilters: [isnotnull(inv_quantity_on_hand#21332), isnotnull(inv_item_sk#21330L), isnotnull(inv_warehouse_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_quantity_on_hand), IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(..., ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                  :           :     :           :           :     :     :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22379]
                  :           :     :           :           :     :     :                       +- Filter isnotnull(w_warehouse_sk#21333L)
                  :           :     :           :           :     :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#21333L,w_warehouse_name#21335] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#21333L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>
                  :           :     :           :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22427]
                  :           :     :           :           :     :        +- Project [hd_demo_sk#21378L]
                  :           :     :           :           :     :           +- Filter ((isnotnull(hd_buy_potential#21380) AND (hd_buy_potential#21380 = 1001-5000)) AND isnotnull(hd_demo_sk#21378L))
                  :           :     :           :           :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21378L,hd_buy_potential#21380] Batched: true, DataFilters: [isnotnull(hd_buy_potential#21380), (hd_buy_potential#21380 = 1001-5000), isnotnull(hd_demo_sk#21..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_buy_potential), EqualTo(hd_buy_potential,1001-5000), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_buy_potential:string>
                  :           :     :           :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22431]
                  :           :     :           :           :        +- Filter (isnotnull(d_date#21441) AND isnotnull(d_date_sk#21439L))
                  :           :     :           :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21439L,d_date#21441] Batched: true, DataFilters: [isnotnull(d_date#21441), isnotnull(d_date_sk#21439L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :           :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22435]
                  :           :     :           :              +- Project [cd_demo_sk#21369L]
                  :           :     :           :                 +- Filter ((isnotnull(cd_marital_status#21371) AND (cd_marital_status#21371 = M)) AND isnotnull(cd_demo_sk#21369L))
                  :           :     :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#21369L,cd_marital_status#21371] Batched: true, DataFilters: [isnotnull(cd_marital_status#21371), (cd_marital_status#21371 = M), isnotnull(cd_demo_sk#21369L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_marital_status), EqualTo(cd_marital_status,M), IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string>
                  :           :     :           +- Sort [i_item_sk#21347L ASC NULLS FIRST], false, 0
                  :           :     :              +- Exchange hashpartitioning(i_item_sk#21347L, 3000), ENSURE_REQUIREMENTS, [id=#22441]
                  :           :     :                 +- Filter isnotnull(i_item_sk#21347L)
                  :           :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#21347L,i_item_desc#21351] Batched: true, DataFilters: [isnotnull(i_item_sk#21347L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_desc:string>
                  :           :     +- Sort [inv_item_sk#21330L ASC NULLS FIRST, d_date_sk#21383L ASC NULLS FIRST], false, 0
                  :           :        +- Exchange hashpartitioning(inv_item_sk#21330L, d_date_sk#21383L, 3000), ENSURE_REQUIREMENTS, [id=#22460]
                  :           :           +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_quantity_on_hand#21332, w_warehouse_name#21335]
                  :           :              +- BroadcastHashJoin [inv_warehouse_sk#21331L], [w_warehouse_sk#21333L], Inner, BuildRight, false
                  :           :                 :- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, inv_item_sk#21330L, inv_warehouse_sk#21331L, inv_quantity_on_hand#21332]
                  :           :                 :  +- BroadcastHashJoin [d_date_sk#21411L], [inv_date_sk#21329L], Inner, BuildLeft, false
                  :           :                 :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[3, bigint, true]),false), [id=#22450]
                  :           :                 :     :  +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387, d_date_sk#21411L]
                  :           :                 :     :     +- BroadcastHashJoin [d_week_seq#21387], [d_week_seq#21415], Inner, BuildLeft, false
                  :           :                 :     :        :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[2, int, true] as bigint)),false), [id=#22446]
                  :           :                 :     :        :  +- Project [d_date_sk#21383L, d_date#21385, d_week_seq#21387]
                  :           :                 :     :        :     +- Filter ((((isnotnull(d_year#21389) AND (d_year#21389 = 2001)) AND isnotnull(d_date_sk#21383L)) AND isnotnull(d_week_seq#21387)) AND isnotnull(d_date#21385))
                  :           :                 :     :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21383L,d_date#21385,d_week_seq#21387,d_year#21389] Batched: true, DataFilters: [isnotnull(d_year#21389), (d_year#21389 = 2001), isnotnull(d_date_sk#21383L), isnotnull(d_week_se..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk), IsNotNull(d_week_seq), IsNotNull(..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_week_seq:int,d_year:int>
                  :           :                 :     :        +- Filter (isnotnull(d_week_seq#21415) AND isnotnull(d_date_sk#21411L))
                  :           :                 :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21411L,d_week_seq#21415] Batched: true, DataFilters: [isnotnull(d_week_seq#21415), isnotnull(d_date_sk#21411L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_week_seq:int>
                  :           :                 :     +- Filter (((isnotnull(inv_quantity_on_hand#21332) AND isnotnull(inv_item_sk#21330L)) AND isnotnull(inv_warehouse_sk#21331L)) AND isnotnull(inv_date_sk#21329L))
                  :           :                 :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#21329L,inv_item_sk#21330L,inv_warehouse_sk#21331L,inv_quantity_on_hand#21332] Batched: true, DataFilters: [isnotnull(inv_quantity_on_hand#21332), isnotnull(inv_item_sk#21330L), isnotnull(inv_warehouse_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_quantity_on_hand), IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk), IsNotNull(..., ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_warehouse_sk:bigint,inv_quantity_on_hand:int>
                  :           :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22454]
                  :           :                    +- Filter isnotnull(w_warehouse_sk#21333L)
                  :           :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#21333L,w_warehouse_name#21335] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#21333L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:bigint,w_warehouse_name:string>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22466]
                  :              +- Filter isnotnull(p_promo_sk#21467L)
                  :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#21467L] Batched: true, DataFilters: [isnotnull(p_promo_sk#21467L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint>
                  +- Sort [cr_item_sk#21487L ASC NULLS FIRST, cr_order_number#21501L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(cr_item_sk#21487L, cr_order_number#21501L, 3000), ENSURE_REQUIREMENTS, [id=#22472]
                        +- Project [cr_item_sk#21487L, cr_order_number#21501L]
                           +- Filter (isnotnull(cr_item_sk#21487L) AND isnotnull(cr_order_number#21501L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#21487L,cr_order_number#21501L,cr_returned_date_sk#21512L] Batched: true, DataFilters: [isnotnull(cr_item_sk#21487L), isnotnull(cr_order_number#21501L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_order_number)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint>

read query: spark_queries/q73.sql
explain query: q73
== Parsed Logical Plan ==
'Sort ['cnt DESC NULLS LAST], true
+- 'Project ['c_last_name, 'c_first_name, 'c_salutation, 'c_preferred_cust_flag, 'ss_ticket_number, 'cnt]
   +- 'Filter (('ss_customer_sk = 'c_customer_sk) AND (('cnt >= 1) AND ('cnt <= 5)))
      +- 'Join Inner
         :- 'SubqueryAlias dj
         :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk], ['ss_ticket_number, 'ss_customer_sk, 'count(1) AS cnt#21524]
         :     +- 'Filter ((((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_store_sk = 'store.s_store_sk)) AND ('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND ((('date_dim.d_dom >= 1) AND ('date_dim.d_dom <= 2)) AND (('household_demographics.hd_buy_potential = >10000) OR ('household_demographics.hd_buy_potential = unknown)))) AND ((('household_demographics.hd_vehicle_count > 0) AND (CASE WHEN ('household_demographics.hd_vehicle_count > 0) THEN ('household_demographics.hd_dep_count / 'household_demographics.hd_vehicle_count) ELSE null END > 1)) AND ('date_dim.d_year IN (2000,(2000 + 1),(2000 + 2)) AND 'store.s_county IN (Mobile County,Maverick County,Huron County,Kittitas County))))
         :        +- 'Join Inner
         :           :- 'Join Inner
         :           :  :- 'Join Inner
         :           :  :  :- 'UnresolvedRelation [store_sales], [], false
         :           :  :  +- 'UnresolvedRelation [date_dim], [], false
         :           :  +- 'UnresolvedRelation [store], [], false
         :           +- 'UnresolvedRelation [household_demographics], [], false
         +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, c_salutation: string, c_preferred_cust_flag: string, ss_ticket_number: bigint, cnt: bigint
Sort [cnt#21524L DESC NULLS LAST], true
+- Project [c_last_name#21620, c_first_name#21619, c_salutation#21618, c_preferred_cust_flag#21621, ss_ticket_number#21534L, cnt#21524L]
   +- Filter ((ss_customer_sk#21528L = c_customer_sk#21611L) AND ((cnt#21524L >= cast(1 as bigint)) AND (cnt#21524L <= cast(5 as bigint))))
      +- Join Inner
         :- SubqueryAlias dj
         :  +- Aggregate [ss_ticket_number#21534L, ss_customer_sk#21528L], [ss_ticket_number#21534L, ss_customer_sk#21528L, count(1) AS cnt#21524L]
         :     +- Filter (((((ss_sold_date_sk#21548L = d_date_sk#21549L) AND (ss_store_sk#21532L = s_store_sk#21577L)) AND (ss_hdemo_sk#21530L = hd_demo_sk#21606L)) AND (((d_dom#21558 >= 1) AND (d_dom#21558 <= 2)) AND ((hd_buy_potential#21608 = >10000) OR (hd_buy_potential#21608 = unknown)))) AND (((hd_vehicle_count#21610 > 0) AND (CASE WHEN (hd_vehicle_count#21610 > 0) THEN (cast(hd_dep_count#21609 as double) / cast(hd_vehicle_count#21610 as double)) ELSE cast(null as double) END > cast(1 as double))) AND (d_year#21555 IN (2000,(2000 + 1),(2000 + 2)) AND s_county#21600 IN (Mobile County,Maverick County,Huron County,Kittitas County))))
         :        +- Join Inner
         :           :- Join Inner
         :           :  :- Join Inner
         :           :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
         :           :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21526L,ss_item_sk#21527L,ss_customer_sk#21528L,ss_cdemo_sk#21529L,ss_hdemo_sk#21530L,ss_addr_sk#21531L,ss_store_sk#21532L,ss_promo_sk#21533L,ss_ticket_number#21534L,ss_quantity#21535,ss_wholesale_cost#21536,ss_list_price#21537,ss_sales_price#21538,ss_ext_discount_amt#21539,ss_ext_sales_price#21540,ss_ext_wholesale_cost#21541,ss_ext_list_price#21542,ss_ext_tax#21543,ss_coupon_amt#21544,ss_net_paid#21545,ss_net_paid_inc_tax#21546,ss_net_profit#21547,ss_sold_date_sk#21548L] orc
         :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21549L,d_date_id#21550,d_date#21551,d_month_seq#21552,d_week_seq#21553,d_quarter_seq#21554,d_year#21555,d_dow#21556,d_moy#21557,d_dom#21558,d_qoy#21559,d_fy_year#21560,d_fy_quarter_seq#21561,d_fy_week_seq#21562,d_day_name#21563,d_quarter_name#21564,d_holiday#21565,d_weekend#21566,d_following_holiday#21567,d_first_dom#21568,d_last_dom#21569,d_same_day_ly#21570,d_same_day_lq#21571,d_current_day#21572,... 4 more fields] orc
         :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
         :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#21577L,s_store_id#21578,s_rec_start_date#21579,s_rec_end_date#21580,s_closed_date_sk#21581L,s_store_name#21582,s_number_employees#21583,s_floor_space#21584,s_hours#21585,s_manager#21586,s_market_id#21587,s_geography_class#21588,s_market_desc#21589,s_market_manager#21590,s_division_id#21591,s_division_name#21592,s_company_id#21593,s_company_name#21594,s_street_number#21595,s_street_name#21596,s_street_type#21597,s_suite_number#21598,s_city#21599,s_county#21600,... 5 more fields] orc
         :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
         :              +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21606L,hd_income_band_sk#21607L,hd_buy_potential#21608,hd_dep_count#21609,hd_vehicle_count#21610] orc
         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
            +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21611L,c_customer_id#21612,c_current_cdemo_sk#21613L,c_current_hdemo_sk#21614L,c_current_addr_sk#21615L,c_first_shipto_date_sk#21616L,c_first_sales_date_sk#21617L,c_salutation#21618,c_first_name#21619,c_last_name#21620,c_preferred_cust_flag#21621,c_birth_day#21622,c_birth_month#21623,c_birth_year#21624,c_birth_country#21625,c_login#21626,c_email_address#21627,c_last_review_date#21628] orc

== Optimized Logical Plan ==
Sort [cnt#21524L DESC NULLS LAST], true
+- Project [c_last_name#21620, c_first_name#21619, c_salutation#21618, c_preferred_cust_flag#21621, ss_ticket_number#21534L, cnt#21524L]
   +- Join Inner, (ss_customer_sk#21528L = c_customer_sk#21611L)
      :- Filter ((cnt#21524L >= 1) AND (cnt#21524L <= 5))
      :  +- Aggregate [ss_ticket_number#21534L, ss_customer_sk#21528L], [ss_ticket_number#21534L, ss_customer_sk#21528L, count(1) AS cnt#21524L]
      :     +- Project [ss_customer_sk#21528L, ss_ticket_number#21534L]
      :        +- Join Inner, (ss_hdemo_sk#21530L = hd_demo_sk#21606L)
      :           :- Project [ss_customer_sk#21528L, ss_hdemo_sk#21530L, ss_ticket_number#21534L]
      :           :  +- Join Inner, (ss_store_sk#21532L = s_store_sk#21577L)
      :           :     :- Project [ss_customer_sk#21528L, ss_hdemo_sk#21530L, ss_store_sk#21532L, ss_ticket_number#21534L]
      :           :     :  +- Join Inner, (ss_sold_date_sk#21548L = d_date_sk#21549L)
      :           :     :     :- Project [ss_customer_sk#21528L, ss_hdemo_sk#21530L, ss_store_sk#21532L, ss_ticket_number#21534L, ss_sold_date_sk#21548L]
      :           :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#21548L) AND isnotnull(ss_store_sk#21532L)) AND isnotnull(ss_hdemo_sk#21530L)) AND isnotnull(ss_customer_sk#21528L)) AND dynamicpruning#21635 [ss_sold_date_sk#21548L])
      :           :     :     :     :  +- Project [d_date_sk#21549L]
      :           :     :     :     :     +- Filter ((isnotnull(d_dom#21558) AND (((d_dom#21558 >= 1) AND (d_dom#21558 <= 2)) AND d_year#21555 IN (2000,2001,2002))) AND isnotnull(d_date_sk#21549L))
      :           :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21549L,d_date_id#21550,d_date#21551,d_month_seq#21552,d_week_seq#21553,d_quarter_seq#21554,d_year#21555,d_dow#21556,d_moy#21557,d_dom#21558,d_qoy#21559,d_fy_year#21560,d_fy_quarter_seq#21561,d_fy_week_seq#21562,d_day_name#21563,d_quarter_name#21564,d_holiday#21565,d_weekend#21566,d_following_holiday#21567,d_first_dom#21568,d_last_dom#21569,d_same_day_ly#21570,d_same_day_lq#21571,d_current_day#21572,... 4 more fields] orc
      :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21526L,ss_item_sk#21527L,ss_customer_sk#21528L,ss_cdemo_sk#21529L,ss_hdemo_sk#21530L,ss_addr_sk#21531L,ss_store_sk#21532L,ss_promo_sk#21533L,ss_ticket_number#21534L,ss_quantity#21535,ss_wholesale_cost#21536,ss_list_price#21537,ss_sales_price#21538,ss_ext_discount_amt#21539,ss_ext_sales_price#21540,ss_ext_wholesale_cost#21541,ss_ext_list_price#21542,ss_ext_tax#21543,ss_coupon_amt#21544,ss_net_paid#21545,ss_net_paid_inc_tax#21546,ss_net_profit#21547,ss_sold_date_sk#21548L] orc
      :           :     :     +- Project [d_date_sk#21549L]
      :           :     :        +- Filter ((isnotnull(d_dom#21558) AND (((d_dom#21558 >= 1) AND (d_dom#21558 <= 2)) AND d_year#21555 IN (2000,2001,2002))) AND isnotnull(d_date_sk#21549L))
      :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21549L,d_date_id#21550,d_date#21551,d_month_seq#21552,d_week_seq#21553,d_quarter_seq#21554,d_year#21555,d_dow#21556,d_moy#21557,d_dom#21558,d_qoy#21559,d_fy_year#21560,d_fy_quarter_seq#21561,d_fy_week_seq#21562,d_day_name#21563,d_quarter_name#21564,d_holiday#21565,d_weekend#21566,d_following_holiday#21567,d_first_dom#21568,d_last_dom#21569,d_same_day_ly#21570,d_same_day_lq#21571,d_current_day#21572,... 4 more fields] orc
      :           :     +- Project [s_store_sk#21577L]
      :           :        +- Filter (s_county#21600 IN (Mobile County,Maverick County,Huron County,Kittitas County) AND isnotnull(s_store_sk#21577L))
      :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#21577L,s_store_id#21578,s_rec_start_date#21579,s_rec_end_date#21580,s_closed_date_sk#21581L,s_store_name#21582,s_number_employees#21583,s_floor_space#21584,s_hours#21585,s_manager#21586,s_market_id#21587,s_geography_class#21588,s_market_desc#21589,s_market_manager#21590,s_division_id#21591,s_division_name#21592,s_company_id#21593,s_company_name#21594,s_street_number#21595,s_street_name#21596,s_street_type#21597,s_suite_number#21598,s_city#21599,s_county#21600,... 5 more fields] orc
      :           +- Project [hd_demo_sk#21606L]
      :              +- Filter (((isnotnull(hd_vehicle_count#21610) AND isnotnull(hd_dep_count#21609)) AND ((((hd_buy_potential#21608 = >10000) OR (hd_buy_potential#21608 = unknown)) AND (hd_vehicle_count#21610 > 0)) AND ((cast(hd_dep_count#21609 as double) / cast(hd_vehicle_count#21610 as double)) > 1.0))) AND isnotnull(hd_demo_sk#21606L))
      :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21606L,hd_income_band_sk#21607L,hd_buy_potential#21608,hd_dep_count#21609,hd_vehicle_count#21610] orc
      +- Project [c_customer_sk#21611L, c_salutation#21618, c_first_name#21619, c_last_name#21620, c_preferred_cust_flag#21621]
         +- Filter isnotnull(c_customer_sk#21611L)
            +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21611L,c_customer_id#21612,c_current_cdemo_sk#21613L,c_current_hdemo_sk#21614L,c_current_addr_sk#21615L,c_first_shipto_date_sk#21616L,c_first_sales_date_sk#21617L,c_salutation#21618,c_first_name#21619,c_last_name#21620,c_preferred_cust_flag#21621,c_birth_day#21622,c_birth_month#21623,c_birth_year#21624,c_birth_country#21625,c_login#21626,c_email_address#21627,c_last_review_date#21628] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [cnt#21524L DESC NULLS LAST], true, 0
   +- Exchange rangepartitioning(cnt#21524L DESC NULLS LAST, 3000), ENSURE_REQUIREMENTS, [id=#22627]
      +- Project [c_last_name#21620, c_first_name#21619, c_salutation#21618, c_preferred_cust_flag#21621, ss_ticket_number#21534L, cnt#21524L]
         +- SortMergeJoin [ss_customer_sk#21528L], [c_customer_sk#21611L], Inner
            :- Sort [ss_customer_sk#21528L ASC NULLS FIRST], false, 0
            :  +- Exchange hashpartitioning(ss_customer_sk#21528L, 3000), ENSURE_REQUIREMENTS, [id=#22620]
            :     +- Filter ((cnt#21524L >= 1) AND (cnt#21524L <= 5))
            :        +- HashAggregate(keys=[ss_ticket_number#21534L, ss_customer_sk#21528L], functions=[count(1)], output=[ss_ticket_number#21534L, ss_customer_sk#21528L, cnt#21524L])
            :           +- Exchange hashpartitioning(ss_ticket_number#21534L, ss_customer_sk#21528L, 3000), ENSURE_REQUIREMENTS, [id=#22615]
            :              +- HashAggregate(keys=[ss_ticket_number#21534L, ss_customer_sk#21528L], functions=[partial_count(1)], output=[ss_ticket_number#21534L, ss_customer_sk#21528L, count#21637L])
            :                 +- Project [ss_customer_sk#21528L, ss_ticket_number#21534L]
            :                    +- BroadcastHashJoin [ss_hdemo_sk#21530L], [hd_demo_sk#21606L], Inner, BuildRight, false
            :                       :- Project [ss_customer_sk#21528L, ss_hdemo_sk#21530L, ss_ticket_number#21534L]
            :                       :  +- BroadcastHashJoin [ss_store_sk#21532L], [s_store_sk#21577L], Inner, BuildRight, false
            :                       :     :- Project [ss_customer_sk#21528L, ss_hdemo_sk#21530L, ss_store_sk#21532L, ss_ticket_number#21534L]
            :                       :     :  +- BroadcastHashJoin [ss_sold_date_sk#21548L], [d_date_sk#21549L], Inner, BuildRight, false
            :                       :     :     :- Filter ((isnotnull(ss_store_sk#21532L) AND isnotnull(ss_hdemo_sk#21530L)) AND isnotnull(ss_customer_sk#21528L))
            :                       :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#21528L,ss_hdemo_sk#21530L,ss_store_sk#21532L,ss_ticket_number#21534L,ss_sold_date_sk#21548L] Batched: true, DataFilters: [isnotnull(ss_store_sk#21532L), isnotnull(ss_hdemo_sk#21530L), isnotnull(ss_customer_sk#21528L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#21548L), dynamicpruningexpression(ss_sold_date_sk#21548L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint,ss_ticket_number:bigint>
            :                       :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#21635, 0, true, Project [d_date_sk#21549L], [d_date_sk#21549L]
            :                       :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
            :                       :     :     :              +- Project [d_date_sk#21549L]
            :                       :     :     :                 +- Filter ((((isnotnull(d_dom#21558) AND (d_dom#21558 >= 1)) AND (d_dom#21558 <= 2)) AND d_year#21555 IN (2000,2001,2002)) AND isnotnull(d_date_sk#21549L))
            :                       :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21549L,d_year#21555,d_dom#21558] Batched: true, DataFilters: [isnotnull(d_dom#21558), (d_dom#21558 >= 1), (d_dom#21558 <= 2), d_year#21555 IN (2000,2001,2002)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [2000,2001,2..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
            :                       :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22602]
            :                       :     :        +- Project [d_date_sk#21549L]
            :                       :     :           +- Filter ((((isnotnull(d_dom#21558) AND (d_dom#21558 >= 1)) AND (d_dom#21558 <= 2)) AND d_year#21555 IN (2000,2001,2002)) AND isnotnull(d_date_sk#21549L))
            :                       :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21549L,d_year#21555,d_dom#21558] Batched: true, DataFilters: [isnotnull(d_dom#21558), (d_dom#21558 >= 1), (d_dom#21558 <= 2), d_year#21555 IN (2000,2001,2002)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [2000,2001,2..., ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dom:int>
            :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22606]
            :                       :        +- Project [s_store_sk#21577L]
            :                       :           +- Filter (s_county#21600 IN (Mobile County,Maverick County,Huron County,Kittitas County) AND isnotnull(s_store_sk#21577L))
            :                       :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#21577L,s_county#21600] Batched: true, DataFilters: [s_county#21600 IN (Mobile County,Maverick County,Huron County,Kittitas County), isnotnull(s_stor..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(s_county, [Huron County,Kittitas County,Maverick County,Mobile County]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_county:string>
            :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#22610]
            :                          +- Project [hd_demo_sk#21606L]
            :                             +- Filter (((((isnotnull(hd_vehicle_count#21610) AND isnotnull(hd_dep_count#21609)) AND ((hd_buy_potential#21608 = >10000) OR (hd_buy_potential#21608 = unknown))) AND (hd_vehicle_count#21610 > 0)) AND ((cast(hd_dep_count#21609 as double) / cast(hd_vehicle_count#21610 as double)) > 1.0)) AND isnotnull(hd_demo_sk#21606L))
            :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#21606L,hd_buy_potential#21608,hd_dep_count#21609,hd_vehicle_count#21610] Batched: true, DataFilters: [isnotnull(hd_vehicle_count#21610), isnotnull(hd_dep_count#21609), ((hd_buy_potential#21608 = >10..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_vehicle_count), IsNotNull(hd_dep_count), Or(EqualTo(hd_buy_potential,>10000),EqualT..., ReadSchema: struct<hd_demo_sk:bigint,hd_buy_potential:string,hd_dep_count:int,hd_vehicle_count:int>
            +- Sort [c_customer_sk#21611L ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(c_customer_sk#21611L, 3000), ENSURE_REQUIREMENTS, [id=#22621]
                  +- Filter isnotnull(c_customer_sk#21611L)
                     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21611L,c_salutation#21618,c_first_name#21619,c_last_name#21620,c_preferred_cust_flag#21621] Batched: true, DataFilters: [isnotnull(c_customer_sk#21611L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_salutation:string,c_first_name:string,c_last_name:string,c_preferre...

read query: spark_queries/q74.sql
explain query: q74
== Parsed Logical Plan ==
CTE [year_total]
:  +- 'SubqueryAlias year_total
:     +- 'Union false, false
:        :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'd_year], ['c_customer_id AS customer_id#21638, 'c_first_name AS customer_first_name#21639, 'c_last_name AS customer_last_name#21640, 'd_year AS year#21641, 'max('ss_net_paid) AS year_total#21642, s AS sale_type#21643]
:        :  +- 'Filter ((('c_customer_sk = 'ss_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND 'd_year IN (2001,(2001 + 1)))
:        :     +- 'Join Inner
:        :        :- 'Join Inner
:        :        :  :- 'UnresolvedRelation [customer], [], false
:        :        :  +- 'UnresolvedRelation [store_sales], [], false
:        :        +- 'UnresolvedRelation [date_dim], [], false
:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'd_year], ['c_customer_id AS customer_id#21644, 'c_first_name AS customer_first_name#21645, 'c_last_name AS customer_last_name#21646, 'd_year AS year#21647, 'max('ws_net_paid) AS year_total#21648, w AS sale_type#21649]
:           +- 'Filter ((('c_customer_sk = 'ws_bill_customer_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND 'd_year IN (2001,(2001 + 1)))
:              +- 'Join Inner
:                 :- 'Join Inner
:                 :  :- 'UnresolvedRelation [customer], [], false
:                 :  +- 'UnresolvedRelation [web_sales], [], false
:                 +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort [2 ASC NULLS FIRST, 1 ASC NULLS FIRST, 3 ASC NULLS FIRST], true
         +- 'Project ['t_s_secyear.customer_id, 't_s_secyear.customer_first_name, 't_s_secyear.customer_last_name]
            +- 'Filter ((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) AND ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) AND (('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) AND ('t_s_firstyear.sale_type = s))) AND ((('t_w_firstyear.sale_type = w) AND ('t_s_secyear.sale_type = s)) AND ('t_w_secyear.sale_type = w))) AND (((('t_s_firstyear.year = 2001) AND ('t_s_secyear.year = (2001 + 1))) AND (('t_w_firstyear.year = 2001) AND ('t_w_secyear.year = (2001 + 1)))) AND ((('t_s_firstyear.year_total > 0) AND ('t_w_firstyear.year_total > 0)) AND (CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'SubqueryAlias t_s_firstyear
                  :  :  :  +- 'UnresolvedRelation [year_total], [], false
                  :  :  +- 'SubqueryAlias t_s_secyear
                  :  :     +- 'UnresolvedRelation [year_total], [], false
                  :  +- 'SubqueryAlias t_w_firstyear
                  :     +- 'UnresolvedRelation [year_total], [], false
                  +- 'SubqueryAlias t_w_secyear
                     +- 'UnresolvedRelation [year_total], [], false

== Analyzed Logical Plan ==
customer_id: string, customer_first_name: string, customer_last_name: string
WithCTE
:- CTERelationDef 48
:  +- SubqueryAlias year_total
:     +- Union false, false
:        :- Aggregate [c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697], [c_customer_id#21651 AS customer_id#21638, c_first_name#21658 AS customer_first_name#21639, c_last_name#21659 AS customer_last_name#21640, d_year#21697 AS year#21641, max(ss_net_paid#21687) AS year_total#21642, s AS sale_type#21643]
:        :  +- Filter (((c_customer_sk#21650L = ss_customer_sk#21670L) AND (ss_sold_date_sk#21690L = d_date_sk#21691L)) AND d_year#21697 IN (2001,(2001 + 1)))
:        :     +- Join Inner
:        :        :- Join Inner
:        :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:        :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21650L,c_customer_id#21651,c_current_cdemo_sk#21652L,c_current_hdemo_sk#21653L,c_current_addr_sk#21654L,c_first_shipto_date_sk#21655L,c_first_sales_date_sk#21656L,c_salutation#21657,c_first_name#21658,c_last_name#21659,c_preferred_cust_flag#21660,c_birth_day#21661,c_birth_month#21662,c_birth_year#21663,c_birth_country#21664,c_login#21665,c_email_address#21666,c_last_review_date#21667] orc
:        :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:        :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21668L,ss_item_sk#21669L,ss_customer_sk#21670L,ss_cdemo_sk#21671L,ss_hdemo_sk#21672L,ss_addr_sk#21673L,ss_store_sk#21674L,ss_promo_sk#21675L,ss_ticket_number#21676L,ss_quantity#21677,ss_wholesale_cost#21678,ss_list_price#21679,ss_sales_price#21680,ss_ext_discount_amt#21681,ss_ext_sales_price#21682,ss_ext_wholesale_cost#21683,ss_ext_list_price#21684,ss_ext_tax#21685,ss_coupon_amt#21686,ss_net_paid#21687,ss_net_paid_inc_tax#21688,ss_net_profit#21689,ss_sold_date_sk#21690L] orc
:        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21691L,d_date_id#21692,d_date#21693,d_month_seq#21694,d_week_seq#21695,d_quarter_seq#21696,d_year#21697,d_dow#21698,d_moy#21699,d_dom#21700,d_qoy#21701,d_fy_year#21702,d_fy_quarter_seq#21703,d_fy_week_seq#21704,d_day_name#21705,d_quarter_name#21706,d_holiday#21707,d_weekend#21708,d_following_holiday#21709,d_first_dom#21710,d_last_dom#21711,d_same_day_ly#21712,d_same_day_lq#21713,d_current_day#21714,... 4 more fields] orc
:        +- Aggregate [c_customer_id#21720, c_first_name#21727, c_last_name#21728, d_year#21777], [c_customer_id#21720 AS customer_id#21644, c_first_name#21727 AS customer_first_name#21645, c_last_name#21728 AS customer_last_name#21646, d_year#21777 AS year#21647, max(ws_net_paid#21765) AS year_total#21648, w AS sale_type#21649]
:           +- Filter (((c_customer_sk#21719L = ws_bill_customer_sk#21740L) AND (ws_sold_date_sk#21770L = d_date_sk#21771L)) AND d_year#21777 IN (2001,(2001 + 1)))
:              +- Join Inner
:                 :- Join Inner
:                 :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
:                 :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21719L,c_customer_id#21720,c_current_cdemo_sk#21721L,c_current_hdemo_sk#21722L,c_current_addr_sk#21723L,c_first_shipto_date_sk#21724L,c_first_sales_date_sk#21725L,c_salutation#21726,c_first_name#21727,c_last_name#21728,c_preferred_cust_flag#21729,c_birth_day#21730,c_birth_month#21731,c_birth_year#21732,c_birth_country#21733,c_login#21734,c_email_address#21735,c_last_review_date#21736] orc
:                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#21737L,ws_ship_date_sk#21738L,ws_item_sk#21739L,ws_bill_customer_sk#21740L,ws_bill_cdemo_sk#21741L,ws_bill_hdemo_sk#21742L,ws_bill_addr_sk#21743L,ws_ship_customer_sk#21744L,ws_ship_cdemo_sk#21745L,ws_ship_hdemo_sk#21746L,ws_ship_addr_sk#21747L,ws_web_page_sk#21748L,ws_web_site_sk#21749L,ws_ship_mode_sk#21750L,ws_warehouse_sk#21751L,ws_promo_sk#21752L,ws_order_number#21753L,ws_quantity#21754,ws_wholesale_cost#21755,ws_list_price#21756,ws_sales_price#21757,ws_ext_discount_amt#21758,ws_ext_sales_price#21759,ws_ext_wholesale_cost#21760,... 10 more fields] orc
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21771L,d_date_id#21772,d_date#21773,d_month_seq#21774,d_week_seq#21775,d_quarter_seq#21776,d_year#21777,d_dow#21778,d_moy#21779,d_dom#21780,d_qoy#21781,d_fy_year#21782,d_fy_quarter_seq#21783,d_fy_week_seq#21784,d_day_name#21785,d_quarter_name#21786,d_holiday#21787,d_weekend#21788,d_following_holiday#21789,d_first_dom#21790,d_last_dom#21791,d_same_day_ly#21792,d_same_day_lq#21793,d_current_day#21794,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [customer_first_name#21802 ASC NULLS FIRST, customer_id#21801 ASC NULLS FIRST, customer_last_name#21803 ASC NULLS FIRST], true
         +- Project [customer_id#21801, customer_first_name#21802, customer_last_name#21803]
            +- Filter (((((customer_id#21801 = customer_id#21638) AND (customer_id#21638 = customer_id#21813)) AND ((customer_id#21638 = customer_id#21807) AND (sale_type#21643 = s))) AND (((sale_type#21812 = w) AND (sale_type#21806 = s)) AND (sale_type#21818 = w))) AND ((((year#21641 = 2001) AND (year#21804 = (2001 + 1))) AND ((year#21810 = 2001) AND (year#21816 = (2001 + 1)))) AND (((year_total#21642 > cast(0 as double)) AND (year_total#21811 > cast(0 as double))) AND (CASE WHEN (year_total#21811 > cast(0 as double)) THEN (year_total#21817 / year_total#21811) ELSE cast(null as double) END > CASE WHEN (year_total#21642 > cast(0 as double)) THEN (year_total#21805 / year_total#21642) ELSE cast(null as double) END))))
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- SubqueryAlias t_s_firstyear
                  :  :  :  +- SubqueryAlias year_total
                  :  :  :     +- CTERelationRef 48, true, [customer_id#21638, customer_first_name#21639, customer_last_name#21640, year#21641, year_total#21642, sale_type#21643]
                  :  :  +- SubqueryAlias t_s_secyear
                  :  :     +- SubqueryAlias year_total
                  :  :        +- CTERelationRef 48, true, [customer_id#21801, customer_first_name#21802, customer_last_name#21803, year#21804, year_total#21805, sale_type#21806]
                  :  +- SubqueryAlias t_w_firstyear
                  :     +- SubqueryAlias year_total
                  :        +- CTERelationRef 48, true, [customer_id#21807, customer_first_name#21808, customer_last_name#21809, year#21810, year_total#21811, sale_type#21812]
                  +- SubqueryAlias t_w_secyear
                     +- SubqueryAlias year_total
                        +- CTERelationRef 48, true, [customer_id#21813, customer_first_name#21814, customer_last_name#21815, year#21816, year_total#21817, sale_type#21818]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [customer_first_name#21802 ASC NULLS FIRST, customer_id#21801 ASC NULLS FIRST, customer_last_name#21803 ASC NULLS FIRST], true
      +- Project [customer_id#21801, customer_first_name#21802, customer_last_name#21803]
         +- Join Inner, ((customer_id#21638 = customer_id#21813) AND (CASE WHEN (year_total#22130 > 0.0) THEN (year_total#21817 / year_total#22130) END > CASE WHEN (year_total#21642 > 0.0) THEN (year_total#21805 / year_total#21642) END))
            :- Project [customer_id#21638, year_total#21642, customer_id#21801, customer_first_name#21802, customer_last_name#21803, year_total#21805, year_total#22130]
            :  +- Join Inner, (customer_id#21638 = customer_id#22126)
            :     :- Join Inner, (customer_id#21801 = customer_id#21638)
            :     :  :- Filter (isnotnull(year_total#21642) AND (year_total#21642 > 0.0))
            :     :  :  +- Aggregate [c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697], [c_customer_id#21651 AS customer_id#21638, max(ss_net_paid#21687) AS year_total#21642]
            :     :  :     +- Project [c_customer_id#21651, c_first_name#21658, c_last_name#21659, ss_net_paid#21687, d_year#21697]
            :     :  :        +- Join Inner, (c_customer_sk#21650L = ss_customer_sk#21670L)
            :     :  :           :- Project [ss_customer_sk#21670L, ss_net_paid#21687, d_year#21697]
            :     :  :           :  +- Join Inner, (ss_sold_date_sk#21690L = d_date_sk#21691L)
            :     :  :           :     :- Project [ss_customer_sk#21670L, ss_net_paid#21687, ss_sold_date_sk#21690L]
            :     :  :           :     :  +- Filter ((isnotnull(ss_customer_sk#21670L) AND isnotnull(ss_sold_date_sk#21690L)) AND dynamicpruning#22305 [ss_sold_date_sk#21690L])
            :     :  :           :     :     :  +- Project [d_date_sk#21691L, d_year#21697]
            :     :  :           :     :     :     +- Filter ((isnotnull(d_year#21697) AND ((d_year#21697 = 2001) AND d_year#21697 IN (2001,2002))) AND isnotnull(d_date_sk#21691L))
            :     :  :           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21691L,d_date_id#21692,d_date#21693,d_month_seq#21694,d_week_seq#21695,d_quarter_seq#21696,d_year#21697,d_dow#21698,d_moy#21699,d_dom#21700,d_qoy#21701,d_fy_year#21702,d_fy_quarter_seq#21703,d_fy_week_seq#21704,d_day_name#21705,d_quarter_name#21706,d_holiday#21707,d_weekend#21708,d_following_holiday#21709,d_first_dom#21710,d_last_dom#21711,d_same_day_ly#21712,d_same_day_lq#21713,d_current_day#21714,... 4 more fields] orc
            :     :  :           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21668L,ss_item_sk#21669L,ss_customer_sk#21670L,ss_cdemo_sk#21671L,ss_hdemo_sk#21672L,ss_addr_sk#21673L,ss_store_sk#21674L,ss_promo_sk#21675L,ss_ticket_number#21676L,ss_quantity#21677,ss_wholesale_cost#21678,ss_list_price#21679,ss_sales_price#21680,ss_ext_discount_amt#21681,ss_ext_sales_price#21682,ss_ext_wholesale_cost#21683,ss_ext_list_price#21684,ss_ext_tax#21685,ss_coupon_amt#21686,ss_net_paid#21687,ss_net_paid_inc_tax#21688,ss_net_profit#21689,ss_sold_date_sk#21690L] orc
            :     :  :           :     +- Project [d_date_sk#21691L, d_year#21697]
            :     :  :           :        +- Filter ((isnotnull(d_year#21697) AND ((d_year#21697 = 2001) AND d_year#21697 IN (2001,2002))) AND isnotnull(d_date_sk#21691L))
            :     :  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21691L,d_date_id#21692,d_date#21693,d_month_seq#21694,d_week_seq#21695,d_quarter_seq#21696,d_year#21697,d_dow#21698,d_moy#21699,d_dom#21700,d_qoy#21701,d_fy_year#21702,d_fy_quarter_seq#21703,d_fy_week_seq#21704,d_day_name#21705,d_quarter_name#21706,d_holiday#21707,d_weekend#21708,d_following_holiday#21709,d_first_dom#21710,d_last_dom#21711,d_same_day_ly#21712,d_same_day_lq#21713,d_current_day#21714,... 4 more fields] orc
            :     :  :           +- Project [c_customer_sk#21650L, c_customer_id#21651, c_first_name#21658, c_last_name#21659]
            :     :  :              +- Filter (isnotnull(c_customer_sk#21650L) AND isnotnull(c_customer_id#21651))
            :     :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21650L,c_customer_id#21651,c_current_cdemo_sk#21652L,c_current_hdemo_sk#21653L,c_current_addr_sk#21654L,c_first_shipto_date_sk#21655L,c_first_sales_date_sk#21656L,c_salutation#21657,c_first_name#21658,c_last_name#21659,c_preferred_cust_flag#21660,c_birth_day#21661,c_birth_month#21662,c_birth_year#21663,c_birth_country#21664,c_login#21665,c_email_address#21666,c_last_review_date#21667] orc
            :     :  +- Aggregate [c_customer_id#21823, c_first_name#21830, c_last_name#21831, d_year#21869], [c_customer_id#21823 AS customer_id#21801, c_first_name#21830 AS customer_first_name#21802, c_last_name#21831 AS customer_last_name#21803, max(ss_net_paid#21859) AS year_total#21805]
            :     :     +- Project [c_customer_id#21823, c_first_name#21830, c_last_name#21831, ss_net_paid#21859, d_year#21869]
            :     :        +- Join Inner, (c_customer_sk#21822L = ss_customer_sk#21842L)
            :     :           :- Project [ss_customer_sk#21842L, ss_net_paid#21859, d_year#21869]
            :     :           :  +- Join Inner, (ss_sold_date_sk#21862L = d_date_sk#21863L)
            :     :           :     :- Project [ss_customer_sk#21842L, ss_net_paid#21859, ss_sold_date_sk#21862L]
            :     :           :     :  +- Filter ((isnotnull(ss_customer_sk#21842L) AND isnotnull(ss_sold_date_sk#21862L)) AND dynamicpruning#22306 [ss_sold_date_sk#21862L])
            :     :           :     :     :  +- Project [d_date_sk#21863L, d_year#21869]
            :     :           :     :     :     +- Filter ((isnotnull(d_year#21869) AND ((d_year#21869 = 2002) AND d_year#21869 IN (2001,2002))) AND isnotnull(d_date_sk#21863L))
            :     :           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21863L,d_date_id#21864,d_date#21865,d_month_seq#21866,d_week_seq#21867,d_quarter_seq#21868,d_year#21869,d_dow#21870,d_moy#21871,d_dom#21872,d_qoy#21873,d_fy_year#21874,d_fy_quarter_seq#21875,d_fy_week_seq#21876,d_day_name#21877,d_quarter_name#21878,d_holiday#21879,d_weekend#21880,d_following_holiday#21881,d_first_dom#21882,d_last_dom#21883,d_same_day_ly#21884,d_same_day_lq#21885,d_current_day#21886,... 4 more fields] orc
            :     :           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#21840L,ss_item_sk#21841L,ss_customer_sk#21842L,ss_cdemo_sk#21843L,ss_hdemo_sk#21844L,ss_addr_sk#21845L,ss_store_sk#21846L,ss_promo_sk#21847L,ss_ticket_number#21848L,ss_quantity#21849,ss_wholesale_cost#21850,ss_list_price#21851,ss_sales_price#21852,ss_ext_discount_amt#21853,ss_ext_sales_price#21854,ss_ext_wholesale_cost#21855,ss_ext_list_price#21856,ss_ext_tax#21857,ss_coupon_amt#21858,ss_net_paid#21859,ss_net_paid_inc_tax#21860,ss_net_profit#21861,ss_sold_date_sk#21862L] orc
            :     :           :     +- Project [d_date_sk#21863L, d_year#21869]
            :     :           :        +- Filter ((isnotnull(d_year#21869) AND ((d_year#21869 = 2002) AND d_year#21869 IN (2001,2002))) AND isnotnull(d_date_sk#21863L))
            :     :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21863L,d_date_id#21864,d_date#21865,d_month_seq#21866,d_week_seq#21867,d_quarter_seq#21868,d_year#21869,d_dow#21870,d_moy#21871,d_dom#21872,d_qoy#21873,d_fy_year#21874,d_fy_quarter_seq#21875,d_fy_week_seq#21876,d_day_name#21877,d_quarter_name#21878,d_holiday#21879,d_weekend#21880,d_following_holiday#21881,d_first_dom#21882,d_last_dom#21883,d_same_day_ly#21884,d_same_day_lq#21885,d_current_day#21886,... 4 more fields] orc
            :     :           +- Project [c_customer_sk#21822L, c_customer_id#21823, c_first_name#21830, c_last_name#21831]
            :     :              +- Filter (isnotnull(c_customer_sk#21822L) AND isnotnull(c_customer_id#21823))
            :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21822L,c_customer_id#21823,c_current_cdemo_sk#21824L,c_current_hdemo_sk#21825L,c_current_addr_sk#21826L,c_first_shipto_date_sk#21827L,c_first_sales_date_sk#21828L,c_salutation#21829,c_first_name#21830,c_last_name#21831,c_preferred_cust_flag#21832,c_birth_day#21833,c_birth_month#21834,c_birth_year#21835,c_birth_country#21836,c_login#21837,c_email_address#21838,c_last_review_date#21839] orc
            :     +- Project [customer_id#21644 AS customer_id#22126, year_total#21648 AS year_total#22130]
            :        +- Filter (isnotnull(year_total#21648) AND (year_total#21648 > 0.0))
            :           +- Aggregate [c_customer_id#22047, c_first_name#22054, c_last_name#22055, d_year#22104], [c_customer_id#22047 AS customer_id#21644, max(ws_net_paid#22092) AS year_total#21648]
            :              +- Project [c_customer_id#22047, c_first_name#22054, c_last_name#22055, ws_net_paid#22092, d_year#22104]
            :                 +- Join Inner, (c_customer_sk#22046L = ws_bill_customer_sk#22067L)
            :                    :- Project [ws_bill_customer_sk#22067L, ws_net_paid#22092, d_year#22104]
            :                    :  +- Join Inner, (ws_sold_date_sk#22097L = d_date_sk#22098L)
            :                    :     :- Project [ws_bill_customer_sk#22067L, ws_net_paid#22092, ws_sold_date_sk#22097L]
            :                    :     :  +- Filter ((isnotnull(ws_bill_customer_sk#22067L) AND isnotnull(ws_sold_date_sk#22097L)) AND dynamicpruning#22307 [ws_sold_date_sk#22097L])
            :                    :     :     :  +- Project [d_date_sk#22098L, d_year#22104]
            :                    :     :     :     +- Filter ((isnotnull(d_year#22104) AND ((d_year#22104 = 2001) AND d_year#22104 IN (2001,2002))) AND isnotnull(d_date_sk#22098L))
            :                    :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22098L,d_date_id#22099,d_date#22100,d_month_seq#22101,d_week_seq#22102,d_quarter_seq#22103,d_year#22104,d_dow#22105,d_moy#22106,d_dom#22107,d_qoy#22108,d_fy_year#22109,d_fy_quarter_seq#22110,d_fy_week_seq#22111,d_day_name#22112,d_quarter_name#22113,d_holiday#22114,d_weekend#22115,d_following_holiday#22116,d_first_dom#22117,d_last_dom#22118,d_same_day_ly#22119,d_same_day_lq#22120,d_current_day#22121,... 4 more fields] orc
            :                    :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#22064L,ws_ship_date_sk#22065L,ws_item_sk#22066L,ws_bill_customer_sk#22067L,ws_bill_cdemo_sk#22068L,ws_bill_hdemo_sk#22069L,ws_bill_addr_sk#22070L,ws_ship_customer_sk#22071L,ws_ship_cdemo_sk#22072L,ws_ship_hdemo_sk#22073L,ws_ship_addr_sk#22074L,ws_web_page_sk#22075L,ws_web_site_sk#22076L,ws_ship_mode_sk#22077L,ws_warehouse_sk#22078L,ws_promo_sk#22079L,ws_order_number#22080L,ws_quantity#22081,ws_wholesale_cost#22082,ws_list_price#22083,ws_sales_price#22084,ws_ext_discount_amt#22085,ws_ext_sales_price#22086,ws_ext_wholesale_cost#22087,... 10 more fields] orc
            :                    :     +- Project [d_date_sk#22098L, d_year#22104]
            :                    :        +- Filter ((isnotnull(d_year#22104) AND ((d_year#22104 = 2001) AND d_year#22104 IN (2001,2002))) AND isnotnull(d_date_sk#22098L))
            :                    :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22098L,d_date_id#22099,d_date#22100,d_month_seq#22101,d_week_seq#22102,d_quarter_seq#22103,d_year#22104,d_dow#22105,d_moy#22106,d_dom#22107,d_qoy#22108,d_fy_year#22109,d_fy_quarter_seq#22110,d_fy_week_seq#22111,d_day_name#22112,d_quarter_name#22113,d_holiday#22114,d_weekend#22115,d_following_holiday#22116,d_first_dom#22117,d_last_dom#22118,d_same_day_ly#22119,d_same_day_lq#22120,d_current_day#22121,... 4 more fields] orc
            :                    +- Project [c_customer_sk#22046L, c_customer_id#22047, c_first_name#22054, c_last_name#22055]
            :                       +- Filter (isnotnull(c_customer_sk#22046L) AND isnotnull(c_customer_id#22047))
            :                          +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#22046L,c_customer_id#22047,c_current_cdemo_sk#22048L,c_current_hdemo_sk#22049L,c_current_addr_sk#22050L,c_first_shipto_date_sk#22051L,c_first_sales_date_sk#22052L,c_salutation#22053,c_first_name#22054,c_last_name#22055,c_preferred_cust_flag#22056,c_birth_day#22057,c_birth_month#22058,c_birth_year#22059,c_birth_country#22060,c_login#22061,c_email_address#22062,c_last_review_date#22063] orc
            +- Aggregate [c_customer_id#22202, c_first_name#22209, c_last_name#22210, d_year#22259], [c_customer_id#22202 AS customer_id#21813, max(ws_net_paid#22247) AS year_total#21817]
               +- Project [c_customer_id#22202, c_first_name#22209, c_last_name#22210, ws_net_paid#22247, d_year#22259]
                  +- Join Inner, (c_customer_sk#22201L = ws_bill_customer_sk#22222L)
                     :- Project [ws_bill_customer_sk#22222L, ws_net_paid#22247, d_year#22259]
                     :  +- Join Inner, (ws_sold_date_sk#22252L = d_date_sk#22253L)
                     :     :- Project [ws_bill_customer_sk#22222L, ws_net_paid#22247, ws_sold_date_sk#22252L]
                     :     :  +- Filter ((isnotnull(ws_bill_customer_sk#22222L) AND isnotnull(ws_sold_date_sk#22252L)) AND dynamicpruning#22308 [ws_sold_date_sk#22252L])
                     :     :     :  +- Project [d_date_sk#22253L, d_year#22259]
                     :     :     :     +- Filter ((isnotnull(d_year#22259) AND ((d_year#22259 = 2002) AND d_year#22259 IN (2001,2002))) AND isnotnull(d_date_sk#22253L))
                     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22253L,d_date_id#22254,d_date#22255,d_month_seq#22256,d_week_seq#22257,d_quarter_seq#22258,d_year#22259,d_dow#22260,d_moy#22261,d_dom#22262,d_qoy#22263,d_fy_year#22264,d_fy_quarter_seq#22265,d_fy_week_seq#22266,d_day_name#22267,d_quarter_name#22268,d_holiday#22269,d_weekend#22270,d_following_holiday#22271,d_first_dom#22272,d_last_dom#22273,d_same_day_ly#22274,d_same_day_lq#22275,d_current_day#22276,... 4 more fields] orc
                     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#22219L,ws_ship_date_sk#22220L,ws_item_sk#22221L,ws_bill_customer_sk#22222L,ws_bill_cdemo_sk#22223L,ws_bill_hdemo_sk#22224L,ws_bill_addr_sk#22225L,ws_ship_customer_sk#22226L,ws_ship_cdemo_sk#22227L,ws_ship_hdemo_sk#22228L,ws_ship_addr_sk#22229L,ws_web_page_sk#22230L,ws_web_site_sk#22231L,ws_ship_mode_sk#22232L,ws_warehouse_sk#22233L,ws_promo_sk#22234L,ws_order_number#22235L,ws_quantity#22236,ws_wholesale_cost#22237,ws_list_price#22238,ws_sales_price#22239,ws_ext_discount_amt#22240,ws_ext_sales_price#22241,ws_ext_wholesale_cost#22242,... 10 more fields] orc
                     :     +- Project [d_date_sk#22253L, d_year#22259]
                     :        +- Filter ((isnotnull(d_year#22259) AND ((d_year#22259 = 2002) AND d_year#22259 IN (2001,2002))) AND isnotnull(d_date_sk#22253L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22253L,d_date_id#22254,d_date#22255,d_month_seq#22256,d_week_seq#22257,d_quarter_seq#22258,d_year#22259,d_dow#22260,d_moy#22261,d_dom#22262,d_qoy#22263,d_fy_year#22264,d_fy_quarter_seq#22265,d_fy_week_seq#22266,d_day_name#22267,d_quarter_name#22268,d_holiday#22269,d_weekend#22270,d_following_holiday#22271,d_first_dom#22272,d_last_dom#22273,d_same_day_ly#22274,d_same_day_lq#22275,d_current_day#22276,... 4 more fields] orc
                     +- Project [c_customer_sk#22201L, c_customer_id#22202, c_first_name#22209, c_last_name#22210]
                        +- Filter (isnotnull(c_customer_sk#22201L) AND isnotnull(c_customer_id#22202))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#22201L,c_customer_id#22202,c_current_cdemo_sk#22203L,c_current_hdemo_sk#22204L,c_current_addr_sk#22205L,c_first_shipto_date_sk#22206L,c_first_sales_date_sk#22207L,c_salutation#22208,c_first_name#22209,c_last_name#22210,c_preferred_cust_flag#22211,c_birth_day#22212,c_birth_month#22213,c_birth_year#22214,c_birth_country#22215,c_login#22216,c_email_address#22217,c_last_review_date#22218] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[customer_first_name#21802 ASC NULLS FIRST,customer_id#21801 ASC NULLS FIRST,customer_last_name#21803 ASC NULLS FIRST], output=[customer_id#21801,customer_first_name#21802,customer_last_name#21803])
   +- Project [customer_id#21801, customer_first_name#21802, customer_last_name#21803]
      +- SortMergeJoin [customer_id#21638], [customer_id#21813], Inner, (CASE WHEN (year_total#22130 > 0.0) THEN (year_total#21817 / year_total#22130) END > CASE WHEN (year_total#21642 > 0.0) THEN (year_total#21805 / year_total#21642) END)
         :- Project [customer_id#21638, year_total#21642, customer_id#21801, customer_first_name#21802, customer_last_name#21803, year_total#21805, year_total#22130]
         :  +- SortMergeJoin [customer_id#21638], [customer_id#22126], Inner
         :     :- SortMergeJoin [customer_id#21638], [customer_id#21801], Inner
         :     :  :- Sort [customer_id#21638 ASC NULLS FIRST], false, 0
         :     :  :  +- Exchange hashpartitioning(customer_id#21638, 3000), ENSURE_REQUIREMENTS, [id=#22987]
         :     :  :     +- Filter (isnotnull(year_total#21642) AND (year_total#21642 > 0.0))
         :     :  :        +- HashAggregate(keys=[c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697], functions=[max(ss_net_paid#21687)], output=[customer_id#21638, year_total#21642])
         :     :  :           +- Exchange hashpartitioning(c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697, 3000), ENSURE_REQUIREMENTS, [id=#22967]
         :     :  :              +- HashAggregate(keys=[c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697], functions=[partial_max(ss_net_paid#21687)], output=[c_customer_id#21651, c_first_name#21658, c_last_name#21659, d_year#21697, max#22310])
         :     :  :                 +- Project [c_customer_id#21651, c_first_name#21658, c_last_name#21659, ss_net_paid#21687, d_year#21697]
         :     :  :                    +- SortMergeJoin [ss_customer_sk#21670L], [c_customer_sk#21650L], Inner
         :     :  :                       :- Sort [ss_customer_sk#21670L ASC NULLS FIRST], false, 0
         :     :  :                       :  +- Exchange hashpartitioning(ss_customer_sk#21670L, 3000), ENSURE_REQUIREMENTS, [id=#22959]
         :     :  :                       :     +- Project [ss_customer_sk#21670L, ss_net_paid#21687, d_year#21697]
         :     :  :                       :        +- BroadcastHashJoin [ss_sold_date_sk#21690L], [d_date_sk#21691L], Inner, BuildRight, false
         :     :  :                       :           :- Filter isnotnull(ss_customer_sk#21670L)
         :     :  :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#21670L,ss_net_paid#21687,ss_sold_date_sk#21690L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#21670L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#21690L), dynamicpruningexpression(ss_sold_date_sk#21690L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_net_paid:double>
         :     :  :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#22305, 0, true, Project [d_date_sk#21691L, d_year#21697], [d_date_sk#21691L]
         :     :  :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :  :                       :           :              +- Filter (((isnotnull(d_year#21697) AND (d_year#21697 = 2001)) AND d_year#21697 IN (2001,2002)) AND isnotnull(d_date_sk#21691L))
         :     :  :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21691L,d_year#21697] Batched: true, DataFilters: [isnotnull(d_year#21697), (d_year#21697 = 2001), d_year#21697 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :  :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22954]
         :     :  :                       :              +- Filter (((isnotnull(d_year#21697) AND (d_year#21697 = 2001)) AND d_year#21697 IN (2001,2002)) AND isnotnull(d_date_sk#21691L))
         :     :  :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21691L,d_year#21697] Batched: true, DataFilters: [isnotnull(d_year#21697), (d_year#21697 = 2001), d_year#21697 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :  :                       +- Sort [c_customer_sk#21650L ASC NULLS FIRST], false, 0
         :     :  :                          +- Exchange hashpartitioning(c_customer_sk#21650L, 3000), ENSURE_REQUIREMENTS, [id=#22960]
         :     :  :                             +- Filter (isnotnull(c_customer_sk#21650L) AND isnotnull(c_customer_id#21651))
         :     :  :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21650L,c_customer_id#21651,c_first_name#21658,c_last_name#21659] Batched: true, DataFilters: [isnotnull(c_customer_sk#21650L), isnotnull(c_customer_id#21651)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string>
         :     :  +- Sort [customer_id#21801 ASC NULLS FIRST], false, 0
         :     :     +- Exchange hashpartitioning(customer_id#21801, 3000), ENSURE_REQUIREMENTS, [id=#22988]
         :     :        +- HashAggregate(keys=[c_customer_id#21823, c_first_name#21830, c_last_name#21831, d_year#21869], functions=[max(ss_net_paid#21859)], output=[customer_id#21801, customer_first_name#21802, customer_last_name#21803, year_total#21805])
         :     :           +- Exchange hashpartitioning(c_customer_id#21823, c_first_name#21830, c_last_name#21831, d_year#21869, 3000), ENSURE_REQUIREMENTS, [id=#22983]
         :     :              +- HashAggregate(keys=[c_customer_id#21823, c_first_name#21830, c_last_name#21831, d_year#21869], functions=[partial_max(ss_net_paid#21859)], output=[c_customer_id#21823, c_first_name#21830, c_last_name#21831, d_year#21869, max#22312])
         :     :                 +- Project [c_customer_id#21823, c_first_name#21830, c_last_name#21831, ss_net_paid#21859, d_year#21869]
         :     :                    +- SortMergeJoin [ss_customer_sk#21842L], [c_customer_sk#21822L], Inner
         :     :                       :- Sort [ss_customer_sk#21842L ASC NULLS FIRST], false, 0
         :     :                       :  +- Exchange hashpartitioning(ss_customer_sk#21842L, 3000), ENSURE_REQUIREMENTS, [id=#22975]
         :     :                       :     +- Project [ss_customer_sk#21842L, ss_net_paid#21859, d_year#21869]
         :     :                       :        +- BroadcastHashJoin [ss_sold_date_sk#21862L], [d_date_sk#21863L], Inner, BuildRight, false
         :     :                       :           :- Filter isnotnull(ss_customer_sk#21842L)
         :     :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#21842L,ss_net_paid#21859,ss_sold_date_sk#21862L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#21842L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#21862L), dynamicpruningexpression(ss_sold_date_sk#21862L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_net_paid:double>
         :     :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#22306, 0, true, Project [d_date_sk#21863L, d_year#21869], [d_date_sk#21863L]
         :     :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :                       :           :              +- Filter (((isnotnull(d_year#21869) AND (d_year#21869 = 2002)) AND d_year#21869 IN (2001,2002)) AND isnotnull(d_date_sk#21863L))
         :     :                       :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21863L,d_year#21869] Batched: true, DataFilters: [isnotnull(d_year#21869), (d_year#21869 = 2002), d_year#21869 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22970]
         :     :                       :              +- Filter (((isnotnull(d_year#21869) AND (d_year#21869 = 2002)) AND d_year#21869 IN (2001,2002)) AND isnotnull(d_date_sk#21863L))
         :     :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#21863L,d_year#21869] Batched: true, DataFilters: [isnotnull(d_year#21869), (d_year#21869 = 2002), d_year#21869 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                       +- Sort [c_customer_sk#21822L ASC NULLS FIRST], false, 0
         :     :                          +- Exchange hashpartitioning(c_customer_sk#21822L, 3000), ENSURE_REQUIREMENTS, [id=#22976]
         :     :                             +- Filter (isnotnull(c_customer_sk#21822L) AND isnotnull(c_customer_id#21823))
         :     :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#21822L,c_customer_id#21823,c_first_name#21830,c_last_name#21831] Batched: true, DataFilters: [isnotnull(c_customer_sk#21822L), isnotnull(c_customer_id#21823)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string>
         :     +- Sort [customer_id#22126 ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(customer_id#22126, 3000), ENSURE_REQUIREMENTS, [id=#23011]
         :           +- Project [customer_id#21644 AS customer_id#22126, year_total#21648 AS year_total#22130]
         :              +- Filter (isnotnull(year_total#21648) AND (year_total#21648 > 0.0))
         :                 +- HashAggregate(keys=[c_customer_id#22047, c_first_name#22054, c_last_name#22055, d_year#22104], functions=[max(ws_net_paid#22092)], output=[customer_id#21644, year_total#21648])
         :                    +- Exchange hashpartitioning(c_customer_id#22047, c_first_name#22054, c_last_name#22055, d_year#22104, 3000), ENSURE_REQUIREMENTS, [id=#23005]
         :                       +- HashAggregate(keys=[c_customer_id#22047, c_first_name#22054, c_last_name#22055, d_year#22104], functions=[partial_max(ws_net_paid#22092)], output=[c_customer_id#22047, c_first_name#22054, c_last_name#22055, d_year#22104, max#22314])
         :                          +- Project [c_customer_id#22047, c_first_name#22054, c_last_name#22055, ws_net_paid#22092, d_year#22104]
         :                             +- SortMergeJoin [ws_bill_customer_sk#22067L], [c_customer_sk#22046L], Inner
         :                                :- Sort [ws_bill_customer_sk#22067L ASC NULLS FIRST], false, 0
         :                                :  +- Exchange hashpartitioning(ws_bill_customer_sk#22067L, 3000), ENSURE_REQUIREMENTS, [id=#22997]
         :                                :     +- Project [ws_bill_customer_sk#22067L, ws_net_paid#22092, d_year#22104]
         :                                :        +- BroadcastHashJoin [ws_sold_date_sk#22097L], [d_date_sk#22098L], Inner, BuildRight, false
         :                                :           :- Filter isnotnull(ws_bill_customer_sk#22067L)
         :                                :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#22067L,ws_net_paid#22092,ws_sold_date_sk#22097L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#22067L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#22097L), dynamicpruningexpression(ws_sold_date_sk#22097L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_net_paid:double>
         :                                :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#22307, 0, true, Project [d_date_sk#22098L, d_year#22104], [d_date_sk#22098L]
         :                                :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                :           :              +- Filter (((isnotnull(d_year#22104) AND (d_year#22104 = 2001)) AND d_year#22104 IN (2001,2002)) AND isnotnull(d_date_sk#22098L))
         :                                :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22098L,d_year#22104] Batched: true, DataFilters: [isnotnull(d_year#22104), (d_year#22104 = 2001), d_year#22104 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#22992]
         :                                :              +- Filter (((isnotnull(d_year#22104) AND (d_year#22104 = 2001)) AND d_year#22104 IN (2001,2002)) AND isnotnull(d_date_sk#22098L))
         :                                :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22098L,d_year#22104] Batched: true, DataFilters: [isnotnull(d_year#22104), (d_year#22104 = 2001), d_year#22104 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                +- Sort [c_customer_sk#22046L ASC NULLS FIRST], false, 0
         :                                   +- Exchange hashpartitioning(c_customer_sk#22046L, 3000), ENSURE_REQUIREMENTS, [id=#22998]
         :                                      +- Filter (isnotnull(c_customer_sk#22046L) AND isnotnull(c_customer_id#22047))
         :                                         +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#22046L,c_customer_id#22047,c_first_name#22054,c_last_name#22055] Batched: true, DataFilters: [isnotnull(c_customer_sk#22046L), isnotnull(c_customer_id#22047)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string>
         +- Sort [customer_id#21813 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(customer_id#21813, 3000), ENSURE_REQUIREMENTS, [id=#23032]
               +- HashAggregate(keys=[c_customer_id#22202, c_first_name#22209, c_last_name#22210, d_year#22259], functions=[max(ws_net_paid#22247)], output=[customer_id#21813, year_total#21817])
                  +- Exchange hashpartitioning(c_customer_id#22202, c_first_name#22209, c_last_name#22210, d_year#22259, 3000), ENSURE_REQUIREMENTS, [id=#23028]
                     +- HashAggregate(keys=[c_customer_id#22202, c_first_name#22209, c_last_name#22210, d_year#22259], functions=[partial_max(ws_net_paid#22247)], output=[c_customer_id#22202, c_first_name#22209, c_last_name#22210, d_year#22259, max#22316])
                        +- Project [c_customer_id#22202, c_first_name#22209, c_last_name#22210, ws_net_paid#22247, d_year#22259]
                           +- SortMergeJoin [ws_bill_customer_sk#22222L], [c_customer_sk#22201L], Inner
                              :- Sort [ws_bill_customer_sk#22222L ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_bill_customer_sk#22222L, 3000), ENSURE_REQUIREMENTS, [id=#23020]
                              :     +- Project [ws_bill_customer_sk#22222L, ws_net_paid#22247, d_year#22259]
                              :        +- BroadcastHashJoin [ws_sold_date_sk#22252L], [d_date_sk#22253L], Inner, BuildRight, false
                              :           :- Filter isnotnull(ws_bill_customer_sk#22222L)
                              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#22222L,ws_net_paid#22247,ws_sold_date_sk#22252L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#22222L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#22252L), dynamicpruningexpression(ws_sold_date_sk#22252L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint,ws_net_paid:double>
                              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#22308, 0, true, Project [d_date_sk#22253L, d_year#22259], [d_date_sk#22253L]
                              :           :           +- AdaptiveSparkPlan isFinalPlan=false
                              :           :              +- Filter (((isnotnull(d_year#22259) AND (d_year#22259 = 2002)) AND d_year#22259 IN (2001,2002)) AND isnotnull(d_date_sk#22253L))
                              :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22253L,d_year#22259] Batched: true, DataFilters: [isnotnull(d_year#22259), (d_year#22259 = 2002), d_year#22259 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23015]
                              :              +- Filter (((isnotnull(d_year#22259) AND (d_year#22259 = 2002)) AND d_year#22259 IN (2001,2002)) AND isnotnull(d_date_sk#22253L))
                              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22253L,d_year#22259] Batched: true, DataFilters: [isnotnull(d_year#22259), (d_year#22259 = 2002), d_year#22259 IN (2001,2002), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              +- Sort [c_customer_sk#22201L ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(c_customer_sk#22201L, 3000), ENSURE_REQUIREMENTS, [id=#23021]
                                    +- Filter (isnotnull(c_customer_sk#22201L) AND isnotnull(c_customer_id#22202))
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#22201L,c_customer_id#22202,c_first_name#22209,c_last_name#22210] Batched: true, DataFilters: [isnotnull(c_customer_sk#22201L), isnotnull(c_customer_id#22202)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_first_name:string,c_last_name:string>

read query: spark_queries/q75.sql
explain query: q75
== Parsed Logical Plan ==
CTE [all_sales]
:  +- 'SubqueryAlias all_sales
:     +- 'Aggregate ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id], ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, 'SUM('sales_cnt) AS sales_cnt#22329, 'SUM('sales_amt) AS sales_amt#22330]
:        +- 'SubqueryAlias sales_detail
:           +- 'Distinct
:              +- 'Union false, false
:                 :- 'Distinct
:                 :  +- 'Union false, false
:                 :     :- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('cs_quantity - 'COALESCE('cr_return_quantity, 0)) AS sales_cnt#22323, ('cs_ext_sales_price - 'COALESCE('cr_return_amount, 0.0)) AS sales_amt#22324]
:                 :     :  +- 'Filter ('i_category = Sports)
:                 :     :     +- 'Join LeftOuter, (('cs_order_number = 'cr_order_number) AND ('cs_item_sk = 'cr_item_sk))
:                 :     :        :- 'Join Inner, ('d_date_sk = 'cs_sold_date_sk)
:                 :     :        :  :- 'Join Inner, ('i_item_sk = 'cs_item_sk)
:                 :     :        :  :  :- 'UnresolvedRelation [catalog_sales], [], false
:                 :     :        :  :  +- 'UnresolvedRelation [item], [], false
:                 :     :        :  +- 'UnresolvedRelation [date_dim], [], false
:                 :     :        +- 'UnresolvedRelation [catalog_returns], [], false
:                 :     +- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('ss_quantity - 'COALESCE('sr_return_quantity, 0)) AS sales_cnt#22325, ('ss_ext_sales_price - 'COALESCE('sr_return_amt, 0.0)) AS sales_amt#22326]
:                 :        +- 'Filter ('i_category = Sports)
:                 :           +- 'Join LeftOuter, (('ss_ticket_number = 'sr_ticket_number) AND ('ss_item_sk = 'sr_item_sk))
:                 :              :- 'Join Inner, ('d_date_sk = 'ss_sold_date_sk)
:                 :              :  :- 'Join Inner, ('i_item_sk = 'ss_item_sk)
:                 :              :  :  :- 'UnresolvedRelation [store_sales], [], false
:                 :              :  :  +- 'UnresolvedRelation [item], [], false
:                 :              :  +- 'UnresolvedRelation [date_dim], [], false
:                 :              +- 'UnresolvedRelation [store_returns], [], false
:                 +- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('ws_quantity - 'COALESCE('wr_return_quantity, 0)) AS sales_cnt#22327, ('ws_ext_sales_price - 'COALESCE('wr_return_amt, 0.0)) AS sales_amt#22328]
:                    +- 'Filter ('i_category = Sports)
:                       +- 'Join LeftOuter, (('ws_order_number = 'wr_order_number) AND ('ws_item_sk = 'wr_item_sk))
:                          :- 'Join Inner, ('d_date_sk = 'ws_sold_date_sk)
:                          :  :- 'Join Inner, ('i_item_sk = 'ws_item_sk)
:                          :  :  :- 'UnresolvedRelation [web_sales], [], false
:                          :  :  +- 'UnresolvedRelation [item], [], false
:                          :  +- 'UnresolvedRelation [date_dim], [], false
:                          +- 'UnresolvedRelation [web_returns], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['sales_cnt_diff ASC NULLS FIRST], true
         +- 'Project ['prev_yr.d_year AS prev_year#22317, 'curr_yr.d_year AS year#22318, 'curr_yr.i_brand_id, 'curr_yr.i_class_id, 'curr_yr.i_category_id, 'curr_yr.i_manufact_id, 'prev_yr.sales_cnt AS prev_yr_cnt#22319, 'curr_yr.sales_cnt AS curr_yr_cnt#22320, ('curr_yr.sales_cnt - 'prev_yr.sales_cnt) AS sales_cnt_diff#22321, ('curr_yr.sales_amt - 'prev_yr.sales_amt) AS sales_amt_diff#22322]
            +- 'Filter (((('curr_yr.i_brand_id = 'prev_yr.i_brand_id) AND ('curr_yr.i_class_id = 'prev_yr.i_class_id)) AND (('curr_yr.i_category_id = 'prev_yr.i_category_id) AND ('curr_yr.i_manufact_id = 'prev_yr.i_manufact_id))) AND ((('curr_yr.d_year = 2002) AND ('prev_yr.d_year = (2002 - 1))) AND ((cast('curr_yr.sales_cnt as decimal(17,2)) / cast('prev_yr.sales_cnt as decimal(17,2))) < 0.9)))
               +- 'Join Inner
                  :- 'SubqueryAlias curr_yr
                  :  +- 'UnresolvedRelation [all_sales], [], false
                  +- 'SubqueryAlias prev_yr
                     +- 'UnresolvedRelation [all_sales], [], false

== Analyzed Logical Plan ==
prev_year: int, year: int, i_brand_id: int, i_class_id: int, i_category_id: int, i_manufact_id: int, prev_yr_cnt: bigint, curr_yr_cnt: bigint, sales_cnt_diff: bigint, sales_amt_diff: double
WithCTE
:- CTERelationDef 49
:  +- SubqueryAlias all_sales
:     +- Aggregate [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378], [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sum(sales_cnt#22323) AS sales_cnt#22329L, sum(sales_amt#22324) AS sales_amt#22330]
:        +- SubqueryAlias sales_detail
:           +- Distinct
:              +- Union false, false
:                 :- Distinct
:                 :  +- Union false, false
:                 :     :- Project [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, (cs_quantity#22348 - coalesce(cr_return_quantity#22431, 0)) AS sales_cnt#22323, (cs_ext_sales_price#22353 - coalesce(cr_return_amount#22432, cast(0.0 as double))) AS sales_amt#22324]
:                 :     :  +- Filter (i_category#22377 = Sports)
:                 :     :     +- Join LeftOuter, ((cs_order_number#22347L = cr_order_number#22430L) AND (cs_item_sk#22345L = cr_item_sk#22416L))
:                 :     :        :- Join Inner, (d_date_sk#22387L = cs_sold_date_sk#22364L)
:                 :     :        :  :- Join Inner, (i_item_sk#22365L = cs_item_sk#22345L)
:                 :     :        :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:                 :     :        :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#22331L,cs_ship_date_sk#22332L,cs_bill_customer_sk#22333L,cs_bill_cdemo_sk#22334L,cs_bill_hdemo_sk#22335L,cs_bill_addr_sk#22336L,cs_ship_customer_sk#22337L,cs_ship_cdemo_sk#22338L,cs_ship_hdemo_sk#22339L,cs_ship_addr_sk#22340L,cs_call_center_sk#22341L,cs_catalog_page_sk#22342L,cs_ship_mode_sk#22343L,cs_warehouse_sk#22344L,cs_item_sk#22345L,cs_promo_sk#22346L,cs_order_number#22347L,cs_quantity#22348,cs_wholesale_cost#22349,cs_list_price#22350,cs_sales_price#22351,cs_ext_discount_amt#22352,cs_ext_sales_price#22353,cs_ext_wholesale_cost#22354,... 10 more fields] orc
:                 :     :        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 :     :        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22365L,i_item_id#22366,i_rec_start_date#22367,i_rec_end_date#22368,i_item_desc#22369,i_current_price#22370,i_wholesale_cost#22371,i_brand_id#22372,i_brand#22373,i_class_id#22374,i_class#22375,i_category_id#22376,i_category#22377,i_manufact_id#22378,i_manufact#22379,i_size#22380,i_formulation#22381,i_color#22382,i_units#22383,i_container#22384,i_manager_id#22385,i_product_name#22386] orc
:                 :     :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22387L,d_date_id#22388,d_date#22389,d_month_seq#22390,d_week_seq#22391,d_quarter_seq#22392,d_year#22393,d_dow#22394,d_moy#22395,d_dom#22396,d_qoy#22397,d_fy_year#22398,d_fy_quarter_seq#22399,d_fy_week_seq#22400,d_day_name#22401,d_quarter_name#22402,d_holiday#22403,d_weekend#22404,d_following_holiday#22405,d_first_dom#22406,d_last_dom#22407,d_same_day_ly#22408,d_same_day_lq#22409,d_current_day#22410,... 4 more fields] orc
:                 :     :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:                 :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#22415L,cr_item_sk#22416L,cr_refunded_customer_sk#22417L,cr_refunded_cdemo_sk#22418L,cr_refunded_hdemo_sk#22419L,cr_refunded_addr_sk#22420L,cr_returning_customer_sk#22421L,cr_returning_cdemo_sk#22422L,cr_returning_hdemo_sk#22423L,cr_returning_addr_sk#22424L,cr_call_center_sk#22425L,cr_catalog_page_sk#22426L,cr_ship_mode_sk#22427L,cr_warehouse_sk#22428L,cr_reason_sk#22429L,cr_order_number#22430L,cr_return_quantity#22431,cr_return_amount#22432,cr_return_tax#22433,cr_return_amt_inc_tax#22434,cr_fee#22435,cr_return_ship_cost#22436,cr_refunded_cash#22437,cr_reversed_charge#22438,... 3 more fields] orc
:                 :     +- Project [d_year#22493, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478, (ss_quantity#22451 - coalesce(sr_return_quantity#22524, 0)) AS sales_cnt#22325, (ss_ext_sales_price#22456 - coalesce(sr_return_amt#22525, cast(0.0 as double))) AS sales_amt#22326]
:                 :        +- Filter (i_category#22477 = Sports)
:                 :           +- Join LeftOuter, ((ss_ticket_number#22450L = sr_ticket_number#22523L) AND (ss_item_sk#22443L = sr_item_sk#22516L))
:                 :              :- Join Inner, (d_date_sk#22487L = ss_sold_date_sk#22464L)
:                 :              :  :- Join Inner, (i_item_sk#22465L = ss_item_sk#22443L)
:                 :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:                 :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#22442L,ss_item_sk#22443L,ss_customer_sk#22444L,ss_cdemo_sk#22445L,ss_hdemo_sk#22446L,ss_addr_sk#22447L,ss_store_sk#22448L,ss_promo_sk#22449L,ss_ticket_number#22450L,ss_quantity#22451,ss_wholesale_cost#22452,ss_list_price#22453,ss_sales_price#22454,ss_ext_discount_amt#22455,ss_ext_sales_price#22456,ss_ext_wholesale_cost#22457,ss_ext_list_price#22458,ss_ext_tax#22459,ss_coupon_amt#22460,ss_net_paid#22461,ss_net_paid_inc_tax#22462,ss_net_profit#22463,ss_sold_date_sk#22464L] orc
:                 :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                 :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22465L,i_item_id#22466,i_rec_start_date#22467,i_rec_end_date#22468,i_item_desc#22469,i_current_price#22470,i_wholesale_cost#22471,i_brand_id#22472,i_brand#22473,i_class_id#22474,i_class#22475,i_category_id#22476,i_category#22477,i_manufact_id#22478,i_manufact#22479,i_size#22480,i_formulation#22481,i_color#22482,i_units#22483,i_container#22484,i_manager_id#22485,i_product_name#22486] orc
:                 :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22487L,d_date_id#22488,d_date#22489,d_month_seq#22490,d_week_seq#22491,d_quarter_seq#22492,d_year#22493,d_dow#22494,d_moy#22495,d_dom#22496,d_qoy#22497,d_fy_year#22498,d_fy_quarter_seq#22499,d_fy_week_seq#22500,d_day_name#22501,d_quarter_name#22502,d_holiday#22503,d_weekend#22504,d_following_holiday#22505,d_first_dom#22506,d_last_dom#22507,d_same_day_ly#22508,d_same_day_lq#22509,d_current_day#22510,... 4 more fields] orc
:                 :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:                 :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#22515L,sr_item_sk#22516L,sr_customer_sk#22517L,sr_cdemo_sk#22518L,sr_hdemo_sk#22519L,sr_addr_sk#22520L,sr_store_sk#22521L,sr_reason_sk#22522L,sr_ticket_number#22523L,sr_return_quantity#22524,sr_return_amt#22525,sr_return_tax#22526,sr_return_amt_inc_tax#22527,sr_fee#22528,sr_return_ship_cost#22529,sr_refunded_cash#22530,sr_reversed_charge#22531,sr_store_credit#22532,sr_net_loss#22533,sr_returned_date_sk#22534L] orc
:                 +- Project [d_year#22597, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582, (ws_quantity#22552 - coalesce(wr_return_quantity#22632, 0)) AS sales_cnt#22327, (ws_ext_sales_price#22557 - coalesce(wr_return_amt#22633, cast(0.0 as double))) AS sales_amt#22328]
:                    +- Filter (i_category#22581 = Sports)
:                       +- Join LeftOuter, ((ws_order_number#22551L = wr_order_number#22631L) AND (ws_item_sk#22537L = wr_item_sk#22620L))
:                          :- Join Inner, (d_date_sk#22591L = ws_sold_date_sk#22568L)
:                          :  :- Join Inner, (i_item_sk#22569L = ws_item_sk#22537L)
:                          :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                          :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#22535L,ws_ship_date_sk#22536L,ws_item_sk#22537L,ws_bill_customer_sk#22538L,ws_bill_cdemo_sk#22539L,ws_bill_hdemo_sk#22540L,ws_bill_addr_sk#22541L,ws_ship_customer_sk#22542L,ws_ship_cdemo_sk#22543L,ws_ship_hdemo_sk#22544L,ws_ship_addr_sk#22545L,ws_web_page_sk#22546L,ws_web_site_sk#22547L,ws_ship_mode_sk#22548L,ws_warehouse_sk#22549L,ws_promo_sk#22550L,ws_order_number#22551L,ws_quantity#22552,ws_wholesale_cost#22553,ws_list_price#22554,ws_sales_price#22555,ws_ext_discount_amt#22556,ws_ext_sales_price#22557,ws_ext_wholesale_cost#22558,... 10 more fields] orc
:                          :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:                          :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22569L,i_item_id#22570,i_rec_start_date#22571,i_rec_end_date#22572,i_item_desc#22573,i_current_price#22574,i_wholesale_cost#22575,i_brand_id#22576,i_brand#22577,i_class_id#22578,i_class#22579,i_category_id#22580,i_category#22581,i_manufact_id#22582,i_manufact#22583,i_size#22584,i_formulation#22585,i_color#22586,i_units#22587,i_container#22588,i_manager_id#22589,i_product_name#22590] orc
:                          :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                          :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22591L,d_date_id#22592,d_date#22593,d_month_seq#22594,d_week_seq#22595,d_quarter_seq#22596,d_year#22597,d_dow#22598,d_moy#22599,d_dom#22600,d_qoy#22601,d_fy_year#22602,d_fy_quarter_seq#22603,d_fy_week_seq#22604,d_day_name#22605,d_quarter_name#22606,d_holiday#22607,d_weekend#22608,d_following_holiday#22609,d_first_dom#22610,d_last_dom#22611,d_same_day_ly#22612,d_same_day_lq#22613,d_current_day#22614,... 4 more fields] orc
:                          +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:                             +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#22619L,wr_item_sk#22620L,wr_refunded_customer_sk#22621L,wr_refunded_cdemo_sk#22622L,wr_refunded_hdemo_sk#22623L,wr_refunded_addr_sk#22624L,wr_returning_customer_sk#22625L,wr_returning_cdemo_sk#22626L,wr_returning_hdemo_sk#22627L,wr_returning_addr_sk#22628L,wr_web_page_sk#22629L,wr_reason_sk#22630L,wr_order_number#22631L,wr_return_quantity#22632,wr_return_amt#22633,wr_return_tax#22634,wr_return_amt_inc_tax#22635,wr_fee#22636,wr_return_ship_cost#22637,wr_refunded_cash#22638,wr_reversed_charge#22639,wr_account_credit#22640,wr_net_loss#22641,wr_returned_date_sk#22642L] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [sales_cnt_diff#22321L ASC NULLS FIRST], true
         +- Project [d_year#22645 AS prev_year#22317, d_year#22393 AS year#22318, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22650L AS prev_yr_cnt#22319L, sales_cnt#22329L AS curr_yr_cnt#22320L, (sales_cnt#22329L - sales_cnt#22650L) AS sales_cnt_diff#22321L, (sales_amt#22330 - sales_amt#22651) AS sales_amt_diff#22322]
            +- Filter ((((i_brand_id#22372 = i_brand_id#22646) AND (i_class_id#22374 = i_class_id#22647)) AND ((i_category_id#22376 = i_category_id#22648) AND (i_manufact_id#22378 = i_manufact_id#22649))) AND (((d_year#22393 = 2002) AND (d_year#22645 = (2002 - 1))) AND (cast(CheckOverflow((promote_precision(cast(cast(sales_cnt#22329L as decimal(17,2)) as decimal(17,2))) / promote_precision(cast(cast(sales_cnt#22650L as decimal(17,2)) as decimal(17,2)))), DecimalType(37,20), true) as decimal(37,20)) < cast(0.9 as decimal(37,20)))))
               +- Join Inner
                  :- SubqueryAlias curr_yr
                  :  +- SubqueryAlias all_sales
                  :     +- CTERelationRef 49, true, [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22329L, sales_amt#22330]
                  +- SubqueryAlias prev_yr
                     +- SubqueryAlias all_sales
                        +- CTERelationRef 49, true, [d_year#22645, i_brand_id#22646, i_class_id#22647, i_category_id#22648, i_manufact_id#22649, sales_cnt#22650L, sales_amt#22651]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [sales_cnt_diff#22321L ASC NULLS FIRST], true
      +- Project [d_year#22724 AS prev_year#22317, d_year#22393 AS year#22318, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22650L AS prev_yr_cnt#22319L, sales_cnt#22329L AS curr_yr_cnt#22320L, (sales_cnt#22329L - sales_cnt#22650L) AS sales_cnt_diff#22321L, (sales_amt#22330 - sales_amt#22651) AS sales_amt_diff#22322]
         +- Join Inner, (((((i_brand_id#22372 = i_brand_id#22703) AND (i_class_id#22374 = i_class_id#22705)) AND (i_category_id#22376 = i_category_id#22707)) AND (i_manufact_id#22378 = i_manufact_id#22709)) AND (CheckOverflow((promote_precision(cast(sales_cnt#22329L as decimal(17,2))) / promote_precision(cast(sales_cnt#22650L as decimal(17,2)))), DecimalType(37,20), true) < 0.90000000000000000000))
            :- Aggregate [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378], [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sum(sales_cnt#22323) AS sales_cnt#22329L, sum(sales_amt#22324) AS sales_amt#22330]
            :  +- Aggregate [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324], [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324]
            :     +- Union false, false
            :        :- Project [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, (cs_quantity#22348 - coalesce(cr_return_quantity#22431, 0)) AS sales_cnt#22323, (cs_ext_sales_price#22353 - coalesce(cr_return_amount#22432, 0.0)) AS sales_amt#22324]
            :        :  +- Join LeftOuter, ((cs_order_number#22347L = cr_order_number#22430L) AND (cs_item_sk#22345L = cr_item_sk#22416L))
            :        :     :- Project [cs_item_sk#22345L, cs_order_number#22347L, cs_quantity#22348, cs_ext_sales_price#22353, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, d_year#22393]
            :        :     :  +- Join Inner, (d_date_sk#22387L = cs_sold_date_sk#22364L)
            :        :     :     :- Project [cs_item_sk#22345L, cs_order_number#22347L, cs_quantity#22348, cs_ext_sales_price#22353, cs_sold_date_sk#22364L, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378]
            :        :     :     :  +- Join Inner, (i_item_sk#22365L = cs_item_sk#22345L)
            :        :     :     :     :- Project [cs_item_sk#22345L, cs_order_number#22347L, cs_quantity#22348, cs_ext_sales_price#22353, cs_sold_date_sk#22364L]
            :        :     :     :     :  +- Filter ((isnotnull(cs_item_sk#22345L) AND isnotnull(cs_sold_date_sk#22364L)) AND dynamicpruning#22976 [cs_sold_date_sk#22364L])
            :        :     :     :     :     :  +- Project [d_date_sk#22387L, d_year#22393]
            :        :     :     :     :     :     +- Filter ((isnotnull(d_year#22393) AND (d_year#22393 = 2002)) AND isnotnull(d_date_sk#22387L))
            :        :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22387L,d_date_id#22388,d_date#22389,d_month_seq#22390,d_week_seq#22391,d_quarter_seq#22392,d_year#22393,d_dow#22394,d_moy#22395,d_dom#22396,d_qoy#22397,d_fy_year#22398,d_fy_quarter_seq#22399,d_fy_week_seq#22400,d_day_name#22401,d_quarter_name#22402,d_holiday#22403,d_weekend#22404,d_following_holiday#22405,d_first_dom#22406,d_last_dom#22407,d_same_day_ly#22408,d_same_day_lq#22409,d_current_day#22410,... 4 more fields] orc
            :        :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#22331L,cs_ship_date_sk#22332L,cs_bill_customer_sk#22333L,cs_bill_cdemo_sk#22334L,cs_bill_hdemo_sk#22335L,cs_bill_addr_sk#22336L,cs_ship_customer_sk#22337L,cs_ship_cdemo_sk#22338L,cs_ship_hdemo_sk#22339L,cs_ship_addr_sk#22340L,cs_call_center_sk#22341L,cs_catalog_page_sk#22342L,cs_ship_mode_sk#22343L,cs_warehouse_sk#22344L,cs_item_sk#22345L,cs_promo_sk#22346L,cs_order_number#22347L,cs_quantity#22348,cs_wholesale_cost#22349,cs_list_price#22350,cs_sales_price#22351,cs_ext_discount_amt#22352,cs_ext_sales_price#22353,cs_ext_wholesale_cost#22354,... 10 more fields] orc
            :        :     :     :     +- Project [i_item_sk#22365L, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378]
            :        :     :     :        +- Filter (((isnotnull(i_category#22377) AND (i_category#22377 = Sports)) AND isnotnull(i_item_sk#22365L)) AND (((isnotnull(i_brand_id#22372) AND isnotnull(i_class_id#22374)) AND isnotnull(i_category_id#22376)) AND isnotnull(i_manufact_id#22378)))
            :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22365L,i_item_id#22366,i_rec_start_date#22367,i_rec_end_date#22368,i_item_desc#22369,i_current_price#22370,i_wholesale_cost#22371,i_brand_id#22372,i_brand#22373,i_class_id#22374,i_class#22375,i_category_id#22376,i_category#22377,i_manufact_id#22378,i_manufact#22379,i_size#22380,i_formulation#22381,i_color#22382,i_units#22383,i_container#22384,i_manager_id#22385,i_product_name#22386] orc
            :        :     :     +- Project [d_date_sk#22387L, d_year#22393]
            :        :     :        +- Filter ((isnotnull(d_year#22393) AND (d_year#22393 = 2002)) AND isnotnull(d_date_sk#22387L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22387L,d_date_id#22388,d_date#22389,d_month_seq#22390,d_week_seq#22391,d_quarter_seq#22392,d_year#22393,d_dow#22394,d_moy#22395,d_dom#22396,d_qoy#22397,d_fy_year#22398,d_fy_quarter_seq#22399,d_fy_week_seq#22400,d_day_name#22401,d_quarter_name#22402,d_holiday#22403,d_weekend#22404,d_following_holiday#22405,d_first_dom#22406,d_last_dom#22407,d_same_day_ly#22408,d_same_day_lq#22409,d_current_day#22410,... 4 more fields] orc
            :        :     +- Project [cr_item_sk#22416L, cr_order_number#22430L, cr_return_quantity#22431, cr_return_amount#22432]
            :        :        +- Filter (isnotnull(cr_order_number#22430L) AND isnotnull(cr_item_sk#22416L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#22415L,cr_item_sk#22416L,cr_refunded_customer_sk#22417L,cr_refunded_cdemo_sk#22418L,cr_refunded_hdemo_sk#22419L,cr_refunded_addr_sk#22420L,cr_returning_customer_sk#22421L,cr_returning_cdemo_sk#22422L,cr_returning_hdemo_sk#22423L,cr_returning_addr_sk#22424L,cr_call_center_sk#22425L,cr_catalog_page_sk#22426L,cr_ship_mode_sk#22427L,cr_warehouse_sk#22428L,cr_reason_sk#22429L,cr_order_number#22430L,cr_return_quantity#22431,cr_return_amount#22432,cr_return_tax#22433,cr_return_amt_inc_tax#22434,cr_fee#22435,cr_return_ship_cost#22436,cr_refunded_cash#22437,cr_reversed_charge#22438,... 3 more fields] orc
            :        :- Project [d_year#22493, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478, (ss_quantity#22451 - coalesce(sr_return_quantity#22524, 0)) AS sales_cnt#22325, (ss_ext_sales_price#22456 - coalesce(sr_return_amt#22525, 0.0)) AS sales_amt#22326]
            :        :  +- Join LeftOuter, ((ss_ticket_number#22450L = sr_ticket_number#22523L) AND (ss_item_sk#22443L = sr_item_sk#22516L))
            :        :     :- Project [ss_item_sk#22443L, ss_ticket_number#22450L, ss_quantity#22451, ss_ext_sales_price#22456, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478, d_year#22493]
            :        :     :  +- Join Inner, (d_date_sk#22487L = ss_sold_date_sk#22464L)
            :        :     :     :- Project [ss_item_sk#22443L, ss_ticket_number#22450L, ss_quantity#22451, ss_ext_sales_price#22456, ss_sold_date_sk#22464L, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478]
            :        :     :     :  +- Join Inner, (i_item_sk#22465L = ss_item_sk#22443L)
            :        :     :     :     :- Project [ss_item_sk#22443L, ss_ticket_number#22450L, ss_quantity#22451, ss_ext_sales_price#22456, ss_sold_date_sk#22464L]
            :        :     :     :     :  +- Filter ((isnotnull(ss_item_sk#22443L) AND isnotnull(ss_sold_date_sk#22464L)) AND dynamicpruning#22977 [ss_sold_date_sk#22464L])
            :        :     :     :     :     :  +- Project [d_date_sk#22487L, d_year#22493]
            :        :     :     :     :     :     +- Filter ((isnotnull(d_year#22493) AND (d_year#22493 = 2002)) AND isnotnull(d_date_sk#22487L))
            :        :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22487L,d_date_id#22488,d_date#22489,d_month_seq#22490,d_week_seq#22491,d_quarter_seq#22492,d_year#22493,d_dow#22494,d_moy#22495,d_dom#22496,d_qoy#22497,d_fy_year#22498,d_fy_quarter_seq#22499,d_fy_week_seq#22500,d_day_name#22501,d_quarter_name#22502,d_holiday#22503,d_weekend#22504,d_following_holiday#22505,d_first_dom#22506,d_last_dom#22507,d_same_day_ly#22508,d_same_day_lq#22509,d_current_day#22510,... 4 more fields] orc
            :        :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#22442L,ss_item_sk#22443L,ss_customer_sk#22444L,ss_cdemo_sk#22445L,ss_hdemo_sk#22446L,ss_addr_sk#22447L,ss_store_sk#22448L,ss_promo_sk#22449L,ss_ticket_number#22450L,ss_quantity#22451,ss_wholesale_cost#22452,ss_list_price#22453,ss_sales_price#22454,ss_ext_discount_amt#22455,ss_ext_sales_price#22456,ss_ext_wholesale_cost#22457,ss_ext_list_price#22458,ss_ext_tax#22459,ss_coupon_amt#22460,ss_net_paid#22461,ss_net_paid_inc_tax#22462,ss_net_profit#22463,ss_sold_date_sk#22464L] orc
            :        :     :     :     +- Project [i_item_sk#22465L, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478]
            :        :     :     :        +- Filter (((isnotnull(i_category#22477) AND (i_category#22477 = Sports)) AND isnotnull(i_item_sk#22465L)) AND (((isnotnull(i_brand_id#22472) AND isnotnull(i_class_id#22474)) AND isnotnull(i_category_id#22476)) AND isnotnull(i_manufact_id#22478)))
            :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22465L,i_item_id#22466,i_rec_start_date#22467,i_rec_end_date#22468,i_item_desc#22469,i_current_price#22470,i_wholesale_cost#22471,i_brand_id#22472,i_brand#22473,i_class_id#22474,i_class#22475,i_category_id#22476,i_category#22477,i_manufact_id#22478,i_manufact#22479,i_size#22480,i_formulation#22481,i_color#22482,i_units#22483,i_container#22484,i_manager_id#22485,i_product_name#22486] orc
            :        :     :     +- Project [d_date_sk#22487L, d_year#22493]
            :        :     :        +- Filter ((isnotnull(d_year#22493) AND (d_year#22493 = 2002)) AND isnotnull(d_date_sk#22487L))
            :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22487L,d_date_id#22488,d_date#22489,d_month_seq#22490,d_week_seq#22491,d_quarter_seq#22492,d_year#22493,d_dow#22494,d_moy#22495,d_dom#22496,d_qoy#22497,d_fy_year#22498,d_fy_quarter_seq#22499,d_fy_week_seq#22500,d_day_name#22501,d_quarter_name#22502,d_holiday#22503,d_weekend#22504,d_following_holiday#22505,d_first_dom#22506,d_last_dom#22507,d_same_day_ly#22508,d_same_day_lq#22509,d_current_day#22510,... 4 more fields] orc
            :        :     +- Project [sr_item_sk#22516L, sr_ticket_number#22523L, sr_return_quantity#22524, sr_return_amt#22525]
            :        :        +- Filter (isnotnull(sr_ticket_number#22523L) AND isnotnull(sr_item_sk#22516L))
            :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#22515L,sr_item_sk#22516L,sr_customer_sk#22517L,sr_cdemo_sk#22518L,sr_hdemo_sk#22519L,sr_addr_sk#22520L,sr_store_sk#22521L,sr_reason_sk#22522L,sr_ticket_number#22523L,sr_return_quantity#22524,sr_return_amt#22525,sr_return_tax#22526,sr_return_amt_inc_tax#22527,sr_fee#22528,sr_return_ship_cost#22529,sr_refunded_cash#22530,sr_reversed_charge#22531,sr_store_credit#22532,sr_net_loss#22533,sr_returned_date_sk#22534L] orc
            :        +- Project [d_year#22597, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582, (ws_quantity#22552 - coalesce(wr_return_quantity#22632, 0)) AS sales_cnt#22327, (ws_ext_sales_price#22557 - coalesce(wr_return_amt#22633, 0.0)) AS sales_amt#22328]
            :           +- Join LeftOuter, ((ws_order_number#22551L = wr_order_number#22631L) AND (ws_item_sk#22537L = wr_item_sk#22620L))
            :              :- Project [ws_item_sk#22537L, ws_order_number#22551L, ws_quantity#22552, ws_ext_sales_price#22557, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582, d_year#22597]
            :              :  +- Join Inner, (d_date_sk#22591L = ws_sold_date_sk#22568L)
            :              :     :- Project [ws_item_sk#22537L, ws_order_number#22551L, ws_quantity#22552, ws_ext_sales_price#22557, ws_sold_date_sk#22568L, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582]
            :              :     :  +- Join Inner, (i_item_sk#22569L = ws_item_sk#22537L)
            :              :     :     :- Project [ws_item_sk#22537L, ws_order_number#22551L, ws_quantity#22552, ws_ext_sales_price#22557, ws_sold_date_sk#22568L]
            :              :     :     :  +- Filter ((isnotnull(ws_item_sk#22537L) AND isnotnull(ws_sold_date_sk#22568L)) AND dynamicpruning#22978 [ws_sold_date_sk#22568L])
            :              :     :     :     :  +- Project [d_date_sk#22591L, d_year#22597]
            :              :     :     :     :     +- Filter ((isnotnull(d_year#22597) AND (d_year#22597 = 2002)) AND isnotnull(d_date_sk#22591L))
            :              :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22591L,d_date_id#22592,d_date#22593,d_month_seq#22594,d_week_seq#22595,d_quarter_seq#22596,d_year#22597,d_dow#22598,d_moy#22599,d_dom#22600,d_qoy#22601,d_fy_year#22602,d_fy_quarter_seq#22603,d_fy_week_seq#22604,d_day_name#22605,d_quarter_name#22606,d_holiday#22607,d_weekend#22608,d_following_holiday#22609,d_first_dom#22610,d_last_dom#22611,d_same_day_ly#22612,d_same_day_lq#22613,d_current_day#22614,... 4 more fields] orc
            :              :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#22535L,ws_ship_date_sk#22536L,ws_item_sk#22537L,ws_bill_customer_sk#22538L,ws_bill_cdemo_sk#22539L,ws_bill_hdemo_sk#22540L,ws_bill_addr_sk#22541L,ws_ship_customer_sk#22542L,ws_ship_cdemo_sk#22543L,ws_ship_hdemo_sk#22544L,ws_ship_addr_sk#22545L,ws_web_page_sk#22546L,ws_web_site_sk#22547L,ws_ship_mode_sk#22548L,ws_warehouse_sk#22549L,ws_promo_sk#22550L,ws_order_number#22551L,ws_quantity#22552,ws_wholesale_cost#22553,ws_list_price#22554,ws_sales_price#22555,ws_ext_discount_amt#22556,ws_ext_sales_price#22557,ws_ext_wholesale_cost#22558,... 10 more fields] orc
            :              :     :     +- Project [i_item_sk#22569L, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582]
            :              :     :        +- Filter (((isnotnull(i_category#22581) AND (i_category#22581 = Sports)) AND isnotnull(i_item_sk#22569L)) AND (((isnotnull(i_brand_id#22576) AND isnotnull(i_class_id#22578)) AND isnotnull(i_category_id#22580)) AND isnotnull(i_manufact_id#22582)))
            :              :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22569L,i_item_id#22570,i_rec_start_date#22571,i_rec_end_date#22572,i_item_desc#22573,i_current_price#22574,i_wholesale_cost#22575,i_brand_id#22576,i_brand#22577,i_class_id#22578,i_class#22579,i_category_id#22580,i_category#22581,i_manufact_id#22582,i_manufact#22583,i_size#22584,i_formulation#22585,i_color#22586,i_units#22587,i_container#22588,i_manager_id#22589,i_product_name#22590] orc
            :              :     +- Project [d_date_sk#22591L, d_year#22597]
            :              :        +- Filter ((isnotnull(d_year#22597) AND (d_year#22597 = 2002)) AND isnotnull(d_date_sk#22591L))
            :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22591L,d_date_id#22592,d_date#22593,d_month_seq#22594,d_week_seq#22595,d_quarter_seq#22596,d_year#22597,d_dow#22598,d_moy#22599,d_dom#22600,d_qoy#22601,d_fy_year#22602,d_fy_quarter_seq#22603,d_fy_week_seq#22604,d_day_name#22605,d_quarter_name#22606,d_holiday#22607,d_weekend#22608,d_following_holiday#22609,d_first_dom#22610,d_last_dom#22611,d_same_day_ly#22612,d_same_day_lq#22613,d_current_day#22614,... 4 more fields] orc
            :              +- Project [wr_item_sk#22620L, wr_order_number#22631L, wr_return_quantity#22632, wr_return_amt#22633]
            :                 +- Filter (isnotnull(wr_order_number#22631L) AND isnotnull(wr_item_sk#22620L))
            :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#22619L,wr_item_sk#22620L,wr_refunded_customer_sk#22621L,wr_refunded_cdemo_sk#22622L,wr_refunded_hdemo_sk#22623L,wr_refunded_addr_sk#22624L,wr_returning_customer_sk#22625L,wr_returning_cdemo_sk#22626L,wr_returning_hdemo_sk#22627L,wr_returning_addr_sk#22628L,wr_web_page_sk#22629L,wr_reason_sk#22630L,wr_order_number#22631L,wr_return_quantity#22632,wr_return_amt#22633,wr_return_tax#22634,wr_return_amt_inc_tax#22635,wr_fee#22636,wr_return_ship_cost#22637,wr_refunded_cash#22638,wr_reversed_charge#22639,wr_account_credit#22640,wr_net_loss#22641,wr_returned_date_sk#22642L] orc
            +- Aggregate [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709], [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sum(sales_cnt#22323) AS sales_cnt#22650L, sum(sales_amt#22324) AS sales_amt#22651]
               +- Aggregate [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324], [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324]
                  +- Union false, false
                     :- Project [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, (cs_quantity#22679 - coalesce(cr_return_quantity#22762, 0)) AS sales_cnt#22323, (cs_ext_sales_price#22684 - coalesce(cr_return_amount#22763, 0.0)) AS sales_amt#22324]
                     :  +- Join LeftOuter, ((cs_order_number#22678L = cr_order_number#22761L) AND (cs_item_sk#22676L = cr_item_sk#22747L))
                     :     :- Project [cs_item_sk#22676L, cs_order_number#22678L, cs_quantity#22679, cs_ext_sales_price#22684, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, d_year#22724]
                     :     :  +- Join Inner, (d_date_sk#22718L = cs_sold_date_sk#22695L)
                     :     :     :- Project [cs_item_sk#22676L, cs_order_number#22678L, cs_quantity#22679, cs_ext_sales_price#22684, cs_sold_date_sk#22695L, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709]
                     :     :     :  +- Join Inner, (i_item_sk#22696L = cs_item_sk#22676L)
                     :     :     :     :- Project [cs_item_sk#22676L, cs_order_number#22678L, cs_quantity#22679, cs_ext_sales_price#22684, cs_sold_date_sk#22695L]
                     :     :     :     :  +- Filter ((isnotnull(cs_item_sk#22676L) AND isnotnull(cs_sold_date_sk#22695L)) AND dynamicpruning#22979 [cs_sold_date_sk#22695L])
                     :     :     :     :     :  +- Project [d_date_sk#22718L, d_year#22724]
                     :     :     :     :     :     +- Filter ((isnotnull(d_year#22724) AND (d_year#22724 = 2001)) AND isnotnull(d_date_sk#22718L))
                     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22718L,d_date_id#22719,d_date#22720,d_month_seq#22721,d_week_seq#22722,d_quarter_seq#22723,d_year#22724,d_dow#22725,d_moy#22726,d_dom#22727,d_qoy#22728,d_fy_year#22729,d_fy_quarter_seq#22730,d_fy_week_seq#22731,d_day_name#22732,d_quarter_name#22733,d_holiday#22734,d_weekend#22735,d_following_holiday#22736,d_first_dom#22737,d_last_dom#22738,d_same_day_ly#22739,d_same_day_lq#22740,d_current_day#22741,... 4 more fields] orc
                     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#22662L,cs_ship_date_sk#22663L,cs_bill_customer_sk#22664L,cs_bill_cdemo_sk#22665L,cs_bill_hdemo_sk#22666L,cs_bill_addr_sk#22667L,cs_ship_customer_sk#22668L,cs_ship_cdemo_sk#22669L,cs_ship_hdemo_sk#22670L,cs_ship_addr_sk#22671L,cs_call_center_sk#22672L,cs_catalog_page_sk#22673L,cs_ship_mode_sk#22674L,cs_warehouse_sk#22675L,cs_item_sk#22676L,cs_promo_sk#22677L,cs_order_number#22678L,cs_quantity#22679,cs_wholesale_cost#22680,cs_list_price#22681,cs_sales_price#22682,cs_ext_discount_amt#22683,cs_ext_sales_price#22684,cs_ext_wholesale_cost#22685,... 10 more fields] orc
                     :     :     :     +- Project [i_item_sk#22696L, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709]
                     :     :     :        +- Filter (((isnotnull(i_category#22708) AND (i_category#22708 = Sports)) AND isnotnull(i_item_sk#22696L)) AND (((isnotnull(i_brand_id#22703) AND isnotnull(i_class_id#22705)) AND isnotnull(i_category_id#22707)) AND isnotnull(i_manufact_id#22709)))
                     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22696L,i_item_id#22697,i_rec_start_date#22698,i_rec_end_date#22699,i_item_desc#22700,i_current_price#22701,i_wholesale_cost#22702,i_brand_id#22703,i_brand#22704,i_class_id#22705,i_class#22706,i_category_id#22707,i_category#22708,i_manufact_id#22709,i_manufact#22710,i_size#22711,i_formulation#22712,i_color#22713,i_units#22714,i_container#22715,i_manager_id#22716,i_product_name#22717] orc
                     :     :     +- Project [d_date_sk#22718L, d_year#22724]
                     :     :        +- Filter ((isnotnull(d_year#22724) AND (d_year#22724 = 2001)) AND isnotnull(d_date_sk#22718L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22718L,d_date_id#22719,d_date#22720,d_month_seq#22721,d_week_seq#22722,d_quarter_seq#22723,d_year#22724,d_dow#22725,d_moy#22726,d_dom#22727,d_qoy#22728,d_fy_year#22729,d_fy_quarter_seq#22730,d_fy_week_seq#22731,d_day_name#22732,d_quarter_name#22733,d_holiday#22734,d_weekend#22735,d_following_holiday#22736,d_first_dom#22737,d_last_dom#22738,d_same_day_ly#22739,d_same_day_lq#22740,d_current_day#22741,... 4 more fields] orc
                     :     +- Project [cr_item_sk#22747L, cr_order_number#22761L, cr_return_quantity#22762, cr_return_amount#22763]
                     :        +- Filter (isnotnull(cr_order_number#22761L) AND isnotnull(cr_item_sk#22747L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#22746L,cr_item_sk#22747L,cr_refunded_customer_sk#22748L,cr_refunded_cdemo_sk#22749L,cr_refunded_hdemo_sk#22750L,cr_refunded_addr_sk#22751L,cr_returning_customer_sk#22752L,cr_returning_cdemo_sk#22753L,cr_returning_hdemo_sk#22754L,cr_returning_addr_sk#22755L,cr_call_center_sk#22756L,cr_catalog_page_sk#22757L,cr_ship_mode_sk#22758L,cr_warehouse_sk#22759L,cr_reason_sk#22760L,cr_order_number#22761L,cr_return_quantity#22762,cr_return_amount#22763,cr_return_tax#22764,cr_return_amt_inc_tax#22765,cr_fee#22766,cr_return_ship_cost#22767,cr_refunded_cash#22768,cr_reversed_charge#22769,... 3 more fields] orc
                     :- Project [d_year#22824, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809, (ss_quantity#22782 - coalesce(sr_return_quantity#22855, 0)) AS sales_cnt#22325, (ss_ext_sales_price#22787 - coalesce(sr_return_amt#22856, 0.0)) AS sales_amt#22326]
                     :  +- Join LeftOuter, ((ss_ticket_number#22781L = sr_ticket_number#22854L) AND (ss_item_sk#22774L = sr_item_sk#22847L))
                     :     :- Project [ss_item_sk#22774L, ss_ticket_number#22781L, ss_quantity#22782, ss_ext_sales_price#22787, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809, d_year#22824]
                     :     :  +- Join Inner, (d_date_sk#22818L = ss_sold_date_sk#22795L)
                     :     :     :- Project [ss_item_sk#22774L, ss_ticket_number#22781L, ss_quantity#22782, ss_ext_sales_price#22787, ss_sold_date_sk#22795L, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809]
                     :     :     :  +- Join Inner, (i_item_sk#22796L = ss_item_sk#22774L)
                     :     :     :     :- Project [ss_item_sk#22774L, ss_ticket_number#22781L, ss_quantity#22782, ss_ext_sales_price#22787, ss_sold_date_sk#22795L]
                     :     :     :     :  +- Filter ((isnotnull(ss_item_sk#22774L) AND isnotnull(ss_sold_date_sk#22795L)) AND dynamicpruning#22980 [ss_sold_date_sk#22795L])
                     :     :     :     :     :  +- Project [d_date_sk#22818L, d_year#22824]
                     :     :     :     :     :     +- Filter ((isnotnull(d_year#22824) AND (d_year#22824 = 2001)) AND isnotnull(d_date_sk#22818L))
                     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22818L,d_date_id#22819,d_date#22820,d_month_seq#22821,d_week_seq#22822,d_quarter_seq#22823,d_year#22824,d_dow#22825,d_moy#22826,d_dom#22827,d_qoy#22828,d_fy_year#22829,d_fy_quarter_seq#22830,d_fy_week_seq#22831,d_day_name#22832,d_quarter_name#22833,d_holiday#22834,d_weekend#22835,d_following_holiday#22836,d_first_dom#22837,d_last_dom#22838,d_same_day_ly#22839,d_same_day_lq#22840,d_current_day#22841,... 4 more fields] orc
                     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#22773L,ss_item_sk#22774L,ss_customer_sk#22775L,ss_cdemo_sk#22776L,ss_hdemo_sk#22777L,ss_addr_sk#22778L,ss_store_sk#22779L,ss_promo_sk#22780L,ss_ticket_number#22781L,ss_quantity#22782,ss_wholesale_cost#22783,ss_list_price#22784,ss_sales_price#22785,ss_ext_discount_amt#22786,ss_ext_sales_price#22787,ss_ext_wholesale_cost#22788,ss_ext_list_price#22789,ss_ext_tax#22790,ss_coupon_amt#22791,ss_net_paid#22792,ss_net_paid_inc_tax#22793,ss_net_profit#22794,ss_sold_date_sk#22795L] orc
                     :     :     :     +- Project [i_item_sk#22796L, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809]
                     :     :     :        +- Filter (((isnotnull(i_category#22808) AND (i_category#22808 = Sports)) AND isnotnull(i_item_sk#22796L)) AND (((isnotnull(i_brand_id#22803) AND isnotnull(i_class_id#22805)) AND isnotnull(i_category_id#22807)) AND isnotnull(i_manufact_id#22809)))
                     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22796L,i_item_id#22797,i_rec_start_date#22798,i_rec_end_date#22799,i_item_desc#22800,i_current_price#22801,i_wholesale_cost#22802,i_brand_id#22803,i_brand#22804,i_class_id#22805,i_class#22806,i_category_id#22807,i_category#22808,i_manufact_id#22809,i_manufact#22810,i_size#22811,i_formulation#22812,i_color#22813,i_units#22814,i_container#22815,i_manager_id#22816,i_product_name#22817] orc
                     :     :     +- Project [d_date_sk#22818L, d_year#22824]
                     :     :        +- Filter ((isnotnull(d_year#22824) AND (d_year#22824 = 2001)) AND isnotnull(d_date_sk#22818L))
                     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22818L,d_date_id#22819,d_date#22820,d_month_seq#22821,d_week_seq#22822,d_quarter_seq#22823,d_year#22824,d_dow#22825,d_moy#22826,d_dom#22827,d_qoy#22828,d_fy_year#22829,d_fy_quarter_seq#22830,d_fy_week_seq#22831,d_day_name#22832,d_quarter_name#22833,d_holiday#22834,d_weekend#22835,d_following_holiday#22836,d_first_dom#22837,d_last_dom#22838,d_same_day_ly#22839,d_same_day_lq#22840,d_current_day#22841,... 4 more fields] orc
                     :     +- Project [sr_item_sk#22847L, sr_ticket_number#22854L, sr_return_quantity#22855, sr_return_amt#22856]
                     :        +- Filter (isnotnull(sr_ticket_number#22854L) AND isnotnull(sr_item_sk#22847L))
                     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#22846L,sr_item_sk#22847L,sr_customer_sk#22848L,sr_cdemo_sk#22849L,sr_hdemo_sk#22850L,sr_addr_sk#22851L,sr_store_sk#22852L,sr_reason_sk#22853L,sr_ticket_number#22854L,sr_return_quantity#22855,sr_return_amt#22856,sr_return_tax#22857,sr_return_amt_inc_tax#22858,sr_fee#22859,sr_return_ship_cost#22860,sr_refunded_cash#22861,sr_reversed_charge#22862,sr_store_credit#22863,sr_net_loss#22864,sr_returned_date_sk#22865L] orc
                     +- Project [d_year#22928, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913, (ws_quantity#22883 - coalesce(wr_return_quantity#22963, 0)) AS sales_cnt#22327, (ws_ext_sales_price#22888 - coalesce(wr_return_amt#22964, 0.0)) AS sales_amt#22328]
                        +- Join LeftOuter, ((ws_order_number#22882L = wr_order_number#22962L) AND (ws_item_sk#22868L = wr_item_sk#22951L))
                           :- Project [ws_item_sk#22868L, ws_order_number#22882L, ws_quantity#22883, ws_ext_sales_price#22888, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913, d_year#22928]
                           :  +- Join Inner, (d_date_sk#22922L = ws_sold_date_sk#22899L)
                           :     :- Project [ws_item_sk#22868L, ws_order_number#22882L, ws_quantity#22883, ws_ext_sales_price#22888, ws_sold_date_sk#22899L, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913]
                           :     :  +- Join Inner, (i_item_sk#22900L = ws_item_sk#22868L)
                           :     :     :- Project [ws_item_sk#22868L, ws_order_number#22882L, ws_quantity#22883, ws_ext_sales_price#22888, ws_sold_date_sk#22899L]
                           :     :     :  +- Filter ((isnotnull(ws_item_sk#22868L) AND isnotnull(ws_sold_date_sk#22899L)) AND dynamicpruning#22981 [ws_sold_date_sk#22899L])
                           :     :     :     :  +- Project [d_date_sk#22922L, d_year#22928]
                           :     :     :     :     +- Filter ((isnotnull(d_year#22928) AND (d_year#22928 = 2001)) AND isnotnull(d_date_sk#22922L))
                           :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22922L,d_date_id#22923,d_date#22924,d_month_seq#22925,d_week_seq#22926,d_quarter_seq#22927,d_year#22928,d_dow#22929,d_moy#22930,d_dom#22931,d_qoy#22932,d_fy_year#22933,d_fy_quarter_seq#22934,d_fy_week_seq#22935,d_day_name#22936,d_quarter_name#22937,d_holiday#22938,d_weekend#22939,d_following_holiday#22940,d_first_dom#22941,d_last_dom#22942,d_same_day_ly#22943,d_same_day_lq#22944,d_current_day#22945,... 4 more fields] orc
                           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#22866L,ws_ship_date_sk#22867L,ws_item_sk#22868L,ws_bill_customer_sk#22869L,ws_bill_cdemo_sk#22870L,ws_bill_hdemo_sk#22871L,ws_bill_addr_sk#22872L,ws_ship_customer_sk#22873L,ws_ship_cdemo_sk#22874L,ws_ship_hdemo_sk#22875L,ws_ship_addr_sk#22876L,ws_web_page_sk#22877L,ws_web_site_sk#22878L,ws_ship_mode_sk#22879L,ws_warehouse_sk#22880L,ws_promo_sk#22881L,ws_order_number#22882L,ws_quantity#22883,ws_wholesale_cost#22884,ws_list_price#22885,ws_sales_price#22886,ws_ext_discount_amt#22887,ws_ext_sales_price#22888,ws_ext_wholesale_cost#22889,... 10 more fields] orc
                           :     :     +- Project [i_item_sk#22900L, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913]
                           :     :        +- Filter (((isnotnull(i_category#22912) AND (i_category#22912 = Sports)) AND isnotnull(i_item_sk#22900L)) AND (((isnotnull(i_brand_id#22907) AND isnotnull(i_class_id#22909)) AND isnotnull(i_category_id#22911)) AND isnotnull(i_manufact_id#22913)))
                           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22900L,i_item_id#22901,i_rec_start_date#22902,i_rec_end_date#22903,i_item_desc#22904,i_current_price#22905,i_wholesale_cost#22906,i_brand_id#22907,i_brand#22908,i_class_id#22909,i_class#22910,i_category_id#22911,i_category#22912,i_manufact_id#22913,i_manufact#22914,i_size#22915,i_formulation#22916,i_color#22917,i_units#22918,i_container#22919,i_manager_id#22920,i_product_name#22921] orc
                           :     +- Project [d_date_sk#22922L, d_year#22928]
                           :        +- Filter ((isnotnull(d_year#22928) AND (d_year#22928 = 2001)) AND isnotnull(d_date_sk#22922L))
                           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22922L,d_date_id#22923,d_date#22924,d_month_seq#22925,d_week_seq#22926,d_quarter_seq#22927,d_year#22928,d_dow#22929,d_moy#22930,d_dom#22931,d_qoy#22932,d_fy_year#22933,d_fy_quarter_seq#22934,d_fy_week_seq#22935,d_day_name#22936,d_quarter_name#22937,d_holiday#22938,d_weekend#22939,d_following_holiday#22940,d_first_dom#22941,d_last_dom#22942,d_same_day_ly#22943,d_same_day_lq#22944,d_current_day#22945,... 4 more fields] orc
                           +- Project [wr_item_sk#22951L, wr_order_number#22962L, wr_return_quantity#22963, wr_return_amt#22964]
                              +- Filter (isnotnull(wr_order_number#22962L) AND isnotnull(wr_item_sk#22951L))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#22950L,wr_item_sk#22951L,wr_refunded_customer_sk#22952L,wr_refunded_cdemo_sk#22953L,wr_refunded_hdemo_sk#22954L,wr_refunded_addr_sk#22955L,wr_returning_customer_sk#22956L,wr_returning_cdemo_sk#22957L,wr_returning_hdemo_sk#22958L,wr_returning_addr_sk#22959L,wr_web_page_sk#22960L,wr_reason_sk#22961L,wr_order_number#22962L,wr_return_quantity#22963,wr_return_amt#22964,wr_return_tax#22965,wr_return_amt_inc_tax#22966,wr_fee#22967,wr_return_ship_cost#22968,wr_refunded_cash#22969,wr_reversed_charge#22970,wr_account_credit#22971,wr_net_loss#22972,wr_returned_date_sk#22973L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[sales_cnt_diff#22321L ASC NULLS FIRST], output=[prev_year#22317,year#22318,i_brand_id#22372,i_class_id#22374,i_category_id#22376,i_manufact_id#22378,prev_yr_cnt#22319L,curr_yr_cnt#22320L,sales_cnt_diff#22321L,sales_amt_diff#22322])
   +- Project [d_year#22724 AS prev_year#22317, d_year#22393 AS year#22318, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22650L AS prev_yr_cnt#22319L, sales_cnt#22329L AS curr_yr_cnt#22320L, (sales_cnt#22329L - sales_cnt#22650L) AS sales_cnt_diff#22321L, (sales_amt#22330 - sales_amt#22651) AS sales_amt_diff#22322]
      +- SortMergeJoin [i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378], [i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709], Inner, (CheckOverflow((promote_precision(cast(sales_cnt#22329L as decimal(17,2))) / promote_precision(cast(sales_cnt#22650L as decimal(17,2)))), DecimalType(37,20), true) < 0.90000000000000000000)
         :- Sort [i_brand_id#22372 ASC NULLS FIRST, i_class_id#22374 ASC NULLS FIRST, i_category_id#22376 ASC NULLS FIRST, i_manufact_id#22378 ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, 3000), ENSURE_REQUIREMENTS, [id=#23682]
         :     +- HashAggregate(keys=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378], functions=[sum(sales_cnt#22323), sum(sales_amt#22324)], output=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22329L, sales_amt#22330])
         :        +- Exchange hashpartitioning(d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, 3000), ENSURE_REQUIREMENTS, [id=#23624]
         :           +- HashAggregate(keys=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378], functions=[partial_sum(sales_cnt#22323), partial_sum(sales_amt#22324)], output=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sum#22984L, sum#22985])
         :              +- HashAggregate(keys=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324], functions=[], output=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324])
         :                 +- Exchange hashpartitioning(d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324, 3000), ENSURE_REQUIREMENTS, [id=#23620]
         :                    +- HashAggregate(keys=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, knownfloatingpointnormalized(normalizenanandzero(sales_amt#22324)) AS sales_amt#22324], functions=[], output=[d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, sales_cnt#22323, sales_amt#22324])
         :                       +- Union
         :                          :- Project [d_year#22393, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, (cs_quantity#22348 - coalesce(cr_return_quantity#22431, 0)) AS sales_cnt#22323, (cs_ext_sales_price#22353 - coalesce(cr_return_amount#22432, 0.0)) AS sales_amt#22324]
         :                          :  +- SortMergeJoin [cs_order_number#22347L, cs_item_sk#22345L], [cr_order_number#22430L, cr_item_sk#22416L], LeftOuter
         :                          :     :- Sort [cs_order_number#22347L ASC NULLS FIRST, cs_item_sk#22345L ASC NULLS FIRST], false, 0
         :                          :     :  +- Exchange hashpartitioning(cs_order_number#22347L, cs_item_sk#22345L, 3000), ENSURE_REQUIREMENTS, [id=#23581]
         :                          :     :     +- Project [cs_item_sk#22345L, cs_order_number#22347L, cs_quantity#22348, cs_ext_sales_price#22353, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378, d_year#22393]
         :                          :     :        +- BroadcastHashJoin [cs_sold_date_sk#22364L], [d_date_sk#22387L], Inner, BuildRight, false
         :                          :     :           :- Project [cs_item_sk#22345L, cs_order_number#22347L, cs_quantity#22348, cs_ext_sales_price#22353, cs_sold_date_sk#22364L, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378]
         :                          :     :           :  +- BroadcastHashJoin [cs_item_sk#22345L], [i_item_sk#22365L], Inner, BuildRight, false
         :                          :     :           :     :- Filter isnotnull(cs_item_sk#22345L)
         :                          :     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#22345L,cs_order_number#22347L,cs_quantity#22348,cs_ext_sales_price#22353,cs_sold_date_sk#22364L] Batched: true, DataFilters: [isnotnull(cs_item_sk#22345L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#22364L), dynamicpruningexpression(cs_sold_date_sk#22364L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_order_number:bigint,cs_quantity:int,cs_ext_sales_price:double>
         :                          :     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22976, 0, true, Project [d_date_sk#22387L, d_year#22393], [d_date_sk#22387L]
         :                          :     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                          :     :           :     :              +- Filter ((isnotnull(d_year#22393) AND (d_year#22393 = 2002)) AND isnotnull(d_date_sk#22387L))
         :                          :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22387L,d_year#22393] Batched: true, DataFilters: [isnotnull(d_year#22393), (d_year#22393 = 2002), isnotnull(d_date_sk#22387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                          :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23572]
         :                          :     :           :        +- Project [i_item_sk#22365L, i_brand_id#22372, i_class_id#22374, i_category_id#22376, i_manufact_id#22378]
         :                          :     :           :           +- Filter ((((((isnotnull(i_category#22377) AND (i_category#22377 = Sports)) AND isnotnull(i_item_sk#22365L)) AND isnotnull(i_brand_id#22372)) AND isnotnull(i_class_id#22374)) AND isnotnull(i_category_id#22376)) AND isnotnull(i_manufact_id#22378))
         :                          :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22365L,i_brand_id#22372,i_class_id#22374,i_category_id#22376,i_category#22377,i_manufact_id#22378] Batched: true, DataFilters: [isnotnull(i_category#22377), (i_category#22377 = Sports), isnotnull(i_item_sk#22365L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
         :                          :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23576]
         :                          :     :              +- Filter ((isnotnull(d_year#22393) AND (d_year#22393 = 2002)) AND isnotnull(d_date_sk#22387L))
         :                          :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22387L,d_year#22393] Batched: true, DataFilters: [isnotnull(d_year#22393), (d_year#22393 = 2002), isnotnull(d_date_sk#22387L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                          :     +- Sort [cr_order_number#22430L ASC NULLS FIRST, cr_item_sk#22416L ASC NULLS FIRST], false, 0
         :                          :        +- Exchange hashpartitioning(cr_order_number#22430L, cr_item_sk#22416L, 3000), ENSURE_REQUIREMENTS, [id=#23582]
         :                          :           +- Project [cr_item_sk#22416L, cr_order_number#22430L, cr_return_quantity#22431, cr_return_amount#22432]
         :                          :              +- Filter (isnotnull(cr_order_number#22430L) AND isnotnull(cr_item_sk#22416L))
         :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#22416L,cr_order_number#22430L,cr_return_quantity#22431,cr_return_amount#22432,cr_returned_date_sk#22441L] Batched: true, DataFilters: [isnotnull(cr_order_number#22430L), isnotnull(cr_item_sk#22416L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:double>
         :                          :- Project [d_year#22493, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478, (ss_quantity#22451 - coalesce(sr_return_quantity#22524, 0)) AS sales_cnt#22325, (ss_ext_sales_price#22456 - coalesce(sr_return_amt#22525, 0.0)) AS sales_amt#22326]
         :                          :  +- SortMergeJoin [ss_ticket_number#22450L, ss_item_sk#22443L], [sr_ticket_number#22523L, sr_item_sk#22516L], LeftOuter
         :                          :     :- Sort [ss_ticket_number#22450L ASC NULLS FIRST, ss_item_sk#22443L ASC NULLS FIRST], false, 0
         :                          :     :  +- Exchange hashpartitioning(ss_ticket_number#22450L, ss_item_sk#22443L, 3000), ENSURE_REQUIREMENTS, [id=#23596]
         :                          :     :     +- Project [ss_item_sk#22443L, ss_ticket_number#22450L, ss_quantity#22451, ss_ext_sales_price#22456, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478, d_year#22493]
         :                          :     :        +- BroadcastHashJoin [ss_sold_date_sk#22464L], [d_date_sk#22487L], Inner, BuildRight, false
         :                          :     :           :- Project [ss_item_sk#22443L, ss_ticket_number#22450L, ss_quantity#22451, ss_ext_sales_price#22456, ss_sold_date_sk#22464L, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478]
         :                          :     :           :  +- BroadcastHashJoin [ss_item_sk#22443L], [i_item_sk#22465L], Inner, BuildRight, false
         :                          :     :           :     :- Filter isnotnull(ss_item_sk#22443L)
         :                          :     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#22443L,ss_ticket_number#22450L,ss_quantity#22451,ss_ext_sales_price#22456,ss_sold_date_sk#22464L] Batched: true, DataFilters: [isnotnull(ss_item_sk#22443L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#22464L), dynamicpruningexpression(ss_sold_date_sk#22464L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ticket_number:bigint,ss_quantity:int,ss_ext_sales_price:double>
         :                          :     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22977, 0, true, Project [d_date_sk#22487L, d_year#22493], [d_date_sk#22487L]
         :                          :     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                          :     :           :     :              +- Filter ((isnotnull(d_year#22493) AND (d_year#22493 = 2002)) AND isnotnull(d_date_sk#22487L))
         :                          :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22487L,d_year#22493] Batched: true, DataFilters: [isnotnull(d_year#22493), (d_year#22493 = 2002), isnotnull(d_date_sk#22487L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                          :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23587]
         :                          :     :           :        +- Project [i_item_sk#22465L, i_brand_id#22472, i_class_id#22474, i_category_id#22476, i_manufact_id#22478]
         :                          :     :           :           +- Filter ((((((isnotnull(i_category#22477) AND (i_category#22477 = Sports)) AND isnotnull(i_item_sk#22465L)) AND isnotnull(i_brand_id#22472)) AND isnotnull(i_class_id#22474)) AND isnotnull(i_category_id#22476)) AND isnotnull(i_manufact_id#22478))
         :                          :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22465L,i_brand_id#22472,i_class_id#22474,i_category_id#22476,i_category#22477,i_manufact_id#22478] Batched: true, DataFilters: [isnotnull(i_category#22477), (i_category#22477 = Sports), isnotnull(i_item_sk#22465L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
         :                          :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23591]
         :                          :     :              +- Filter ((isnotnull(d_year#22493) AND (d_year#22493 = 2002)) AND isnotnull(d_date_sk#22487L))
         :                          :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22487L,d_year#22493] Batched: true, DataFilters: [isnotnull(d_year#22493), (d_year#22493 = 2002), isnotnull(d_date_sk#22487L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                          :     +- Sort [sr_ticket_number#22523L ASC NULLS FIRST, sr_item_sk#22516L ASC NULLS FIRST], false, 0
         :                          :        +- Exchange hashpartitioning(sr_ticket_number#22523L, sr_item_sk#22516L, 3000), ENSURE_REQUIREMENTS, [id=#23597]
         :                          :           +- Project [sr_item_sk#22516L, sr_ticket_number#22523L, sr_return_quantity#22524, sr_return_amt#22525]
         :                          :              +- Filter (isnotnull(sr_ticket_number#22523L) AND isnotnull(sr_item_sk#22516L))
         :                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#22516L,sr_ticket_number#22523L,sr_return_quantity#22524,sr_return_amt#22525,sr_returned_date_sk#22534L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#22523L), isnotnull(sr_item_sk#22516L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:double>
         :                          +- Project [d_year#22597, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582, (ws_quantity#22552 - coalesce(wr_return_quantity#22632, 0)) AS sales_cnt#22327, (ws_ext_sales_price#22557 - coalesce(wr_return_amt#22633, 0.0)) AS sales_amt#22328]
         :                             +- SortMergeJoin [ws_order_number#22551L, ws_item_sk#22537L], [wr_order_number#22631L, wr_item_sk#22620L], LeftOuter
         :                                :- Sort [ws_order_number#22551L ASC NULLS FIRST, ws_item_sk#22537L ASC NULLS FIRST], false, 0
         :                                :  +- Exchange hashpartitioning(ws_order_number#22551L, ws_item_sk#22537L, 3000), ENSURE_REQUIREMENTS, [id=#23611]
         :                                :     +- Project [ws_item_sk#22537L, ws_order_number#22551L, ws_quantity#22552, ws_ext_sales_price#22557, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582, d_year#22597]
         :                                :        +- BroadcastHashJoin [ws_sold_date_sk#22568L], [d_date_sk#22591L], Inner, BuildRight, false
         :                                :           :- Project [ws_item_sk#22537L, ws_order_number#22551L, ws_quantity#22552, ws_ext_sales_price#22557, ws_sold_date_sk#22568L, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582]
         :                                :           :  +- BroadcastHashJoin [ws_item_sk#22537L], [i_item_sk#22569L], Inner, BuildRight, false
         :                                :           :     :- Filter isnotnull(ws_item_sk#22537L)
         :                                :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#22537L,ws_order_number#22551L,ws_quantity#22552,ws_ext_sales_price#22557,ws_sold_date_sk#22568L] Batched: true, DataFilters: [isnotnull(ws_item_sk#22537L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#22568L), dynamicpruningexpression(ws_sold_date_sk#22568L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_order_number:bigint,ws_quantity:int,ws_ext_sales_price:double>
         :                                :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22978, 0, true, Project [d_date_sk#22591L, d_year#22597], [d_date_sk#22591L]
         :                                :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                                :           :     :              +- Filter ((isnotnull(d_year#22597) AND (d_year#22597 = 2002)) AND isnotnull(d_date_sk#22591L))
         :                                :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22591L,d_year#22597] Batched: true, DataFilters: [isnotnull(d_year#22597), (d_year#22597 = 2002), isnotnull(d_date_sk#22591L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23602]
         :                                :           :        +- Project [i_item_sk#22569L, i_brand_id#22576, i_class_id#22578, i_category_id#22580, i_manufact_id#22582]
         :                                :           :           +- Filter ((((((isnotnull(i_category#22581) AND (i_category#22581 = Sports)) AND isnotnull(i_item_sk#22569L)) AND isnotnull(i_brand_id#22576)) AND isnotnull(i_class_id#22578)) AND isnotnull(i_category_id#22580)) AND isnotnull(i_manufact_id#22582))
         :                                :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22569L,i_brand_id#22576,i_class_id#22578,i_category_id#22580,i_category#22581,i_manufact_id#22582] Batched: true, DataFilters: [isnotnull(i_category#22581), (i_category#22581 = Sports), isnotnull(i_item_sk#22569L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
         :                                :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23606]
         :                                :              +- Filter ((isnotnull(d_year#22597) AND (d_year#22597 = 2002)) AND isnotnull(d_date_sk#22591L))
         :                                :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22591L,d_year#22597] Batched: true, DataFilters: [isnotnull(d_year#22597), (d_year#22597 = 2002), isnotnull(d_date_sk#22591L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                                +- Sort [wr_order_number#22631L ASC NULLS FIRST, wr_item_sk#22620L ASC NULLS FIRST], false, 0
         :                                   +- Exchange hashpartitioning(wr_order_number#22631L, wr_item_sk#22620L, 3000), ENSURE_REQUIREMENTS, [id=#23612]
         :                                      +- Project [wr_item_sk#22620L, wr_order_number#22631L, wr_return_quantity#22632, wr_return_amt#22633]
         :                                         +- Filter (isnotnull(wr_order_number#22631L) AND isnotnull(wr_item_sk#22620L))
         :                                            +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#22620L,wr_order_number#22631L,wr_return_quantity#22632,wr_return_amt#22633,wr_returned_date_sk#22642L] Batched: true, DataFilters: [isnotnull(wr_order_number#22631L), isnotnull(wr_item_sk#22620L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_order_number), IsNotNull(wr_item_sk)], ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:double>
         +- Sort [i_brand_id#22703 ASC NULLS FIRST, i_class_id#22705 ASC NULLS FIRST, i_category_id#22707 ASC NULLS FIRST, i_manufact_id#22709 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, 3000), ENSURE_REQUIREMENTS, [id=#23683]
               +- HashAggregate(keys=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709], functions=[sum(sales_cnt#22323), sum(sales_amt#22324)], output=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22650L, sales_amt#22651])
                  +- Exchange hashpartitioning(d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, 3000), ENSURE_REQUIREMENTS, [id=#23678]
                     +- HashAggregate(keys=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709], functions=[partial_sum(sales_cnt#22323), partial_sum(sales_amt#22324)], output=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sum#22984L, sum#22985])
                        +- HashAggregate(keys=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324], functions=[], output=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324])
                           +- Exchange hashpartitioning(d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324, 3000), ENSURE_REQUIREMENTS, [id=#23674]
                              +- HashAggregate(keys=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, knownfloatingpointnormalized(normalizenanandzero(sales_amt#22324)) AS sales_amt#22324], functions=[], output=[d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, sales_cnt#22323, sales_amt#22324])
                                 +- Union
                                    :- Project [d_year#22724, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, (cs_quantity#22679 - coalesce(cr_return_quantity#22762, 0)) AS sales_cnt#22323, (cs_ext_sales_price#22684 - coalesce(cr_return_amount#22763, 0.0)) AS sales_amt#22324]
                                    :  +- SortMergeJoin [cs_order_number#22678L, cs_item_sk#22676L], [cr_order_number#22761L, cr_item_sk#22747L], LeftOuter
                                    :     :- Sort [cs_order_number#22678L ASC NULLS FIRST, cs_item_sk#22676L ASC NULLS FIRST], false, 0
                                    :     :  +- Exchange hashpartitioning(cs_order_number#22678L, cs_item_sk#22676L, 3000), ENSURE_REQUIREMENTS, [id=#23635]
                                    :     :     +- Project [cs_item_sk#22676L, cs_order_number#22678L, cs_quantity#22679, cs_ext_sales_price#22684, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709, d_year#22724]
                                    :     :        +- BroadcastHashJoin [cs_sold_date_sk#22695L], [d_date_sk#22718L], Inner, BuildRight, false
                                    :     :           :- Project [cs_item_sk#22676L, cs_order_number#22678L, cs_quantity#22679, cs_ext_sales_price#22684, cs_sold_date_sk#22695L, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709]
                                    :     :           :  +- BroadcastHashJoin [cs_item_sk#22676L], [i_item_sk#22696L], Inner, BuildRight, false
                                    :     :           :     :- Filter isnotnull(cs_item_sk#22676L)
                                    :     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_item_sk#22676L,cs_order_number#22678L,cs_quantity#22679,cs_ext_sales_price#22684,cs_sold_date_sk#22695L] Batched: true, DataFilters: [isnotnull(cs_item_sk#22676L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#22695L), dynamicpruningexpression(cs_sold_date_sk#22695L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:bigint,cs_order_number:bigint,cs_quantity:int,cs_ext_sales_price:double>
                                    :     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22979, 0, true, Project [d_date_sk#22718L, d_year#22724], [d_date_sk#22718L]
                                    :     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                    :     :           :     :              +- Filter ((isnotnull(d_year#22724) AND (d_year#22724 = 2001)) AND isnotnull(d_date_sk#22718L))
                                    :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22718L,d_year#22724] Batched: true, DataFilters: [isnotnull(d_year#22724), (d_year#22724 = 2001), isnotnull(d_date_sk#22718L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                    :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23626]
                                    :     :           :        +- Project [i_item_sk#22696L, i_brand_id#22703, i_class_id#22705, i_category_id#22707, i_manufact_id#22709]
                                    :     :           :           +- Filter ((((((isnotnull(i_category#22708) AND (i_category#22708 = Sports)) AND isnotnull(i_item_sk#22696L)) AND isnotnull(i_brand_id#22703)) AND isnotnull(i_class_id#22705)) AND isnotnull(i_category_id#22707)) AND isnotnull(i_manufact_id#22709))
                                    :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22696L,i_brand_id#22703,i_class_id#22705,i_category_id#22707,i_category#22708,i_manufact_id#22709] Batched: true, DataFilters: [isnotnull(i_category#22708), (i_category#22708 = Sports), isnotnull(i_item_sk#22696L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
                                    :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23630]
                                    :     :              +- Filter ((isnotnull(d_year#22724) AND (d_year#22724 = 2001)) AND isnotnull(d_date_sk#22718L))
                                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22718L,d_year#22724] Batched: true, DataFilters: [isnotnull(d_year#22724), (d_year#22724 = 2001), isnotnull(d_date_sk#22718L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                    :     +- Sort [cr_order_number#22761L ASC NULLS FIRST, cr_item_sk#22747L ASC NULLS FIRST], false, 0
                                    :        +- Exchange hashpartitioning(cr_order_number#22761L, cr_item_sk#22747L, 3000), ENSURE_REQUIREMENTS, [id=#23636]
                                    :           +- Project [cr_item_sk#22747L, cr_order_number#22761L, cr_return_quantity#22762, cr_return_amount#22763]
                                    :              +- Filter (isnotnull(cr_order_number#22761L) AND isnotnull(cr_item_sk#22747L))
                                    :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#22747L,cr_order_number#22761L,cr_return_quantity#22762,cr_return_amount#22763,cr_returned_date_sk#22772L] Batched: true, DataFilters: [isnotnull(cr_order_number#22761L), isnotnull(cr_item_sk#22747L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:double>
                                    :- Project [d_year#22824, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809, (ss_quantity#22782 - coalesce(sr_return_quantity#22855, 0)) AS sales_cnt#22325, (ss_ext_sales_price#22787 - coalesce(sr_return_amt#22856, 0.0)) AS sales_amt#22326]
                                    :  +- SortMergeJoin [ss_ticket_number#22781L, ss_item_sk#22774L], [sr_ticket_number#22854L, sr_item_sk#22847L], LeftOuter
                                    :     :- Sort [ss_ticket_number#22781L ASC NULLS FIRST, ss_item_sk#22774L ASC NULLS FIRST], false, 0
                                    :     :  +- Exchange hashpartitioning(ss_ticket_number#22781L, ss_item_sk#22774L, 3000), ENSURE_REQUIREMENTS, [id=#23650]
                                    :     :     +- Project [ss_item_sk#22774L, ss_ticket_number#22781L, ss_quantity#22782, ss_ext_sales_price#22787, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809, d_year#22824]
                                    :     :        +- BroadcastHashJoin [ss_sold_date_sk#22795L], [d_date_sk#22818L], Inner, BuildRight, false
                                    :     :           :- Project [ss_item_sk#22774L, ss_ticket_number#22781L, ss_quantity#22782, ss_ext_sales_price#22787, ss_sold_date_sk#22795L, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809]
                                    :     :           :  +- BroadcastHashJoin [ss_item_sk#22774L], [i_item_sk#22796L], Inner, BuildRight, false
                                    :     :           :     :- Filter isnotnull(ss_item_sk#22774L)
                                    :     :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#22774L,ss_ticket_number#22781L,ss_quantity#22782,ss_ext_sales_price#22787,ss_sold_date_sk#22795L] Batched: true, DataFilters: [isnotnull(ss_item_sk#22774L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#22795L), dynamicpruningexpression(ss_sold_date_sk#22795L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ticket_number:bigint,ss_quantity:int,ss_ext_sales_price:double>
                                    :     :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22980, 0, true, Project [d_date_sk#22818L, d_year#22824], [d_date_sk#22818L]
                                    :     :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                    :     :           :     :              +- Filter ((isnotnull(d_year#22824) AND (d_year#22824 = 2001)) AND isnotnull(d_date_sk#22818L))
                                    :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22818L,d_year#22824] Batched: true, DataFilters: [isnotnull(d_year#22824), (d_year#22824 = 2001), isnotnull(d_date_sk#22818L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                    :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23641]
                                    :     :           :        +- Project [i_item_sk#22796L, i_brand_id#22803, i_class_id#22805, i_category_id#22807, i_manufact_id#22809]
                                    :     :           :           +- Filter ((((((isnotnull(i_category#22808) AND (i_category#22808 = Sports)) AND isnotnull(i_item_sk#22796L)) AND isnotnull(i_brand_id#22803)) AND isnotnull(i_class_id#22805)) AND isnotnull(i_category_id#22807)) AND isnotnull(i_manufact_id#22809))
                                    :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22796L,i_brand_id#22803,i_class_id#22805,i_category_id#22807,i_category#22808,i_manufact_id#22809] Batched: true, DataFilters: [isnotnull(i_category#22808), (i_category#22808 = Sports), isnotnull(i_item_sk#22796L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
                                    :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23645]
                                    :     :              +- Filter ((isnotnull(d_year#22824) AND (d_year#22824 = 2001)) AND isnotnull(d_date_sk#22818L))
                                    :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22818L,d_year#22824] Batched: true, DataFilters: [isnotnull(d_year#22824), (d_year#22824 = 2001), isnotnull(d_date_sk#22818L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                    :     +- Sort [sr_ticket_number#22854L ASC NULLS FIRST, sr_item_sk#22847L ASC NULLS FIRST], false, 0
                                    :        +- Exchange hashpartitioning(sr_ticket_number#22854L, sr_item_sk#22847L, 3000), ENSURE_REQUIREMENTS, [id=#23651]
                                    :           +- Project [sr_item_sk#22847L, sr_ticket_number#22854L, sr_return_quantity#22855, sr_return_amt#22856]
                                    :              +- Filter (isnotnull(sr_ticket_number#22854L) AND isnotnull(sr_item_sk#22847L))
                                    :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#22847L,sr_ticket_number#22854L,sr_return_quantity#22855,sr_return_amt#22856,sr_returned_date_sk#22865L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#22854L), isnotnull(sr_item_sk#22847L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:double>
                                    +- Project [d_year#22928, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913, (ws_quantity#22883 - coalesce(wr_return_quantity#22963, 0)) AS sales_cnt#22327, (ws_ext_sales_price#22888 - coalesce(wr_return_amt#22964, 0.0)) AS sales_amt#22328]
                                       +- SortMergeJoin [ws_order_number#22882L, ws_item_sk#22868L], [wr_order_number#22962L, wr_item_sk#22951L], LeftOuter
                                          :- Sort [ws_order_number#22882L ASC NULLS FIRST, ws_item_sk#22868L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(ws_order_number#22882L, ws_item_sk#22868L, 3000), ENSURE_REQUIREMENTS, [id=#23665]
                                          :     +- Project [ws_item_sk#22868L, ws_order_number#22882L, ws_quantity#22883, ws_ext_sales_price#22888, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913, d_year#22928]
                                          :        +- BroadcastHashJoin [ws_sold_date_sk#22899L], [d_date_sk#22922L], Inner, BuildRight, false
                                          :           :- Project [ws_item_sk#22868L, ws_order_number#22882L, ws_quantity#22883, ws_ext_sales_price#22888, ws_sold_date_sk#22899L, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913]
                                          :           :  +- BroadcastHashJoin [ws_item_sk#22868L], [i_item_sk#22900L], Inner, BuildRight, false
                                          :           :     :- Filter isnotnull(ws_item_sk#22868L)
                                          :           :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#22868L,ws_order_number#22882L,ws_quantity#22883,ws_ext_sales_price#22888,ws_sold_date_sk#22899L] Batched: true, DataFilters: [isnotnull(ws_item_sk#22868L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#22899L), dynamicpruningexpression(ws_sold_date_sk#22899L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_order_number:bigint,ws_quantity:int,ws_ext_sales_price:double>
                                          :           :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#22981, 0, true, Project [d_date_sk#22922L, d_year#22928], [d_date_sk#22922L]
                                          :           :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :           :     :              +- Filter ((isnotnull(d_year#22928) AND (d_year#22928 = 2001)) AND isnotnull(d_date_sk#22922L))
                                          :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22922L,d_year#22928] Batched: true, DataFilters: [isnotnull(d_year#22928), (d_year#22928 = 2001), isnotnull(d_date_sk#22922L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                          :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#23656]
                                          :           :        +- Project [i_item_sk#22900L, i_brand_id#22907, i_class_id#22909, i_category_id#22911, i_manufact_id#22913]
                                          :           :           +- Filter ((((((isnotnull(i_category#22912) AND (i_category#22912 = Sports)) AND isnotnull(i_item_sk#22900L)) AND isnotnull(i_brand_id#22907)) AND isnotnull(i_class_id#22909)) AND isnotnull(i_category_id#22911)) AND isnotnull(i_manufact_id#22913))
                                          :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#22900L,i_brand_id#22907,i_class_id#22909,i_category_id#22911,i_category#22912,i_manufact_id#22913] Batched: true, DataFilters: [isnotnull(i_category#22912), (i_category#22912 = Sports), isnotnull(i_item_sk#22900L), isnotnull..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Sports), IsNotNull(i_item_sk), IsNotNull(i_brand_id), ..., ReadSchema: struct<i_item_sk:bigint,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manuf...
                                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23660]
                                          :              +- Filter ((isnotnull(d_year#22928) AND (d_year#22928 = 2001)) AND isnotnull(d_date_sk#22922L))
                                          :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#22922L,d_year#22928] Batched: true, DataFilters: [isnotnull(d_year#22928), (d_year#22928 = 2001), isnotnull(d_date_sk#22922L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                          +- Sort [wr_order_number#22962L ASC NULLS FIRST, wr_item_sk#22951L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(wr_order_number#22962L, wr_item_sk#22951L, 3000), ENSURE_REQUIREMENTS, [id=#23666]
                                                +- Project [wr_item_sk#22951L, wr_order_number#22962L, wr_return_quantity#22963, wr_return_amt#22964]
                                                   +- Filter (isnotnull(wr_order_number#22962L) AND isnotnull(wr_item_sk#22951L))
                                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#22951L,wr_order_number#22962L,wr_return_quantity#22963,wr_return_amt#22964,wr_returned_date_sk#22973L] Batched: true, DataFilters: [isnotnull(wr_order_number#22962L), isnotnull(wr_item_sk#22951L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_order_number), IsNotNull(wr_item_sk)], ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:double>

read query: spark_queries/q76.sql
explain query: q76
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['channel ASC NULLS FIRST, 'col_name ASC NULLS FIRST, 'd_year ASC NULLS FIRST, 'd_qoy ASC NULLS FIRST, 'i_category ASC NULLS FIRST], true
      +- 'Aggregate ['channel, 'col_name, 'd_year, 'd_qoy, 'i_category], ['channel, 'col_name, 'd_year, 'd_qoy, 'i_category, 'COUNT(1) AS sales_cnt#22995, 'SUM('ext_sales_price) AS sales_amt#22996]
         +- 'SubqueryAlias foo
            +- 'Union false, false
               :- 'Union false, false
               :  :- 'Project [store AS channel#22986, ss_addr_sk AS col_name#22987, 'd_year, 'd_qoy, 'i_category, 'ss_ext_sales_price AS ext_sales_price#22988]
               :  :  +- 'Filter ((isnull('ss_addr_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('ss_item_sk = 'i_item_sk))
               :  :     +- 'Join Inner
               :  :        :- 'Join Inner
               :  :        :  :- 'UnresolvedRelation [store_sales], [], false
               :  :        :  +- 'UnresolvedRelation [item], [], false
               :  :        +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'Project [web AS channel#22989, ws_web_page_sk AS col_name#22990, 'd_year, 'd_qoy, 'i_category, 'ws_ext_sales_price AS ext_sales_price#22991]
               :     +- 'Filter ((isnull('ws_web_page_sk) AND ('ws_sold_date_sk = 'd_date_sk)) AND ('ws_item_sk = 'i_item_sk))
               :        +- 'Join Inner
               :           :- 'Join Inner
               :           :  :- 'UnresolvedRelation [web_sales], [], false
               :           :  +- 'UnresolvedRelation [item], [], false
               :           +- 'UnresolvedRelation [date_dim], [], false
               +- 'Project [catalog AS channel#22992, cs_warehouse_sk AS col_name#22993, 'd_year, 'd_qoy, 'i_category, 'cs_ext_sales_price AS ext_sales_price#22994]
                  +- 'Filter ((isnull('cs_warehouse_sk) AND ('cs_sold_date_sk = 'd_date_sk)) AND ('cs_item_sk = 'i_item_sk))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'UnresolvedRelation [catalog_sales], [], false
                        :  +- 'UnresolvedRelation [item], [], false
                        +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
channel: string, col_name: string, d_year: int, d_qoy: int, i_category: string, sales_cnt: bigint, sales_amt: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#22986 ASC NULLS FIRST, col_name#22987 ASC NULLS FIRST, d_year#23049 ASC NULLS FIRST, d_qoy#23053 ASC NULLS FIRST, i_category#23033 ASC NULLS FIRST], true
      +- Aggregate [channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033], [channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, count(1) AS sales_cnt#22995L, sum(ext_sales_price#22988) AS sales_amt#22996]
         +- SubqueryAlias foo
            +- Union false, false
               :- Union false, false
               :  :- Project [store AS channel#22986, ss_addr_sk AS col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, ss_ext_sales_price#23012 AS ext_sales_price#22988]
               :  :  +- Filter ((isnull(ss_addr_sk#23003L) AND (ss_sold_date_sk#23020L = d_date_sk#23043L)) AND (ss_item_sk#22999L = i_item_sk#23021L))
               :  :     +- Join Inner
               :  :        :- Join Inner
               :  :        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#22998L,ss_item_sk#22999L,ss_customer_sk#23000L,ss_cdemo_sk#23001L,ss_hdemo_sk#23002L,ss_addr_sk#23003L,ss_store_sk#23004L,ss_promo_sk#23005L,ss_ticket_number#23006L,ss_quantity#23007,ss_wholesale_cost#23008,ss_list_price#23009,ss_sales_price#23010,ss_ext_discount_amt#23011,ss_ext_sales_price#23012,ss_ext_wholesale_cost#23013,ss_ext_list_price#23014,ss_ext_tax#23015,ss_coupon_amt#23016,ss_net_paid#23017,ss_net_paid_inc_tax#23018,ss_net_profit#23019,ss_sold_date_sk#23020L] orc
               :  :        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23021L,i_item_id#23022,i_rec_start_date#23023,i_rec_end_date#23024,i_item_desc#23025,i_current_price#23026,i_wholesale_cost#23027,i_brand_id#23028,i_brand#23029,i_class_id#23030,i_class#23031,i_category_id#23032,i_category#23033,i_manufact_id#23034,i_manufact#23035,i_size#23036,i_formulation#23037,i_color#23038,i_units#23039,i_container#23040,i_manager_id#23041,i_product_name#23042] orc
               :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23043L,d_date_id#23044,d_date#23045,d_month_seq#23046,d_week_seq#23047,d_quarter_seq#23048,d_year#23049,d_dow#23050,d_moy#23051,d_dom#23052,d_qoy#23053,d_fy_year#23054,d_fy_quarter_seq#23055,d_fy_week_seq#23056,d_day_name#23057,d_quarter_name#23058,d_holiday#23059,d_weekend#23060,d_following_holiday#23061,d_first_dom#23062,d_last_dom#23063,d_same_day_ly#23064,d_same_day_lq#23065,d_current_day#23066,... 4 more fields] orc
               :  +- Project [web AS channel#22989, ws_web_page_sk AS col_name#22990, d_year#23133, d_qoy#23137, i_category#23117, ws_ext_sales_price#23093 AS ext_sales_price#22991]
               :     +- Filter ((isnull(ws_web_page_sk#23082L) AND (ws_sold_date_sk#23104L = d_date_sk#23127L)) AND (ws_item_sk#23073L = i_item_sk#23105L))
               :        +- Join Inner
               :           :- Join Inner
               :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23071L,ws_ship_date_sk#23072L,ws_item_sk#23073L,ws_bill_customer_sk#23074L,ws_bill_cdemo_sk#23075L,ws_bill_hdemo_sk#23076L,ws_bill_addr_sk#23077L,ws_ship_customer_sk#23078L,ws_ship_cdemo_sk#23079L,ws_ship_hdemo_sk#23080L,ws_ship_addr_sk#23081L,ws_web_page_sk#23082L,ws_web_site_sk#23083L,ws_ship_mode_sk#23084L,ws_warehouse_sk#23085L,ws_promo_sk#23086L,ws_order_number#23087L,ws_quantity#23088,ws_wholesale_cost#23089,ws_list_price#23090,ws_sales_price#23091,ws_ext_discount_amt#23092,ws_ext_sales_price#23093,ws_ext_wholesale_cost#23094,... 10 more fields] orc
               :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23105L,i_item_id#23106,i_rec_start_date#23107,i_rec_end_date#23108,i_item_desc#23109,i_current_price#23110,i_wholesale_cost#23111,i_brand_id#23112,i_brand#23113,i_class_id#23114,i_class#23115,i_category_id#23116,i_category#23117,i_manufact_id#23118,i_manufact#23119,i_size#23120,i_formulation#23121,i_color#23122,i_units#23123,i_container#23124,i_manager_id#23125,i_product_name#23126] orc
               :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23127L,d_date_id#23128,d_date#23129,d_month_seq#23130,d_week_seq#23131,d_quarter_seq#23132,d_year#23133,d_dow#23134,d_moy#23135,d_dom#23136,d_qoy#23137,d_fy_year#23138,d_fy_quarter_seq#23139,d_fy_week_seq#23140,d_day_name#23141,d_quarter_name#23142,d_holiday#23143,d_weekend#23144,d_following_holiday#23145,d_first_dom#23146,d_last_dom#23147,d_same_day_ly#23148,d_same_day_lq#23149,d_current_day#23150,... 4 more fields] orc
               +- Project [catalog AS channel#22992, cs_warehouse_sk AS col_name#22993, d_year#23217, d_qoy#23221, i_category#23201, cs_ext_sales_price#23177 AS ext_sales_price#22994]
                  +- Filter ((isnull(cs_warehouse_sk#23168L) AND (cs_sold_date_sk#23188L = d_date_sk#23211L)) AND (cs_item_sk#23169L = i_item_sk#23189L))
                     +- Join Inner
                        :- Join Inner
                        :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
                        :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23155L,cs_ship_date_sk#23156L,cs_bill_customer_sk#23157L,cs_bill_cdemo_sk#23158L,cs_bill_hdemo_sk#23159L,cs_bill_addr_sk#23160L,cs_ship_customer_sk#23161L,cs_ship_cdemo_sk#23162L,cs_ship_hdemo_sk#23163L,cs_ship_addr_sk#23164L,cs_call_center_sk#23165L,cs_catalog_page_sk#23166L,cs_ship_mode_sk#23167L,cs_warehouse_sk#23168L,cs_item_sk#23169L,cs_promo_sk#23170L,cs_order_number#23171L,cs_quantity#23172,cs_wholesale_cost#23173,cs_list_price#23174,cs_sales_price#23175,cs_ext_discount_amt#23176,cs_ext_sales_price#23177,cs_ext_wholesale_cost#23178,... 10 more fields] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23189L,i_item_id#23190,i_rec_start_date#23191,i_rec_end_date#23192,i_item_desc#23193,i_current_price#23194,i_wholesale_cost#23195,i_brand_id#23196,i_brand#23197,i_class_id#23198,i_class#23199,i_category_id#23200,i_category#23201,i_manufact_id#23202,i_manufact#23203,i_size#23204,i_formulation#23205,i_color#23206,i_units#23207,i_container#23208,i_manager_id#23209,i_product_name#23210] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23211L,d_date_id#23212,d_date#23213,d_month_seq#23214,d_week_seq#23215,d_quarter_seq#23216,d_year#23217,d_dow#23218,d_moy#23219,d_dom#23220,d_qoy#23221,d_fy_year#23222,d_fy_quarter_seq#23223,d_fy_week_seq#23224,d_day_name#23225,d_quarter_name#23226,d_holiday#23227,d_weekend#23228,d_following_holiday#23229,d_first_dom#23230,d_last_dom#23231,d_same_day_ly#23232,d_same_day_lq#23233,d_current_day#23234,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#22986 ASC NULLS FIRST, col_name#22987 ASC NULLS FIRST, d_year#23049 ASC NULLS FIRST, d_qoy#23053 ASC NULLS FIRST, i_category#23033 ASC NULLS FIRST], true
      +- Aggregate [channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033], [channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, count(1) AS sales_cnt#22995L, sum(ext_sales_price#22988) AS sales_amt#22996]
         +- Union false, false
            :- Project [store AS channel#22986, ss_addr_sk AS col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, ss_ext_sales_price#23012 AS ext_sales_price#22988]
            :  +- Join Inner, (ss_item_sk#22999L = i_item_sk#23021L)
            :     :- Project [ss_item_sk#22999L, ss_ext_sales_price#23012, d_year#23049, d_qoy#23053]
            :     :  +- Join Inner, (ss_sold_date_sk#23020L = d_date_sk#23043L)
            :     :     :- Project [ss_item_sk#22999L, ss_ext_sales_price#23012, ss_sold_date_sk#23020L]
            :     :     :  +- Filter ((isnull(ss_addr_sk#23003L) AND isnotnull(ss_item_sk#22999L)) AND isnotnull(ss_sold_date_sk#23020L))
            :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#22998L,ss_item_sk#22999L,ss_customer_sk#23000L,ss_cdemo_sk#23001L,ss_hdemo_sk#23002L,ss_addr_sk#23003L,ss_store_sk#23004L,ss_promo_sk#23005L,ss_ticket_number#23006L,ss_quantity#23007,ss_wholesale_cost#23008,ss_list_price#23009,ss_sales_price#23010,ss_ext_discount_amt#23011,ss_ext_sales_price#23012,ss_ext_wholesale_cost#23013,ss_ext_list_price#23014,ss_ext_tax#23015,ss_coupon_amt#23016,ss_net_paid#23017,ss_net_paid_inc_tax#23018,ss_net_profit#23019,ss_sold_date_sk#23020L] orc
            :     :     +- Project [d_date_sk#23043L, d_year#23049, d_qoy#23053]
            :     :        +- Filter isnotnull(d_date_sk#23043L)
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23043L,d_date_id#23044,d_date#23045,d_month_seq#23046,d_week_seq#23047,d_quarter_seq#23048,d_year#23049,d_dow#23050,d_moy#23051,d_dom#23052,d_qoy#23053,d_fy_year#23054,d_fy_quarter_seq#23055,d_fy_week_seq#23056,d_day_name#23057,d_quarter_name#23058,d_holiday#23059,d_weekend#23060,d_following_holiday#23061,d_first_dom#23062,d_last_dom#23063,d_same_day_ly#23064,d_same_day_lq#23065,d_current_day#23066,... 4 more fields] orc
            :     +- Project [i_item_sk#23021L, i_category#23033]
            :        +- Filter isnotnull(i_item_sk#23021L)
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23021L,i_item_id#23022,i_rec_start_date#23023,i_rec_end_date#23024,i_item_desc#23025,i_current_price#23026,i_wholesale_cost#23027,i_brand_id#23028,i_brand#23029,i_class_id#23030,i_class#23031,i_category_id#23032,i_category#23033,i_manufact_id#23034,i_manufact#23035,i_size#23036,i_formulation#23037,i_color#23038,i_units#23039,i_container#23040,i_manager_id#23041,i_product_name#23042] orc
            :- Project [web AS channel#22989, ws_web_page_sk AS col_name#22990, d_year#23133, d_qoy#23137, i_category#23117, ws_ext_sales_price#23093 AS ext_sales_price#22991]
            :  +- Join Inner, (ws_item_sk#23073L = i_item_sk#23105L)
            :     :- Project [ws_item_sk#23073L, ws_ext_sales_price#23093, d_year#23133, d_qoy#23137]
            :     :  +- Join Inner, (ws_sold_date_sk#23104L = d_date_sk#23127L)
            :     :     :- Project [ws_item_sk#23073L, ws_ext_sales_price#23093, ws_sold_date_sk#23104L]
            :     :     :  +- Filter ((isnull(ws_web_page_sk#23082L) AND isnotnull(ws_item_sk#23073L)) AND isnotnull(ws_sold_date_sk#23104L))
            :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23071L,ws_ship_date_sk#23072L,ws_item_sk#23073L,ws_bill_customer_sk#23074L,ws_bill_cdemo_sk#23075L,ws_bill_hdemo_sk#23076L,ws_bill_addr_sk#23077L,ws_ship_customer_sk#23078L,ws_ship_cdemo_sk#23079L,ws_ship_hdemo_sk#23080L,ws_ship_addr_sk#23081L,ws_web_page_sk#23082L,ws_web_site_sk#23083L,ws_ship_mode_sk#23084L,ws_warehouse_sk#23085L,ws_promo_sk#23086L,ws_order_number#23087L,ws_quantity#23088,ws_wholesale_cost#23089,ws_list_price#23090,ws_sales_price#23091,ws_ext_discount_amt#23092,ws_ext_sales_price#23093,ws_ext_wholesale_cost#23094,... 10 more fields] orc
            :     :     +- Project [d_date_sk#23127L, d_year#23133, d_qoy#23137]
            :     :        +- Filter isnotnull(d_date_sk#23127L)
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23127L,d_date_id#23128,d_date#23129,d_month_seq#23130,d_week_seq#23131,d_quarter_seq#23132,d_year#23133,d_dow#23134,d_moy#23135,d_dom#23136,d_qoy#23137,d_fy_year#23138,d_fy_quarter_seq#23139,d_fy_week_seq#23140,d_day_name#23141,d_quarter_name#23142,d_holiday#23143,d_weekend#23144,d_following_holiday#23145,d_first_dom#23146,d_last_dom#23147,d_same_day_ly#23148,d_same_day_lq#23149,d_current_day#23150,... 4 more fields] orc
            :     +- Project [i_item_sk#23105L, i_category#23117]
            :        +- Filter isnotnull(i_item_sk#23105L)
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23105L,i_item_id#23106,i_rec_start_date#23107,i_rec_end_date#23108,i_item_desc#23109,i_current_price#23110,i_wholesale_cost#23111,i_brand_id#23112,i_brand#23113,i_class_id#23114,i_class#23115,i_category_id#23116,i_category#23117,i_manufact_id#23118,i_manufact#23119,i_size#23120,i_formulation#23121,i_color#23122,i_units#23123,i_container#23124,i_manager_id#23125,i_product_name#23126] orc
            +- Project [catalog AS channel#22992, cs_warehouse_sk AS col_name#22993, d_year#23217, d_qoy#23221, i_category#23201, cs_ext_sales_price#23177 AS ext_sales_price#22994]
               +- Join Inner, (cs_item_sk#23169L = i_item_sk#23189L)
                  :- Project [cs_item_sk#23169L, cs_ext_sales_price#23177, d_year#23217, d_qoy#23221]
                  :  +- Join Inner, (cs_sold_date_sk#23188L = d_date_sk#23211L)
                  :     :- Project [cs_item_sk#23169L, cs_ext_sales_price#23177, cs_sold_date_sk#23188L]
                  :     :  +- Filter ((isnull(cs_warehouse_sk#23168L) AND isnotnull(cs_item_sk#23169L)) AND isnotnull(cs_sold_date_sk#23188L))
                  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23155L,cs_ship_date_sk#23156L,cs_bill_customer_sk#23157L,cs_bill_cdemo_sk#23158L,cs_bill_hdemo_sk#23159L,cs_bill_addr_sk#23160L,cs_ship_customer_sk#23161L,cs_ship_cdemo_sk#23162L,cs_ship_hdemo_sk#23163L,cs_ship_addr_sk#23164L,cs_call_center_sk#23165L,cs_catalog_page_sk#23166L,cs_ship_mode_sk#23167L,cs_warehouse_sk#23168L,cs_item_sk#23169L,cs_promo_sk#23170L,cs_order_number#23171L,cs_quantity#23172,cs_wholesale_cost#23173,cs_list_price#23174,cs_sales_price#23175,cs_ext_discount_amt#23176,cs_ext_sales_price#23177,cs_ext_wholesale_cost#23178,... 10 more fields] orc
                  :     +- Project [d_date_sk#23211L, d_year#23217, d_qoy#23221]
                  :        +- Filter isnotnull(d_date_sk#23211L)
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23211L,d_date_id#23212,d_date#23213,d_month_seq#23214,d_week_seq#23215,d_quarter_seq#23216,d_year#23217,d_dow#23218,d_moy#23219,d_dom#23220,d_qoy#23221,d_fy_year#23222,d_fy_quarter_seq#23223,d_fy_week_seq#23224,d_day_name#23225,d_quarter_name#23226,d_holiday#23227,d_weekend#23228,d_following_holiday#23229,d_first_dom#23230,d_last_dom#23231,d_same_day_ly#23232,d_same_day_lq#23233,d_current_day#23234,... 4 more fields] orc
                  +- Project [i_item_sk#23189L, i_category#23201]
                     +- Filter isnotnull(i_item_sk#23189L)
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23189L,i_item_id#23190,i_rec_start_date#23191,i_rec_end_date#23192,i_item_desc#23193,i_current_price#23194,i_wholesale_cost#23195,i_brand_id#23196,i_brand#23197,i_class_id#23198,i_class#23199,i_category_id#23200,i_category#23201,i_manufact_id#23202,i_manufact#23203,i_size#23204,i_formulation#23205,i_color#23206,i_units#23207,i_container#23208,i_manager_id#23209,i_product_name#23210] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#22986 ASC NULLS FIRST,col_name#22987 ASC NULLS FIRST,d_year#23049 ASC NULLS FIRST,d_qoy#23053 ASC NULLS FIRST,i_category#23033 ASC NULLS FIRST], output=[channel#22986,col_name#22987,d_year#23049,d_qoy#23053,i_category#23033,sales_cnt#22995L,sales_amt#22996])
   +- HashAggregate(keys=[channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033], functions=[count(1), sum(ext_sales_price#22988)], output=[channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, sales_cnt#22995L, sales_amt#22996])
      +- Exchange hashpartitioning(channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, 3000), ENSURE_REQUIREMENTS, [id=#23875]
         +- HashAggregate(keys=[channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033], functions=[partial_count(1), partial_sum(ext_sales_price#22988)], output=[channel#22986, col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, count#23249L, sum#23250])
            +- Union
               :- Project [store AS channel#22986, ss_addr_sk AS col_name#22987, d_year#23049, d_qoy#23053, i_category#23033, ss_ext_sales_price#23012 AS ext_sales_price#22988]
               :  +- SortMergeJoin [ss_item_sk#22999L], [i_item_sk#23021L], Inner
               :     :- Sort [ss_item_sk#22999L ASC NULLS FIRST], false, 0
               :     :  +- Exchange hashpartitioning(ss_item_sk#22999L, 3000), ENSURE_REQUIREMENTS, [id=#23844]
               :     :     +- Project [ss_item_sk#22999L, ss_ext_sales_price#23012, d_year#23049, d_qoy#23053]
               :     :        +- BroadcastHashJoin [ss_sold_date_sk#23020L], [d_date_sk#23043L], Inner, BuildRight, false
               :     :           :- Project [ss_item_sk#22999L, ss_ext_sales_price#23012, ss_sold_date_sk#23020L]
               :     :           :  +- Filter (isnull(ss_addr_sk#23003L) AND isnotnull(ss_item_sk#22999L))
               :     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#22999L,ss_addr_sk#23003L,ss_ext_sales_price#23012,ss_sold_date_sk#23020L] Batched: true, DataFilters: [isnull(ss_addr_sk#23003L), isnotnull(ss_item_sk#22999L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#23020L)], PushedFilters: [IsNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_addr_sk:bigint,ss_ext_sales_price:double>
               :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23839]
               :     :              +- Filter isnotnull(d_date_sk#23043L)
               :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23043L,d_year#23049,d_qoy#23053] Batched: true, DataFilters: [isnotnull(d_date_sk#23043L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
               :     +- Sort [i_item_sk#23021L ASC NULLS FIRST], false, 0
               :        +- Exchange hashpartitioning(i_item_sk#23021L, 3000), ENSURE_REQUIREMENTS, [id=#23845]
               :           +- Filter isnotnull(i_item_sk#23021L)
               :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23021L,i_category#23033] Batched: true, DataFilters: [isnotnull(i_item_sk#23021L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category:string>
               :- Project [web AS channel#22989, ws_web_page_sk AS col_name#22990, d_year#23133, d_qoy#23137, i_category#23117, ws_ext_sales_price#23093 AS ext_sales_price#22991]
               :  +- SortMergeJoin [ws_item_sk#23073L], [i_item_sk#23105L], Inner
               :     :- Sort [ws_item_sk#23073L ASC NULLS FIRST], false, 0
               :     :  +- Exchange hashpartitioning(ws_item_sk#23073L, 3000), ENSURE_REQUIREMENTS, [id=#23855]
               :     :     +- Project [ws_item_sk#23073L, ws_ext_sales_price#23093, d_year#23133, d_qoy#23137]
               :     :        +- BroadcastHashJoin [ws_sold_date_sk#23104L], [d_date_sk#23127L], Inner, BuildRight, false
               :     :           :- Project [ws_item_sk#23073L, ws_ext_sales_price#23093, ws_sold_date_sk#23104L]
               :     :           :  +- Filter (isnull(ws_web_page_sk#23082L) AND isnotnull(ws_item_sk#23073L))
               :     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#23073L,ws_web_page_sk#23082L,ws_ext_sales_price#23093,ws_sold_date_sk#23104L] Batched: true, DataFilters: [isnull(ws_web_page_sk#23082L), isnotnull(ws_item_sk#23073L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#23104L)], PushedFilters: [IsNull(ws_web_page_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_web_page_sk:bigint,ws_ext_sales_price:double>
               :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23850]
               :     :              +- Filter isnotnull(d_date_sk#23127L)
               :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23127L,d_year#23133,d_qoy#23137] Batched: true, DataFilters: [isnotnull(d_date_sk#23127L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
               :     +- Sort [i_item_sk#23105L ASC NULLS FIRST], false, 0
               :        +- Exchange hashpartitioning(i_item_sk#23105L, 3000), ENSURE_REQUIREMENTS, [id=#23856]
               :           +- Filter isnotnull(i_item_sk#23105L)
               :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23105L,i_category#23117] Batched: true, DataFilters: [isnotnull(i_item_sk#23105L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category:string>
               +- Project [catalog AS channel#22992, cs_warehouse_sk AS col_name#22993, d_year#23217, d_qoy#23221, i_category#23201, cs_ext_sales_price#23177 AS ext_sales_price#22994]
                  +- SortMergeJoin [cs_item_sk#23169L], [i_item_sk#23189L], Inner
                     :- Sort [cs_item_sk#23169L ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(cs_item_sk#23169L, 3000), ENSURE_REQUIREMENTS, [id=#23866]
                     :     +- Project [cs_item_sk#23169L, cs_ext_sales_price#23177, d_year#23217, d_qoy#23221]
                     :        +- BroadcastHashJoin [cs_sold_date_sk#23188L], [d_date_sk#23211L], Inner, BuildRight, false
                     :           :- Project [cs_item_sk#23169L, cs_ext_sales_price#23177, cs_sold_date_sk#23188L]
                     :           :  +- Filter (isnull(cs_warehouse_sk#23168L) AND isnotnull(cs_item_sk#23169L))
                     :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_warehouse_sk#23168L,cs_item_sk#23169L,cs_ext_sales_price#23177,cs_sold_date_sk#23188L] Batched: true, DataFilters: [isnull(cs_warehouse_sk#23168L), isnotnull(cs_item_sk#23169L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#23188L)], PushedFilters: [IsNull(cs_warehouse_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_warehouse_sk:bigint,cs_item_sk:bigint,cs_ext_sales_price:double>
                     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#23861]
                     :              +- Filter isnotnull(d_date_sk#23211L)
                     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23211L,d_year#23217,d_qoy#23221] Batched: true, DataFilters: [isnotnull(d_date_sk#23211L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_qoy:int>
                     +- Sort [i_item_sk#23189L ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_item_sk#23189L, 3000), ENSURE_REQUIREMENTS, [id=#23867]
                           +- Filter isnotnull(i_item_sk#23189L)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#23189L,i_category#23201] Batched: true, DataFilters: [isnotnull(i_item_sk#23189L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_category:string>

read query: spark_queries/q77.sql
explain query: q77
== Parsed Logical Plan ==
CTE [ss, sr, cs, cr, ws, wr]
:  :- 'SubqueryAlias ss
:  :  +- 'Aggregate ['s_store_sk], ['s_store_sk, 'sum('ss_ext_sales_price) AS sales#23265, 'sum('ss_net_profit) AS profit#23266]
:  :     +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND ('ss_store_sk = 's_store_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [store], [], false
:  :- 'SubqueryAlias sr
:  :  +- 'Aggregate ['s_store_sk], ['s_store_sk, 'sum('sr_return_amt) AS returns#23267, 'sum('sr_net_loss) AS profit_loss#23268]
:  :     +- 'Filter ((('sr_returned_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND ('sr_store_sk = 's_store_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_returns], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [store], [], false
:  :- 'SubqueryAlias cs
:  :  +- 'Aggregate ['cs_call_center_sk], ['cs_call_center_sk, 'sum('cs_ext_sales_price) AS sales#23269, 'sum('cs_net_profit) AS profit#23270]
:  :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY))))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [catalog_sales], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  :- 'SubqueryAlias cr
:  :  +- 'Project ['sum('cr_return_amount) AS returns#23271, 'sum('cr_net_loss) AS profit_loss#23272]
:  :     +- 'Filter (('cr_returned_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY))))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [catalog_returns], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  :- 'SubqueryAlias ws
:  :  +- 'Aggregate ['wp_web_page_sk], ['wp_web_page_sk, 'sum('ws_ext_sales_price) AS sales#23273, 'sum('ws_net_profit) AS profit#23274]
:  :     +- 'Filter ((('ws_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND ('ws_web_page_sk = 'wp_web_page_sk))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [web_sales], [], false
:  :           :  +- 'UnresolvedRelation [date_dim], [], false
:  :           +- 'UnresolvedRelation [web_page], [], false
:  +- 'SubqueryAlias wr
:     +- 'Aggregate ['wp_web_page_sk], ['wp_web_page_sk, 'sum('wr_return_amt) AS returns#23275, 'sum('wr_net_loss) AS profit_loss#23276]
:        +- 'Filter ((('wr_returned_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND ('wr_web_page_sk = 'wp_web_page_sk))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_returns], [], false
:              :  +- 'UnresolvedRelation [date_dim], [], false
:              +- 'UnresolvedRelation [web_page], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true
         +- 'Aggregate [rollup(Vector(0), Vector(1), 'channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#23262, 'sum('returns) AS returns#23263, 'sum('profit) AS profit#23264]
            +- 'SubqueryAlias x
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [store channel AS channel#23251, 'ss.s_store_sk AS id#23252, 'sales, 'coalesce('returns, 0) AS returns#23253, ('profit - 'coalesce('profit_loss, 0)) AS profit#23254]
                  :  :  +- 'Join LeftOuter, ('ss.s_store_sk = 'sr.s_store_sk)
                  :  :     :- 'UnresolvedRelation [ss], [], false
                  :  :     +- 'UnresolvedRelation [sr], [], false
                  :  +- 'Project [catalog channel AS channel#23255, 'cs_call_center_sk AS id#23256, 'sales, 'returns, ('profit - 'profit_loss) AS profit#23257]
                  :     +- 'Join Inner
                  :        :- 'UnresolvedRelation [cs], [], false
                  :        +- 'UnresolvedRelation [cr], [], false
                  +- 'Project [web channel AS channel#23258, 'ws.wp_web_page_sk AS id#23259, 'sales, 'coalesce('returns, 0) AS returns#23260, ('profit - 'coalesce('profit_loss, 0)) AS profit#23261]
                     +- 'Join LeftOuter, ('ws.wp_web_page_sk = 'wr.wp_web_page_sk)
                        :- 'UnresolvedRelation [ws], [], false
                        +- 'UnresolvedRelation [wr], [], false

== Analyzed Logical Plan ==
channel: string, id: bigint, sales: double, returns: double, profit: double
WithCTE
:- CTERelationDef 50
:  +- SubqueryAlias ss
:     +- Aggregate [s_store_sk#23328L], [s_store_sk#23328L, sum(ss_ext_sales_price#23291) AS sales#23265, sum(ss_net_profit#23298) AS profit#23266]
:        +- Filter (((ss_sold_date_sk#23299L = d_date_sk#23300L) AND ((d_date#23302 >= cast(1998-08-04 as date)) AND (d_date#23302 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND (ss_store_sk#23283L = s_store_sk#23328L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#23277L,ss_item_sk#23278L,ss_customer_sk#23279L,ss_cdemo_sk#23280L,ss_hdemo_sk#23281L,ss_addr_sk#23282L,ss_store_sk#23283L,ss_promo_sk#23284L,ss_ticket_number#23285L,ss_quantity#23286,ss_wholesale_cost#23287,ss_list_price#23288,ss_sales_price#23289,ss_ext_discount_amt#23290,ss_ext_sales_price#23291,ss_ext_wholesale_cost#23292,ss_ext_list_price#23293,ss_ext_tax#23294,ss_coupon_amt#23295,ss_net_paid#23296,ss_net_paid_inc_tax#23297,ss_net_profit#23298,ss_sold_date_sk#23299L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23300L,d_date_id#23301,d_date#23302,d_month_seq#23303,d_week_seq#23304,d_quarter_seq#23305,d_year#23306,d_dow#23307,d_moy#23308,d_dom#23309,d_qoy#23310,d_fy_year#23311,d_fy_quarter_seq#23312,d_fy_week_seq#23313,d_day_name#23314,d_quarter_name#23315,d_holiday#23316,d_weekend#23317,d_following_holiday#23318,d_first_dom#23319,d_last_dom#23320,d_same_day_ly#23321,d_same_day_lq#23322,d_current_day#23323,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23328L,s_store_id#23329,s_rec_start_date#23330,s_rec_end_date#23331,s_closed_date_sk#23332L,s_store_name#23333,s_number_employees#23334,s_floor_space#23335,s_hours#23336,s_manager#23337,s_market_id#23338,s_geography_class#23339,s_market_desc#23340,s_market_manager#23341,s_division_id#23342,s_division_name#23343,s_company_id#23344,s_company_name#23345,s_street_number#23346,s_street_name#23347,s_street_type#23348,s_suite_number#23349,s_city#23350,s_county#23351,... 5 more fields] orc
:- CTERelationDef 51
:  +- SubqueryAlias sr
:     +- Aggregate [s_store_sk#23405L], [s_store_sk#23405L, sum(sr_return_amt#23367) AS returns#23267, sum(sr_net_loss#23375) AS profit_loss#23268]
:        +- Filter (((sr_returned_date_sk#23376L = d_date_sk#23377L) AND ((d_date#23379 >= cast(1998-08-04 as date)) AND (d_date#23379 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND (sr_store_sk#23363L = s_store_sk#23405L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#23357L,sr_item_sk#23358L,sr_customer_sk#23359L,sr_cdemo_sk#23360L,sr_hdemo_sk#23361L,sr_addr_sk#23362L,sr_store_sk#23363L,sr_reason_sk#23364L,sr_ticket_number#23365L,sr_return_quantity#23366,sr_return_amt#23367,sr_return_tax#23368,sr_return_amt_inc_tax#23369,sr_fee#23370,sr_return_ship_cost#23371,sr_refunded_cash#23372,sr_reversed_charge#23373,sr_store_credit#23374,sr_net_loss#23375,sr_returned_date_sk#23376L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23377L,d_date_id#23378,d_date#23379,d_month_seq#23380,d_week_seq#23381,d_quarter_seq#23382,d_year#23383,d_dow#23384,d_moy#23385,d_dom#23386,d_qoy#23387,d_fy_year#23388,d_fy_quarter_seq#23389,d_fy_week_seq#23390,d_day_name#23391,d_quarter_name#23392,d_holiday#23393,d_weekend#23394,d_following_holiday#23395,d_first_dom#23396,d_last_dom#23397,d_same_day_ly#23398,d_same_day_lq#23399,d_current_day#23400,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23405L,s_store_id#23406,s_rec_start_date#23407,s_rec_end_date#23408,s_closed_date_sk#23409L,s_store_name#23410,s_number_employees#23411,s_floor_space#23412,s_hours#23413,s_manager#23414,s_market_id#23415,s_geography_class#23416,s_market_desc#23417,s_market_manager#23418,s_division_id#23419,s_division_name#23420,s_company_id#23421,s_company_name#23422,s_street_number#23423,s_street_name#23424,s_street_type#23425,s_suite_number#23426,s_city#23427,s_county#23428,... 5 more fields] orc
:- CTERelationDef 52
:  +- SubqueryAlias cs
:     +- Aggregate [cs_call_center_sk#23444L], [cs_call_center_sk#23444L, sum(cs_ext_sales_price#23456) AS sales#23269, sum(cs_net_profit#23466) AS profit#23270]
:        +- Filter ((cs_sold_date_sk#23467L = d_date_sk#23468L) AND ((d_date#23470 >= cast(1998-08-04 as date)) AND (d_date#23470 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY)))))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23434L,cs_ship_date_sk#23435L,cs_bill_customer_sk#23436L,cs_bill_cdemo_sk#23437L,cs_bill_hdemo_sk#23438L,cs_bill_addr_sk#23439L,cs_ship_customer_sk#23440L,cs_ship_cdemo_sk#23441L,cs_ship_hdemo_sk#23442L,cs_ship_addr_sk#23443L,cs_call_center_sk#23444L,cs_catalog_page_sk#23445L,cs_ship_mode_sk#23446L,cs_warehouse_sk#23447L,cs_item_sk#23448L,cs_promo_sk#23449L,cs_order_number#23450L,cs_quantity#23451,cs_wholesale_cost#23452,cs_list_price#23453,cs_sales_price#23454,cs_ext_discount_amt#23455,cs_ext_sales_price#23456,cs_ext_wholesale_cost#23457,... 10 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23468L,d_date_id#23469,d_date#23470,d_month_seq#23471,d_week_seq#23472,d_quarter_seq#23473,d_year#23474,d_dow#23475,d_moy#23476,d_dom#23477,d_qoy#23478,d_fy_year#23479,d_fy_quarter_seq#23480,d_fy_week_seq#23481,d_day_name#23482,d_quarter_name#23483,d_holiday#23484,d_weekend#23485,d_following_holiday#23486,d_first_dom#23487,d_last_dom#23488,d_same_day_ly#23489,d_same_day_lq#23490,d_current_day#23491,... 4 more fields] orc
:- CTERelationDef 53
:  +- SubqueryAlias cr
:     +- Aggregate [sum(cr_return_amount#23513) AS returns#23271, sum(cr_net_loss#23521) AS profit_loss#23272]
:        +- Filter ((cr_returned_date_sk#23522L = d_date_sk#23523L) AND ((d_date#23525 >= cast(1998-08-04 as date)) AND (d_date#23525 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY)))))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#23496L,cr_item_sk#23497L,cr_refunded_customer_sk#23498L,cr_refunded_cdemo_sk#23499L,cr_refunded_hdemo_sk#23500L,cr_refunded_addr_sk#23501L,cr_returning_customer_sk#23502L,cr_returning_cdemo_sk#23503L,cr_returning_hdemo_sk#23504L,cr_returning_addr_sk#23505L,cr_call_center_sk#23506L,cr_catalog_page_sk#23507L,cr_ship_mode_sk#23508L,cr_warehouse_sk#23509L,cr_reason_sk#23510L,cr_order_number#23511L,cr_return_quantity#23512,cr_return_amount#23513,cr_return_tax#23514,cr_return_amt_inc_tax#23515,cr_fee#23516,cr_return_ship_cost#23517,cr_refunded_cash#23518,cr_reversed_charge#23519,... 3 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23523L,d_date_id#23524,d_date#23525,d_month_seq#23526,d_week_seq#23527,d_quarter_seq#23528,d_year#23529,d_dow#23530,d_moy#23531,d_dom#23532,d_qoy#23533,d_fy_year#23534,d_fy_quarter_seq#23535,d_fy_week_seq#23536,d_day_name#23537,d_quarter_name#23538,d_holiday#23539,d_weekend#23540,d_following_holiday#23541,d_first_dom#23542,d_last_dom#23543,d_same_day_ly#23544,d_same_day_lq#23545,d_current_day#23546,... 4 more fields] orc
:- CTERelationDef 54
:  +- SubqueryAlias ws
:     +- Aggregate [wp_web_page_sk#23613L], [wp_web_page_sk#23613L, sum(ws_ext_sales_price#23573) AS sales#23273, sum(ws_net_profit#23583) AS profit#23274]
:        +- Filter (((ws_sold_date_sk#23584L = d_date_sk#23585L) AND ((d_date#23587 >= cast(1998-08-04 as date)) AND (d_date#23587 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND (ws_web_page_sk#23562L = wp_web_page_sk#23613L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23551L,ws_ship_date_sk#23552L,ws_item_sk#23553L,ws_bill_customer_sk#23554L,ws_bill_cdemo_sk#23555L,ws_bill_hdemo_sk#23556L,ws_bill_addr_sk#23557L,ws_ship_customer_sk#23558L,ws_ship_cdemo_sk#23559L,ws_ship_hdemo_sk#23560L,ws_ship_addr_sk#23561L,ws_web_page_sk#23562L,ws_web_site_sk#23563L,ws_ship_mode_sk#23564L,ws_warehouse_sk#23565L,ws_promo_sk#23566L,ws_order_number#23567L,ws_quantity#23568,ws_wholesale_cost#23569,ws_list_price#23570,ws_sales_price#23571,ws_ext_discount_amt#23572,ws_ext_sales_price#23573,ws_ext_wholesale_cost#23574,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23585L,d_date_id#23586,d_date#23587,d_month_seq#23588,d_week_seq#23589,d_quarter_seq#23590,d_year#23591,d_dow#23592,d_moy#23593,d_dom#23594,d_qoy#23595,d_fy_year#23596,d_fy_quarter_seq#23597,d_fy_week_seq#23598,d_day_name#23599,d_quarter_name#23600,d_holiday#23601,d_weekend#23602,d_following_holiday#23603,d_first_dom#23604,d_last_dom#23605,d_same_day_ly#23606,d_same_day_lq#23607,d_current_day#23608,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_page
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23613L,wp_web_page_id#23614,wp_rec_start_date#23615,wp_rec_end_date#23616,wp_creation_date_sk#23617L,wp_access_date_sk#23618L,wp_autogen_flag#23619,wp_customer_sk#23620L,wp_url#23621,wp_type#23622,wp_char_count#23623,wp_link_count#23624,wp_image_count#23625,wp_max_ad_count#23626] orc
:- CTERelationDef 55
:  +- SubqueryAlias wr
:     +- Aggregate [wp_web_page_sk#23679L], [wp_web_page_sk#23679L, sum(wr_return_amt#23641) AS returns#23275, sum(wr_net_loss#23649) AS profit_loss#23276]
:        +- Filter (((wr_returned_date_sk#23650L = d_date_sk#23651L) AND ((d_date#23653 >= cast(1998-08-04 as date)) AND (d_date#23653 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND (wr_web_page_sk#23637L = wp_web_page_sk#23679L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#23627L,wr_item_sk#23628L,wr_refunded_customer_sk#23629L,wr_refunded_cdemo_sk#23630L,wr_refunded_hdemo_sk#23631L,wr_refunded_addr_sk#23632L,wr_returning_customer_sk#23633L,wr_returning_cdemo_sk#23634L,wr_returning_hdemo_sk#23635L,wr_returning_addr_sk#23636L,wr_web_page_sk#23637L,wr_reason_sk#23638L,wr_order_number#23639L,wr_return_quantity#23640,wr_return_amt#23641,wr_return_tax#23642,wr_return_amt_inc_tax#23643,wr_fee#23644,wr_return_ship_cost#23645,wr_refunded_cash#23646,wr_reversed_charge#23647,wr_account_credit#23648,wr_net_loss#23649,wr_returned_date_sk#23650L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23651L,d_date_id#23652,d_date#23653,d_month_seq#23654,d_week_seq#23655,d_quarter_seq#23656,d_year#23657,d_dow#23658,d_moy#23659,d_dom#23660,d_qoy#23661,d_fy_year#23662,d_fy_quarter_seq#23663,d_fy_week_seq#23664,d_day_name#23665,d_quarter_name#23666,d_holiday#23667,d_weekend#23668,d_following_holiday#23669,d_first_dom#23670,d_last_dom#23671,d_same_day_ly#23672,d_same_day_lq#23673,d_current_day#23674,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_page
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23679L,wp_web_page_id#23680,wp_rec_start_date#23681,wp_rec_end_date#23682,wp_creation_date_sk#23683L,wp_access_date_sk#23684L,wp_autogen_flag#23685,wp_customer_sk#23686L,wp_url#23687,wp_type#23688,wp_char_count#23689,wp_link_count#23690,wp_image_count#23691,wp_max_ad_count#23692] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [channel#23711 ASC NULLS FIRST, id#23712L ASC NULLS FIRST], true
         +- Aggregate [channel#23711, id#23712L, spark_grouping_id#23710L], [channel#23711, id#23712L, sum(sales#23265) AS sales#23262, sum(returns#23253) AS returns#23263, sum(profit#23254) AS profit#23264]
            +- Expand [[channel#23251, id#23252L, sales#23265, returns#23253, profit#23254, channel#23708, id#23709L, 0], [channel#23251, id#23252L, sales#23265, returns#23253, profit#23254, channel#23708, null, 1], [channel#23251, id#23252L, sales#23265, returns#23253, profit#23254, null, null, 3]], [channel#23251, id#23252L, sales#23265, returns#23253, profit#23254, channel#23711, id#23712L, spark_grouping_id#23710L]
               +- Project [channel#23251, id#23252L, sales#23265, returns#23253, profit#23254, channel#23251 AS channel#23708, id#23252L AS id#23709L]
                  +- SubqueryAlias x
                     +- Union false, false
                        :- Union false, false
                        :  :- Project [store channel AS channel#23251, s_store_sk#23328L AS id#23252L, sales#23265, coalesce(returns#23267, cast(0 as double)) AS returns#23253, (profit#23266 - coalesce(profit_loss#23268, cast(0 as double))) AS profit#23254]
                        :  :  +- Join LeftOuter, (s_store_sk#23328L = s_store_sk#23405L)
                        :  :     :- SubqueryAlias ss
                        :  :     :  +- CTERelationRef 50, true, [s_store_sk#23328L, sales#23265, profit#23266]
                        :  :     +- SubqueryAlias sr
                        :  :        +- CTERelationRef 51, true, [s_store_sk#23405L, returns#23267, profit_loss#23268]
                        :  +- Project [catalog channel AS channel#23255, cs_call_center_sk#23444L AS id#23256L, sales#23269, returns#23271, (profit#23270 - profit_loss#23272) AS profit#23257]
                        :     +- Join Inner
                        :        :- SubqueryAlias cs
                        :        :  +- CTERelationRef 52, true, [cs_call_center_sk#23444L, sales#23269, profit#23270]
                        :        +- SubqueryAlias cr
                        :           +- CTERelationRef 53, true, [returns#23271, profit_loss#23272]
                        +- Project [web channel AS channel#23258, wp_web_page_sk#23613L AS id#23259L, sales#23273, coalesce(returns#23275, cast(0 as double)) AS returns#23260, (profit#23274 - coalesce(profit_loss#23276, cast(0 as double))) AS profit#23261]
                           +- Join LeftOuter, (wp_web_page_sk#23613L = wp_web_page_sk#23679L)
                              :- SubqueryAlias ws
                              :  +- CTERelationRef 54, true, [wp_web_page_sk#23613L, sales#23273, profit#23274]
                              +- SubqueryAlias wr
                                 +- CTERelationRef 55, true, [wp_web_page_sk#23679L, returns#23275, profit_loss#23276]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#23711 ASC NULLS FIRST, id#23712L ASC NULLS FIRST], true
      +- Aggregate [channel#23711, id#23712L, spark_grouping_id#23710L], [channel#23711, id#23712L, sum(sales#23265) AS sales#23262, sum(returns#23253) AS returns#23263, sum(profit#23254) AS profit#23264]
         +- Expand [[sales#23265, returns#23253, profit#23254, channel#23708, id#23709L, 0], [sales#23265, returns#23253, profit#23254, channel#23708, null, 1], [sales#23265, returns#23253, profit#23254, null, null, 3]], [sales#23265, returns#23253, profit#23254, channel#23711, id#23712L, spark_grouping_id#23710L]
            +- Union false, false
               :- Project [sales#23265, coalesce(returns#23267, 0.0) AS returns#23253, (profit#23266 - coalesce(profit_loss#23268, 0.0)) AS profit#23254, store channel AS channel#23708, s_store_sk#23328L AS id#23709L]
               :  +- Join LeftOuter, (s_store_sk#23328L = s_store_sk#23405L)
               :     :- Aggregate [s_store_sk#23328L], [s_store_sk#23328L, sum(ss_ext_sales_price#23291) AS sales#23265, sum(ss_net_profit#23298) AS profit#23266]
               :     :  +- Project [ss_ext_sales_price#23291, ss_net_profit#23298, s_store_sk#23328L]
               :     :     +- Join Inner, (ss_store_sk#23283L = s_store_sk#23328L)
               :     :        :- Project [ss_store_sk#23283L, ss_ext_sales_price#23291, ss_net_profit#23298]
               :     :        :  +- Join Inner, (ss_sold_date_sk#23299L = d_date_sk#23300L)
               :     :        :     :- Project [ss_store_sk#23283L, ss_ext_sales_price#23291, ss_net_profit#23298, ss_sold_date_sk#23299L]
               :     :        :     :  +- Filter ((isnotnull(ss_sold_date_sk#23299L) AND isnotnull(ss_store_sk#23283L)) AND dynamicpruning#23722 [ss_sold_date_sk#23299L])
               :     :        :     :     :  +- Project [d_date_sk#23300L]
               :     :        :     :     :     +- Filter ((isnotnull(d_date#23302) AND ((d_date#23302 >= 1998-08-04) AND (d_date#23302 <= 1998-09-03))) AND isnotnull(d_date_sk#23300L))
               :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23300L,d_date_id#23301,d_date#23302,d_month_seq#23303,d_week_seq#23304,d_quarter_seq#23305,d_year#23306,d_dow#23307,d_moy#23308,d_dom#23309,d_qoy#23310,d_fy_year#23311,d_fy_quarter_seq#23312,d_fy_week_seq#23313,d_day_name#23314,d_quarter_name#23315,d_holiday#23316,d_weekend#23317,d_following_holiday#23318,d_first_dom#23319,d_last_dom#23320,d_same_day_ly#23321,d_same_day_lq#23322,d_current_day#23323,... 4 more fields] orc
               :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#23277L,ss_item_sk#23278L,ss_customer_sk#23279L,ss_cdemo_sk#23280L,ss_hdemo_sk#23281L,ss_addr_sk#23282L,ss_store_sk#23283L,ss_promo_sk#23284L,ss_ticket_number#23285L,ss_quantity#23286,ss_wholesale_cost#23287,ss_list_price#23288,ss_sales_price#23289,ss_ext_discount_amt#23290,ss_ext_sales_price#23291,ss_ext_wholesale_cost#23292,ss_ext_list_price#23293,ss_ext_tax#23294,ss_coupon_amt#23295,ss_net_paid#23296,ss_net_paid_inc_tax#23297,ss_net_profit#23298,ss_sold_date_sk#23299L] orc
               :     :        :     +- Project [d_date_sk#23300L]
               :     :        :        +- Filter ((isnotnull(d_date#23302) AND ((d_date#23302 >= 1998-08-04) AND (d_date#23302 <= 1998-09-03))) AND isnotnull(d_date_sk#23300L))
               :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23300L,d_date_id#23301,d_date#23302,d_month_seq#23303,d_week_seq#23304,d_quarter_seq#23305,d_year#23306,d_dow#23307,d_moy#23308,d_dom#23309,d_qoy#23310,d_fy_year#23311,d_fy_quarter_seq#23312,d_fy_week_seq#23313,d_day_name#23314,d_quarter_name#23315,d_holiday#23316,d_weekend#23317,d_following_holiday#23318,d_first_dom#23319,d_last_dom#23320,d_same_day_ly#23321,d_same_day_lq#23322,d_current_day#23323,... 4 more fields] orc
               :     :        +- Project [s_store_sk#23328L]
               :     :           +- Filter isnotnull(s_store_sk#23328L)
               :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23328L,s_store_id#23329,s_rec_start_date#23330,s_rec_end_date#23331,s_closed_date_sk#23332L,s_store_name#23333,s_number_employees#23334,s_floor_space#23335,s_hours#23336,s_manager#23337,s_market_id#23338,s_geography_class#23339,s_market_desc#23340,s_market_manager#23341,s_division_id#23342,s_division_name#23343,s_company_id#23344,s_company_name#23345,s_street_number#23346,s_street_name#23347,s_street_type#23348,s_suite_number#23349,s_city#23350,s_county#23351,... 5 more fields] orc
               :     +- Aggregate [s_store_sk#23405L], [s_store_sk#23405L, sum(sr_return_amt#23367) AS returns#23267, sum(sr_net_loss#23375) AS profit_loss#23268]
               :        +- Project [sr_return_amt#23367, sr_net_loss#23375, s_store_sk#23405L]
               :           +- Join Inner, (sr_store_sk#23363L = s_store_sk#23405L)
               :              :- Project [sr_store_sk#23363L, sr_return_amt#23367, sr_net_loss#23375]
               :              :  +- Join Inner, (sr_returned_date_sk#23376L = d_date_sk#23377L)
               :              :     :- Project [sr_store_sk#23363L, sr_return_amt#23367, sr_net_loss#23375, sr_returned_date_sk#23376L]
               :              :     :  +- Filter ((isnotnull(sr_returned_date_sk#23376L) AND isnotnull(sr_store_sk#23363L)) AND dynamicpruning#23723 [sr_returned_date_sk#23376L])
               :              :     :     :  +- Project [d_date_sk#23377L]
               :              :     :     :     +- Filter ((isnotnull(d_date#23379) AND ((d_date#23379 >= 1998-08-04) AND (d_date#23379 <= 1998-09-03))) AND isnotnull(d_date_sk#23377L))
               :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23377L,d_date_id#23378,d_date#23379,d_month_seq#23380,d_week_seq#23381,d_quarter_seq#23382,d_year#23383,d_dow#23384,d_moy#23385,d_dom#23386,d_qoy#23387,d_fy_year#23388,d_fy_quarter_seq#23389,d_fy_week_seq#23390,d_day_name#23391,d_quarter_name#23392,d_holiday#23393,d_weekend#23394,d_following_holiday#23395,d_first_dom#23396,d_last_dom#23397,d_same_day_ly#23398,d_same_day_lq#23399,d_current_day#23400,... 4 more fields] orc
               :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#23357L,sr_item_sk#23358L,sr_customer_sk#23359L,sr_cdemo_sk#23360L,sr_hdemo_sk#23361L,sr_addr_sk#23362L,sr_store_sk#23363L,sr_reason_sk#23364L,sr_ticket_number#23365L,sr_return_quantity#23366,sr_return_amt#23367,sr_return_tax#23368,sr_return_amt_inc_tax#23369,sr_fee#23370,sr_return_ship_cost#23371,sr_refunded_cash#23372,sr_reversed_charge#23373,sr_store_credit#23374,sr_net_loss#23375,sr_returned_date_sk#23376L] orc
               :              :     +- Project [d_date_sk#23377L]
               :              :        +- Filter ((isnotnull(d_date#23379) AND ((d_date#23379 >= 1998-08-04) AND (d_date#23379 <= 1998-09-03))) AND isnotnull(d_date_sk#23377L))
               :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23377L,d_date_id#23378,d_date#23379,d_month_seq#23380,d_week_seq#23381,d_quarter_seq#23382,d_year#23383,d_dow#23384,d_moy#23385,d_dom#23386,d_qoy#23387,d_fy_year#23388,d_fy_quarter_seq#23389,d_fy_week_seq#23390,d_day_name#23391,d_quarter_name#23392,d_holiday#23393,d_weekend#23394,d_following_holiday#23395,d_first_dom#23396,d_last_dom#23397,d_same_day_ly#23398,d_same_day_lq#23399,d_current_day#23400,... 4 more fields] orc
               :              +- Project [s_store_sk#23405L]
               :                 +- Filter isnotnull(s_store_sk#23405L)
               :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23405L,s_store_id#23406,s_rec_start_date#23407,s_rec_end_date#23408,s_closed_date_sk#23409L,s_store_name#23410,s_number_employees#23411,s_floor_space#23412,s_hours#23413,s_manager#23414,s_market_id#23415,s_geography_class#23416,s_market_desc#23417,s_market_manager#23418,s_division_id#23419,s_division_name#23420,s_company_id#23421,s_company_name#23422,s_street_number#23423,s_street_name#23424,s_street_type#23425,s_suite_number#23426,s_city#23427,s_county#23428,... 5 more fields] orc
               :- Project [sales#23269, returns#23271, (profit#23270 - profit_loss#23272) AS profit#23257, catalog channel AS channel#23718, cs_call_center_sk#23444L AS id#23719L]
               :  +- Join Inner
               :     :- Aggregate [cs_call_center_sk#23444L], [cs_call_center_sk#23444L, sum(cs_ext_sales_price#23456) AS sales#23269, sum(cs_net_profit#23466) AS profit#23270]
               :     :  +- Project [cs_call_center_sk#23444L, cs_ext_sales_price#23456, cs_net_profit#23466]
               :     :     +- Join Inner, (cs_sold_date_sk#23467L = d_date_sk#23468L)
               :     :        :- Project [cs_call_center_sk#23444L, cs_ext_sales_price#23456, cs_net_profit#23466, cs_sold_date_sk#23467L]
               :     :        :  +- Filter (isnotnull(cs_sold_date_sk#23467L) AND dynamicpruning#23724 [cs_sold_date_sk#23467L])
               :     :        :     :  +- Project [d_date_sk#23468L]
               :     :        :     :     +- Filter ((isnotnull(d_date#23470) AND ((d_date#23470 >= 1998-08-04) AND (d_date#23470 <= 1998-09-03))) AND isnotnull(d_date_sk#23468L))
               :     :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23468L,d_date_id#23469,d_date#23470,d_month_seq#23471,d_week_seq#23472,d_quarter_seq#23473,d_year#23474,d_dow#23475,d_moy#23476,d_dom#23477,d_qoy#23478,d_fy_year#23479,d_fy_quarter_seq#23480,d_fy_week_seq#23481,d_day_name#23482,d_quarter_name#23483,d_holiday#23484,d_weekend#23485,d_following_holiday#23486,d_first_dom#23487,d_last_dom#23488,d_same_day_ly#23489,d_same_day_lq#23490,d_current_day#23491,... 4 more fields] orc
               :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23434L,cs_ship_date_sk#23435L,cs_bill_customer_sk#23436L,cs_bill_cdemo_sk#23437L,cs_bill_hdemo_sk#23438L,cs_bill_addr_sk#23439L,cs_ship_customer_sk#23440L,cs_ship_cdemo_sk#23441L,cs_ship_hdemo_sk#23442L,cs_ship_addr_sk#23443L,cs_call_center_sk#23444L,cs_catalog_page_sk#23445L,cs_ship_mode_sk#23446L,cs_warehouse_sk#23447L,cs_item_sk#23448L,cs_promo_sk#23449L,cs_order_number#23450L,cs_quantity#23451,cs_wholesale_cost#23452,cs_list_price#23453,cs_sales_price#23454,cs_ext_discount_amt#23455,cs_ext_sales_price#23456,cs_ext_wholesale_cost#23457,... 10 more fields] orc
               :     :        +- Project [d_date_sk#23468L]
               :     :           +- Filter ((isnotnull(d_date#23470) AND ((d_date#23470 >= 1998-08-04) AND (d_date#23470 <= 1998-09-03))) AND isnotnull(d_date_sk#23468L))
               :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23468L,d_date_id#23469,d_date#23470,d_month_seq#23471,d_week_seq#23472,d_quarter_seq#23473,d_year#23474,d_dow#23475,d_moy#23476,d_dom#23477,d_qoy#23478,d_fy_year#23479,d_fy_quarter_seq#23480,d_fy_week_seq#23481,d_day_name#23482,d_quarter_name#23483,d_holiday#23484,d_weekend#23485,d_following_holiday#23486,d_first_dom#23487,d_last_dom#23488,d_same_day_ly#23489,d_same_day_lq#23490,d_current_day#23491,... 4 more fields] orc
               :     +- Aggregate [sum(cr_return_amount#23513) AS returns#23271, sum(cr_net_loss#23521) AS profit_loss#23272]
               :        +- Project [cr_return_amount#23513, cr_net_loss#23521]
               :           +- Join Inner, (cr_returned_date_sk#23522L = d_date_sk#23523L)
               :              :- Project [cr_return_amount#23513, cr_net_loss#23521, cr_returned_date_sk#23522L]
               :              :  +- Filter (isnotnull(cr_returned_date_sk#23522L) AND dynamicpruning#23725 [cr_returned_date_sk#23522L])
               :              :     :  +- Project [d_date_sk#23523L]
               :              :     :     +- Filter ((isnotnull(d_date#23525) AND ((d_date#23525 >= 1998-08-04) AND (d_date#23525 <= 1998-09-03))) AND isnotnull(d_date_sk#23523L))
               :              :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23523L,d_date_id#23524,d_date#23525,d_month_seq#23526,d_week_seq#23527,d_quarter_seq#23528,d_year#23529,d_dow#23530,d_moy#23531,d_dom#23532,d_qoy#23533,d_fy_year#23534,d_fy_quarter_seq#23535,d_fy_week_seq#23536,d_day_name#23537,d_quarter_name#23538,d_holiday#23539,d_weekend#23540,d_following_holiday#23541,d_first_dom#23542,d_last_dom#23543,d_same_day_ly#23544,d_same_day_lq#23545,d_current_day#23546,... 4 more fields] orc
               :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#23496L,cr_item_sk#23497L,cr_refunded_customer_sk#23498L,cr_refunded_cdemo_sk#23499L,cr_refunded_hdemo_sk#23500L,cr_refunded_addr_sk#23501L,cr_returning_customer_sk#23502L,cr_returning_cdemo_sk#23503L,cr_returning_hdemo_sk#23504L,cr_returning_addr_sk#23505L,cr_call_center_sk#23506L,cr_catalog_page_sk#23507L,cr_ship_mode_sk#23508L,cr_warehouse_sk#23509L,cr_reason_sk#23510L,cr_order_number#23511L,cr_return_quantity#23512,cr_return_amount#23513,cr_return_tax#23514,cr_return_amt_inc_tax#23515,cr_fee#23516,cr_return_ship_cost#23517,cr_refunded_cash#23518,cr_reversed_charge#23519,... 3 more fields] orc
               :              +- Project [d_date_sk#23523L]
               :                 +- Filter ((isnotnull(d_date#23525) AND ((d_date#23525 >= 1998-08-04) AND (d_date#23525 <= 1998-09-03))) AND isnotnull(d_date_sk#23523L))
               :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23523L,d_date_id#23524,d_date#23525,d_month_seq#23526,d_week_seq#23527,d_quarter_seq#23528,d_year#23529,d_dow#23530,d_moy#23531,d_dom#23532,d_qoy#23533,d_fy_year#23534,d_fy_quarter_seq#23535,d_fy_week_seq#23536,d_day_name#23537,d_quarter_name#23538,d_holiday#23539,d_weekend#23540,d_following_holiday#23541,d_first_dom#23542,d_last_dom#23543,d_same_day_ly#23544,d_same_day_lq#23545,d_current_day#23546,... 4 more fields] orc
               +- Project [sales#23273, coalesce(returns#23275, 0.0) AS returns#23260, (profit#23274 - coalesce(profit_loss#23276, 0.0)) AS profit#23261, web channel AS channel#23720, wp_web_page_sk#23613L AS id#23721L]
                  +- Join LeftOuter, (wp_web_page_sk#23613L = wp_web_page_sk#23679L)
                     :- Aggregate [wp_web_page_sk#23613L], [wp_web_page_sk#23613L, sum(ws_ext_sales_price#23573) AS sales#23273, sum(ws_net_profit#23583) AS profit#23274]
                     :  +- Project [ws_ext_sales_price#23573, ws_net_profit#23583, wp_web_page_sk#23613L]
                     :     +- Join Inner, (ws_web_page_sk#23562L = wp_web_page_sk#23613L)
                     :        :- Project [ws_web_page_sk#23562L, ws_ext_sales_price#23573, ws_net_profit#23583]
                     :        :  +- Join Inner, (ws_sold_date_sk#23584L = d_date_sk#23585L)
                     :        :     :- Project [ws_web_page_sk#23562L, ws_ext_sales_price#23573, ws_net_profit#23583, ws_sold_date_sk#23584L]
                     :        :     :  +- Filter ((isnotnull(ws_sold_date_sk#23584L) AND isnotnull(ws_web_page_sk#23562L)) AND dynamicpruning#23726 [ws_sold_date_sk#23584L])
                     :        :     :     :  +- Project [d_date_sk#23585L]
                     :        :     :     :     +- Filter ((isnotnull(d_date#23587) AND ((d_date#23587 >= 1998-08-04) AND (d_date#23587 <= 1998-09-03))) AND isnotnull(d_date_sk#23585L))
                     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23585L,d_date_id#23586,d_date#23587,d_month_seq#23588,d_week_seq#23589,d_quarter_seq#23590,d_year#23591,d_dow#23592,d_moy#23593,d_dom#23594,d_qoy#23595,d_fy_year#23596,d_fy_quarter_seq#23597,d_fy_week_seq#23598,d_day_name#23599,d_quarter_name#23600,d_holiday#23601,d_weekend#23602,d_following_holiday#23603,d_first_dom#23604,d_last_dom#23605,d_same_day_ly#23606,d_same_day_lq#23607,d_current_day#23608,... 4 more fields] orc
                     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23551L,ws_ship_date_sk#23552L,ws_item_sk#23553L,ws_bill_customer_sk#23554L,ws_bill_cdemo_sk#23555L,ws_bill_hdemo_sk#23556L,ws_bill_addr_sk#23557L,ws_ship_customer_sk#23558L,ws_ship_cdemo_sk#23559L,ws_ship_hdemo_sk#23560L,ws_ship_addr_sk#23561L,ws_web_page_sk#23562L,ws_web_site_sk#23563L,ws_ship_mode_sk#23564L,ws_warehouse_sk#23565L,ws_promo_sk#23566L,ws_order_number#23567L,ws_quantity#23568,ws_wholesale_cost#23569,ws_list_price#23570,ws_sales_price#23571,ws_ext_discount_amt#23572,ws_ext_sales_price#23573,ws_ext_wholesale_cost#23574,... 10 more fields] orc
                     :        :     +- Project [d_date_sk#23585L]
                     :        :        +- Filter ((isnotnull(d_date#23587) AND ((d_date#23587 >= 1998-08-04) AND (d_date#23587 <= 1998-09-03))) AND isnotnull(d_date_sk#23585L))
                     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23585L,d_date_id#23586,d_date#23587,d_month_seq#23588,d_week_seq#23589,d_quarter_seq#23590,d_year#23591,d_dow#23592,d_moy#23593,d_dom#23594,d_qoy#23595,d_fy_year#23596,d_fy_quarter_seq#23597,d_fy_week_seq#23598,d_day_name#23599,d_quarter_name#23600,d_holiday#23601,d_weekend#23602,d_following_holiday#23603,d_first_dom#23604,d_last_dom#23605,d_same_day_ly#23606,d_same_day_lq#23607,d_current_day#23608,... 4 more fields] orc
                     :        +- Project [wp_web_page_sk#23613L]
                     :           +- Filter isnotnull(wp_web_page_sk#23613L)
                     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23613L,wp_web_page_id#23614,wp_rec_start_date#23615,wp_rec_end_date#23616,wp_creation_date_sk#23617L,wp_access_date_sk#23618L,wp_autogen_flag#23619,wp_customer_sk#23620L,wp_url#23621,wp_type#23622,wp_char_count#23623,wp_link_count#23624,wp_image_count#23625,wp_max_ad_count#23626] orc
                     +- Aggregate [wp_web_page_sk#23679L], [wp_web_page_sk#23679L, sum(wr_return_amt#23641) AS returns#23275, sum(wr_net_loss#23649) AS profit_loss#23276]
                        +- Project [wr_return_amt#23641, wr_net_loss#23649, wp_web_page_sk#23679L]
                           +- Join Inner, (wr_web_page_sk#23637L = wp_web_page_sk#23679L)
                              :- Project [wr_web_page_sk#23637L, wr_return_amt#23641, wr_net_loss#23649]
                              :  +- Join Inner, (wr_returned_date_sk#23650L = d_date_sk#23651L)
                              :     :- Project [wr_web_page_sk#23637L, wr_return_amt#23641, wr_net_loss#23649, wr_returned_date_sk#23650L]
                              :     :  +- Filter ((isnotnull(wr_returned_date_sk#23650L) AND isnotnull(wr_web_page_sk#23637L)) AND dynamicpruning#23727 [wr_returned_date_sk#23650L])
                              :     :     :  +- Project [d_date_sk#23651L]
                              :     :     :     +- Filter ((isnotnull(d_date#23653) AND ((d_date#23653 >= 1998-08-04) AND (d_date#23653 <= 1998-09-03))) AND isnotnull(d_date_sk#23651L))
                              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23651L,d_date_id#23652,d_date#23653,d_month_seq#23654,d_week_seq#23655,d_quarter_seq#23656,d_year#23657,d_dow#23658,d_moy#23659,d_dom#23660,d_qoy#23661,d_fy_year#23662,d_fy_quarter_seq#23663,d_fy_week_seq#23664,d_day_name#23665,d_quarter_name#23666,d_holiday#23667,d_weekend#23668,d_following_holiday#23669,d_first_dom#23670,d_last_dom#23671,d_same_day_ly#23672,d_same_day_lq#23673,d_current_day#23674,... 4 more fields] orc
                              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#23627L,wr_item_sk#23628L,wr_refunded_customer_sk#23629L,wr_refunded_cdemo_sk#23630L,wr_refunded_hdemo_sk#23631L,wr_refunded_addr_sk#23632L,wr_returning_customer_sk#23633L,wr_returning_cdemo_sk#23634L,wr_returning_hdemo_sk#23635L,wr_returning_addr_sk#23636L,wr_web_page_sk#23637L,wr_reason_sk#23638L,wr_order_number#23639L,wr_return_quantity#23640,wr_return_amt#23641,wr_return_tax#23642,wr_return_amt_inc_tax#23643,wr_fee#23644,wr_return_ship_cost#23645,wr_refunded_cash#23646,wr_reversed_charge#23647,wr_account_credit#23648,wr_net_loss#23649,wr_returned_date_sk#23650L] orc
                              :     +- Project [d_date_sk#23651L]
                              :        +- Filter ((isnotnull(d_date#23653) AND ((d_date#23653 >= 1998-08-04) AND (d_date#23653 <= 1998-09-03))) AND isnotnull(d_date_sk#23651L))
                              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23651L,d_date_id#23652,d_date#23653,d_month_seq#23654,d_week_seq#23655,d_quarter_seq#23656,d_year#23657,d_dow#23658,d_moy#23659,d_dom#23660,d_qoy#23661,d_fy_year#23662,d_fy_quarter_seq#23663,d_fy_week_seq#23664,d_day_name#23665,d_quarter_name#23666,d_holiday#23667,d_weekend#23668,d_following_holiday#23669,d_first_dom#23670,d_last_dom#23671,d_same_day_ly#23672,d_same_day_lq#23673,d_current_day#23674,... 4 more fields] orc
                              +- Project [wp_web_page_sk#23679L]
                                 +- Filter isnotnull(wp_web_page_sk#23679L)
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23679L,wp_web_page_id#23680,wp_rec_start_date#23681,wp_rec_end_date#23682,wp_creation_date_sk#23683L,wp_access_date_sk#23684L,wp_autogen_flag#23685,wp_customer_sk#23686L,wp_url#23687,wp_type#23688,wp_char_count#23689,wp_link_count#23690,wp_image_count#23691,wp_max_ad_count#23692] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#23711 ASC NULLS FIRST,id#23712L ASC NULLS FIRST], output=[channel#23711,id#23712L,sales#23262,returns#23263,profit#23264])
   +- HashAggregate(keys=[channel#23711, id#23712L, spark_grouping_id#23710L], functions=[sum(sales#23265), sum(returns#23253), sum(profit#23254)], output=[channel#23711, id#23712L, sales#23262, returns#23263, profit#23264])
      +- Exchange hashpartitioning(channel#23711, id#23712L, spark_grouping_id#23710L, 3000), ENSURE_REQUIREMENTS, [id=#24362]
         +- HashAggregate(keys=[channel#23711, id#23712L, spark_grouping_id#23710L], functions=[partial_sum(sales#23265), partial_sum(returns#23253), partial_sum(profit#23254)], output=[channel#23711, id#23712L, spark_grouping_id#23710L, sum#23731, sum#23732, sum#23733])
            +- Expand [[sales#23265, returns#23253, profit#23254, channel#23708, id#23709L, 0], [sales#23265, returns#23253, profit#23254, channel#23708, null, 1], [sales#23265, returns#23253, profit#23254, null, null, 3]], [sales#23265, returns#23253, profit#23254, channel#23711, id#23712L, spark_grouping_id#23710L]
               +- Union
                  :- Project [sales#23265, coalesce(returns#23267, 0.0) AS returns#23253, (profit#23266 - coalesce(profit_loss#23268, 0.0)) AS profit#23254, store channel AS channel#23708, s_store_sk#23328L AS id#23709L]
                  :  +- BroadcastHashJoin [s_store_sk#23328L], [s_store_sk#23405L], LeftOuter, BuildRight, false
                  :     :- HashAggregate(keys=[s_store_sk#23328L], functions=[sum(ss_ext_sales_price#23291), sum(ss_net_profit#23298)], output=[s_store_sk#23328L, sales#23265, profit#23266])
                  :     :  +- Exchange hashpartitioning(s_store_sk#23328L, 3000), ENSURE_REQUIREMENTS, [id=#24297]
                  :     :     +- HashAggregate(keys=[s_store_sk#23328L], functions=[partial_sum(ss_ext_sales_price#23291), partial_sum(ss_net_profit#23298)], output=[s_store_sk#23328L, sum#23736, sum#23737])
                  :     :        +- Project [ss_ext_sales_price#23291, ss_net_profit#23298, s_store_sk#23328L]
                  :     :           +- BroadcastHashJoin [ss_store_sk#23283L], [s_store_sk#23328L], Inner, BuildRight, false
                  :     :              :- Project [ss_store_sk#23283L, ss_ext_sales_price#23291, ss_net_profit#23298]
                  :     :              :  +- BroadcastHashJoin [ss_sold_date_sk#23299L], [d_date_sk#23300L], Inner, BuildRight, false
                  :     :              :     :- Filter isnotnull(ss_store_sk#23283L)
                  :     :              :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_store_sk#23283L,ss_ext_sales_price#23291,ss_net_profit#23298,ss_sold_date_sk#23299L] Batched: true, DataFilters: [isnotnull(ss_store_sk#23283L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#23299L), dynamicpruningexpression(ss_sold_date_sk#23299L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:bigint,ss_ext_sales_price:double,ss_net_profit:double>
                  :     :              :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#23722, 0, true, Project [d_date_sk#23300L], [d_date_sk#23300L]
                  :     :              :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              :     :              +- Project [d_date_sk#23300L]
                  :     :              :     :                 +- Filter (((isnotnull(d_date#23302) AND (d_date#23302 >= 1998-08-04)) AND (d_date#23302 <= 1998-09-03)) AND isnotnull(d_date_sk#23300L))
                  :     :              :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23300L,d_date#23302] Batched: true, DataFilters: [isnotnull(d_date#23302), (d_date#23302 >= 1998-08-04), (d_date#23302 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :     :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24288]
                  :     :              :        +- Project [d_date_sk#23300L]
                  :     :              :           +- Filter (((isnotnull(d_date#23302) AND (d_date#23302 >= 1998-08-04)) AND (d_date#23302 <= 1998-09-03)) AND isnotnull(d_date_sk#23300L))
                  :     :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23300L,d_date#23302] Batched: true, DataFilters: [isnotnull(d_date#23302), (d_date#23302 >= 1998-08-04), (d_date#23302 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24292]
                  :     :                 +- Filter isnotnull(s_store_sk#23328L)
                  :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23328L] Batched: true, DataFilters: [isnotnull(s_store_sk#23328L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24311]
                  :        +- HashAggregate(keys=[s_store_sk#23405L], functions=[sum(sr_return_amt#23367), sum(sr_net_loss#23375)], output=[s_store_sk#23405L, returns#23267, profit_loss#23268])
                  :           +- Exchange hashpartitioning(s_store_sk#23405L, 3000), ENSURE_REQUIREMENTS, [id=#24308]
                  :              +- HashAggregate(keys=[s_store_sk#23405L], functions=[partial_sum(sr_return_amt#23367), partial_sum(sr_net_loss#23375)], output=[s_store_sk#23405L, sum#23740, sum#23741])
                  :                 +- Project [sr_return_amt#23367, sr_net_loss#23375, s_store_sk#23405L]
                  :                    +- BroadcastHashJoin [sr_store_sk#23363L], [s_store_sk#23405L], Inner, BuildRight, false
                  :                       :- Project [sr_store_sk#23363L, sr_return_amt#23367, sr_net_loss#23375]
                  :                       :  +- BroadcastHashJoin [sr_returned_date_sk#23376L], [d_date_sk#23377L], Inner, BuildRight, false
                  :                       :     :- Filter isnotnull(sr_store_sk#23363L)
                  :                       :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_store_sk#23363L,sr_return_amt#23367,sr_net_loss#23375,sr_returned_date_sk#23376L] Batched: true, DataFilters: [isnotnull(sr_store_sk#23363L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#23376L), dynamicpruningexpression(sr_returned_date_sk#23376L IN dy..., PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_store_sk:bigint,sr_return_amt:double,sr_net_loss:double>
                  :                       :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#23723, 0, true, Project [d_date_sk#23377L], [d_date_sk#23377L]
                  :                       :     :           +- AdaptiveSparkPlan isFinalPlan=false
                  :                       :     :              +- Project [d_date_sk#23377L]
                  :                       :     :                 +- Filter (((isnotnull(d_date#23379) AND (d_date#23379 >= 1998-08-04)) AND (d_date#23379 <= 1998-09-03)) AND isnotnull(d_date_sk#23377L))
                  :                       :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23377L,d_date#23379] Batched: true, DataFilters: [isnotnull(d_date#23379), (d_date#23379 >= 1998-08-04), (d_date#23379 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24299]
                  :                       :        +- Project [d_date_sk#23377L]
                  :                       :           +- Filter (((isnotnull(d_date#23379) AND (d_date#23379 >= 1998-08-04)) AND (d_date#23379 <= 1998-09-03)) AND isnotnull(d_date_sk#23377L))
                  :                       :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23377L,d_date#23379] Batched: true, DataFilters: [isnotnull(d_date#23379), (d_date#23379 >= 1998-08-04), (d_date#23379 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24303]
                  :                          +- Filter isnotnull(s_store_sk#23405L)
                  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#23405L] Batched: true, DataFilters: [isnotnull(s_store_sk#23405L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint>
                  :- Project [sales#23269, returns#23271, (profit#23270 - profit_loss#23272) AS profit#23257, catalog channel AS channel#23718, cs_call_center_sk#23444L AS id#23719L]
                  :  +- BroadcastNestedLoopJoin BuildRight, Inner
                  :     :- HashAggregate(keys=[cs_call_center_sk#23444L], functions=[sum(cs_ext_sales_price#23456), sum(cs_net_profit#23466)], output=[cs_call_center_sk#23444L, sales#23269, profit#23270])
                  :     :  +- Exchange hashpartitioning(cs_call_center_sk#23444L, 3000), ENSURE_REQUIREMENTS, [id=#24319]
                  :     :     +- HashAggregate(keys=[cs_call_center_sk#23444L], functions=[partial_sum(cs_ext_sales_price#23456), partial_sum(cs_net_profit#23466)], output=[cs_call_center_sk#23444L, sum#23744, sum#23745])
                  :     :        +- Project [cs_call_center_sk#23444L, cs_ext_sales_price#23456, cs_net_profit#23466]
                  :     :           +- BroadcastHashJoin [cs_sold_date_sk#23467L], [d_date_sk#23468L], Inner, BuildRight, false
                  :     :              :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_call_center_sk#23444L,cs_ext_sales_price#23456,cs_net_profit#23466,cs_sold_date_sk#23467L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#23467L), dynamicpruningexpression(cs_sold_date_sk#23467L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<cs_call_center_sk:bigint,cs_ext_sales_price:double,cs_net_profit:double>
                  :     :              :     +- SubqueryAdaptiveBroadcast dynamicpruning#23724, 0, true, Project [d_date_sk#23468L], [d_date_sk#23468L]
                  :     :              :        +- AdaptiveSparkPlan isFinalPlan=false
                  :     :              :           +- Project [d_date_sk#23468L]
                  :     :              :              +- Filter (((isnotnull(d_date#23470) AND (d_date#23470 >= 1998-08-04)) AND (d_date#23470 <= 1998-09-03)) AND isnotnull(d_date_sk#23468L))
                  :     :              :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23468L,d_date#23470] Batched: true, DataFilters: [isnotnull(d_date#23470), (d_date#23470 >= 1998-08-04), (d_date#23470 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24314]
                  :     :                 +- Project [d_date_sk#23468L]
                  :     :                    +- Filter (((isnotnull(d_date#23470) AND (d_date#23470 >= 1998-08-04)) AND (d_date#23470 <= 1998-09-03)) AND isnotnull(d_date_sk#23468L))
                  :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23468L,d_date#23470] Batched: true, DataFilters: [isnotnull(d_date#23470), (d_date#23470 >= 1998-08-04), (d_date#23470 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :     +- BroadcastExchange IdentityBroadcastMode, [id=#24329]
                  :        +- HashAggregate(keys=[], functions=[sum(cr_return_amount#23513), sum(cr_net_loss#23521)], output=[returns#23271, profit_loss#23272])
                  :           +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#24326]
                  :              +- HashAggregate(keys=[], functions=[partial_sum(cr_return_amount#23513), partial_sum(cr_net_loss#23521)], output=[sum#23748, sum#23749])
                  :                 +- Project [cr_return_amount#23513, cr_net_loss#23521]
                  :                    +- BroadcastHashJoin [cr_returned_date_sk#23522L], [d_date_sk#23523L], Inner, BuildRight, false
                  :                       :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_return_amount#23513,cr_net_loss#23521,cr_returned_date_sk#23522L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#23522L), dynamicpruningexpression(cr_returned_date_sk#23522L IN dy..., PushedFilters: [], ReadSchema: struct<cr_return_amount:double,cr_net_loss:double>
                  :                       :     +- SubqueryAdaptiveBroadcast dynamicpruning#23725, 0, true, Project [d_date_sk#23523L], [d_date_sk#23523L]
                  :                       :        +- AdaptiveSparkPlan isFinalPlan=false
                  :                       :           +- Project [d_date_sk#23523L]
                  :                       :              +- Filter (((isnotnull(d_date#23525) AND (d_date#23525 >= 1998-08-04)) AND (d_date#23525 <= 1998-09-03)) AND isnotnull(d_date_sk#23523L))
                  :                       :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23523L,d_date#23525] Batched: true, DataFilters: [isnotnull(d_date#23525), (d_date#23525 >= 1998-08-04), (d_date#23525 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24321]
                  :                          +- Project [d_date_sk#23523L]
                  :                             +- Filter (((isnotnull(d_date#23525) AND (d_date#23525 >= 1998-08-04)) AND (d_date#23525 <= 1998-09-03)) AND isnotnull(d_date_sk#23523L))
                  :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23523L,d_date#23525] Batched: true, DataFilters: [isnotnull(d_date#23525), (d_date#23525 >= 1998-08-04), (d_date#23525 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  +- Project [sales#23273, coalesce(returns#23275, 0.0) AS returns#23260, (profit#23274 - coalesce(profit_loss#23276, 0.0)) AS profit#23261, web channel AS channel#23720, wp_web_page_sk#23613L AS id#23721L]
                     +- BroadcastHashJoin [wp_web_page_sk#23613L], [wp_web_page_sk#23679L], LeftOuter, BuildRight, false
                        :- HashAggregate(keys=[wp_web_page_sk#23613L], functions=[sum(ws_ext_sales_price#23573), sum(ws_net_profit#23583)], output=[wp_web_page_sk#23613L, sales#23273, profit#23274])
                        :  +- Exchange hashpartitioning(wp_web_page_sk#23613L, 3000), ENSURE_REQUIREMENTS, [id=#24341]
                        :     +- HashAggregate(keys=[wp_web_page_sk#23613L], functions=[partial_sum(ws_ext_sales_price#23573), partial_sum(ws_net_profit#23583)], output=[wp_web_page_sk#23613L, sum#23752, sum#23753])
                        :        +- Project [ws_ext_sales_price#23573, ws_net_profit#23583, wp_web_page_sk#23613L]
                        :           +- BroadcastHashJoin [ws_web_page_sk#23562L], [wp_web_page_sk#23613L], Inner, BuildRight, false
                        :              :- Project [ws_web_page_sk#23562L, ws_ext_sales_price#23573, ws_net_profit#23583]
                        :              :  +- BroadcastHashJoin [ws_sold_date_sk#23584L], [d_date_sk#23585L], Inner, BuildRight, false
                        :              :     :- Filter isnotnull(ws_web_page_sk#23562L)
                        :              :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_web_page_sk#23562L,ws_ext_sales_price#23573,ws_net_profit#23583,ws_sold_date_sk#23584L] Batched: true, DataFilters: [isnotnull(ws_web_page_sk#23562L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#23584L), dynamicpruningexpression(ws_sold_date_sk#23584L IN dynamicpru..., PushedFilters: [IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_web_page_sk:bigint,ws_ext_sales_price:double,ws_net_profit:double>
                        :              :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#23726, 0, true, Project [d_date_sk#23585L], [d_date_sk#23585L]
                        :              :     :           +- AdaptiveSparkPlan isFinalPlan=false
                        :              :     :              +- Project [d_date_sk#23585L]
                        :              :     :                 +- Filter (((isnotnull(d_date#23587) AND (d_date#23587 >= 1998-08-04)) AND (d_date#23587 <= 1998-09-03)) AND isnotnull(d_date_sk#23585L))
                        :              :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23585L,d_date#23587] Batched: true, DataFilters: [isnotnull(d_date#23587), (d_date#23587 >= 1998-08-04), (d_date#23587 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                        :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24332]
                        :              :        +- Project [d_date_sk#23585L]
                        :              :           +- Filter (((isnotnull(d_date#23587) AND (d_date#23587 >= 1998-08-04)) AND (d_date#23587 <= 1998-09-03)) AND isnotnull(d_date_sk#23585L))
                        :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23585L,d_date#23587] Batched: true, DataFilters: [isnotnull(d_date#23587), (d_date#23587 >= 1998-08-04), (d_date#23587 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                        :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24336]
                        :                 +- Filter isnotnull(wp_web_page_sk#23613L)
                        :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23613L] Batched: true, DataFilters: [isnotnull(wp_web_page_sk#23613L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(wp_web_page_sk)], ReadSchema: struct<wp_web_page_sk:bigint>
                        +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24355]
                           +- HashAggregate(keys=[wp_web_page_sk#23679L], functions=[sum(wr_return_amt#23641), sum(wr_net_loss#23649)], output=[wp_web_page_sk#23679L, returns#23275, profit_loss#23276])
                              +- Exchange hashpartitioning(wp_web_page_sk#23679L, 3000), ENSURE_REQUIREMENTS, [id=#24352]
                                 +- HashAggregate(keys=[wp_web_page_sk#23679L], functions=[partial_sum(wr_return_amt#23641), partial_sum(wr_net_loss#23649)], output=[wp_web_page_sk#23679L, sum#23756, sum#23757])
                                    +- Project [wr_return_amt#23641, wr_net_loss#23649, wp_web_page_sk#23679L]
                                       +- BroadcastHashJoin [wr_web_page_sk#23637L], [wp_web_page_sk#23679L], Inner, BuildRight, false
                                          :- Project [wr_web_page_sk#23637L, wr_return_amt#23641, wr_net_loss#23649]
                                          :  +- BroadcastHashJoin [wr_returned_date_sk#23650L], [d_date_sk#23651L], Inner, BuildRight, false
                                          :     :- Filter isnotnull(wr_web_page_sk#23637L)
                                          :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_web_page_sk#23637L,wr_return_amt#23641,wr_net_loss#23649,wr_returned_date_sk#23650L] Batched: true, DataFilters: [isnotnull(wr_web_page_sk#23637L)], Format: ORC, Location: InMemoryFileIndex(2184 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(wr_returned_date_sk#23650L), dynamicpruningexpression(wr_returned_date_sk#23650L IN dy..., PushedFilters: [IsNotNull(wr_web_page_sk)], ReadSchema: struct<wr_web_page_sk:bigint,wr_return_amt:double,wr_net_loss:double>
                                          :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#23727, 0, true, Project [d_date_sk#23651L], [d_date_sk#23651L]
                                          :     :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :     :              +- Project [d_date_sk#23651L]
                                          :     :                 +- Filter (((isnotnull(d_date#23653) AND (d_date#23653 >= 1998-08-04)) AND (d_date#23653 <= 1998-09-03)) AND isnotnull(d_date_sk#23651L))
                                          :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23651L,d_date#23653] Batched: true, DataFilters: [isnotnull(d_date#23653), (d_date#23653 >= 1998-08-04), (d_date#23653 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24343]
                                          :        +- Project [d_date_sk#23651L]
                                          :           +- Filter (((isnotnull(d_date#23653) AND (d_date#23653 >= 1998-08-04)) AND (d_date#23653 <= 1998-09-03)) AND isnotnull(d_date_sk#23651L))
                                          :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23651L,d_date#23653] Batched: true, DataFilters: [isnotnull(d_date#23653), (d_date#23653 >= 1998-08-04), (d_date#23653 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24347]
                                             +- Filter isnotnull(wp_web_page_sk#23679L)
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#23679L] Batched: true, DataFilters: [isnotnull(wp_web_page_sk#23679L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(wp_web_page_sk)], ReadSchema: struct<wp_web_page_sk:bigint>

read query: spark_queries/q78.sql
explain query: q78
== Parsed Logical Plan ==
CTE [ws, cs, ss]
:  :- 'SubqueryAlias ws
:  :  +- 'Aggregate ['d_year, 'ws_item_sk, 'ws_bill_customer_sk], ['d_year AS ws_sold_year#23765, 'ws_item_sk, 'ws_bill_customer_sk AS ws_customer_sk#23766, 'sum('ws_quantity) AS ws_qty#23767, 'sum('ws_wholesale_cost) AS ws_wc#23768, 'sum('ws_sales_price) AS ws_sp#23769]
:  :     +- 'Filter isnull('wr_order_number)
:  :        +- 'Join Inner, ('ws_sold_date_sk = 'd_date_sk)
:  :           :- 'Join LeftOuter, (('wr_order_number = 'ws_order_number) AND ('ws_item_sk = 'wr_item_sk))
:  :           :  :- 'UnresolvedRelation [web_sales], [], false
:  :           :  +- 'UnresolvedRelation [web_returns], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  :- 'SubqueryAlias cs
:  :  +- 'Aggregate ['d_year, 'cs_item_sk, 'cs_bill_customer_sk], ['d_year AS cs_sold_year#23770, 'cs_item_sk, 'cs_bill_customer_sk AS cs_customer_sk#23771, 'sum('cs_quantity) AS cs_qty#23772, 'sum('cs_wholesale_cost) AS cs_wc#23773, 'sum('cs_sales_price) AS cs_sp#23774]
:  :     +- 'Filter isnull('cr_order_number)
:  :        +- 'Join Inner, ('cs_sold_date_sk = 'd_date_sk)
:  :           :- 'Join LeftOuter, (('cr_order_number = 'cs_order_number) AND ('cs_item_sk = 'cr_item_sk))
:  :           :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  +- 'UnresolvedRelation [catalog_returns], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias ss
:     +- 'Aggregate ['d_year, 'ss_item_sk, 'ss_customer_sk], ['d_year AS ss_sold_year#23775, 'ss_item_sk, 'ss_customer_sk, 'sum('ss_quantity) AS ss_qty#23776, 'sum('ss_wholesale_cost) AS ss_wc#23777, 'sum('ss_sales_price) AS ss_sp#23778]
:        +- 'Filter isnull('sr_ticket_number)
:           +- 'Join Inner, ('ss_sold_date_sk = 'd_date_sk)
:              :- 'Join LeftOuter, (('sr_ticket_number = 'ss_ticket_number) AND ('ss_item_sk = 'sr_item_sk))
:              :  :- 'UnresolvedRelation [store_sales], [], false
:              :  +- 'UnresolvedRelation [store_returns], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['ss_sold_year ASC NULLS FIRST, 'ss_item_sk ASC NULLS FIRST, 'ss_customer_sk ASC NULLS FIRST, 'ss_qty DESC NULLS LAST, 'ss_wc DESC NULLS LAST, 'ss_sp DESC NULLS LAST, 'other_chan_qty ASC NULLS FIRST, 'other_chan_wholesale_cost ASC NULLS FIRST, 'other_chan_sales_price ASC NULLS FIRST, 'round(('ss_qty / 'coalesce(('ws_qty + 'cs_qty), 1)), 2) ASC NULLS FIRST], true
         +- 'Project ['ss_sold_year, 'ss_item_sk, 'ss_customer_sk, 'round(('ss_qty / 'coalesce(('ws_qty + 'cs_qty), 1)), 2) AS ratio#23758, 'ss_qty AS store_qty#23759, 'ss_wc AS store_wholesale_cost#23760, 'ss_sp AS store_sales_price#23761, ('coalesce('ws_qty, 0) + 'coalesce('cs_qty, 0)) AS other_chan_qty#23762, ('coalesce('ws_wc, 0) + 'coalesce('cs_wc, 0)) AS other_chan_wholesale_cost#23763, ('coalesce('ws_sp, 0) + 'coalesce('cs_sp, 0)) AS other_chan_sales_price#23764]
            +- 'Filter ((('coalesce('ws_qty, 0) > 0) AND ('coalesce('cs_qty, 0) > 0)) AND ('ss_sold_year = 2000))
               +- 'Join LeftOuter, ((('cs_sold_year = 'ss_sold_year) AND ('cs_item_sk = 'ss_item_sk)) AND ('cs_customer_sk = 'ss_customer_sk))
                  :- 'Join LeftOuter, ((('ws_sold_year = 'ss_sold_year) AND ('ws_item_sk = 'ss_item_sk)) AND ('ws_customer_sk = 'ss_customer_sk))
                  :  :- 'UnresolvedRelation [ss], [], false
                  :  +- 'UnresolvedRelation [ws], [], false
                  +- 'UnresolvedRelation [cs], [], false

== Analyzed Logical Plan ==
ss_sold_year: int, ss_item_sk: bigint, ss_customer_sk: bigint, ratio: double, store_qty: bigint, store_wholesale_cost: double, store_sales_price: double, other_chan_qty: bigint, other_chan_wholesale_cost: double, other_chan_sales_price: double
WithCTE
:- CTERelationDef 56
:  +- SubqueryAlias ws
:     +- Aggregate [d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L], [d_year#23843 AS ws_sold_year#23765, ws_item_sk#23781L, ws_bill_customer_sk#23782L AS ws_customer_sk#23766L, sum(ws_quantity#23796) AS ws_qty#23767L, sum(ws_wholesale_cost#23797) AS ws_wc#23768, sum(ws_sales_price#23799) AS ws_sp#23769]
:        +- Filter isnull(wr_order_number#23825L)
:           +- Join Inner, (ws_sold_date_sk#23812L = d_date_sk#23837L)
:              :- Join LeftOuter, ((wr_order_number#23825L = ws_order_number#23795L) AND (ws_item_sk#23781L = wr_item_sk#23814L))
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23779L,ws_ship_date_sk#23780L,ws_item_sk#23781L,ws_bill_customer_sk#23782L,ws_bill_cdemo_sk#23783L,ws_bill_hdemo_sk#23784L,ws_bill_addr_sk#23785L,ws_ship_customer_sk#23786L,ws_ship_cdemo_sk#23787L,ws_ship_hdemo_sk#23788L,ws_ship_addr_sk#23789L,ws_web_page_sk#23790L,ws_web_site_sk#23791L,ws_ship_mode_sk#23792L,ws_warehouse_sk#23793L,ws_promo_sk#23794L,ws_order_number#23795L,ws_quantity#23796,ws_wholesale_cost#23797,ws_list_price#23798,ws_sales_price#23799,ws_ext_discount_amt#23800,ws_ext_sales_price#23801,ws_ext_wholesale_cost#23802,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#23813L,wr_item_sk#23814L,wr_refunded_customer_sk#23815L,wr_refunded_cdemo_sk#23816L,wr_refunded_hdemo_sk#23817L,wr_refunded_addr_sk#23818L,wr_returning_customer_sk#23819L,wr_returning_cdemo_sk#23820L,wr_returning_hdemo_sk#23821L,wr_returning_addr_sk#23822L,wr_web_page_sk#23823L,wr_reason_sk#23824L,wr_order_number#23825L,wr_return_quantity#23826,wr_return_amt#23827,wr_return_tax#23828,wr_return_amt_inc_tax#23829,wr_fee#23830,wr_return_ship_cost#23831,wr_refunded_cash#23832,wr_reversed_charge#23833,wr_account_credit#23834,wr_net_loss#23835,wr_returned_date_sk#23836L] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23837L,d_date_id#23838,d_date#23839,d_month_seq#23840,d_week_seq#23841,d_quarter_seq#23842,d_year#23843,d_dow#23844,d_moy#23845,d_dom#23846,d_qoy#23847,d_fy_year#23848,d_fy_quarter_seq#23849,d_fy_week_seq#23850,d_day_name#23851,d_quarter_name#23852,d_holiday#23853,d_weekend#23854,d_following_holiday#23855,d_first_dom#23856,d_last_dom#23857,d_same_day_ly#23858,d_same_day_lq#23859,d_current_day#23860,... 4 more fields] orc
:- CTERelationDef 57
:  +- SubqueryAlias cs
:     +- Aggregate [d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L], [d_year#23932 AS cs_sold_year#23770, cs_item_sk#23879L, cs_bill_customer_sk#23867L AS cs_customer_sk#23771L, sum(cs_quantity#23882) AS cs_qty#23772L, sum(cs_wholesale_cost#23883) AS cs_wc#23773, sum(cs_sales_price#23885) AS cs_sp#23774]
:        +- Filter isnull(cr_order_number#23914L)
:           +- Join Inner, (cs_sold_date_sk#23898L = d_date_sk#23926L)
:              :- Join LeftOuter, ((cr_order_number#23914L = cs_order_number#23881L) AND (cs_item_sk#23879L = cr_item_sk#23900L))
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23865L,cs_ship_date_sk#23866L,cs_bill_customer_sk#23867L,cs_bill_cdemo_sk#23868L,cs_bill_hdemo_sk#23869L,cs_bill_addr_sk#23870L,cs_ship_customer_sk#23871L,cs_ship_cdemo_sk#23872L,cs_ship_hdemo_sk#23873L,cs_ship_addr_sk#23874L,cs_call_center_sk#23875L,cs_catalog_page_sk#23876L,cs_ship_mode_sk#23877L,cs_warehouse_sk#23878L,cs_item_sk#23879L,cs_promo_sk#23880L,cs_order_number#23881L,cs_quantity#23882,cs_wholesale_cost#23883,cs_list_price#23884,cs_sales_price#23885,cs_ext_discount_amt#23886,cs_ext_sales_price#23887,cs_ext_wholesale_cost#23888,... 10 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#23899L,cr_item_sk#23900L,cr_refunded_customer_sk#23901L,cr_refunded_cdemo_sk#23902L,cr_refunded_hdemo_sk#23903L,cr_refunded_addr_sk#23904L,cr_returning_customer_sk#23905L,cr_returning_cdemo_sk#23906L,cr_returning_hdemo_sk#23907L,cr_returning_addr_sk#23908L,cr_call_center_sk#23909L,cr_catalog_page_sk#23910L,cr_ship_mode_sk#23911L,cr_warehouse_sk#23912L,cr_reason_sk#23913L,cr_order_number#23914L,cr_return_quantity#23915,cr_return_amount#23916,cr_return_tax#23917,cr_return_amt_inc_tax#23918,cr_fee#23919,cr_return_ship_cost#23920,cr_refunded_cash#23921,cr_reversed_charge#23922,... 3 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23926L,d_date_id#23927,d_date#23928,d_month_seq#23929,d_week_seq#23930,d_quarter_seq#23931,d_year#23932,d_dow#23933,d_moy#23934,d_dom#23935,d_qoy#23936,d_fy_year#23937,d_fy_quarter_seq#23938,d_fy_week_seq#23939,d_day_name#23940,d_quarter_name#23941,d_holiday#23942,d_weekend#23943,d_following_holiday#23944,d_first_dom#23945,d_last_dom#23946,d_same_day_ly#23947,d_same_day_lq#23948,d_current_day#23949,... 4 more fields] orc
:- CTERelationDef 58
:  +- SubqueryAlias ss
:     +- Aggregate [d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L], [d_year#24003 AS ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, sum(ss_quantity#23963) AS ss_qty#23776L, sum(ss_wholesale_cost#23964) AS ss_wc#23777, sum(ss_sales_price#23966) AS ss_sp#23778]
:        +- Filter isnull(sr_ticket_number#23985L)
:           +- Join Inner, (ss_sold_date_sk#23976L = d_date_sk#23997L)
:              :- Join LeftOuter, ((sr_ticket_number#23985L = ss_ticket_number#23962L) AND (ss_item_sk#23955L = sr_item_sk#23978L))
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#23954L,ss_item_sk#23955L,ss_customer_sk#23956L,ss_cdemo_sk#23957L,ss_hdemo_sk#23958L,ss_addr_sk#23959L,ss_store_sk#23960L,ss_promo_sk#23961L,ss_ticket_number#23962L,ss_quantity#23963,ss_wholesale_cost#23964,ss_list_price#23965,ss_sales_price#23966,ss_ext_discount_amt#23967,ss_ext_sales_price#23968,ss_ext_wholesale_cost#23969,ss_ext_list_price#23970,ss_ext_tax#23971,ss_coupon_amt#23972,ss_net_paid#23973,ss_net_paid_inc_tax#23974,ss_net_profit#23975,ss_sold_date_sk#23976L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#23977L,sr_item_sk#23978L,sr_customer_sk#23979L,sr_cdemo_sk#23980L,sr_hdemo_sk#23981L,sr_addr_sk#23982L,sr_store_sk#23983L,sr_reason_sk#23984L,sr_ticket_number#23985L,sr_return_quantity#23986,sr_return_amt#23987,sr_return_tax#23988,sr_return_amt_inc_tax#23989,sr_fee#23990,sr_return_ship_cost#23991,sr_refunded_cash#23992,sr_reversed_charge#23993,sr_store_credit#23994,sr_net_loss#23995,sr_returned_date_sk#23996L] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23997L,d_date_id#23998,d_date#23999,d_month_seq#24000,d_week_seq#24001,d_quarter_seq#24002,d_year#24003,d_dow#24004,d_moy#24005,d_dom#24006,d_qoy#24007,d_fy_year#24008,d_fy_quarter_seq#24009,d_fy_week_seq#24010,d_day_name#24011,d_quarter_name#24012,d_holiday#24013,d_weekend#24014,d_following_holiday#24015,d_first_dom#24016,d_last_dom#24017,d_same_day_ly#24018,d_same_day_lq#24019,d_current_day#24020,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ratio#23758, store_qty#23759L, store_wholesale_cost#23760, store_sales_price#23761, other_chan_qty#23762L, other_chan_wholesale_cost#23763, other_chan_sales_price#23764]
         +- Sort [ss_sold_year#23775 ASC NULLS FIRST, ss_item_sk#23955L ASC NULLS FIRST, ss_customer_sk#23956L ASC NULLS FIRST, ss_qty#23776L DESC NULLS LAST, ss_wc#23777 DESC NULLS LAST, ss_sp#23778 DESC NULLS LAST, other_chan_qty#23762L ASC NULLS FIRST, other_chan_wholesale_cost#23763 ASC NULLS FIRST, other_chan_sales_price#23764 ASC NULLS FIRST, round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), cast(1 as bigint)) as double)), 2) ASC NULLS FIRST], true
            +- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), cast(1 as bigint)) as double)), 2) AS ratio#23758, ss_qty#23776L AS store_qty#23759L, ss_wc#23777 AS store_wholesale_cost#23760, ss_sp#23778 AS store_sales_price#23761, (coalesce(ws_qty#23767L, cast(0 as bigint)) + coalesce(cs_qty#23772L, cast(0 as bigint))) AS other_chan_qty#23762L, (coalesce(ws_wc#23768, cast(0 as double)) + coalesce(cs_wc#23773, cast(0 as double))) AS other_chan_wholesale_cost#23763, (coalesce(ws_sp#23769, cast(0 as double)) + coalesce(cs_sp#23774, cast(0 as double))) AS other_chan_sales_price#23764, ss_qty#23776L, ss_wc#23777, ss_sp#23778, ws_qty#23767L, cs_qty#23772L]
               +- Filter (((coalesce(ws_qty#23767L, cast(0 as bigint)) > cast(0 as bigint)) AND (coalesce(cs_qty#23772L, cast(0 as bigint)) > cast(0 as bigint))) AND (ss_sold_year#23775 = 2000))
                  +- Join LeftOuter, (((cs_sold_year#23770 = ss_sold_year#23775) AND (cs_item_sk#23879L = ss_item_sk#23955L)) AND (cs_customer_sk#23771L = ss_customer_sk#23956L))
                     :- Join LeftOuter, (((ws_sold_year#23765 = ss_sold_year#23775) AND (ws_item_sk#23781L = ss_item_sk#23955L)) AND (ws_customer_sk#23766L = ss_customer_sk#23956L))
                     :  :- SubqueryAlias ss
                     :  :  +- CTERelationRef 58, true, [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ss_qty#23776L, ss_wc#23777, ss_sp#23778]
                     :  +- SubqueryAlias ws
                     :     +- CTERelationRef 56, true, [ws_sold_year#23765, ws_item_sk#23781L, ws_customer_sk#23766L, ws_qty#23767L, ws_wc#23768, ws_sp#23769]
                     +- SubqueryAlias cs
                        +- CTERelationRef 57, true, [cs_sold_year#23770, cs_item_sk#23879L, cs_customer_sk#23771L, cs_qty#23772L, cs_wc#23773, cs_sp#23774]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ratio#23758, store_qty#23759L, store_wholesale_cost#23760, store_sales_price#23761, other_chan_qty#23762L, other_chan_wholesale_cost#23763, other_chan_sales_price#23764]
      +- Sort [ss_sold_year#23775 ASC NULLS FIRST, ss_item_sk#23955L ASC NULLS FIRST, ss_customer_sk#23956L ASC NULLS FIRST, ss_qty#23776L DESC NULLS LAST, ss_wc#23777 DESC NULLS LAST, ss_sp#23778 DESC NULLS LAST, other_chan_qty#23762L ASC NULLS FIRST, other_chan_wholesale_cost#23763 ASC NULLS FIRST, other_chan_sales_price#23764 ASC NULLS FIRST, round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), 1) as double)), 2) ASC NULLS FIRST], true
         +- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), 1) as double)), 2) AS ratio#23758, ss_qty#23776L AS store_qty#23759L, ss_wc#23777 AS store_wholesale_cost#23760, ss_sp#23778 AS store_sales_price#23761, (coalesce(ws_qty#23767L, 0) + coalesce(cs_qty#23772L, 0)) AS other_chan_qty#23762L, (coalesce(ws_wc#23768, 0.0) + coalesce(cs_wc#23773, 0.0)) AS other_chan_wholesale_cost#23763, (coalesce(ws_sp#23769, 0.0) + coalesce(cs_sp#23774, 0.0)) AS other_chan_sales_price#23764, ss_qty#23776L, ss_wc#23777, ss_sp#23778, ws_qty#23767L, cs_qty#23772L]
            +- Join Inner, (((cs_sold_year#23770 = ss_sold_year#23775) AND (cs_item_sk#23879L = ss_item_sk#23955L)) AND (cs_customer_sk#23771L = ss_customer_sk#23956L))
               :- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ss_qty#23776L, ss_wc#23777, ss_sp#23778, ws_qty#23767L, ws_wc#23768, ws_sp#23769]
               :  +- Join Inner, (((ws_sold_year#23765 = ss_sold_year#23775) AND (ws_item_sk#23781L = ss_item_sk#23955L)) AND (ws_customer_sk#23766L = ss_customer_sk#23956L))
               :     :- Aggregate [d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L], [d_year#24003 AS ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, sum(ss_quantity#23963) AS ss_qty#23776L, sum(ss_wholesale_cost#23964) AS ss_wc#23777, sum(ss_sales_price#23966) AS ss_sp#23778]
               :     :  +- Project [ss_item_sk#23955L, ss_customer_sk#23956L, ss_quantity#23963, ss_wholesale_cost#23964, ss_sales_price#23966, d_year#24003]
               :     :     +- Join Inner, (ss_sold_date_sk#23976L = d_date_sk#23997L)
               :     :        :- Project [ss_item_sk#23955L, ss_customer_sk#23956L, ss_quantity#23963, ss_wholesale_cost#23964, ss_sales_price#23966, ss_sold_date_sk#23976L]
               :     :        :  +- Filter isnull(sr_ticket_number#23985L)
               :     :        :     +- Join LeftOuter, ((sr_ticket_number#23985L = ss_ticket_number#23962L) AND (ss_item_sk#23955L = sr_item_sk#23978L))
               :     :        :        :- Project [ss_item_sk#23955L, ss_customer_sk#23956L, ss_ticket_number#23962L, ss_quantity#23963, ss_wholesale_cost#23964, ss_sales_price#23966, ss_sold_date_sk#23976L]
               :     :        :        :  +- Filter (((isnotnull(ss_sold_date_sk#23976L) AND isnotnull(ss_item_sk#23955L)) AND isnotnull(ss_customer_sk#23956L)) AND dynamicpruning#24044 [ss_sold_date_sk#23976L])
               :     :        :        :     :  +- Project [d_date_sk#23997L, d_year#24003]
               :     :        :        :     :     +- Filter ((isnotnull(d_year#24003) AND (d_year#24003 = 2000)) AND isnotnull(d_date_sk#23997L))
               :     :        :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23997L,d_date_id#23998,d_date#23999,d_month_seq#24000,d_week_seq#24001,d_quarter_seq#24002,d_year#24003,d_dow#24004,d_moy#24005,d_dom#24006,d_qoy#24007,d_fy_year#24008,d_fy_quarter_seq#24009,d_fy_week_seq#24010,d_day_name#24011,d_quarter_name#24012,d_holiday#24013,d_weekend#24014,d_following_holiday#24015,d_first_dom#24016,d_last_dom#24017,d_same_day_ly#24018,d_same_day_lq#24019,d_current_day#24020,... 4 more fields] orc
               :     :        :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#23954L,ss_item_sk#23955L,ss_customer_sk#23956L,ss_cdemo_sk#23957L,ss_hdemo_sk#23958L,ss_addr_sk#23959L,ss_store_sk#23960L,ss_promo_sk#23961L,ss_ticket_number#23962L,ss_quantity#23963,ss_wholesale_cost#23964,ss_list_price#23965,ss_sales_price#23966,ss_ext_discount_amt#23967,ss_ext_sales_price#23968,ss_ext_wholesale_cost#23969,ss_ext_list_price#23970,ss_ext_tax#23971,ss_coupon_amt#23972,ss_net_paid#23973,ss_net_paid_inc_tax#23974,ss_net_profit#23975,ss_sold_date_sk#23976L] orc
               :     :        :        +- Project [sr_item_sk#23978L, sr_ticket_number#23985L]
               :     :        :           +- Filter (isnotnull(sr_ticket_number#23985L) AND isnotnull(sr_item_sk#23978L))
               :     :        :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#23977L,sr_item_sk#23978L,sr_customer_sk#23979L,sr_cdemo_sk#23980L,sr_hdemo_sk#23981L,sr_addr_sk#23982L,sr_store_sk#23983L,sr_reason_sk#23984L,sr_ticket_number#23985L,sr_return_quantity#23986,sr_return_amt#23987,sr_return_tax#23988,sr_return_amt_inc_tax#23989,sr_fee#23990,sr_return_ship_cost#23991,sr_refunded_cash#23992,sr_reversed_charge#23993,sr_store_credit#23994,sr_net_loss#23995,sr_returned_date_sk#23996L] orc
               :     :        +- Project [d_date_sk#23997L, d_year#24003]
               :     :           +- Filter ((isnotnull(d_year#24003) AND (d_year#24003 = 2000)) AND isnotnull(d_date_sk#23997L))
               :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23997L,d_date_id#23998,d_date#23999,d_month_seq#24000,d_week_seq#24001,d_quarter_seq#24002,d_year#24003,d_dow#24004,d_moy#24005,d_dom#24006,d_qoy#24007,d_fy_year#24008,d_fy_quarter_seq#24009,d_fy_week_seq#24010,d_day_name#24011,d_quarter_name#24012,d_holiday#24013,d_weekend#24014,d_following_holiday#24015,d_first_dom#24016,d_last_dom#24017,d_same_day_ly#24018,d_same_day_lq#24019,d_current_day#24020,... 4 more fields] orc
               :     +- Filter (coalesce(ws_qty#23767L, 0) > 0)
               :        +- Aggregate [d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L], [d_year#23843 AS ws_sold_year#23765, ws_item_sk#23781L, ws_bill_customer_sk#23782L AS ws_customer_sk#23766L, sum(ws_quantity#23796) AS ws_qty#23767L, sum(ws_wholesale_cost#23797) AS ws_wc#23768, sum(ws_sales_price#23799) AS ws_sp#23769]
               :           +- Project [ws_item_sk#23781L, ws_bill_customer_sk#23782L, ws_quantity#23796, ws_wholesale_cost#23797, ws_sales_price#23799, d_year#23843]
               :              +- Join Inner, (ws_sold_date_sk#23812L = d_date_sk#23837L)
               :                 :- Project [ws_item_sk#23781L, ws_bill_customer_sk#23782L, ws_quantity#23796, ws_wholesale_cost#23797, ws_sales_price#23799, ws_sold_date_sk#23812L]
               :                 :  +- Filter isnull(wr_order_number#23825L)
               :                 :     +- Join LeftOuter, ((wr_order_number#23825L = ws_order_number#23795L) AND (ws_item_sk#23781L = wr_item_sk#23814L))
               :                 :        :- Project [ws_item_sk#23781L, ws_bill_customer_sk#23782L, ws_order_number#23795L, ws_quantity#23796, ws_wholesale_cost#23797, ws_sales_price#23799, ws_sold_date_sk#23812L]
               :                 :        :  +- Filter (((isnotnull(ws_sold_date_sk#23812L) AND isnotnull(ws_item_sk#23781L)) AND isnotnull(ws_bill_customer_sk#23782L)) AND dynamicpruning#24045 [ws_sold_date_sk#23812L])
               :                 :        :     :  +- Project [d_date_sk#23837L, d_year#23843]
               :                 :        :     :     +- Filter (isnotnull(d_date_sk#23837L) AND ((d_year#23843 = 2000) AND isnotnull(d_year#23843)))
               :                 :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23837L,d_date_id#23838,d_date#23839,d_month_seq#23840,d_week_seq#23841,d_quarter_seq#23842,d_year#23843,d_dow#23844,d_moy#23845,d_dom#23846,d_qoy#23847,d_fy_year#23848,d_fy_quarter_seq#23849,d_fy_week_seq#23850,d_day_name#23851,d_quarter_name#23852,d_holiday#23853,d_weekend#23854,d_following_holiday#23855,d_first_dom#23856,d_last_dom#23857,d_same_day_ly#23858,d_same_day_lq#23859,d_current_day#23860,... 4 more fields] orc
               :                 :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#23779L,ws_ship_date_sk#23780L,ws_item_sk#23781L,ws_bill_customer_sk#23782L,ws_bill_cdemo_sk#23783L,ws_bill_hdemo_sk#23784L,ws_bill_addr_sk#23785L,ws_ship_customer_sk#23786L,ws_ship_cdemo_sk#23787L,ws_ship_hdemo_sk#23788L,ws_ship_addr_sk#23789L,ws_web_page_sk#23790L,ws_web_site_sk#23791L,ws_ship_mode_sk#23792L,ws_warehouse_sk#23793L,ws_promo_sk#23794L,ws_order_number#23795L,ws_quantity#23796,ws_wholesale_cost#23797,ws_list_price#23798,ws_sales_price#23799,ws_ext_discount_amt#23800,ws_ext_sales_price#23801,ws_ext_wholesale_cost#23802,... 10 more fields] orc
               :                 :        +- Project [wr_item_sk#23814L, wr_order_number#23825L]
               :                 :           +- Filter (isnotnull(wr_order_number#23825L) AND isnotnull(wr_item_sk#23814L))
               :                 :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#23813L,wr_item_sk#23814L,wr_refunded_customer_sk#23815L,wr_refunded_cdemo_sk#23816L,wr_refunded_hdemo_sk#23817L,wr_refunded_addr_sk#23818L,wr_returning_customer_sk#23819L,wr_returning_cdemo_sk#23820L,wr_returning_hdemo_sk#23821L,wr_returning_addr_sk#23822L,wr_web_page_sk#23823L,wr_reason_sk#23824L,wr_order_number#23825L,wr_return_quantity#23826,wr_return_amt#23827,wr_return_tax#23828,wr_return_amt_inc_tax#23829,wr_fee#23830,wr_return_ship_cost#23831,wr_refunded_cash#23832,wr_reversed_charge#23833,wr_account_credit#23834,wr_net_loss#23835,wr_returned_date_sk#23836L] orc
               :                 +- Project [d_date_sk#23837L, d_year#23843]
               :                    +- Filter (isnotnull(d_date_sk#23837L) AND ((d_year#23843 = 2000) AND isnotnull(d_year#23843)))
               :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23837L,d_date_id#23838,d_date#23839,d_month_seq#23840,d_week_seq#23841,d_quarter_seq#23842,d_year#23843,d_dow#23844,d_moy#23845,d_dom#23846,d_qoy#23847,d_fy_year#23848,d_fy_quarter_seq#23849,d_fy_week_seq#23850,d_day_name#23851,d_quarter_name#23852,d_holiday#23853,d_weekend#23854,d_following_holiday#23855,d_first_dom#23856,d_last_dom#23857,d_same_day_ly#23858,d_same_day_lq#23859,d_current_day#23860,... 4 more fields] orc
               +- Filter (coalesce(cs_qty#23772L, 0) > 0)
                  +- Aggregate [d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L], [d_year#23932 AS cs_sold_year#23770, cs_item_sk#23879L, cs_bill_customer_sk#23867L AS cs_customer_sk#23771L, sum(cs_quantity#23882) AS cs_qty#23772L, sum(cs_wholesale_cost#23883) AS cs_wc#23773, sum(cs_sales_price#23885) AS cs_sp#23774]
                     +- Project [cs_bill_customer_sk#23867L, cs_item_sk#23879L, cs_quantity#23882, cs_wholesale_cost#23883, cs_sales_price#23885, d_year#23932]
                        +- Join Inner, (cs_sold_date_sk#23898L = d_date_sk#23926L)
                           :- Project [cs_bill_customer_sk#23867L, cs_item_sk#23879L, cs_quantity#23882, cs_wholesale_cost#23883, cs_sales_price#23885, cs_sold_date_sk#23898L]
                           :  +- Filter isnull(cr_order_number#23914L)
                           :     +- Join LeftOuter, ((cr_order_number#23914L = cs_order_number#23881L) AND (cs_item_sk#23879L = cr_item_sk#23900L))
                           :        :- Project [cs_bill_customer_sk#23867L, cs_item_sk#23879L, cs_order_number#23881L, cs_quantity#23882, cs_wholesale_cost#23883, cs_sales_price#23885, cs_sold_date_sk#23898L]
                           :        :  +- Filter (((isnotnull(cs_sold_date_sk#23898L) AND isnotnull(cs_item_sk#23879L)) AND isnotnull(cs_bill_customer_sk#23867L)) AND dynamicpruning#24046 [cs_sold_date_sk#23898L])
                           :        :     :  +- Project [d_date_sk#23926L, d_year#23932]
                           :        :     :     +- Filter (isnotnull(d_date_sk#23926L) AND ((d_year#23932 = 2000) AND isnotnull(d_year#23932)))
                           :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23926L,d_date_id#23927,d_date#23928,d_month_seq#23929,d_week_seq#23930,d_quarter_seq#23931,d_year#23932,d_dow#23933,d_moy#23934,d_dom#23935,d_qoy#23936,d_fy_year#23937,d_fy_quarter_seq#23938,d_fy_week_seq#23939,d_day_name#23940,d_quarter_name#23941,d_holiday#23942,d_weekend#23943,d_following_holiday#23944,d_first_dom#23945,d_last_dom#23946,d_same_day_ly#23947,d_same_day_lq#23948,d_current_day#23949,... 4 more fields] orc
                           :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#23865L,cs_ship_date_sk#23866L,cs_bill_customer_sk#23867L,cs_bill_cdemo_sk#23868L,cs_bill_hdemo_sk#23869L,cs_bill_addr_sk#23870L,cs_ship_customer_sk#23871L,cs_ship_cdemo_sk#23872L,cs_ship_hdemo_sk#23873L,cs_ship_addr_sk#23874L,cs_call_center_sk#23875L,cs_catalog_page_sk#23876L,cs_ship_mode_sk#23877L,cs_warehouse_sk#23878L,cs_item_sk#23879L,cs_promo_sk#23880L,cs_order_number#23881L,cs_quantity#23882,cs_wholesale_cost#23883,cs_list_price#23884,cs_sales_price#23885,cs_ext_discount_amt#23886,cs_ext_sales_price#23887,cs_ext_wholesale_cost#23888,... 10 more fields] orc
                           :        +- Project [cr_item_sk#23900L, cr_order_number#23914L]
                           :           +- Filter (isnotnull(cr_order_number#23914L) AND isnotnull(cr_item_sk#23900L))
                           :              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#23899L,cr_item_sk#23900L,cr_refunded_customer_sk#23901L,cr_refunded_cdemo_sk#23902L,cr_refunded_hdemo_sk#23903L,cr_refunded_addr_sk#23904L,cr_returning_customer_sk#23905L,cr_returning_cdemo_sk#23906L,cr_returning_hdemo_sk#23907L,cr_returning_addr_sk#23908L,cr_call_center_sk#23909L,cr_catalog_page_sk#23910L,cr_ship_mode_sk#23911L,cr_warehouse_sk#23912L,cr_reason_sk#23913L,cr_order_number#23914L,cr_return_quantity#23915,cr_return_amount#23916,cr_return_tax#23917,cr_return_amt_inc_tax#23918,cr_fee#23919,cr_return_ship_cost#23920,cr_refunded_cash#23921,cr_reversed_charge#23922,... 3 more fields] orc
                           +- Project [d_date_sk#23926L, d_year#23932]
                              +- Filter (isnotnull(d_date_sk#23926L) AND ((d_year#23932 = 2000) AND isnotnull(d_year#23932)))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23926L,d_date_id#23927,d_date#23928,d_month_seq#23929,d_week_seq#23930,d_quarter_seq#23931,d_year#23932,d_dow#23933,d_moy#23934,d_dom#23935,d_qoy#23936,d_fy_year#23937,d_fy_quarter_seq#23938,d_fy_week_seq#23939,d_day_name#23940,d_quarter_name#23941,d_holiday#23942,d_weekend#23943,d_following_holiday#23944,d_first_dom#23945,d_last_dom#23946,d_same_day_ly#23947,d_same_day_lq#23948,d_current_day#23949,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[ss_sold_year#23775 ASC NULLS FIRST,ss_item_sk#23955L ASC NULLS FIRST,ss_customer_sk#23956L ASC NULLS FIRST,ss_qty#23776L DESC NULLS LAST,ss_wc#23777 DESC NULLS LAST,ss_sp#23778 DESC NULLS LAST,other_chan_qty#23762L ASC NULLS FIRST,other_chan_wholesale_cost#23763 ASC NULLS FIRST,other_chan_sales_price#23764 ASC NULLS FIRST,round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), 1) as double)), 2) ASC NULLS FIRST], output=[ss_sold_year#23775,ss_item_sk#23955L,ss_customer_sk#23956L,ratio#23758,store_qty#23759L,store_wholesale_cost#23760,store_sales_price#23761,other_chan_qty#23762L,other_chan_wholesale_cost#23763,other_chan_sales_price#23764])
   +- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, round((cast(ss_qty#23776L as double) / cast(coalesce((ws_qty#23767L + cs_qty#23772L), 1) as double)), 2) AS ratio#23758, ss_qty#23776L AS store_qty#23759L, ss_wc#23777 AS store_wholesale_cost#23760, ss_sp#23778 AS store_sales_price#23761, (coalesce(ws_qty#23767L, 0) + coalesce(cs_qty#23772L, 0)) AS other_chan_qty#23762L, (coalesce(ws_wc#23768, 0.0) + coalesce(cs_wc#23773, 0.0)) AS other_chan_wholesale_cost#23763, (coalesce(ws_sp#23769, 0.0) + coalesce(cs_sp#23774, 0.0)) AS other_chan_sales_price#23764, ss_qty#23776L, ss_wc#23777, ss_sp#23778, ws_qty#23767L, cs_qty#23772L]
      +- SortMergeJoin [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L], [cs_sold_year#23770, cs_item_sk#23879L, cs_customer_sk#23771L], Inner
         :- Project [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ss_qty#23776L, ss_wc#23777, ss_sp#23778, ws_qty#23767L, ws_wc#23768, ws_sp#23769]
         :  +- SortMergeJoin [ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L], [ws_sold_year#23765, ws_item_sk#23781L, ws_customer_sk#23766L], Inner
         :     :- Sort [ss_sold_year#23775 ASC NULLS FIRST, ss_item_sk#23955L ASC NULLS FIRST, ss_customer_sk#23956L ASC NULLS FIRST], false, 0
         :     :  +- HashAggregate(keys=[d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L], functions=[sum(ss_quantity#23963), sum(ss_wholesale_cost#23964), sum(ss_sales_price#23966)], output=[ss_sold_year#23775, ss_item_sk#23955L, ss_customer_sk#23956L, ss_qty#23776L, ss_wc#23777, ss_sp#23778])
         :     :     +- Exchange hashpartitioning(d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L, 3000), ENSURE_REQUIREMENTS, [id=#24642]
         :     :        +- HashAggregate(keys=[d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L], functions=[partial_sum(ss_quantity#23963), partial_sum(ss_wholesale_cost#23964), partial_sum(ss_sales_price#23966)], output=[d_year#24003, ss_item_sk#23955L, ss_customer_sk#23956L, sum#24050L, sum#24051, sum#24052])
         :     :           +- Project [ss_item_sk#23955L, ss_customer_sk#23956L, ss_quantity#23963, ss_wholesale_cost#23964, ss_sales_price#23966, d_year#24003]
         :     :              +- BroadcastHashJoin [ss_sold_date_sk#23976L], [d_date_sk#23997L], Inner, BuildRight, false
         :     :                 :- Project [ss_item_sk#23955L, ss_customer_sk#23956L, ss_quantity#23963, ss_wholesale_cost#23964, ss_sales_price#23966, ss_sold_date_sk#23976L]
         :     :                 :  +- Filter isnull(sr_ticket_number#23985L)
         :     :                 :     +- SortMergeJoin [ss_ticket_number#23962L, ss_item_sk#23955L], [sr_ticket_number#23985L, sr_item_sk#23978L], LeftOuter
         :     :                 :        :- Sort [ss_ticket_number#23962L ASC NULLS FIRST, ss_item_sk#23955L ASC NULLS FIRST], false, 0
         :     :                 :        :  +- Exchange hashpartitioning(ss_ticket_number#23962L, ss_item_sk#23955L, 3000), ENSURE_REQUIREMENTS, [id=#24629]
         :     :                 :        :     +- Filter (isnotnull(ss_item_sk#23955L) AND isnotnull(ss_customer_sk#23956L))
         :     :                 :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#23955L,ss_customer_sk#23956L,ss_ticket_number#23962L,ss_quantity#23963,ss_wholesale_cost#23964,ss_sales_price#23966,ss_sold_date_sk#23976L] Batched: true, DataFilters: [isnotnull(ss_item_sk#23955L), isnotnull(ss_customer_sk#23956L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#23976L), dynamicpruningexpression(ss_sold_date_sk#23976L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_ticket_number:bigint,ss_quantity:int,ss_wholesa...
         :     :                 :        :              +- SubqueryAdaptiveBroadcast dynamicpruning#24044, 0, true, Project [d_date_sk#23997L, d_year#24003], [d_date_sk#23997L]
         :     :                 :        :                 +- AdaptiveSparkPlan isFinalPlan=false
         :     :                 :        :                    +- Filter ((isnotnull(d_year#24003) AND (d_year#24003 = 2000)) AND isnotnull(d_date_sk#23997L))
         :     :                 :        :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23997L,d_year#24003] Batched: true, DataFilters: [isnotnull(d_year#24003), (d_year#24003 = 2000), isnotnull(d_date_sk#23997L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     :                 :        +- Sort [sr_ticket_number#23985L ASC NULLS FIRST, sr_item_sk#23978L ASC NULLS FIRST], false, 0
         :     :                 :           +- Exchange hashpartitioning(sr_ticket_number#23985L, sr_item_sk#23978L, 3000), ENSURE_REQUIREMENTS, [id=#24630]
         :     :                 :              +- Project [sr_item_sk#23978L, sr_ticket_number#23985L]
         :     :                 :                 +- Filter (isnotnull(sr_ticket_number#23985L) AND isnotnull(sr_item_sk#23978L))
         :     :                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#23978L,sr_ticket_number#23985L,sr_returned_date_sk#23996L] Batched: true, DataFilters: [isnotnull(sr_ticket_number#23985L), isnotnull(sr_item_sk#23978L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint>
         :     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24637]
         :     :                    +- Filter ((isnotnull(d_year#24003) AND (d_year#24003 = 2000)) AND isnotnull(d_date_sk#23997L))
         :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23997L,d_year#24003] Batched: true, DataFilters: [isnotnull(d_year#24003), (d_year#24003 = 2000), isnotnull(d_date_sk#23997L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :     +- Sort [ws_sold_year#23765 ASC NULLS FIRST, ws_item_sk#23781L ASC NULLS FIRST, ws_customer_sk#23766L ASC NULLS FIRST], false, 0
         :        +- Filter (coalesce(ws_qty#23767L, 0) > 0)
         :           +- HashAggregate(keys=[d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L], functions=[sum(ws_quantity#23796), sum(ws_wholesale_cost#23797), sum(ws_sales_price#23799)], output=[ws_sold_year#23765, ws_item_sk#23781L, ws_customer_sk#23766L, ws_qty#23767L, ws_wc#23768, ws_sp#23769])
         :              +- Exchange hashpartitioning(d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L, 3000), ENSURE_REQUIREMENTS, [id=#24658]
         :                 +- HashAggregate(keys=[d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L], functions=[partial_sum(ws_quantity#23796), partial_sum(ws_wholesale_cost#23797), partial_sum(ws_sales_price#23799)], output=[d_year#23843, ws_item_sk#23781L, ws_bill_customer_sk#23782L, sum#24056L, sum#24057, sum#24058])
         :                    +- Project [ws_item_sk#23781L, ws_bill_customer_sk#23782L, ws_quantity#23796, ws_wholesale_cost#23797, ws_sales_price#23799, d_year#23843]
         :                       +- BroadcastHashJoin [ws_sold_date_sk#23812L], [d_date_sk#23837L], Inner, BuildRight, false
         :                          :- Project [ws_item_sk#23781L, ws_bill_customer_sk#23782L, ws_quantity#23796, ws_wholesale_cost#23797, ws_sales_price#23799, ws_sold_date_sk#23812L]
         :                          :  +- Filter isnull(wr_order_number#23825L)
         :                          :     +- SortMergeJoin [ws_order_number#23795L, ws_item_sk#23781L], [wr_order_number#23825L, wr_item_sk#23814L], LeftOuter
         :                          :        :- Sort [ws_order_number#23795L ASC NULLS FIRST, ws_item_sk#23781L ASC NULLS FIRST], false, 0
         :                          :        :  +- Exchange hashpartitioning(ws_order_number#23795L, ws_item_sk#23781L, 3000), ENSURE_REQUIREMENTS, [id=#24645]
         :                          :        :     +- Filter (isnotnull(ws_item_sk#23781L) AND isnotnull(ws_bill_customer_sk#23782L))
         :                          :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#23781L,ws_bill_customer_sk#23782L,ws_order_number#23795L,ws_quantity#23796,ws_wholesale_cost#23797,ws_sales_price#23799,ws_sold_date_sk#23812L] Batched: true, DataFilters: [isnotnull(ws_item_sk#23781L), isnotnull(ws_bill_customer_sk#23782L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#23812L), dynamicpruningexpression(ws_sold_date_sk#23812L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_bill_customer_sk:bigint,ws_order_number:bigint,ws_quantity:int,ws_who...
         :                          :        :              +- SubqueryAdaptiveBroadcast dynamicpruning#24045, 0, true, Project [d_date_sk#23837L, d_year#23843], [d_date_sk#23837L]
         :                          :        :                 +- AdaptiveSparkPlan isFinalPlan=false
         :                          :        :                    +- Filter ((isnotnull(d_date_sk#23837L) AND (d_year#23843 = 2000)) AND isnotnull(d_year#23843))
         :                          :        :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23837L,d_year#23843] Batched: true, DataFilters: [isnotnull(d_date_sk#23837L), (d_year#23843 = 2000), isnotnull(d_year#23843)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), EqualTo(d_year,2000), IsNotNull(d_year)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                          :        +- Sort [wr_order_number#23825L ASC NULLS FIRST, wr_item_sk#23814L ASC NULLS FIRST], false, 0
         :                          :           +- Exchange hashpartitioning(wr_order_number#23825L, wr_item_sk#23814L, 3000), ENSURE_REQUIREMENTS, [id=#24646]
         :                          :              +- Project [wr_item_sk#23814L, wr_order_number#23825L]
         :                          :                 +- Filter (isnotnull(wr_order_number#23825L) AND isnotnull(wr_item_sk#23814L))
         :                          :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#23814L,wr_order_number#23825L,wr_returned_date_sk#23836L] Batched: true, DataFilters: [isnotnull(wr_order_number#23825L), isnotnull(wr_item_sk#23814L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_order_number), IsNotNull(wr_item_sk)], ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint>
         :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24653]
         :                             +- Filter ((isnotnull(d_date_sk#23837L) AND (d_year#23843 = 2000)) AND isnotnull(d_year#23843))
         :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23837L,d_year#23843] Batched: true, DataFilters: [isnotnull(d_date_sk#23837L), (d_year#23843 = 2000), isnotnull(d_year#23843)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), EqualTo(d_year,2000), IsNotNull(d_year)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         +- Sort [cs_sold_year#23770 ASC NULLS FIRST, cs_item_sk#23879L ASC NULLS FIRST, cs_customer_sk#23771L ASC NULLS FIRST], false, 0
            +- Filter (coalesce(cs_qty#23772L, 0) > 0)
               +- HashAggregate(keys=[d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L], functions=[sum(cs_quantity#23882), sum(cs_wholesale_cost#23883), sum(cs_sales_price#23885)], output=[cs_sold_year#23770, cs_item_sk#23879L, cs_customer_sk#23771L, cs_qty#23772L, cs_wc#23773, cs_sp#23774])
                  +- Exchange hashpartitioning(d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L, 3000), ENSURE_REQUIREMENTS, [id=#24681]
                     +- HashAggregate(keys=[d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L], functions=[partial_sum(cs_quantity#23882), partial_sum(cs_wholesale_cost#23883), partial_sum(cs_sales_price#23885)], output=[d_year#23932, cs_item_sk#23879L, cs_bill_customer_sk#23867L, sum#24062L, sum#24063, sum#24064])
                        +- Project [cs_bill_customer_sk#23867L, cs_item_sk#23879L, cs_quantity#23882, cs_wholesale_cost#23883, cs_sales_price#23885, d_year#23932]
                           +- BroadcastHashJoin [cs_sold_date_sk#23898L], [d_date_sk#23926L], Inner, BuildRight, false
                              :- Project [cs_bill_customer_sk#23867L, cs_item_sk#23879L, cs_quantity#23882, cs_wholesale_cost#23883, cs_sales_price#23885, cs_sold_date_sk#23898L]
                              :  +- Filter isnull(cr_order_number#23914L)
                              :     +- SortMergeJoin [cs_order_number#23881L, cs_item_sk#23879L], [cr_order_number#23914L, cr_item_sk#23900L], LeftOuter
                              :        :- Sort [cs_order_number#23881L ASC NULLS FIRST, cs_item_sk#23879L ASC NULLS FIRST], false, 0
                              :        :  +- Exchange hashpartitioning(cs_order_number#23881L, cs_item_sk#23879L, 3000), ENSURE_REQUIREMENTS, [id=#24668]
                              :        :     +- Filter (isnotnull(cs_item_sk#23879L) AND isnotnull(cs_bill_customer_sk#23867L))
                              :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#23867L,cs_item_sk#23879L,cs_order_number#23881L,cs_quantity#23882,cs_wholesale_cost#23883,cs_sales_price#23885,cs_sold_date_sk#23898L] Batched: true, DataFilters: [isnotnull(cs_item_sk#23879L), isnotnull(cs_bill_customer_sk#23867L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#23898L), dynamicpruningexpression(cs_sold_date_sk#23898L IN dynamicpru..., PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint,cs_order_number:bigint,cs_quantity:int,cs_who...
                              :        :              +- SubqueryAdaptiveBroadcast dynamicpruning#24046, 0, true, Project [d_date_sk#23926L, d_year#23932], [d_date_sk#23926L]
                              :        :                 +- AdaptiveSparkPlan isFinalPlan=false
                              :        :                    +- Filter ((isnotnull(d_date_sk#23926L) AND (d_year#23932 = 2000)) AND isnotnull(d_year#23932))
                              :        :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23926L,d_year#23932] Batched: true, DataFilters: [isnotnull(d_date_sk#23926L), (d_year#23932 = 2000), isnotnull(d_year#23932)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), EqualTo(d_year,2000), IsNotNull(d_year)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                              :        +- Sort [cr_order_number#23914L ASC NULLS FIRST, cr_item_sk#23900L ASC NULLS FIRST], false, 0
                              :           +- Exchange hashpartitioning(cr_order_number#23914L, cr_item_sk#23900L, 3000), ENSURE_REQUIREMENTS, [id=#24669]
                              :              +- Project [cr_item_sk#23900L, cr_order_number#23914L]
                              :                 +- Filter (isnotnull(cr_order_number#23914L) AND isnotnull(cr_item_sk#23900L))
                              :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#23900L,cr_order_number#23914L,cr_returned_date_sk#23925L] Batched: true, DataFilters: [isnotnull(cr_order_number#23914L), isnotnull(cr_item_sk#23900L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint>
                              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#24676]
                                 +- Filter ((isnotnull(d_date_sk#23926L) AND (d_year#23932 = 2000)) AND isnotnull(d_year#23932))
                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#23926L,d_year#23932] Batched: true, DataFilters: [isnotnull(d_date_sk#23926L), (d_year#23932 = 2000), isnotnull(d_year#23932)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), EqualTo(d_year,2000), IsNotNull(d_year)], ReadSchema: struct<d_date_sk:bigint,d_year:int>

read query: spark_queries/q79.sql
explain query: q79
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'substr('s_city, 1, 30) ASC NULLS FIRST, 'profit ASC NULLS FIRST], true
      +- 'Project ['c_last_name, 'c_first_name, unresolvedalias('substr('s_city, 1, 30), None), 'ss_ticket_number, 'amt, 'profit]
         +- 'Filter ('ss_customer_sk = 'c_customer_sk)
            +- 'Join Inner
               :- 'SubqueryAlias ms
               :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'store.s_city], ['ss_ticket_number, 'ss_customer_sk, 'store.s_city, 'sum('ss_coupon_amt) AS amt#24065, 'sum('ss_net_profit) AS profit#24066]
               :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_store_sk = 'store.s_store_sk)) AND (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) AND (('household_demographics.hd_dep_count = 8) OR ('household_demographics.hd_vehicle_count > 0)))) AND ((('date_dim.d_dow = 1) AND 'date_dim.d_year IN (1998,(1998 + 1),(1998 + 2))) AND (('store.s_number_employees >= 200) AND ('store.s_number_employees <= 295))))
               :        +- 'Join Inner
               :           :- 'Join Inner
               :           :  :- 'Join Inner
               :           :  :  :- 'UnresolvedRelation [store_sales], [], false
               :           :  :  +- 'UnresolvedRelation [date_dim], [], false
               :           :  +- 'UnresolvedRelation [store], [], false
               :           +- 'UnresolvedRelation [household_demographics], [], false
               +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_last_name: string, c_first_name: string, substr(s_city, 1, 30): string, ss_ticket_number: bigint, amt: double, profit: double
GlobalLimit 100
+- LocalLimit 100
   +- Project [c_last_name#24161, c_first_name#24160, substr(s_city, 1, 30)#24172, ss_ticket_number#24075L, amt#24065, profit#24066]
      +- Sort [c_last_name#24161 ASC NULLS FIRST, c_first_name#24160 ASC NULLS FIRST, substr(s_city#24140, 1, 30) ASC NULLS FIRST, profit#24066 ASC NULLS FIRST], true
         +- Project [c_last_name#24161, c_first_name#24160, substr(s_city#24140, 1, 30) AS substr(s_city, 1, 30)#24172, ss_ticket_number#24075L, amt#24065, profit#24066, s_city#24140]
            +- Filter (ss_customer_sk#24069L = c_customer_sk#24152L)
               +- Join Inner
                  :- SubqueryAlias ms
                  :  +- Aggregate [ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140], [ss_ticket_number#24075L, ss_customer_sk#24069L, s_city#24140, sum(ss_coupon_amt#24085) AS amt#24065, sum(ss_net_profit#24088) AS profit#24066]
                  :     +- Filter ((((ss_sold_date_sk#24089L = d_date_sk#24090L) AND (ss_store_sk#24073L = s_store_sk#24118L)) AND ((ss_hdemo_sk#24071L = hd_demo_sk#24147L) AND ((hd_dep_count#24150 = 8) OR (hd_vehicle_count#24151 > 0)))) AND (((d_dow#24097 = 1) AND d_year#24096 IN (1998,(1998 + 1),(1998 + 2))) AND ((s_number_employees#24124 >= 200) AND (s_number_employees#24124 <= 295))))
                  :        +- Join Inner
                  :           :- Join Inner
                  :           :  :- Join Inner
                  :           :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                  :           :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24067L,ss_item_sk#24068L,ss_customer_sk#24069L,ss_cdemo_sk#24070L,ss_hdemo_sk#24071L,ss_addr_sk#24072L,ss_store_sk#24073L,ss_promo_sk#24074L,ss_ticket_number#24075L,ss_quantity#24076,ss_wholesale_cost#24077,ss_list_price#24078,ss_sales_price#24079,ss_ext_discount_amt#24080,ss_ext_sales_price#24081,ss_ext_wholesale_cost#24082,ss_ext_list_price#24083,ss_ext_tax#24084,ss_coupon_amt#24085,ss_net_paid#24086,ss_net_paid_inc_tax#24087,ss_net_profit#24088,ss_sold_date_sk#24089L] orc
                  :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24090L,d_date_id#24091,d_date#24092,d_month_seq#24093,d_week_seq#24094,d_quarter_seq#24095,d_year#24096,d_dow#24097,d_moy#24098,d_dom#24099,d_qoy#24100,d_fy_year#24101,d_fy_quarter_seq#24102,d_fy_week_seq#24103,d_day_name#24104,d_quarter_name#24105,d_holiday#24106,d_weekend#24107,d_following_holiday#24108,d_first_dom#24109,d_last_dom#24110,d_same_day_ly#24111,d_same_day_lq#24112,d_current_day#24113,... 4 more fields] orc
                  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24118L,s_store_id#24119,s_rec_start_date#24120,s_rec_end_date#24121,s_closed_date_sk#24122L,s_store_name#24123,s_number_employees#24124,s_floor_space#24125,s_hours#24126,s_manager#24127,s_market_id#24128,s_geography_class#24129,s_market_desc#24130,s_market_manager#24131,s_division_id#24132,s_division_name#24133,s_company_id#24134,s_company_name#24135,s_street_number#24136,s_street_name#24137,s_street_type#24138,s_suite_number#24139,s_city#24140,s_county#24141,... 5 more fields] orc
                  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
                  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#24147L,hd_income_band_sk#24148L,hd_buy_potential#24149,hd_dep_count#24150,hd_vehicle_count#24151] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24152L,c_customer_id#24153,c_current_cdemo_sk#24154L,c_current_hdemo_sk#24155L,c_current_addr_sk#24156L,c_first_shipto_date_sk#24157L,c_first_sales_date_sk#24158L,c_salutation#24159,c_first_name#24160,c_last_name#24161,c_preferred_cust_flag#24162,c_birth_day#24163,c_birth_month#24164,c_birth_year#24165,c_birth_country#24166,c_login#24167,c_email_address#24168,c_last_review_date#24169] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [c_last_name#24161, c_first_name#24160, substr(s_city, 1, 30)#24172, ss_ticket_number#24075L, amt#24065, profit#24066]
      +- Sort [c_last_name#24161 ASC NULLS FIRST, c_first_name#24160 ASC NULLS FIRST, substr(s_city#24140, 1, 30) ASC NULLS FIRST, profit#24066 ASC NULLS FIRST], true
         +- Project [c_last_name#24161, c_first_name#24160, substr(s_city#24140, 1, 30) AS substr(s_city, 1, 30)#24172, ss_ticket_number#24075L, amt#24065, profit#24066, s_city#24140]
            +- Join Inner, (ss_customer_sk#24069L = c_customer_sk#24152L)
               :- Aggregate [ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140], [ss_ticket_number#24075L, ss_customer_sk#24069L, s_city#24140, sum(ss_coupon_amt#24085) AS amt#24065, sum(ss_net_profit#24088) AS profit#24066]
               :  +- Project [ss_customer_sk#24069L, ss_addr_sk#24072L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088, s_city#24140]
               :     +- Join Inner, (ss_store_sk#24073L = s_store_sk#24118L)
               :        :- Project [ss_customer_sk#24069L, ss_addr_sk#24072L, ss_store_sk#24073L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088]
               :        :  +- Join Inner, (ss_hdemo_sk#24071L = hd_demo_sk#24147L)
               :        :     :- Project [ss_customer_sk#24069L, ss_hdemo_sk#24071L, ss_addr_sk#24072L, ss_store_sk#24073L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088]
               :        :     :  +- Join Inner, (ss_sold_date_sk#24089L = d_date_sk#24090L)
               :        :     :     :- Project [ss_customer_sk#24069L, ss_hdemo_sk#24071L, ss_addr_sk#24072L, ss_store_sk#24073L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088, ss_sold_date_sk#24089L]
               :        :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#24089L) AND isnotnull(ss_store_sk#24073L)) AND isnotnull(ss_hdemo_sk#24071L)) AND isnotnull(ss_customer_sk#24069L)) AND dynamicpruning#24179 [ss_sold_date_sk#24089L])
               :        :     :     :     :  +- Project [d_date_sk#24090L]
               :        :     :     :     :     +- Filter ((isnotnull(d_dow#24097) AND ((d_dow#24097 = 1) AND d_year#24096 IN (1998,1999,2000))) AND isnotnull(d_date_sk#24090L))
               :        :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24090L,d_date_id#24091,d_date#24092,d_month_seq#24093,d_week_seq#24094,d_quarter_seq#24095,d_year#24096,d_dow#24097,d_moy#24098,d_dom#24099,d_qoy#24100,d_fy_year#24101,d_fy_quarter_seq#24102,d_fy_week_seq#24103,d_day_name#24104,d_quarter_name#24105,d_holiday#24106,d_weekend#24107,d_following_holiday#24108,d_first_dom#24109,d_last_dom#24110,d_same_day_ly#24111,d_same_day_lq#24112,d_current_day#24113,... 4 more fields] orc
               :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24067L,ss_item_sk#24068L,ss_customer_sk#24069L,ss_cdemo_sk#24070L,ss_hdemo_sk#24071L,ss_addr_sk#24072L,ss_store_sk#24073L,ss_promo_sk#24074L,ss_ticket_number#24075L,ss_quantity#24076,ss_wholesale_cost#24077,ss_list_price#24078,ss_sales_price#24079,ss_ext_discount_amt#24080,ss_ext_sales_price#24081,ss_ext_wholesale_cost#24082,ss_ext_list_price#24083,ss_ext_tax#24084,ss_coupon_amt#24085,ss_net_paid#24086,ss_net_paid_inc_tax#24087,ss_net_profit#24088,ss_sold_date_sk#24089L] orc
               :        :     :     +- Project [d_date_sk#24090L]
               :        :     :        +- Filter ((isnotnull(d_dow#24097) AND ((d_dow#24097 = 1) AND d_year#24096 IN (1998,1999,2000))) AND isnotnull(d_date_sk#24090L))
               :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24090L,d_date_id#24091,d_date#24092,d_month_seq#24093,d_week_seq#24094,d_quarter_seq#24095,d_year#24096,d_dow#24097,d_moy#24098,d_dom#24099,d_qoy#24100,d_fy_year#24101,d_fy_quarter_seq#24102,d_fy_week_seq#24103,d_day_name#24104,d_quarter_name#24105,d_holiday#24106,d_weekend#24107,d_following_holiday#24108,d_first_dom#24109,d_last_dom#24110,d_same_day_ly#24111,d_same_day_lq#24112,d_current_day#24113,... 4 more fields] orc
               :        :     +- Project [hd_demo_sk#24147L]
               :        :        +- Filter (((hd_dep_count#24150 = 8) OR (hd_vehicle_count#24151 > 0)) AND isnotnull(hd_demo_sk#24147L))
               :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#24147L,hd_income_band_sk#24148L,hd_buy_potential#24149,hd_dep_count#24150,hd_vehicle_count#24151] orc
               :        +- Project [s_store_sk#24118L, s_city#24140]
               :           +- Filter ((isnotnull(s_number_employees#24124) AND ((s_number_employees#24124 >= 200) AND (s_number_employees#24124 <= 295))) AND isnotnull(s_store_sk#24118L))
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24118L,s_store_id#24119,s_rec_start_date#24120,s_rec_end_date#24121,s_closed_date_sk#24122L,s_store_name#24123,s_number_employees#24124,s_floor_space#24125,s_hours#24126,s_manager#24127,s_market_id#24128,s_geography_class#24129,s_market_desc#24130,s_market_manager#24131,s_division_id#24132,s_division_name#24133,s_company_id#24134,s_company_name#24135,s_street_number#24136,s_street_name#24137,s_street_type#24138,s_suite_number#24139,s_city#24140,s_county#24141,... 5 more fields] orc
               +- Project [c_customer_sk#24152L, c_first_name#24160, c_last_name#24161]
                  +- Filter isnotnull(c_customer_sk#24152L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24152L,c_customer_id#24153,c_current_cdemo_sk#24154L,c_current_hdemo_sk#24155L,c_current_addr_sk#24156L,c_first_shipto_date_sk#24157L,c_first_sales_date_sk#24158L,c_salutation#24159,c_first_name#24160,c_last_name#24161,c_preferred_cust_flag#24162,c_birth_day#24163,c_birth_month#24164,c_birth_year#24165,c_birth_country#24166,c_login#24167,c_email_address#24168,c_last_review_date#24169] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_last_name#24161 ASC NULLS FIRST,c_first_name#24160 ASC NULLS FIRST,substr(s_city#24140, 1, 30) ASC NULLS FIRST,profit#24066 ASC NULLS FIRST], output=[c_last_name#24161,c_first_name#24160,substr(s_city, 1, 30)#24172,ss_ticket_number#24075L,amt#24065,profit#24066])
   +- Project [c_last_name#24161, c_first_name#24160, substr(s_city#24140, 1, 30) AS substr(s_city, 1, 30)#24172, ss_ticket_number#24075L, amt#24065, profit#24066, s_city#24140]
      +- SortMergeJoin [ss_customer_sk#24069L], [c_customer_sk#24152L], Inner
         :- Sort [ss_customer_sk#24069L ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(ss_customer_sk#24069L, 3000), ENSURE_REQUIREMENTS, [id=#24820]
         :     +- HashAggregate(keys=[ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140], functions=[sum(ss_coupon_amt#24085), sum(ss_net_profit#24088)], output=[ss_ticket_number#24075L, ss_customer_sk#24069L, s_city#24140, amt#24065, profit#24066])
         :        +- Exchange hashpartitioning(ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140, 3000), ENSURE_REQUIREMENTS, [id=#24816]
         :           +- HashAggregate(keys=[ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140], functions=[partial_sum(ss_coupon_amt#24085), partial_sum(ss_net_profit#24088)], output=[ss_ticket_number#24075L, ss_customer_sk#24069L, ss_addr_sk#24072L, s_city#24140, sum#24182, sum#24183])
         :              +- Project [ss_customer_sk#24069L, ss_addr_sk#24072L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088, s_city#24140]
         :                 +- BroadcastHashJoin [ss_store_sk#24073L], [s_store_sk#24118L], Inner, BuildRight, false
         :                    :- Project [ss_customer_sk#24069L, ss_addr_sk#24072L, ss_store_sk#24073L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088]
         :                    :  +- BroadcastHashJoin [ss_hdemo_sk#24071L], [hd_demo_sk#24147L], Inner, BuildRight, false
         :                    :     :- Project [ss_customer_sk#24069L, ss_hdemo_sk#24071L, ss_addr_sk#24072L, ss_store_sk#24073L, ss_ticket_number#24075L, ss_coupon_amt#24085, ss_net_profit#24088]
         :                    :     :  +- BroadcastHashJoin [ss_sold_date_sk#24089L], [d_date_sk#24090L], Inner, BuildRight, false
         :                    :     :     :- Filter ((isnotnull(ss_store_sk#24073L) AND isnotnull(ss_hdemo_sk#24071L)) AND isnotnull(ss_customer_sk#24069L))
         :                    :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#24069L,ss_hdemo_sk#24071L,ss_addr_sk#24072L,ss_store_sk#24073L,ss_ticket_number#24075L,ss_coupon_amt#24085,ss_net_profit#24088,ss_sold_date_sk#24089L] Batched: true, DataFilters: [isnotnull(ss_store_sk#24073L), isnotnull(ss_hdemo_sk#24071L), isnotnull(ss_customer_sk#24069L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#24089L), dynamicpruningexpression(ss_sold_date_sk#24089L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint,ss_hdemo_sk:bigint,ss_addr_sk:bigint,ss_store_sk:bigint,ss_ticket_nu...
         :                    :     :     :        +- SubqueryAdaptiveBroadcast dynamicpruning#24179, 0, true, Project [d_date_sk#24090L], [d_date_sk#24090L]
         :                    :     :     :           +- AdaptiveSparkPlan isFinalPlan=false
         :                    :     :     :              +- Project [d_date_sk#24090L]
         :                    :     :     :                 +- Filter (((isnotnull(d_dow#24097) AND (d_dow#24097 = 1)) AND d_year#24096 IN (1998,1999,2000)) AND isnotnull(d_date_sk#24090L))
         :                    :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24090L,d_year#24096,d_dow#24097] Batched: true, DataFilters: [isnotnull(d_dow#24097), (d_dow#24097 = 1), d_year#24096 IN (1998,1999,2000), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [1998,1999,2000]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dow:int>
         :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24803]
         :                    :     :        +- Project [d_date_sk#24090L]
         :                    :     :           +- Filter (((isnotnull(d_dow#24097) AND (d_dow#24097 = 1)) AND d_year#24096 IN (1998,1999,2000)) AND isnotnull(d_date_sk#24090L))
         :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24090L,d_year#24096,d_dow#24097] Batched: true, DataFilters: [isnotnull(d_dow#24097), (d_dow#24097 = 1), d_year#24096 IN (1998,1999,2000), isnotnull(d_date_sk..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [1998,1999,2000]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_dow:int>
         :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24807]
         :                    :        +- Project [hd_demo_sk#24147L]
         :                    :           +- Filter (((hd_dep_count#24150 = 8) OR (hd_vehicle_count#24151 > 0)) AND isnotnull(hd_demo_sk#24147L))
         :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#24147L,hd_dep_count#24150,hd_vehicle_count#24151] Batched: true, DataFilters: [((hd_dep_count#24150 = 8) OR (hd_vehicle_count#24151 > 0)), isnotnull(hd_demo_sk#24147L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,8),GreaterThan(hd_vehicle_count,0)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
         :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#24811]
         :                       +- Project [s_store_sk#24118L, s_city#24140]
         :                          +- Filter (((isnotnull(s_number_employees#24124) AND (s_number_employees#24124 >= 200)) AND (s_number_employees#24124 <= 295)) AND isnotnull(s_store_sk#24118L))
         :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24118L,s_number_employees#24124,s_city#24140] Batched: true, DataFilters: [isnotnull(s_number_employees#24124), (s_number_employees#24124 >= 200), (s_number_employees#2412..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:bigint,s_number_employees:int,s_city:string>
         +- Sort [c_customer_sk#24152L ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(c_customer_sk#24152L, 3000), ENSURE_REQUIREMENTS, [id=#24821]
               +- Filter isnotnull(c_customer_sk#24152L)
                  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24152L,c_first_name#24160,c_last_name#24161] Batched: true, DataFilters: [isnotnull(c_customer_sk#24152L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>

read query: spark_queries/q80.sql
explain query: q80
== Parsed Logical Plan ==
CTE [ssr, csr, wsr]
:  :- 'SubqueryAlias ssr
:  :  +- 'Aggregate ['s_store_id], ['s_store_id AS store_id#24193, 'sum('ss_ext_sales_price) AS sales#24194, 'sum('coalesce('sr_return_amt, 0)) AS returns#24195, 'sum(('ss_net_profit - 'coalesce('sr_net_loss, 0))) AS profit#24196]
:  :     +- 'Filter (((('ss_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND (('ss_store_sk = 's_store_sk) AND ('ss_item_sk = 'i_item_sk))) AND ((('i_current_price > 50) AND ('ss_promo_sk = 'p_promo_sk)) AND ('p_channel_tv = N)))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'Join Inner
:  :           :  :  :  :- 'Join LeftOuter, (('ss_item_sk = 'sr_item_sk) AND ('ss_ticket_number = 'sr_ticket_number))
:  :           :  :  :  :  :- 'UnresolvedRelation [store_sales], [], false
:  :           :  :  :  :  +- 'UnresolvedRelation [store_returns], [], false
:  :           :  :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  :  +- 'UnresolvedRelation [store], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [promotion], [], false
:  :- 'SubqueryAlias csr
:  :  +- 'Aggregate ['cp_catalog_page_id], ['cp_catalog_page_id AS catalog_page_id#24197, 'sum('cs_ext_sales_price) AS sales#24198, 'sum('coalesce('cr_return_amount, 0)) AS returns#24199, 'sum(('cs_net_profit - 'coalesce('cr_net_loss, 0))) AS profit#24200]
:  :     +- 'Filter (((('cs_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND (('cs_catalog_page_sk = 'cp_catalog_page_sk) AND ('cs_item_sk = 'i_item_sk))) AND ((('i_current_price > 50) AND ('cs_promo_sk = 'p_promo_sk)) AND ('p_channel_tv = N)))
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'Join Inner
:  :           :  :  :- 'Join Inner
:  :           :  :  :  :- 'Join LeftOuter, (('cs_item_sk = 'cr_item_sk) AND ('cs_order_number = 'cr_order_number))
:  :           :  :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
:  :           :  :  :  :  +- 'UnresolvedRelation [catalog_returns], [], false
:  :           :  :  :  +- 'UnresolvedRelation [date_dim], [], false
:  :           :  :  +- 'UnresolvedRelation [catalog_page], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [promotion], [], false
:  +- 'SubqueryAlias wsr
:     +- 'Aggregate ['web_site_id], ['web_site_id, 'sum('ws_ext_sales_price) AS sales#24201, 'sum('coalesce('wr_return_amt, 0)) AS returns#24202, 'sum(('ws_net_profit - 'coalesce('wr_net_loss, 0))) AS profit#24203]
:        +- 'Filter (((('ws_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(1998-08-04 as date)) AND ('d_date <= (cast(1998-08-04 as date) + INTERVAL '30' DAY)))) AND (('ws_web_site_sk = 'web_site_sk) AND ('ws_item_sk = 'i_item_sk))) AND ((('i_current_price > 50) AND ('ws_promo_sk = 'p_promo_sk)) AND ('p_channel_tv = N)))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'Join Inner
:              :  :  :- 'Join Inner
:              :  :  :  :- 'Join LeftOuter, (('ws_item_sk = 'wr_item_sk) AND ('ws_order_number = 'wr_order_number))
:              :  :  :  :  :- 'UnresolvedRelation [web_sales], [], false
:              :  :  :  :  +- 'UnresolvedRelation [web_returns], [], false
:              :  :  :  +- 'UnresolvedRelation [date_dim], [], false
:              :  :  +- 'UnresolvedRelation [web_site], [], false
:              :  +- 'UnresolvedRelation [item], [], false
:              +- 'UnresolvedRelation [promotion], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true
         +- 'Aggregate [rollup(Vector(0), Vector(1), 'channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#24190, 'sum('returns) AS returns#24191, 'sum('profit) AS profit#24192]
            +- 'SubqueryAlias x
               +- 'Union false, false
                  :- 'Union false, false
                  :  :- 'Project [store channel AS channel#24184, concat(store, 'store_id) AS id#24185, 'sales, 'returns, 'profit]
                  :  :  +- 'UnresolvedRelation [ssr], [], false
                  :  +- 'Project [catalog channel AS channel#24186, concat(catalog_page, 'catalog_page_id) AS id#24187, 'sales, 'returns, 'profit]
                  :     +- 'UnresolvedRelation [csr], [], false
                  +- 'Project [web channel AS channel#24188, concat(web_site, 'web_site_id) AS id#24189, 'sales, 'returns, 'profit]
                     +- 'UnresolvedRelation [wsr], [], false

== Analyzed Logical Plan ==
channel: string, id: string, sales: double, returns: double, profit: double
WithCTE
:- CTERelationDef 59
:  +- SubqueryAlias ssr
:     +- Aggregate [s_store_id#24276], [s_store_id#24276 AS store_id#24193, sum(ss_ext_sales_price#24218) AS sales#24194, sum(coalesce(sr_return_amt#24237, cast(0 as double))) AS returns#24195, sum((ss_net_profit#24225 - coalesce(sr_net_loss#24245, cast(0 as double)))) AS profit#24196]
:        +- Filter ((((ss_sold_date_sk#24226L = d_date_sk#24247L) AND ((d_date#24249 >= cast(1998-08-04 as date)) AND (d_date#24249 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND ((ss_store_sk#24210L = s_store_sk#24275L) AND (ss_item_sk#24205L = i_item_sk#24304L))) AND (((i_current_price#24309 > cast(50 as double)) AND (ss_promo_sk#24211L = p_promo_sk#24326L)) AND (p_channel_tv#24337 = N)))
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- Join LeftOuter, ((ss_item_sk#24205L = sr_item_sk#24228L) AND (ss_ticket_number#24212L = sr_ticket_number#24235L))
:              :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24204L,ss_item_sk#24205L,ss_customer_sk#24206L,ss_cdemo_sk#24207L,ss_hdemo_sk#24208L,ss_addr_sk#24209L,ss_store_sk#24210L,ss_promo_sk#24211L,ss_ticket_number#24212L,ss_quantity#24213,ss_wholesale_cost#24214,ss_list_price#24215,ss_sales_price#24216,ss_ext_discount_amt#24217,ss_ext_sales_price#24218,ss_ext_wholesale_cost#24219,ss_ext_list_price#24220,ss_ext_tax#24221,ss_coupon_amt#24222,ss_net_paid#24223,ss_net_paid_inc_tax#24224,ss_net_profit#24225,ss_sold_date_sk#24226L] orc
:              :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#24227L,sr_item_sk#24228L,sr_customer_sk#24229L,sr_cdemo_sk#24230L,sr_hdemo_sk#24231L,sr_addr_sk#24232L,sr_store_sk#24233L,sr_reason_sk#24234L,sr_ticket_number#24235L,sr_return_quantity#24236,sr_return_amt#24237,sr_return_tax#24238,sr_return_amt_inc_tax#24239,sr_fee#24240,sr_return_ship_cost#24241,sr_refunded_cash#24242,sr_reversed_charge#24243,sr_store_credit#24244,sr_net_loss#24245,sr_returned_date_sk#24246L] orc
:              :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24247L,d_date_id#24248,d_date#24249,d_month_seq#24250,d_week_seq#24251,d_quarter_seq#24252,d_year#24253,d_dow#24254,d_moy#24255,d_dom#24256,d_qoy#24257,d_fy_year#24258,d_fy_quarter_seq#24259,d_fy_week_seq#24260,d_day_name#24261,d_quarter_name#24262,d_holiday#24263,d_weekend#24264,d_following_holiday#24265,d_first_dom#24266,d_last_dom#24267,d_same_day_ly#24268,d_same_day_lq#24269,d_current_day#24270,... 4 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24275L,s_store_id#24276,s_rec_start_date#24277,s_rec_end_date#24278,s_closed_date_sk#24279L,s_store_name#24280,s_number_employees#24281,s_floor_space#24282,s_hours#24283,s_manager#24284,s_market_id#24285,s_geography_class#24286,s_market_desc#24287,s_market_manager#24288,s_division_id#24289,s_division_name#24290,s_company_id#24291,s_company_name#24292,s_street_number#24293,s_street_name#24294,s_street_type#24295,s_suite_number#24296,s_city#24297,s_county#24298,... 5 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24304L,i_item_id#24305,i_rec_start_date#24306,i_rec_end_date#24307,i_item_desc#24308,i_current_price#24309,i_wholesale_cost#24310,i_brand_id#24311,i_brand#24312,i_class_id#24313,i_class#24314,i_category_id#24315,i_category#24316,i_manufact_id#24317,i_manufact#24318,i_size#24319,i_formulation#24320,i_color#24321,i_units#24322,i_container#24323,i_manager_id#24324,i_product_name#24325] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24326L,p_promo_id#24327,p_start_date_sk#24328L,p_end_date_sk#24329L,p_item_sk#24330L,p_cost#24331,p_response_target#24332,p_promo_name#24333,p_channel_dmail#24334,p_channel_email#24335,p_channel_catalog#24336,p_channel_tv#24337,p_channel_radio#24338,p_channel_press#24339,p_channel_event#24340,p_channel_demo#24341,p_channel_details#24342,p_purpose#24343,p_discount_active#24344] orc
:- CTERelationDef 60
:  +- SubqueryAlias csr
:     +- Aggregate [cp_catalog_page_id#24435], [cp_catalog_page_id#24435 AS catalog_page_id#24197, sum(cs_ext_sales_price#24367) AS sales#24198, sum(coalesce(cr_return_amount#24396, cast(0 as double))) AS returns#24199, sum((cs_net_profit#24377 - coalesce(cr_net_loss#24404, cast(0 as double)))) AS profit#24200]
:        +- Filter ((((cs_sold_date_sk#24378L = d_date_sk#24406L) AND ((d_date#24408 >= cast(1998-08-04 as date)) AND (d_date#24408 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND ((cs_catalog_page_sk#24356L = cp_catalog_page_sk#24434L) AND (cs_item_sk#24359L = i_item_sk#24443L))) AND (((i_current_price#24448 > cast(50 as double)) AND (cs_promo_sk#24360L = p_promo_sk#24465L)) AND (p_channel_tv#24476 = N)))
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- Join LeftOuter, ((cs_item_sk#24359L = cr_item_sk#24380L) AND (cs_order_number#24361L = cr_order_number#24394L))
:              :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#24345L,cs_ship_date_sk#24346L,cs_bill_customer_sk#24347L,cs_bill_cdemo_sk#24348L,cs_bill_hdemo_sk#24349L,cs_bill_addr_sk#24350L,cs_ship_customer_sk#24351L,cs_ship_cdemo_sk#24352L,cs_ship_hdemo_sk#24353L,cs_ship_addr_sk#24354L,cs_call_center_sk#24355L,cs_catalog_page_sk#24356L,cs_ship_mode_sk#24357L,cs_warehouse_sk#24358L,cs_item_sk#24359L,cs_promo_sk#24360L,cs_order_number#24361L,cs_quantity#24362,cs_wholesale_cost#24363,cs_list_price#24364,cs_sales_price#24365,cs_ext_discount_amt#24366,cs_ext_sales_price#24367,cs_ext_wholesale_cost#24368,... 10 more fields] orc
:              :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24379L,cr_item_sk#24380L,cr_refunded_customer_sk#24381L,cr_refunded_cdemo_sk#24382L,cr_refunded_hdemo_sk#24383L,cr_refunded_addr_sk#24384L,cr_returning_customer_sk#24385L,cr_returning_cdemo_sk#24386L,cr_returning_hdemo_sk#24387L,cr_returning_addr_sk#24388L,cr_call_center_sk#24389L,cr_catalog_page_sk#24390L,cr_ship_mode_sk#24391L,cr_warehouse_sk#24392L,cr_reason_sk#24393L,cr_order_number#24394L,cr_return_quantity#24395,cr_return_amount#24396,cr_return_tax#24397,cr_return_amt_inc_tax#24398,cr_fee#24399,cr_return_ship_cost#24400,cr_refunded_cash#24401,cr_reversed_charge#24402,... 3 more fields] orc
:              :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24406L,d_date_id#24407,d_date#24408,d_month_seq#24409,d_week_seq#24410,d_quarter_seq#24411,d_year#24412,d_dow#24413,d_moy#24414,d_dom#24415,d_qoy#24416,d_fy_year#24417,d_fy_quarter_seq#24418,d_fy_week_seq#24419,d_day_name#24420,d_quarter_name#24421,d_holiday#24422,d_weekend#24423,d_following_holiday#24424,d_first_dom#24425,d_last_dom#24426,d_same_day_ly#24427,d_same_day_lq#24428,d_current_day#24429,... 4 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_page
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#24434L,cp_catalog_page_id#24435,cp_start_date_sk#24436L,cp_end_date_sk#24437L,cp_department#24438,cp_catalog_number#24439,cp_catalog_page_number#24440,cp_description#24441,cp_type#24442] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24443L,i_item_id#24444,i_rec_start_date#24445,i_rec_end_date#24446,i_item_desc#24447,i_current_price#24448,i_wholesale_cost#24449,i_brand_id#24450,i_brand#24451,i_class_id#24452,i_class#24453,i_category_id#24454,i_category#24455,i_manufact_id#24456,i_manufact#24457,i_size#24458,i_formulation#24459,i_color#24460,i_units#24461,i_container#24462,i_manager_id#24463,i_product_name#24464] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24465L,p_promo_id#24466,p_start_date_sk#24467L,p_end_date_sk#24468L,p_item_sk#24469L,p_cost#24470,p_response_target#24471,p_promo_name#24472,p_channel_dmail#24473,p_channel_email#24474,p_channel_catalog#24475,p_channel_tv#24476,p_channel_radio#24477,p_channel_press#24478,p_channel_event#24479,p_channel_demo#24480,p_channel_details#24481,p_purpose#24482,p_discount_active#24483] orc
:- CTERelationDef 61
:  +- SubqueryAlias wsr
:     +- Aggregate [web_site_id#24571], [web_site_id#24571, sum(ws_ext_sales_price#24506) AS sales#24201, sum(coalesce(wr_return_amt#24532, cast(0 as double))) AS returns#24202, sum((ws_net_profit#24516 - coalesce(wr_net_loss#24540, cast(0 as double)))) AS profit#24203]
:        +- Filter ((((ws_sold_date_sk#24517L = d_date_sk#24542L) AND ((d_date#24544 >= cast(1998-08-04 as date)) AND (d_date#24544 <= date_add(cast(1998-08-04 as date), extractansiintervaldays(INTERVAL '30' DAY))))) AND ((ws_web_site_sk#24496L = web_site_sk#24570L) AND (ws_item_sk#24486L = i_item_sk#24596L))) AND (((i_current_price#24601 > cast(50 as double)) AND (ws_promo_sk#24499L = p_promo_sk#24618L)) AND (p_channel_tv#24629 = N)))
:           +- Join Inner
:              :- Join Inner
:              :  :- Join Inner
:              :  :  :- Join Inner
:              :  :  :  :- Join LeftOuter, ((ws_item_sk#24486L = wr_item_sk#24519L) AND (ws_order_number#24500L = wr_order_number#24530L))
:              :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#24484L,ws_ship_date_sk#24485L,ws_item_sk#24486L,ws_bill_customer_sk#24487L,ws_bill_cdemo_sk#24488L,ws_bill_hdemo_sk#24489L,ws_bill_addr_sk#24490L,ws_ship_customer_sk#24491L,ws_ship_cdemo_sk#24492L,ws_ship_hdemo_sk#24493L,ws_ship_addr_sk#24494L,ws_web_page_sk#24495L,ws_web_site_sk#24496L,ws_ship_mode_sk#24497L,ws_warehouse_sk#24498L,ws_promo_sk#24499L,ws_order_number#24500L,ws_quantity#24501,ws_wholesale_cost#24502,ws_list_price#24503,ws_sales_price#24504,ws_ext_discount_amt#24505,ws_ext_sales_price#24506,ws_ext_wholesale_cost#24507,... 10 more fields] orc
:              :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#24518L,wr_item_sk#24519L,wr_refunded_customer_sk#24520L,wr_refunded_cdemo_sk#24521L,wr_refunded_hdemo_sk#24522L,wr_refunded_addr_sk#24523L,wr_returning_customer_sk#24524L,wr_returning_cdemo_sk#24525L,wr_returning_hdemo_sk#24526L,wr_returning_addr_sk#24527L,wr_web_page_sk#24528L,wr_reason_sk#24529L,wr_order_number#24530L,wr_return_quantity#24531,wr_return_amt#24532,wr_return_tax#24533,wr_return_amt_inc_tax#24534,wr_fee#24535,wr_return_ship_cost#24536,wr_refunded_cash#24537,wr_reversed_charge#24538,wr_account_credit#24539,wr_net_loss#24540,wr_returned_date_sk#24541L] orc
:              :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24542L,d_date_id#24543,d_date#24544,d_month_seq#24545,d_week_seq#24546,d_quarter_seq#24547,d_year#24548,d_dow#24549,d_moy#24550,d_dom#24551,d_qoy#24552,d_fy_year#24553,d_fy_quarter_seq#24554,d_fy_week_seq#24555,d_day_name#24556,d_quarter_name#24557,d_holiday#24558,d_weekend#24559,d_following_holiday#24560,d_first_dom#24561,d_last_dom#24562,d_same_day_ly#24563,d_same_day_lq#24564,d_current_day#24565,... 4 more fields] orc
:              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_site
:              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#24570L,web_site_id#24571,web_rec_start_date#24572,web_rec_end_date#24573,web_name#24574,web_open_date_sk#24575L,web_close_date_sk#24576L,web_class#24577,web_manager#24578,web_mkt_id#24579,web_mkt_class#24580,web_mkt_desc#24581,web_market_manager#24582,web_company_id#24583,web_company_name#24584,web_street_number#24585,web_street_name#24586,web_street_type#24587,web_suite_number#24588,web_city#24589,web_county#24590,web_state#24591,web_zip#24592,web_country#24593,... 2 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24596L,i_item_id#24597,i_rec_start_date#24598,i_rec_end_date#24599,i_item_desc#24600,i_current_price#24601,i_wholesale_cost#24602,i_brand_id#24603,i_brand#24604,i_class_id#24605,i_class#24606,i_category_id#24607,i_category#24608,i_manufact_id#24609,i_manufact#24610,i_size#24611,i_formulation#24612,i_color#24613,i_units#24614,i_container#24615,i_manager_id#24616,i_product_name#24617] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.promotion
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24618L,p_promo_id#24619,p_start_date_sk#24620L,p_end_date_sk#24621L,p_item_sk#24622L,p_cost#24623,p_response_target#24624,p_promo_name#24625,p_channel_dmail#24626,p_channel_email#24627,p_channel_catalog#24628,p_channel_tv#24629,p_channel_radio#24630,p_channel_press#24631,p_channel_event#24632,p_channel_demo#24633,p_channel_details#24634,p_purpose#24635,p_discount_active#24636] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [channel#24652 ASC NULLS FIRST, id#24653 ASC NULLS FIRST], true
         +- Aggregate [channel#24652, id#24653, spark_grouping_id#24651L], [channel#24652, id#24653, sum(sales#24194) AS sales#24190, sum(returns#24195) AS returns#24191, sum(profit#24196) AS profit#24192]
            +- Expand [[channel#24184, id#24185, sales#24194, returns#24195, profit#24196, channel#24649, id#24650, 0], [channel#24184, id#24185, sales#24194, returns#24195, profit#24196, channel#24649, null, 1], [channel#24184, id#24185, sales#24194, returns#24195, profit#24196, null, null, 3]], [channel#24184, id#24185, sales#24194, returns#24195, profit#24196, channel#24652, id#24653, spark_grouping_id#24651L]
               +- Project [channel#24184, id#24185, sales#24194, returns#24195, profit#24196, channel#24184 AS channel#24649, id#24185 AS id#24650]
                  +- SubqueryAlias x
                     +- Union false, false
                        :- Union false, false
                        :  :- Project [store channel AS channel#24184, concat(store, store_id#24193) AS id#24185, sales#24194, returns#24195, profit#24196]
                        :  :  +- SubqueryAlias ssr
                        :  :     +- CTERelationRef 59, true, [store_id#24193, sales#24194, returns#24195, profit#24196]
                        :  +- Project [catalog channel AS channel#24186, concat(catalog_page, catalog_page_id#24197) AS id#24187, sales#24198, returns#24199, profit#24200]
                        :     +- SubqueryAlias csr
                        :        +- CTERelationRef 60, true, [catalog_page_id#24197, sales#24198, returns#24199, profit#24200]
                        +- Project [web channel AS channel#24188, concat(web_site, web_site_id#24571) AS id#24189, sales#24201, returns#24202, profit#24203]
                           +- SubqueryAlias wsr
                              +- CTERelationRef 61, true, [web_site_id#24571, sales#24201, returns#24202, profit#24203]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [channel#24652 ASC NULLS FIRST, id#24653 ASC NULLS FIRST], true
      +- Aggregate [channel#24652, id#24653, spark_grouping_id#24651L], [channel#24652, id#24653, sum(sales#24194) AS sales#24190, sum(returns#24195) AS returns#24191, sum(profit#24196) AS profit#24192]
         +- Expand [[sales#24194, returns#24195, profit#24196, channel#24649, id#24650, 0], [sales#24194, returns#24195, profit#24196, channel#24649, null, 1], [sales#24194, returns#24195, profit#24196, null, null, 3]], [sales#24194, returns#24195, profit#24196, channel#24652, id#24653, spark_grouping_id#24651L]
            +- Union false, false
               :- Aggregate [s_store_id#24276], [sum(ss_ext_sales_price#24218) AS sales#24194, sum(coalesce(sr_return_amt#24237, 0.0)) AS returns#24195, sum((ss_net_profit#24225 - coalesce(sr_net_loss#24245, 0.0))) AS profit#24196, store channel AS channel#24649, concat(store, s_store_id#24276) AS id#24650]
               :  +- Project [ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245, s_store_id#24276]
               :     +- Join Inner, (ss_store_sk#24210L = s_store_sk#24275L)
               :        :- Project [ss_store_sk#24210L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
               :        :  +- Join Inner, (ss_item_sk#24205L = i_item_sk#24304L)
               :        :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
               :        :     :  +- Join Inner, (ss_promo_sk#24211L = p_promo_sk#24326L)
               :        :     :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_promo_sk#24211L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
               :        :     :     :  +- Join Inner, (ss_sold_date_sk#24226L = d_date_sk#24247L)
               :        :     :     :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_promo_sk#24211L, ss_ext_sales_price#24218, ss_net_profit#24225, ss_sold_date_sk#24226L, sr_return_amt#24237, sr_net_loss#24245]
               :        :     :     :     :  +- Join LeftOuter, ((ss_item_sk#24205L = sr_item_sk#24228L) AND (ss_ticket_number#24212L = sr_ticket_number#24235L))
               :        :     :     :     :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_promo_sk#24211L, ss_ticket_number#24212L, ss_ext_sales_price#24218, ss_net_profit#24225, ss_sold_date_sk#24226L]
               :        :     :     :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#24226L) AND isnotnull(ss_store_sk#24210L)) AND isnotnull(ss_item_sk#24205L)) AND isnotnull(ss_promo_sk#24211L)) AND dynamicpruning#24663 [ss_sold_date_sk#24226L])
               :        :     :     :     :     :     :  +- Project [d_date_sk#24247L]
               :        :     :     :     :     :     :     +- Filter ((isnotnull(d_date#24249) AND ((d_date#24249 >= 1998-08-04) AND (d_date#24249 <= 1998-09-03))) AND isnotnull(d_date_sk#24247L))
               :        :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24247L,d_date_id#24248,d_date#24249,d_month_seq#24250,d_week_seq#24251,d_quarter_seq#24252,d_year#24253,d_dow#24254,d_moy#24255,d_dom#24256,d_qoy#24257,d_fy_year#24258,d_fy_quarter_seq#24259,d_fy_week_seq#24260,d_day_name#24261,d_quarter_name#24262,d_holiday#24263,d_weekend#24264,d_following_holiday#24265,d_first_dom#24266,d_last_dom#24267,d_same_day_ly#24268,d_same_day_lq#24269,d_current_day#24270,... 4 more fields] orc
               :        :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24204L,ss_item_sk#24205L,ss_customer_sk#24206L,ss_cdemo_sk#24207L,ss_hdemo_sk#24208L,ss_addr_sk#24209L,ss_store_sk#24210L,ss_promo_sk#24211L,ss_ticket_number#24212L,ss_quantity#24213,ss_wholesale_cost#24214,ss_list_price#24215,ss_sales_price#24216,ss_ext_discount_amt#24217,ss_ext_sales_price#24218,ss_ext_wholesale_cost#24219,ss_ext_list_price#24220,ss_ext_tax#24221,ss_coupon_amt#24222,ss_net_paid#24223,ss_net_paid_inc_tax#24224,ss_net_profit#24225,ss_sold_date_sk#24226L] orc
               :        :     :     :     :     +- Project [sr_item_sk#24228L, sr_ticket_number#24235L, sr_return_amt#24237, sr_net_loss#24245]
               :        :     :     :     :        +- Filter (isnotnull(sr_item_sk#24228L) AND isnotnull(sr_ticket_number#24235L))
               :        :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#24227L,sr_item_sk#24228L,sr_customer_sk#24229L,sr_cdemo_sk#24230L,sr_hdemo_sk#24231L,sr_addr_sk#24232L,sr_store_sk#24233L,sr_reason_sk#24234L,sr_ticket_number#24235L,sr_return_quantity#24236,sr_return_amt#24237,sr_return_tax#24238,sr_return_amt_inc_tax#24239,sr_fee#24240,sr_return_ship_cost#24241,sr_refunded_cash#24242,sr_reversed_charge#24243,sr_store_credit#24244,sr_net_loss#24245,sr_returned_date_sk#24246L] orc
               :        :     :     :     +- Project [d_date_sk#24247L]
               :        :     :     :        +- Filter ((isnotnull(d_date#24249) AND ((d_date#24249 >= 1998-08-04) AND (d_date#24249 <= 1998-09-03))) AND isnotnull(d_date_sk#24247L))
               :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24247L,d_date_id#24248,d_date#24249,d_month_seq#24250,d_week_seq#24251,d_quarter_seq#24252,d_year#24253,d_dow#24254,d_moy#24255,d_dom#24256,d_qoy#24257,d_fy_year#24258,d_fy_quarter_seq#24259,d_fy_week_seq#24260,d_day_name#24261,d_quarter_name#24262,d_holiday#24263,d_weekend#24264,d_following_holiday#24265,d_first_dom#24266,d_last_dom#24267,d_same_day_ly#24268,d_same_day_lq#24269,d_current_day#24270,... 4 more fields] orc
               :        :     :     +- Project [p_promo_sk#24326L]
               :        :     :        +- Filter ((isnotnull(p_channel_tv#24337) AND (p_channel_tv#24337 = N)) AND isnotnull(p_promo_sk#24326L))
               :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24326L,p_promo_id#24327,p_start_date_sk#24328L,p_end_date_sk#24329L,p_item_sk#24330L,p_cost#24331,p_response_target#24332,p_promo_name#24333,p_channel_dmail#24334,p_channel_email#24335,p_channel_catalog#24336,p_channel_tv#24337,p_channel_radio#24338,p_channel_press#24339,p_channel_event#24340,p_channel_demo#24341,p_channel_details#24342,p_purpose#24343,p_discount_active#24344] orc
               :        :     +- Project [i_item_sk#24304L]
               :        :        +- Filter ((isnotnull(i_current_price#24309) AND (i_current_price#24309 > 50.0)) AND isnotnull(i_item_sk#24304L))
               :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24304L,i_item_id#24305,i_rec_start_date#24306,i_rec_end_date#24307,i_item_desc#24308,i_current_price#24309,i_wholesale_cost#24310,i_brand_id#24311,i_brand#24312,i_class_id#24313,i_class#24314,i_category_id#24315,i_category#24316,i_manufact_id#24317,i_manufact#24318,i_size#24319,i_formulation#24320,i_color#24321,i_units#24322,i_container#24323,i_manager_id#24324,i_product_name#24325] orc
               :        +- Project [s_store_sk#24275L, s_store_id#24276]
               :           +- Filter isnotnull(s_store_sk#24275L)
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24275L,s_store_id#24276,s_rec_start_date#24277,s_rec_end_date#24278,s_closed_date_sk#24279L,s_store_name#24280,s_number_employees#24281,s_floor_space#24282,s_hours#24283,s_manager#24284,s_market_id#24285,s_geography_class#24286,s_market_desc#24287,s_market_manager#24288,s_division_id#24289,s_division_name#24290,s_company_id#24291,s_company_name#24292,s_street_number#24293,s_street_name#24294,s_street_type#24295,s_suite_number#24296,s_city#24297,s_county#24298,... 5 more fields] orc
               :- Aggregate [cp_catalog_page_id#24435], [sum(cs_ext_sales_price#24367) AS sales#24198, sum(coalesce(cr_return_amount#24396, 0.0)) AS returns#24199, sum((cs_net_profit#24377 - coalesce(cr_net_loss#24404, 0.0))) AS profit#24200, catalog channel AS channel#24659, concat(catalog_page, cp_catalog_page_id#24435) AS id#24660]
               :  +- Project [cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404, cp_catalog_page_id#24435]
               :     +- Join Inner, (cs_catalog_page_sk#24356L = cp_catalog_page_sk#24434L)
               :        :- Project [cs_catalog_page_sk#24356L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
               :        :  +- Join Inner, (cs_item_sk#24359L = i_item_sk#24443L)
               :        :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
               :        :     :  +- Join Inner, (cs_promo_sk#24360L = p_promo_sk#24465L)
               :        :     :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_promo_sk#24360L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
               :        :     :     :  +- Join Inner, (cs_sold_date_sk#24378L = d_date_sk#24406L)
               :        :     :     :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_promo_sk#24360L, cs_ext_sales_price#24367, cs_net_profit#24377, cs_sold_date_sk#24378L, cr_return_amount#24396, cr_net_loss#24404]
               :        :     :     :     :  +- Join LeftOuter, ((cs_item_sk#24359L = cr_item_sk#24380L) AND (cs_order_number#24361L = cr_order_number#24394L))
               :        :     :     :     :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_promo_sk#24360L, cs_order_number#24361L, cs_ext_sales_price#24367, cs_net_profit#24377, cs_sold_date_sk#24378L]
               :        :     :     :     :     :  +- Filter ((((isnotnull(cs_sold_date_sk#24378L) AND isnotnull(cs_catalog_page_sk#24356L)) AND isnotnull(cs_item_sk#24359L)) AND isnotnull(cs_promo_sk#24360L)) AND dynamicpruning#24664 [cs_sold_date_sk#24378L])
               :        :     :     :     :     :     :  +- Project [d_date_sk#24406L]
               :        :     :     :     :     :     :     +- Filter ((isnotnull(d_date#24408) AND ((d_date#24408 >= 1998-08-04) AND (d_date#24408 <= 1998-09-03))) AND isnotnull(d_date_sk#24406L))
               :        :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24406L,d_date_id#24407,d_date#24408,d_month_seq#24409,d_week_seq#24410,d_quarter_seq#24411,d_year#24412,d_dow#24413,d_moy#24414,d_dom#24415,d_qoy#24416,d_fy_year#24417,d_fy_quarter_seq#24418,d_fy_week_seq#24419,d_day_name#24420,d_quarter_name#24421,d_holiday#24422,d_weekend#24423,d_following_holiday#24424,d_first_dom#24425,d_last_dom#24426,d_same_day_ly#24427,d_same_day_lq#24428,d_current_day#24429,... 4 more fields] orc
               :        :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#24345L,cs_ship_date_sk#24346L,cs_bill_customer_sk#24347L,cs_bill_cdemo_sk#24348L,cs_bill_hdemo_sk#24349L,cs_bill_addr_sk#24350L,cs_ship_customer_sk#24351L,cs_ship_cdemo_sk#24352L,cs_ship_hdemo_sk#24353L,cs_ship_addr_sk#24354L,cs_call_center_sk#24355L,cs_catalog_page_sk#24356L,cs_ship_mode_sk#24357L,cs_warehouse_sk#24358L,cs_item_sk#24359L,cs_promo_sk#24360L,cs_order_number#24361L,cs_quantity#24362,cs_wholesale_cost#24363,cs_list_price#24364,cs_sales_price#24365,cs_ext_discount_amt#24366,cs_ext_sales_price#24367,cs_ext_wholesale_cost#24368,... 10 more fields] orc
               :        :     :     :     :     +- Project [cr_item_sk#24380L, cr_order_number#24394L, cr_return_amount#24396, cr_net_loss#24404]
               :        :     :     :     :        +- Filter (isnotnull(cr_item_sk#24380L) AND isnotnull(cr_order_number#24394L))
               :        :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24379L,cr_item_sk#24380L,cr_refunded_customer_sk#24381L,cr_refunded_cdemo_sk#24382L,cr_refunded_hdemo_sk#24383L,cr_refunded_addr_sk#24384L,cr_returning_customer_sk#24385L,cr_returning_cdemo_sk#24386L,cr_returning_hdemo_sk#24387L,cr_returning_addr_sk#24388L,cr_call_center_sk#24389L,cr_catalog_page_sk#24390L,cr_ship_mode_sk#24391L,cr_warehouse_sk#24392L,cr_reason_sk#24393L,cr_order_number#24394L,cr_return_quantity#24395,cr_return_amount#24396,cr_return_tax#24397,cr_return_amt_inc_tax#24398,cr_fee#24399,cr_return_ship_cost#24400,cr_refunded_cash#24401,cr_reversed_charge#24402,... 3 more fields] orc
               :        :     :     :     +- Project [d_date_sk#24406L]
               :        :     :     :        +- Filter ((isnotnull(d_date#24408) AND ((d_date#24408 >= 1998-08-04) AND (d_date#24408 <= 1998-09-03))) AND isnotnull(d_date_sk#24406L))
               :        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24406L,d_date_id#24407,d_date#24408,d_month_seq#24409,d_week_seq#24410,d_quarter_seq#24411,d_year#24412,d_dow#24413,d_moy#24414,d_dom#24415,d_qoy#24416,d_fy_year#24417,d_fy_quarter_seq#24418,d_fy_week_seq#24419,d_day_name#24420,d_quarter_name#24421,d_holiday#24422,d_weekend#24423,d_following_holiday#24424,d_first_dom#24425,d_last_dom#24426,d_same_day_ly#24427,d_same_day_lq#24428,d_current_day#24429,... 4 more fields] orc
               :        :     :     +- Project [p_promo_sk#24465L]
               :        :     :        +- Filter ((isnotnull(p_channel_tv#24476) AND (p_channel_tv#24476 = N)) AND isnotnull(p_promo_sk#24465L))
               :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24465L,p_promo_id#24466,p_start_date_sk#24467L,p_end_date_sk#24468L,p_item_sk#24469L,p_cost#24470,p_response_target#24471,p_promo_name#24472,p_channel_dmail#24473,p_channel_email#24474,p_channel_catalog#24475,p_channel_tv#24476,p_channel_radio#24477,p_channel_press#24478,p_channel_event#24479,p_channel_demo#24480,p_channel_details#24481,p_purpose#24482,p_discount_active#24483] orc
               :        :     +- Project [i_item_sk#24443L]
               :        :        +- Filter ((isnotnull(i_current_price#24448) AND (i_current_price#24448 > 50.0)) AND isnotnull(i_item_sk#24443L))
               :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24443L,i_item_id#24444,i_rec_start_date#24445,i_rec_end_date#24446,i_item_desc#24447,i_current_price#24448,i_wholesale_cost#24449,i_brand_id#24450,i_brand#24451,i_class_id#24452,i_class#24453,i_category_id#24454,i_category#24455,i_manufact_id#24456,i_manufact#24457,i_size#24458,i_formulation#24459,i_color#24460,i_units#24461,i_container#24462,i_manager_id#24463,i_product_name#24464] orc
               :        +- Project [cp_catalog_page_sk#24434L, cp_catalog_page_id#24435]
               :           +- Filter isnotnull(cp_catalog_page_sk#24434L)
               :              +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#24434L,cp_catalog_page_id#24435,cp_start_date_sk#24436L,cp_end_date_sk#24437L,cp_department#24438,cp_catalog_number#24439,cp_catalog_page_number#24440,cp_description#24441,cp_type#24442] orc
               +- Aggregate [web_site_id#24571], [sum(ws_ext_sales_price#24506) AS sales#24201, sum(coalesce(wr_return_amt#24532, 0.0)) AS returns#24202, sum((ws_net_profit#24516 - coalesce(wr_net_loss#24540, 0.0))) AS profit#24203, web channel AS channel#24661, concat(web_site, web_site_id#24571) AS id#24662]
                  +- Project [ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540, web_site_id#24571]
                     +- Join Inner, (ws_web_site_sk#24496L = web_site_sk#24570L)
                        :- Project [ws_web_site_sk#24496L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                        :  +- Join Inner, (ws_item_sk#24486L = i_item_sk#24596L)
                        :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                        :     :  +- Join Inner, (ws_promo_sk#24499L = p_promo_sk#24618L)
                        :     :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_promo_sk#24499L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                        :     :     :  +- Join Inner, (ws_sold_date_sk#24517L = d_date_sk#24542L)
                        :     :     :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_promo_sk#24499L, ws_ext_sales_price#24506, ws_net_profit#24516, ws_sold_date_sk#24517L, wr_return_amt#24532, wr_net_loss#24540]
                        :     :     :     :  +- Join LeftOuter, ((ws_item_sk#24486L = wr_item_sk#24519L) AND (ws_order_number#24500L = wr_order_number#24530L))
                        :     :     :     :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_promo_sk#24499L, ws_order_number#24500L, ws_ext_sales_price#24506, ws_net_profit#24516, ws_sold_date_sk#24517L]
                        :     :     :     :     :  +- Filter ((((isnotnull(ws_sold_date_sk#24517L) AND isnotnull(ws_web_site_sk#24496L)) AND isnotnull(ws_item_sk#24486L)) AND isnotnull(ws_promo_sk#24499L)) AND dynamicpruning#24665 [ws_sold_date_sk#24517L])
                        :     :     :     :     :     :  +- Project [d_date_sk#24542L]
                        :     :     :     :     :     :     +- Filter ((isnotnull(d_date#24544) AND ((d_date#24544 >= 1998-08-04) AND (d_date#24544 <= 1998-09-03))) AND isnotnull(d_date_sk#24542L))
                        :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24542L,d_date_id#24543,d_date#24544,d_month_seq#24545,d_week_seq#24546,d_quarter_seq#24547,d_year#24548,d_dow#24549,d_moy#24550,d_dom#24551,d_qoy#24552,d_fy_year#24553,d_fy_quarter_seq#24554,d_fy_week_seq#24555,d_day_name#24556,d_quarter_name#24557,d_holiday#24558,d_weekend#24559,d_following_holiday#24560,d_first_dom#24561,d_last_dom#24562,d_same_day_ly#24563,d_same_day_lq#24564,d_current_day#24565,... 4 more fields] orc
                        :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#24484L,ws_ship_date_sk#24485L,ws_item_sk#24486L,ws_bill_customer_sk#24487L,ws_bill_cdemo_sk#24488L,ws_bill_hdemo_sk#24489L,ws_bill_addr_sk#24490L,ws_ship_customer_sk#24491L,ws_ship_cdemo_sk#24492L,ws_ship_hdemo_sk#24493L,ws_ship_addr_sk#24494L,ws_web_page_sk#24495L,ws_web_site_sk#24496L,ws_ship_mode_sk#24497L,ws_warehouse_sk#24498L,ws_promo_sk#24499L,ws_order_number#24500L,ws_quantity#24501,ws_wholesale_cost#24502,ws_list_price#24503,ws_sales_price#24504,ws_ext_discount_amt#24505,ws_ext_sales_price#24506,ws_ext_wholesale_cost#24507,... 10 more fields] orc
                        :     :     :     :     +- Project [wr_item_sk#24519L, wr_order_number#24530L, wr_return_amt#24532, wr_net_loss#24540]
                        :     :     :     :        +- Filter (isnotnull(wr_item_sk#24519L) AND isnotnull(wr_order_number#24530L))
                        :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#24518L,wr_item_sk#24519L,wr_refunded_customer_sk#24520L,wr_refunded_cdemo_sk#24521L,wr_refunded_hdemo_sk#24522L,wr_refunded_addr_sk#24523L,wr_returning_customer_sk#24524L,wr_returning_cdemo_sk#24525L,wr_returning_hdemo_sk#24526L,wr_returning_addr_sk#24527L,wr_web_page_sk#24528L,wr_reason_sk#24529L,wr_order_number#24530L,wr_return_quantity#24531,wr_return_amt#24532,wr_return_tax#24533,wr_return_amt_inc_tax#24534,wr_fee#24535,wr_return_ship_cost#24536,wr_refunded_cash#24537,wr_reversed_charge#24538,wr_account_credit#24539,wr_net_loss#24540,wr_returned_date_sk#24541L] orc
                        :     :     :     +- Project [d_date_sk#24542L]
                        :     :     :        +- Filter ((isnotnull(d_date#24544) AND ((d_date#24544 >= 1998-08-04) AND (d_date#24544 <= 1998-09-03))) AND isnotnull(d_date_sk#24542L))
                        :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24542L,d_date_id#24543,d_date#24544,d_month_seq#24545,d_week_seq#24546,d_quarter_seq#24547,d_year#24548,d_dow#24549,d_moy#24550,d_dom#24551,d_qoy#24552,d_fy_year#24553,d_fy_quarter_seq#24554,d_fy_week_seq#24555,d_day_name#24556,d_quarter_name#24557,d_holiday#24558,d_weekend#24559,d_following_holiday#24560,d_first_dom#24561,d_last_dom#24562,d_same_day_ly#24563,d_same_day_lq#24564,d_current_day#24565,... 4 more fields] orc
                        :     :     +- Project [p_promo_sk#24618L]
                        :     :        +- Filter ((isnotnull(p_channel_tv#24629) AND (p_channel_tv#24629 = N)) AND isnotnull(p_promo_sk#24618L))
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24618L,p_promo_id#24619,p_start_date_sk#24620L,p_end_date_sk#24621L,p_item_sk#24622L,p_cost#24623,p_response_target#24624,p_promo_name#24625,p_channel_dmail#24626,p_channel_email#24627,p_channel_catalog#24628,p_channel_tv#24629,p_channel_radio#24630,p_channel_press#24631,p_channel_event#24632,p_channel_demo#24633,p_channel_details#24634,p_purpose#24635,p_discount_active#24636] orc
                        :     +- Project [i_item_sk#24596L]
                        :        +- Filter ((isnotnull(i_current_price#24601) AND (i_current_price#24601 > 50.0)) AND isnotnull(i_item_sk#24596L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24596L,i_item_id#24597,i_rec_start_date#24598,i_rec_end_date#24599,i_item_desc#24600,i_current_price#24601,i_wholesale_cost#24602,i_brand_id#24603,i_brand#24604,i_class_id#24605,i_class#24606,i_category_id#24607,i_category#24608,i_manufact_id#24609,i_manufact#24610,i_size#24611,i_formulation#24612,i_color#24613,i_units#24614,i_container#24615,i_manager_id#24616,i_product_name#24617] orc
                        +- Project [web_site_sk#24570L, web_site_id#24571]
                           +- Filter isnotnull(web_site_sk#24570L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#24570L,web_site_id#24571,web_rec_start_date#24572,web_rec_end_date#24573,web_name#24574,web_open_date_sk#24575L,web_close_date_sk#24576L,web_class#24577,web_manager#24578,web_mkt_id#24579,web_mkt_class#24580,web_mkt_desc#24581,web_market_manager#24582,web_company_id#24583,web_company_name#24584,web_street_number#24585,web_street_name#24586,web_street_type#24587,web_suite_number#24588,web_city#24589,web_county#24590,web_state#24591,web_zip#24592,web_country#24593,... 2 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[channel#24652 ASC NULLS FIRST,id#24653 ASC NULLS FIRST], output=[channel#24652,id#24653,sales#24190,returns#24191,profit#24192])
   +- HashAggregate(keys=[channel#24652, id#24653, spark_grouping_id#24651L], functions=[sum(sales#24194), sum(returns#24195), sum(profit#24196)], output=[channel#24652, id#24653, sales#24190, returns#24191, profit#24192])
      +- Exchange hashpartitioning(channel#24652, id#24653, spark_grouping_id#24651L, 3000), ENSURE_REQUIREMENTS, [id=#25324]
         +- HashAggregate(keys=[channel#24652, id#24653, spark_grouping_id#24651L], functions=[partial_sum(sales#24194), partial_sum(returns#24195), partial_sum(profit#24196)], output=[channel#24652, id#24653, spark_grouping_id#24651L, sum#24669, sum#24670, sum#24671])
            +- Expand [[sales#24194, returns#24195, profit#24196, channel#24649, id#24650, 0], [sales#24194, returns#24195, profit#24196, channel#24649, null, 1], [sales#24194, returns#24195, profit#24196, null, null, 3]], [sales#24194, returns#24195, profit#24196, channel#24652, id#24653, spark_grouping_id#24651L]
               +- Union
                  :- HashAggregate(keys=[s_store_id#24276], functions=[sum(ss_ext_sales_price#24218), sum(coalesce(sr_return_amt#24237, 0.0)), sum((ss_net_profit#24225 - coalesce(sr_net_loss#24245, 0.0)))], output=[sales#24194, returns#24195, profit#24196, channel#24649, id#24650])
                  :  +- Exchange hashpartitioning(s_store_id#24276, 3000), ENSURE_REQUIREMENTS, [id=#25264]
                  :     +- HashAggregate(keys=[s_store_id#24276], functions=[partial_sum(ss_ext_sales_price#24218), partial_sum(coalesce(sr_return_amt#24237, 0.0)), partial_sum((ss_net_profit#24225 - coalesce(sr_net_loss#24245, 0.0)))], output=[s_store_id#24276, sum#24675, sum#24676, sum#24677])
                  :        +- Project [ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245, s_store_id#24276]
                  :           +- BroadcastHashJoin [ss_store_sk#24210L], [s_store_sk#24275L], Inner, BuildRight, false
                  :              :- Project [ss_store_sk#24210L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
                  :              :  +- BroadcastHashJoin [ss_item_sk#24205L], [i_item_sk#24304L], Inner, BuildRight, false
                  :              :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
                  :              :     :  +- BroadcastHashJoin [ss_promo_sk#24211L], [p_promo_sk#24326L], Inner, BuildRight, false
                  :              :     :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_promo_sk#24211L, ss_ext_sales_price#24218, ss_net_profit#24225, sr_return_amt#24237, sr_net_loss#24245]
                  :              :     :     :  +- BroadcastHashJoin [ss_sold_date_sk#24226L], [d_date_sk#24247L], Inner, BuildRight, false
                  :              :     :     :     :- Project [ss_item_sk#24205L, ss_store_sk#24210L, ss_promo_sk#24211L, ss_ext_sales_price#24218, ss_net_profit#24225, ss_sold_date_sk#24226L, sr_return_amt#24237, sr_net_loss#24245]
                  :              :     :     :     :  +- SortMergeJoin [ss_item_sk#24205L, ss_ticket_number#24212L], [sr_item_sk#24228L, sr_ticket_number#24235L], LeftOuter
                  :              :     :     :     :     :- Sort [ss_item_sk#24205L ASC NULLS FIRST, ss_ticket_number#24212L ASC NULLS FIRST], false, 0
                  :              :     :     :     :     :  +- Exchange hashpartitioning(ss_item_sk#24205L, ss_ticket_number#24212L, 3000), ENSURE_REQUIREMENTS, [id=#25240]
                  :              :     :     :     :     :     +- Filter ((isnotnull(ss_store_sk#24210L) AND isnotnull(ss_item_sk#24205L)) AND isnotnull(ss_promo_sk#24211L))
                  :              :     :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#24205L,ss_store_sk#24210L,ss_promo_sk#24211L,ss_ticket_number#24212L,ss_ext_sales_price#24218,ss_net_profit#24225,ss_sold_date_sk#24226L] Batched: true, DataFilters: [isnotnull(ss_store_sk#24210L), isnotnull(ss_item_sk#24205L), isnotnull(ss_promo_sk#24211L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#24226L), dynamicpruningexpression(ss_sold_date_sk#24226L IN dynamicpru..., PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk), IsNotNull(ss_promo_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_promo_sk:bigint,ss_ticket_number:bigint,ss_ext_sal...
                  :              :     :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#24663, 0, true, Project [d_date_sk#24247L], [d_date_sk#24247L]
                  :              :     :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :     :     :     :                    +- Project [d_date_sk#24247L]
                  :              :     :     :     :     :                       +- Filter (((isnotnull(d_date#24249) AND (d_date#24249 >= 1998-08-04)) AND (d_date#24249 <= 1998-09-03)) AND isnotnull(d_date_sk#24247L))
                  :              :     :     :     :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24247L,d_date#24249] Batched: true, DataFilters: [isnotnull(d_date#24249), (d_date#24249 >= 1998-08-04), (d_date#24249 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :     :     :     +- Sort [sr_item_sk#24228L ASC NULLS FIRST, sr_ticket_number#24235L ASC NULLS FIRST], false, 0
                  :              :     :     :     :        +- Exchange hashpartitioning(sr_item_sk#24228L, sr_ticket_number#24235L, 3000), ENSURE_REQUIREMENTS, [id=#25241]
                  :              :     :     :     :           +- Project [sr_item_sk#24228L, sr_ticket_number#24235L, sr_return_amt#24237, sr_net_loss#24245]
                  :              :     :     :     :              +- Filter (isnotnull(sr_item_sk#24228L) AND isnotnull(sr_ticket_number#24235L))
                  :              :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#24228L,sr_ticket_number#24235L,sr_return_amt#24237,sr_net_loss#24245,sr_returned_date_sk#24246L] Batched: true, DataFilters: [isnotnull(sr_item_sk#24228L), isnotnull(sr_ticket_number#24235L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number)], ReadSchema: struct<sr_item_sk:bigint,sr_ticket_number:bigint,sr_return_amt:double,sr_net_loss:double>
                  :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25247]
                  :              :     :     :        +- Project [d_date_sk#24247L]
                  :              :     :     :           +- Filter (((isnotnull(d_date#24249) AND (d_date#24249 >= 1998-08-04)) AND (d_date#24249 <= 1998-09-03)) AND isnotnull(d_date_sk#24247L))
                  :              :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24247L,d_date#24249] Batched: true, DataFilters: [isnotnull(d_date#24249), (d_date#24249 >= 1998-08-04), (d_date#24249 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25251]
                  :              :     :        +- Project [p_promo_sk#24326L]
                  :              :     :           +- Filter ((isnotnull(p_channel_tv#24337) AND (p_channel_tv#24337 = N)) AND isnotnull(p_promo_sk#24326L))
                  :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24326L,p_channel_tv#24337] Batched: true, DataFilters: [isnotnull(p_channel_tv#24337), (p_channel_tv#24337 = N), isnotnull(p_promo_sk#24326L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_channel_tv), EqualTo(p_channel_tv,N), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint,p_channel_tv:string>
                  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25255]
                  :              :        +- Project [i_item_sk#24304L]
                  :              :           +- Filter ((isnotnull(i_current_price#24309) AND (i_current_price#24309 > 50.0)) AND isnotnull(i_item_sk#24304L))
                  :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24304L,i_current_price#24309] Batched: true, DataFilters: [isnotnull(i_current_price#24309), (i_current_price#24309 > 50.0), isnotnull(i_item_sk#24304L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThan(i_current_price,50.0), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double>
                  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#25259]
                  :                 +- Filter isnotnull(s_store_sk#24275L)
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#24275L,s_store_id#24276] Batched: true, DataFilters: [isnotnull(s_store_sk#24275L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_id:string>
                  :- HashAggregate(keys=[cp_catalog_page_id#24435], functions=[sum(cs_ext_sales_price#24367), sum(coalesce(cr_return_amount#24396, 0.0)), sum((cs_net_profit#24377 - coalesce(cr_net_loss#24404, 0.0)))], output=[sales#24198, returns#24199, profit#24200, channel#24659, id#24660])
                  :  +- Exchange hashpartitioning(cp_catalog_page_id#24435, 3000), ENSURE_REQUIREMENTS, [id=#25291]
                  :     +- HashAggregate(keys=[cp_catalog_page_id#24435], functions=[partial_sum(cs_ext_sales_price#24367), partial_sum(coalesce(cr_return_amount#24396, 0.0)), partial_sum((cs_net_profit#24377 - coalesce(cr_net_loss#24404, 0.0)))], output=[cp_catalog_page_id#24435, sum#24681, sum#24682, sum#24683])
                  :        +- Project [cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404, cp_catalog_page_id#24435]
                  :           +- BroadcastHashJoin [cs_catalog_page_sk#24356L], [cp_catalog_page_sk#24434L], Inner, BuildRight, false
                  :              :- Project [cs_catalog_page_sk#24356L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
                  :              :  +- BroadcastHashJoin [cs_item_sk#24359L], [i_item_sk#24443L], Inner, BuildRight, false
                  :              :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
                  :              :     :  +- BroadcastHashJoin [cs_promo_sk#24360L], [p_promo_sk#24465L], Inner, BuildRight, false
                  :              :     :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_promo_sk#24360L, cs_ext_sales_price#24367, cs_net_profit#24377, cr_return_amount#24396, cr_net_loss#24404]
                  :              :     :     :  +- BroadcastHashJoin [cs_sold_date_sk#24378L], [d_date_sk#24406L], Inner, BuildRight, false
                  :              :     :     :     :- Project [cs_catalog_page_sk#24356L, cs_item_sk#24359L, cs_promo_sk#24360L, cs_ext_sales_price#24367, cs_net_profit#24377, cs_sold_date_sk#24378L, cr_return_amount#24396, cr_net_loss#24404]
                  :              :     :     :     :  +- SortMergeJoin [cs_item_sk#24359L, cs_order_number#24361L], [cr_item_sk#24380L, cr_order_number#24394L], LeftOuter
                  :              :     :     :     :     :- Sort [cs_item_sk#24359L ASC NULLS FIRST, cs_order_number#24361L ASC NULLS FIRST], false, 0
                  :              :     :     :     :     :  +- Exchange hashpartitioning(cs_item_sk#24359L, cs_order_number#24361L, 3000), ENSURE_REQUIREMENTS, [id=#25267]
                  :              :     :     :     :     :     +- Filter ((isnotnull(cs_catalog_page_sk#24356L) AND isnotnull(cs_item_sk#24359L)) AND isnotnull(cs_promo_sk#24360L))
                  :              :     :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_catalog_page_sk#24356L,cs_item_sk#24359L,cs_promo_sk#24360L,cs_order_number#24361L,cs_ext_sales_price#24367,cs_net_profit#24377,cs_sold_date_sk#24378L] Batched: true, DataFilters: [isnotnull(cs_catalog_page_sk#24356L), isnotnull(cs_item_sk#24359L), isnotnull(cs_promo_sk#24360L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#24378L), dynamicpruningexpression(cs_sold_date_sk#24378L IN dynamicpru..., PushedFilters: [IsNotNull(cs_catalog_page_sk), IsNotNull(cs_item_sk), IsNotNull(cs_promo_sk)], ReadSchema: struct<cs_catalog_page_sk:bigint,cs_item_sk:bigint,cs_promo_sk:bigint,cs_order_number:bigint,cs_e...
                  :              :     :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#24664, 0, true, Project [d_date_sk#24406L], [d_date_sk#24406L]
                  :              :     :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                  :              :     :     :     :     :                    +- Project [d_date_sk#24406L]
                  :              :     :     :     :     :                       +- Filter (((isnotnull(d_date#24408) AND (d_date#24408 >= 1998-08-04)) AND (d_date#24408 <= 1998-09-03)) AND isnotnull(d_date_sk#24406L))
                  :              :     :     :     :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24406L,d_date#24408] Batched: true, DataFilters: [isnotnull(d_date#24408), (d_date#24408 >= 1998-08-04), (d_date#24408 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :     :     :     +- Sort [cr_item_sk#24380L ASC NULLS FIRST, cr_order_number#24394L ASC NULLS FIRST], false, 0
                  :              :     :     :     :        +- Exchange hashpartitioning(cr_item_sk#24380L, cr_order_number#24394L, 3000), ENSURE_REQUIREMENTS, [id=#25268]
                  :              :     :     :     :           +- Project [cr_item_sk#24380L, cr_order_number#24394L, cr_return_amount#24396, cr_net_loss#24404]
                  :              :     :     :     :              +- Filter (isnotnull(cr_item_sk#24380L) AND isnotnull(cr_order_number#24394L))
                  :              :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#24380L,cr_order_number#24394L,cr_return_amount#24396,cr_net_loss#24404,cr_returned_date_sk#24405L] Batched: true, DataFilters: [isnotnull(cr_item_sk#24380L), isnotnull(cr_order_number#24394L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_order_number)], ReadSchema: struct<cr_item_sk:bigint,cr_order_number:bigint,cr_return_amount:double,cr_net_loss:double>
                  :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25274]
                  :              :     :     :        +- Project [d_date_sk#24406L]
                  :              :     :     :           +- Filter (((isnotnull(d_date#24408) AND (d_date#24408 >= 1998-08-04)) AND (d_date#24408 <= 1998-09-03)) AND isnotnull(d_date_sk#24406L))
                  :              :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24406L,d_date#24408] Batched: true, DataFilters: [isnotnull(d_date#24408), (d_date#24408 >= 1998-08-04), (d_date#24408 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25278]
                  :              :     :        +- Project [p_promo_sk#24465L]
                  :              :     :           +- Filter ((isnotnull(p_channel_tv#24476) AND (p_channel_tv#24476 = N)) AND isnotnull(p_promo_sk#24465L))
                  :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24465L,p_channel_tv#24476] Batched: true, DataFilters: [isnotnull(p_channel_tv#24476), (p_channel_tv#24476 = N), isnotnull(p_promo_sk#24465L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_channel_tv), EqualTo(p_channel_tv,N), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint,p_channel_tv:string>
                  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25282]
                  :              :        +- Project [i_item_sk#24443L]
                  :              :           +- Filter ((isnotnull(i_current_price#24448) AND (i_current_price#24448 > 50.0)) AND isnotnull(i_item_sk#24443L))
                  :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24443L,i_current_price#24448] Batched: true, DataFilters: [isnotnull(i_current_price#24448), (i_current_price#24448 > 50.0), isnotnull(i_item_sk#24443L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThan(i_current_price,50.0), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double>
                  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#25286]
                  :                 +- Filter isnotnull(cp_catalog_page_sk#24434L)
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_page[cp_catalog_page_sk#24434L,cp_catalog_page_id#24435] Batched: true, DataFilters: [isnotnull(cp_catalog_page_sk#24434L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cp_catalog_page_sk)], ReadSchema: struct<cp_catalog_page_sk:bigint,cp_catalog_page_id:string>
                  +- HashAggregate(keys=[web_site_id#24571], functions=[sum(ws_ext_sales_price#24506), sum(coalesce(wr_return_amt#24532, 0.0)), sum((ws_net_profit#24516 - coalesce(wr_net_loss#24540, 0.0)))], output=[sales#24201, returns#24202, profit#24203, channel#24661, id#24662])
                     +- Exchange hashpartitioning(web_site_id#24571, 3000), ENSURE_REQUIREMENTS, [id=#25318]
                        +- HashAggregate(keys=[web_site_id#24571], functions=[partial_sum(ws_ext_sales_price#24506), partial_sum(coalesce(wr_return_amt#24532, 0.0)), partial_sum((ws_net_profit#24516 - coalesce(wr_net_loss#24540, 0.0)))], output=[web_site_id#24571, sum#24687, sum#24688, sum#24689])
                           +- Project [ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540, web_site_id#24571]
                              +- BroadcastHashJoin [ws_web_site_sk#24496L], [web_site_sk#24570L], Inner, BuildRight, false
                                 :- Project [ws_web_site_sk#24496L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                                 :  +- BroadcastHashJoin [ws_item_sk#24486L], [i_item_sk#24596L], Inner, BuildRight, false
                                 :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                                 :     :  +- BroadcastHashJoin [ws_promo_sk#24499L], [p_promo_sk#24618L], Inner, BuildRight, false
                                 :     :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_promo_sk#24499L, ws_ext_sales_price#24506, ws_net_profit#24516, wr_return_amt#24532, wr_net_loss#24540]
                                 :     :     :  +- BroadcastHashJoin [ws_sold_date_sk#24517L], [d_date_sk#24542L], Inner, BuildRight, false
                                 :     :     :     :- Project [ws_item_sk#24486L, ws_web_site_sk#24496L, ws_promo_sk#24499L, ws_ext_sales_price#24506, ws_net_profit#24516, ws_sold_date_sk#24517L, wr_return_amt#24532, wr_net_loss#24540]
                                 :     :     :     :  +- SortMergeJoin [ws_item_sk#24486L, ws_order_number#24500L], [wr_item_sk#24519L, wr_order_number#24530L], LeftOuter
                                 :     :     :     :     :- Sort [ws_item_sk#24486L ASC NULLS FIRST, ws_order_number#24500L ASC NULLS FIRST], false, 0
                                 :     :     :     :     :  +- Exchange hashpartitioning(ws_item_sk#24486L, ws_order_number#24500L, 3000), ENSURE_REQUIREMENTS, [id=#25294]
                                 :     :     :     :     :     +- Filter ((isnotnull(ws_web_site_sk#24496L) AND isnotnull(ws_item_sk#24486L)) AND isnotnull(ws_promo_sk#24499L))
                                 :     :     :     :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#24486L,ws_web_site_sk#24496L,ws_promo_sk#24499L,ws_order_number#24500L,ws_ext_sales_price#24506,ws_net_profit#24516,ws_sold_date_sk#24517L] Batched: true, DataFilters: [isnotnull(ws_web_site_sk#24496L), isnotnull(ws_item_sk#24486L), isnotnull(ws_promo_sk#24499L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#24517L), dynamicpruningexpression(ws_sold_date_sk#24517L IN dynamicpru..., PushedFilters: [IsNotNull(ws_web_site_sk), IsNotNull(ws_item_sk), IsNotNull(ws_promo_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_web_site_sk:bigint,ws_promo_sk:bigint,ws_order_number:bigint,ws_ext_s...
                                 :     :     :     :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#24665, 0, true, Project [d_date_sk#24542L], [d_date_sk#24542L]
                                 :     :     :     :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :     :     :     :                    +- Project [d_date_sk#24542L]
                                 :     :     :     :     :                       +- Filter (((isnotnull(d_date#24544) AND (d_date#24544 >= 1998-08-04)) AND (d_date#24544 <= 1998-09-03)) AND isnotnull(d_date_sk#24542L))
                                 :     :     :     :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24542L,d_date#24544] Batched: true, DataFilters: [isnotnull(d_date#24544), (d_date#24544 >= 1998-08-04), (d_date#24544 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                 :     :     :     :     +- Sort [wr_item_sk#24519L ASC NULLS FIRST, wr_order_number#24530L ASC NULLS FIRST], false, 0
                                 :     :     :     :        +- Exchange hashpartitioning(wr_item_sk#24519L, wr_order_number#24530L, 3000), ENSURE_REQUIREMENTS, [id=#25295]
                                 :     :     :     :           +- Project [wr_item_sk#24519L, wr_order_number#24530L, wr_return_amt#24532, wr_net_loss#24540]
                                 :     :     :     :              +- Filter (isnotnull(wr_item_sk#24519L) AND isnotnull(wr_order_number#24530L))
                                 :     :     :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#24519L,wr_order_number#24530L,wr_return_amt#24532,wr_net_loss#24540,wr_returned_date_sk#24541L] Batched: true, DataFilters: [isnotnull(wr_item_sk#24519L), isnotnull(wr_order_number#24530L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_item_sk), IsNotNull(wr_order_number)], ReadSchema: struct<wr_item_sk:bigint,wr_order_number:bigint,wr_return_amt:double,wr_net_loss:double>
                                 :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25301]
                                 :     :     :        +- Project [d_date_sk#24542L]
                                 :     :     :           +- Filter (((isnotnull(d_date#24544) AND (d_date#24544 >= 1998-08-04)) AND (d_date#24544 <= 1998-09-03)) AND isnotnull(d_date_sk#24542L))
                                 :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24542L,d_date#24544] Batched: true, DataFilters: [isnotnull(d_date#24544), (d_date#24544 >= 1998-08-04), (d_date#24544 <= 1998-09-03), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-08-04), LessThanOrEqual(d_date,1998-09-03), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                 :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25305]
                                 :     :        +- Project [p_promo_sk#24618L]
                                 :     :           +- Filter ((isnotnull(p_channel_tv#24629) AND (p_channel_tv#24629 = N)) AND isnotnull(p_promo_sk#24618L))
                                 :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.promotion[p_promo_sk#24618L,p_channel_tv#24629] Batched: true, DataFilters: [isnotnull(p_channel_tv#24629), (p_channel_tv#24629 = N), isnotnull(p_promo_sk#24618L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(p_channel_tv), EqualTo(p_channel_tv,N), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:bigint,p_channel_tv:string>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25309]
                                 :        +- Project [i_item_sk#24596L]
                                 :           +- Filter ((isnotnull(i_current_price#24601) AND (i_current_price#24601 > 50.0)) AND isnotnull(i_item_sk#24596L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24596L,i_current_price#24601] Batched: true, DataFilters: [isnotnull(i_current_price#24601), (i_current_price#24601 > 50.0), isnotnull(i_item_sk#24596L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThan(i_current_price,50.0), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_current_price:double>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#25313]
                                    +- Filter isnotnull(web_site_sk#24570L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#24570L,web_site_id#24571] Batched: true, DataFilters: [isnotnull(web_site_sk#24570L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:bigint,web_site_id:string>

read query: spark_queries/q81.sql
explain query: q81
== Parsed Logical Plan ==
CTE [customer_total_return]
:  +- 'SubqueryAlias customer_total_return
:     +- 'Aggregate ['cr_returning_customer_sk, 'ca_state], ['cr_returning_customer_sk AS ctr_customer_sk#24691, 'ca_state AS ctr_state#24692, 'sum('cr_return_amt_inc_tax) AS ctr_total_return#24693]
:        +- 'Filter ((('cr_returned_date_sk = 'd_date_sk) AND ('d_year = 1998)) AND ('cr_returning_addr_sk = 'ca_address_sk))
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [catalog_returns], [], false
:              :  +- 'UnresolvedRelation [date_dim], [], false
:              +- 'UnresolvedRelation [customer_address], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['c_customer_id ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_last_name ASC NULLS FIRST, 'ca_street_number ASC NULLS FIRST, 'ca_street_name ASC NULLS FIRST, 'ca_street_type ASC NULLS FIRST, 'ca_suite_number ASC NULLS FIRST, 'ca_city ASC NULLS FIRST, 'ca_county ASC NULLS FIRST, 'ca_state ASC NULLS FIRST, 'ca_zip ASC NULLS FIRST, 'ca_country ASC NULLS FIRST, 'ca_gmt_offset ASC NULLS FIRST, 'ca_location_type ASC NULLS FIRST, 'ctr_total_return ASC NULLS FIRST], true
         +- 'Project ['c_customer_id, 'c_salutation, 'c_first_name, 'c_last_name, 'ca_street_number, 'ca_street_name, 'ca_street_type, 'ca_suite_number, 'ca_city, 'ca_county, 'ca_state, 'ca_zip, 'ca_country, 'ca_gmt_offset, 'ca_location_type, 'ctr_total_return]
            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#24690 []) AND ('ca_address_sk = 'c_current_addr_sk)) AND (('ca_state = IL) AND ('ctr1.ctr_customer_sk = 'c_customer_sk)))
               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]
               :     +- 'Filter ('ctr1.ctr_state = 'ctr2.ctr_state)
               :        +- 'SubqueryAlias ctr2
               :           +- 'UnresolvedRelation [customer_total_return], [], false
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'SubqueryAlias ctr1
                  :  :  +- 'UnresolvedRelation [customer_total_return], [], false
                  :  +- 'UnresolvedRelation [customer_address], [], false
                  +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
c_customer_id: string, c_salutation: string, c_first_name: string, c_last_name: string, ca_street_number: string, ca_street_name: string, ca_street_type: string, ca_suite_number: string, ca_city: string, ca_county: string, ca_state: string, ca_zip: string, ca_country: string, ca_gmt_offset: double, ca_location_type: string, ctr_total_return: double
WithCTE
:- CTERelationDef 62
:  +- SubqueryAlias customer_total_return
:     +- Aggregate [cr_returning_customer_sk#24700L, ca_state#24757], [cr_returning_customer_sk#24700L AS ctr_customer_sk#24691L, ca_state#24757 AS ctr_state#24692, sum(cr_return_amt_inc_tax#24713) AS ctr_total_return#24693]
:        +- Filter (((cr_returned_date_sk#24720L = d_date_sk#24721L) AND (d_year#24727 = 1998)) AND (cr_returning_addr_sk#24703L = ca_address_sk#24749L))
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24694L,cr_item_sk#24695L,cr_refunded_customer_sk#24696L,cr_refunded_cdemo_sk#24697L,cr_refunded_hdemo_sk#24698L,cr_refunded_addr_sk#24699L,cr_returning_customer_sk#24700L,cr_returning_cdemo_sk#24701L,cr_returning_hdemo_sk#24702L,cr_returning_addr_sk#24703L,cr_call_center_sk#24704L,cr_catalog_page_sk#24705L,cr_ship_mode_sk#24706L,cr_warehouse_sk#24707L,cr_reason_sk#24708L,cr_order_number#24709L,cr_return_quantity#24710,cr_return_amount#24711,cr_return_tax#24712,cr_return_amt_inc_tax#24713,cr_fee#24714,cr_return_ship_cost#24715,cr_refunded_cash#24716,cr_reversed_charge#24717,... 3 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_date_id#24722,d_date#24723,d_month_seq#24724,d_week_seq#24725,d_quarter_seq#24726,d_year#24727,d_dow#24728,d_moy#24729,d_dom#24730,d_qoy#24731,d_fy_year#24732,d_fy_quarter_seq#24733,d_fy_week_seq#24734,d_day_name#24735,d_quarter_name#24736,d_holiday#24737,d_weekend#24738,d_following_holiday#24739,d_first_dom#24740,d_last_dom#24741,d_same_day_ly#24742,d_same_day_lq#24743,d_current_day#24744,... 4 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24749L,ca_address_id#24750,ca_street_number#24751,ca_street_name#24752,ca_street_type#24753,ca_suite_number#24754,ca_city#24755,ca_county#24756,ca_state#24757,ca_zip#24758,ca_country#24759,ca_gmt_offset#24760,ca_location_type#24761] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [c_customer_id#24776 ASC NULLS FIRST, c_salutation#24782 ASC NULLS FIRST, c_first_name#24783 ASC NULLS FIRST, c_last_name#24784 ASC NULLS FIRST, ca_street_number#24764 ASC NULLS FIRST, ca_street_name#24765 ASC NULLS FIRST, ca_street_type#24766 ASC NULLS FIRST, ca_suite_number#24767 ASC NULLS FIRST, ca_city#24768 ASC NULLS FIRST, ca_county#24769 ASC NULLS FIRST, ca_state#24770 ASC NULLS FIRST, ca_zip#24771 ASC NULLS FIRST, ca_country#24772 ASC NULLS FIRST, ca_gmt_offset#24773 ASC NULLS FIRST, ca_location_type#24774 ASC NULLS FIRST, ctr_total_return#24693 ASC NULLS FIRST], true
         +- Project [c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774, ctr_total_return#24693]
            +- Filter (((ctr_total_return#24693 > scalar-subquery#24690 [ctr_state#24692]) AND (ca_address_sk#24762L = c_current_addr_sk#24779L)) AND ((ca_state#24770 = IL) AND (ctr_customer_sk#24691L = c_customer_sk#24775L)))
               :  +- Aggregate [(avg(ctr_total_return#24693) * cast(1.2 as double)) AS (avg(ctr_total_return) * 1.2)#24795]
               :     +- Filter (outer(ctr_state#24692) = ctr_state#24692)
               :        +- SubqueryAlias ctr2
               :           +- SubqueryAlias customer_total_return
               :              +- CTERelationRef 62, true, [ctr_customer_sk#24691L, ctr_state#24692, ctr_total_return#24693]
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias ctr1
                  :  :  +- SubqueryAlias customer_total_return
                  :  :     +- CTERelationRef 62, true, [ctr_customer_sk#24691L, ctr_state#24692, ctr_total_return#24693]
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24762L,ca_address_id#24763,ca_street_number#24764,ca_street_name#24765,ca_street_type#24766,ca_suite_number#24767,ca_city#24768,ca_county#24769,ca_state#24770,ca_zip#24771,ca_country#24772,ca_gmt_offset#24773,ca_location_type#24774] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24775L,c_customer_id#24776,c_current_cdemo_sk#24777L,c_current_hdemo_sk#24778L,c_current_addr_sk#24779L,c_first_shipto_date_sk#24780L,c_first_sales_date_sk#24781L,c_salutation#24782,c_first_name#24783,c_last_name#24784,c_preferred_cust_flag#24785,c_birth_day#24786,c_birth_month#24787,c_birth_year#24788,c_birth_country#24789,c_login#24790,c_email_address#24791,c_last_review_date#24792] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [c_customer_id#24776 ASC NULLS FIRST, c_salutation#24782 ASC NULLS FIRST, c_first_name#24783 ASC NULLS FIRST, c_last_name#24784 ASC NULLS FIRST, ca_street_number#24764 ASC NULLS FIRST, ca_street_name#24765 ASC NULLS FIRST, ca_street_type#24766 ASC NULLS FIRST, ca_suite_number#24767 ASC NULLS FIRST, ca_city#24768 ASC NULLS FIRST, ca_county#24769 ASC NULLS FIRST, ca_state#24770 ASC NULLS FIRST, ca_zip#24771 ASC NULLS FIRST, ca_country#24772 ASC NULLS FIRST, ca_gmt_offset#24773 ASC NULLS FIRST, ca_location_type#24774 ASC NULLS FIRST, ctr_total_return#24693 ASC NULLS FIRST], true
      +- Project [c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774, ctr_total_return#24693]
         +- Join Inner, ((ctr_total_return#24693 > (avg(ctr_total_return) * 1.2)#24795) AND (ctr_state#24692 = ctr_state#24692#24812))
            :- Project [c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774, ctr_state#24692, ctr_total_return#24693]
            :  +- Join Inner, (ctr_customer_sk#24691L = c_customer_sk#24775L)
            :     :- Project [c_customer_sk#24775L, c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774]
            :     :  +- Join Inner, (ca_address_sk#24762L = c_current_addr_sk#24779L)
            :     :     :- Project [c_customer_sk#24775L, c_customer_id#24776, c_current_addr_sk#24779L, c_salutation#24782, c_first_name#24783, c_last_name#24784]
            :     :     :  +- Filter (isnotnull(c_customer_sk#24775L) AND isnotnull(c_current_addr_sk#24779L))
            :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24775L,c_customer_id#24776,c_current_cdemo_sk#24777L,c_current_hdemo_sk#24778L,c_current_addr_sk#24779L,c_first_shipto_date_sk#24780L,c_first_sales_date_sk#24781L,c_salutation#24782,c_first_name#24783,c_last_name#24784,c_preferred_cust_flag#24785,c_birth_day#24786,c_birth_month#24787,c_birth_year#24788,c_birth_country#24789,c_login#24790,c_email_address#24791,c_last_review_date#24792] orc
            :     :     +- Project [ca_address_sk#24762L, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774]
            :     :        +- Filter ((isnotnull(ca_state#24770) AND (ca_state#24770 = IL)) AND isnotnull(ca_address_sk#24762L))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24762L,ca_address_id#24763,ca_street_number#24764,ca_street_name#24765,ca_street_type#24766,ca_suite_number#24767,ca_city#24768,ca_county#24769,ca_state#24770,ca_zip#24771,ca_country#24772,ca_gmt_offset#24773,ca_location_type#24774] orc
            :     +- Filter isnotnull(ctr_total_return#24693)
            :        +- Aggregate [cr_returning_customer_sk#24700L, ca_state#24757], [cr_returning_customer_sk#24700L AS ctr_customer_sk#24691L, ca_state#24757 AS ctr_state#24692, sum(cr_return_amt_inc_tax#24713) AS ctr_total_return#24693]
            :           +- Project [cr_returning_customer_sk#24700L, cr_return_amt_inc_tax#24713, ca_state#24757]
            :              +- Join Inner, (cr_returning_addr_sk#24703L = ca_address_sk#24749L)
            :                 :- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713]
            :                 :  +- Join Inner, (cr_returned_date_sk#24720L = d_date_sk#24721L)
            :                 :     :- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713, cr_returned_date_sk#24720L]
            :                 :     :  +- Filter (((isnotnull(cr_returned_date_sk#24720L) AND isnotnull(cr_returning_addr_sk#24703L)) AND isnotnull(cr_returning_customer_sk#24700L)) AND dynamicpruning#24813 [cr_returned_date_sk#24720L])
            :                 :     :     :  +- Project [d_date_sk#24721L]
            :                 :     :     :     +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
            :                 :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_date_id#24722,d_date#24723,d_month_seq#24724,d_week_seq#24725,d_quarter_seq#24726,d_year#24727,d_dow#24728,d_moy#24729,d_dom#24730,d_qoy#24731,d_fy_year#24732,d_fy_quarter_seq#24733,d_fy_week_seq#24734,d_day_name#24735,d_quarter_name#24736,d_holiday#24737,d_weekend#24738,d_following_holiday#24739,d_first_dom#24740,d_last_dom#24741,d_same_day_ly#24742,d_same_day_lq#24743,d_current_day#24744,... 4 more fields] orc
            :                 :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24694L,cr_item_sk#24695L,cr_refunded_customer_sk#24696L,cr_refunded_cdemo_sk#24697L,cr_refunded_hdemo_sk#24698L,cr_refunded_addr_sk#24699L,cr_returning_customer_sk#24700L,cr_returning_cdemo_sk#24701L,cr_returning_hdemo_sk#24702L,cr_returning_addr_sk#24703L,cr_call_center_sk#24704L,cr_catalog_page_sk#24705L,cr_ship_mode_sk#24706L,cr_warehouse_sk#24707L,cr_reason_sk#24708L,cr_order_number#24709L,cr_return_quantity#24710,cr_return_amount#24711,cr_return_tax#24712,cr_return_amt_inc_tax#24713,cr_fee#24714,cr_return_ship_cost#24715,cr_refunded_cash#24716,cr_reversed_charge#24717,... 3 more fields] orc
            :                 :     +- Project [d_date_sk#24721L]
            :                 :        +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
            :                 :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_date_id#24722,d_date#24723,d_month_seq#24724,d_week_seq#24725,d_quarter_seq#24726,d_year#24727,d_dow#24728,d_moy#24729,d_dom#24730,d_qoy#24731,d_fy_year#24732,d_fy_quarter_seq#24733,d_fy_week_seq#24734,d_day_name#24735,d_quarter_name#24736,d_holiday#24737,d_weekend#24738,d_following_holiday#24739,d_first_dom#24740,d_last_dom#24741,d_same_day_ly#24742,d_same_day_lq#24743,d_current_day#24744,... 4 more fields] orc
            :                 +- Project [ca_address_sk#24749L, ca_state#24757]
            :                    +- Filter (isnotnull(ca_address_sk#24749L) AND isnotnull(ca_state#24757))
            :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24749L,ca_address_id#24750,ca_street_number#24751,ca_street_name#24752,ca_street_type#24753,ca_suite_number#24754,ca_city#24755,ca_county#24756,ca_state#24757,ca_zip#24758,ca_country#24759,ca_gmt_offset#24760,ca_location_type#24761] orc
            +- Filter isnotnull((avg(ctr_total_return) * 1.2)#24795)
               +- Aggregate [ctr_state#24692], [(avg(ctr_total_return#24693) * 1.2) AS (avg(ctr_total_return) * 1.2)#24795, ctr_state#24692 AS ctr_state#24692#24812]
                  +- Aggregate [cr_returning_customer_sk#24700L, ca_state#24757], [ca_state#24757 AS ctr_state#24692, sum(cr_return_amt_inc_tax#24713) AS ctr_total_return#24693]
                     +- Project [cr_returning_customer_sk#24700L, cr_return_amt_inc_tax#24713, ca_state#24757]
                        +- Join Inner, (cr_returning_addr_sk#24703L = ca_address_sk#24749L)
                           :- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713]
                           :  +- Join Inner, (cr_returned_date_sk#24720L = d_date_sk#24721L)
                           :     :- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713, cr_returned_date_sk#24720L]
                           :     :  +- Filter ((isnotnull(cr_returned_date_sk#24720L) AND isnotnull(cr_returning_addr_sk#24703L)) AND dynamicpruning#24814 [cr_returned_date_sk#24720L])
                           :     :     :  +- Project [d_date_sk#24721L]
                           :     :     :     +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
                           :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_date_id#24722,d_date#24723,d_month_seq#24724,d_week_seq#24725,d_quarter_seq#24726,d_year#24727,d_dow#24728,d_moy#24729,d_dom#24730,d_qoy#24731,d_fy_year#24732,d_fy_quarter_seq#24733,d_fy_week_seq#24734,d_day_name#24735,d_quarter_name#24736,d_holiday#24737,d_weekend#24738,d_following_holiday#24739,d_first_dom#24740,d_last_dom#24741,d_same_day_ly#24742,d_same_day_lq#24743,d_current_day#24744,... 4 more fields] orc
                           :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24694L,cr_item_sk#24695L,cr_refunded_customer_sk#24696L,cr_refunded_cdemo_sk#24697L,cr_refunded_hdemo_sk#24698L,cr_refunded_addr_sk#24699L,cr_returning_customer_sk#24700L,cr_returning_cdemo_sk#24701L,cr_returning_hdemo_sk#24702L,cr_returning_addr_sk#24703L,cr_call_center_sk#24704L,cr_catalog_page_sk#24705L,cr_ship_mode_sk#24706L,cr_warehouse_sk#24707L,cr_reason_sk#24708L,cr_order_number#24709L,cr_return_quantity#24710,cr_return_amount#24711,cr_return_tax#24712,cr_return_amt_inc_tax#24713,cr_fee#24714,cr_return_ship_cost#24715,cr_refunded_cash#24716,cr_reversed_charge#24717,... 3 more fields] orc
                           :     +- Project [d_date_sk#24721L]
                           :        +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
                           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_date_id#24722,d_date#24723,d_month_seq#24724,d_week_seq#24725,d_quarter_seq#24726,d_year#24727,d_dow#24728,d_moy#24729,d_dom#24730,d_qoy#24731,d_fy_year#24732,d_fy_quarter_seq#24733,d_fy_week_seq#24734,d_day_name#24735,d_quarter_name#24736,d_holiday#24737,d_weekend#24738,d_following_holiday#24739,d_first_dom#24740,d_last_dom#24741,d_same_day_ly#24742,d_same_day_lq#24743,d_current_day#24744,... 4 more fields] orc
                           +- Project [ca_address_sk#24749L, ca_state#24757]
                              +- Filter (isnotnull(ca_address_sk#24749L) AND isnotnull(ca_state#24757))
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24749L,ca_address_id#24750,ca_street_number#24751,ca_street_name#24752,ca_street_type#24753,ca_suite_number#24754,ca_city#24755,ca_county#24756,ca_state#24757,ca_zip#24758,ca_country#24759,ca_gmt_offset#24760,ca_location_type#24761] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_customer_id#24776 ASC NULLS FIRST,c_salutation#24782 ASC NULLS FIRST,c_first_name#24783 ASC NULLS FIRST,c_last_name#24784 ASC NULLS FIRST,ca_street_number#24764 ASC NULLS FIRST,ca_street_name#24765 ASC NULLS FIRST,ca_street_type#24766 ASC NULLS FIRST,ca_suite_number#24767 ASC NULLS FIRST,ca_city#24768 ASC NULLS FIRST,ca_county#24769 ASC NULLS FIRST,ca_state#24770 ASC NULLS FIRST,ca_zip#24771 ASC NULLS FIRST,ca_country#24772 ASC NULLS FIRST,ca_gmt_offset#24773 ASC NULLS FIRST,ca_location_type#24774 ASC NULLS FIRST,ctr_total_return#24693 ASC NULLS FIRST], output=[c_customer_id#24776,c_salutation#24782,c_first_name#24783,c_last_name#24784,ca_street_number#24764,ca_street_name#24765,ca_street_type#24766,ca_suite_number#24767,ca_city#24768,ca_county#24769,ca_state#24770,ca_zip#24771,ca_country#24772,ca_gmt_offset#24773,ca_location_type#24774,ctr_total_return#24693])
   +- Project [c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774, ctr_total_return#24693]
      +- BroadcastHashJoin [ctr_state#24692], [ctr_state#24692#24812], Inner, BuildRight, (ctr_total_return#24693 > (avg(ctr_total_return) * 1.2)#24795), false
         :- Project [c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774, ctr_state#24692, ctr_total_return#24693]
         :  +- SortMergeJoin [c_customer_sk#24775L], [ctr_customer_sk#24691L], Inner
         :     :- Sort [c_customer_sk#24775L ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(c_customer_sk#24775L, 3000), ENSURE_REQUIREMENTS, [id=#25566]
         :     :     +- Project [c_customer_sk#24775L, c_customer_id#24776, c_salutation#24782, c_first_name#24783, c_last_name#24784, ca_street_number#24764, ca_street_name#24765, ca_street_type#24766, ca_suite_number#24767, ca_city#24768, ca_county#24769, ca_state#24770, ca_zip#24771, ca_country#24772, ca_gmt_offset#24773, ca_location_type#24774]
         :     :        +- SortMergeJoin [c_current_addr_sk#24779L], [ca_address_sk#24762L], Inner
         :     :           :- Sort [c_current_addr_sk#24779L ASC NULLS FIRST], false, 0
         :     :           :  +- Exchange hashpartitioning(c_current_addr_sk#24779L, 3000), ENSURE_REQUIREMENTS, [id=#25542]
         :     :           :     +- Filter (isnotnull(c_customer_sk#24775L) AND isnotnull(c_current_addr_sk#24779L))
         :     :           :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#24775L,c_customer_id#24776,c_current_addr_sk#24779L,c_salutation#24782,c_first_name#24783,c_last_name#24784] Batched: true, DataFilters: [isnotnull(c_customer_sk#24775L), isnotnull(c_current_addr_sk#24779L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:bigint,c_customer_id:string,c_current_addr_sk:bigint,c_salutation:string,c_f...
         :     :           +- Sort [ca_address_sk#24762L ASC NULLS FIRST], false, 0
         :     :              +- Exchange hashpartitioning(ca_address_sk#24762L, 3000), ENSURE_REQUIREMENTS, [id=#25543]
         :     :                 +- Filter ((isnotnull(ca_state#24770) AND (ca_state#24770 = IL)) AND isnotnull(ca_address_sk#24762L))
         :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24762L,ca_street_number#24764,ca_street_name#24765,ca_street_type#24766,ca_suite_number#24767,ca_city#24768,ca_county#24769,ca_state#24770,ca_zip#24771,ca_country#24772,ca_gmt_offset#24773,ca_location_type#24774] Batched: true, DataFilters: [isnotnull(ca_state#24770), (ca_state#24770 = IL), isnotnull(ca_address_sk#24762L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,IL), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_street_number:string,ca_street_name:string,ca_street_type:string,c...
         :     +- Sort [ctr_customer_sk#24691L ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(ctr_customer_sk#24691L, 3000), ENSURE_REQUIREMENTS, [id=#25567]
         :           +- Filter isnotnull(ctr_total_return#24693)
         :              +- HashAggregate(keys=[cr_returning_customer_sk#24700L, ca_state#24757], functions=[sum(cr_return_amt_inc_tax#24713)], output=[ctr_customer_sk#24691L, ctr_state#24692, ctr_total_return#24693])
         :                 +- Exchange hashpartitioning(cr_returning_customer_sk#24700L, ca_state#24757, 3000), ENSURE_REQUIREMENTS, [id=#25561]
         :                    +- HashAggregate(keys=[cr_returning_customer_sk#24700L, ca_state#24757], functions=[partial_sum(cr_return_amt_inc_tax#24713)], output=[cr_returning_customer_sk#24700L, ca_state#24757, sum#24816])
         :                       +- Project [cr_returning_customer_sk#24700L, cr_return_amt_inc_tax#24713, ca_state#24757]
         :                          +- SortMergeJoin [cr_returning_addr_sk#24703L], [ca_address_sk#24749L], Inner
         :                             :- Sort [cr_returning_addr_sk#24703L ASC NULLS FIRST], false, 0
         :                             :  +- Exchange hashpartitioning(cr_returning_addr_sk#24703L, 3000), ENSURE_REQUIREMENTS, [id=#25553]
         :                             :     +- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713]
         :                             :        +- BroadcastHashJoin [cr_returned_date_sk#24720L], [d_date_sk#24721L], Inner, BuildRight, false
         :                             :           :- Filter (isnotnull(cr_returning_addr_sk#24703L) AND isnotnull(cr_returning_customer_sk#24700L))
         :                             :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returning_customer_sk#24700L,cr_returning_addr_sk#24703L,cr_return_amt_inc_tax#24713,cr_returned_date_sk#24720L] Batched: true, DataFilters: [isnotnull(cr_returning_addr_sk#24703L), isnotnull(cr_returning_customer_sk#24700L)], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#24720L), dynamicpruningexpression(cr_returned_date_sk#24720L IN dy..., PushedFilters: [IsNotNull(cr_returning_addr_sk), IsNotNull(cr_returning_customer_sk)], ReadSchema: struct<cr_returning_customer_sk:bigint,cr_returning_addr_sk:bigint,cr_return_amt_inc_tax:double>
         :                             :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#24813, 0, true, Project [d_date_sk#24721L], [d_date_sk#24721L]
         :                             :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                             :           :              +- Project [d_date_sk#24721L]
         :                             :           :                 +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
         :                             :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_year#24727] Batched: true, DataFilters: [isnotnull(d_year#24727), (d_year#24727 = 1998), isnotnull(d_date_sk#24721L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                             :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25548]
         :                             :              +- Project [d_date_sk#24721L]
         :                             :                 +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
         :                             :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_year#24727] Batched: true, DataFilters: [isnotnull(d_year#24727), (d_year#24727 = 1998), isnotnull(d_date_sk#24721L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
         :                             +- Sort [ca_address_sk#24749L ASC NULLS FIRST], false, 0
         :                                +- Exchange hashpartitioning(ca_address_sk#24749L, 3000), ENSURE_REQUIREMENTS, [id=#25554]
         :                                   +- Filter (isnotnull(ca_address_sk#24749L) AND isnotnull(ca_state#24757))
         :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24749L,ca_state#24757] Batched: true, DataFilters: [isnotnull(ca_address_sk#24749L), isnotnull(ca_state#24757)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
         +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, string, true]),false), [id=#25593]
            +- Filter isnotnull((avg(ctr_total_return) * 1.2)#24795)
               +- HashAggregate(keys=[ctr_state#24692], functions=[avg(ctr_total_return#24693)], output=[(avg(ctr_total_return) * 1.2)#24795, ctr_state#24692#24812])
                  +- Exchange hashpartitioning(ctr_state#24692, 3000), ENSURE_REQUIREMENTS, [id=#25589]
                     +- HashAggregate(keys=[ctr_state#24692], functions=[partial_avg(ctr_total_return#24693)], output=[ctr_state#24692, sum#24819, count#24820L])
                        +- HashAggregate(keys=[cr_returning_customer_sk#24700L, ca_state#24757], functions=[sum(cr_return_amt_inc_tax#24713)], output=[ctr_state#24692, ctr_total_return#24693])
                           +- Exchange hashpartitioning(cr_returning_customer_sk#24700L, ca_state#24757, 3000), ENSURE_REQUIREMENTS, [id=#25585]
                              +- HashAggregate(keys=[cr_returning_customer_sk#24700L, ca_state#24757], functions=[partial_sum(cr_return_amt_inc_tax#24713)], output=[cr_returning_customer_sk#24700L, ca_state#24757, sum#24816])
                                 +- Project [cr_returning_customer_sk#24700L, cr_return_amt_inc_tax#24713, ca_state#24757]
                                    +- SortMergeJoin [cr_returning_addr_sk#24703L], [ca_address_sk#24749L], Inner
                                       :- Sort [cr_returning_addr_sk#24703L ASC NULLS FIRST], false, 0
                                       :  +- Exchange hashpartitioning(cr_returning_addr_sk#24703L, 3000), ENSURE_REQUIREMENTS, [id=#25577]
                                       :     +- Project [cr_returning_customer_sk#24700L, cr_returning_addr_sk#24703L, cr_return_amt_inc_tax#24713]
                                       :        +- BroadcastHashJoin [cr_returned_date_sk#24720L], [d_date_sk#24721L], Inner, BuildRight, false
                                       :           :- Filter isnotnull(cr_returning_addr_sk#24703L)
                                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returning_customer_sk#24700L,cr_returning_addr_sk#24703L,cr_return_amt_inc_tax#24713,cr_returned_date_sk#24720L] Batched: true, DataFilters: [isnotnull(cr_returning_addr_sk#24703L)], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#24720L), dynamicpruningexpression(cr_returned_date_sk#24720L IN dy..., PushedFilters: [IsNotNull(cr_returning_addr_sk)], ReadSchema: struct<cr_returning_customer_sk:bigint,cr_returning_addr_sk:bigint,cr_return_amt_inc_tax:double>
                                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#24814, 0, true, Project [d_date_sk#24721L], [d_date_sk#24721L]
                                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                       :           :              +- Project [d_date_sk#24721L]
                                       :           :                 +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
                                       :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_year#24727] Batched: true, DataFilters: [isnotnull(d_year#24727), (d_year#24727 = 1998), isnotnull(d_date_sk#24721L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25572]
                                       :              +- Project [d_date_sk#24721L]
                                       :                 +- Filter ((isnotnull(d_year#24727) AND (d_year#24727 = 1998)) AND isnotnull(d_date_sk#24721L))
                                       :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24721L,d_year#24727] Batched: true, DataFilters: [isnotnull(d_year#24727), (d_year#24727 = 1998), isnotnull(d_date_sk#24721L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                                       +- Sort [ca_address_sk#24749L ASC NULLS FIRST], false, 0
                                          +- Exchange hashpartitioning(ca_address_sk#24749L, 3000), ENSURE_REQUIREMENTS, [id=#25578]
                                             +- Filter (isnotnull(ca_address_sk#24749L) AND isnotnull(ca_state#24757))
                                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#24749L,ca_state#24757] Batched: true, DataFilters: [isnotnull(ca_address_sk#24749L), isnotnull(ca_state#24757)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>

read query: spark_queries/q82.sql
explain query: q82
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['i_item_id ASC NULLS FIRST], true
      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_current_price]
         +- 'Filter ((((('i_current_price >= 30) AND ('i_current_price <= (30 + 30))) AND ('inv_item_sk = 'i_item_sk)) AND (('d_date_sk = 'inv_date_sk) AND (('d_date >= cast(2002-05-30 as date)) AND ('d_date <= (cast(2002-05-30 as date) + INTERVAL '60' DAY))))) AND (('i_manufact_id IN (437,129,727,663) AND (('inv_quantity_on_hand >= 100) AND ('inv_quantity_on_hand <= 500))) AND ('ss_item_sk = 'i_item_sk)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [item], [], false
               :  :  +- 'UnresolvedRelation [inventory], [], false
               :  +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [store_sales], [], false

== Analyzed Logical Plan ==
i_item_id: string, i_item_desc: string, i_current_price: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#24822 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#24822, i_item_desc#24825, i_current_price#24826], [i_item_id#24822, i_item_desc#24825, i_current_price#24826]
         +- Filter (((((i_current_price#24826 >= cast(30 as double)) AND (i_current_price#24826 <= cast((30 + 30) as double))) AND (inv_item_sk#24844L = i_item_sk#24821L)) AND ((d_date_sk#24847L = inv_date_sk#24843L) AND ((d_date#24849 >= cast(2002-05-30 as date)) AND (d_date#24849 <= date_add(cast(2002-05-30 as date), extractansiintervaldays(INTERVAL '60' DAY)))))) AND ((i_manufact_id#24834 IN (437,129,727,663) AND ((inv_quantity_on_hand#24846 >= 100) AND (inv_quantity_on_hand#24846 <= 500))) AND (ss_item_sk#24876L = i_item_sk#24821L)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24821L,i_item_id#24822,i_rec_start_date#24823,i_rec_end_date#24824,i_item_desc#24825,i_current_price#24826,i_wholesale_cost#24827,i_brand_id#24828,i_brand#24829,i_class_id#24830,i_class#24831,i_category_id#24832,i_category#24833,i_manufact_id#24834,i_manufact#24835,i_size#24836,i_formulation#24837,i_color#24838,i_units#24839,i_container#24840,i_manager_id#24841,i_product_name#24842] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.inventory
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#24843L,inv_item_sk#24844L,inv_warehouse_sk#24845L,inv_quantity_on_hand#24846] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24847L,d_date_id#24848,d_date#24849,d_month_seq#24850,d_week_seq#24851,d_quarter_seq#24852,d_year#24853,d_dow#24854,d_moy#24855,d_dom#24856,d_qoy#24857,d_fy_year#24858,d_fy_quarter_seq#24859,d_fy_week_seq#24860,d_day_name#24861,d_quarter_name#24862,d_holiday#24863,d_weekend#24864,d_following_holiday#24865,d_first_dom#24866,d_last_dom#24867,d_same_day_ly#24868,d_same_day_lq#24869,d_current_day#24870,... 4 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24875L,ss_item_sk#24876L,ss_customer_sk#24877L,ss_cdemo_sk#24878L,ss_hdemo_sk#24879L,ss_addr_sk#24880L,ss_store_sk#24881L,ss_promo_sk#24882L,ss_ticket_number#24883L,ss_quantity#24884,ss_wholesale_cost#24885,ss_list_price#24886,ss_sales_price#24887,ss_ext_discount_amt#24888,ss_ext_sales_price#24889,ss_ext_wholesale_cost#24890,ss_ext_list_price#24891,ss_ext_tax#24892,ss_coupon_amt#24893,ss_net_paid#24894,ss_net_paid_inc_tax#24895,ss_net_profit#24896,ss_sold_date_sk#24897L] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [i_item_id#24822 ASC NULLS FIRST], true
      +- Aggregate [i_item_id#24822, i_item_desc#24825, i_current_price#24826], [i_item_id#24822, i_item_desc#24825, i_current_price#24826]
         +- Project [i_item_id#24822, i_item_desc#24825, i_current_price#24826]
            +- Join Inner, (ss_item_sk#24876L = i_item_sk#24821L)
               :- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826]
               :  +- Join Inner, (d_date_sk#24847L = inv_date_sk#24843L)
               :     :- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826, inv_date_sk#24843L]
               :     :  +- Join Inner, (inv_item_sk#24844L = i_item_sk#24821L)
               :     :     :- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826]
               :     :     :  +- Filter ((isnotnull(i_current_price#24826) AND (((i_current_price#24826 >= 30.0) AND (i_current_price#24826 <= 60.0)) AND i_manufact_id#24834 IN (437,129,727,663))) AND isnotnull(i_item_sk#24821L))
               :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24821L,i_item_id#24822,i_rec_start_date#24823,i_rec_end_date#24824,i_item_desc#24825,i_current_price#24826,i_wholesale_cost#24827,i_brand_id#24828,i_brand#24829,i_class_id#24830,i_class#24831,i_category_id#24832,i_category#24833,i_manufact_id#24834,i_manufact#24835,i_size#24836,i_formulation#24837,i_color#24838,i_units#24839,i_container#24840,i_manager_id#24841,i_product_name#24842] orc
               :     :     +- Project [inv_date_sk#24843L, inv_item_sk#24844L]
               :     :        +- Filter ((isnotnull(inv_quantity_on_hand#24846) AND ((inv_quantity_on_hand#24846 >= 100) AND (inv_quantity_on_hand#24846 <= 500))) AND (isnotnull(inv_item_sk#24844L) AND isnotnull(inv_date_sk#24843L)))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#24843L,inv_item_sk#24844L,inv_warehouse_sk#24845L,inv_quantity_on_hand#24846] orc
               :     +- Project [d_date_sk#24847L]
               :        +- Filter ((isnotnull(d_date#24849) AND ((d_date#24849 >= 2002-05-30) AND (d_date#24849 <= 2002-07-29))) AND isnotnull(d_date_sk#24847L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24847L,d_date_id#24848,d_date#24849,d_month_seq#24850,d_week_seq#24851,d_quarter_seq#24852,d_year#24853,d_dow#24854,d_moy#24855,d_dom#24856,d_qoy#24857,d_fy_year#24858,d_fy_quarter_seq#24859,d_fy_week_seq#24860,d_day_name#24861,d_quarter_name#24862,d_holiday#24863,d_weekend#24864,d_following_holiday#24865,d_first_dom#24866,d_last_dom#24867,d_same_day_ly#24868,d_same_day_lq#24869,d_current_day#24870,... 4 more fields] orc
               +- Project [ss_item_sk#24876L]
                  +- Filter isnotnull(ss_item_sk#24876L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#24875L,ss_item_sk#24876L,ss_customer_sk#24877L,ss_cdemo_sk#24878L,ss_hdemo_sk#24879L,ss_addr_sk#24880L,ss_store_sk#24881L,ss_promo_sk#24882L,ss_ticket_number#24883L,ss_quantity#24884,ss_wholesale_cost#24885,ss_list_price#24886,ss_sales_price#24887,ss_ext_discount_amt#24888,ss_ext_sales_price#24889,ss_ext_wholesale_cost#24890,ss_ext_list_price#24891,ss_ext_tax#24892,ss_coupon_amt#24893,ss_net_paid#24894,ss_net_paid_inc_tax#24895,ss_net_profit#24896,ss_sold_date_sk#24897L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[i_item_id#24822 ASC NULLS FIRST], output=[i_item_id#24822,i_item_desc#24825,i_current_price#24826])
   +- HashAggregate(keys=[i_item_id#24822, i_item_desc#24825, i_current_price#24826], functions=[], output=[i_item_id#24822, i_item_desc#24825, i_current_price#24826])
      +- Exchange hashpartitioning(i_item_id#24822, i_item_desc#24825, i_current_price#24826, 3000), ENSURE_REQUIREMENTS, [id=#25680]
         +- HashAggregate(keys=[i_item_id#24822, i_item_desc#24825, knownfloatingpointnormalized(normalizenanandzero(i_current_price#24826)) AS i_current_price#24826], functions=[], output=[i_item_id#24822, i_item_desc#24825, i_current_price#24826])
            +- Project [i_item_id#24822, i_item_desc#24825, i_current_price#24826]
               +- SortMergeJoin [i_item_sk#24821L], [ss_item_sk#24876L], Inner
                  :- Sort [i_item_sk#24821L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(i_item_sk#24821L, 3000), ENSURE_REQUIREMENTS, [id=#25672]
                  :     +- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826]
                  :        +- BroadcastHashJoin [inv_date_sk#24843L], [d_date_sk#24847L], Inner, BuildRight, false
                  :           :- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826, inv_date_sk#24843L]
                  :           :  +- BroadcastHashJoin [i_item_sk#24821L], [inv_item_sk#24844L], Inner, BuildLeft, false
                  :           :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25663]
                  :           :     :  +- Project [i_item_sk#24821L, i_item_id#24822, i_item_desc#24825, i_current_price#24826]
                  :           :     :     +- Filter ((((isnotnull(i_current_price#24826) AND (i_current_price#24826 >= 30.0)) AND (i_current_price#24826 <= 60.0)) AND i_manufact_id#24834 IN (437,129,727,663)) AND isnotnull(i_item_sk#24821L))
                  :           :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24821L,i_item_id#24822,i_item_desc#24825,i_current_price#24826,i_manufact_id#24834] Batched: true, DataFilters: [isnotnull(i_current_price#24826), (i_current_price#24826 >= 30.0), (i_current_price#24826 <= 60...., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,30.0), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string,i_current_price:double,i_manufact_id:...
                  :           :     +- Project [inv_date_sk#24843L, inv_item_sk#24844L]
                  :           :        +- Filter ((((isnotnull(inv_quantity_on_hand#24846) AND (inv_quantity_on_hand#24846 >= 100)) AND (inv_quantity_on_hand#24846 <= 500)) AND isnotnull(inv_item_sk#24844L)) AND isnotnull(inv_date_sk#24843L))
                  :           :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.inventory[inv_date_sk#24843L,inv_item_sk#24844L,inv_quantity_on_hand#24846] Batched: true, DataFilters: [isnotnull(inv_quantity_on_hand#24846), (inv_quantity_on_hand#24846 >= 100), (inv_quantity_on_han..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(inv_quantity_on_hand), GreaterThanOrEqual(inv_quantity_on_hand,100), LessThanOrEqual(i..., ReadSchema: struct<inv_date_sk:bigint,inv_item_sk:bigint,inv_quantity_on_hand:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#25667]
                  :              +- Project [d_date_sk#24847L]
                  :                 +- Filter (((isnotnull(d_date#24849) AND (d_date#24849 >= 2002-05-30)) AND (d_date#24849 <= 2002-07-29)) AND isnotnull(d_date_sk#24847L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24847L,d_date#24849] Batched: true, DataFilters: [isnotnull(d_date#24849), (d_date#24849 >= 2002-05-30), (d_date#24849 <= 2002-07-29), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2002-05-30), LessThanOrEqual(d_date,2002-07-29), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                  +- Sort [ss_item_sk#24876L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(ss_item_sk#24876L, 3000), ENSURE_REQUIREMENTS, [id=#25673]
                        +- Project [ss_item_sk#24876L]
                           +- Filter isnotnull(ss_item_sk#24876L)
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#24876L,ss_sold_date_sk#24897L] Batched: true, DataFilters: [isnotnull(ss_item_sk#24876L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint>

read query: spark_queries/q83.sql
explain query: q83
== Parsed Logical Plan ==
CTE [sr_items, cr_items, wr_items]
:  :- 'SubqueryAlias sr_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#24905, 'sum('sr_return_quantity) AS sr_item_qty#24906]
:  :     +- 'Filter ((('sr_item_sk = 'i_item_sk) AND 'd_date IN (list#24908 [])) AND ('sr_returned_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter 'd_week_seq IN (list#24907 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter 'd_date IN (1998-01-02,1998-10-15,1998-11-10)
:  :        :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_returns], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  :- 'SubqueryAlias cr_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#24909, 'sum('cr_return_quantity) AS cr_item_qty#24910]
:  :     +- 'Filter ((('cr_item_sk = 'i_item_sk) AND 'd_date IN (list#24912 [])) AND ('cr_returned_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter 'd_week_seq IN (list#24911 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter 'd_date IN (1998-01-02,1998-10-15,1998-11-10)
:  :        :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        :        +- 'UnresolvedRelation [date_dim], [], false
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [catalog_returns], [], false
:  :           :  +- 'UnresolvedRelation [item], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias wr_items
:     +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#24913, 'sum('wr_return_quantity) AS wr_item_qty#24914]
:        +- 'Filter ((('wr_item_sk = 'i_item_sk) AND 'd_date IN (list#24916 [])) AND ('wr_returned_date_sk = 'd_date_sk))
:           :  +- 'Project ['d_date]
:           :     +- 'Filter 'd_week_seq IN (list#24915 [])
:           :        :  +- 'Project ['d_week_seq]
:           :        :     +- 'Filter 'd_date IN (1998-01-02,1998-10-15,1998-11-10)
:           :        :        +- 'UnresolvedRelation [date_dim], [], false
:           :        +- 'UnresolvedRelation [date_dim], [], false
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_returns], [], false
:              :  +- 'UnresolvedRelation [item], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['sr_items.item_id ASC NULLS FIRST, 'sr_item_qty ASC NULLS FIRST], true
         +- 'Project ['sr_items.item_id, 'sr_item_qty, ((('sr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS sr_dev#24901, 'cr_item_qty, ((('cr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS cr_dev#24902, 'wr_item_qty, ((('wr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS wr_dev#24903, ((('sr_item_qty + 'cr_item_qty) + 'wr_item_qty) / 3.0) AS average#24904]
            +- 'Filter (('sr_items.item_id = 'cr_items.item_id) AND ('sr_items.item_id = 'wr_items.item_id))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'UnresolvedRelation [sr_items], [], false
                  :  +- 'UnresolvedRelation [cr_items], [], false
                  +- 'UnresolvedRelation [wr_items], [], false

== Analyzed Logical Plan ==
item_id: string, sr_item_qty: bigint, sr_dev: double, cr_item_qty: bigint, cr_dev: double, wr_item_qty: bigint, wr_dev: double, average: decimal(27,6)
WithCTE
:- CTERelationDef 63
:  +- SubqueryAlias sr_items
:     +- Aggregate [i_item_id#24938], [i_item_id#24938 AS item_id#24905, sum(sr_return_quantity#24926) AS sr_item_qty#24906L]
:        +- Filter (((sr_item_sk#24918L = i_item_sk#24937L) AND d_date#24961 IN (list#24908 [])) AND (sr_returned_date_sk#24936L = d_date_sk#24959L))
:           :  +- Project [d_date#25140]
:           :     +- Filter d_week_seq#25142 IN (list#24907 [])
:           :        :  +- Project [d_week_seq#25170]
:           :        :     +- Filter cast(d_date#25168 as string) IN (cast(1998-01-02 as string),cast(1998-10-15 as string),cast(1998-11-10 as string))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25166L,d_date_id#25167,d_date#25168,d_month_seq#25169,d_week_seq#25170,d_quarter_seq#25171,d_year#25172,d_dow#25173,d_moy#25174,d_dom#25175,d_qoy#25176,d_fy_year#25177,d_fy_quarter_seq#25178,d_fy_week_seq#25179,d_day_name#25180,d_quarter_name#25181,d_holiday#25182,d_weekend#25183,d_following_holiday#25184,d_first_dom#25185,d_last_dom#25186,d_same_day_ly#25187,d_same_day_lq#25188,d_current_day#25189,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25138L,d_date_id#25139,d_date#25140,d_month_seq#25141,d_week_seq#25142,d_quarter_seq#25143,d_year#25144,d_dow#25145,d_moy#25146,d_dom#25147,d_qoy#25148,d_fy_year#25149,d_fy_quarter_seq#25150,d_fy_week_seq#25151,d_day_name#25152,d_quarter_name#25153,d_holiday#25154,d_weekend#25155,d_following_holiday#25156,d_first_dom#25157,d_last_dom#25158,d_same_day_ly#25159,d_same_day_lq#25160,d_current_day#25161,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#24917L,sr_item_sk#24918L,sr_customer_sk#24919L,sr_cdemo_sk#24920L,sr_hdemo_sk#24921L,sr_addr_sk#24922L,sr_store_sk#24923L,sr_reason_sk#24924L,sr_ticket_number#24925L,sr_return_quantity#24926,sr_return_amt#24927,sr_return_tax#24928,sr_return_amt_inc_tax#24929,sr_fee#24930,sr_return_ship_cost#24931,sr_refunded_cash#24932,sr_reversed_charge#24933,sr_store_credit#24934,sr_net_loss#24935,sr_returned_date_sk#24936L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24937L,i_item_id#24938,i_rec_start_date#24939,i_rec_end_date#24940,i_item_desc#24941,i_current_price#24942,i_wholesale_cost#24943,i_brand_id#24944,i_brand#24945,i_class_id#24946,i_class#24947,i_category_id#24948,i_category#24949,i_manufact_id#24950,i_manufact#24951,i_size#24952,i_formulation#24953,i_color#24954,i_units#24955,i_container#24956,i_manager_id#24957,i_product_name#24958] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24959L,d_date_id#24960,d_date#24961,d_month_seq#24962,d_week_seq#24963,d_quarter_seq#24964,d_year#24965,d_dow#24966,d_moy#24967,d_dom#24968,d_qoy#24969,d_fy_year#24970,d_fy_quarter_seq#24971,d_fy_week_seq#24972,d_day_name#24973,d_quarter_name#24974,d_holiday#24975,d_weekend#24976,d_following_holiday#24977,d_first_dom#24978,d_last_dom#24979,d_same_day_ly#24980,d_same_day_lq#24981,d_current_day#24982,... 4 more fields] orc
:- CTERelationDef 64
:  +- SubqueryAlias cr_items
:     +- Aggregate [i_item_id#25015], [i_item_id#25015 AS item_id#24909, sum(cr_return_quantity#25003) AS cr_item_qty#24910L]
:        +- Filter (((cr_item_sk#24988L = i_item_sk#25014L) AND d_date#25038 IN (list#24912 [])) AND (cr_returned_date_sk#25013L = d_date_sk#25036L))
:           :  +- Project [d_date#25196]
:           :     +- Filter d_week_seq#25198 IN (list#24911 [])
:           :        :  +- Project [d_week_seq#25226]
:           :        :     +- Filter cast(d_date#25224 as string) IN (cast(1998-01-02 as string),cast(1998-10-15 as string),cast(1998-11-10 as string))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25222L,d_date_id#25223,d_date#25224,d_month_seq#25225,d_week_seq#25226,d_quarter_seq#25227,d_year#25228,d_dow#25229,d_moy#25230,d_dom#25231,d_qoy#25232,d_fy_year#25233,d_fy_quarter_seq#25234,d_fy_week_seq#25235,d_day_name#25236,d_quarter_name#25237,d_holiday#25238,d_weekend#25239,d_following_holiday#25240,d_first_dom#25241,d_last_dom#25242,d_same_day_ly#25243,d_same_day_lq#25244,d_current_day#25245,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25194L,d_date_id#25195,d_date#25196,d_month_seq#25197,d_week_seq#25198,d_quarter_seq#25199,d_year#25200,d_dow#25201,d_moy#25202,d_dom#25203,d_qoy#25204,d_fy_year#25205,d_fy_quarter_seq#25206,d_fy_week_seq#25207,d_day_name#25208,d_quarter_name#25209,d_holiday#25210,d_weekend#25211,d_following_holiday#25212,d_first_dom#25213,d_last_dom#25214,d_same_day_ly#25215,d_same_day_lq#25216,d_current_day#25217,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24987L,cr_item_sk#24988L,cr_refunded_customer_sk#24989L,cr_refunded_cdemo_sk#24990L,cr_refunded_hdemo_sk#24991L,cr_refunded_addr_sk#24992L,cr_returning_customer_sk#24993L,cr_returning_cdemo_sk#24994L,cr_returning_hdemo_sk#24995L,cr_returning_addr_sk#24996L,cr_call_center_sk#24997L,cr_catalog_page_sk#24998L,cr_ship_mode_sk#24999L,cr_warehouse_sk#25000L,cr_reason_sk#25001L,cr_order_number#25002L,cr_return_quantity#25003,cr_return_amount#25004,cr_return_tax#25005,cr_return_amt_inc_tax#25006,cr_fee#25007,cr_return_ship_cost#25008,cr_refunded_cash#25009,cr_reversed_charge#25010,... 3 more fields] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25014L,i_item_id#25015,i_rec_start_date#25016,i_rec_end_date#25017,i_item_desc#25018,i_current_price#25019,i_wholesale_cost#25020,i_brand_id#25021,i_brand#25022,i_class_id#25023,i_class#25024,i_category_id#25025,i_category#25026,i_manufact_id#25027,i_manufact#25028,i_size#25029,i_formulation#25030,i_color#25031,i_units#25032,i_container#25033,i_manager_id#25034,i_product_name#25035] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25036L,d_date_id#25037,d_date#25038,d_month_seq#25039,d_week_seq#25040,d_quarter_seq#25041,d_year#25042,d_dow#25043,d_moy#25044,d_dom#25045,d_qoy#25046,d_fy_year#25047,d_fy_quarter_seq#25048,d_fy_week_seq#25049,d_day_name#25050,d_quarter_name#25051,d_holiday#25052,d_weekend#25053,d_following_holiday#25054,d_first_dom#25055,d_last_dom#25056,d_same_day_ly#25057,d_same_day_lq#25058,d_current_day#25059,... 4 more fields] orc
:- CTERelationDef 65
:  +- SubqueryAlias wr_items
:     +- Aggregate [i_item_id#25089], [i_item_id#25089 AS item_id#24913, sum(wr_return_quantity#25077) AS wr_item_qty#24914L]
:        +- Filter (((wr_item_sk#25065L = i_item_sk#25088L) AND d_date#25112 IN (list#24916 [])) AND (wr_returned_date_sk#25087L = d_date_sk#25110L))
:           :  +- Project [d_date#25252]
:           :     +- Filter d_week_seq#25254 IN (list#24915 [])
:           :        :  +- Project [d_week_seq#25282]
:           :        :     +- Filter cast(d_date#25280 as string) IN (cast(1998-01-02 as string),cast(1998-10-15 as string),cast(1998-11-10 as string))
:           :        :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25278L,d_date_id#25279,d_date#25280,d_month_seq#25281,d_week_seq#25282,d_quarter_seq#25283,d_year#25284,d_dow#25285,d_moy#25286,d_dom#25287,d_qoy#25288,d_fy_year#25289,d_fy_quarter_seq#25290,d_fy_week_seq#25291,d_day_name#25292,d_quarter_name#25293,d_holiday#25294,d_weekend#25295,d_following_holiday#25296,d_first_dom#25297,d_last_dom#25298,d_same_day_ly#25299,d_same_day_lq#25300,d_current_day#25301,... 4 more fields] orc
:           :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25250L,d_date_id#25251,d_date#25252,d_month_seq#25253,d_week_seq#25254,d_quarter_seq#25255,d_year#25256,d_dow#25257,d_moy#25258,d_dom#25259,d_qoy#25260,d_fy_year#25261,d_fy_quarter_seq#25262,d_fy_week_seq#25263,d_day_name#25264,d_quarter_name#25265,d_holiday#25266,d_weekend#25267,d_following_holiday#25268,d_first_dom#25269,d_last_dom#25270,d_same_day_ly#25271,d_same_day_lq#25272,d_current_day#25273,... 4 more fields] orc
:           +- Join Inner
:              :- Join Inner
:              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
:              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#25064L,wr_item_sk#25065L,wr_refunded_customer_sk#25066L,wr_refunded_cdemo_sk#25067L,wr_refunded_hdemo_sk#25068L,wr_refunded_addr_sk#25069L,wr_returning_customer_sk#25070L,wr_returning_cdemo_sk#25071L,wr_returning_hdemo_sk#25072L,wr_returning_addr_sk#25073L,wr_web_page_sk#25074L,wr_reason_sk#25075L,wr_order_number#25076L,wr_return_quantity#25077,wr_return_amt#25078,wr_return_tax#25079,wr_return_amt_inc_tax#25080,wr_fee#25081,wr_return_ship_cost#25082,wr_refunded_cash#25083,wr_reversed_charge#25084,wr_account_credit#25085,wr_net_loss#25086,wr_returned_date_sk#25087L] orc
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25088L,i_item_id#25089,i_rec_start_date#25090,i_rec_end_date#25091,i_item_desc#25092,i_current_price#25093,i_wholesale_cost#25094,i_brand_id#25095,i_brand#25096,i_class_id#25097,i_class#25098,i_category_id#25099,i_category#25100,i_manufact_id#25101,i_manufact#25102,i_size#25103,i_formulation#25104,i_color#25105,i_units#25106,i_container#25107,i_manager_id#25108,i_product_name#25109] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25110L,d_date_id#25111,d_date#25112,d_month_seq#25113,d_week_seq#25114,d_quarter_seq#25115,d_year#25116,d_dow#25117,d_moy#25118,d_dom#25119,d_qoy#25120,d_fy_year#25121,d_fy_quarter_seq#25122,d_fy_week_seq#25123,d_day_name#25124,d_quarter_name#25125,d_holiday#25126,d_weekend#25127,d_following_holiday#25128,d_first_dom#25129,d_last_dom#25130,d_same_day_ly#25131,d_same_day_lq#25132,d_current_day#25133,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [item_id#24905 ASC NULLS FIRST, sr_item_qty#24906L ASC NULLS FIRST], true
         +- Project [item_id#24905, sr_item_qty#24906L, (((cast(sr_item_qty#24906L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS sr_dev#24901, cr_item_qty#24910L, (((cast(cr_item_qty#24910L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS cr_dev#24902, wr_item_qty#24914L, (((cast(wr_item_qty#24914L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS wr_dev#24903, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as decimal(20,0)) as decimal(21,1))) / promote_precision(cast(3.0 as decimal(21,1)))), DecimalType(27,6), true) AS average#24904]
            +- Filter ((item_id#24905 = item_id#24909) AND (item_id#24905 = item_id#24913))
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias sr_items
                  :  :  +- CTERelationRef 63, true, [item_id#24905, sr_item_qty#24906L]
                  :  +- SubqueryAlias cr_items
                  :     +- CTERelationRef 64, true, [item_id#24909, cr_item_qty#24910L]
                  +- SubqueryAlias wr_items
                     +- CTERelationRef 65, true, [item_id#24913, wr_item_qty#24914L]

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [item_id#24905 ASC NULLS FIRST, sr_item_qty#24906L ASC NULLS FIRST], true
      +- Project [item_id#24905, sr_item_qty#24906L, (((cast(sr_item_qty#24906L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS sr_dev#24901, cr_item_qty#24910L, (((cast(cr_item_qty#24910L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS cr_dev#24902, wr_item_qty#24914L, (((cast(wr_item_qty#24914L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS wr_dev#24903, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6), true) AS average#24904]
         +- Join Inner, (item_id#24905 = item_id#24913)
            :- Project [item_id#24905, sr_item_qty#24906L, cr_item_qty#24910L]
            :  +- Join Inner, (item_id#24905 = item_id#24909)
            :     :- Aggregate [i_item_id#24938], [i_item_id#24938 AS item_id#24905, sum(sr_return_quantity#24926) AS sr_item_qty#24906L]
            :     :  +- Project [sr_return_quantity#24926, i_item_id#24938]
            :     :     +- Join Inner, (sr_item_sk#24918L = i_item_sk#24937L)
            :     :        :- Project [sr_item_sk#24918L, sr_return_quantity#24926]
            :     :        :  +- Join Inner, (sr_returned_date_sk#24936L = d_date_sk#24959L)
            :     :        :     :- Project [sr_item_sk#24918L, sr_return_quantity#24926, sr_returned_date_sk#24936L]
            :     :        :     :  +- Filter ((isnotnull(sr_item_sk#24918L) AND isnotnull(sr_returned_date_sk#24936L)) AND dynamicpruning#25317 [sr_returned_date_sk#24936L])
            :     :        :     :     :  +- Project [d_date_sk#24959L]
            :     :        :     :     :     +- Join LeftSemi, (d_date#24961 = d_date#25140)
            :     :        :     :     :        :- Project [d_date_sk#24959L, d_date#24961]
            :     :        :     :     :        :  +- Filter isnotnull(d_date_sk#24959L)
            :     :        :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24959L,d_date_id#24960,d_date#24961,d_month_seq#24962,d_week_seq#24963,d_quarter_seq#24964,d_year#24965,d_dow#24966,d_moy#24967,d_dom#24968,d_qoy#24969,d_fy_year#24970,d_fy_quarter_seq#24971,d_fy_week_seq#24972,d_day_name#24973,d_quarter_name#24974,d_holiday#24975,d_weekend#24976,d_following_holiday#24977,d_first_dom#24978,d_last_dom#24979,d_same_day_ly#24980,d_same_day_lq#24981,d_current_day#24982,... 4 more fields] orc
            :     :        :     :     :        +- Project [d_date#25140]
            :     :        :     :     :           +- Join LeftSemi, (d_week_seq#25142 = d_week_seq#25170)
            :     :        :     :     :              :- Project [d_date#25140, d_week_seq#25142]
            :     :        :     :     :              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25138L,d_date_id#25139,d_date#25140,d_month_seq#25141,d_week_seq#25142,d_quarter_seq#25143,d_year#25144,d_dow#25145,d_moy#25146,d_dom#25147,d_qoy#25148,d_fy_year#25149,d_fy_quarter_seq#25150,d_fy_week_seq#25151,d_day_name#25152,d_quarter_name#25153,d_holiday#25154,d_weekend#25155,d_following_holiday#25156,d_first_dom#25157,d_last_dom#25158,d_same_day_ly#25159,d_same_day_lq#25160,d_current_day#25161,... 4 more fields] orc
            :     :        :     :     :              +- Project [d_week_seq#25170]
            :     :        :     :     :                 +- Filter cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)
            :     :        :     :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25166L,d_date_id#25167,d_date#25168,d_month_seq#25169,d_week_seq#25170,d_quarter_seq#25171,d_year#25172,d_dow#25173,d_moy#25174,d_dom#25175,d_qoy#25176,d_fy_year#25177,d_fy_quarter_seq#25178,d_fy_week_seq#25179,d_day_name#25180,d_quarter_name#25181,d_holiday#25182,d_weekend#25183,d_following_holiday#25184,d_first_dom#25185,d_last_dom#25186,d_same_day_ly#25187,d_same_day_lq#25188,d_current_day#25189,... 4 more fields] orc
            :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#24917L,sr_item_sk#24918L,sr_customer_sk#24919L,sr_cdemo_sk#24920L,sr_hdemo_sk#24921L,sr_addr_sk#24922L,sr_store_sk#24923L,sr_reason_sk#24924L,sr_ticket_number#24925L,sr_return_quantity#24926,sr_return_amt#24927,sr_return_tax#24928,sr_return_amt_inc_tax#24929,sr_fee#24930,sr_return_ship_cost#24931,sr_refunded_cash#24932,sr_reversed_charge#24933,sr_store_credit#24934,sr_net_loss#24935,sr_returned_date_sk#24936L] orc
            :     :        :     +- Project [d_date_sk#24959L]
            :     :        :        +- Join LeftSemi, (d_date#24961 = d_date#25140)
            :     :        :           :- Project [d_date_sk#24959L, d_date#24961]
            :     :        :           :  +- Filter isnotnull(d_date_sk#24959L)
            :     :        :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24959L,d_date_id#24960,d_date#24961,d_month_seq#24962,d_week_seq#24963,d_quarter_seq#24964,d_year#24965,d_dow#24966,d_moy#24967,d_dom#24968,d_qoy#24969,d_fy_year#24970,d_fy_quarter_seq#24971,d_fy_week_seq#24972,d_day_name#24973,d_quarter_name#24974,d_holiday#24975,d_weekend#24976,d_following_holiday#24977,d_first_dom#24978,d_last_dom#24979,d_same_day_ly#24980,d_same_day_lq#24981,d_current_day#24982,... 4 more fields] orc
            :     :        :           +- Project [d_date#25140]
            :     :        :              +- Join LeftSemi, (d_week_seq#25142 = d_week_seq#25170)
            :     :        :                 :- Project [d_date#25140, d_week_seq#25142]
            :     :        :                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25138L,d_date_id#25139,d_date#25140,d_month_seq#25141,d_week_seq#25142,d_quarter_seq#25143,d_year#25144,d_dow#25145,d_moy#25146,d_dom#25147,d_qoy#25148,d_fy_year#25149,d_fy_quarter_seq#25150,d_fy_week_seq#25151,d_day_name#25152,d_quarter_name#25153,d_holiday#25154,d_weekend#25155,d_following_holiday#25156,d_first_dom#25157,d_last_dom#25158,d_same_day_ly#25159,d_same_day_lq#25160,d_current_day#25161,... 4 more fields] orc
            :     :        :                 +- Project [d_week_seq#25170]
            :     :        :                    +- Filter cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)
            :     :        :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25166L,d_date_id#25167,d_date#25168,d_month_seq#25169,d_week_seq#25170,d_quarter_seq#25171,d_year#25172,d_dow#25173,d_moy#25174,d_dom#25175,d_qoy#25176,d_fy_year#25177,d_fy_quarter_seq#25178,d_fy_week_seq#25179,d_day_name#25180,d_quarter_name#25181,d_holiday#25182,d_weekend#25183,d_following_holiday#25184,d_first_dom#25185,d_last_dom#25186,d_same_day_ly#25187,d_same_day_lq#25188,d_current_day#25189,... 4 more fields] orc
            :     :        +- Project [i_item_sk#24937L, i_item_id#24938]
            :     :           +- Filter (isnotnull(i_item_sk#24937L) AND isnotnull(i_item_id#24938))
            :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24937L,i_item_id#24938,i_rec_start_date#24939,i_rec_end_date#24940,i_item_desc#24941,i_current_price#24942,i_wholesale_cost#24943,i_brand_id#24944,i_brand#24945,i_class_id#24946,i_class#24947,i_category_id#24948,i_category#24949,i_manufact_id#24950,i_manufact#24951,i_size#24952,i_formulation#24953,i_color#24954,i_units#24955,i_container#24956,i_manager_id#24957,i_product_name#24958] orc
            :     +- Aggregate [i_item_id#25015], [i_item_id#25015 AS item_id#24909, sum(cr_return_quantity#25003) AS cr_item_qty#24910L]
            :        +- Project [cr_return_quantity#25003, i_item_id#25015]
            :           +- Join Inner, (cr_item_sk#24988L = i_item_sk#25014L)
            :              :- Project [cr_item_sk#24988L, cr_return_quantity#25003]
            :              :  +- Join Inner, (cr_returned_date_sk#25013L = d_date_sk#25036L)
            :              :     :- Project [cr_item_sk#24988L, cr_return_quantity#25003, cr_returned_date_sk#25013L]
            :              :     :  +- Filter ((isnotnull(cr_item_sk#24988L) AND isnotnull(cr_returned_date_sk#25013L)) AND dynamicpruning#25318 [cr_returned_date_sk#25013L])
            :              :     :     :  +- Project [d_date_sk#25036L]
            :              :     :     :     +- Join LeftSemi, (d_date#25038 = d_date#25196)
            :              :     :     :        :- Project [d_date_sk#25036L, d_date#25038]
            :              :     :     :        :  +- Filter isnotnull(d_date_sk#25036L)
            :              :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25036L,d_date_id#25037,d_date#25038,d_month_seq#25039,d_week_seq#25040,d_quarter_seq#25041,d_year#25042,d_dow#25043,d_moy#25044,d_dom#25045,d_qoy#25046,d_fy_year#25047,d_fy_quarter_seq#25048,d_fy_week_seq#25049,d_day_name#25050,d_quarter_name#25051,d_holiday#25052,d_weekend#25053,d_following_holiday#25054,d_first_dom#25055,d_last_dom#25056,d_same_day_ly#25057,d_same_day_lq#25058,d_current_day#25059,... 4 more fields] orc
            :              :     :     :        +- Project [d_date#25196]
            :              :     :     :           +- Join LeftSemi, (d_week_seq#25198 = d_week_seq#25226)
            :              :     :     :              :- Project [d_date#25196, d_week_seq#25198]
            :              :     :     :              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25194L,d_date_id#25195,d_date#25196,d_month_seq#25197,d_week_seq#25198,d_quarter_seq#25199,d_year#25200,d_dow#25201,d_moy#25202,d_dom#25203,d_qoy#25204,d_fy_year#25205,d_fy_quarter_seq#25206,d_fy_week_seq#25207,d_day_name#25208,d_quarter_name#25209,d_holiday#25210,d_weekend#25211,d_following_holiday#25212,d_first_dom#25213,d_last_dom#25214,d_same_day_ly#25215,d_same_day_lq#25216,d_current_day#25217,... 4 more fields] orc
            :              :     :     :              +- Project [d_week_seq#25226]
            :              :     :     :                 +- Filter cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)
            :              :     :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25222L,d_date_id#25223,d_date#25224,d_month_seq#25225,d_week_seq#25226,d_quarter_seq#25227,d_year#25228,d_dow#25229,d_moy#25230,d_dom#25231,d_qoy#25232,d_fy_year#25233,d_fy_quarter_seq#25234,d_fy_week_seq#25235,d_day_name#25236,d_quarter_name#25237,d_holiday#25238,d_weekend#25239,d_following_holiday#25240,d_first_dom#25241,d_last_dom#25242,d_same_day_ly#25243,d_same_day_lq#25244,d_current_day#25245,... 4 more fields] orc
            :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#24987L,cr_item_sk#24988L,cr_refunded_customer_sk#24989L,cr_refunded_cdemo_sk#24990L,cr_refunded_hdemo_sk#24991L,cr_refunded_addr_sk#24992L,cr_returning_customer_sk#24993L,cr_returning_cdemo_sk#24994L,cr_returning_hdemo_sk#24995L,cr_returning_addr_sk#24996L,cr_call_center_sk#24997L,cr_catalog_page_sk#24998L,cr_ship_mode_sk#24999L,cr_warehouse_sk#25000L,cr_reason_sk#25001L,cr_order_number#25002L,cr_return_quantity#25003,cr_return_amount#25004,cr_return_tax#25005,cr_return_amt_inc_tax#25006,cr_fee#25007,cr_return_ship_cost#25008,cr_refunded_cash#25009,cr_reversed_charge#25010,... 3 more fields] orc
            :              :     +- Project [d_date_sk#25036L]
            :              :        +- Join LeftSemi, (d_date#25038 = d_date#25196)
            :              :           :- Project [d_date_sk#25036L, d_date#25038]
            :              :           :  +- Filter isnotnull(d_date_sk#25036L)
            :              :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25036L,d_date_id#25037,d_date#25038,d_month_seq#25039,d_week_seq#25040,d_quarter_seq#25041,d_year#25042,d_dow#25043,d_moy#25044,d_dom#25045,d_qoy#25046,d_fy_year#25047,d_fy_quarter_seq#25048,d_fy_week_seq#25049,d_day_name#25050,d_quarter_name#25051,d_holiday#25052,d_weekend#25053,d_following_holiday#25054,d_first_dom#25055,d_last_dom#25056,d_same_day_ly#25057,d_same_day_lq#25058,d_current_day#25059,... 4 more fields] orc
            :              :           +- Project [d_date#25196]
            :              :              +- Join LeftSemi, (d_week_seq#25198 = d_week_seq#25226)
            :              :                 :- Project [d_date#25196, d_week_seq#25198]
            :              :                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25194L,d_date_id#25195,d_date#25196,d_month_seq#25197,d_week_seq#25198,d_quarter_seq#25199,d_year#25200,d_dow#25201,d_moy#25202,d_dom#25203,d_qoy#25204,d_fy_year#25205,d_fy_quarter_seq#25206,d_fy_week_seq#25207,d_day_name#25208,d_quarter_name#25209,d_holiday#25210,d_weekend#25211,d_following_holiday#25212,d_first_dom#25213,d_last_dom#25214,d_same_day_ly#25215,d_same_day_lq#25216,d_current_day#25217,... 4 more fields] orc
            :              :                 +- Project [d_week_seq#25226]
            :              :                    +- Filter cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)
            :              :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25222L,d_date_id#25223,d_date#25224,d_month_seq#25225,d_week_seq#25226,d_quarter_seq#25227,d_year#25228,d_dow#25229,d_moy#25230,d_dom#25231,d_qoy#25232,d_fy_year#25233,d_fy_quarter_seq#25234,d_fy_week_seq#25235,d_day_name#25236,d_quarter_name#25237,d_holiday#25238,d_weekend#25239,d_following_holiday#25240,d_first_dom#25241,d_last_dom#25242,d_same_day_ly#25243,d_same_day_lq#25244,d_current_day#25245,... 4 more fields] orc
            :              +- Project [i_item_sk#25014L, i_item_id#25015]
            :                 +- Filter (isnotnull(i_item_sk#25014L) AND isnotnull(i_item_id#25015))
            :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25014L,i_item_id#25015,i_rec_start_date#25016,i_rec_end_date#25017,i_item_desc#25018,i_current_price#25019,i_wholesale_cost#25020,i_brand_id#25021,i_brand#25022,i_class_id#25023,i_class#25024,i_category_id#25025,i_category#25026,i_manufact_id#25027,i_manufact#25028,i_size#25029,i_formulation#25030,i_color#25031,i_units#25032,i_container#25033,i_manager_id#25034,i_product_name#25035] orc
            +- Aggregate [i_item_id#25089], [i_item_id#25089 AS item_id#24913, sum(wr_return_quantity#25077) AS wr_item_qty#24914L]
               +- Project [wr_return_quantity#25077, i_item_id#25089]
                  +- Join Inner, (wr_item_sk#25065L = i_item_sk#25088L)
                     :- Project [wr_item_sk#25065L, wr_return_quantity#25077]
                     :  +- Join Inner, (wr_returned_date_sk#25087L = d_date_sk#25110L)
                     :     :- Project [wr_item_sk#25065L, wr_return_quantity#25077, wr_returned_date_sk#25087L]
                     :     :  +- Filter ((isnotnull(wr_item_sk#25065L) AND isnotnull(wr_returned_date_sk#25087L)) AND dynamicpruning#25319 [wr_returned_date_sk#25087L])
                     :     :     :  +- Project [d_date_sk#25110L]
                     :     :     :     +- Join LeftSemi, (d_date#25112 = d_date#25252)
                     :     :     :        :- Project [d_date_sk#25110L, d_date#25112]
                     :     :     :        :  +- Filter isnotnull(d_date_sk#25110L)
                     :     :     :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25110L,d_date_id#25111,d_date#25112,d_month_seq#25113,d_week_seq#25114,d_quarter_seq#25115,d_year#25116,d_dow#25117,d_moy#25118,d_dom#25119,d_qoy#25120,d_fy_year#25121,d_fy_quarter_seq#25122,d_fy_week_seq#25123,d_day_name#25124,d_quarter_name#25125,d_holiday#25126,d_weekend#25127,d_following_holiday#25128,d_first_dom#25129,d_last_dom#25130,d_same_day_ly#25131,d_same_day_lq#25132,d_current_day#25133,... 4 more fields] orc
                     :     :     :        +- Project [d_date#25252]
                     :     :     :           +- Join LeftSemi, (d_week_seq#25254 = d_week_seq#25282)
                     :     :     :              :- Project [d_date#25252, d_week_seq#25254]
                     :     :     :              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25250L,d_date_id#25251,d_date#25252,d_month_seq#25253,d_week_seq#25254,d_quarter_seq#25255,d_year#25256,d_dow#25257,d_moy#25258,d_dom#25259,d_qoy#25260,d_fy_year#25261,d_fy_quarter_seq#25262,d_fy_week_seq#25263,d_day_name#25264,d_quarter_name#25265,d_holiday#25266,d_weekend#25267,d_following_holiday#25268,d_first_dom#25269,d_last_dom#25270,d_same_day_ly#25271,d_same_day_lq#25272,d_current_day#25273,... 4 more fields] orc
                     :     :     :              +- Project [d_week_seq#25282]
                     :     :     :                 +- Filter cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)
                     :     :     :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25278L,d_date_id#25279,d_date#25280,d_month_seq#25281,d_week_seq#25282,d_quarter_seq#25283,d_year#25284,d_dow#25285,d_moy#25286,d_dom#25287,d_qoy#25288,d_fy_year#25289,d_fy_quarter_seq#25290,d_fy_week_seq#25291,d_day_name#25292,d_quarter_name#25293,d_holiday#25294,d_weekend#25295,d_following_holiday#25296,d_first_dom#25297,d_last_dom#25298,d_same_day_ly#25299,d_same_day_lq#25300,d_current_day#25301,... 4 more fields] orc
                     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#25064L,wr_item_sk#25065L,wr_refunded_customer_sk#25066L,wr_refunded_cdemo_sk#25067L,wr_refunded_hdemo_sk#25068L,wr_refunded_addr_sk#25069L,wr_returning_customer_sk#25070L,wr_returning_cdemo_sk#25071L,wr_returning_hdemo_sk#25072L,wr_returning_addr_sk#25073L,wr_web_page_sk#25074L,wr_reason_sk#25075L,wr_order_number#25076L,wr_return_quantity#25077,wr_return_amt#25078,wr_return_tax#25079,wr_return_amt_inc_tax#25080,wr_fee#25081,wr_return_ship_cost#25082,wr_refunded_cash#25083,wr_reversed_charge#25084,wr_account_credit#25085,wr_net_loss#25086,wr_returned_date_sk#25087L] orc
                     :     +- Project [d_date_sk#25110L]
                     :        +- Join LeftSemi, (d_date#25112 = d_date#25252)
                     :           :- Project [d_date_sk#25110L, d_date#25112]
                     :           :  +- Filter isnotnull(d_date_sk#25110L)
                     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25110L,d_date_id#25111,d_date#25112,d_month_seq#25113,d_week_seq#25114,d_quarter_seq#25115,d_year#25116,d_dow#25117,d_moy#25118,d_dom#25119,d_qoy#25120,d_fy_year#25121,d_fy_quarter_seq#25122,d_fy_week_seq#25123,d_day_name#25124,d_quarter_name#25125,d_holiday#25126,d_weekend#25127,d_following_holiday#25128,d_first_dom#25129,d_last_dom#25130,d_same_day_ly#25131,d_same_day_lq#25132,d_current_day#25133,... 4 more fields] orc
                     :           +- Project [d_date#25252]
                     :              +- Join LeftSemi, (d_week_seq#25254 = d_week_seq#25282)
                     :                 :- Project [d_date#25252, d_week_seq#25254]
                     :                 :  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25250L,d_date_id#25251,d_date#25252,d_month_seq#25253,d_week_seq#25254,d_quarter_seq#25255,d_year#25256,d_dow#25257,d_moy#25258,d_dom#25259,d_qoy#25260,d_fy_year#25261,d_fy_quarter_seq#25262,d_fy_week_seq#25263,d_day_name#25264,d_quarter_name#25265,d_holiday#25266,d_weekend#25267,d_following_holiday#25268,d_first_dom#25269,d_last_dom#25270,d_same_day_ly#25271,d_same_day_lq#25272,d_current_day#25273,... 4 more fields] orc
                     :                 +- Project [d_week_seq#25282]
                     :                    +- Filter cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)
                     :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25278L,d_date_id#25279,d_date#25280,d_month_seq#25281,d_week_seq#25282,d_quarter_seq#25283,d_year#25284,d_dow#25285,d_moy#25286,d_dom#25287,d_qoy#25288,d_fy_year#25289,d_fy_quarter_seq#25290,d_fy_week_seq#25291,d_day_name#25292,d_quarter_name#25293,d_holiday#25294,d_weekend#25295,d_following_holiday#25296,d_first_dom#25297,d_last_dom#25298,d_same_day_ly#25299,d_same_day_lq#25300,d_current_day#25301,... 4 more fields] orc
                     +- Project [i_item_sk#25088L, i_item_id#25089]
                        +- Filter (isnotnull(i_item_sk#25088L) AND isnotnull(i_item_id#25089))
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25088L,i_item_id#25089,i_rec_start_date#25090,i_rec_end_date#25091,i_item_desc#25092,i_current_price#25093,i_wholesale_cost#25094,i_brand_id#25095,i_brand#25096,i_class_id#25097,i_class#25098,i_category_id#25099,i_category#25100,i_manufact_id#25101,i_manufact#25102,i_size#25103,i_formulation#25104,i_color#25105,i_units#25106,i_container#25107,i_manager_id#25108,i_product_name#25109] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[item_id#24905 ASC NULLS FIRST,sr_item_qty#24906L ASC NULLS FIRST], output=[item_id#24905,sr_item_qty#24906L,sr_dev#24901,cr_item_qty#24910L,cr_dev#24902,wr_item_qty#24914L,wr_dev#24903,average#24904])
   +- Project [item_id#24905, sr_item_qty#24906L, (((cast(sr_item_qty#24906L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS sr_dev#24901, cr_item_qty#24910L, (((cast(cr_item_qty#24910L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS cr_dev#24902, wr_item_qty#24914L, (((cast(wr_item_qty#24914L as double) / cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as double)) / 3.0) * 100.0) AS wr_dev#24903, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#24906L + cr_item_qty#24910L) + wr_item_qty#24914L) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6), true) AS average#24904]
      +- BroadcastHashJoin [item_id#24905], [item_id#24913], Inner, BuildRight, false
         :- Project [item_id#24905, sr_item_qty#24906L, cr_item_qty#24910L]
         :  +- BroadcastHashJoin [item_id#24905], [item_id#24909], Inner, BuildRight, false
         :     :- HashAggregate(keys=[i_item_id#24938], functions=[sum(sr_return_quantity#24926)], output=[item_id#24905, sr_item_qty#24906L])
         :     :  +- Exchange hashpartitioning(i_item_id#24938, 3000), ENSURE_REQUIREMENTS, [id=#26114]
         :     :     +- HashAggregate(keys=[i_item_id#24938], functions=[partial_sum(sr_return_quantity#24926)], output=[i_item_id#24938, sum#25321L])
         :     :        +- Project [sr_return_quantity#24926, i_item_id#24938]
         :     :           +- SortMergeJoin [sr_item_sk#24918L], [i_item_sk#24937L], Inner
         :     :              :- Sort [sr_item_sk#24918L ASC NULLS FIRST], false, 0
         :     :              :  +- Exchange hashpartitioning(sr_item_sk#24918L, 3000), ENSURE_REQUIREMENTS, [id=#26106]
         :     :              :     +- Project [sr_item_sk#24918L, sr_return_quantity#24926]
         :     :              :        +- BroadcastHashJoin [sr_returned_date_sk#24936L], [d_date_sk#24959L], Inner, BuildRight, false
         :     :              :           :- Filter isnotnull(sr_item_sk#24918L)
         :     :              :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#24918L,sr_return_quantity#24926,sr_returned_date_sk#24936L] Batched: true, DataFilters: [isnotnull(sr_item_sk#24918L)], Format: ORC, Location: InMemoryFileIndex(2003 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(sr_returned_date_sk#24936L), dynamicpruningexpression(sr_returned_date_sk#24936L IN dy..., PushedFilters: [IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_return_quantity:int>
         :     :              :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25317, 0, true, Project [d_date_sk#24959L], [d_date_sk#24959L]
         :     :              :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :     :              :           :              +- Project [d_date_sk#24959L]
         :     :              :           :                 +- BroadcastHashJoin [d_date#24961], [d_date#25140], LeftSemi, BuildRight, false
         :     :              :           :                    :- Filter isnotnull(d_date_sk#24959L)
         :     :              :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24959L,d_date#24961] Batched: true, DataFilters: [isnotnull(d_date_sk#24959L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :     :              :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#25957]
         :     :              :           :                       +- Project [d_date#25140]
         :     :              :           :                          +- BroadcastHashJoin [d_week_seq#25142], [d_week_seq#25170], LeftSemi, BuildRight, false
         :     :              :           :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25140,d_week_seq#25142] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :              :           :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#25953]
         :     :              :           :                                +- Project [d_week_seq#25170]
         :     :              :           :                                   +- Filter cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)
         :     :              :           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25168,d_week_seq#25170] Batched: true, DataFilters: [cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :              :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26101]
         :     :              :              +- Project [d_date_sk#24959L]
         :     :              :                 +- BroadcastHashJoin [d_date#24961], [d_date#25140], LeftSemi, BuildRight, false
         :     :              :                    :- Filter isnotnull(d_date_sk#24959L)
         :     :              :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#24959L,d_date#24961] Batched: true, DataFilters: [isnotnull(d_date_sk#24959L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :     :              :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#26097]
         :     :              :                       +- Project [d_date#25140]
         :     :              :                          +- BroadcastHashJoin [d_week_seq#25142], [d_week_seq#25170], LeftSemi, BuildRight, false
         :     :              :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25140,d_week_seq#25142] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :              :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#26093]
         :     :              :                                +- Project [d_week_seq#25170]
         :     :              :                                   +- Filter cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)
         :     :              :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25168,d_week_seq#25170] Batched: true, DataFilters: [cast(d_date#25168 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :     :              +- Sort [i_item_sk#24937L ASC NULLS FIRST], false, 0
         :     :                 +- Exchange hashpartitioning(i_item_sk#24937L, 3000), ENSURE_REQUIREMENTS, [id=#26107]
         :     :                    +- Filter (isnotnull(i_item_sk#24937L) AND isnotnull(i_item_id#24938))
         :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#24937L,i_item_id#24938] Batched: true, DataFilters: [isnotnull(i_item_sk#24937L), isnotnull(i_item_id#24938)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
         :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#26140]
         :        +- HashAggregate(keys=[i_item_id#25015], functions=[sum(cr_return_quantity#25003)], output=[item_id#24909, cr_item_qty#24910L])
         :           +- Exchange hashpartitioning(i_item_id#25015, 3000), ENSURE_REQUIREMENTS, [id=#26137]
         :              +- HashAggregate(keys=[i_item_id#25015], functions=[partial_sum(cr_return_quantity#25003)], output=[i_item_id#25015, sum#25323L])
         :                 +- Project [cr_return_quantity#25003, i_item_id#25015]
         :                    +- SortMergeJoin [cr_item_sk#24988L], [i_item_sk#25014L], Inner
         :                       :- Sort [cr_item_sk#24988L ASC NULLS FIRST], false, 0
         :                       :  +- Exchange hashpartitioning(cr_item_sk#24988L, 3000), ENSURE_REQUIREMENTS, [id=#26129]
         :                       :     +- Project [cr_item_sk#24988L, cr_return_quantity#25003]
         :                       :        +- BroadcastHashJoin [cr_returned_date_sk#25013L], [d_date_sk#25036L], Inner, BuildRight, false
         :                       :           :- Filter isnotnull(cr_item_sk#24988L)
         :                       :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_item_sk#24988L,cr_return_quantity#25003,cr_returned_date_sk#25013L] Batched: true, DataFilters: [isnotnull(cr_item_sk#24988L)], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#25013L), dynamicpruningexpression(cr_returned_date_sk#25013L IN dy..., PushedFilters: [IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:bigint,cr_return_quantity:int>
         :                       :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25318, 0, true, Project [d_date_sk#25036L], [d_date_sk#25036L]
         :                       :           :           +- AdaptiveSparkPlan isFinalPlan=false
         :                       :           :              +- Project [d_date_sk#25036L]
         :                       :           :                 +- BroadcastHashJoin [d_date#25038], [d_date#25196], LeftSemi, BuildRight, false
         :                       :           :                    :- Filter isnotnull(d_date_sk#25036L)
         :                       :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25036L,d_date#25038] Batched: true, DataFilters: [isnotnull(d_date_sk#25036L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :                       :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#25992]
         :                       :           :                       +- Project [d_date#25196]
         :                       :           :                          +- BroadcastHashJoin [d_week_seq#25198], [d_week_seq#25226], LeftSemi, BuildRight, false
         :                       :           :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25196,d_week_seq#25198] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                       :           :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#25988]
         :                       :           :                                +- Project [d_week_seq#25226]
         :                       :           :                                   +- Filter cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)
         :                       :           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25224,d_week_seq#25226] Batched: true, DataFilters: [cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                       :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26124]
         :                       :              +- Project [d_date_sk#25036L]
         :                       :                 +- BroadcastHashJoin [d_date#25038], [d_date#25196], LeftSemi, BuildRight, false
         :                       :                    :- Filter isnotnull(d_date_sk#25036L)
         :                       :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25036L,d_date#25038] Batched: true, DataFilters: [isnotnull(d_date_sk#25036L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
         :                       :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#26120]
         :                       :                       +- Project [d_date#25196]
         :                       :                          +- BroadcastHashJoin [d_week_seq#25198], [d_week_seq#25226], LeftSemi, BuildRight, false
         :                       :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25196,d_week_seq#25198] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                       :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#26116]
         :                       :                                +- Project [d_week_seq#25226]
         :                       :                                   +- Filter cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)
         :                       :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25224,d_week_seq#25226] Batched: true, DataFilters: [cast(d_date#25224 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
         :                       +- Sort [i_item_sk#25014L ASC NULLS FIRST], false, 0
         :                          +- Exchange hashpartitioning(i_item_sk#25014L, 3000), ENSURE_REQUIREMENTS, [id=#26130]
         :                             +- Filter (isnotnull(i_item_sk#25014L) AND isnotnull(i_item_id#25015))
         :                                +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25014L,i_item_id#25015] Batched: true, DataFilters: [isnotnull(i_item_sk#25014L), isnotnull(i_item_id#25015)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>
         +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]),false), [id=#26167]
            +- HashAggregate(keys=[i_item_id#25089], functions=[sum(wr_return_quantity#25077)], output=[item_id#24913, wr_item_qty#24914L])
               +- Exchange hashpartitioning(i_item_id#25089, 3000), ENSURE_REQUIREMENTS, [id=#26164]
                  +- HashAggregate(keys=[i_item_id#25089], functions=[partial_sum(wr_return_quantity#25077)], output=[i_item_id#25089, sum#25325L])
                     +- Project [wr_return_quantity#25077, i_item_id#25089]
                        +- SortMergeJoin [wr_item_sk#25065L], [i_item_sk#25088L], Inner
                           :- Sort [wr_item_sk#25065L ASC NULLS FIRST], false, 0
                           :  +- Exchange hashpartitioning(wr_item_sk#25065L, 3000), ENSURE_REQUIREMENTS, [id=#26156]
                           :     +- Project [wr_item_sk#25065L, wr_return_quantity#25077]
                           :        +- BroadcastHashJoin [wr_returned_date_sk#25087L], [d_date_sk#25110L], Inner, BuildRight, false
                           :           :- Filter isnotnull(wr_item_sk#25065L)
                           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#25065L,wr_return_quantity#25077,wr_returned_date_sk#25087L] Batched: true, DataFilters: [isnotnull(wr_item_sk#25065L)], Format: ORC, Location: InMemoryFileIndex(2184 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(wr_returned_date_sk#25087L), dynamicpruningexpression(wr_returned_date_sk#25087L IN dy..., PushedFilters: [IsNotNull(wr_item_sk)], ReadSchema: struct<wr_item_sk:bigint,wr_return_quantity:int>
                           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25319, 0, true, Project [d_date_sk#25110L], [d_date_sk#25110L]
                           :           :           +- AdaptiveSparkPlan isFinalPlan=false
                           :           :              +- Project [d_date_sk#25110L]
                           :           :                 +- BroadcastHashJoin [d_date#25112], [d_date#25252], LeftSemi, BuildRight, false
                           :           :                    :- Filter isnotnull(d_date_sk#25110L)
                           :           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25110L,d_date#25112] Batched: true, DataFilters: [isnotnull(d_date_sk#25110L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
                           :           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#26027]
                           :           :                       +- Project [d_date#25252]
                           :           :                          +- BroadcastHashJoin [d_week_seq#25254], [d_week_seq#25282], LeftSemi, BuildRight, false
                           :           :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25252,d_week_seq#25254] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
                           :           :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#26023]
                           :           :                                +- Project [d_week_seq#25282]
                           :           :                                   +- Filter cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)
                           :           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25280,d_week_seq#25282] Batched: true, DataFilters: [cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
                           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26151]
                           :              +- Project [d_date_sk#25110L]
                           :                 +- BroadcastHashJoin [d_date#25112], [d_date#25252], LeftSemi, BuildRight, false
                           :                    :- Filter isnotnull(d_date_sk#25110L)
                           :                    :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25110L,d_date#25112] Batched: true, DataFilters: [isnotnull(d_date_sk#25110L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_date:date>
                           :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#26147]
                           :                       +- Project [d_date#25252]
                           :                          +- BroadcastHashJoin [d_week_seq#25254], [d_week_seq#25282], LeftSemi, BuildRight, false
                           :                             :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25252,d_week_seq#25254] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
                           :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#26143]
                           :                                +- Project [d_week_seq#25282]
                           :                                   +- Filter cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)
                           :                                      +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date#25280,d_week_seq#25282] Batched: true, DataFilters: [cast(d_date#25280 as string) IN (1998-01-02,1998-10-15,1998-11-10)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
                           +- Sort [i_item_sk#25088L ASC NULLS FIRST], false, 0
                              +- Exchange hashpartitioning(i_item_sk#25088L, 3000), ENSURE_REQUIREMENTS, [id=#26157]
                                 +- Filter (isnotnull(i_item_sk#25088L) AND isnotnull(i_item_id#25089))
                                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25088L,i_item_id#25089] Batched: true, DataFilters: [isnotnull(i_item_sk#25088L), isnotnull(i_item_id#25089)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string>

read query: spark_queries/q84.sql
explain query: q84
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['c_customer_id ASC NULLS FIRST], true
      +- 'Project ['c_customer_id AS customer_id#25326, concat(concat('c_last_name, , ), 'c_first_name) AS customername#25327]
         +- 'Filter (((('ca_city = Hopewell) AND ('c_current_addr_sk = 'ca_address_sk)) AND (('ib_lower_bound >= 32287) AND ('ib_upper_bound <= (32287 + 50000)))) AND ((('ib_income_band_sk = 'hd_income_band_sk) AND ('cd_demo_sk = 'c_current_cdemo_sk)) AND (('hd_demo_sk = 'c_current_hdemo_sk) AND ('sr_cdemo_sk = 'cd_demo_sk))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'UnresolvedRelation [customer], [], false
               :  :  :  :  +- 'UnresolvedRelation [customer_address], [], false
               :  :  :  +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  +- 'UnresolvedRelation [household_demographics], [], false
               :  +- 'UnresolvedRelation [income_band], [], false
               +- 'UnresolvedRelation [store_returns], [], false

== Analyzed Logical Plan ==
customer_id: string, customername: string
GlobalLimit 100
+- LocalLimit 100
   +- Project [customer_id#25326, customername#25327]
      +- Sort [c_customer_id#25329 ASC NULLS FIRST], true
         +- Project [c_customer_id#25329 AS customer_id#25326, concat(concat(c_last_name#25337, , ), c_first_name#25336) AS customername#25327, c_customer_id#25329]
            +- Filter ((((ca_city#25352 = Hopewell) AND (c_current_addr_sk#25332L = ca_address_sk#25346L)) AND ((ib_lower_bound#25374 >= 32287) AND (ib_upper_bound#25375 <= (32287 + 50000)))) AND (((ib_income_band_sk#25373L = hd_income_band_sk#25369L) AND (cd_demo_sk#25359L = c_current_cdemo_sk#25330L)) AND ((hd_demo_sk#25368L = c_current_hdemo_sk#25331L) AND (sr_cdemo_sk#25379L = cd_demo_sk#25359L))))
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- Join Inner
                  :  :  :  :- Join Inner
                  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25328L,c_customer_id#25329,c_current_cdemo_sk#25330L,c_current_hdemo_sk#25331L,c_current_addr_sk#25332L,c_first_shipto_date_sk#25333L,c_first_sales_date_sk#25334L,c_salutation#25335,c_first_name#25336,c_last_name#25337,c_preferred_cust_flag#25338,c_birth_day#25339,c_birth_month#25340,c_birth_year#25341,c_birth_country#25342,c_login#25343,c_email_address#25344,c_last_review_date#25345] orc
                  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25346L,ca_address_id#25347,ca_street_number#25348,ca_street_name#25349,ca_street_type#25350,ca_suite_number#25351,ca_city#25352,ca_county#25353,ca_state#25354,ca_zip#25355,ca_country#25356,ca_gmt_offset#25357,ca_location_type#25358] orc
                  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
                  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25359L,cd_gender#25360,cd_marital_status#25361,cd_education_status#25362,cd_purchase_estimate#25363,cd_credit_rating#25364,cd_dep_count#25365,cd_dep_employed_count#25366,cd_dep_college_count#25367] orc
                  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
                  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25368L,hd_income_band_sk#25369L,hd_buy_potential#25370,hd_dep_count#25371,hd_vehicle_count#25372] orc
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.income_band
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#25373L,ib_lower_bound#25374,ib_upper_bound#25375] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#25376L,sr_item_sk#25377L,sr_customer_sk#25378L,sr_cdemo_sk#25379L,sr_hdemo_sk#25380L,sr_addr_sk#25381L,sr_store_sk#25382L,sr_reason_sk#25383L,sr_ticket_number#25384L,sr_return_quantity#25385,sr_return_amt#25386,sr_return_tax#25387,sr_return_amt_inc_tax#25388,sr_fee#25389,sr_return_ship_cost#25390,sr_refunded_cash#25391,sr_reversed_charge#25392,sr_store_credit#25393,sr_net_loss#25394,sr_returned_date_sk#25395L] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Project [customer_id#25326, customername#25327]
      +- Sort [c_customer_id#25329 ASC NULLS FIRST], true
         +- Project [c_customer_id#25329 AS customer_id#25326, concat(c_last_name#25337, , , c_first_name#25336) AS customername#25327, c_customer_id#25329]
            +- Join Inner, (sr_cdemo_sk#25379L = cd_demo_sk#25359L)
               :- Project [c_customer_id#25329, c_first_name#25336, c_last_name#25337, cd_demo_sk#25359L]
               :  +- Join Inner, (cd_demo_sk#25359L = c_current_cdemo_sk#25330L)
               :     :- Project [c_customer_id#25329, c_current_cdemo_sk#25330L, c_first_name#25336, c_last_name#25337]
               :     :  +- Join Inner, (hd_demo_sk#25368L = c_current_hdemo_sk#25331L)
               :     :     :- Project [c_customer_id#25329, c_current_cdemo_sk#25330L, c_current_hdemo_sk#25331L, c_first_name#25336, c_last_name#25337]
               :     :     :  +- Join Inner, (c_current_addr_sk#25332L = ca_address_sk#25346L)
               :     :     :     :- Project [c_customer_id#25329, c_current_cdemo_sk#25330L, c_current_hdemo_sk#25331L, c_current_addr_sk#25332L, c_first_name#25336, c_last_name#25337]
               :     :     :     :  +- Filter (isnotnull(c_current_addr_sk#25332L) AND (isnotnull(c_current_cdemo_sk#25330L) AND isnotnull(c_current_hdemo_sk#25331L)))
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25328L,c_customer_id#25329,c_current_cdemo_sk#25330L,c_current_hdemo_sk#25331L,c_current_addr_sk#25332L,c_first_shipto_date_sk#25333L,c_first_sales_date_sk#25334L,c_salutation#25335,c_first_name#25336,c_last_name#25337,c_preferred_cust_flag#25338,c_birth_day#25339,c_birth_month#25340,c_birth_year#25341,c_birth_country#25342,c_login#25343,c_email_address#25344,c_last_review_date#25345] orc
               :     :     :     +- Project [ca_address_sk#25346L]
               :     :     :        +- Filter ((isnotnull(ca_city#25352) AND (ca_city#25352 = Hopewell)) AND isnotnull(ca_address_sk#25346L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25346L,ca_address_id#25347,ca_street_number#25348,ca_street_name#25349,ca_street_type#25350,ca_suite_number#25351,ca_city#25352,ca_county#25353,ca_state#25354,ca_zip#25355,ca_country#25356,ca_gmt_offset#25357,ca_location_type#25358] orc
               :     :     +- Project [hd_demo_sk#25368L]
               :     :        +- Join Inner, (ib_income_band_sk#25373L = hd_income_band_sk#25369L)
               :     :           :- Project [hd_demo_sk#25368L, hd_income_band_sk#25369L]
               :     :           :  +- Filter (isnotnull(hd_demo_sk#25368L) AND isnotnull(hd_income_band_sk#25369L))
               :     :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25368L,hd_income_band_sk#25369L,hd_buy_potential#25370,hd_dep_count#25371,hd_vehicle_count#25372] orc
               :     :           +- Project [ib_income_band_sk#25373L]
               :     :              +- Filter (((isnotnull(ib_lower_bound#25374) AND isnotnull(ib_upper_bound#25375)) AND ((ib_lower_bound#25374 >= 32287) AND (ib_upper_bound#25375 <= 82287))) AND isnotnull(ib_income_band_sk#25373L))
               :     :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#25373L,ib_lower_bound#25374,ib_upper_bound#25375] orc
               :     +- Project [cd_demo_sk#25359L]
               :        +- Filter isnotnull(cd_demo_sk#25359L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25359L,cd_gender#25360,cd_marital_status#25361,cd_education_status#25362,cd_purchase_estimate#25363,cd_credit_rating#25364,cd_dep_count#25365,cd_dep_employed_count#25366,cd_dep_college_count#25367] orc
               +- Project [sr_cdemo_sk#25379L]
                  +- Filter isnotnull(sr_cdemo_sk#25379L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#25376L,sr_item_sk#25377L,sr_customer_sk#25378L,sr_cdemo_sk#25379L,sr_hdemo_sk#25380L,sr_addr_sk#25381L,sr_store_sk#25382L,sr_reason_sk#25383L,sr_ticket_number#25384L,sr_return_quantity#25385,sr_return_amt#25386,sr_return_tax#25387,sr_return_amt_inc_tax#25388,sr_fee#25389,sr_return_ship_cost#25390,sr_refunded_cash#25391,sr_reversed_charge#25392,sr_store_credit#25393,sr_net_loss#25394,sr_returned_date_sk#25395L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[c_customer_id#25329 ASC NULLS FIRST], output=[customer_id#25326,customername#25327])
   +- Project [c_customer_id#25329 AS customer_id#25326, concat(c_last_name#25337, , , c_first_name#25336) AS customername#25327, c_customer_id#25329]
      +- BroadcastHashJoin [cd_demo_sk#25359L], [sr_cdemo_sk#25379L], Inner, BuildLeft, false
         :- BroadcastExchange HashedRelationBroadcastMode(List(input[3, bigint, true]),false), [id=#26288]
         :  +- Project [c_customer_id#25329, c_first_name#25336, c_last_name#25337, cd_demo_sk#25359L]
         :     +- BroadcastHashJoin [c_current_cdemo_sk#25330L], [cd_demo_sk#25359L], Inner, BuildLeft, false
         :        :- BroadcastExchange HashedRelationBroadcastMode(List(input[1, bigint, true]),false), [id=#26284]
         :        :  +- Project [c_customer_id#25329, c_current_cdemo_sk#25330L, c_first_name#25336, c_last_name#25337]
         :        :     +- BroadcastHashJoin [c_current_hdemo_sk#25331L], [hd_demo_sk#25368L], Inner, BuildRight, false
         :        :        :- Project [c_customer_id#25329, c_current_cdemo_sk#25330L, c_current_hdemo_sk#25331L, c_first_name#25336, c_last_name#25337]
         :        :        :  +- BroadcastHashJoin [c_current_addr_sk#25332L], [ca_address_sk#25346L], Inner, BuildRight, false
         :        :        :     :- Filter ((isnotnull(c_current_addr_sk#25332L) AND isnotnull(c_current_cdemo_sk#25330L)) AND isnotnull(c_current_hdemo_sk#25331L))
         :        :        :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_id#25329,c_current_cdemo_sk#25330L,c_current_hdemo_sk#25331L,c_current_addr_sk#25332L,c_first_name#25336,c_last_name#25337] Batched: true, DataFilters: [isnotnull(c_current_addr_sk#25332L), isnotnull(c_current_cdemo_sk#25330L), isnotnull(c_current_h..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk), IsNotNull(c_current_hdemo_sk)], ReadSchema: struct<c_customer_id:string,c_current_cdemo_sk:bigint,c_current_hdemo_sk:bigint,c_current_addr_sk...
         :        :        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26273]
         :        :        :        +- Project [ca_address_sk#25346L]
         :        :        :           +- Filter ((isnotnull(ca_city#25352) AND (ca_city#25352 = Hopewell)) AND isnotnull(ca_address_sk#25346L))
         :        :        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25346L,ca_city#25352] Batched: true, DataFilters: [isnotnull(ca_city#25352), (ca_city#25352 = Hopewell), isnotnull(ca_address_sk#25346L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_city), EqualTo(ca_city,Hopewell), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_city:string>
         :        :        +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26280]
         :        :           +- Project [hd_demo_sk#25368L]
         :        :              +- BroadcastHashJoin [hd_income_band_sk#25369L], [ib_income_band_sk#25373L], Inner, BuildRight, false
         :        :                 :- Filter (isnotnull(hd_demo_sk#25368L) AND isnotnull(hd_income_band_sk#25369L))
         :        :                 :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25368L,hd_income_band_sk#25369L] Batched: true, DataFilters: [isnotnull(hd_demo_sk#25368L), isnotnull(hd_income_band_sk#25369L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_income_band_sk:bigint>
         :        :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26276]
         :        :                    +- Project [ib_income_band_sk#25373L]
         :        :                       +- Filter ((((isnotnull(ib_lower_bound#25374) AND isnotnull(ib_upper_bound#25375)) AND (ib_lower_bound#25374 >= 32287)) AND (ib_upper_bound#25375 <= 82287)) AND isnotnull(ib_income_band_sk#25373L))
         :        :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.income_band[ib_income_band_sk#25373L,ib_lower_bound#25374,ib_upper_bound#25375] Batched: true, DataFilters: [isnotnull(ib_lower_bound#25374), isnotnull(ib_upper_bound#25375), (ib_lower_bound#25374 >= 32287..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ib_lower_bound), IsNotNull(ib_upper_bound), GreaterThanOrEqual(ib_lower_bound,32287), ..., ReadSchema: struct<ib_income_band_sk:bigint,ib_lower_bound:int,ib_upper_bound:int>
         :        +- Filter isnotnull(cd_demo_sk#25359L)
         :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25359L] Batched: true, DataFilters: [isnotnull(cd_demo_sk#25359L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:bigint>
         +- Project [sr_cdemo_sk#25379L]
            +- Filter isnotnull(sr_cdemo_sk#25379L)
               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_cdemo_sk#25379L,sr_returned_date_sk#25395L] Batched: true, DataFilters: [isnotnull(sr_cdemo_sk#25379L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_cdemo_sk)], ReadSchema: struct<sr_cdemo_sk:bigint>

read query: spark_queries/q85.sql
explain query: q85
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['substr('r_reason_desc, 1, 20) ASC NULLS FIRST, 'avg('ws_quantity) ASC NULLS FIRST, 'avg('wr_refunded_cash) ASC NULLS FIRST, 'avg('wr_fee) ASC NULLS FIRST], true
      +- 'Aggregate ['r_reason_desc], [unresolvedalias('substr('r_reason_desc, 1, 20), None), unresolvedalias('avg('ws_quantity), None), unresolvedalias('avg('wr_refunded_cash), None), unresolvedalias('avg('wr_fee), None)]
         +- 'Filter ((((('ws_web_page_sk = 'wp_web_page_sk) AND ('ws_item_sk = 'wr_item_sk)) AND ('ws_order_number = 'wr_order_number)) AND ((('ws_sold_date_sk = 'd_date_sk) AND ('d_year = 1998)) AND ('cd1.cd_demo_sk = 'wr_refunded_cdemo_sk))) AND (((('cd2.cd_demo_sk = 'wr_returning_cdemo_sk) AND ('ca_address_sk = 'wr_refunded_addr_sk)) AND ('r_reason_sk = 'wr_reason_sk)) AND ((((((('cd1.cd_marital_status = M) AND ('cd1.cd_marital_status = 'cd2.cd_marital_status)) AND ('cd1.cd_education_status = 4 yr Degree)) AND (('cd1.cd_education_status = 'cd2.cd_education_status) AND (('ws_sales_price >= 100.00) AND ('ws_sales_price <= 150.00)))) OR (((('cd1.cd_marital_status = D) AND ('cd1.cd_marital_status = 'cd2.cd_marital_status)) AND ('cd1.cd_education_status = Primary)) AND (('cd1.cd_education_status = 'cd2.cd_education_status) AND (('ws_sales_price >= 50.00) AND ('ws_sales_price <= 100.00))))) OR (((('cd1.cd_marital_status = U) AND ('cd1.cd_marital_status = 'cd2.cd_marital_status)) AND ('cd1.cd_education_status = Advanced Degree)) AND (('cd1.cd_education_status = 'cd2.cd_education_status) AND (('ws_sales_price >= 150.00) AND ('ws_sales_price <= 200.00))))) AND ((((('ca_country = United States) AND 'ca_state IN (KY,GA,NM)) AND (('ws_net_profit >= 100) AND ('ws_net_profit <= 200))) OR ((('ca_country = United States) AND 'ca_state IN (MT,OR,IN)) AND (('ws_net_profit >= 150) AND ('ws_net_profit <= 300)))) OR ((('ca_country = United States) AND 'ca_state IN (WI,MO,WV)) AND (('ws_net_profit >= 50) AND ('ws_net_profit <= 250)))))))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'Join Inner
               :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :- 'Join Inner
               :  :  :  :  :  :  :- 'UnresolvedRelation [web_sales], [], false
               :  :  :  :  :  :  +- 'UnresolvedRelation [web_returns], [], false
               :  :  :  :  :  +- 'UnresolvedRelation [web_page], [], false
               :  :  :  :  +- 'SubqueryAlias cd1
               :  :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  :  +- 'SubqueryAlias cd2
               :  :  :     +- 'UnresolvedRelation [customer_demographics], [], false
               :  :  +- 'UnresolvedRelation [customer_address], [], false
               :  +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [reason], [], false

== Analyzed Logical Plan ==
substr(r_reason_desc, 1, 20): string, avg(ws_quantity): double, avg(wr_refunded_cash): double, avg(wr_fee): double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(r_reason_desc, 1, 20)#25535 ASC NULLS FIRST, avg(ws_quantity)#25536 ASC NULLS FIRST, avg(wr_refunded_cash)#25537 ASC NULLS FIRST, avg(wr_fee)#25538 ASC NULLS FIRST], true
      +- Aggregate [r_reason_desc#25531], [substr(r_reason_desc#25531, 1, 20) AS substr(r_reason_desc, 1, 20)#25535, avg(ws_quantity#25415) AS avg(ws_quantity)#25536, avg(wr_refunded_cash#25451) AS avg(wr_refunded_cash)#25537, avg(wr_fee#25449) AS avg(wr_fee)#25538]
         +- Filter (((((ws_web_page_sk#25409L = wp_web_page_sk#25456L) AND (ws_item_sk#25400L = wr_item_sk#25433L)) AND (ws_order_number#25414L = wr_order_number#25444L)) AND (((ws_sold_date_sk#25431L = d_date_sk#25501L) AND (d_year#25507 = 1998)) AND (cd_demo_sk#25470L = wr_refunded_cdemo_sk#25435L))) AND ((((cd_demo_sk#25479L = wr_returning_cdemo_sk#25439L) AND (ca_address_sk#25488L = wr_refunded_addr_sk#25437L)) AND (r_reason_sk#25529L = wr_reason_sk#25443L)) AND (((((((cd_marital_status#25472 = M) AND (cd_marital_status#25472 = cd_marital_status#25481)) AND (cd_education_status#25473 = 4 yr Degree)) AND ((cd_education_status#25473 = cd_education_status#25482) AND ((ws_sales_price#25418 >= cast(100.00 as double)) AND (ws_sales_price#25418 <= cast(150.00 as double))))) OR ((((cd_marital_status#25472 = D) AND (cd_marital_status#25472 = cd_marital_status#25481)) AND (cd_education_status#25473 = Primary)) AND ((cd_education_status#25473 = cd_education_status#25482) AND ((ws_sales_price#25418 >= cast(50.00 as double)) AND (ws_sales_price#25418 <= cast(100.00 as double)))))) OR ((((cd_marital_status#25472 = U) AND (cd_marital_status#25472 = cd_marital_status#25481)) AND (cd_education_status#25473 = Advanced Degree)) AND ((cd_education_status#25473 = cd_education_status#25482) AND ((ws_sales_price#25418 >= cast(150.00 as double)) AND (ws_sales_price#25418 <= cast(200.00 as double)))))) AND (((((ca_country#25498 = United States) AND ca_state#25496 IN (KY,GA,NM)) AND ((ws_net_profit#25430 >= cast(100 as double)) AND (ws_net_profit#25430 <= cast(200 as double)))) OR (((ca_country#25498 = United States) AND ca_state#25496 IN (MT,OR,IN)) AND ((ws_net_profit#25430 >= cast(150 as double)) AND (ws_net_profit#25430 <= cast(300 as double))))) OR (((ca_country#25498 = United States) AND ca_state#25496 IN (WI,MO,WV)) AND ((ws_net_profit#25430 >= cast(50 as double)) AND (ws_net_profit#25430 <= cast(250 as double))))))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- Join Inner
               :  :  :  :  :  :- Join Inner
               :  :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25398L,ws_ship_date_sk#25399L,ws_item_sk#25400L,ws_bill_customer_sk#25401L,ws_bill_cdemo_sk#25402L,ws_bill_hdemo_sk#25403L,ws_bill_addr_sk#25404L,ws_ship_customer_sk#25405L,ws_ship_cdemo_sk#25406L,ws_ship_hdemo_sk#25407L,ws_ship_addr_sk#25408L,ws_web_page_sk#25409L,ws_web_site_sk#25410L,ws_ship_mode_sk#25411L,ws_warehouse_sk#25412L,ws_promo_sk#25413L,ws_order_number#25414L,ws_quantity#25415,ws_wholesale_cost#25416,ws_list_price#25417,ws_sales_price#25418,ws_ext_discount_amt#25419,ws_ext_sales_price#25420,ws_ext_wholesale_cost#25421,... 10 more fields] orc
               :  :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
               :  :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#25432L,wr_item_sk#25433L,wr_refunded_customer_sk#25434L,wr_refunded_cdemo_sk#25435L,wr_refunded_hdemo_sk#25436L,wr_refunded_addr_sk#25437L,wr_returning_customer_sk#25438L,wr_returning_cdemo_sk#25439L,wr_returning_hdemo_sk#25440L,wr_returning_addr_sk#25441L,wr_web_page_sk#25442L,wr_reason_sk#25443L,wr_order_number#25444L,wr_return_quantity#25445,wr_return_amt#25446,wr_return_tax#25447,wr_return_amt_inc_tax#25448,wr_fee#25449,wr_return_ship_cost#25450,wr_refunded_cash#25451,wr_reversed_charge#25452,wr_account_credit#25453,wr_net_loss#25454,wr_returned_date_sk#25455L] orc
               :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_page
               :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#25456L,wp_web_page_id#25457,wp_rec_start_date#25458,wp_rec_end_date#25459,wp_creation_date_sk#25460L,wp_access_date_sk#25461L,wp_autogen_flag#25462,wp_customer_sk#25463L,wp_url#25464,wp_type#25465,wp_char_count#25466,wp_link_count#25467,wp_image_count#25468,wp_max_ad_count#25469] orc
               :  :  :  :  +- SubqueryAlias cd1
               :  :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
               :  :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25470L,cd_gender#25471,cd_marital_status#25472,cd_education_status#25473,cd_purchase_estimate#25474,cd_credit_rating#25475,cd_dep_count#25476,cd_dep_employed_count#25477,cd_dep_college_count#25478] orc
               :  :  :  +- SubqueryAlias cd2
               :  :  :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
               :  :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25479L,cd_gender#25480,cd_marital_status#25481,cd_education_status#25482,cd_purchase_estimate#25483,cd_credit_rating#25484,cd_dep_count#25485,cd_dep_employed_count#25486,cd_dep_college_count#25487] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25488L,ca_address_id#25489,ca_street_number#25490,ca_street_name#25491,ca_street_type#25492,ca_suite_number#25493,ca_city#25494,ca_county#25495,ca_state#25496,ca_zip#25497,ca_country#25498,ca_gmt_offset#25499,ca_location_type#25500] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25501L,d_date_id#25502,d_date#25503,d_month_seq#25504,d_week_seq#25505,d_quarter_seq#25506,d_year#25507,d_dow#25508,d_moy#25509,d_dom#25510,d_qoy#25511,d_fy_year#25512,d_fy_quarter_seq#25513,d_fy_week_seq#25514,d_day_name#25515,d_quarter_name#25516,d_holiday#25517,d_weekend#25518,d_following_holiday#25519,d_first_dom#25520,d_last_dom#25521,d_same_day_ly#25522,d_same_day_lq#25523,d_current_day#25524,... 4 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.reason
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#25529L,r_reason_id#25530,r_reason_desc#25531] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(r_reason_desc, 1, 20)#25535 ASC NULLS FIRST, avg(ws_quantity)#25536 ASC NULLS FIRST, avg(wr_refunded_cash)#25537 ASC NULLS FIRST, avg(wr_fee)#25538 ASC NULLS FIRST], true
      +- Aggregate [r_reason_desc#25531], [substr(r_reason_desc#25531, 1, 20) AS substr(r_reason_desc, 1, 20)#25535, avg(ws_quantity#25415) AS avg(ws_quantity)#25536, avg(wr_refunded_cash#25451) AS avg(wr_refunded_cash)#25537, avg(wr_fee#25449) AS avg(wr_fee)#25538]
         +- Project [ws_quantity#25415, wr_fee#25449, wr_refunded_cash#25451, r_reason_desc#25531]
            +- Join Inner, (r_reason_sk#25529L = wr_reason_sk#25443L)
               :- Project [ws_quantity#25415, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
               :  +- Join Inner, (((cd_demo_sk#25479L = wr_returning_cdemo_sk#25439L) AND (cd_marital_status#25472 = cd_marital_status#25481)) AND (cd_education_status#25473 = cd_education_status#25482))
               :     :- Project [ws_quantity#25415, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451, cd_marital_status#25472, cd_education_status#25473]
               :     :  +- Join Inner, (((((((cd_marital_status#25472 = M) AND (cd_education_status#25473 = 4 yr Degree)) AND (ws_sales_price#25418 >= 100.0)) AND (ws_sales_price#25418 <= 150.0)) OR ((((cd_marital_status#25472 = D) AND (cd_education_status#25473 = Primary)) AND (ws_sales_price#25418 >= 50.0)) AND (ws_sales_price#25418 <= 100.0))) OR ((((cd_marital_status#25472 = U) AND (cd_education_status#25473 = Advanced Degree)) AND (ws_sales_price#25418 >= 150.0)) AND (ws_sales_price#25418 <= 200.0))) AND (cd_demo_sk#25470L = wr_refunded_cdemo_sk#25435L))
               :     :     :- Project [ws_quantity#25415, ws_sales_price#25418, wr_refunded_cdemo_sk#25435L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
               :     :     :  +- Join Inner, (ws_sold_date_sk#25431L = d_date_sk#25501L)
               :     :     :     :- Project [ws_quantity#25415, ws_sales_price#25418, ws_sold_date_sk#25431L, wr_refunded_cdemo_sk#25435L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
               :     :     :     :  +- Join Inner, ((ca_address_sk#25488L = wr_refunded_addr_sk#25437L) AND ((((ca_state#25496 IN (KY,GA,NM) AND (ws_net_profit#25430 >= 100.0)) AND (ws_net_profit#25430 <= 200.0)) OR ((ca_state#25496 IN (MT,OR,IN) AND (ws_net_profit#25430 >= 150.0)) AND (ws_net_profit#25430 <= 300.0))) OR ((ca_state#25496 IN (WI,MO,WV) AND (ws_net_profit#25430 >= 50.0)) AND (ws_net_profit#25430 <= 250.0))))
               :     :     :     :     :- Project [ws_quantity#25415, ws_sales_price#25418, ws_net_profit#25430, ws_sold_date_sk#25431L, wr_refunded_cdemo_sk#25435L, wr_refunded_addr_sk#25437L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
               :     :     :     :     :  +- Join Inner, ((ws_item_sk#25400L = wr_item_sk#25433L) AND (ws_order_number#25414L = wr_order_number#25444L))
               :     :     :     :     :     :- Project [ws_item_sk#25400L, ws_order_number#25414L, ws_quantity#25415, ws_sales_price#25418, ws_net_profit#25430, ws_sold_date_sk#25431L]
               :     :     :     :     :     :  +- Join Inner, (ws_web_page_sk#25409L = wp_web_page_sk#25456L)
               :     :     :     :     :     :     :- Project [ws_item_sk#25400L, ws_web_page_sk#25409L, ws_order_number#25414L, ws_quantity#25415, ws_sales_price#25418, ws_net_profit#25430, ws_sold_date_sk#25431L]
               :     :     :     :     :     :     :  +- Filter ((((isnotnull(ws_item_sk#25400L) AND isnotnull(ws_order_number#25414L)) AND isnotnull(ws_web_page_sk#25409L)) AND isnotnull(ws_sold_date_sk#25431L)) AND ((((((ws_sales_price#25418 >= 100.0) AND (ws_sales_price#25418 <= 150.0)) OR ((ws_sales_price#25418 >= 50.0) AND (ws_sales_price#25418 <= 100.0))) OR ((ws_sales_price#25418 >= 150.0) AND (ws_sales_price#25418 <= 200.0))) AND ((((ws_net_profit#25430 >= 100.0) AND (ws_net_profit#25430 <= 200.0)) OR ((ws_net_profit#25430 >= 150.0) AND (ws_net_profit#25430 <= 300.0))) OR ((ws_net_profit#25430 >= 50.0) AND (ws_net_profit#25430 <= 250.0)))) AND dynamicpruning#25546 [ws_sold_date_sk#25431L]))
               :     :     :     :     :     :     :     :  +- Project [d_date_sk#25501L]
               :     :     :     :     :     :     :     :     +- Filter ((isnotnull(d_year#25507) AND (d_year#25507 = 1998)) AND isnotnull(d_date_sk#25501L))
               :     :     :     :     :     :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25501L,d_date_id#25502,d_date#25503,d_month_seq#25504,d_week_seq#25505,d_quarter_seq#25506,d_year#25507,d_dow#25508,d_moy#25509,d_dom#25510,d_qoy#25511,d_fy_year#25512,d_fy_quarter_seq#25513,d_fy_week_seq#25514,d_day_name#25515,d_quarter_name#25516,d_holiday#25517,d_weekend#25518,d_following_holiday#25519,d_first_dom#25520,d_last_dom#25521,d_same_day_ly#25522,d_same_day_lq#25523,d_current_day#25524,... 4 more fields] orc
               :     :     :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25398L,ws_ship_date_sk#25399L,ws_item_sk#25400L,ws_bill_customer_sk#25401L,ws_bill_cdemo_sk#25402L,ws_bill_hdemo_sk#25403L,ws_bill_addr_sk#25404L,ws_ship_customer_sk#25405L,ws_ship_cdemo_sk#25406L,ws_ship_hdemo_sk#25407L,ws_ship_addr_sk#25408L,ws_web_page_sk#25409L,ws_web_site_sk#25410L,ws_ship_mode_sk#25411L,ws_warehouse_sk#25412L,ws_promo_sk#25413L,ws_order_number#25414L,ws_quantity#25415,ws_wholesale_cost#25416,ws_list_price#25417,ws_sales_price#25418,ws_ext_discount_amt#25419,ws_ext_sales_price#25420,ws_ext_wholesale_cost#25421,... 10 more fields] orc
               :     :     :     :     :     :     +- Project [wp_web_page_sk#25456L]
               :     :     :     :     :     :        +- Filter isnotnull(wp_web_page_sk#25456L)
               :     :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#25456L,wp_web_page_id#25457,wp_rec_start_date#25458,wp_rec_end_date#25459,wp_creation_date_sk#25460L,wp_access_date_sk#25461L,wp_autogen_flag#25462,wp_customer_sk#25463L,wp_url#25464,wp_type#25465,wp_char_count#25466,wp_link_count#25467,wp_image_count#25468,wp_max_ad_count#25469] orc
               :     :     :     :     :     +- Project [wr_item_sk#25433L, wr_refunded_cdemo_sk#25435L, wr_refunded_addr_sk#25437L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_order_number#25444L, wr_fee#25449, wr_refunded_cash#25451]
               :     :     :     :     :        +- Filter (((isnotnull(wr_item_sk#25433L) AND isnotnull(wr_order_number#25444L)) AND isnotnull(wr_refunded_cdemo_sk#25435L)) AND ((isnotnull(wr_returning_cdemo_sk#25439L) AND isnotnull(wr_refunded_addr_sk#25437L)) AND isnotnull(wr_reason_sk#25443L)))
               :     :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#25432L,wr_item_sk#25433L,wr_refunded_customer_sk#25434L,wr_refunded_cdemo_sk#25435L,wr_refunded_hdemo_sk#25436L,wr_refunded_addr_sk#25437L,wr_returning_customer_sk#25438L,wr_returning_cdemo_sk#25439L,wr_returning_hdemo_sk#25440L,wr_returning_addr_sk#25441L,wr_web_page_sk#25442L,wr_reason_sk#25443L,wr_order_number#25444L,wr_return_quantity#25445,wr_return_amt#25446,wr_return_tax#25447,wr_return_amt_inc_tax#25448,wr_fee#25449,wr_return_ship_cost#25450,wr_refunded_cash#25451,wr_reversed_charge#25452,wr_account_credit#25453,wr_net_loss#25454,wr_returned_date_sk#25455L] orc
               :     :     :     :     +- Project [ca_address_sk#25488L, ca_state#25496]
               :     :     :     :        +- Filter (((isnotnull(ca_country#25498) AND (ca_country#25498 = United States)) AND isnotnull(ca_address_sk#25488L)) AND ((ca_state#25496 IN (KY,GA,NM) OR ca_state#25496 IN (MT,OR,IN)) OR ca_state#25496 IN (WI,MO,WV)))
               :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25488L,ca_address_id#25489,ca_street_number#25490,ca_street_name#25491,ca_street_type#25492,ca_suite_number#25493,ca_city#25494,ca_county#25495,ca_state#25496,ca_zip#25497,ca_country#25498,ca_gmt_offset#25499,ca_location_type#25500] orc
               :     :     :     +- Project [d_date_sk#25501L]
               :     :     :        +- Filter ((isnotnull(d_year#25507) AND (d_year#25507 = 1998)) AND isnotnull(d_date_sk#25501L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25501L,d_date_id#25502,d_date#25503,d_month_seq#25504,d_week_seq#25505,d_quarter_seq#25506,d_year#25507,d_dow#25508,d_moy#25509,d_dom#25510,d_qoy#25511,d_fy_year#25512,d_fy_quarter_seq#25513,d_fy_week_seq#25514,d_day_name#25515,d_quarter_name#25516,d_holiday#25517,d_weekend#25518,d_following_holiday#25519,d_first_dom#25520,d_last_dom#25521,d_same_day_ly#25522,d_same_day_lq#25523,d_current_day#25524,... 4 more fields] orc
               :     :     +- Project [cd_demo_sk#25470L, cd_marital_status#25472, cd_education_status#25473]
               :     :        +- Filter ((isnotnull(cd_demo_sk#25470L) AND (isnotnull(cd_marital_status#25472) AND isnotnull(cd_education_status#25473))) AND ((((cd_marital_status#25472 = M) AND (cd_education_status#25473 = 4 yr Degree)) OR ((cd_marital_status#25472 = D) AND (cd_education_status#25473 = Primary))) OR ((cd_marital_status#25472 = U) AND (cd_education_status#25473 = Advanced Degree))))
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25470L,cd_gender#25471,cd_marital_status#25472,cd_education_status#25473,cd_purchase_estimate#25474,cd_credit_rating#25475,cd_dep_count#25476,cd_dep_employed_count#25477,cd_dep_college_count#25478] orc
               :     +- Project [cd_demo_sk#25479L, cd_marital_status#25481, cd_education_status#25482]
               :        +- Filter ((isnotnull(cd_demo_sk#25479L) AND isnotnull(cd_marital_status#25481)) AND isnotnull(cd_education_status#25482))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25479L,cd_gender#25480,cd_marital_status#25481,cd_education_status#25482,cd_purchase_estimate#25483,cd_credit_rating#25484,cd_dep_count#25485,cd_dep_employed_count#25486,cd_dep_college_count#25487] orc
               +- Project [r_reason_sk#25529L, r_reason_desc#25531]
                  +- Filter isnotnull(r_reason_sk#25529L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#25529L,r_reason_id#25530,r_reason_desc#25531] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[substr(r_reason_desc, 1, 20)#25535 ASC NULLS FIRST,avg(ws_quantity)#25536 ASC NULLS FIRST,avg(wr_refunded_cash)#25537 ASC NULLS FIRST,avg(wr_fee)#25538 ASC NULLS FIRST], output=[substr(r_reason_desc, 1, 20)#25535,avg(ws_quantity)#25536,avg(wr_refunded_cash)#25537,avg(wr_fee)#25538])
   +- HashAggregate(keys=[r_reason_desc#25531], functions=[avg(ws_quantity#25415), avg(wr_refunded_cash#25451), avg(wr_fee#25449)], output=[substr(r_reason_desc, 1, 20)#25535, avg(ws_quantity)#25536, avg(wr_refunded_cash)#25537, avg(wr_fee)#25538])
      +- Exchange hashpartitioning(r_reason_desc#25531, 3000), ENSURE_REQUIREMENTS, [id=#26506]
         +- HashAggregate(keys=[r_reason_desc#25531], functions=[partial_avg(ws_quantity#25415), partial_avg(wr_refunded_cash#25451), partial_avg(wr_fee#25449)], output=[r_reason_desc#25531, sum#25553, count#25554L, sum#25555, count#25556L, sum#25557, count#25558L])
            +- Project [ws_quantity#25415, wr_fee#25449, wr_refunded_cash#25451, r_reason_desc#25531]
               +- BroadcastHashJoin [wr_reason_sk#25443L], [r_reason_sk#25529L], Inner, BuildRight, false
                  :- Project [ws_quantity#25415, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
                  :  +- SortMergeJoin [wr_returning_cdemo_sk#25439L, cd_marital_status#25472, cd_education_status#25473], [cd_demo_sk#25479L, cd_marital_status#25481, cd_education_status#25482], Inner
                  :     :- Sort [wr_returning_cdemo_sk#25439L ASC NULLS FIRST, cd_marital_status#25472 ASC NULLS FIRST, cd_education_status#25473 ASC NULLS FIRST], false, 0
                  :     :  +- Exchange hashpartitioning(wr_returning_cdemo_sk#25439L, cd_marital_status#25472, cd_education_status#25473, 3000), ENSURE_REQUIREMENTS, [id=#26494]
                  :     :     +- Project [ws_quantity#25415, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451, cd_marital_status#25472, cd_education_status#25473]
                  :     :        +- BroadcastHashJoin [wr_refunded_cdemo_sk#25435L], [cd_demo_sk#25470L], Inner, BuildRight, ((((((cd_marital_status#25472 = M) AND (cd_education_status#25473 = 4 yr Degree)) AND (ws_sales_price#25418 >= 100.0)) AND (ws_sales_price#25418 <= 150.0)) OR ((((cd_marital_status#25472 = D) AND (cd_education_status#25473 = Primary)) AND (ws_sales_price#25418 >= 50.0)) AND (ws_sales_price#25418 <= 100.0))) OR ((((cd_marital_status#25472 = U) AND (cd_education_status#25473 = Advanced Degree)) AND (ws_sales_price#25418 >= 150.0)) AND (ws_sales_price#25418 <= 200.0))), false
                  :     :           :- Project [ws_quantity#25415, ws_sales_price#25418, wr_refunded_cdemo_sk#25435L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
                  :     :           :  +- BroadcastHashJoin [ws_sold_date_sk#25431L], [d_date_sk#25501L], Inner, BuildRight, false
                  :     :           :     :- Project [ws_quantity#25415, ws_sales_price#25418, ws_sold_date_sk#25431L, wr_refunded_cdemo_sk#25435L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
                  :     :           :     :  +- SortMergeJoin [wr_refunded_addr_sk#25437L], [ca_address_sk#25488L], Inner, ((((ca_state#25496 IN (KY,GA,NM) AND (ws_net_profit#25430 >= 100.0)) AND (ws_net_profit#25430 <= 200.0)) OR ((ca_state#25496 IN (MT,OR,IN) AND (ws_net_profit#25430 >= 150.0)) AND (ws_net_profit#25430 <= 300.0))) OR ((ca_state#25496 IN (WI,MO,WV) AND (ws_net_profit#25430 >= 50.0)) AND (ws_net_profit#25430 <= 250.0)))
                  :     :           :     :     :- Sort [wr_refunded_addr_sk#25437L ASC NULLS FIRST], false, 0
                  :     :           :     :     :  +- Exchange hashpartitioning(wr_refunded_addr_sk#25437L, 3000), ENSURE_REQUIREMENTS, [id=#26478]
                  :     :           :     :     :     +- Project [ws_quantity#25415, ws_sales_price#25418, ws_net_profit#25430, ws_sold_date_sk#25431L, wr_refunded_cdemo_sk#25435L, wr_refunded_addr_sk#25437L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_fee#25449, wr_refunded_cash#25451]
                  :     :           :     :     :        +- SortMergeJoin [ws_item_sk#25400L, ws_order_number#25414L], [wr_item_sk#25433L, wr_order_number#25444L], Inner
                  :     :           :     :     :           :- Sort [ws_item_sk#25400L ASC NULLS FIRST, ws_order_number#25414L ASC NULLS FIRST], false, 0
                  :     :           :     :     :           :  +- Exchange hashpartitioning(ws_item_sk#25400L, ws_order_number#25414L, 3000), ENSURE_REQUIREMENTS, [id=#26470]
                  :     :           :     :     :           :     +- Project [ws_item_sk#25400L, ws_order_number#25414L, ws_quantity#25415, ws_sales_price#25418, ws_net_profit#25430, ws_sold_date_sk#25431L]
                  :     :           :     :     :           :        +- BroadcastHashJoin [ws_web_page_sk#25409L], [wp_web_page_sk#25456L], Inner, BuildRight, false
                  :     :           :     :     :           :           :- Filter ((((isnotnull(ws_item_sk#25400L) AND isnotnull(ws_order_number#25414L)) AND isnotnull(ws_web_page_sk#25409L)) AND ((((ws_sales_price#25418 >= 100.0) AND (ws_sales_price#25418 <= 150.0)) OR ((ws_sales_price#25418 >= 50.0) AND (ws_sales_price#25418 <= 100.0))) OR ((ws_sales_price#25418 >= 150.0) AND (ws_sales_price#25418 <= 200.0)))) AND ((((ws_net_profit#25430 >= 100.0) AND (ws_net_profit#25430 <= 200.0)) OR ((ws_net_profit#25430 >= 150.0) AND (ws_net_profit#25430 <= 300.0))) OR ((ws_net_profit#25430 >= 50.0) AND (ws_net_profit#25430 <= 250.0))))
                  :     :           :     :     :           :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#25400L,ws_web_page_sk#25409L,ws_order_number#25414L,ws_quantity#25415,ws_sales_price#25418,ws_net_profit#25430,ws_sold_date_sk#25431L] Batched: true, DataFilters: [isnotnull(ws_item_sk#25400L), isnotnull(ws_order_number#25414L), isnotnull(ws_web_page_sk#25409L..., Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#25431L), dynamicpruningexpression(ws_sold_date_sk#25431L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_order_number), IsNotNull(ws_web_page_sk), Or(Or(And(GreaterT..., ReadSchema: struct<ws_item_sk:bigint,ws_web_page_sk:bigint,ws_order_number:bigint,ws_quantity:int,ws_sales_pr...
                  :     :           :     :     :           :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25546, 0, true, Project [d_date_sk#25501L], [d_date_sk#25501L]
                  :     :           :     :     :           :           :           +- AdaptiveSparkPlan isFinalPlan=false
                  :     :           :     :     :           :           :              +- Project [d_date_sk#25501L]
                  :     :           :     :     :           :           :                 +- Filter ((isnotnull(d_year#25507) AND (d_year#25507 = 1998)) AND isnotnull(d_date_sk#25501L))
                  :     :           :     :     :           :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25501L,d_year#25507] Batched: true, DataFilters: [isnotnull(d_year#25507), (d_year#25507 = 1998), isnotnull(d_date_sk#25501L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :           :     :     :           :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#26465]
                  :     :           :     :     :           :              +- Filter isnotnull(wp_web_page_sk#25456L)
                  :     :           :     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#25456L] Batched: true, DataFilters: [isnotnull(wp_web_page_sk#25456L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(wp_web_page_sk)], ReadSchema: struct<wp_web_page_sk:bigint>
                  :     :           :     :     :           +- Sort [wr_item_sk#25433L ASC NULLS FIRST, wr_order_number#25444L ASC NULLS FIRST], false, 0
                  :     :           :     :     :              +- Exchange hashpartitioning(wr_item_sk#25433L, wr_order_number#25444L, 3000), ENSURE_REQUIREMENTS, [id=#26471]
                  :     :           :     :     :                 +- Project [wr_item_sk#25433L, wr_refunded_cdemo_sk#25435L, wr_refunded_addr_sk#25437L, wr_returning_cdemo_sk#25439L, wr_reason_sk#25443L, wr_order_number#25444L, wr_fee#25449, wr_refunded_cash#25451]
                  :     :           :     :     :                    +- Filter (((((isnotnull(wr_item_sk#25433L) AND isnotnull(wr_order_number#25444L)) AND isnotnull(wr_refunded_cdemo_sk#25435L)) AND isnotnull(wr_returning_cdemo_sk#25439L)) AND isnotnull(wr_refunded_addr_sk#25437L)) AND isnotnull(wr_reason_sk#25443L))
                  :     :           :     :     :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_item_sk#25433L,wr_refunded_cdemo_sk#25435L,wr_refunded_addr_sk#25437L,wr_returning_cdemo_sk#25439L,wr_reason_sk#25443L,wr_order_number#25444L,wr_fee#25449,wr_refunded_cash#25451,wr_returned_date_sk#25455L] Batched: true, DataFilters: [isnotnull(wr_item_sk#25433L), isnotnull(wr_order_number#25444L), isnotnull(wr_refunded_cdemo_sk#..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_item_sk), IsNotNull(wr_order_number), IsNotNull(wr_refunded_cdemo_sk), IsNotNull(wr..., ReadSchema: struct<wr_item_sk:bigint,wr_refunded_cdemo_sk:bigint,wr_refunded_addr_sk:bigint,wr_returning_cdem...
                  :     :           :     :     +- Sort [ca_address_sk#25488L ASC NULLS FIRST], false, 0
                  :     :           :     :        +- Exchange hashpartitioning(ca_address_sk#25488L, 3000), ENSURE_REQUIREMENTS, [id=#26479]
                  :     :           :     :           +- Project [ca_address_sk#25488L, ca_state#25496]
                  :     :           :     :              +- Filter (((isnotnull(ca_country#25498) AND (ca_country#25498 = United States)) AND isnotnull(ca_address_sk#25488L)) AND ((ca_state#25496 IN (KY,GA,NM) OR ca_state#25496 IN (MT,OR,IN)) OR ca_state#25496 IN (WI,MO,WV)))
                  :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#25488L,ca_state#25496,ca_country#25498] Batched: true, DataFilters: [isnotnull(ca_country#25498), (ca_country#25498 = United States), isnotnull(ca_address_sk#25488L)..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk), Or(Or(In(ca_..., ReadSchema: struct<ca_address_sk:bigint,ca_state:string,ca_country:string>
                  :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26485]
                  :     :           :        +- Project [d_date_sk#25501L]
                  :     :           :           +- Filter ((isnotnull(d_year#25507) AND (d_year#25507 = 1998)) AND isnotnull(d_date_sk#25501L))
                  :     :           :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25501L,d_year#25507] Batched: true, DataFilters: [isnotnull(d_year#25507), (d_year#25507 = 1998), isnotnull(d_date_sk#25501L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int>
                  :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#26489]
                  :     :              +- Filter (((isnotnull(cd_demo_sk#25470L) AND isnotnull(cd_marital_status#25472)) AND isnotnull(cd_education_status#25473)) AND ((((cd_marital_status#25472 = M) AND (cd_education_status#25473 = 4 yr Degree)) OR ((cd_marital_status#25472 = D) AND (cd_education_status#25473 = Primary))) OR ((cd_marital_status#25472 = U) AND (cd_education_status#25473 = Advanced Degree))))
                  :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25470L,cd_marital_status#25472,cd_education_status#25473] Batched: true, DataFilters: [isnotnull(cd_demo_sk#25470L), isnotnull(cd_marital_status#25472), isnotnull(cd_education_status#..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status), IsNotNull(cd_education_status), Or(Or(And(E..., ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string,cd_education_status:string>
                  :     +- Sort [cd_demo_sk#25479L ASC NULLS FIRST, cd_marital_status#25481 ASC NULLS FIRST, cd_education_status#25482 ASC NULLS FIRST], false, 0
                  :        +- Exchange hashpartitioning(cd_demo_sk#25479L, cd_marital_status#25481, cd_education_status#25482, 3000), ENSURE_REQUIREMENTS, [id=#26495]
                  :           +- Filter ((isnotnull(cd_demo_sk#25479L) AND isnotnull(cd_marital_status#25481)) AND isnotnull(cd_education_status#25482))
                  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#25479L,cd_marital_status#25481,cd_education_status#25482] Batched: true, DataFilters: [isnotnull(cd_demo_sk#25479L), isnotnull(cd_marital_status#25481), isnotnull(cd_education_status#..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status), IsNotNull(cd_education_status)], ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string,cd_education_status:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#26501]
                     +- Filter isnotnull(r_reason_sk#25529L)
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#25529L,r_reason_desc#25531] Batched: true, DataFilters: [isnotnull(r_reason_sk#25529L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_sk)], ReadSchema: struct<r_reason_sk:bigint,r_reason_desc:string>

read query: spark_queries/q86.sql
explain query: q86
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 'i_category END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true
      +- 'Aggregate [rollup(Vector(0), Vector(1), 'i_category, 'i_class)], ['sum('ws_net_paid) AS total_sum#25559, 'i_category, 'i_class, ('grouping('i_category) + 'grouping('i_class)) AS lochierarchy#25560, 'rank() windowspecdefinition(('grouping('i_category) + 'grouping('i_class)), CASE WHEN ('grouping('i_class) = 0) THEN 'i_category END, 'sum('ws_net_paid) DESC NULLS LAST, unspecifiedframe$()) AS rank_within_parent#25561]
         +- 'Filter (((('d1.d_month_seq >= 1212) AND ('d1.d_month_seq <= (1212 + 11))) AND ('d1.d_date_sk = 'ws_sold_date_sk)) AND ('i_item_sk = 'ws_item_sk))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [web_sales], [], false
               :  +- 'SubqueryAlias d1
               :     +- 'UnresolvedRelation [date_dim], [], false
               +- 'UnresolvedRelation [item], [], false

== Analyzed Logical Plan ==
total_sum: double, i_category: string, i_class: string, lochierarchy: tinyint, rank_within_parent: int
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#25560 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#25560 as int) = 0) THEN i_category#25653 END ASC NULLS FIRST, rank_within_parent#25561 ASC NULLS FIRST], true
      +- Project [total_sum#25559, i_category#25653, i_class#25654, lochierarchy#25560, rank_within_parent#25561]
         +- Project [total_sum#25559, i_category#25653, i_class#25654, lochierarchy#25560, _w0#25663, _w1#25667, _w2#25668, _w3#25669, rank_within_parent#25561, rank_within_parent#25561]
            +- Window [rank(_w3#25669) windowspecdefinition(_w1#25667, _w2#25668, _w3#25669 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#25561], [_w1#25667, _w2#25668], [_w3#25669 DESC NULLS LAST]
               +- Aggregate [i_category#25653, i_class#25654, spark_grouping_id#25652L], [sum(ws_net_paid#25592) AS total_sum#25559, i_category#25653, i_class#25654, (cast((shiftright(spark_grouping_id#25652L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint)) AS lochierarchy#25560, sum(ws_net_paid#25592) AS _w0#25663, (cast((shiftright(spark_grouping_id#25652L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint)) AS _w1#25667, CASE WHEN (cast(cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint) as int) = 0) THEN i_category#25653 END AS _w2#25668, sum(ws_net_paid#25592) AS _w3#25669]
                  +- Expand [[ws_sold_time_sk#25564L, ws_ship_date_sk#25565L, ws_item_sk#25566L, ws_bill_customer_sk#25567L, ws_bill_cdemo_sk#25568L, ws_bill_hdemo_sk#25569L, ws_bill_addr_sk#25570L, ws_ship_customer_sk#25571L, ws_ship_cdemo_sk#25572L, ws_ship_hdemo_sk#25573L, ws_ship_addr_sk#25574L, ws_web_page_sk#25575L, ws_web_site_sk#25576L, ws_ship_mode_sk#25577L, ws_warehouse_sk#25578L, ws_promo_sk#25579L, ws_order_number#25580L, ws_quantity#25581, ws_wholesale_cost#25582, ws_list_price#25583, ws_sales_price#25584, ws_ext_discount_amt#25585, ws_ext_sales_price#25586, ws_ext_wholesale_cost#25587, ... 63 more fields], [ws_sold_time_sk#25564L, ws_ship_date_sk#25565L, ws_item_sk#25566L, ws_bill_customer_sk#25567L, ws_bill_cdemo_sk#25568L, ws_bill_hdemo_sk#25569L, ws_bill_addr_sk#25570L, ws_ship_customer_sk#25571L, ws_ship_cdemo_sk#25572L, ws_ship_hdemo_sk#25573L, ws_ship_addr_sk#25574L, ws_web_page_sk#25575L, ws_web_site_sk#25576L, ws_ship_mode_sk#25577L, ws_warehouse_sk#25578L, ws_promo_sk#25579L, ws_order_number#25580L, ws_quantity#25581, ws_wholesale_cost#25582, ws_list_price#25583, ws_sales_price#25584, ws_ext_discount_amt#25585, ws_ext_sales_price#25586, ws_ext_wholesale_cost#25587, ... 63 more fields], [ws_sold_time_sk#25564L, ws_ship_date_sk#25565L, ws_item_sk#25566L, ws_bill_customer_sk#25567L, ws_bill_cdemo_sk#25568L, ws_bill_hdemo_sk#25569L, ws_bill_addr_sk#25570L, ws_ship_customer_sk#25571L, ws_ship_cdemo_sk#25572L, ws_ship_hdemo_sk#25573L, ws_ship_addr_sk#25574L, ws_web_page_sk#25575L, ws_web_site_sk#25576L, ws_ship_mode_sk#25577L, ws_warehouse_sk#25578L, ws_promo_sk#25579L, ws_order_number#25580L, ws_quantity#25581, ws_wholesale_cost#25582, ws_list_price#25583, ws_sales_price#25584, ws_ext_discount_amt#25585, ws_ext_sales_price#25586, ws_ext_wholesale_cost#25587, ... 63 more fields]], [ws_sold_time_sk#25564L, ws_ship_date_sk#25565L, ws_item_sk#25566L, ws_bill_customer_sk#25567L, ws_bill_cdemo_sk#25568L, ws_bill_hdemo_sk#25569L, ws_bill_addr_sk#25570L, ws_ship_customer_sk#25571L, ws_ship_cdemo_sk#25572L, ws_ship_hdemo_sk#25573L, ws_ship_addr_sk#25574L, ws_web_page_sk#25575L, ws_web_site_sk#25576L, ws_ship_mode_sk#25577L, ws_warehouse_sk#25578L, ws_promo_sk#25579L, ws_order_number#25580L, ws_quantity#25581, ws_wholesale_cost#25582, ws_list_price#25583, ws_sales_price#25584, ws_ext_discount_amt#25585, ws_ext_sales_price#25586, ws_ext_wholesale_cost#25587, ... 63 more fields]
                     +- Project [ws_sold_time_sk#25564L, ws_ship_date_sk#25565L, ws_item_sk#25566L, ws_bill_customer_sk#25567L, ws_bill_cdemo_sk#25568L, ws_bill_hdemo_sk#25569L, ws_bill_addr_sk#25570L, ws_ship_customer_sk#25571L, ws_ship_cdemo_sk#25572L, ws_ship_hdemo_sk#25573L, ws_ship_addr_sk#25574L, ws_web_page_sk#25575L, ws_web_site_sk#25576L, ws_ship_mode_sk#25577L, ws_warehouse_sk#25578L, ws_promo_sk#25579L, ws_order_number#25580L, ws_quantity#25581, ws_wholesale_cost#25582, ws_list_price#25583, ws_sales_price#25584, ws_ext_discount_amt#25585, ws_ext_sales_price#25586, ws_ext_wholesale_cost#25587, ... 62 more fields]
                        +- Filter ((((d_month_seq#25601 >= 1212) AND (d_month_seq#25601 <= (1212 + 11))) AND (d_date_sk#25598L = ws_sold_date_sk#25597L)) AND (i_item_sk#25626L = ws_item_sk#25566L))
                           +- Join Inner
                              :- Join Inner
                              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25564L,ws_ship_date_sk#25565L,ws_item_sk#25566L,ws_bill_customer_sk#25567L,ws_bill_cdemo_sk#25568L,ws_bill_hdemo_sk#25569L,ws_bill_addr_sk#25570L,ws_ship_customer_sk#25571L,ws_ship_cdemo_sk#25572L,ws_ship_hdemo_sk#25573L,ws_ship_addr_sk#25574L,ws_web_page_sk#25575L,ws_web_site_sk#25576L,ws_ship_mode_sk#25577L,ws_warehouse_sk#25578L,ws_promo_sk#25579L,ws_order_number#25580L,ws_quantity#25581,ws_wholesale_cost#25582,ws_list_price#25583,ws_sales_price#25584,ws_ext_discount_amt#25585,ws_ext_sales_price#25586,ws_ext_wholesale_cost#25587,... 10 more fields] orc
                              :  +- SubqueryAlias d1
                              :     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                              :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25598L,d_date_id#25599,d_date#25600,d_month_seq#25601,d_week_seq#25602,d_quarter_seq#25603,d_year#25604,d_dow#25605,d_moy#25606,d_dom#25607,d_qoy#25608,d_fy_year#25609,d_fy_quarter_seq#25610,d_fy_week_seq#25611,d_day_name#25612,d_quarter_name#25613,d_holiday#25614,d_weekend#25615,d_following_holiday#25616,d_first_dom#25617,d_last_dom#25618,d_same_day_ly#25619,d_same_day_lq#25620,d_current_day#25621,... 4 more fields] orc
                              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                 +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25626L,i_item_id#25627,i_rec_start_date#25628,i_rec_end_date#25629,i_item_desc#25630,i_current_price#25631,i_wholesale_cost#25632,i_brand_id#25633,i_brand#25634,i_class_id#25635,i_class#25636,i_category_id#25637,i_category#25638,i_manufact_id#25639,i_manufact#25640,i_size#25641,i_formulation#25642,i_color#25643,i_units#25644,i_container#25645,i_manager_id#25646,i_product_name#25647] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [lochierarchy#25560 DESC NULLS LAST, CASE WHEN (lochierarchy#25560 = 0) THEN i_category#25653 END ASC NULLS FIRST, rank_within_parent#25561 ASC NULLS FIRST], true
      +- Project [total_sum#25559, i_category#25653, i_class#25654, lochierarchy#25560, rank_within_parent#25561]
         +- Window [rank(_w3#25669) windowspecdefinition(_w1#25667, _w2#25668, _w3#25669 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#25561], [_w1#25667, _w2#25668], [_w3#25669 DESC NULLS LAST]
            +- Aggregate [i_category#25653, i_class#25654, spark_grouping_id#25652L], [sum(ws_net_paid#25592) AS total_sum#25559, i_category#25653, i_class#25654, (cast((shiftright(spark_grouping_id#25652L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint)) AS lochierarchy#25560, (cast((shiftright(spark_grouping_id#25652L, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint)) AS _w1#25667, CASE WHEN (cast((shiftright(spark_grouping_id#25652L, 0) & 1) as tinyint) = 0) THEN i_category#25653 END AS _w2#25668, sum(ws_net_paid#25592) AS _w3#25669]
               +- Expand [[ws_net_paid#25592, i_category#25638, i_class#25636, 0], [ws_net_paid#25592, i_category#25638, null, 1], [ws_net_paid#25592, null, null, 3]], [ws_net_paid#25592, i_category#25653, i_class#25654, spark_grouping_id#25652L]
                  +- Project [ws_net_paid#25592, i_category#25638, i_class#25636]
                     +- Join Inner, (i_item_sk#25626L = ws_item_sk#25566L)
                        :- Project [ws_item_sk#25566L, ws_net_paid#25592]
                        :  +- Join Inner, (d_date_sk#25598L = ws_sold_date_sk#25597L)
                        :     :- Project [ws_item_sk#25566L, ws_net_paid#25592, ws_sold_date_sk#25597L]
                        :     :  +- Filter ((isnotnull(ws_sold_date_sk#25597L) AND isnotnull(ws_item_sk#25566L)) AND dynamicpruning#25681 [ws_sold_date_sk#25597L])
                        :     :     :  +- Project [d_date_sk#25598L]
                        :     :     :     +- Filter ((isnotnull(d_month_seq#25601) AND ((d_month_seq#25601 >= 1212) AND (d_month_seq#25601 <= 1223))) AND isnotnull(d_date_sk#25598L))
                        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25598L,d_date_id#25599,d_date#25600,d_month_seq#25601,d_week_seq#25602,d_quarter_seq#25603,d_year#25604,d_dow#25605,d_moy#25606,d_dom#25607,d_qoy#25608,d_fy_year#25609,d_fy_quarter_seq#25610,d_fy_week_seq#25611,d_day_name#25612,d_quarter_name#25613,d_holiday#25614,d_weekend#25615,d_following_holiday#25616,d_first_dom#25617,d_last_dom#25618,d_same_day_ly#25619,d_same_day_lq#25620,d_current_day#25621,... 4 more fields] orc
                        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25564L,ws_ship_date_sk#25565L,ws_item_sk#25566L,ws_bill_customer_sk#25567L,ws_bill_cdemo_sk#25568L,ws_bill_hdemo_sk#25569L,ws_bill_addr_sk#25570L,ws_ship_customer_sk#25571L,ws_ship_cdemo_sk#25572L,ws_ship_hdemo_sk#25573L,ws_ship_addr_sk#25574L,ws_web_page_sk#25575L,ws_web_site_sk#25576L,ws_ship_mode_sk#25577L,ws_warehouse_sk#25578L,ws_promo_sk#25579L,ws_order_number#25580L,ws_quantity#25581,ws_wholesale_cost#25582,ws_list_price#25583,ws_sales_price#25584,ws_ext_discount_amt#25585,ws_ext_sales_price#25586,ws_ext_wholesale_cost#25587,... 10 more fields] orc
                        :     +- Project [d_date_sk#25598L]
                        :        +- Filter ((isnotnull(d_month_seq#25601) AND ((d_month_seq#25601 >= 1212) AND (d_month_seq#25601 <= 1223))) AND isnotnull(d_date_sk#25598L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25598L,d_date_id#25599,d_date#25600,d_month_seq#25601,d_week_seq#25602,d_quarter_seq#25603,d_year#25604,d_dow#25605,d_moy#25606,d_dom#25607,d_qoy#25608,d_fy_year#25609,d_fy_quarter_seq#25610,d_fy_week_seq#25611,d_day_name#25612,d_quarter_name#25613,d_holiday#25614,d_weekend#25615,d_following_holiday#25616,d_first_dom#25617,d_last_dom#25618,d_same_day_ly#25619,d_same_day_lq#25620,d_current_day#25621,... 4 more fields] orc
                        +- Project [i_item_sk#25626L, i_class#25636, i_category#25638]
                           +- Filter isnotnull(i_item_sk#25626L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25626L,i_item_id#25627,i_rec_start_date#25628,i_rec_end_date#25629,i_item_desc#25630,i_current_price#25631,i_wholesale_cost#25632,i_brand_id#25633,i_brand#25634,i_class_id#25635,i_class#25636,i_category_id#25637,i_category#25638,i_manufact_id#25639,i_manufact#25640,i_size#25641,i_formulation#25642,i_color#25643,i_units#25644,i_container#25645,i_manager_id#25646,i_product_name#25647] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#25560 DESC NULLS LAST,CASE WHEN (lochierarchy#25560 = 0) THEN i_category#25653 END ASC NULLS FIRST,rank_within_parent#25561 ASC NULLS FIRST], output=[total_sum#25559,i_category#25653,i_class#25654,lochierarchy#25560,rank_within_parent#25561])
   +- Project [total_sum#25559, i_category#25653, i_class#25654, lochierarchy#25560, rank_within_parent#25561]
      +- Window [rank(_w3#25669) windowspecdefinition(_w1#25667, _w2#25668, _w3#25669 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#25561], [_w1#25667, _w2#25668], [_w3#25669 DESC NULLS LAST]
         +- Sort [_w1#25667 ASC NULLS FIRST, _w2#25668 ASC NULLS FIRST, _w3#25669 DESC NULLS LAST], false, 0
            +- Exchange hashpartitioning(_w1#25667, _w2#25668, 3000), ENSURE_REQUIREMENTS, [id=#26617]
               +- HashAggregate(keys=[i_category#25653, i_class#25654, spark_grouping_id#25652L], functions=[sum(ws_net_paid#25592)], output=[total_sum#25559, i_category#25653, i_class#25654, lochierarchy#25560, _w1#25667, _w2#25668, _w3#25669])
                  +- Exchange hashpartitioning(i_category#25653, i_class#25654, spark_grouping_id#25652L, 3000), ENSURE_REQUIREMENTS, [id=#26614]
                     +- HashAggregate(keys=[i_category#25653, i_class#25654, spark_grouping_id#25652L], functions=[partial_sum(ws_net_paid#25592)], output=[i_category#25653, i_class#25654, spark_grouping_id#25652L, sum#25683])
                        +- Expand [[ws_net_paid#25592, i_category#25638, i_class#25636, 0], [ws_net_paid#25592, i_category#25638, null, 1], [ws_net_paid#25592, null, null, 3]], [ws_net_paid#25592, i_category#25653, i_class#25654, spark_grouping_id#25652L]
                           +- Project [ws_net_paid#25592, i_category#25638, i_class#25636]
                              +- SortMergeJoin [ws_item_sk#25566L], [i_item_sk#25626L], Inner
                                 :- Sort [ws_item_sk#25566L ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(ws_item_sk#25566L, 3000), ENSURE_REQUIREMENTS, [id=#26605]
                                 :     +- Project [ws_item_sk#25566L, ws_net_paid#25592]
                                 :        +- BroadcastHashJoin [ws_sold_date_sk#25597L], [d_date_sk#25598L], Inner, BuildRight, false
                                 :           :- Filter isnotnull(ws_item_sk#25566L)
                                 :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#25566L,ws_net_paid#25592,ws_sold_date_sk#25597L] Batched: true, DataFilters: [isnotnull(ws_item_sk#25566L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#25597L), dynamicpruningexpression(ws_sold_date_sk#25597L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_net_paid:double>
                                 :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25681, 0, true, Project [d_date_sk#25598L], [d_date_sk#25598L]
                                 :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                 :           :              +- Project [d_date_sk#25598L]
                                 :           :                 +- Filter (((isnotnull(d_month_seq#25601) AND (d_month_seq#25601 >= 1212)) AND (d_month_seq#25601 <= 1223)) AND isnotnull(d_date_sk#25598L))
                                 :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25598L,d_month_seq#25601] Batched: true, DataFilters: [isnotnull(d_month_seq#25601), (d_month_seq#25601 >= 1212), (d_month_seq#25601 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26600]
                                 :              +- Project [d_date_sk#25598L]
                                 :                 +- Filter (((isnotnull(d_month_seq#25601) AND (d_month_seq#25601 >= 1212)) AND (d_month_seq#25601 <= 1223)) AND isnotnull(d_date_sk#25598L))
                                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25598L,d_month_seq#25601] Batched: true, DataFilters: [isnotnull(d_month_seq#25601), (d_month_seq#25601 >= 1212), (d_month_seq#25601 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                 +- Sort [i_item_sk#25626L ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(i_item_sk#25626L, 3000), ENSURE_REQUIREMENTS, [id=#26606]
                                       +- Filter isnotnull(i_item_sk#25626L)
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#25626L,i_class#25636,i_category#25638] Batched: true, DataFilters: [isnotnull(i_item_sk#25626L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_class:string,i_category:string>

read query: spark_queries/q87.sql
explain query: q87
== Parsed Logical Plan ==
'Project [unresolvedalias('count(1), None)]
+- 'SubqueryAlias cool_cust
   +- 'Except false
      :- 'Except false
      :  :- 'Distinct
      :  :  +- 'Project ['c_last_name, 'c_first_name, 'd_date]
      :  :     +- 'Filter ((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) AND ('store_sales.ss_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
      :  :        +- 'Join Inner
      :  :           :- 'Join Inner
      :  :           :  :- 'UnresolvedRelation [store_sales], [], false
      :  :           :  +- 'UnresolvedRelation [date_dim], [], false
      :  :           +- 'UnresolvedRelation [customer], [], false
      :  +- 'Distinct
      :     +- 'Project ['c_last_name, 'c_first_name, 'd_date]
      :        +- 'Filter ((('catalog_sales.cs_sold_date_sk = 'date_dim.d_date_sk) AND ('catalog_sales.cs_bill_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
      :           +- 'Join Inner
      :              :- 'Join Inner
      :              :  :- 'UnresolvedRelation [catalog_sales], [], false
      :              :  +- 'UnresolvedRelation [date_dim], [], false
      :              +- 'UnresolvedRelation [customer], [], false
      +- 'Distinct
         +- 'Project ['c_last_name, 'c_first_name, 'd_date]
            +- 'Filter ((('web_sales.ws_sold_date_sk = 'date_dim.d_date_sk) AND ('web_sales.ws_bill_customer_sk = 'customer.c_customer_sk)) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'UnresolvedRelation [web_sales], [], false
                  :  +- 'UnresolvedRelation [date_dim], [], false
                  +- 'UnresolvedRelation [customer], [], false

== Analyzed Logical Plan ==
count(1): bigint
Aggregate [count(1) AS count(1)#25914L]
+- SubqueryAlias cool_cust
   +- Except false
      :- Except false
      :  :- Distinct
      :  :  +- Project [c_last_name#25745, c_first_name#25744, d_date#25710]
      :  :     +- Filter (((ss_sold_date_sk#25707L = d_date_sk#25708L) AND (ss_customer_sk#25687L = c_customer_sk#25736L)) AND ((d_month_seq#25711 >= 1212) AND (d_month_seq#25711 <= (1212 + 11))))
      :  :        +- Join Inner
      :  :           :- Join Inner
      :  :           :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
      :  :           :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#25685L,ss_item_sk#25686L,ss_customer_sk#25687L,ss_cdemo_sk#25688L,ss_hdemo_sk#25689L,ss_addr_sk#25690L,ss_store_sk#25691L,ss_promo_sk#25692L,ss_ticket_number#25693L,ss_quantity#25694,ss_wholesale_cost#25695,ss_list_price#25696,ss_sales_price#25697,ss_ext_discount_amt#25698,ss_ext_sales_price#25699,ss_ext_wholesale_cost#25700,ss_ext_list_price#25701,ss_ext_tax#25702,ss_coupon_amt#25703,ss_net_paid#25704,ss_net_paid_inc_tax#25705,ss_net_profit#25706,ss_sold_date_sk#25707L] orc
      :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
      :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25708L,d_date_id#25709,d_date#25710,d_month_seq#25711,d_week_seq#25712,d_quarter_seq#25713,d_year#25714,d_dow#25715,d_moy#25716,d_dom#25717,d_qoy#25718,d_fy_year#25719,d_fy_quarter_seq#25720,d_fy_week_seq#25721,d_day_name#25722,d_quarter_name#25723,d_holiday#25724,d_weekend#25725,d_following_holiday#25726,d_first_dom#25727,d_last_dom#25728,d_same_day_ly#25729,d_same_day_lq#25730,d_current_day#25731,... 4 more fields] orc
      :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
      :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25736L,c_customer_id#25737,c_current_cdemo_sk#25738L,c_current_hdemo_sk#25739L,c_current_addr_sk#25740L,c_first_shipto_date_sk#25741L,c_first_sales_date_sk#25742L,c_salutation#25743,c_first_name#25744,c_last_name#25745,c_preferred_cust_flag#25746,c_birth_day#25747,c_birth_month#25748,c_birth_year#25749,c_birth_country#25750,c_login#25751,c_email_address#25752,c_last_review_date#25753] orc
      :  +- Distinct
      :     +- Project [c_last_name#25825, c_first_name#25824, d_date#25790]
      :        +- Filter (((cs_sold_date_sk#25787L = d_date_sk#25788L) AND (cs_bill_customer_sk#25756L = c_customer_sk#25816L)) AND ((d_month_seq#25791 >= 1212) AND (d_month_seq#25791 <= (1212 + 11))))
      :           +- Join Inner
      :              :- Join Inner
      :              :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
      :              :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#25754L,cs_ship_date_sk#25755L,cs_bill_customer_sk#25756L,cs_bill_cdemo_sk#25757L,cs_bill_hdemo_sk#25758L,cs_bill_addr_sk#25759L,cs_ship_customer_sk#25760L,cs_ship_cdemo_sk#25761L,cs_ship_hdemo_sk#25762L,cs_ship_addr_sk#25763L,cs_call_center_sk#25764L,cs_catalog_page_sk#25765L,cs_ship_mode_sk#25766L,cs_warehouse_sk#25767L,cs_item_sk#25768L,cs_promo_sk#25769L,cs_order_number#25770L,cs_quantity#25771,cs_wholesale_cost#25772,cs_list_price#25773,cs_sales_price#25774,cs_ext_discount_amt#25775,cs_ext_sales_price#25776,cs_ext_wholesale_cost#25777,... 10 more fields] orc
      :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
      :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25788L,d_date_id#25789,d_date#25790,d_month_seq#25791,d_week_seq#25792,d_quarter_seq#25793,d_year#25794,d_dow#25795,d_moy#25796,d_dom#25797,d_qoy#25798,d_fy_year#25799,d_fy_quarter_seq#25800,d_fy_week_seq#25801,d_day_name#25802,d_quarter_name#25803,d_holiday#25804,d_weekend#25805,d_following_holiday#25806,d_first_dom#25807,d_last_dom#25808,d_same_day_ly#25809,d_same_day_lq#25810,d_current_day#25811,... 4 more fields] orc
      :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
      :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25816L,c_customer_id#25817,c_current_cdemo_sk#25818L,c_current_hdemo_sk#25819L,c_current_addr_sk#25820L,c_first_shipto_date_sk#25821L,c_first_sales_date_sk#25822L,c_salutation#25823,c_first_name#25824,c_last_name#25825,c_preferred_cust_flag#25826,c_birth_day#25827,c_birth_month#25828,c_birth_year#25829,c_birth_country#25830,c_login#25831,c_email_address#25832,c_last_review_date#25833] orc
      +- Distinct
         +- Project [c_last_name#25905, c_first_name#25904, d_date#25870]
            +- Filter (((ws_sold_date_sk#25867L = d_date_sk#25868L) AND (ws_bill_customer_sk#25837L = c_customer_sk#25896L)) AND ((d_month_seq#25871 >= 1212) AND (d_month_seq#25871 <= (1212 + 11))))
               +- Join Inner
                  :- Join Inner
                  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25834L,ws_ship_date_sk#25835L,ws_item_sk#25836L,ws_bill_customer_sk#25837L,ws_bill_cdemo_sk#25838L,ws_bill_hdemo_sk#25839L,ws_bill_addr_sk#25840L,ws_ship_customer_sk#25841L,ws_ship_cdemo_sk#25842L,ws_ship_hdemo_sk#25843L,ws_ship_addr_sk#25844L,ws_web_page_sk#25845L,ws_web_site_sk#25846L,ws_ship_mode_sk#25847L,ws_warehouse_sk#25848L,ws_promo_sk#25849L,ws_order_number#25850L,ws_quantity#25851,ws_wholesale_cost#25852,ws_list_price#25853,ws_sales_price#25854,ws_ext_discount_amt#25855,ws_ext_sales_price#25856,ws_ext_wholesale_cost#25857,... 10 more fields] orc
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25868L,d_date_id#25869,d_date#25870,d_month_seq#25871,d_week_seq#25872,d_quarter_seq#25873,d_year#25874,d_dow#25875,d_moy#25876,d_dom#25877,d_qoy#25878,d_fy_year#25879,d_fy_quarter_seq#25880,d_fy_week_seq#25881,d_day_name#25882,d_quarter_name#25883,d_holiday#25884,d_weekend#25885,d_following_holiday#25886,d_first_dom#25887,d_last_dom#25888,d_same_day_ly#25889,d_same_day_lq#25890,d_current_day#25891,... 4 more fields] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25896L,c_customer_id#25897,c_current_cdemo_sk#25898L,c_current_hdemo_sk#25899L,c_current_addr_sk#25900L,c_first_shipto_date_sk#25901L,c_first_sales_date_sk#25902L,c_salutation#25903,c_first_name#25904,c_last_name#25905,c_preferred_cust_flag#25906,c_birth_day#25907,c_birth_month#25908,c_birth_year#25909,c_birth_country#25910,c_login#25911,c_email_address#25912,c_last_review_date#25913] orc

== Optimized Logical Plan ==
Aggregate [count(1) AS count(1)#25914L]
+- Aggregate [c_last_name#25745, c_first_name#25744, d_date#25710]
   +- Join LeftAnti, (((c_last_name#25745 <=> c_last_name#25905) AND (c_first_name#25744 <=> c_first_name#25904)) AND (d_date#25710 <=> d_date#25870))
      :- Aggregate [c_last_name#25745, c_first_name#25744, d_date#25710], [c_last_name#25745, c_first_name#25744, d_date#25710]
      :  +- Join LeftAnti, (((c_last_name#25745 <=> c_last_name#25825) AND (c_first_name#25744 <=> c_first_name#25824)) AND (d_date#25710 <=> d_date#25790))
      :     :- Aggregate [c_last_name#25745, c_first_name#25744, d_date#25710], [c_last_name#25745, c_first_name#25744, d_date#25710]
      :     :  +- Project [c_last_name#25745, c_first_name#25744, d_date#25710]
      :     :     +- Join Inner, (ss_customer_sk#25687L = c_customer_sk#25736L)
      :     :        :- Project [ss_customer_sk#25687L, d_date#25710]
      :     :        :  +- Join Inner, (ss_sold_date_sk#25707L = d_date_sk#25708L)
      :     :        :     :- Project [ss_customer_sk#25687L, ss_sold_date_sk#25707L]
      :     :        :     :  +- Filter ((isnotnull(ss_sold_date_sk#25707L) AND isnotnull(ss_customer_sk#25687L)) AND dynamicpruning#25916 [ss_sold_date_sk#25707L])
      :     :        :     :     :  +- Project [d_date_sk#25708L, d_date#25710]
      :     :        :     :     :     +- Filter ((isnotnull(d_month_seq#25711) AND ((d_month_seq#25711 >= 1212) AND (d_month_seq#25711 <= 1223))) AND isnotnull(d_date_sk#25708L))
      :     :        :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25708L,d_date_id#25709,d_date#25710,d_month_seq#25711,d_week_seq#25712,d_quarter_seq#25713,d_year#25714,d_dow#25715,d_moy#25716,d_dom#25717,d_qoy#25718,d_fy_year#25719,d_fy_quarter_seq#25720,d_fy_week_seq#25721,d_day_name#25722,d_quarter_name#25723,d_holiday#25724,d_weekend#25725,d_following_holiday#25726,d_first_dom#25727,d_last_dom#25728,d_same_day_ly#25729,d_same_day_lq#25730,d_current_day#25731,... 4 more fields] orc
      :     :        :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#25685L,ss_item_sk#25686L,ss_customer_sk#25687L,ss_cdemo_sk#25688L,ss_hdemo_sk#25689L,ss_addr_sk#25690L,ss_store_sk#25691L,ss_promo_sk#25692L,ss_ticket_number#25693L,ss_quantity#25694,ss_wholesale_cost#25695,ss_list_price#25696,ss_sales_price#25697,ss_ext_discount_amt#25698,ss_ext_sales_price#25699,ss_ext_wholesale_cost#25700,ss_ext_list_price#25701,ss_ext_tax#25702,ss_coupon_amt#25703,ss_net_paid#25704,ss_net_paid_inc_tax#25705,ss_net_profit#25706,ss_sold_date_sk#25707L] orc
      :     :        :     +- Project [d_date_sk#25708L, d_date#25710]
      :     :        :        +- Filter ((isnotnull(d_month_seq#25711) AND ((d_month_seq#25711 >= 1212) AND (d_month_seq#25711 <= 1223))) AND isnotnull(d_date_sk#25708L))
      :     :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25708L,d_date_id#25709,d_date#25710,d_month_seq#25711,d_week_seq#25712,d_quarter_seq#25713,d_year#25714,d_dow#25715,d_moy#25716,d_dom#25717,d_qoy#25718,d_fy_year#25719,d_fy_quarter_seq#25720,d_fy_week_seq#25721,d_day_name#25722,d_quarter_name#25723,d_holiday#25724,d_weekend#25725,d_following_holiday#25726,d_first_dom#25727,d_last_dom#25728,d_same_day_ly#25729,d_same_day_lq#25730,d_current_day#25731,... 4 more fields] orc
      :     :        +- Project [c_customer_sk#25736L, c_first_name#25744, c_last_name#25745]
      :     :           +- Filter isnotnull(c_customer_sk#25736L)
      :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25736L,c_customer_id#25737,c_current_cdemo_sk#25738L,c_current_hdemo_sk#25739L,c_current_addr_sk#25740L,c_first_shipto_date_sk#25741L,c_first_sales_date_sk#25742L,c_salutation#25743,c_first_name#25744,c_last_name#25745,c_preferred_cust_flag#25746,c_birth_day#25747,c_birth_month#25748,c_birth_year#25749,c_birth_country#25750,c_login#25751,c_email_address#25752,c_last_review_date#25753] orc
      :     +- Aggregate [c_last_name#25825, c_first_name#25824, d_date#25790], [c_last_name#25825, c_first_name#25824, d_date#25790]
      :        +- Project [c_last_name#25825, c_first_name#25824, d_date#25790]
      :           +- Join Inner, (cs_bill_customer_sk#25756L = c_customer_sk#25816L)
      :              :- Project [cs_bill_customer_sk#25756L, d_date#25790]
      :              :  +- Join Inner, (cs_sold_date_sk#25787L = d_date_sk#25788L)
      :              :     :- Project [cs_bill_customer_sk#25756L, cs_sold_date_sk#25787L]
      :              :     :  +- Filter ((isnotnull(cs_sold_date_sk#25787L) AND isnotnull(cs_bill_customer_sk#25756L)) AND dynamicpruning#25917 [cs_sold_date_sk#25787L])
      :              :     :     :  +- Project [d_date_sk#25788L, d_date#25790]
      :              :     :     :     +- Filter ((isnotnull(d_month_seq#25791) AND ((d_month_seq#25791 >= 1212) AND (d_month_seq#25791 <= 1223))) AND isnotnull(d_date_sk#25788L))
      :              :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25788L,d_date_id#25789,d_date#25790,d_month_seq#25791,d_week_seq#25792,d_quarter_seq#25793,d_year#25794,d_dow#25795,d_moy#25796,d_dom#25797,d_qoy#25798,d_fy_year#25799,d_fy_quarter_seq#25800,d_fy_week_seq#25801,d_day_name#25802,d_quarter_name#25803,d_holiday#25804,d_weekend#25805,d_following_holiday#25806,d_first_dom#25807,d_last_dom#25808,d_same_day_ly#25809,d_same_day_lq#25810,d_current_day#25811,... 4 more fields] orc
      :              :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#25754L,cs_ship_date_sk#25755L,cs_bill_customer_sk#25756L,cs_bill_cdemo_sk#25757L,cs_bill_hdemo_sk#25758L,cs_bill_addr_sk#25759L,cs_ship_customer_sk#25760L,cs_ship_cdemo_sk#25761L,cs_ship_hdemo_sk#25762L,cs_ship_addr_sk#25763L,cs_call_center_sk#25764L,cs_catalog_page_sk#25765L,cs_ship_mode_sk#25766L,cs_warehouse_sk#25767L,cs_item_sk#25768L,cs_promo_sk#25769L,cs_order_number#25770L,cs_quantity#25771,cs_wholesale_cost#25772,cs_list_price#25773,cs_sales_price#25774,cs_ext_discount_amt#25775,cs_ext_sales_price#25776,cs_ext_wholesale_cost#25777,... 10 more fields] orc
      :              :     +- Project [d_date_sk#25788L, d_date#25790]
      :              :        +- Filter ((isnotnull(d_month_seq#25791) AND ((d_month_seq#25791 >= 1212) AND (d_month_seq#25791 <= 1223))) AND isnotnull(d_date_sk#25788L))
      :              :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25788L,d_date_id#25789,d_date#25790,d_month_seq#25791,d_week_seq#25792,d_quarter_seq#25793,d_year#25794,d_dow#25795,d_moy#25796,d_dom#25797,d_qoy#25798,d_fy_year#25799,d_fy_quarter_seq#25800,d_fy_week_seq#25801,d_day_name#25802,d_quarter_name#25803,d_holiday#25804,d_weekend#25805,d_following_holiday#25806,d_first_dom#25807,d_last_dom#25808,d_same_day_ly#25809,d_same_day_lq#25810,d_current_day#25811,... 4 more fields] orc
      :              +- Project [c_customer_sk#25816L, c_first_name#25824, c_last_name#25825]
      :                 +- Filter isnotnull(c_customer_sk#25816L)
      :                    +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25816L,c_customer_id#25817,c_current_cdemo_sk#25818L,c_current_hdemo_sk#25819L,c_current_addr_sk#25820L,c_first_shipto_date_sk#25821L,c_first_sales_date_sk#25822L,c_salutation#25823,c_first_name#25824,c_last_name#25825,c_preferred_cust_flag#25826,c_birth_day#25827,c_birth_month#25828,c_birth_year#25829,c_birth_country#25830,c_login#25831,c_email_address#25832,c_last_review_date#25833] orc
      +- Aggregate [c_last_name#25905, c_first_name#25904, d_date#25870], [c_last_name#25905, c_first_name#25904, d_date#25870]
         +- Project [c_last_name#25905, c_first_name#25904, d_date#25870]
            +- Join Inner, (ws_bill_customer_sk#25837L = c_customer_sk#25896L)
               :- Project [ws_bill_customer_sk#25837L, d_date#25870]
               :  +- Join Inner, (ws_sold_date_sk#25867L = d_date_sk#25868L)
               :     :- Project [ws_bill_customer_sk#25837L, ws_sold_date_sk#25867L]
               :     :  +- Filter ((isnotnull(ws_sold_date_sk#25867L) AND isnotnull(ws_bill_customer_sk#25837L)) AND dynamicpruning#25918 [ws_sold_date_sk#25867L])
               :     :     :  +- Project [d_date_sk#25868L, d_date#25870]
               :     :     :     +- Filter ((isnotnull(d_month_seq#25871) AND ((d_month_seq#25871 >= 1212) AND (d_month_seq#25871 <= 1223))) AND isnotnull(d_date_sk#25868L))
               :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25868L,d_date_id#25869,d_date#25870,d_month_seq#25871,d_week_seq#25872,d_quarter_seq#25873,d_year#25874,d_dow#25875,d_moy#25876,d_dom#25877,d_qoy#25878,d_fy_year#25879,d_fy_quarter_seq#25880,d_fy_week_seq#25881,d_day_name#25882,d_quarter_name#25883,d_holiday#25884,d_weekend#25885,d_following_holiday#25886,d_first_dom#25887,d_last_dom#25888,d_same_day_ly#25889,d_same_day_lq#25890,d_current_day#25891,... 4 more fields] orc
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#25834L,ws_ship_date_sk#25835L,ws_item_sk#25836L,ws_bill_customer_sk#25837L,ws_bill_cdemo_sk#25838L,ws_bill_hdemo_sk#25839L,ws_bill_addr_sk#25840L,ws_ship_customer_sk#25841L,ws_ship_cdemo_sk#25842L,ws_ship_hdemo_sk#25843L,ws_ship_addr_sk#25844L,ws_web_page_sk#25845L,ws_web_site_sk#25846L,ws_ship_mode_sk#25847L,ws_warehouse_sk#25848L,ws_promo_sk#25849L,ws_order_number#25850L,ws_quantity#25851,ws_wholesale_cost#25852,ws_list_price#25853,ws_sales_price#25854,ws_ext_discount_amt#25855,ws_ext_sales_price#25856,ws_ext_wholesale_cost#25857,... 10 more fields] orc
               :     +- Project [d_date_sk#25868L, d_date#25870]
               :        +- Filter ((isnotnull(d_month_seq#25871) AND ((d_month_seq#25871 >= 1212) AND (d_month_seq#25871 <= 1223))) AND isnotnull(d_date_sk#25868L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25868L,d_date_id#25869,d_date#25870,d_month_seq#25871,d_week_seq#25872,d_quarter_seq#25873,d_year#25874,d_dow#25875,d_moy#25876,d_dom#25877,d_qoy#25878,d_fy_year#25879,d_fy_quarter_seq#25880,d_fy_week_seq#25881,d_day_name#25882,d_quarter_name#25883,d_holiday#25884,d_weekend#25885,d_following_holiday#25886,d_first_dom#25887,d_last_dom#25888,d_same_day_ly#25889,d_same_day_lq#25890,d_current_day#25891,... 4 more fields] orc
               +- Project [c_customer_sk#25896L, c_first_name#25904, c_last_name#25905]
                  +- Filter isnotnull(c_customer_sk#25896L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25896L,c_customer_id#25897,c_current_cdemo_sk#25898L,c_current_hdemo_sk#25899L,c_current_addr_sk#25900L,c_first_shipto_date_sk#25901L,c_first_sales_date_sk#25902L,c_salutation#25903,c_first_name#25904,c_last_name#25905,c_preferred_cust_flag#25906,c_birth_day#25907,c_birth_month#25908,c_birth_year#25909,c_birth_country#25910,c_login#25911,c_email_address#25912,c_last_review_date#25913] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#25914L])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#26940]
      +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#25920L])
         +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[])
            +- Exchange hashpartitioning(c_last_name#25745, c_first_name#25744, d_date#25710, 3000), ENSURE_REQUIREMENTS, [id=#26936]
               +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[c_last_name#25745, c_first_name#25744, d_date#25710])
                  +- SortMergeJoin [coalesce(c_last_name#25745, ), isnull(c_last_name#25745), coalesce(c_first_name#25744, ), isnull(c_first_name#25744), coalesce(d_date#25710, 1970-01-01), isnull(d_date#25710)], [coalesce(c_last_name#25905, ), isnull(c_last_name#25905), coalesce(c_first_name#25904, ), isnull(c_first_name#25904), coalesce(d_date#25870, 1970-01-01), isnull(d_date#25870)], LeftAnti
                     :- Sort [coalesce(c_last_name#25745, ) ASC NULLS FIRST, isnull(c_last_name#25745) ASC NULLS FIRST, coalesce(c_first_name#25744, ) ASC NULLS FIRST, isnull(c_first_name#25744) ASC NULLS FIRST, coalesce(d_date#25710, 1970-01-01) ASC NULLS FIRST, isnull(d_date#25710) ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(coalesce(c_last_name#25745, ), isnull(c_last_name#25745), coalesce(c_first_name#25744, ), isnull(c_first_name#25744), coalesce(d_date#25710, 1970-01-01), isnull(d_date#25710), 3000), ENSURE_REQUIREMENTS, [id=#26929]
                     :     +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[c_last_name#25745, c_first_name#25744, d_date#25710])
                     :        +- Exchange hashpartitioning(c_last_name#25745, c_first_name#25744, d_date#25710, 3000), ENSURE_REQUIREMENTS, [id=#26910]
                     :           +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[c_last_name#25745, c_first_name#25744, d_date#25710])
                     :              +- SortMergeJoin [coalesce(c_last_name#25745, ), isnull(c_last_name#25745), coalesce(c_first_name#25744, ), isnull(c_first_name#25744), coalesce(d_date#25710, 1970-01-01), isnull(d_date#25710)], [coalesce(c_last_name#25825, ), isnull(c_last_name#25825), coalesce(c_first_name#25824, ), isnull(c_first_name#25824), coalesce(d_date#25790, 1970-01-01), isnull(d_date#25790)], LeftAnti
                     :                 :- Sort [coalesce(c_last_name#25745, ) ASC NULLS FIRST, isnull(c_last_name#25745) ASC NULLS FIRST, coalesce(c_first_name#25744, ) ASC NULLS FIRST, isnull(c_first_name#25744) ASC NULLS FIRST, coalesce(d_date#25710, 1970-01-01) ASC NULLS FIRST, isnull(d_date#25710) ASC NULLS FIRST], false, 0
                     :                 :  +- Exchange hashpartitioning(coalesce(c_last_name#25745, ), isnull(c_last_name#25745), coalesce(c_first_name#25744, ), isnull(c_first_name#25744), coalesce(d_date#25710, 1970-01-01), isnull(d_date#25710), 3000), ENSURE_REQUIREMENTS, [id=#26903]
                     :                 :     +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[c_last_name#25745, c_first_name#25744, d_date#25710])
                     :                 :        +- Exchange hashpartitioning(c_last_name#25745, c_first_name#25744, d_date#25710, 3000), ENSURE_REQUIREMENTS, [id=#26884]
                     :                 :           +- HashAggregate(keys=[c_last_name#25745, c_first_name#25744, d_date#25710], functions=[], output=[c_last_name#25745, c_first_name#25744, d_date#25710])
                     :                 :              +- Project [c_last_name#25745, c_first_name#25744, d_date#25710]
                     :                 :                 +- SortMergeJoin [ss_customer_sk#25687L], [c_customer_sk#25736L], Inner
                     :                 :                    :- Sort [ss_customer_sk#25687L ASC NULLS FIRST], false, 0
                     :                 :                    :  +- Exchange hashpartitioning(ss_customer_sk#25687L, 3000), ENSURE_REQUIREMENTS, [id=#26876]
                     :                 :                    :     +- Project [ss_customer_sk#25687L, d_date#25710]
                     :                 :                    :        +- BroadcastHashJoin [ss_sold_date_sk#25707L], [d_date_sk#25708L], Inner, BuildRight, false
                     :                 :                    :           :- Filter isnotnull(ss_customer_sk#25687L)
                     :                 :                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_customer_sk#25687L,ss_sold_date_sk#25707L] Batched: true, DataFilters: [isnotnull(ss_customer_sk#25687L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#25707L), dynamicpruningexpression(ss_sold_date_sk#25707L IN dynamicpru..., PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:bigint>
                     :                 :                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25916, 0, true, Project [d_date_sk#25708L, d_date#25710], [d_date_sk#25708L]
                     :                 :                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                 :                    :           :              +- Project [d_date_sk#25708L, d_date#25710]
                     :                 :                    :           :                 +- Filter (((isnotnull(d_month_seq#25711) AND (d_month_seq#25711 >= 1212)) AND (d_month_seq#25711 <= 1223)) AND isnotnull(d_date_sk#25708L))
                     :                 :                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25708L,d_date#25710,d_month_seq#25711] Batched: true, DataFilters: [isnotnull(d_month_seq#25711), (d_month_seq#25711 >= 1212), (d_month_seq#25711 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                 :                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26871]
                     :                 :                    :              +- Project [d_date_sk#25708L, d_date#25710]
                     :                 :                    :                 +- Filter (((isnotnull(d_month_seq#25711) AND (d_month_seq#25711 >= 1212)) AND (d_month_seq#25711 <= 1223)) AND isnotnull(d_date_sk#25708L))
                     :                 :                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25708L,d_date#25710,d_month_seq#25711] Batched: true, DataFilters: [isnotnull(d_month_seq#25711), (d_month_seq#25711 >= 1212), (d_month_seq#25711 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                 :                    +- Sort [c_customer_sk#25736L ASC NULLS FIRST], false, 0
                     :                 :                       +- Exchange hashpartitioning(c_customer_sk#25736L, 3000), ENSURE_REQUIREMENTS, [id=#26877]
                     :                 :                          +- Filter isnotnull(c_customer_sk#25736L)
                     :                 :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25736L,c_first_name#25744,c_last_name#25745] Batched: true, DataFilters: [isnotnull(c_customer_sk#25736L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
                     :                 +- Sort [coalesce(c_last_name#25825, ) ASC NULLS FIRST, isnull(c_last_name#25825) ASC NULLS FIRST, coalesce(c_first_name#25824, ) ASC NULLS FIRST, isnull(c_first_name#25824) ASC NULLS FIRST, coalesce(d_date#25790, 1970-01-01) ASC NULLS FIRST, isnull(d_date#25790) ASC NULLS FIRST], false, 0
                     :                    +- Exchange hashpartitioning(coalesce(c_last_name#25825, ), isnull(c_last_name#25825), coalesce(c_first_name#25824, ), isnull(c_first_name#25824), coalesce(d_date#25790, 1970-01-01), isnull(d_date#25790), 3000), ENSURE_REQUIREMENTS, [id=#26904]
                     :                       +- HashAggregate(keys=[c_last_name#25825, c_first_name#25824, d_date#25790], functions=[], output=[c_last_name#25825, c_first_name#25824, d_date#25790])
                     :                          +- Exchange hashpartitioning(c_last_name#25825, c_first_name#25824, d_date#25790, 3000), ENSURE_REQUIREMENTS, [id=#26899]
                     :                             +- HashAggregate(keys=[c_last_name#25825, c_first_name#25824, d_date#25790], functions=[], output=[c_last_name#25825, c_first_name#25824, d_date#25790])
                     :                                +- Project [c_last_name#25825, c_first_name#25824, d_date#25790]
                     :                                   +- SortMergeJoin [cs_bill_customer_sk#25756L], [c_customer_sk#25816L], Inner
                     :                                      :- Sort [cs_bill_customer_sk#25756L ASC NULLS FIRST], false, 0
                     :                                      :  +- Exchange hashpartitioning(cs_bill_customer_sk#25756L, 3000), ENSURE_REQUIREMENTS, [id=#26891]
                     :                                      :     +- Project [cs_bill_customer_sk#25756L, d_date#25790]
                     :                                      :        +- BroadcastHashJoin [cs_sold_date_sk#25787L], [d_date_sk#25788L], Inner, BuildRight, false
                     :                                      :           :- Filter isnotnull(cs_bill_customer_sk#25756L)
                     :                                      :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#25756L,cs_sold_date_sk#25787L] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#25756L)], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#25787L), dynamicpruningexpression(cs_sold_date_sk#25787L IN dynamicpru..., PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:bigint>
                     :                                      :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25917, 0, true, Project [d_date_sk#25788L, d_date#25790], [d_date_sk#25788L]
                     :                                      :           :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                                      :           :              +- Project [d_date_sk#25788L, d_date#25790]
                     :                                      :           :                 +- Filter (((isnotnull(d_month_seq#25791) AND (d_month_seq#25791 >= 1212)) AND (d_month_seq#25791 <= 1223)) AND isnotnull(d_date_sk#25788L))
                     :                                      :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25788L,d_date#25790,d_month_seq#25791] Batched: true, DataFilters: [isnotnull(d_month_seq#25791), (d_month_seq#25791 >= 1212), (d_month_seq#25791 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                                      :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26886]
                     :                                      :              +- Project [d_date_sk#25788L, d_date#25790]
                     :                                      :                 +- Filter (((isnotnull(d_month_seq#25791) AND (d_month_seq#25791 >= 1212)) AND (d_month_seq#25791 <= 1223)) AND isnotnull(d_date_sk#25788L))
                     :                                      :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25788L,d_date#25790,d_month_seq#25791] Batched: true, DataFilters: [isnotnull(d_month_seq#25791), (d_month_seq#25791 >= 1212), (d_month_seq#25791 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                     :                                      +- Sort [c_customer_sk#25816L ASC NULLS FIRST], false, 0
                     :                                         +- Exchange hashpartitioning(c_customer_sk#25816L, 3000), ENSURE_REQUIREMENTS, [id=#26892]
                     :                                            +- Filter isnotnull(c_customer_sk#25816L)
                     :                                               +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25816L,c_first_name#25824,c_last_name#25825] Batched: true, DataFilters: [isnotnull(c_customer_sk#25816L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>
                     +- Sort [coalesce(c_last_name#25905, ) ASC NULLS FIRST, isnull(c_last_name#25905) ASC NULLS FIRST, coalesce(c_first_name#25904, ) ASC NULLS FIRST, isnull(c_first_name#25904) ASC NULLS FIRST, coalesce(d_date#25870, 1970-01-01) ASC NULLS FIRST, isnull(d_date#25870) ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(coalesce(c_last_name#25905, ), isnull(c_last_name#25905), coalesce(c_first_name#25904, ), isnull(c_first_name#25904), coalesce(d_date#25870, 1970-01-01), isnull(d_date#25870), 3000), ENSURE_REQUIREMENTS, [id=#26930]
                           +- HashAggregate(keys=[c_last_name#25905, c_first_name#25904, d_date#25870], functions=[], output=[c_last_name#25905, c_first_name#25904, d_date#25870])
                              +- Exchange hashpartitioning(c_last_name#25905, c_first_name#25904, d_date#25870, 3000), ENSURE_REQUIREMENTS, [id=#26925]
                                 +- HashAggregate(keys=[c_last_name#25905, c_first_name#25904, d_date#25870], functions=[], output=[c_last_name#25905, c_first_name#25904, d_date#25870])
                                    +- Project [c_last_name#25905, c_first_name#25904, d_date#25870]
                                       +- SortMergeJoin [ws_bill_customer_sk#25837L], [c_customer_sk#25896L], Inner
                                          :- Sort [ws_bill_customer_sk#25837L ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(ws_bill_customer_sk#25837L, 3000), ENSURE_REQUIREMENTS, [id=#26917]
                                          :     +- Project [ws_bill_customer_sk#25837L, d_date#25870]
                                          :        +- BroadcastHashJoin [ws_sold_date_sk#25867L], [d_date_sk#25868L], Inner, BuildRight, false
                                          :           :- Filter isnotnull(ws_bill_customer_sk#25837L)
                                          :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_bill_customer_sk#25837L,ws_sold_date_sk#25867L] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#25837L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#25867L), dynamicpruningexpression(ws_sold_date_sk#25867L IN dynamicpru..., PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:bigint>
                                          :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#25918, 0, true, Project [d_date_sk#25868L, d_date#25870], [d_date_sk#25868L]
                                          :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                          :           :              +- Project [d_date_sk#25868L, d_date#25870]
                                          :           :                 +- Filter (((isnotnull(d_month_seq#25871) AND (d_month_seq#25871 >= 1212)) AND (d_month_seq#25871 <= 1223)) AND isnotnull(d_date_sk#25868L))
                                          :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25868L,d_date#25870,d_month_seq#25871] Batched: true, DataFilters: [isnotnull(d_month_seq#25871), (d_month_seq#25871 >= 1212), (d_month_seq#25871 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#26912]
                                          :              +- Project [d_date_sk#25868L, d_date#25870]
                                          :                 +- Filter (((isnotnull(d_month_seq#25871) AND (d_month_seq#25871 >= 1212)) AND (d_month_seq#25871 <= 1223)) AND isnotnull(d_date_sk#25868L))
                                          :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#25868L,d_date#25870,d_month_seq#25871] Batched: true, DataFilters: [isnotnull(d_month_seq#25871), (d_month_seq#25871 >= 1212), (d_month_seq#25871 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_date:date,d_month_seq:int>
                                          +- Sort [c_customer_sk#25896L ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(c_customer_sk#25896L, 3000), ENSURE_REQUIREMENTS, [id=#26918]
                                                +- Filter isnotnull(c_customer_sk#25896L)
                                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#25896L,c_first_name#25904,c_last_name#25905] Batched: true, DataFilters: [isnotnull(c_customer_sk#25896L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:bigint,c_first_name:string,c_last_name:string>

read query: spark_queries/q88.sql
explain query: q88
== Parsed Logical Plan ==
'Project [*]
+- 'Join Inner
   :- 'Join Inner
   :  :- 'Join Inner
   :  :  :- 'Join Inner
   :  :  :  :- 'Join Inner
   :  :  :  :  :- 'Join Inner
   :  :  :  :  :  :- 'Join Inner
   :  :  :  :  :  :  :- 'SubqueryAlias s1
   :  :  :  :  :  :  :  +- 'Project ['count(1) AS h8_30_to_9#25921]
   :  :  :  :  :  :  :     +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 8))) AND ((('time_dim.t_minute >= 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :  :  :  :  :  :        +- 'Join Inner
   :  :  :  :  :  :  :           :- 'Join Inner
   :  :  :  :  :  :  :           :  :- 'Join Inner
   :  :  :  :  :  :  :           :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :  :  :  :  :  :           :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :  :  :  :  :  :           :  +- 'UnresolvedRelation [time_dim], [], false
   :  :  :  :  :  :  :           +- 'UnresolvedRelation [store], [], false
   :  :  :  :  :  :  +- 'SubqueryAlias s2
   :  :  :  :  :  :     +- 'Project ['count(1) AS h9_to_9_30#25922]
   :  :  :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 9))) AND ((('time_dim.t_minute < 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :  :  :  :  :           +- 'Join Inner
   :  :  :  :  :  :              :- 'Join Inner
   :  :  :  :  :  :              :  :- 'Join Inner
   :  :  :  :  :  :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :  :  :  :  :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :  :  :  :  :              :  +- 'UnresolvedRelation [time_dim], [], false
   :  :  :  :  :  :              +- 'UnresolvedRelation [store], [], false
   :  :  :  :  :  +- 'SubqueryAlias s3
   :  :  :  :  :     +- 'Project ['count(1) AS h9_30_to_10#25923]
   :  :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 9))) AND ((('time_dim.t_minute >= 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :  :  :  :           +- 'Join Inner
   :  :  :  :  :              :- 'Join Inner
   :  :  :  :  :              :  :- 'Join Inner
   :  :  :  :  :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :  :  :  :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :  :  :  :              :  +- 'UnresolvedRelation [time_dim], [], false
   :  :  :  :  :              +- 'UnresolvedRelation [store], [], false
   :  :  :  :  +- 'SubqueryAlias s4
   :  :  :  :     +- 'Project ['count(1) AS h10_to_10_30#25924]
   :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 10))) AND ((('time_dim.t_minute < 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :  :  :           +- 'Join Inner
   :  :  :  :              :- 'Join Inner
   :  :  :  :              :  :- 'Join Inner
   :  :  :  :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :  :  :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :  :  :              :  +- 'UnresolvedRelation [time_dim], [], false
   :  :  :  :              +- 'UnresolvedRelation [store], [], false
   :  :  :  +- 'SubqueryAlias s5
   :  :  :     +- 'Project ['count(1) AS h10_30_to_11#25925]
   :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 10))) AND ((('time_dim.t_minute >= 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :  :           +- 'Join Inner
   :  :  :              :- 'Join Inner
   :  :  :              :  :- 'Join Inner
   :  :  :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :  :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :  :              :  +- 'UnresolvedRelation [time_dim], [], false
   :  :  :              +- 'UnresolvedRelation [store], [], false
   :  :  +- 'SubqueryAlias s6
   :  :     +- 'Project ['count(1) AS h11_to_11_30#25926]
   :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 11))) AND ((('time_dim.t_minute < 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :  :           +- 'Join Inner
   :  :              :- 'Join Inner
   :  :              :  :- 'Join Inner
   :  :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :  :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :  :              :  +- 'UnresolvedRelation [time_dim], [], false
   :  :              +- 'UnresolvedRelation [store], [], false
   :  +- 'SubqueryAlias s7
   :     +- 'Project ['count(1) AS h11_30_to_12#25927]
   :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 11))) AND ((('time_dim.t_minute >= 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
   :           +- 'Join Inner
   :              :- 'Join Inner
   :              :  :- 'Join Inner
   :              :  :  :- 'UnresolvedRelation [store_sales], [], false
   :              :  :  +- 'UnresolvedRelation [household_demographics], [], false
   :              :  +- 'UnresolvedRelation [time_dim], [], false
   :              +- 'UnresolvedRelation [store], [], false
   +- 'SubqueryAlias s8
      +- 'Project ['count(1) AS h12_to_12_30#25928]
         +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 12))) AND ((('time_dim.t_minute < 30) AND (((('household_demographics.hd_dep_count = 3) AND ('household_demographics.hd_vehicle_count <= (3 + 2))) OR (('household_demographics.hd_dep_count = 0) AND ('household_demographics.hd_vehicle_count <= (0 + 2)))) OR (('household_demographics.hd_dep_count = 1) AND ('household_demographics.hd_vehicle_count <= (1 + 2))))) AND ('store.s_store_name = ese)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  +- 'UnresolvedRelation [household_demographics], [], false
               :  +- 'UnresolvedRelation [time_dim], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
h8_30_to_9: bigint, h9_to_9_30: bigint, h9_30_to_10: bigint, h10_to_10_30: bigint, h10_30_to_11: bigint, h11_to_11_30: bigint, h11_30_to_12: bigint, h12_to_12_30: bigint
Project [h8_30_to_9#25921L, h9_to_9_30#25922L, h9_30_to_10#25923L, h10_to_10_30#25924L, h10_30_to_11#25925L, h11_to_11_30#25926L, h11_30_to_12#25927L, h12_to_12_30#25928L]
+- Join Inner
   :- Join Inner
   :  :- Join Inner
   :  :  :- Join Inner
   :  :  :  :- Join Inner
   :  :  :  :  :- Join Inner
   :  :  :  :  :  :- Join Inner
   :  :  :  :  :  :  :- SubqueryAlias s1
   :  :  :  :  :  :  :  +- Aggregate [count(1) AS h8_30_to_9#25921L]
   :  :  :  :  :  :  :     +- Filter ((((ss_sold_time_sk#25937L = t_time_sk#25965L) AND (ss_hdemo_sk#25941L = hd_demo_sk#25960L)) AND ((ss_store_sk#25943L = s_store_sk#25975L) AND (t_hour#25968 = 8))) AND (((t_minute#25969 >= 30) AND ((((hd_dep_count#25963 = 3) AND (hd_vehicle_count#25964 <= (3 + 2))) OR ((hd_dep_count#25963 = 0) AND (hd_vehicle_count#25964 <= (0 + 2)))) OR ((hd_dep_count#25963 = 1) AND (hd_vehicle_count#25964 <= (1 + 2))))) AND (s_store_name#25980 = ese)))
   :  :  :  :  :  :  :        +- Join Inner
   :  :  :  :  :  :  :           :- Join Inner
   :  :  :  :  :  :  :           :  :- Join Inner
   :  :  :  :  :  :  :           :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :  :  :  :  :  :           :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#25937L,ss_item_sk#25938L,ss_customer_sk#25939L,ss_cdemo_sk#25940L,ss_hdemo_sk#25941L,ss_addr_sk#25942L,ss_store_sk#25943L,ss_promo_sk#25944L,ss_ticket_number#25945L,ss_quantity#25946,ss_wholesale_cost#25947,ss_list_price#25948,ss_sales_price#25949,ss_ext_discount_amt#25950,ss_ext_sales_price#25951,ss_ext_wholesale_cost#25952,ss_ext_list_price#25953,ss_ext_tax#25954,ss_coupon_amt#25955,ss_net_paid#25956,ss_net_paid_inc_tax#25957,ss_net_profit#25958,ss_sold_date_sk#25959L] orc
   :  :  :  :  :  :  :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :  :  :  :  :  :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25960L,hd_income_band_sk#25961L,hd_buy_potential#25962,hd_dep_count#25963,hd_vehicle_count#25964] orc
   :  :  :  :  :  :  :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :  :  :  :  :  :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#25965L,t_time_id#25966,t_time#25967,t_hour#25968,t_minute#25969,t_second#25970,t_am_pm#25971,t_shift#25972,t_sub_shift#25973,t_meal_time#25974] orc
   :  :  :  :  :  :  :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :  :  :  :  :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#25975L,s_store_id#25976,s_rec_start_date#25977,s_rec_end_date#25978,s_closed_date_sk#25979L,s_store_name#25980,s_number_employees#25981,s_floor_space#25982,s_hours#25983,s_manager#25984,s_market_id#25985,s_geography_class#25986,s_market_desc#25987,s_market_manager#25988,s_division_id#25989,s_division_name#25990,s_company_id#25991,s_company_name#25992,s_street_number#25993,s_street_name#25994,s_street_type#25995,s_suite_number#25996,s_city#25997,s_county#25998,... 5 more fields] orc
   :  :  :  :  :  :  +- SubqueryAlias s2
   :  :  :  :  :  :     +- Aggregate [count(1) AS h9_to_9_30#25922L]
   :  :  :  :  :  :        +- Filter ((((ss_sold_time_sk#26004L = t_time_sk#26032L) AND (ss_hdemo_sk#26008L = hd_demo_sk#26027L)) AND ((ss_store_sk#26010L = s_store_sk#26042L) AND (t_hour#26035 = 9))) AND (((t_minute#26036 < 30) AND ((((hd_dep_count#26030 = 3) AND (hd_vehicle_count#26031 <= (3 + 2))) OR ((hd_dep_count#26030 = 0) AND (hd_vehicle_count#26031 <= (0 + 2)))) OR ((hd_dep_count#26030 = 1) AND (hd_vehicle_count#26031 <= (1 + 2))))) AND (s_store_name#26047 = ese)))
   :  :  :  :  :  :           +- Join Inner
   :  :  :  :  :  :              :- Join Inner
   :  :  :  :  :  :              :  :- Join Inner
   :  :  :  :  :  :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :  :  :  :  :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26004L,ss_item_sk#26005L,ss_customer_sk#26006L,ss_cdemo_sk#26007L,ss_hdemo_sk#26008L,ss_addr_sk#26009L,ss_store_sk#26010L,ss_promo_sk#26011L,ss_ticket_number#26012L,ss_quantity#26013,ss_wholesale_cost#26014,ss_list_price#26015,ss_sales_price#26016,ss_ext_discount_amt#26017,ss_ext_sales_price#26018,ss_ext_wholesale_cost#26019,ss_ext_list_price#26020,ss_ext_tax#26021,ss_coupon_amt#26022,ss_net_paid#26023,ss_net_paid_inc_tax#26024,ss_net_profit#26025,ss_sold_date_sk#26026L] orc
   :  :  :  :  :  :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :  :  :  :  :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26027L,hd_income_band_sk#26028L,hd_buy_potential#26029,hd_dep_count#26030,hd_vehicle_count#26031] orc
   :  :  :  :  :  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :  :  :  :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26032L,t_time_id#26033,t_time#26034,t_hour#26035,t_minute#26036,t_second#26037,t_am_pm#26038,t_shift#26039,t_sub_shift#26040,t_meal_time#26041] orc
   :  :  :  :  :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :  :  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26042L,s_store_id#26043,s_rec_start_date#26044,s_rec_end_date#26045,s_closed_date_sk#26046L,s_store_name#26047,s_number_employees#26048,s_floor_space#26049,s_hours#26050,s_manager#26051,s_market_id#26052,s_geography_class#26053,s_market_desc#26054,s_market_manager#26055,s_division_id#26056,s_division_name#26057,s_company_id#26058,s_company_name#26059,s_street_number#26060,s_street_name#26061,s_street_type#26062,s_suite_number#26063,s_city#26064,s_county#26065,... 5 more fields] orc
   :  :  :  :  :  +- SubqueryAlias s3
   :  :  :  :  :     +- Aggregate [count(1) AS h9_30_to_10#25923L]
   :  :  :  :  :        +- Filter ((((ss_sold_time_sk#26071L = t_time_sk#26099L) AND (ss_hdemo_sk#26075L = hd_demo_sk#26094L)) AND ((ss_store_sk#26077L = s_store_sk#26109L) AND (t_hour#26102 = 9))) AND (((t_minute#26103 >= 30) AND ((((hd_dep_count#26097 = 3) AND (hd_vehicle_count#26098 <= (3 + 2))) OR ((hd_dep_count#26097 = 0) AND (hd_vehicle_count#26098 <= (0 + 2)))) OR ((hd_dep_count#26097 = 1) AND (hd_vehicle_count#26098 <= (1 + 2))))) AND (s_store_name#26114 = ese)))
   :  :  :  :  :           +- Join Inner
   :  :  :  :  :              :- Join Inner
   :  :  :  :  :              :  :- Join Inner
   :  :  :  :  :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :  :  :  :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26071L,ss_item_sk#26072L,ss_customer_sk#26073L,ss_cdemo_sk#26074L,ss_hdemo_sk#26075L,ss_addr_sk#26076L,ss_store_sk#26077L,ss_promo_sk#26078L,ss_ticket_number#26079L,ss_quantity#26080,ss_wholesale_cost#26081,ss_list_price#26082,ss_sales_price#26083,ss_ext_discount_amt#26084,ss_ext_sales_price#26085,ss_ext_wholesale_cost#26086,ss_ext_list_price#26087,ss_ext_tax#26088,ss_coupon_amt#26089,ss_net_paid#26090,ss_net_paid_inc_tax#26091,ss_net_profit#26092,ss_sold_date_sk#26093L] orc
   :  :  :  :  :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :  :  :  :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26094L,hd_income_band_sk#26095L,hd_buy_potential#26096,hd_dep_count#26097,hd_vehicle_count#26098] orc
   :  :  :  :  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :  :  :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26099L,t_time_id#26100,t_time#26101,t_hour#26102,t_minute#26103,t_second#26104,t_am_pm#26105,t_shift#26106,t_sub_shift#26107,t_meal_time#26108] orc
   :  :  :  :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26109L,s_store_id#26110,s_rec_start_date#26111,s_rec_end_date#26112,s_closed_date_sk#26113L,s_store_name#26114,s_number_employees#26115,s_floor_space#26116,s_hours#26117,s_manager#26118,s_market_id#26119,s_geography_class#26120,s_market_desc#26121,s_market_manager#26122,s_division_id#26123,s_division_name#26124,s_company_id#26125,s_company_name#26126,s_street_number#26127,s_street_name#26128,s_street_type#26129,s_suite_number#26130,s_city#26131,s_county#26132,... 5 more fields] orc
   :  :  :  :  +- SubqueryAlias s4
   :  :  :  :     +- Aggregate [count(1) AS h10_to_10_30#25924L]
   :  :  :  :        +- Filter ((((ss_sold_time_sk#26138L = t_time_sk#26166L) AND (ss_hdemo_sk#26142L = hd_demo_sk#26161L)) AND ((ss_store_sk#26144L = s_store_sk#26176L) AND (t_hour#26169 = 10))) AND (((t_minute#26170 < 30) AND ((((hd_dep_count#26164 = 3) AND (hd_vehicle_count#26165 <= (3 + 2))) OR ((hd_dep_count#26164 = 0) AND (hd_vehicle_count#26165 <= (0 + 2)))) OR ((hd_dep_count#26164 = 1) AND (hd_vehicle_count#26165 <= (1 + 2))))) AND (s_store_name#26181 = ese)))
   :  :  :  :           +- Join Inner
   :  :  :  :              :- Join Inner
   :  :  :  :              :  :- Join Inner
   :  :  :  :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :  :  :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26138L,ss_item_sk#26139L,ss_customer_sk#26140L,ss_cdemo_sk#26141L,ss_hdemo_sk#26142L,ss_addr_sk#26143L,ss_store_sk#26144L,ss_promo_sk#26145L,ss_ticket_number#26146L,ss_quantity#26147,ss_wholesale_cost#26148,ss_list_price#26149,ss_sales_price#26150,ss_ext_discount_amt#26151,ss_ext_sales_price#26152,ss_ext_wholesale_cost#26153,ss_ext_list_price#26154,ss_ext_tax#26155,ss_coupon_amt#26156,ss_net_paid#26157,ss_net_paid_inc_tax#26158,ss_net_profit#26159,ss_sold_date_sk#26160L] orc
   :  :  :  :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :  :  :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26161L,hd_income_band_sk#26162L,hd_buy_potential#26163,hd_dep_count#26164,hd_vehicle_count#26165] orc
   :  :  :  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :  :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26166L,t_time_id#26167,t_time#26168,t_hour#26169,t_minute#26170,t_second#26171,t_am_pm#26172,t_shift#26173,t_sub_shift#26174,t_meal_time#26175] orc
   :  :  :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26176L,s_store_id#26177,s_rec_start_date#26178,s_rec_end_date#26179,s_closed_date_sk#26180L,s_store_name#26181,s_number_employees#26182,s_floor_space#26183,s_hours#26184,s_manager#26185,s_market_id#26186,s_geography_class#26187,s_market_desc#26188,s_market_manager#26189,s_division_id#26190,s_division_name#26191,s_company_id#26192,s_company_name#26193,s_street_number#26194,s_street_name#26195,s_street_type#26196,s_suite_number#26197,s_city#26198,s_county#26199,... 5 more fields] orc
   :  :  :  +- SubqueryAlias s5
   :  :  :     +- Aggregate [count(1) AS h10_30_to_11#25925L]
   :  :  :        +- Filter ((((ss_sold_time_sk#26205L = t_time_sk#26233L) AND (ss_hdemo_sk#26209L = hd_demo_sk#26228L)) AND ((ss_store_sk#26211L = s_store_sk#26243L) AND (t_hour#26236 = 10))) AND (((t_minute#26237 >= 30) AND ((((hd_dep_count#26231 = 3) AND (hd_vehicle_count#26232 <= (3 + 2))) OR ((hd_dep_count#26231 = 0) AND (hd_vehicle_count#26232 <= (0 + 2)))) OR ((hd_dep_count#26231 = 1) AND (hd_vehicle_count#26232 <= (1 + 2))))) AND (s_store_name#26248 = ese)))
   :  :  :           +- Join Inner
   :  :  :              :- Join Inner
   :  :  :              :  :- Join Inner
   :  :  :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :  :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26205L,ss_item_sk#26206L,ss_customer_sk#26207L,ss_cdemo_sk#26208L,ss_hdemo_sk#26209L,ss_addr_sk#26210L,ss_store_sk#26211L,ss_promo_sk#26212L,ss_ticket_number#26213L,ss_quantity#26214,ss_wholesale_cost#26215,ss_list_price#26216,ss_sales_price#26217,ss_ext_discount_amt#26218,ss_ext_sales_price#26219,ss_ext_wholesale_cost#26220,ss_ext_list_price#26221,ss_ext_tax#26222,ss_coupon_amt#26223,ss_net_paid#26224,ss_net_paid_inc_tax#26225,ss_net_profit#26226,ss_sold_date_sk#26227L] orc
   :  :  :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :  :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26228L,hd_income_band_sk#26229L,hd_buy_potential#26230,hd_dep_count#26231,hd_vehicle_count#26232] orc
   :  :  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26233L,t_time_id#26234,t_time#26235,t_hour#26236,t_minute#26237,t_second#26238,t_am_pm#26239,t_shift#26240,t_sub_shift#26241,t_meal_time#26242] orc
   :  :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26243L,s_store_id#26244,s_rec_start_date#26245,s_rec_end_date#26246,s_closed_date_sk#26247L,s_store_name#26248,s_number_employees#26249,s_floor_space#26250,s_hours#26251,s_manager#26252,s_market_id#26253,s_geography_class#26254,s_market_desc#26255,s_market_manager#26256,s_division_id#26257,s_division_name#26258,s_company_id#26259,s_company_name#26260,s_street_number#26261,s_street_name#26262,s_street_type#26263,s_suite_number#26264,s_city#26265,s_county#26266,... 5 more fields] orc
   :  :  +- SubqueryAlias s6
   :  :     +- Aggregate [count(1) AS h11_to_11_30#25926L]
   :  :        +- Filter ((((ss_sold_time_sk#26272L = t_time_sk#26300L) AND (ss_hdemo_sk#26276L = hd_demo_sk#26295L)) AND ((ss_store_sk#26278L = s_store_sk#26310L) AND (t_hour#26303 = 11))) AND (((t_minute#26304 < 30) AND ((((hd_dep_count#26298 = 3) AND (hd_vehicle_count#26299 <= (3 + 2))) OR ((hd_dep_count#26298 = 0) AND (hd_vehicle_count#26299 <= (0 + 2)))) OR ((hd_dep_count#26298 = 1) AND (hd_vehicle_count#26299 <= (1 + 2))))) AND (s_store_name#26315 = ese)))
   :  :           +- Join Inner
   :  :              :- Join Inner
   :  :              :  :- Join Inner
   :  :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :  :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26272L,ss_item_sk#26273L,ss_customer_sk#26274L,ss_cdemo_sk#26275L,ss_hdemo_sk#26276L,ss_addr_sk#26277L,ss_store_sk#26278L,ss_promo_sk#26279L,ss_ticket_number#26280L,ss_quantity#26281,ss_wholesale_cost#26282,ss_list_price#26283,ss_sales_price#26284,ss_ext_discount_amt#26285,ss_ext_sales_price#26286,ss_ext_wholesale_cost#26287,ss_ext_list_price#26288,ss_ext_tax#26289,ss_coupon_amt#26290,ss_net_paid#26291,ss_net_paid_inc_tax#26292,ss_net_profit#26293,ss_sold_date_sk#26294L] orc
   :  :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :  :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26295L,hd_income_band_sk#26296L,hd_buy_potential#26297,hd_dep_count#26298,hd_vehicle_count#26299] orc
   :  :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :  :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26300L,t_time_id#26301,t_time#26302,t_hour#26303,t_minute#26304,t_second#26305,t_am_pm#26306,t_shift#26307,t_sub_shift#26308,t_meal_time#26309] orc
   :  :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26310L,s_store_id#26311,s_rec_start_date#26312,s_rec_end_date#26313,s_closed_date_sk#26314L,s_store_name#26315,s_number_employees#26316,s_floor_space#26317,s_hours#26318,s_manager#26319,s_market_id#26320,s_geography_class#26321,s_market_desc#26322,s_market_manager#26323,s_division_id#26324,s_division_name#26325,s_company_id#26326,s_company_name#26327,s_street_number#26328,s_street_name#26329,s_street_type#26330,s_suite_number#26331,s_city#26332,s_county#26333,... 5 more fields] orc
   :  +- SubqueryAlias s7
   :     +- Aggregate [count(1) AS h11_30_to_12#25927L]
   :        +- Filter ((((ss_sold_time_sk#26339L = t_time_sk#26367L) AND (ss_hdemo_sk#26343L = hd_demo_sk#26362L)) AND ((ss_store_sk#26345L = s_store_sk#26377L) AND (t_hour#26370 = 11))) AND (((t_minute#26371 >= 30) AND ((((hd_dep_count#26365 = 3) AND (hd_vehicle_count#26366 <= (3 + 2))) OR ((hd_dep_count#26365 = 0) AND (hd_vehicle_count#26366 <= (0 + 2)))) OR ((hd_dep_count#26365 = 1) AND (hd_vehicle_count#26366 <= (1 + 2))))) AND (s_store_name#26382 = ese)))
   :           +- Join Inner
   :              :- Join Inner
   :              :  :- Join Inner
   :              :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
   :              :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26339L,ss_item_sk#26340L,ss_customer_sk#26341L,ss_cdemo_sk#26342L,ss_hdemo_sk#26343L,ss_addr_sk#26344L,ss_store_sk#26345L,ss_promo_sk#26346L,ss_ticket_number#26347L,ss_quantity#26348,ss_wholesale_cost#26349,ss_list_price#26350,ss_sales_price#26351,ss_ext_discount_amt#26352,ss_ext_sales_price#26353,ss_ext_wholesale_cost#26354,ss_ext_list_price#26355,ss_ext_tax#26356,ss_coupon_amt#26357,ss_net_paid#26358,ss_net_paid_inc_tax#26359,ss_net_profit#26360,ss_sold_date_sk#26361L] orc
   :              :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
   :              :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26362L,hd_income_band_sk#26363L,hd_buy_potential#26364,hd_dep_count#26365,hd_vehicle_count#26366] orc
   :              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
   :              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26367L,t_time_id#26368,t_time#26369,t_hour#26370,t_minute#26371,t_second#26372,t_am_pm#26373,t_shift#26374,t_sub_shift#26375,t_meal_time#26376] orc
   :              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
   :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26377L,s_store_id#26378,s_rec_start_date#26379,s_rec_end_date#26380,s_closed_date_sk#26381L,s_store_name#26382,s_number_employees#26383,s_floor_space#26384,s_hours#26385,s_manager#26386,s_market_id#26387,s_geography_class#26388,s_market_desc#26389,s_market_manager#26390,s_division_id#26391,s_division_name#26392,s_company_id#26393,s_company_name#26394,s_street_number#26395,s_street_name#26396,s_street_type#26397,s_suite_number#26398,s_city#26399,s_county#26400,... 5 more fields] orc
   +- SubqueryAlias s8
      +- Aggregate [count(1) AS h12_to_12_30#25928L]
         +- Filter ((((ss_sold_time_sk#26406L = t_time_sk#26434L) AND (ss_hdemo_sk#26410L = hd_demo_sk#26429L)) AND ((ss_store_sk#26412L = s_store_sk#26444L) AND (t_hour#26437 = 12))) AND (((t_minute#26438 < 30) AND ((((hd_dep_count#26432 = 3) AND (hd_vehicle_count#26433 <= (3 + 2))) OR ((hd_dep_count#26432 = 0) AND (hd_vehicle_count#26433 <= (0 + 2)))) OR ((hd_dep_count#26432 = 1) AND (hd_vehicle_count#26433 <= (1 + 2))))) AND (s_store_name#26449 = ese)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26406L,ss_item_sk#26407L,ss_customer_sk#26408L,ss_cdemo_sk#26409L,ss_hdemo_sk#26410L,ss_addr_sk#26411L,ss_store_sk#26412L,ss_promo_sk#26413L,ss_ticket_number#26414L,ss_quantity#26415,ss_wholesale_cost#26416,ss_list_price#26417,ss_sales_price#26418,ss_ext_discount_amt#26419,ss_ext_sales_price#26420,ss_ext_wholesale_cost#26421,ss_ext_list_price#26422,ss_ext_tax#26423,ss_coupon_amt#26424,ss_net_paid#26425,ss_net_paid_inc_tax#26426,ss_net_profit#26427,ss_sold_date_sk#26428L] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26429L,hd_income_band_sk#26430L,hd_buy_potential#26431,hd_dep_count#26432,hd_vehicle_count#26433] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26434L,t_time_id#26435,t_time#26436,t_hour#26437,t_minute#26438,t_second#26439,t_am_pm#26440,t_shift#26441,t_sub_shift#26442,t_meal_time#26443] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26444L,s_store_id#26445,s_rec_start_date#26446,s_rec_end_date#26447,s_closed_date_sk#26448L,s_store_name#26449,s_number_employees#26450,s_floor_space#26451,s_hours#26452,s_manager#26453,s_market_id#26454,s_geography_class#26455,s_market_desc#26456,s_market_manager#26457,s_division_id#26458,s_division_name#26459,s_company_id#26460,s_company_name#26461,s_street_number#26462,s_street_name#26463,s_street_type#26464,s_suite_number#26465,s_city#26466,s_county#26467,... 5 more fields] orc

== Optimized Logical Plan ==
Join Inner
:- Join Inner
:  :- Join Inner
:  :  :- Join Inner
:  :  :  :- Join Inner
:  :  :  :  :- Join Inner
:  :  :  :  :  :- Join Inner
:  :  :  :  :  :  :- Aggregate [count(1) AS h8_30_to_9#25921L]
:  :  :  :  :  :  :  +- Project
:  :  :  :  :  :  :     +- Join Inner, (ss_hdemo_sk#25941L = hd_demo_sk#25960L)
:  :  :  :  :  :  :        :- Project [ss_hdemo_sk#25941L]
:  :  :  :  :  :  :        :  +- Join Inner, (ss_store_sk#25943L = s_store_sk#25975L)
:  :  :  :  :  :  :        :     :- Project [ss_hdemo_sk#25941L, ss_store_sk#25943L]
:  :  :  :  :  :  :        :     :  +- Join Inner, (ss_sold_time_sk#25937L = t_time_sk#25965L)
:  :  :  :  :  :  :        :     :     :- Project [ss_sold_time_sk#25937L, ss_hdemo_sk#25941L, ss_store_sk#25943L]
:  :  :  :  :  :  :        :     :     :  +- Filter (isnotnull(ss_hdemo_sk#25941L) AND (isnotnull(ss_sold_time_sk#25937L) AND isnotnull(ss_store_sk#25943L)))
:  :  :  :  :  :  :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#25937L,ss_item_sk#25938L,ss_customer_sk#25939L,ss_cdemo_sk#25940L,ss_hdemo_sk#25941L,ss_addr_sk#25942L,ss_store_sk#25943L,ss_promo_sk#25944L,ss_ticket_number#25945L,ss_quantity#25946,ss_wholesale_cost#25947,ss_list_price#25948,ss_sales_price#25949,ss_ext_discount_amt#25950,ss_ext_sales_price#25951,ss_ext_wholesale_cost#25952,ss_ext_list_price#25953,ss_ext_tax#25954,ss_coupon_amt#25955,ss_net_paid#25956,ss_net_paid_inc_tax#25957,ss_net_profit#25958,ss_sold_date_sk#25959L] orc
:  :  :  :  :  :  :        :     :     +- Project [t_time_sk#25965L]
:  :  :  :  :  :  :        :     :        +- Filter (((isnotnull(t_hour#25968) AND isnotnull(t_minute#25969)) AND ((t_hour#25968 = 8) AND (t_minute#25969 >= 30))) AND isnotnull(t_time_sk#25965L))
:  :  :  :  :  :  :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#25965L,t_time_id#25966,t_time#25967,t_hour#25968,t_minute#25969,t_second#25970,t_am_pm#25971,t_shift#25972,t_sub_shift#25973,t_meal_time#25974] orc
:  :  :  :  :  :  :        :     +- Project [s_store_sk#25975L]
:  :  :  :  :  :  :        :        +- Filter ((isnotnull(s_store_name#25980) AND (s_store_name#25980 = ese)) AND isnotnull(s_store_sk#25975L))
:  :  :  :  :  :  :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#25975L,s_store_id#25976,s_rec_start_date#25977,s_rec_end_date#25978,s_closed_date_sk#25979L,s_store_name#25980,s_number_employees#25981,s_floor_space#25982,s_hours#25983,s_manager#25984,s_market_id#25985,s_geography_class#25986,s_market_desc#25987,s_market_manager#25988,s_division_id#25989,s_division_name#25990,s_company_id#25991,s_company_name#25992,s_street_number#25993,s_street_name#25994,s_street_type#25995,s_suite_number#25996,s_city#25997,s_county#25998,... 5 more fields] orc
:  :  :  :  :  :  :        +- Project [hd_demo_sk#25960L]
:  :  :  :  :  :  :           +- Filter (((((hd_dep_count#25963 = 3) AND (hd_vehicle_count#25964 <= 5)) OR ((hd_dep_count#25963 = 0) AND (hd_vehicle_count#25964 <= 2))) OR ((hd_dep_count#25963 = 1) AND (hd_vehicle_count#25964 <= 3))) AND isnotnull(hd_demo_sk#25960L))
:  :  :  :  :  :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25960L,hd_income_band_sk#25961L,hd_buy_potential#25962,hd_dep_count#25963,hd_vehicle_count#25964] orc
:  :  :  :  :  :  +- Aggregate [count(1) AS h9_to_9_30#25922L]
:  :  :  :  :  :     +- Project
:  :  :  :  :  :        +- Join Inner, (ss_hdemo_sk#26008L = hd_demo_sk#26027L)
:  :  :  :  :  :           :- Project [ss_hdemo_sk#26008L]
:  :  :  :  :  :           :  +- Join Inner, (ss_store_sk#26010L = s_store_sk#26042L)
:  :  :  :  :  :           :     :- Project [ss_hdemo_sk#26008L, ss_store_sk#26010L]
:  :  :  :  :  :           :     :  +- Join Inner, (ss_sold_time_sk#26004L = t_time_sk#26032L)
:  :  :  :  :  :           :     :     :- Project [ss_sold_time_sk#26004L, ss_hdemo_sk#26008L, ss_store_sk#26010L]
:  :  :  :  :  :           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26008L) AND (isnotnull(ss_sold_time_sk#26004L) AND isnotnull(ss_store_sk#26010L)))
:  :  :  :  :  :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26004L,ss_item_sk#26005L,ss_customer_sk#26006L,ss_cdemo_sk#26007L,ss_hdemo_sk#26008L,ss_addr_sk#26009L,ss_store_sk#26010L,ss_promo_sk#26011L,ss_ticket_number#26012L,ss_quantity#26013,ss_wholesale_cost#26014,ss_list_price#26015,ss_sales_price#26016,ss_ext_discount_amt#26017,ss_ext_sales_price#26018,ss_ext_wholesale_cost#26019,ss_ext_list_price#26020,ss_ext_tax#26021,ss_coupon_amt#26022,ss_net_paid#26023,ss_net_paid_inc_tax#26024,ss_net_profit#26025,ss_sold_date_sk#26026L] orc
:  :  :  :  :  :           :     :     +- Project [t_time_sk#26032L]
:  :  :  :  :  :           :     :        +- Filter (((isnotnull(t_hour#26035) AND isnotnull(t_minute#26036)) AND ((t_hour#26035 = 9) AND (t_minute#26036 < 30))) AND isnotnull(t_time_sk#26032L))
:  :  :  :  :  :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26032L,t_time_id#26033,t_time#26034,t_hour#26035,t_minute#26036,t_second#26037,t_am_pm#26038,t_shift#26039,t_sub_shift#26040,t_meal_time#26041] orc
:  :  :  :  :  :           :     +- Project [s_store_sk#26042L]
:  :  :  :  :  :           :        +- Filter ((isnotnull(s_store_name#26047) AND (s_store_name#26047 = ese)) AND isnotnull(s_store_sk#26042L))
:  :  :  :  :  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26042L,s_store_id#26043,s_rec_start_date#26044,s_rec_end_date#26045,s_closed_date_sk#26046L,s_store_name#26047,s_number_employees#26048,s_floor_space#26049,s_hours#26050,s_manager#26051,s_market_id#26052,s_geography_class#26053,s_market_desc#26054,s_market_manager#26055,s_division_id#26056,s_division_name#26057,s_company_id#26058,s_company_name#26059,s_street_number#26060,s_street_name#26061,s_street_type#26062,s_suite_number#26063,s_city#26064,s_county#26065,... 5 more fields] orc
:  :  :  :  :  :           +- Project [hd_demo_sk#26027L]
:  :  :  :  :  :              +- Filter (((((hd_dep_count#26030 = 3) AND (hd_vehicle_count#26031 <= 5)) OR ((hd_dep_count#26030 = 0) AND (hd_vehicle_count#26031 <= 2))) OR ((hd_dep_count#26030 = 1) AND (hd_vehicle_count#26031 <= 3))) AND isnotnull(hd_demo_sk#26027L))
:  :  :  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26027L,hd_income_band_sk#26028L,hd_buy_potential#26029,hd_dep_count#26030,hd_vehicle_count#26031] orc
:  :  :  :  :  +- Aggregate [count(1) AS h9_30_to_10#25923L]
:  :  :  :  :     +- Project
:  :  :  :  :        +- Join Inner, (ss_hdemo_sk#26075L = hd_demo_sk#26094L)
:  :  :  :  :           :- Project [ss_hdemo_sk#26075L]
:  :  :  :  :           :  +- Join Inner, (ss_store_sk#26077L = s_store_sk#26109L)
:  :  :  :  :           :     :- Project [ss_hdemo_sk#26075L, ss_store_sk#26077L]
:  :  :  :  :           :     :  +- Join Inner, (ss_sold_time_sk#26071L = t_time_sk#26099L)
:  :  :  :  :           :     :     :- Project [ss_sold_time_sk#26071L, ss_hdemo_sk#26075L, ss_store_sk#26077L]
:  :  :  :  :           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26075L) AND (isnotnull(ss_sold_time_sk#26071L) AND isnotnull(ss_store_sk#26077L)))
:  :  :  :  :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26071L,ss_item_sk#26072L,ss_customer_sk#26073L,ss_cdemo_sk#26074L,ss_hdemo_sk#26075L,ss_addr_sk#26076L,ss_store_sk#26077L,ss_promo_sk#26078L,ss_ticket_number#26079L,ss_quantity#26080,ss_wholesale_cost#26081,ss_list_price#26082,ss_sales_price#26083,ss_ext_discount_amt#26084,ss_ext_sales_price#26085,ss_ext_wholesale_cost#26086,ss_ext_list_price#26087,ss_ext_tax#26088,ss_coupon_amt#26089,ss_net_paid#26090,ss_net_paid_inc_tax#26091,ss_net_profit#26092,ss_sold_date_sk#26093L] orc
:  :  :  :  :           :     :     +- Project [t_time_sk#26099L]
:  :  :  :  :           :     :        +- Filter (((isnotnull(t_hour#26102) AND isnotnull(t_minute#26103)) AND ((t_hour#26102 = 9) AND (t_minute#26103 >= 30))) AND isnotnull(t_time_sk#26099L))
:  :  :  :  :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26099L,t_time_id#26100,t_time#26101,t_hour#26102,t_minute#26103,t_second#26104,t_am_pm#26105,t_shift#26106,t_sub_shift#26107,t_meal_time#26108] orc
:  :  :  :  :           :     +- Project [s_store_sk#26109L]
:  :  :  :  :           :        +- Filter ((isnotnull(s_store_name#26114) AND (s_store_name#26114 = ese)) AND isnotnull(s_store_sk#26109L))
:  :  :  :  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26109L,s_store_id#26110,s_rec_start_date#26111,s_rec_end_date#26112,s_closed_date_sk#26113L,s_store_name#26114,s_number_employees#26115,s_floor_space#26116,s_hours#26117,s_manager#26118,s_market_id#26119,s_geography_class#26120,s_market_desc#26121,s_market_manager#26122,s_division_id#26123,s_division_name#26124,s_company_id#26125,s_company_name#26126,s_street_number#26127,s_street_name#26128,s_street_type#26129,s_suite_number#26130,s_city#26131,s_county#26132,... 5 more fields] orc
:  :  :  :  :           +- Project [hd_demo_sk#26094L]
:  :  :  :  :              +- Filter (((((hd_dep_count#26097 = 3) AND (hd_vehicle_count#26098 <= 5)) OR ((hd_dep_count#26097 = 0) AND (hd_vehicle_count#26098 <= 2))) OR ((hd_dep_count#26097 = 1) AND (hd_vehicle_count#26098 <= 3))) AND isnotnull(hd_demo_sk#26094L))
:  :  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26094L,hd_income_band_sk#26095L,hd_buy_potential#26096,hd_dep_count#26097,hd_vehicle_count#26098] orc
:  :  :  :  +- Aggregate [count(1) AS h10_to_10_30#25924L]
:  :  :  :     +- Project
:  :  :  :        +- Join Inner, (ss_hdemo_sk#26142L = hd_demo_sk#26161L)
:  :  :  :           :- Project [ss_hdemo_sk#26142L]
:  :  :  :           :  +- Join Inner, (ss_store_sk#26144L = s_store_sk#26176L)
:  :  :  :           :     :- Project [ss_hdemo_sk#26142L, ss_store_sk#26144L]
:  :  :  :           :     :  +- Join Inner, (ss_sold_time_sk#26138L = t_time_sk#26166L)
:  :  :  :           :     :     :- Project [ss_sold_time_sk#26138L, ss_hdemo_sk#26142L, ss_store_sk#26144L]
:  :  :  :           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26142L) AND (isnotnull(ss_sold_time_sk#26138L) AND isnotnull(ss_store_sk#26144L)))
:  :  :  :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26138L,ss_item_sk#26139L,ss_customer_sk#26140L,ss_cdemo_sk#26141L,ss_hdemo_sk#26142L,ss_addr_sk#26143L,ss_store_sk#26144L,ss_promo_sk#26145L,ss_ticket_number#26146L,ss_quantity#26147,ss_wholesale_cost#26148,ss_list_price#26149,ss_sales_price#26150,ss_ext_discount_amt#26151,ss_ext_sales_price#26152,ss_ext_wholesale_cost#26153,ss_ext_list_price#26154,ss_ext_tax#26155,ss_coupon_amt#26156,ss_net_paid#26157,ss_net_paid_inc_tax#26158,ss_net_profit#26159,ss_sold_date_sk#26160L] orc
:  :  :  :           :     :     +- Project [t_time_sk#26166L]
:  :  :  :           :     :        +- Filter (((isnotnull(t_hour#26169) AND isnotnull(t_minute#26170)) AND ((t_hour#26169 = 10) AND (t_minute#26170 < 30))) AND isnotnull(t_time_sk#26166L))
:  :  :  :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26166L,t_time_id#26167,t_time#26168,t_hour#26169,t_minute#26170,t_second#26171,t_am_pm#26172,t_shift#26173,t_sub_shift#26174,t_meal_time#26175] orc
:  :  :  :           :     +- Project [s_store_sk#26176L]
:  :  :  :           :        +- Filter ((isnotnull(s_store_name#26181) AND (s_store_name#26181 = ese)) AND isnotnull(s_store_sk#26176L))
:  :  :  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26176L,s_store_id#26177,s_rec_start_date#26178,s_rec_end_date#26179,s_closed_date_sk#26180L,s_store_name#26181,s_number_employees#26182,s_floor_space#26183,s_hours#26184,s_manager#26185,s_market_id#26186,s_geography_class#26187,s_market_desc#26188,s_market_manager#26189,s_division_id#26190,s_division_name#26191,s_company_id#26192,s_company_name#26193,s_street_number#26194,s_street_name#26195,s_street_type#26196,s_suite_number#26197,s_city#26198,s_county#26199,... 5 more fields] orc
:  :  :  :           +- Project [hd_demo_sk#26161L]
:  :  :  :              +- Filter (((((hd_dep_count#26164 = 3) AND (hd_vehicle_count#26165 <= 5)) OR ((hd_dep_count#26164 = 0) AND (hd_vehicle_count#26165 <= 2))) OR ((hd_dep_count#26164 = 1) AND (hd_vehicle_count#26165 <= 3))) AND isnotnull(hd_demo_sk#26161L))
:  :  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26161L,hd_income_band_sk#26162L,hd_buy_potential#26163,hd_dep_count#26164,hd_vehicle_count#26165] orc
:  :  :  +- Aggregate [count(1) AS h10_30_to_11#25925L]
:  :  :     +- Project
:  :  :        +- Join Inner, (ss_hdemo_sk#26209L = hd_demo_sk#26228L)
:  :  :           :- Project [ss_hdemo_sk#26209L]
:  :  :           :  +- Join Inner, (ss_store_sk#26211L = s_store_sk#26243L)
:  :  :           :     :- Project [ss_hdemo_sk#26209L, ss_store_sk#26211L]
:  :  :           :     :  +- Join Inner, (ss_sold_time_sk#26205L = t_time_sk#26233L)
:  :  :           :     :     :- Project [ss_sold_time_sk#26205L, ss_hdemo_sk#26209L, ss_store_sk#26211L]
:  :  :           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26209L) AND (isnotnull(ss_sold_time_sk#26205L) AND isnotnull(ss_store_sk#26211L)))
:  :  :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26205L,ss_item_sk#26206L,ss_customer_sk#26207L,ss_cdemo_sk#26208L,ss_hdemo_sk#26209L,ss_addr_sk#26210L,ss_store_sk#26211L,ss_promo_sk#26212L,ss_ticket_number#26213L,ss_quantity#26214,ss_wholesale_cost#26215,ss_list_price#26216,ss_sales_price#26217,ss_ext_discount_amt#26218,ss_ext_sales_price#26219,ss_ext_wholesale_cost#26220,ss_ext_list_price#26221,ss_ext_tax#26222,ss_coupon_amt#26223,ss_net_paid#26224,ss_net_paid_inc_tax#26225,ss_net_profit#26226,ss_sold_date_sk#26227L] orc
:  :  :           :     :     +- Project [t_time_sk#26233L]
:  :  :           :     :        +- Filter (((isnotnull(t_hour#26236) AND isnotnull(t_minute#26237)) AND ((t_hour#26236 = 10) AND (t_minute#26237 >= 30))) AND isnotnull(t_time_sk#26233L))
:  :  :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26233L,t_time_id#26234,t_time#26235,t_hour#26236,t_minute#26237,t_second#26238,t_am_pm#26239,t_shift#26240,t_sub_shift#26241,t_meal_time#26242] orc
:  :  :           :     +- Project [s_store_sk#26243L]
:  :  :           :        +- Filter ((isnotnull(s_store_name#26248) AND (s_store_name#26248 = ese)) AND isnotnull(s_store_sk#26243L))
:  :  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26243L,s_store_id#26244,s_rec_start_date#26245,s_rec_end_date#26246,s_closed_date_sk#26247L,s_store_name#26248,s_number_employees#26249,s_floor_space#26250,s_hours#26251,s_manager#26252,s_market_id#26253,s_geography_class#26254,s_market_desc#26255,s_market_manager#26256,s_division_id#26257,s_division_name#26258,s_company_id#26259,s_company_name#26260,s_street_number#26261,s_street_name#26262,s_street_type#26263,s_suite_number#26264,s_city#26265,s_county#26266,... 5 more fields] orc
:  :  :           +- Project [hd_demo_sk#26228L]
:  :  :              +- Filter (((((hd_dep_count#26231 = 3) AND (hd_vehicle_count#26232 <= 5)) OR ((hd_dep_count#26231 = 0) AND (hd_vehicle_count#26232 <= 2))) OR ((hd_dep_count#26231 = 1) AND (hd_vehicle_count#26232 <= 3))) AND isnotnull(hd_demo_sk#26228L))
:  :  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26228L,hd_income_band_sk#26229L,hd_buy_potential#26230,hd_dep_count#26231,hd_vehicle_count#26232] orc
:  :  +- Aggregate [count(1) AS h11_to_11_30#25926L]
:  :     +- Project
:  :        +- Join Inner, (ss_hdemo_sk#26276L = hd_demo_sk#26295L)
:  :           :- Project [ss_hdemo_sk#26276L]
:  :           :  +- Join Inner, (ss_store_sk#26278L = s_store_sk#26310L)
:  :           :     :- Project [ss_hdemo_sk#26276L, ss_store_sk#26278L]
:  :           :     :  +- Join Inner, (ss_sold_time_sk#26272L = t_time_sk#26300L)
:  :           :     :     :- Project [ss_sold_time_sk#26272L, ss_hdemo_sk#26276L, ss_store_sk#26278L]
:  :           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26276L) AND (isnotnull(ss_sold_time_sk#26272L) AND isnotnull(ss_store_sk#26278L)))
:  :           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26272L,ss_item_sk#26273L,ss_customer_sk#26274L,ss_cdemo_sk#26275L,ss_hdemo_sk#26276L,ss_addr_sk#26277L,ss_store_sk#26278L,ss_promo_sk#26279L,ss_ticket_number#26280L,ss_quantity#26281,ss_wholesale_cost#26282,ss_list_price#26283,ss_sales_price#26284,ss_ext_discount_amt#26285,ss_ext_sales_price#26286,ss_ext_wholesale_cost#26287,ss_ext_list_price#26288,ss_ext_tax#26289,ss_coupon_amt#26290,ss_net_paid#26291,ss_net_paid_inc_tax#26292,ss_net_profit#26293,ss_sold_date_sk#26294L] orc
:  :           :     :     +- Project [t_time_sk#26300L]
:  :           :     :        +- Filter (((isnotnull(t_hour#26303) AND isnotnull(t_minute#26304)) AND ((t_hour#26303 = 11) AND (t_minute#26304 < 30))) AND isnotnull(t_time_sk#26300L))
:  :           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26300L,t_time_id#26301,t_time#26302,t_hour#26303,t_minute#26304,t_second#26305,t_am_pm#26306,t_shift#26307,t_sub_shift#26308,t_meal_time#26309] orc
:  :           :     +- Project [s_store_sk#26310L]
:  :           :        +- Filter ((isnotnull(s_store_name#26315) AND (s_store_name#26315 = ese)) AND isnotnull(s_store_sk#26310L))
:  :           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26310L,s_store_id#26311,s_rec_start_date#26312,s_rec_end_date#26313,s_closed_date_sk#26314L,s_store_name#26315,s_number_employees#26316,s_floor_space#26317,s_hours#26318,s_manager#26319,s_market_id#26320,s_geography_class#26321,s_market_desc#26322,s_market_manager#26323,s_division_id#26324,s_division_name#26325,s_company_id#26326,s_company_name#26327,s_street_number#26328,s_street_name#26329,s_street_type#26330,s_suite_number#26331,s_city#26332,s_county#26333,... 5 more fields] orc
:  :           +- Project [hd_demo_sk#26295L]
:  :              +- Filter (((((hd_dep_count#26298 = 3) AND (hd_vehicle_count#26299 <= 5)) OR ((hd_dep_count#26298 = 0) AND (hd_vehicle_count#26299 <= 2))) OR ((hd_dep_count#26298 = 1) AND (hd_vehicle_count#26299 <= 3))) AND isnotnull(hd_demo_sk#26295L))
:  :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26295L,hd_income_band_sk#26296L,hd_buy_potential#26297,hd_dep_count#26298,hd_vehicle_count#26299] orc
:  +- Aggregate [count(1) AS h11_30_to_12#25927L]
:     +- Project
:        +- Join Inner, (ss_hdemo_sk#26343L = hd_demo_sk#26362L)
:           :- Project [ss_hdemo_sk#26343L]
:           :  +- Join Inner, (ss_store_sk#26345L = s_store_sk#26377L)
:           :     :- Project [ss_hdemo_sk#26343L, ss_store_sk#26345L]
:           :     :  +- Join Inner, (ss_sold_time_sk#26339L = t_time_sk#26367L)
:           :     :     :- Project [ss_sold_time_sk#26339L, ss_hdemo_sk#26343L, ss_store_sk#26345L]
:           :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26343L) AND (isnotnull(ss_sold_time_sk#26339L) AND isnotnull(ss_store_sk#26345L)))
:           :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26339L,ss_item_sk#26340L,ss_customer_sk#26341L,ss_cdemo_sk#26342L,ss_hdemo_sk#26343L,ss_addr_sk#26344L,ss_store_sk#26345L,ss_promo_sk#26346L,ss_ticket_number#26347L,ss_quantity#26348,ss_wholesale_cost#26349,ss_list_price#26350,ss_sales_price#26351,ss_ext_discount_amt#26352,ss_ext_sales_price#26353,ss_ext_wholesale_cost#26354,ss_ext_list_price#26355,ss_ext_tax#26356,ss_coupon_amt#26357,ss_net_paid#26358,ss_net_paid_inc_tax#26359,ss_net_profit#26360,ss_sold_date_sk#26361L] orc
:           :     :     +- Project [t_time_sk#26367L]
:           :     :        +- Filter (((isnotnull(t_hour#26370) AND isnotnull(t_minute#26371)) AND ((t_hour#26370 = 11) AND (t_minute#26371 >= 30))) AND isnotnull(t_time_sk#26367L))
:           :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26367L,t_time_id#26368,t_time#26369,t_hour#26370,t_minute#26371,t_second#26372,t_am_pm#26373,t_shift#26374,t_sub_shift#26375,t_meal_time#26376] orc
:           :     +- Project [s_store_sk#26377L]
:           :        +- Filter ((isnotnull(s_store_name#26382) AND (s_store_name#26382 = ese)) AND isnotnull(s_store_sk#26377L))
:           :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26377L,s_store_id#26378,s_rec_start_date#26379,s_rec_end_date#26380,s_closed_date_sk#26381L,s_store_name#26382,s_number_employees#26383,s_floor_space#26384,s_hours#26385,s_manager#26386,s_market_id#26387,s_geography_class#26388,s_market_desc#26389,s_market_manager#26390,s_division_id#26391,s_division_name#26392,s_company_id#26393,s_company_name#26394,s_street_number#26395,s_street_name#26396,s_street_type#26397,s_suite_number#26398,s_city#26399,s_county#26400,... 5 more fields] orc
:           +- Project [hd_demo_sk#26362L]
:              +- Filter (((((hd_dep_count#26365 = 3) AND (hd_vehicle_count#26366 <= 5)) OR ((hd_dep_count#26365 = 0) AND (hd_vehicle_count#26366 <= 2))) OR ((hd_dep_count#26365 = 1) AND (hd_vehicle_count#26366 <= 3))) AND isnotnull(hd_demo_sk#26362L))
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26362L,hd_income_band_sk#26363L,hd_buy_potential#26364,hd_dep_count#26365,hd_vehicle_count#26366] orc
+- Aggregate [count(1) AS h12_to_12_30#25928L]
   +- Project
      +- Join Inner, (ss_hdemo_sk#26410L = hd_demo_sk#26429L)
         :- Project [ss_hdemo_sk#26410L]
         :  +- Join Inner, (ss_store_sk#26412L = s_store_sk#26444L)
         :     :- Project [ss_hdemo_sk#26410L, ss_store_sk#26412L]
         :     :  +- Join Inner, (ss_sold_time_sk#26406L = t_time_sk#26434L)
         :     :     :- Project [ss_sold_time_sk#26406L, ss_hdemo_sk#26410L, ss_store_sk#26412L]
         :     :     :  +- Filter (isnotnull(ss_hdemo_sk#26410L) AND (isnotnull(ss_sold_time_sk#26406L) AND isnotnull(ss_store_sk#26412L)))
         :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26406L,ss_item_sk#26407L,ss_customer_sk#26408L,ss_cdemo_sk#26409L,ss_hdemo_sk#26410L,ss_addr_sk#26411L,ss_store_sk#26412L,ss_promo_sk#26413L,ss_ticket_number#26414L,ss_quantity#26415,ss_wholesale_cost#26416,ss_list_price#26417,ss_sales_price#26418,ss_ext_discount_amt#26419,ss_ext_sales_price#26420,ss_ext_wholesale_cost#26421,ss_ext_list_price#26422,ss_ext_tax#26423,ss_coupon_amt#26424,ss_net_paid#26425,ss_net_paid_inc_tax#26426,ss_net_profit#26427,ss_sold_date_sk#26428L] orc
         :     :     +- Project [t_time_sk#26434L]
         :     :        +- Filter (((isnotnull(t_hour#26437) AND isnotnull(t_minute#26438)) AND ((t_hour#26437 = 12) AND (t_minute#26438 < 30))) AND isnotnull(t_time_sk#26434L))
         :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26434L,t_time_id#26435,t_time#26436,t_hour#26437,t_minute#26438,t_second#26439,t_am_pm#26440,t_shift#26441,t_sub_shift#26442,t_meal_time#26443] orc
         :     +- Project [s_store_sk#26444L]
         :        +- Filter ((isnotnull(s_store_name#26449) AND (s_store_name#26449 = ese)) AND isnotnull(s_store_sk#26444L))
         :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26444L,s_store_id#26445,s_rec_start_date#26446,s_rec_end_date#26447,s_closed_date_sk#26448L,s_store_name#26449,s_number_employees#26450,s_floor_space#26451,s_hours#26452,s_manager#26453,s_market_id#26454,s_geography_class#26455,s_market_desc#26456,s_market_manager#26457,s_division_id#26458,s_division_name#26459,s_company_id#26460,s_company_name#26461,s_street_number#26462,s_street_name#26463,s_street_type#26464,s_suite_number#26465,s_city#26466,s_county#26467,... 5 more fields] orc
         +- Project [hd_demo_sk#26429L]
            +- Filter (((((hd_dep_count#26432 = 3) AND (hd_vehicle_count#26433 <= 5)) OR ((hd_dep_count#26432 = 0) AND (hd_vehicle_count#26433 <= 2))) OR ((hd_dep_count#26432 = 1) AND (hd_vehicle_count#26433 <= 3))) AND isnotnull(hd_demo_sk#26429L))
               +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26429L,hd_income_band_sk#26430L,hd_buy_potential#26431,hd_dep_count#26432,hd_vehicle_count#26433] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- BroadcastNestedLoopJoin BuildRight, Inner
   :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :  :  :- BroadcastNestedLoopJoin BuildRight, Inner
   :  :  :  :  :  :  :- HashAggregate(keys=[], functions=[count(1)], output=[h8_30_to_9#25921L])
   :  :  :  :  :  :  :  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27487]
   :  :  :  :  :  :  :     +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26482L])
   :  :  :  :  :  :  :        +- Project
   :  :  :  :  :  :  :           +- BroadcastHashJoin [ss_hdemo_sk#25941L], [hd_demo_sk#25960L], Inner, BuildRight, false
   :  :  :  :  :  :  :              :- Project [ss_hdemo_sk#25941L]
   :  :  :  :  :  :  :              :  +- BroadcastHashJoin [ss_store_sk#25943L], [s_store_sk#25975L], Inner, BuildRight, false
   :  :  :  :  :  :  :              :     :- Project [ss_hdemo_sk#25941L, ss_store_sk#25943L]
   :  :  :  :  :  :  :              :     :  +- BroadcastHashJoin [ss_sold_time_sk#25937L], [t_time_sk#25965L], Inner, BuildRight, false
   :  :  :  :  :  :  :              :     :     :- Project [ss_sold_time_sk#25937L, ss_hdemo_sk#25941L, ss_store_sk#25943L]
   :  :  :  :  :  :  :              :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#25941L) AND isnotnull(ss_sold_time_sk#25937L)) AND isnotnull(ss_store_sk#25943L))
   :  :  :  :  :  :  :              :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#25937L,ss_hdemo_sk#25941L,ss_store_sk#25943L,ss_sold_date_sk#25959L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#25941L), isnotnull(ss_sold_time_sk#25937L), isnotnull(ss_store_sk#25943L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :  :  :  :  :  :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27474]
   :  :  :  :  :  :  :              :     :        +- Project [t_time_sk#25965L]
   :  :  :  :  :  :  :              :     :           +- Filter ((((isnotnull(t_hour#25968) AND isnotnull(t_minute#25969)) AND (t_hour#25968 = 8)) AND (t_minute#25969 >= 30)) AND isnotnull(t_time_sk#25965L))
   :  :  :  :  :  :  :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#25965L,t_hour#25968,t_minute#25969] Batched: true, DataFilters: [isnotnull(t_hour#25968), isnotnull(t_minute#25969), (t_hour#25968 = 8), (t_minute#25969 >= 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,8), GreaterThanOrEqual(t_minute,30), IsNo..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :  :  :  :  :  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27478]
   :  :  :  :  :  :  :              :        +- Project [s_store_sk#25975L]
   :  :  :  :  :  :  :              :           +- Filter ((isnotnull(s_store_name#25980) AND (s_store_name#25980 = ese)) AND isnotnull(s_store_sk#25975L))
   :  :  :  :  :  :  :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#25975L,s_store_name#25980] Batched: true, DataFilters: [isnotnull(s_store_name#25980), (s_store_name#25980 = ese), isnotnull(s_store_sk#25975L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :  :  :  :  :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27482]
   :  :  :  :  :  :  :                 +- Project [hd_demo_sk#25960L]
   :  :  :  :  :  :  :                    +- Filter (((((hd_dep_count#25963 = 3) AND (hd_vehicle_count#25964 <= 5)) OR ((hd_dep_count#25963 = 0) AND (hd_vehicle_count#25964 <= 2))) OR ((hd_dep_count#25963 = 1) AND (hd_vehicle_count#25964 <= 3))) AND isnotnull(hd_demo_sk#25960L))
   :  :  :  :  :  :  :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#25960L,hd_dep_count#25963,hd_vehicle_count#25964] Batched: true, DataFilters: [((((hd_dep_count#25963 = 3) AND (hd_vehicle_count#25964 <= 5)) OR ((hd_dep_count#25963 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  :  :  :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#27505]
   :  :  :  :  :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[h9_to_9_30#25922L])
   :  :  :  :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27502]
   :  :  :  :  :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26484L])
   :  :  :  :  :  :              +- Project
   :  :  :  :  :  :                 +- BroadcastHashJoin [ss_hdemo_sk#26008L], [hd_demo_sk#26027L], Inner, BuildRight, false
   :  :  :  :  :  :                    :- Project [ss_hdemo_sk#26008L]
   :  :  :  :  :  :                    :  +- BroadcastHashJoin [ss_store_sk#26010L], [s_store_sk#26042L], Inner, BuildRight, false
   :  :  :  :  :  :                    :     :- Project [ss_hdemo_sk#26008L, ss_store_sk#26010L]
   :  :  :  :  :  :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26004L], [t_time_sk#26032L], Inner, BuildRight, false
   :  :  :  :  :  :                    :     :     :- Project [ss_sold_time_sk#26004L, ss_hdemo_sk#26008L, ss_store_sk#26010L]
   :  :  :  :  :  :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26008L) AND isnotnull(ss_sold_time_sk#26004L)) AND isnotnull(ss_store_sk#26010L))
   :  :  :  :  :  :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26004L,ss_hdemo_sk#26008L,ss_store_sk#26010L,ss_sold_date_sk#26026L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26008L), isnotnull(ss_sold_time_sk#26004L), isnotnull(ss_store_sk#26010L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :  :  :  :  :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27489]
   :  :  :  :  :  :                    :     :        +- Project [t_time_sk#26032L]
   :  :  :  :  :  :                    :     :           +- Filter ((((isnotnull(t_hour#26035) AND isnotnull(t_minute#26036)) AND (t_hour#26035 = 9)) AND (t_minute#26036 < 30)) AND isnotnull(t_time_sk#26032L))
   :  :  :  :  :  :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26032L,t_hour#26035,t_minute#26036] Batched: true, DataFilters: [isnotnull(t_hour#26035), isnotnull(t_minute#26036), (t_hour#26035 = 9), (t_minute#26036 < 30), i..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,9), LessThan(t_minute,30), IsNotNull(t_ti..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :  :  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27493]
   :  :  :  :  :  :                    :        +- Project [s_store_sk#26042L]
   :  :  :  :  :  :                    :           +- Filter ((isnotnull(s_store_name#26047) AND (s_store_name#26047 = ese)) AND isnotnull(s_store_sk#26042L))
   :  :  :  :  :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26042L,s_store_name#26047] Batched: true, DataFilters: [isnotnull(s_store_name#26047), (s_store_name#26047 = ese), isnotnull(s_store_sk#26042L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :  :  :  :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27497]
   :  :  :  :  :  :                       +- Project [hd_demo_sk#26027L]
   :  :  :  :  :  :                          +- Filter (((((hd_dep_count#26030 = 3) AND (hd_vehicle_count#26031 <= 5)) OR ((hd_dep_count#26030 = 0) AND (hd_vehicle_count#26031 <= 2))) OR ((hd_dep_count#26030 = 1) AND (hd_vehicle_count#26031 <= 3))) AND isnotnull(hd_demo_sk#26027L))
   :  :  :  :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26027L,hd_dep_count#26030,hd_vehicle_count#26031] Batched: true, DataFilters: [((((hd_dep_count#26030 = 3) AND (hd_vehicle_count#26031 <= 5)) OR ((hd_dep_count#26030 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  :  :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#27523]
   :  :  :  :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[h9_30_to_10#25923L])
   :  :  :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27520]
   :  :  :  :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26486L])
   :  :  :  :  :              +- Project
   :  :  :  :  :                 +- BroadcastHashJoin [ss_hdemo_sk#26075L], [hd_demo_sk#26094L], Inner, BuildRight, false
   :  :  :  :  :                    :- Project [ss_hdemo_sk#26075L]
   :  :  :  :  :                    :  +- BroadcastHashJoin [ss_store_sk#26077L], [s_store_sk#26109L], Inner, BuildRight, false
   :  :  :  :  :                    :     :- Project [ss_hdemo_sk#26075L, ss_store_sk#26077L]
   :  :  :  :  :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26071L], [t_time_sk#26099L], Inner, BuildRight, false
   :  :  :  :  :                    :     :     :- Project [ss_sold_time_sk#26071L, ss_hdemo_sk#26075L, ss_store_sk#26077L]
   :  :  :  :  :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26075L) AND isnotnull(ss_sold_time_sk#26071L)) AND isnotnull(ss_store_sk#26077L))
   :  :  :  :  :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26071L,ss_hdemo_sk#26075L,ss_store_sk#26077L,ss_sold_date_sk#26093L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26075L), isnotnull(ss_sold_time_sk#26071L), isnotnull(ss_store_sk#26077L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :  :  :  :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27507]
   :  :  :  :  :                    :     :        +- Project [t_time_sk#26099L]
   :  :  :  :  :                    :     :           +- Filter ((((isnotnull(t_hour#26102) AND isnotnull(t_minute#26103)) AND (t_hour#26102 = 9)) AND (t_minute#26103 >= 30)) AND isnotnull(t_time_sk#26099L))
   :  :  :  :  :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26099L,t_hour#26102,t_minute#26103] Batched: true, DataFilters: [isnotnull(t_hour#26102), isnotnull(t_minute#26103), (t_hour#26102 = 9), (t_minute#26103 >= 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,9), GreaterThanOrEqual(t_minute,30), IsNo..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27511]
   :  :  :  :  :                    :        +- Project [s_store_sk#26109L]
   :  :  :  :  :                    :           +- Filter ((isnotnull(s_store_name#26114) AND (s_store_name#26114 = ese)) AND isnotnull(s_store_sk#26109L))
   :  :  :  :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26109L,s_store_name#26114] Batched: true, DataFilters: [isnotnull(s_store_name#26114), (s_store_name#26114 = ese), isnotnull(s_store_sk#26109L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :  :  :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27515]
   :  :  :  :  :                       +- Project [hd_demo_sk#26094L]
   :  :  :  :  :                          +- Filter (((((hd_dep_count#26097 = 3) AND (hd_vehicle_count#26098 <= 5)) OR ((hd_dep_count#26097 = 0) AND (hd_vehicle_count#26098 <= 2))) OR ((hd_dep_count#26097 = 1) AND (hd_vehicle_count#26098 <= 3))) AND isnotnull(hd_demo_sk#26094L))
   :  :  :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26094L,hd_dep_count#26097,hd_vehicle_count#26098] Batched: true, DataFilters: [((((hd_dep_count#26097 = 3) AND (hd_vehicle_count#26098 <= 5)) OR ((hd_dep_count#26097 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#27541]
   :  :  :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[h10_to_10_30#25924L])
   :  :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27538]
   :  :  :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26488L])
   :  :  :  :              +- Project
   :  :  :  :                 +- BroadcastHashJoin [ss_hdemo_sk#26142L], [hd_demo_sk#26161L], Inner, BuildRight, false
   :  :  :  :                    :- Project [ss_hdemo_sk#26142L]
   :  :  :  :                    :  +- BroadcastHashJoin [ss_store_sk#26144L], [s_store_sk#26176L], Inner, BuildRight, false
   :  :  :  :                    :     :- Project [ss_hdemo_sk#26142L, ss_store_sk#26144L]
   :  :  :  :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26138L], [t_time_sk#26166L], Inner, BuildRight, false
   :  :  :  :                    :     :     :- Project [ss_sold_time_sk#26138L, ss_hdemo_sk#26142L, ss_store_sk#26144L]
   :  :  :  :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26142L) AND isnotnull(ss_sold_time_sk#26138L)) AND isnotnull(ss_store_sk#26144L))
   :  :  :  :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26138L,ss_hdemo_sk#26142L,ss_store_sk#26144L,ss_sold_date_sk#26160L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26142L), isnotnull(ss_sold_time_sk#26138L), isnotnull(ss_store_sk#26144L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :  :  :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27525]
   :  :  :  :                    :     :        +- Project [t_time_sk#26166L]
   :  :  :  :                    :     :           +- Filter ((((isnotnull(t_hour#26169) AND isnotnull(t_minute#26170)) AND (t_hour#26169 = 10)) AND (t_minute#26170 < 30)) AND isnotnull(t_time_sk#26166L))
   :  :  :  :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26166L,t_hour#26169,t_minute#26170] Batched: true, DataFilters: [isnotnull(t_hour#26169), isnotnull(t_minute#26170), (t_hour#26169 = 10), (t_minute#26170 < 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,10), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27529]
   :  :  :  :                    :        +- Project [s_store_sk#26176L]
   :  :  :  :                    :           +- Filter ((isnotnull(s_store_name#26181) AND (s_store_name#26181 = ese)) AND isnotnull(s_store_sk#26176L))
   :  :  :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26176L,s_store_name#26181] Batched: true, DataFilters: [isnotnull(s_store_name#26181), (s_store_name#26181 = ese), isnotnull(s_store_sk#26176L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :  :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27533]
   :  :  :  :                       +- Project [hd_demo_sk#26161L]
   :  :  :  :                          +- Filter (((((hd_dep_count#26164 = 3) AND (hd_vehicle_count#26165 <= 5)) OR ((hd_dep_count#26164 = 0) AND (hd_vehicle_count#26165 <= 2))) OR ((hd_dep_count#26164 = 1) AND (hd_vehicle_count#26165 <= 3))) AND isnotnull(hd_demo_sk#26161L))
   :  :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26161L,hd_dep_count#26164,hd_vehicle_count#26165] Batched: true, DataFilters: [((((hd_dep_count#26164 = 3) AND (hd_vehicle_count#26165 <= 5)) OR ((hd_dep_count#26164 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#27559]
   :  :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[h10_30_to_11#25925L])
   :  :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27556]
   :  :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26490L])
   :  :  :              +- Project
   :  :  :                 +- BroadcastHashJoin [ss_hdemo_sk#26209L], [hd_demo_sk#26228L], Inner, BuildRight, false
   :  :  :                    :- Project [ss_hdemo_sk#26209L]
   :  :  :                    :  +- BroadcastHashJoin [ss_store_sk#26211L], [s_store_sk#26243L], Inner, BuildRight, false
   :  :  :                    :     :- Project [ss_hdemo_sk#26209L, ss_store_sk#26211L]
   :  :  :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26205L], [t_time_sk#26233L], Inner, BuildRight, false
   :  :  :                    :     :     :- Project [ss_sold_time_sk#26205L, ss_hdemo_sk#26209L, ss_store_sk#26211L]
   :  :  :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26209L) AND isnotnull(ss_sold_time_sk#26205L)) AND isnotnull(ss_store_sk#26211L))
   :  :  :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26205L,ss_hdemo_sk#26209L,ss_store_sk#26211L,ss_sold_date_sk#26227L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26209L), isnotnull(ss_sold_time_sk#26205L), isnotnull(ss_store_sk#26211L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :  :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27543]
   :  :  :                    :     :        +- Project [t_time_sk#26233L]
   :  :  :                    :     :           +- Filter ((((isnotnull(t_hour#26236) AND isnotnull(t_minute#26237)) AND (t_hour#26236 = 10)) AND (t_minute#26237 >= 30)) AND isnotnull(t_time_sk#26233L))
   :  :  :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26233L,t_hour#26236,t_minute#26237] Batched: true, DataFilters: [isnotnull(t_hour#26236), isnotnull(t_minute#26237), (t_hour#26236 = 10), (t_minute#26237 >= 30),..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,10), GreaterThanOrEqual(t_minute,30), IsN..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27547]
   :  :  :                    :        +- Project [s_store_sk#26243L]
   :  :  :                    :           +- Filter ((isnotnull(s_store_name#26248) AND (s_store_name#26248 = ese)) AND isnotnull(s_store_sk#26243L))
   :  :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26243L,s_store_name#26248] Batched: true, DataFilters: [isnotnull(s_store_name#26248), (s_store_name#26248 = ese), isnotnull(s_store_sk#26243L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27551]
   :  :  :                       +- Project [hd_demo_sk#26228L]
   :  :  :                          +- Filter (((((hd_dep_count#26231 = 3) AND (hd_vehicle_count#26232 <= 5)) OR ((hd_dep_count#26231 = 0) AND (hd_vehicle_count#26232 <= 2))) OR ((hd_dep_count#26231 = 1) AND (hd_vehicle_count#26232 <= 3))) AND isnotnull(hd_demo_sk#26228L))
   :  :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26228L,hd_dep_count#26231,hd_vehicle_count#26232] Batched: true, DataFilters: [((((hd_dep_count#26231 = 3) AND (hd_vehicle_count#26232 <= 5)) OR ((hd_dep_count#26231 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  :  +- BroadcastExchange IdentityBroadcastMode, [id=#27577]
   :  :     +- HashAggregate(keys=[], functions=[count(1)], output=[h11_to_11_30#25926L])
   :  :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27574]
   :  :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26492L])
   :  :              +- Project
   :  :                 +- BroadcastHashJoin [ss_hdemo_sk#26276L], [hd_demo_sk#26295L], Inner, BuildRight, false
   :  :                    :- Project [ss_hdemo_sk#26276L]
   :  :                    :  +- BroadcastHashJoin [ss_store_sk#26278L], [s_store_sk#26310L], Inner, BuildRight, false
   :  :                    :     :- Project [ss_hdemo_sk#26276L, ss_store_sk#26278L]
   :  :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26272L], [t_time_sk#26300L], Inner, BuildRight, false
   :  :                    :     :     :- Project [ss_sold_time_sk#26272L, ss_hdemo_sk#26276L, ss_store_sk#26278L]
   :  :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26276L) AND isnotnull(ss_sold_time_sk#26272L)) AND isnotnull(ss_store_sk#26278L))
   :  :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26272L,ss_hdemo_sk#26276L,ss_store_sk#26278L,ss_sold_date_sk#26294L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26276L), isnotnull(ss_sold_time_sk#26272L), isnotnull(ss_store_sk#26278L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :  :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27561]
   :  :                    :     :        +- Project [t_time_sk#26300L]
   :  :                    :     :           +- Filter ((((isnotnull(t_hour#26303) AND isnotnull(t_minute#26304)) AND (t_hour#26303 = 11)) AND (t_minute#26304 < 30)) AND isnotnull(t_time_sk#26300L))
   :  :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26300L,t_hour#26303,t_minute#26304] Batched: true, DataFilters: [isnotnull(t_hour#26303), isnotnull(t_minute#26304), (t_hour#26303 = 11), (t_minute#26304 < 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,11), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27565]
   :  :                    :        +- Project [s_store_sk#26310L]
   :  :                    :           +- Filter ((isnotnull(s_store_name#26315) AND (s_store_name#26315 = ese)) AND isnotnull(s_store_sk#26310L))
   :  :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26310L,s_store_name#26315] Batched: true, DataFilters: [isnotnull(s_store_name#26315), (s_store_name#26315 = ese), isnotnull(s_store_sk#26310L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27569]
   :  :                       +- Project [hd_demo_sk#26295L]
   :  :                          +- Filter (((((hd_dep_count#26298 = 3) AND (hd_vehicle_count#26299 <= 5)) OR ((hd_dep_count#26298 = 0) AND (hd_vehicle_count#26299 <= 2))) OR ((hd_dep_count#26298 = 1) AND (hd_vehicle_count#26299 <= 3))) AND isnotnull(hd_demo_sk#26295L))
   :  :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26295L,hd_dep_count#26298,hd_vehicle_count#26299] Batched: true, DataFilters: [((((hd_dep_count#26298 = 3) AND (hd_vehicle_count#26299 <= 5)) OR ((hd_dep_count#26298 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   :  +- BroadcastExchange IdentityBroadcastMode, [id=#27595]
   :     +- HashAggregate(keys=[], functions=[count(1)], output=[h11_30_to_12#25927L])
   :        +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27592]
   :           +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26494L])
   :              +- Project
   :                 +- BroadcastHashJoin [ss_hdemo_sk#26343L], [hd_demo_sk#26362L], Inner, BuildRight, false
   :                    :- Project [ss_hdemo_sk#26343L]
   :                    :  +- BroadcastHashJoin [ss_store_sk#26345L], [s_store_sk#26377L], Inner, BuildRight, false
   :                    :     :- Project [ss_hdemo_sk#26343L, ss_store_sk#26345L]
   :                    :     :  +- BroadcastHashJoin [ss_sold_time_sk#26339L], [t_time_sk#26367L], Inner, BuildRight, false
   :                    :     :     :- Project [ss_sold_time_sk#26339L, ss_hdemo_sk#26343L, ss_store_sk#26345L]
   :                    :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26343L) AND isnotnull(ss_sold_time_sk#26339L)) AND isnotnull(ss_store_sk#26345L))
   :                    :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26339L,ss_hdemo_sk#26343L,ss_store_sk#26345L,ss_sold_date_sk#26361L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26343L), isnotnull(ss_sold_time_sk#26339L), isnotnull(ss_store_sk#26345L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
   :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27579]
   :                    :     :        +- Project [t_time_sk#26367L]
   :                    :     :           +- Filter ((((isnotnull(t_hour#26370) AND isnotnull(t_minute#26371)) AND (t_hour#26370 = 11)) AND (t_minute#26371 >= 30)) AND isnotnull(t_time_sk#26367L))
   :                    :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26367L,t_hour#26370,t_minute#26371] Batched: true, DataFilters: [isnotnull(t_hour#26370), isnotnull(t_minute#26371), (t_hour#26370 = 11), (t_minute#26371 >= 30),..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,11), GreaterThanOrEqual(t_minute,30), IsN..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
   :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27583]
   :                    :        +- Project [s_store_sk#26377L]
   :                    :           +- Filter ((isnotnull(s_store_name#26382) AND (s_store_name#26382 = ese)) AND isnotnull(s_store_sk#26377L))
   :                    :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26377L,s_store_name#26382] Batched: true, DataFilters: [isnotnull(s_store_name#26382), (s_store_name#26382 = ese), isnotnull(s_store_sk#26377L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
   :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27587]
   :                       +- Project [hd_demo_sk#26362L]
   :                          +- Filter (((((hd_dep_count#26365 = 3) AND (hd_vehicle_count#26366 <= 5)) OR ((hd_dep_count#26365 = 0) AND (hd_vehicle_count#26366 <= 2))) OR ((hd_dep_count#26365 = 1) AND (hd_vehicle_count#26366 <= 3))) AND isnotnull(hd_demo_sk#26362L))
   :                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26362L,hd_dep_count#26365,hd_vehicle_count#26366] Batched: true, DataFilters: [((((hd_dep_count#26365 = 3) AND (hd_vehicle_count#26366 <= 5)) OR ((hd_dep_count#26365 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>
   +- BroadcastExchange IdentityBroadcastMode, [id=#27613]
      +- HashAggregate(keys=[], functions=[count(1)], output=[h12_to_12_30#25928L])
         +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27610]
            +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26496L])
               +- Project
                  +- BroadcastHashJoin [ss_hdemo_sk#26410L], [hd_demo_sk#26429L], Inner, BuildRight, false
                     :- Project [ss_hdemo_sk#26410L]
                     :  +- BroadcastHashJoin [ss_store_sk#26412L], [s_store_sk#26444L], Inner, BuildRight, false
                     :     :- Project [ss_hdemo_sk#26410L, ss_store_sk#26412L]
                     :     :  +- BroadcastHashJoin [ss_sold_time_sk#26406L], [t_time_sk#26434L], Inner, BuildRight, false
                     :     :     :- Project [ss_sold_time_sk#26406L, ss_hdemo_sk#26410L, ss_store_sk#26412L]
                     :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#26410L) AND isnotnull(ss_sold_time_sk#26406L)) AND isnotnull(ss_store_sk#26412L))
                     :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26406L,ss_hdemo_sk#26410L,ss_store_sk#26412L,ss_sold_date_sk#26428L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#26410L), isnotnull(ss_sold_time_sk#26406L), isnotnull(ss_store_sk#26412L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27597]
                     :     :        +- Project [t_time_sk#26434L]
                     :     :           +- Filter ((((isnotnull(t_hour#26437) AND isnotnull(t_minute#26438)) AND (t_hour#26437 = 12)) AND (t_minute#26438 < 30)) AND isnotnull(t_time_sk#26434L))
                     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26434L,t_hour#26437,t_minute#26438] Batched: true, DataFilters: [isnotnull(t_hour#26437), isnotnull(t_minute#26438), (t_hour#26437 = 12), (t_minute#26438 < 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,12), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27601]
                     :        +- Project [s_store_sk#26444L]
                     :           +- Filter ((isnotnull(s_store_name#26449) AND (s_store_name#26449 = ese)) AND isnotnull(s_store_sk#26444L))
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26444L,s_store_name#26449] Batched: true, DataFilters: [isnotnull(s_store_name#26449), (s_store_name#26449 = ese), isnotnull(s_store_sk#26444L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27605]
                        +- Project [hd_demo_sk#26429L]
                           +- Filter (((((hd_dep_count#26432 = 3) AND (hd_vehicle_count#26433 <= 5)) OR ((hd_dep_count#26432 = 0) AND (hd_vehicle_count#26433 <= 2))) OR ((hd_dep_count#26432 = 1) AND (hd_vehicle_count#26433 <= 3))) AND isnotnull(hd_demo_sk#26429L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26429L,hd_dep_count#26432,hd_vehicle_count#26433] Batched: true, DataFilters: [((((hd_dep_count#26432 = 3) AND (hd_vehicle_count#26433 <= 5)) OR ((hd_dep_count#26432 = 0) AND ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,3),LessThanOrEqual(hd_vehicle_count,5)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int,hd_vehicle_count:int>

read query: spark_queries/q89.sql
explain query: q89
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true
      +- 'Project [*]
         +- 'Filter (CASE WHEN NOT ('avg_monthly_sales = 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1)
            +- 'SubqueryAlias tmp1
               +- 'Aggregate ['i_category, 'i_class, 'i_brand, 's_store_name, 's_company_name, 'd_moy], ['i_category, 'i_class, 'i_brand, 's_store_name, 's_company_name, 'd_moy, 'sum('ss_sales_price) AS sum_sales#26497, 'avg('sum('ss_sales_price)) windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, unspecifiedframe$()) AS avg_monthly_sales#26498]
                  +- 'Filter (((('ss_item_sk = 'i_item_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND ('ss_store_sk = 's_store_sk)) AND ('d_year IN (2000) AND (('i_category IN (Home,Books,Electronics) AND 'i_class IN (wallpaper,parenting,musical)) OR ('i_category IN (Shoes,Jewelry,Men) AND 'i_class IN (womens,birdal,pants)))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'UnresolvedRelation [item], [], false
                        :  :  +- 'UnresolvedRelation [store_sales], [], false
                        :  +- 'UnresolvedRelation [date_dim], [], false
                        +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
i_category: string, i_class: string, i_brand: string, s_store_name: string, s_company_name: string, d_moy: int, sum_sales: double, avg_monthly_sales: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [(sum_sales#26497 - avg_monthly_sales#26498) ASC NULLS FIRST, s_store_name#26577 ASC NULLS FIRST], true
      +- Project [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, avg_monthly_sales#26498]
         +- Filter (CASE WHEN NOT (avg_monthly_sales#26498 = cast(0 as double)) THEN (abs((sum_sales#26497 - avg_monthly_sales#26498), false) / avg_monthly_sales#26498) ELSE cast(null as double) END > cast(0.1 as double))
            +- SubqueryAlias tmp1
               +- Project [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, avg_monthly_sales#26498]
                  +- Project [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, _w0#26604, avg_monthly_sales#26498, avg_monthly_sales#26498]
                     +- Window [avg(_w0#26604) windowspecdefinition(i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#26498], [i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589]
                        +- Aggregate [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552], [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum(ss_sales_price#26533) AS sum_sales#26497, sum(ss_sales_price#26533) AS _w0#26604]
                           +- Filter ((((ss_item_sk#26522L = i_item_sk#26499L) AND (ss_sold_date_sk#26543L = d_date_sk#26544L)) AND (ss_store_sk#26527L = s_store_sk#26572L)) AND (d_year#26550 IN (2000) AND ((i_category#26511 IN (Home,Books,Electronics) AND i_class#26509 IN (wallpaper,parenting,musical)) OR (i_category#26511 IN (Shoes,Jewelry,Men) AND i_class#26509 IN (womens,birdal,pants)))))
                              +- Join Inner
                                 :- Join Inner
                                 :  :- Join Inner
                                 :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                                 :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26499L,i_item_id#26500,i_rec_start_date#26501,i_rec_end_date#26502,i_item_desc#26503,i_current_price#26504,i_wholesale_cost#26505,i_brand_id#26506,i_brand#26507,i_class_id#26508,i_class#26509,i_category_id#26510,i_category#26511,i_manufact_id#26512,i_manufact#26513,i_size#26514,i_formulation#26515,i_color#26516,i_units#26517,i_container#26518,i_manager_id#26519,i_product_name#26520] orc
                                 :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                                 :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26521L,ss_item_sk#26522L,ss_customer_sk#26523L,ss_cdemo_sk#26524L,ss_hdemo_sk#26525L,ss_addr_sk#26526L,ss_store_sk#26527L,ss_promo_sk#26528L,ss_ticket_number#26529L,ss_quantity#26530,ss_wholesale_cost#26531,ss_list_price#26532,ss_sales_price#26533,ss_ext_discount_amt#26534,ss_ext_sales_price#26535,ss_ext_wholesale_cost#26536,ss_ext_list_price#26537,ss_ext_tax#26538,ss_coupon_amt#26539,ss_net_paid#26540,ss_net_paid_inc_tax#26541,ss_net_profit#26542,ss_sold_date_sk#26543L] orc
                                 :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26544L,d_date_id#26545,d_date#26546,d_month_seq#26547,d_week_seq#26548,d_quarter_seq#26549,d_year#26550,d_dow#26551,d_moy#26552,d_dom#26553,d_qoy#26554,d_fy_year#26555,d_fy_quarter_seq#26556,d_fy_week_seq#26557,d_day_name#26558,d_quarter_name#26559,d_holiday#26560,d_weekend#26561,d_following_holiday#26562,d_first_dom#26563,d_last_dom#26564,d_same_day_ly#26565,d_same_day_lq#26566,d_current_day#26567,... 4 more fields] orc
                                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                                    +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26572L,s_store_id#26573,s_rec_start_date#26574,s_rec_end_date#26575,s_closed_date_sk#26576L,s_store_name#26577,s_number_employees#26578,s_floor_space#26579,s_hours#26580,s_manager#26581,s_market_id#26582,s_geography_class#26583,s_market_desc#26584,s_market_manager#26585,s_division_id#26586,s_division_name#26587,s_company_id#26588,s_company_name#26589,s_street_number#26590,s_street_name#26591,s_street_type#26592,s_suite_number#26593,s_city#26594,s_county#26595,... 5 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [(sum_sales#26497 - avg_monthly_sales#26498) ASC NULLS FIRST, s_store_name#26577 ASC NULLS FIRST], true
      +- Project [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, avg_monthly_sales#26498]
         +- Filter ((isnotnull(avg_monthly_sales#26498) AND isnotnull(sum_sales#26497)) AND (NOT (avg_monthly_sales#26498 = 0.0) AND ((abs((sum_sales#26497 - avg_monthly_sales#26498), false) / avg_monthly_sales#26498) > 0.1)))
            +- Window [avg(_w0#26604) windowspecdefinition(i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#26498], [i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589]
               +- Aggregate [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552], [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum(ss_sales_price#26533) AS sum_sales#26497, sum(ss_sales_price#26533) AS _w0#26604]
                  +- Project [i_brand#26507, i_class#26509, i_category#26511, ss_sales_price#26533, d_moy#26552, s_store_name#26577, s_company_name#26589]
                     +- Join Inner, (ss_store_sk#26527L = s_store_sk#26572L)
                        :- Project [i_brand#26507, i_class#26509, i_category#26511, ss_store_sk#26527L, ss_sales_price#26533, d_moy#26552]
                        :  +- Join Inner, (ss_sold_date_sk#26543L = d_date_sk#26544L)
                        :     :- Project [i_brand#26507, i_class#26509, i_category#26511, ss_store_sk#26527L, ss_sales_price#26533, ss_sold_date_sk#26543L]
                        :     :  +- Join Inner, (ss_item_sk#26522L = i_item_sk#26499L)
                        :     :     :- Project [i_item_sk#26499L, i_brand#26507, i_class#26509, i_category#26511]
                        :     :     :  +- Filter (((i_category#26511 IN (Home,Books,Electronics) AND i_class#26509 IN (wallpaper,parenting,musical)) OR (i_category#26511 IN (Shoes,Jewelry,Men) AND i_class#26509 IN (womens,birdal,pants))) AND isnotnull(i_item_sk#26499L))
                        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26499L,i_item_id#26500,i_rec_start_date#26501,i_rec_end_date#26502,i_item_desc#26503,i_current_price#26504,i_wholesale_cost#26505,i_brand_id#26506,i_brand#26507,i_class_id#26508,i_class#26509,i_category_id#26510,i_category#26511,i_manufact_id#26512,i_manufact#26513,i_size#26514,i_formulation#26515,i_color#26516,i_units#26517,i_container#26518,i_manager_id#26519,i_product_name#26520] orc
                        :     :     +- Project [ss_item_sk#26522L, ss_store_sk#26527L, ss_sales_price#26533, ss_sold_date_sk#26543L]
                        :     :        +- Filter (((isnotnull(ss_item_sk#26522L) AND isnotnull(ss_sold_date_sk#26543L)) AND isnotnull(ss_store_sk#26527L)) AND dynamicpruning#26613 [ss_sold_date_sk#26543L])
                        :     :           :  +- Project [d_date_sk#26544L, d_moy#26552]
                        :     :           :     +- Filter ((isnotnull(d_year#26550) AND (d_year#26550 = 2000)) AND isnotnull(d_date_sk#26544L))
                        :     :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26544L,d_date_id#26545,d_date#26546,d_month_seq#26547,d_week_seq#26548,d_quarter_seq#26549,d_year#26550,d_dow#26551,d_moy#26552,d_dom#26553,d_qoy#26554,d_fy_year#26555,d_fy_quarter_seq#26556,d_fy_week_seq#26557,d_day_name#26558,d_quarter_name#26559,d_holiday#26560,d_weekend#26561,d_following_holiday#26562,d_first_dom#26563,d_last_dom#26564,d_same_day_ly#26565,d_same_day_lq#26566,d_current_day#26567,... 4 more fields] orc
                        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#26521L,ss_item_sk#26522L,ss_customer_sk#26523L,ss_cdemo_sk#26524L,ss_hdemo_sk#26525L,ss_addr_sk#26526L,ss_store_sk#26527L,ss_promo_sk#26528L,ss_ticket_number#26529L,ss_quantity#26530,ss_wholesale_cost#26531,ss_list_price#26532,ss_sales_price#26533,ss_ext_discount_amt#26534,ss_ext_sales_price#26535,ss_ext_wholesale_cost#26536,ss_ext_list_price#26537,ss_ext_tax#26538,ss_coupon_amt#26539,ss_net_paid#26540,ss_net_paid_inc_tax#26541,ss_net_profit#26542,ss_sold_date_sk#26543L] orc
                        :     +- Project [d_date_sk#26544L, d_moy#26552]
                        :        +- Filter ((isnotnull(d_year#26550) AND (d_year#26550 = 2000)) AND isnotnull(d_date_sk#26544L))
                        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26544L,d_date_id#26545,d_date#26546,d_month_seq#26547,d_week_seq#26548,d_quarter_seq#26549,d_year#26550,d_dow#26551,d_moy#26552,d_dom#26553,d_qoy#26554,d_fy_year#26555,d_fy_quarter_seq#26556,d_fy_week_seq#26557,d_day_name#26558,d_quarter_name#26559,d_holiday#26560,d_weekend#26561,d_following_holiday#26562,d_first_dom#26563,d_last_dom#26564,d_same_day_ly#26565,d_same_day_lq#26566,d_current_day#26567,... 4 more fields] orc
                        +- Project [s_store_sk#26572L, s_store_name#26577, s_company_name#26589]
                           +- Filter isnotnull(s_store_sk#26572L)
                              +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26572L,s_store_id#26573,s_rec_start_date#26574,s_rec_end_date#26575,s_closed_date_sk#26576L,s_store_name#26577,s_number_employees#26578,s_floor_space#26579,s_hours#26580,s_manager#26581,s_market_id#26582,s_geography_class#26583,s_market_desc#26584,s_market_manager#26585,s_division_id#26586,s_division_name#26587,s_company_id#26588,s_company_name#26589,s_street_number#26590,s_street_name#26591,s_street_type#26592,s_suite_number#26593,s_city#26594,s_county#26595,... 5 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[(sum_sales#26497 - avg_monthly_sales#26498) ASC NULLS FIRST,s_store_name#26577 ASC NULLS FIRST], output=[i_category#26511,i_class#26509,i_brand#26507,s_store_name#26577,s_company_name#26589,d_moy#26552,sum_sales#26497,avg_monthly_sales#26498])
   +- Project [i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, avg_monthly_sales#26498]
      +- Filter ((isnotnull(avg_monthly_sales#26498) AND isnotnull(sum_sales#26497)) AND (NOT (avg_monthly_sales#26498 = 0.0) AND ((abs((sum_sales#26497 - avg_monthly_sales#26498), false) / avg_monthly_sales#26498) > 0.1)))
         +- Window [avg(_w0#26604) windowspecdefinition(i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#26498], [i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589]
            +- Sort [i_category#26511 ASC NULLS FIRST, i_brand#26507 ASC NULLS FIRST, s_store_name#26577 ASC NULLS FIRST, s_company_name#26589 ASC NULLS FIRST], false, 0
               +- Exchange hashpartitioning(i_category#26511, i_brand#26507, s_store_name#26577, s_company_name#26589, 3000), ENSURE_REQUIREMENTS, [id=#27742]
                  +- HashAggregate(keys=[i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552], functions=[sum(ss_sales_price#26533)], output=[i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum_sales#26497, _w0#26604])
                     +- Exchange hashpartitioning(i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, 3000), ENSURE_REQUIREMENTS, [id=#27739]
                        +- HashAggregate(keys=[i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552], functions=[partial_sum(ss_sales_price#26533)], output=[i_category#26511, i_class#26509, i_brand#26507, s_store_name#26577, s_company_name#26589, d_moy#26552, sum#26615])
                           +- Project [i_brand#26507, i_class#26509, i_category#26511, ss_sales_price#26533, d_moy#26552, s_store_name#26577, s_company_name#26589]
                              +- BroadcastHashJoin [ss_store_sk#26527L], [s_store_sk#26572L], Inner, BuildRight, false
                                 :- Project [i_brand#26507, i_class#26509, i_category#26511, ss_store_sk#26527L, ss_sales_price#26533, d_moy#26552]
                                 :  +- BroadcastHashJoin [ss_sold_date_sk#26543L], [d_date_sk#26544L], Inner, BuildRight, false
                                 :     :- Project [i_brand#26507, i_class#26509, i_category#26511, ss_store_sk#26527L, ss_sales_price#26533, ss_sold_date_sk#26543L]
                                 :     :  +- BroadcastHashJoin [i_item_sk#26499L], [ss_item_sk#26522L], Inner, BuildLeft, false
                                 :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#27726]
                                 :     :     :  +- Filter (((i_category#26511 IN (Home,Books,Electronics) AND i_class#26509 IN (wallpaper,parenting,musical)) OR (i_category#26511 IN (Shoes,Jewelry,Men) AND i_class#26509 IN (womens,birdal,pants))) AND isnotnull(i_item_sk#26499L))
                                 :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26499L,i_brand#26507,i_class#26509,i_category#26511] Batched: true, DataFilters: [((i_category#26511 IN (Home,Books,Electronics) AND i_class#26509 IN (wallpaper,parenting,musical..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(In(i_category, [Books,Electronics,Home]),In(i_class, [musical,parenting,wallpaper])),And(..., ReadSchema: struct<i_item_sk:bigint,i_brand:string,i_class:string,i_category:string>
                                 :     :     +- Filter (isnotnull(ss_item_sk#26522L) AND isnotnull(ss_store_sk#26527L))
                                 :     :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#26522L,ss_store_sk#26527L,ss_sales_price#26533,ss_sold_date_sk#26543L] Batched: true, DataFilters: [isnotnull(ss_item_sk#26522L), isnotnull(ss_store_sk#26527L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#26543L), dynamicpruningexpression(ss_sold_date_sk#26543L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_store_sk:bigint,ss_sales_price:double>
                                 :     :              +- SubqueryAdaptiveBroadcast dynamicpruning#26613, 0, true, Project [d_date_sk#26544L, d_moy#26552], [d_date_sk#26544L]
                                 :     :                 +- AdaptiveSparkPlan isFinalPlan=false
                                 :     :                    +- Project [d_date_sk#26544L, d_moy#26552]
                                 :     :                       +- Filter ((isnotnull(d_year#26550) AND (d_year#26550 = 2000)) AND isnotnull(d_date_sk#26544L))
                                 :     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26544L,d_year#26550,d_moy#26552] Batched: true, DataFilters: [isnotnull(d_year#26550), (d_year#26550 = 2000), isnotnull(d_date_sk#26544L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27730]
                                 :        +- Project [d_date_sk#26544L, d_moy#26552]
                                 :           +- Filter ((isnotnull(d_year#26550) AND (d_year#26550 = 2000)) AND isnotnull(d_date_sk#26544L))
                                 :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26544L,d_year#26550,d_moy#26552] Batched: true, DataFilters: [isnotnull(d_year#26550), (d_year#26550 = 2000), isnotnull(d_date_sk#26544L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#27734]
                                    +- Filter isnotnull(s_store_sk#26572L)
                                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#26572L,s_store_name#26577,s_company_name#26589] Batched: true, DataFilters: [isnotnull(s_store_sk#26572L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string,s_company_name:string>

read query: spark_queries/q90.sql
explain query: q90
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['am_pm_ratio ASC NULLS FIRST], true
      +- 'Project [(cast('amc as decimal(15,4)) / cast('pmc as decimal(15,4))) AS am_pm_ratio#26618]
         +- 'Join Inner
            :- 'SubqueryAlias at
            :  +- 'Project ['count(1) AS amc#26616]
            :     +- 'Filter (((('ws_sold_time_sk = 'time_dim.t_time_sk) AND ('ws_ship_hdemo_sk = 'household_demographics.hd_demo_sk)) AND ('ws_web_page_sk = 'web_page.wp_web_page_sk)) AND (((('time_dim.t_hour >= 6) AND ('time_dim.t_hour <= (6 + 1))) AND ('household_demographics.hd_dep_count = 8)) AND (('web_page.wp_char_count >= 5000) AND ('web_page.wp_char_count <= 5200))))
            :        +- 'Join Inner
            :           :- 'Join Inner
            :           :  :- 'Join Inner
            :           :  :  :- 'UnresolvedRelation [web_sales], [], false
            :           :  :  +- 'UnresolvedRelation [household_demographics], [], false
            :           :  +- 'UnresolvedRelation [time_dim], [], false
            :           +- 'UnresolvedRelation [web_page], [], false
            +- 'SubqueryAlias pt
               +- 'Project ['count(1) AS pmc#26617]
                  +- 'Filter (((('ws_sold_time_sk = 'time_dim.t_time_sk) AND ('ws_ship_hdemo_sk = 'household_demographics.hd_demo_sk)) AND ('ws_web_page_sk = 'web_page.wp_web_page_sk)) AND (((('time_dim.t_hour >= 14) AND ('time_dim.t_hour <= (14 + 1))) AND ('household_demographics.hd_dep_count = 8)) AND (('web_page.wp_char_count >= 5000) AND ('web_page.wp_char_count <= 5200))))
                     +- 'Join Inner
                        :- 'Join Inner
                        :  :- 'Join Inner
                        :  :  :- 'UnresolvedRelation [web_sales], [], false
                        :  :  +- 'UnresolvedRelation [household_demographics], [], false
                        :  +- 'UnresolvedRelation [time_dim], [], false
                        +- 'UnresolvedRelation [web_page], [], false

== Analyzed Logical Plan ==
am_pm_ratio: decimal(35,20)
GlobalLimit 100
+- LocalLimit 100
   +- Sort [am_pm_ratio#26618 ASC NULLS FIRST], true
      +- Project [CheckOverflow((promote_precision(cast(cast(amc#26616L as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(pmc#26617L as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20), true) AS am_pm_ratio#26618]
         +- Join Inner
            :- SubqueryAlias at
            :  +- Aggregate [count(1) AS amc#26616L]
            :     +- Filter ((((ws_sold_time_sk#26621L = t_time_sk#26660L) AND (ws_ship_hdemo_sk#26630L = hd_demo_sk#26655L)) AND (ws_web_page_sk#26632L = wp_web_page_sk#26670L)) AND ((((t_hour#26663 >= 6) AND (t_hour#26663 <= (6 + 1))) AND (hd_dep_count#26658 = 8)) AND ((wp_char_count#26680 >= 5000) AND (wp_char_count#26680 <= 5200))))
            :        +- Join Inner
            :           :- Join Inner
            :           :  :- Join Inner
            :           :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :           :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26621L,ws_ship_date_sk#26622L,ws_item_sk#26623L,ws_bill_customer_sk#26624L,ws_bill_cdemo_sk#26625L,ws_bill_hdemo_sk#26626L,ws_bill_addr_sk#26627L,ws_ship_customer_sk#26628L,ws_ship_cdemo_sk#26629L,ws_ship_hdemo_sk#26630L,ws_ship_addr_sk#26631L,ws_web_page_sk#26632L,ws_web_site_sk#26633L,ws_ship_mode_sk#26634L,ws_warehouse_sk#26635L,ws_promo_sk#26636L,ws_order_number#26637L,ws_quantity#26638,ws_wholesale_cost#26639,ws_list_price#26640,ws_sales_price#26641,ws_ext_discount_amt#26642,ws_ext_sales_price#26643,ws_ext_wholesale_cost#26644,... 10 more fields] orc
            :           :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
            :           :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26655L,hd_income_band_sk#26656L,hd_buy_potential#26657,hd_dep_count#26658,hd_vehicle_count#26659] orc
            :           :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
            :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26660L,t_time_id#26661,t_time#26662,t_hour#26663,t_minute#26664,t_second#26665,t_am_pm#26666,t_shift#26667,t_sub_shift#26668,t_meal_time#26669] orc
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_page
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26670L,wp_web_page_id#26671,wp_rec_start_date#26672,wp_rec_end_date#26673,wp_creation_date_sk#26674L,wp_access_date_sk#26675L,wp_autogen_flag#26676,wp_customer_sk#26677L,wp_url#26678,wp_type#26679,wp_char_count#26680,wp_link_count#26681,wp_image_count#26682,wp_max_ad_count#26683] orc
            +- SubqueryAlias pt
               +- Aggregate [count(1) AS pmc#26617L]
                  +- Filter ((((ws_sold_time_sk#26684L = t_time_sk#26723L) AND (ws_ship_hdemo_sk#26693L = hd_demo_sk#26718L)) AND (ws_web_page_sk#26695L = wp_web_page_sk#26733L)) AND ((((t_hour#26726 >= 14) AND (t_hour#26726 <= (14 + 1))) AND (hd_dep_count#26721 = 8)) AND ((wp_char_count#26743 >= 5000) AND (wp_char_count#26743 <= 5200))))
                     +- Join Inner
                        :- Join Inner
                        :  :- Join Inner
                        :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                        :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26684L,ws_ship_date_sk#26685L,ws_item_sk#26686L,ws_bill_customer_sk#26687L,ws_bill_cdemo_sk#26688L,ws_bill_hdemo_sk#26689L,ws_bill_addr_sk#26690L,ws_ship_customer_sk#26691L,ws_ship_cdemo_sk#26692L,ws_ship_hdemo_sk#26693L,ws_ship_addr_sk#26694L,ws_web_page_sk#26695L,ws_web_site_sk#26696L,ws_ship_mode_sk#26697L,ws_warehouse_sk#26698L,ws_promo_sk#26699L,ws_order_number#26700L,ws_quantity#26701,ws_wholesale_cost#26702,ws_list_price#26703,ws_sales_price#26704,ws_ext_discount_amt#26705,ws_ext_sales_price#26706,ws_ext_wholesale_cost#26707,... 10 more fields] orc
                        :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
                        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26718L,hd_income_band_sk#26719L,hd_buy_potential#26720,hd_dep_count#26721,hd_vehicle_count#26722] orc
                        :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
                        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26723L,t_time_id#26724,t_time#26725,t_hour#26726,t_minute#26727,t_second#26728,t_am_pm#26729,t_shift#26730,t_sub_shift#26731,t_meal_time#26732] orc
                        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_page
                           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26733L,wp_web_page_id#26734,wp_rec_start_date#26735,wp_rec_end_date#26736,wp_creation_date_sk#26737L,wp_access_date_sk#26738L,wp_autogen_flag#26739,wp_customer_sk#26740L,wp_url#26741,wp_type#26742,wp_char_count#26743,wp_link_count#26744,wp_image_count#26745,wp_max_ad_count#26746] orc

== Optimized Logical Plan ==
Project [CheckOverflow((promote_precision(cast(amc#26616L as decimal(15,4))) / promote_precision(cast(pmc#26617L as decimal(15,4)))), DecimalType(35,20), true) AS am_pm_ratio#26618]
+- Join Inner
   :- Aggregate [count(1) AS amc#26616L]
   :  +- Project
   :     +- Join Inner, (ws_ship_hdemo_sk#26630L = hd_demo_sk#26655L)
   :        :- Project [ws_ship_hdemo_sk#26630L]
   :        :  +- Join Inner, (ws_sold_time_sk#26621L = t_time_sk#26660L)
   :        :     :- Project [ws_sold_time_sk#26621L, ws_ship_hdemo_sk#26630L]
   :        :     :  +- Join Inner, (ws_web_page_sk#26632L = wp_web_page_sk#26670L)
   :        :     :     :- Project [ws_sold_time_sk#26621L, ws_ship_hdemo_sk#26630L, ws_web_page_sk#26632L]
   :        :     :     :  +- Filter (isnotnull(ws_ship_hdemo_sk#26630L) AND (isnotnull(ws_sold_time_sk#26621L) AND isnotnull(ws_web_page_sk#26632L)))
   :        :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26621L,ws_ship_date_sk#26622L,ws_item_sk#26623L,ws_bill_customer_sk#26624L,ws_bill_cdemo_sk#26625L,ws_bill_hdemo_sk#26626L,ws_bill_addr_sk#26627L,ws_ship_customer_sk#26628L,ws_ship_cdemo_sk#26629L,ws_ship_hdemo_sk#26630L,ws_ship_addr_sk#26631L,ws_web_page_sk#26632L,ws_web_site_sk#26633L,ws_ship_mode_sk#26634L,ws_warehouse_sk#26635L,ws_promo_sk#26636L,ws_order_number#26637L,ws_quantity#26638,ws_wholesale_cost#26639,ws_list_price#26640,ws_sales_price#26641,ws_ext_discount_amt#26642,ws_ext_sales_price#26643,ws_ext_wholesale_cost#26644,... 10 more fields] orc
   :        :     :     +- Project [wp_web_page_sk#26670L]
   :        :     :        +- Filter ((isnotnull(wp_char_count#26680) AND ((wp_char_count#26680 >= 5000) AND (wp_char_count#26680 <= 5200))) AND isnotnull(wp_web_page_sk#26670L))
   :        :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26670L,wp_web_page_id#26671,wp_rec_start_date#26672,wp_rec_end_date#26673,wp_creation_date_sk#26674L,wp_access_date_sk#26675L,wp_autogen_flag#26676,wp_customer_sk#26677L,wp_url#26678,wp_type#26679,wp_char_count#26680,wp_link_count#26681,wp_image_count#26682,wp_max_ad_count#26683] orc
   :        :     +- Project [t_time_sk#26660L]
   :        :        +- Filter ((isnotnull(t_hour#26663) AND ((t_hour#26663 >= 6) AND (t_hour#26663 <= 7))) AND isnotnull(t_time_sk#26660L))
   :        :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26660L,t_time_id#26661,t_time#26662,t_hour#26663,t_minute#26664,t_second#26665,t_am_pm#26666,t_shift#26667,t_sub_shift#26668,t_meal_time#26669] orc
   :        +- Project [hd_demo_sk#26655L]
   :           +- Filter ((isnotnull(hd_dep_count#26658) AND (hd_dep_count#26658 = 8)) AND isnotnull(hd_demo_sk#26655L))
   :              +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26655L,hd_income_band_sk#26656L,hd_buy_potential#26657,hd_dep_count#26658,hd_vehicle_count#26659] orc
   +- Aggregate [count(1) AS pmc#26617L]
      +- Project
         +- Join Inner, (ws_ship_hdemo_sk#26693L = hd_demo_sk#26718L)
            :- Project [ws_ship_hdemo_sk#26693L]
            :  +- Join Inner, (ws_sold_time_sk#26684L = t_time_sk#26723L)
            :     :- Project [ws_sold_time_sk#26684L, ws_ship_hdemo_sk#26693L]
            :     :  +- Join Inner, (ws_web_page_sk#26695L = wp_web_page_sk#26733L)
            :     :     :- Project [ws_sold_time_sk#26684L, ws_ship_hdemo_sk#26693L, ws_web_page_sk#26695L]
            :     :     :  +- Filter (isnotnull(ws_ship_hdemo_sk#26693L) AND (isnotnull(ws_sold_time_sk#26684L) AND isnotnull(ws_web_page_sk#26695L)))
            :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26684L,ws_ship_date_sk#26685L,ws_item_sk#26686L,ws_bill_customer_sk#26687L,ws_bill_cdemo_sk#26688L,ws_bill_hdemo_sk#26689L,ws_bill_addr_sk#26690L,ws_ship_customer_sk#26691L,ws_ship_cdemo_sk#26692L,ws_ship_hdemo_sk#26693L,ws_ship_addr_sk#26694L,ws_web_page_sk#26695L,ws_web_site_sk#26696L,ws_ship_mode_sk#26697L,ws_warehouse_sk#26698L,ws_promo_sk#26699L,ws_order_number#26700L,ws_quantity#26701,ws_wholesale_cost#26702,ws_list_price#26703,ws_sales_price#26704,ws_ext_discount_amt#26705,ws_ext_sales_price#26706,ws_ext_wholesale_cost#26707,... 10 more fields] orc
            :     :     +- Project [wp_web_page_sk#26733L]
            :     :        +- Filter ((isnotnull(wp_char_count#26743) AND ((wp_char_count#26743 >= 5000) AND (wp_char_count#26743 <= 5200))) AND isnotnull(wp_web_page_sk#26733L))
            :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26733L,wp_web_page_id#26734,wp_rec_start_date#26735,wp_rec_end_date#26736,wp_creation_date_sk#26737L,wp_access_date_sk#26738L,wp_autogen_flag#26739,wp_customer_sk#26740L,wp_url#26741,wp_type#26742,wp_char_count#26743,wp_link_count#26744,wp_image_count#26745,wp_max_ad_count#26746] orc
            :     +- Project [t_time_sk#26723L]
            :        +- Filter ((isnotnull(t_hour#26726) AND ((t_hour#26726 >= 14) AND (t_hour#26726 <= 15))) AND isnotnull(t_time_sk#26723L))
            :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26723L,t_time_id#26724,t_time#26725,t_hour#26726,t_minute#26727,t_second#26728,t_am_pm#26729,t_shift#26730,t_sub_shift#26731,t_meal_time#26732] orc
            +- Project [hd_demo_sk#26718L]
               +- Filter ((isnotnull(hd_dep_count#26721) AND (hd_dep_count#26721 = 8)) AND isnotnull(hd_demo_sk#26718L))
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26718L,hd_income_band_sk#26719L,hd_buy_potential#26720,hd_dep_count#26721,hd_vehicle_count#26722] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Project [CheckOverflow((promote_precision(cast(amc#26616L as decimal(15,4))) / promote_precision(cast(pmc#26617L as decimal(15,4)))), DecimalType(35,20), true) AS am_pm_ratio#26618]
   +- BroadcastNestedLoopJoin BuildRight, Inner
      :- HashAggregate(keys=[], functions=[count(1)], output=[amc#26616L])
      :  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27895]
      :     +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26749L])
      :        +- Project
      :           +- BroadcastHashJoin [ws_ship_hdemo_sk#26630L], [hd_demo_sk#26655L], Inner, BuildRight, false
      :              :- Project [ws_ship_hdemo_sk#26630L]
      :              :  +- BroadcastHashJoin [ws_sold_time_sk#26621L], [t_time_sk#26660L], Inner, BuildRight, false
      :              :     :- Project [ws_sold_time_sk#26621L, ws_ship_hdemo_sk#26630L]
      :              :     :  +- BroadcastHashJoin [ws_web_page_sk#26632L], [wp_web_page_sk#26670L], Inner, BuildRight, false
      :              :     :     :- Project [ws_sold_time_sk#26621L, ws_ship_hdemo_sk#26630L, ws_web_page_sk#26632L]
      :              :     :     :  +- Filter ((isnotnull(ws_ship_hdemo_sk#26630L) AND isnotnull(ws_sold_time_sk#26621L)) AND isnotnull(ws_web_page_sk#26632L))
      :              :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26621L,ws_ship_hdemo_sk#26630L,ws_web_page_sk#26632L,ws_sold_date_sk#26654L] Batched: true, DataFilters: [isnotnull(ws_ship_hdemo_sk#26630L), isnotnull(ws_sold_time_sk#26621L), isnotnull(ws_web_page_sk#..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_hdemo_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_sold_time_sk:bigint,ws_ship_hdemo_sk:bigint,ws_web_page_sk:bigint>
      :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27882]
      :              :     :        +- Project [wp_web_page_sk#26670L]
      :              :     :           +- Filter (((isnotnull(wp_char_count#26680) AND (wp_char_count#26680 >= 5000)) AND (wp_char_count#26680 <= 5200)) AND isnotnull(wp_web_page_sk#26670L))
      :              :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26670L,wp_char_count#26680] Batched: true, DataFilters: [isnotnull(wp_char_count#26680), (wp_char_count#26680 >= 5000), (wp_char_count#26680 <= 5200), is..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(wp_char_count), GreaterThanOrEqual(wp_char_count,5000), LessThanOrEqual(wp_char_count,..., ReadSchema: struct<wp_web_page_sk:bigint,wp_char_count:int>
      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27886]
      :              :        +- Project [t_time_sk#26660L]
      :              :           +- Filter (((isnotnull(t_hour#26663) AND (t_hour#26663 >= 6)) AND (t_hour#26663 <= 7)) AND isnotnull(t_time_sk#26660L))
      :              :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26660L,t_hour#26663] Batched: true, DataFilters: [isnotnull(t_hour#26663), (t_hour#26663 >= 6), (t_hour#26663 <= 7), isnotnull(t_time_sk#26660L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), GreaterThanOrEqual(t_hour,6), LessThanOrEqual(t_hour,7), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:bigint,t_hour:int>
      :              +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27890]
      :                 +- Project [hd_demo_sk#26655L]
      :                    +- Filter ((isnotnull(hd_dep_count#26658) AND (hd_dep_count#26658 = 8)) AND isnotnull(hd_demo_sk#26655L))
      :                       +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26655L,hd_dep_count#26658] Batched: true, DataFilters: [isnotnull(hd_dep_count#26658), (hd_dep_count#26658 = 8), isnotnull(hd_demo_sk#26655L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_dep_count), EqualTo(hd_dep_count,8), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int>
      +- BroadcastExchange IdentityBroadcastMode, [id=#27913]
         +- HashAggregate(keys=[], functions=[count(1)], output=[pmc#26617L])
            +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#27910]
               +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#26751L])
                  +- Project
                     +- BroadcastHashJoin [ws_ship_hdemo_sk#26693L], [hd_demo_sk#26718L], Inner, BuildRight, false
                        :- Project [ws_ship_hdemo_sk#26693L]
                        :  +- BroadcastHashJoin [ws_sold_time_sk#26684L], [t_time_sk#26723L], Inner, BuildRight, false
                        :     :- Project [ws_sold_time_sk#26684L, ws_ship_hdemo_sk#26693L]
                        :     :  +- BroadcastHashJoin [ws_web_page_sk#26695L], [wp_web_page_sk#26733L], Inner, BuildRight, false
                        :     :     :- Project [ws_sold_time_sk#26684L, ws_ship_hdemo_sk#26693L, ws_web_page_sk#26695L]
                        :     :     :  +- Filter ((isnotnull(ws_ship_hdemo_sk#26693L) AND isnotnull(ws_sold_time_sk#26684L)) AND isnotnull(ws_web_page_sk#26695L))
                        :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26684L,ws_ship_hdemo_sk#26693L,ws_web_page_sk#26695L,ws_sold_date_sk#26717L] Batched: true, DataFilters: [isnotnull(ws_ship_hdemo_sk#26693L), isnotnull(ws_sold_time_sk#26684L), isnotnull(ws_web_page_sk#..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_hdemo_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_sold_time_sk:bigint,ws_ship_hdemo_sk:bigint,ws_web_page_sk:bigint>
                        :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27897]
                        :     :        +- Project [wp_web_page_sk#26733L]
                        :     :           +- Filter (((isnotnull(wp_char_count#26743) AND (wp_char_count#26743 >= 5000)) AND (wp_char_count#26743 <= 5200)) AND isnotnull(wp_web_page_sk#26733L))
                        :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_page[wp_web_page_sk#26733L,wp_char_count#26743] Batched: true, DataFilters: [isnotnull(wp_char_count#26743), (wp_char_count#26743 >= 5000), (wp_char_count#26743 <= 5200), is..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(wp_char_count), GreaterThanOrEqual(wp_char_count,5000), LessThanOrEqual(wp_char_count,..., ReadSchema: struct<wp_web_page_sk:bigint,wp_char_count:int>
                        :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27901]
                        :        +- Project [t_time_sk#26723L]
                        :           +- Filter (((isnotnull(t_hour#26726) AND (t_hour#26726 >= 14)) AND (t_hour#26726 <= 15)) AND isnotnull(t_time_sk#26723L))
                        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#26723L,t_hour#26726] Batched: true, DataFilters: [isnotnull(t_hour#26726), (t_hour#26726 >= 14), (t_hour#26726 <= 15), isnotnull(t_time_sk#26723L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), GreaterThanOrEqual(t_hour,14), LessThanOrEqual(t_hour,15), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:bigint,t_hour:int>
                        +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#27905]
                           +- Project [hd_demo_sk#26718L]
                              +- Filter ((isnotnull(hd_dep_count#26721) AND (hd_dep_count#26721 = 8)) AND isnotnull(hd_demo_sk#26718L))
                                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26718L,hd_dep_count#26721] Batched: true, DataFilters: [isnotnull(hd_dep_count#26721), (hd_dep_count#26721 = 8), isnotnull(hd_demo_sk#26718L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_dep_count), EqualTo(hd_dep_count,8), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int>

read query: spark_queries/q91.sql
explain query: q91
== Parsed Logical Plan ==
'Sort ['sum('cr_net_loss) DESC NULLS LAST], true
+- 'Aggregate ['cc_call_center_id, 'cc_name, 'cc_manager, 'cd_marital_status, 'cd_education_status], ['cc_call_center_id AS Call_Center#26752, 'cc_name AS Call_Center_Name#26753, 'cc_manager AS Manager#26754, 'sum('cr_net_loss) AS Returns_Loss#26755]
   +- 'Filter ((((('cr_call_center_sk = 'cc_call_center_sk) AND ('cr_returned_date_sk = 'd_date_sk)) AND ('cr_returning_customer_sk = 'c_customer_sk)) AND ((('cd_demo_sk = 'c_current_cdemo_sk) AND ('hd_demo_sk = 'c_current_hdemo_sk)) AND ('ca_address_sk = 'c_current_addr_sk))) AND (((('d_year = 1999) AND ('d_moy = 11)) AND ((('cd_marital_status = M) AND ('cd_education_status = Unknown)) OR (('cd_marital_status = W) AND ('cd_education_status = Advanced Degree)))) AND ('hd_buy_potential LIKE 0-500% AND ('ca_gmt_offset = -7))))
      +- 'Join Inner
         :- 'Join Inner
         :  :- 'Join Inner
         :  :  :- 'Join Inner
         :  :  :  :- 'Join Inner
         :  :  :  :  :- 'Join Inner
         :  :  :  :  :  :- 'UnresolvedRelation [call_center], [], false
         :  :  :  :  :  +- 'UnresolvedRelation [catalog_returns], [], false
         :  :  :  :  +- 'UnresolvedRelation [date_dim], [], false
         :  :  :  +- 'UnresolvedRelation [customer], [], false
         :  :  +- 'UnresolvedRelation [customer_address], [], false
         :  +- 'UnresolvedRelation [customer_demographics], [], false
         +- 'UnresolvedRelation [household_demographics], [], false

== Analyzed Logical Plan ==
Call_Center: string, Call_Center_Name: string, Manager: string, Returns_Loss: double
Sort [Returns_Loss#26755 DESC NULLS LAST], true
+- Aggregate [cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876], [cc_call_center_id#26757 AS Call_Center#26752, cc_name#26762 AS Call_Center_Name#26753, cc_manager#26767 AS Manager#26754, sum(cr_net_loss#26812) AS Returns_Loss#26755]
   +- Filter (((((cr_call_center_sk#26797L = cc_call_center_sk#26756L) AND (cr_returned_date_sk#26813L = d_date_sk#26814L)) AND (cr_returning_customer_sk#26793L = c_customer_sk#26842L)) AND (((cd_demo_sk#26873L = c_current_cdemo_sk#26844L) AND (hd_demo_sk#26882L = c_current_hdemo_sk#26845L)) AND (ca_address_sk#26860L = c_current_addr_sk#26846L))) AND ((((d_year#26820 = 1999) AND (d_moy#26822 = 11)) AND (((cd_marital_status#26875 = M) AND (cd_education_status#26876 = Unknown)) OR ((cd_marital_status#26875 = W) AND (cd_education_status#26876 = Advanced Degree)))) AND (hd_buy_potential#26884 LIKE 0-500% AND (ca_gmt_offset#26871 = cast(-7 as double)))))
      +- Join Inner
         :- Join Inner
         :  :- Join Inner
         :  :  :- Join Inner
         :  :  :  :- Join Inner
         :  :  :  :  :- Join Inner
         :  :  :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.call_center
         :  :  :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#26756L,cc_call_center_id#26757,cc_rec_start_date#26758,cc_rec_end_date#26759,cc_closed_date_sk#26760L,cc_open_date_sk#26761L,cc_name#26762,cc_class#26763,cc_employees#26764,cc_sq_ft#26765,cc_hours#26766,cc_manager#26767,cc_mkt_id#26768,cc_mkt_class#26769,cc_mkt_desc#26770,cc_market_manager#26771,cc_division#26772,cc_division_name#26773,cc_company#26774,cc_company_name#26775,cc_street_number#26776,cc_street_name#26777,cc_street_type#26778,cc_suite_number#26779,... 7 more fields] orc
         :  :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_returns
         :  :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#26787L,cr_item_sk#26788L,cr_refunded_customer_sk#26789L,cr_refunded_cdemo_sk#26790L,cr_refunded_hdemo_sk#26791L,cr_refunded_addr_sk#26792L,cr_returning_customer_sk#26793L,cr_returning_cdemo_sk#26794L,cr_returning_hdemo_sk#26795L,cr_returning_addr_sk#26796L,cr_call_center_sk#26797L,cr_catalog_page_sk#26798L,cr_ship_mode_sk#26799L,cr_warehouse_sk#26800L,cr_reason_sk#26801L,cr_order_number#26802L,cr_return_quantity#26803,cr_return_amount#26804,cr_return_tax#26805,cr_return_amt_inc_tax#26806,cr_fee#26807,cr_return_ship_cost#26808,cr_refunded_cash#26809,cr_reversed_charge#26810,... 3 more fields] orc
         :  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
         :  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26814L,d_date_id#26815,d_date#26816,d_month_seq#26817,d_week_seq#26818,d_quarter_seq#26819,d_year#26820,d_dow#26821,d_moy#26822,d_dom#26823,d_qoy#26824,d_fy_year#26825,d_fy_quarter_seq#26826,d_fy_week_seq#26827,d_day_name#26828,d_quarter_name#26829,d_holiday#26830,d_weekend#26831,d_following_holiday#26832,d_first_dom#26833,d_last_dom#26834,d_same_day_ly#26835,d_same_day_lq#26836,d_current_day#26837,... 4 more fields] orc
         :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer
         :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#26842L,c_customer_id#26843,c_current_cdemo_sk#26844L,c_current_hdemo_sk#26845L,c_current_addr_sk#26846L,c_first_shipto_date_sk#26847L,c_first_sales_date_sk#26848L,c_salutation#26849,c_first_name#26850,c_last_name#26851,c_preferred_cust_flag#26852,c_birth_day#26853,c_birth_month#26854,c_birth_year#26855,c_birth_country#26856,c_login#26857,c_email_address#26858,c_last_review_date#26859] orc
         :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
         :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#26860L,ca_address_id#26861,ca_street_number#26862,ca_street_name#26863,ca_street_type#26864,ca_suite_number#26865,ca_city#26866,ca_county#26867,ca_state#26868,ca_zip#26869,ca_country#26870,ca_gmt_offset#26871,ca_location_type#26872] orc
         :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_demographics
         :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#26873L,cd_gender#26874,cd_marital_status#26875,cd_education_status#26876,cd_purchase_estimate#26877,cd_credit_rating#26878,cd_dep_count#26879,cd_dep_employed_count#26880,cd_dep_college_count#26881] orc
         +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
            +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26882L,hd_income_band_sk#26883L,hd_buy_potential#26884,hd_dep_count#26885,hd_vehicle_count#26886] orc

== Optimized Logical Plan ==
Sort [Returns_Loss#26755 DESC NULLS LAST], true
+- Aggregate [cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876], [cc_call_center_id#26757 AS Call_Center#26752, cc_name#26762 AS Call_Center_Name#26753, cc_manager#26767 AS Manager#26754, sum(cr_net_loss#26812) AS Returns_Loss#26755]
   +- Project [cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cr_net_loss#26812, cd_marital_status#26875, cd_education_status#26876]
      +- Join Inner, (cr_call_center_sk#26797L = cc_call_center_sk#26756L)
         :- Project [cd_marital_status#26875, cd_education_status#26876, cr_call_center_sk#26797L, cr_net_loss#26812]
         :  +- Join Inner, (cr_returning_customer_sk#26793L = c_customer_sk#26842L)
         :     :- Project [c_customer_sk#26842L, cd_marital_status#26875, cd_education_status#26876]
         :     :  +- Join Inner, (hd_demo_sk#26882L = c_current_hdemo_sk#26845L)
         :     :     :- Project [c_customer_sk#26842L, c_current_hdemo_sk#26845L, cd_marital_status#26875, cd_education_status#26876]
         :     :     :  +- Join Inner, (ca_address_sk#26860L = c_current_addr_sk#26846L)
         :     :     :     :- Project [c_customer_sk#26842L, c_current_hdemo_sk#26845L, c_current_addr_sk#26846L, cd_marital_status#26875, cd_education_status#26876]
         :     :     :     :  +- Join Inner, (cd_demo_sk#26873L = c_current_cdemo_sk#26844L)
         :     :     :     :     :- Project [c_customer_sk#26842L, c_current_cdemo_sk#26844L, c_current_hdemo_sk#26845L, c_current_addr_sk#26846L]
         :     :     :     :     :  +- Filter ((isnotnull(c_customer_sk#26842L) AND isnotnull(c_current_addr_sk#26846L)) AND (isnotnull(c_current_cdemo_sk#26844L) AND isnotnull(c_current_hdemo_sk#26845L)))
         :     :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#26842L,c_customer_id#26843,c_current_cdemo_sk#26844L,c_current_hdemo_sk#26845L,c_current_addr_sk#26846L,c_first_shipto_date_sk#26847L,c_first_sales_date_sk#26848L,c_salutation#26849,c_first_name#26850,c_last_name#26851,c_preferred_cust_flag#26852,c_birth_day#26853,c_birth_month#26854,c_birth_year#26855,c_birth_country#26856,c_login#26857,c_email_address#26858,c_last_review_date#26859] orc
         :     :     :     :     +- Project [cd_demo_sk#26873L, cd_marital_status#26875, cd_education_status#26876]
         :     :     :     :        +- Filter ((((cd_marital_status#26875 = M) AND (cd_education_status#26876 = Unknown)) OR ((cd_marital_status#26875 = W) AND (cd_education_status#26876 = Advanced Degree))) AND isnotnull(cd_demo_sk#26873L))
         :     :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#26873L,cd_gender#26874,cd_marital_status#26875,cd_education_status#26876,cd_purchase_estimate#26877,cd_credit_rating#26878,cd_dep_count#26879,cd_dep_employed_count#26880,cd_dep_college_count#26881] orc
         :     :     :     +- Project [ca_address_sk#26860L]
         :     :     :        +- Filter ((isnotnull(ca_gmt_offset#26871) AND (ca_gmt_offset#26871 = -7.0)) AND isnotnull(ca_address_sk#26860L))
         :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#26860L,ca_address_id#26861,ca_street_number#26862,ca_street_name#26863,ca_street_type#26864,ca_suite_number#26865,ca_city#26866,ca_county#26867,ca_state#26868,ca_zip#26869,ca_country#26870,ca_gmt_offset#26871,ca_location_type#26872] orc
         :     :     +- Project [hd_demo_sk#26882L]
         :     :        +- Filter ((isnotnull(hd_buy_potential#26884) AND StartsWith(hd_buy_potential#26884, 0-500)) AND isnotnull(hd_demo_sk#26882L))
         :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26882L,hd_income_band_sk#26883L,hd_buy_potential#26884,hd_dep_count#26885,hd_vehicle_count#26886] orc
         :     +- Project [cr_returning_customer_sk#26793L, cr_call_center_sk#26797L, cr_net_loss#26812]
         :        +- Join Inner, (cr_returned_date_sk#26813L = d_date_sk#26814L)
         :           :- Project [cr_returning_customer_sk#26793L, cr_call_center_sk#26797L, cr_net_loss#26812, cr_returned_date_sk#26813L]
         :           :  +- Filter (((isnotnull(cr_call_center_sk#26797L) AND isnotnull(cr_returned_date_sk#26813L)) AND isnotnull(cr_returning_customer_sk#26793L)) AND dynamicpruning#26893 [cr_returned_date_sk#26813L])
         :           :     :  +- Project [d_date_sk#26814L]
         :           :     :     +- Filter (((isnotnull(d_year#26820) AND isnotnull(d_moy#26822)) AND ((d_year#26820 = 1999) AND (d_moy#26822 = 11))) AND isnotnull(d_date_sk#26814L))
         :           :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26814L,d_date_id#26815,d_date#26816,d_month_seq#26817,d_week_seq#26818,d_quarter_seq#26819,d_year#26820,d_dow#26821,d_moy#26822,d_dom#26823,d_qoy#26824,d_fy_year#26825,d_fy_quarter_seq#26826,d_fy_week_seq#26827,d_day_name#26828,d_quarter_name#26829,d_holiday#26830,d_weekend#26831,d_following_holiday#26832,d_first_dom#26833,d_last_dom#26834,d_same_day_ly#26835,d_same_day_lq#26836,d_current_day#26837,... 4 more fields] orc
         :           :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returned_time_sk#26787L,cr_item_sk#26788L,cr_refunded_customer_sk#26789L,cr_refunded_cdemo_sk#26790L,cr_refunded_hdemo_sk#26791L,cr_refunded_addr_sk#26792L,cr_returning_customer_sk#26793L,cr_returning_cdemo_sk#26794L,cr_returning_hdemo_sk#26795L,cr_returning_addr_sk#26796L,cr_call_center_sk#26797L,cr_catalog_page_sk#26798L,cr_ship_mode_sk#26799L,cr_warehouse_sk#26800L,cr_reason_sk#26801L,cr_order_number#26802L,cr_return_quantity#26803,cr_return_amount#26804,cr_return_tax#26805,cr_return_amt_inc_tax#26806,cr_fee#26807,cr_return_ship_cost#26808,cr_refunded_cash#26809,cr_reversed_charge#26810,... 3 more fields] orc
         :           +- Project [d_date_sk#26814L]
         :              +- Filter (((isnotnull(d_year#26820) AND isnotnull(d_moy#26822)) AND ((d_year#26820 = 1999) AND (d_moy#26822 = 11))) AND isnotnull(d_date_sk#26814L))
         :                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26814L,d_date_id#26815,d_date#26816,d_month_seq#26817,d_week_seq#26818,d_quarter_seq#26819,d_year#26820,d_dow#26821,d_moy#26822,d_dom#26823,d_qoy#26824,d_fy_year#26825,d_fy_quarter_seq#26826,d_fy_week_seq#26827,d_day_name#26828,d_quarter_name#26829,d_holiday#26830,d_weekend#26831,d_following_holiday#26832,d_first_dom#26833,d_last_dom#26834,d_same_day_ly#26835,d_same_day_lq#26836,d_current_day#26837,... 4 more fields] orc
         +- Project [cc_call_center_sk#26756L, cc_call_center_id#26757, cc_name#26762, cc_manager#26767]
            +- Filter isnotnull(cc_call_center_sk#26756L)
               +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#26756L,cc_call_center_id#26757,cc_rec_start_date#26758,cc_rec_end_date#26759,cc_closed_date_sk#26760L,cc_open_date_sk#26761L,cc_name#26762,cc_class#26763,cc_employees#26764,cc_sq_ft#26765,cc_hours#26766,cc_manager#26767,cc_mkt_id#26768,cc_mkt_class#26769,cc_mkt_desc#26770,cc_market_manager#26771,cc_division#26772,cc_division_name#26773,cc_company#26774,cc_company_name#26775,cc_street_number#26776,cc_street_name#26777,cc_street_type#26778,cc_suite_number#26779,... 7 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Sort [Returns_Loss#26755 DESC NULLS LAST], true, 0
   +- Exchange rangepartitioning(Returns_Loss#26755 DESC NULLS LAST, 3000), ENSURE_REQUIREMENTS, [id=#28099]
      +- HashAggregate(keys=[cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876], functions=[sum(cr_net_loss#26812)], output=[Call_Center#26752, Call_Center_Name#26753, Manager#26754, Returns_Loss#26755])
         +- Exchange hashpartitioning(cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876, 3000), ENSURE_REQUIREMENTS, [id=#28096]
            +- HashAggregate(keys=[cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876], functions=[partial_sum(cr_net_loss#26812)], output=[cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cd_marital_status#26875, cd_education_status#26876, sum#26895])
               +- Project [cc_call_center_id#26757, cc_name#26762, cc_manager#26767, cr_net_loss#26812, cd_marital_status#26875, cd_education_status#26876]
                  +- BroadcastHashJoin [cr_call_center_sk#26797L], [cc_call_center_sk#26756L], Inner, BuildRight, false
                     :- Project [cd_marital_status#26875, cd_education_status#26876, cr_call_center_sk#26797L, cr_net_loss#26812]
                     :  +- SortMergeJoin [c_customer_sk#26842L], [cr_returning_customer_sk#26793L], Inner
                     :     :- Sort [c_customer_sk#26842L ASC NULLS FIRST], false, 0
                     :     :  +- Exchange hashpartitioning(c_customer_sk#26842L, 3000), ENSURE_REQUIREMENTS, [id=#28084]
                     :     :     +- Project [c_customer_sk#26842L, cd_marital_status#26875, cd_education_status#26876]
                     :     :        +- BroadcastHashJoin [c_current_hdemo_sk#26845L], [hd_demo_sk#26882L], Inner, BuildRight, false
                     :     :           :- Project [c_customer_sk#26842L, c_current_hdemo_sk#26845L, cd_marital_status#26875, cd_education_status#26876]
                     :     :           :  +- SortMergeJoin [c_current_addr_sk#26846L], [ca_address_sk#26860L], Inner
                     :     :           :     :- Sort [c_current_addr_sk#26846L ASC NULLS FIRST], false, 0
                     :     :           :     :  +- Exchange hashpartitioning(c_current_addr_sk#26846L, 3000), ENSURE_REQUIREMENTS, [id=#28069]
                     :     :           :     :     +- Project [c_customer_sk#26842L, c_current_hdemo_sk#26845L, c_current_addr_sk#26846L, cd_marital_status#26875, cd_education_status#26876]
                     :     :           :     :        +- BroadcastHashJoin [c_current_cdemo_sk#26844L], [cd_demo_sk#26873L], Inner, BuildRight, false
                     :     :           :     :           :- Filter (((isnotnull(c_customer_sk#26842L) AND isnotnull(c_current_addr_sk#26846L)) AND isnotnull(c_current_cdemo_sk#26844L)) AND isnotnull(c_current_hdemo_sk#26845L))
                     :     :           :     :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer[c_customer_sk#26842L,c_current_cdemo_sk#26844L,c_current_hdemo_sk#26845L,c_current_addr_sk#26846L] Batched: true, DataFilters: [isnotnull(c_customer_sk#26842L), isnotnull(c_current_addr_sk#26846L), isnotnull(c_current_cdemo_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk), IsNotNull..., ReadSchema: struct<c_customer_sk:bigint,c_current_cdemo_sk:bigint,c_current_hdemo_sk:bigint,c_current_addr_sk...
                     :     :           :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#28064]
                     :     :           :     :              +- Filter ((((cd_marital_status#26875 = M) AND (cd_education_status#26876 = Unknown)) OR ((cd_marital_status#26875 = W) AND (cd_education_status#26876 = Advanced Degree))) AND isnotnull(cd_demo_sk#26873L))
                     :     :           :     :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_demographics[cd_demo_sk#26873L,cd_marital_status#26875,cd_education_status#26876] Batched: true, DataFilters: [(((cd_marital_status#26875 = M) AND (cd_education_status#26876 = Unknown)) OR ((cd_marital_statu..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [Or(And(EqualTo(cd_marital_status,M),EqualTo(cd_education_status,Unknown)),And(EqualTo(cd_marital..., ReadSchema: struct<cd_demo_sk:bigint,cd_marital_status:string,cd_education_status:string>
                     :     :           :     +- Sort [ca_address_sk#26860L ASC NULLS FIRST], false, 0
                     :     :           :        +- Exchange hashpartitioning(ca_address_sk#26860L, 3000), ENSURE_REQUIREMENTS, [id=#28070]
                     :     :           :           +- Project [ca_address_sk#26860L]
                     :     :           :              +- Filter ((isnotnull(ca_gmt_offset#26871) AND (ca_gmt_offset#26871 = -7.0)) AND isnotnull(ca_address_sk#26860L))
                     :     :           :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#26860L,ca_gmt_offset#26871] Batched: true, DataFilters: [isnotnull(ca_gmt_offset#26871), (ca_gmt_offset#26871 = -7.0), isnotnull(ca_address_sk#26860L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-7.0), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_gmt_offset:double>
                     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28076]
                     :     :              +- Project [hd_demo_sk#26882L]
                     :     :                 +- Filter ((isnotnull(hd_buy_potential#26884) AND StartsWith(hd_buy_potential#26884, 0-500)) AND isnotnull(hd_demo_sk#26882L))
                     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#26882L,hd_buy_potential#26884] Batched: true, DataFilters: [isnotnull(hd_buy_potential#26884), StartsWith(hd_buy_potential#26884, 0-500), isnotnull(hd_demo_..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_buy_potential), StringStartsWith(hd_buy_potential,0-500), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_buy_potential:string>
                     :     +- Sort [cr_returning_customer_sk#26793L ASC NULLS FIRST], false, 0
                     :        +- Exchange hashpartitioning(cr_returning_customer_sk#26793L, 3000), ENSURE_REQUIREMENTS, [id=#28085]
                     :           +- Project [cr_returning_customer_sk#26793L, cr_call_center_sk#26797L, cr_net_loss#26812]
                     :              +- BroadcastHashJoin [cr_returned_date_sk#26813L], [d_date_sk#26814L], Inner, BuildRight, false
                     :                 :- Filter (isnotnull(cr_call_center_sk#26797L) AND isnotnull(cr_returning_customer_sk#26793L))
                     :                 :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_returns[cr_returning_customer_sk#26793L,cr_call_center_sk#26797L,cr_net_loss#26812,cr_returned_date_sk#26813L] Batched: true, DataFilters: [isnotnull(cr_call_center_sk#26797L), isnotnull(cr_returning_customer_sk#26793L)], Format: ORC, Location: InMemoryFileIndex(2104 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cr_returned_date_sk#26813L), dynamicpruningexpression(cr_returned_date_sk#26813L IN dy..., PushedFilters: [IsNotNull(cr_call_center_sk), IsNotNull(cr_returning_customer_sk)], ReadSchema: struct<cr_returning_customer_sk:bigint,cr_call_center_sk:bigint,cr_net_loss:double>
                     :                 :        +- SubqueryAdaptiveBroadcast dynamicpruning#26893, 0, true, Project [d_date_sk#26814L], [d_date_sk#26814L]
                     :                 :           +- AdaptiveSparkPlan isFinalPlan=false
                     :                 :              +- Project [d_date_sk#26814L]
                     :                 :                 +- Filter ((((isnotnull(d_year#26820) AND isnotnull(d_moy#26822)) AND (d_year#26820 = 1999)) AND (d_moy#26822 = 11)) AND isnotnull(d_date_sk#26814L))
                     :                 :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26814L,d_year#26820,d_moy#26822] Batched: true, DataFilters: [isnotnull(d_year#26820), isnotnull(d_moy#26822), (d_year#26820 = 1999), (d_moy#26822 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28079]
                     :                    +- Project [d_date_sk#26814L]
                     :                       +- Filter ((((isnotnull(d_year#26820) AND isnotnull(d_moy#26822)) AND (d_year#26820 = 1999)) AND (d_moy#26822 = 11)) AND isnotnull(d_date_sk#26814L))
                     :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26814L,d_year#26820,d_moy#26822] Batched: true, DataFilters: [isnotnull(d_year#26820), isnotnull(d_moy#26822), (d_year#26820 = 1999), (d_moy#26822 = 11), isno..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1999), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:bigint,d_year:int,d_moy:int>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#28091]
                        +- Filter isnotnull(cc_call_center_sk#26756L)
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#26756L,cc_call_center_id#26757,cc_name#26762,cc_manager#26767] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#26756L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:bigint,cc_call_center_id:string,cc_name:string,cc_manager:string>

read query: spark_queries/q92.sql
explain query: q92
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['sum('ws_ext_discount_amt) ASC NULLS FIRST], true
      +- 'Project ['sum('ws_ext_discount_amt) AS Excess Discount Amount#26896]
         +- 'Filter (((('i_manufact_id = 269) AND ('i_item_sk = 'ws_item_sk)) AND (('d_date >= 1998-03-18) AND ('d_date <= (cast(1998-03-18 as date) + INTERVAL '90' DAY)))) AND (('d_date_sk = 'ws_sold_date_sk) AND ('ws_ext_discount_amt > scalar-subquery#26897 [])))
            :  +- 'Project [unresolvedalias((1.3 * 'avg('ws_ext_discount_amt)), None)]
            :     +- 'Filter ((('ws_item_sk = 'i_item_sk) AND (('d_date >= 1998-03-18) AND ('d_date <= (cast(1998-03-18 as date) + INTERVAL '90' DAY)))) AND ('d_date_sk = 'ws_sold_date_sk))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [web_sales], [], false
            :           +- 'UnresolvedRelation [date_dim], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'UnresolvedRelation [web_sales], [], false
               :  +- 'UnresolvedRelation [item], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
Excess Discount Amount: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [Excess Discount Amount#26896 ASC NULLS FIRST], true
      +- Aggregate [sum(ws_ext_discount_amt#26919) AS Excess Discount Amount#26896]
         +- Filter ((((i_manufact_id#26945 = 269) AND (i_item_sk#26932L = ws_item_sk#26900L)) AND ((d_date#26956 >= cast(1998-03-18 as date)) AND (d_date#26956 <= date_add(cast(1998-03-18 as date), extractansiintervaldays(INTERVAL '90' DAY))))) AND ((d_date_sk#26954L = ws_sold_date_sk#26931L) AND (ws_ext_discount_amt#26919 > scalar-subquery#26897 [i_item_sk#26932L])))
            :  +- Aggregate [(cast(1.3 as double) * avg(ws_ext_discount_amt#27003)) AS (1.3 * avg(ws_ext_discount_amt))#27045]
            :     +- Filter (((ws_item_sk#26984L = outer(i_item_sk#26932L)) AND ((d_date#27018 >= cast(1998-03-18 as date)) AND (d_date#27018 <= date_add(cast(1998-03-18 as date), extractansiintervaldays(INTERVAL '90' DAY))))) AND (d_date_sk#27016L = ws_sold_date_sk#27015L))
            :        +- Join Inner
            :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26982L,ws_ship_date_sk#26983L,ws_item_sk#26984L,ws_bill_customer_sk#26985L,ws_bill_cdemo_sk#26986L,ws_bill_hdemo_sk#26987L,ws_bill_addr_sk#26988L,ws_ship_customer_sk#26989L,ws_ship_cdemo_sk#26990L,ws_ship_hdemo_sk#26991L,ws_ship_addr_sk#26992L,ws_web_page_sk#26993L,ws_web_site_sk#26994L,ws_ship_mode_sk#26995L,ws_warehouse_sk#26996L,ws_promo_sk#26997L,ws_order_number#26998L,ws_quantity#26999,ws_wholesale_cost#27000,ws_list_price#27001,ws_sales_price#27002,ws_ext_discount_amt#27003,ws_ext_sales_price#27004,ws_ext_wholesale_cost#27005,... 10 more fields] orc
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27016L,d_date_id#27017,d_date#27018,d_month_seq#27019,d_week_seq#27020,d_quarter_seq#27021,d_year#27022,d_dow#27023,d_moy#27024,d_dom#27025,d_qoy#27026,d_fy_year#27027,d_fy_quarter_seq#27028,d_fy_week_seq#27029,d_day_name#27030,d_quarter_name#27031,d_holiday#27032,d_weekend#27033,d_following_holiday#27034,d_first_dom#27035,d_last_dom#27036,d_same_day_ly#27037,d_same_day_lq#27038,d_current_day#27039,... 4 more fields] orc
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26898L,ws_ship_date_sk#26899L,ws_item_sk#26900L,ws_bill_customer_sk#26901L,ws_bill_cdemo_sk#26902L,ws_bill_hdemo_sk#26903L,ws_bill_addr_sk#26904L,ws_ship_customer_sk#26905L,ws_ship_cdemo_sk#26906L,ws_ship_hdemo_sk#26907L,ws_ship_addr_sk#26908L,ws_web_page_sk#26909L,ws_web_site_sk#26910L,ws_ship_mode_sk#26911L,ws_warehouse_sk#26912L,ws_promo_sk#26913L,ws_order_number#26914L,ws_quantity#26915,ws_wholesale_cost#26916,ws_list_price#26917,ws_sales_price#26918,ws_ext_discount_amt#26919,ws_ext_sales_price#26920,ws_ext_wholesale_cost#26921,... 10 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26932L,i_item_id#26933,i_rec_start_date#26934,i_rec_end_date#26935,i_item_desc#26936,i_current_price#26937,i_wholesale_cost#26938,i_brand_id#26939,i_brand#26940,i_class_id#26941,i_class#26942,i_category_id#26943,i_category#26944,i_manufact_id#26945,i_manufact#26946,i_size#26947,i_formulation#26948,i_color#26949,i_units#26950,i_container#26951,i_manager_id#26952,i_product_name#26953] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26954L,d_date_id#26955,d_date#26956,d_month_seq#26957,d_week_seq#26958,d_quarter_seq#26959,d_year#26960,d_dow#26961,d_moy#26962,d_dom#26963,d_qoy#26964,d_fy_year#26965,d_fy_quarter_seq#26966,d_fy_week_seq#26967,d_day_name#26968,d_quarter_name#26969,d_holiday#26970,d_weekend#26971,d_following_holiday#26972,d_first_dom#26973,d_last_dom#26974,d_same_day_ly#26975,d_same_day_lq#26976,d_current_day#26977,... 4 more fields] orc

== Optimized Logical Plan ==
Aggregate [sum(ws_ext_discount_amt#26919) AS Excess Discount Amount#26896]
+- Project [ws_ext_discount_amt#26919]
   +- Join Inner, (d_date_sk#26954L = ws_sold_date_sk#26931L)
      :- Project [ws_ext_discount_amt#26919, ws_sold_date_sk#26931L]
      :  +- Join Inner, ((i_item_sk#26932L = ws_item_sk#26900L) AND (ws_ext_discount_amt#26919 > (1.3 * avg(ws_ext_discount_amt))#27045))
      :     :- Project [i_item_sk#26932L, (1.3 * avg(ws_ext_discount_amt))#27045]
      :     :  +- Join Inner, (ws_item_sk#26984L = i_item_sk#26932L)
      :     :     :- Project [i_item_sk#26932L]
      :     :     :  +- Filter ((isnotnull(i_manufact_id#26945) AND (i_manufact_id#26945 = 269)) AND isnotnull(i_item_sk#26932L))
      :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26932L,i_item_id#26933,i_rec_start_date#26934,i_rec_end_date#26935,i_item_desc#26936,i_current_price#26937,i_wholesale_cost#26938,i_brand_id#26939,i_brand#26940,i_class_id#26941,i_class#26942,i_category_id#26943,i_category#26944,i_manufact_id#26945,i_manufact#26946,i_size#26947,i_formulation#26948,i_color#26949,i_units#26950,i_container#26951,i_manager_id#26952,i_product_name#26953] orc
      :     :     +- Filter isnotnull((1.3 * avg(ws_ext_discount_amt))#27045)
      :     :        +- Aggregate [ws_item_sk#26984L], [(1.3 * avg(ws_ext_discount_amt#27003)) AS (1.3 * avg(ws_ext_discount_amt))#27045, ws_item_sk#26984L]
      :     :           +- Project [ws_item_sk#26984L, ws_ext_discount_amt#27003]
      :     :              +- Join Inner, (d_date_sk#27016L = ws_sold_date_sk#27015L)
      :     :                 :- Project [ws_item_sk#26984L, ws_ext_discount_amt#27003, ws_sold_date_sk#27015L]
      :     :                 :  +- Filter ((isnotnull(ws_sold_date_sk#27015L) AND isnotnull(ws_item_sk#26984L)) AND dynamicpruning#27049 [ws_sold_date_sk#27015L])
      :     :                 :     :  +- Project [d_date_sk#27016L]
      :     :                 :     :     +- Filter ((isnotnull(d_date#27018) AND ((d_date#27018 >= 1998-03-18) AND (d_date#27018 <= 1998-06-16))) AND isnotnull(d_date_sk#27016L))
      :     :                 :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27016L,d_date_id#27017,d_date#27018,d_month_seq#27019,d_week_seq#27020,d_quarter_seq#27021,d_year#27022,d_dow#27023,d_moy#27024,d_dom#27025,d_qoy#27026,d_fy_year#27027,d_fy_quarter_seq#27028,d_fy_week_seq#27029,d_day_name#27030,d_quarter_name#27031,d_holiday#27032,d_weekend#27033,d_following_holiday#27034,d_first_dom#27035,d_last_dom#27036,d_same_day_ly#27037,d_same_day_lq#27038,d_current_day#27039,... 4 more fields] orc
      :     :                 :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26982L,ws_ship_date_sk#26983L,ws_item_sk#26984L,ws_bill_customer_sk#26985L,ws_bill_cdemo_sk#26986L,ws_bill_hdemo_sk#26987L,ws_bill_addr_sk#26988L,ws_ship_customer_sk#26989L,ws_ship_cdemo_sk#26990L,ws_ship_hdemo_sk#26991L,ws_ship_addr_sk#26992L,ws_web_page_sk#26993L,ws_web_site_sk#26994L,ws_ship_mode_sk#26995L,ws_warehouse_sk#26996L,ws_promo_sk#26997L,ws_order_number#26998L,ws_quantity#26999,ws_wholesale_cost#27000,ws_list_price#27001,ws_sales_price#27002,ws_ext_discount_amt#27003,ws_ext_sales_price#27004,ws_ext_wholesale_cost#27005,... 10 more fields] orc
      :     :                 +- Project [d_date_sk#27016L]
      :     :                    +- Filter ((isnotnull(d_date#27018) AND ((d_date#27018 >= 1998-03-18) AND (d_date#27018 <= 1998-06-16))) AND isnotnull(d_date_sk#27016L))
      :     :                       +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27016L,d_date_id#27017,d_date#27018,d_month_seq#27019,d_week_seq#27020,d_quarter_seq#27021,d_year#27022,d_dow#27023,d_moy#27024,d_dom#27025,d_qoy#27026,d_fy_year#27027,d_fy_quarter_seq#27028,d_fy_week_seq#27029,d_day_name#27030,d_quarter_name#27031,d_holiday#27032,d_weekend#27033,d_following_holiday#27034,d_first_dom#27035,d_last_dom#27036,d_same_day_ly#27037,d_same_day_lq#27038,d_current_day#27039,... 4 more fields] orc
      :     +- Project [ws_item_sk#26900L, ws_ext_discount_amt#26919, ws_sold_date_sk#26931L]
      :        +- Filter (((isnotnull(ws_item_sk#26900L) AND isnotnull(ws_ext_discount_amt#26919)) AND isnotnull(ws_sold_date_sk#26931L)) AND dynamicpruning#27050 [ws_sold_date_sk#26931L])
      :           :  +- Project [d_date_sk#26954L]
      :           :     +- Filter ((isnotnull(d_date#26956) AND ((d_date#26956 >= 1998-03-18) AND (d_date#26956 <= 1998-06-16))) AND isnotnull(d_date_sk#26954L))
      :           :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26954L,d_date_id#26955,d_date#26956,d_month_seq#26957,d_week_seq#26958,d_quarter_seq#26959,d_year#26960,d_dow#26961,d_moy#26962,d_dom#26963,d_qoy#26964,d_fy_year#26965,d_fy_quarter_seq#26966,d_fy_week_seq#26967,d_day_name#26968,d_quarter_name#26969,d_holiday#26970,d_weekend#26971,d_following_holiday#26972,d_first_dom#26973,d_last_dom#26974,d_same_day_ly#26975,d_same_day_lq#26976,d_current_day#26977,... 4 more fields] orc
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#26898L,ws_ship_date_sk#26899L,ws_item_sk#26900L,ws_bill_customer_sk#26901L,ws_bill_cdemo_sk#26902L,ws_bill_hdemo_sk#26903L,ws_bill_addr_sk#26904L,ws_ship_customer_sk#26905L,ws_ship_cdemo_sk#26906L,ws_ship_hdemo_sk#26907L,ws_ship_addr_sk#26908L,ws_web_page_sk#26909L,ws_web_site_sk#26910L,ws_ship_mode_sk#26911L,ws_warehouse_sk#26912L,ws_promo_sk#26913L,ws_order_number#26914L,ws_quantity#26915,ws_wholesale_cost#26916,ws_list_price#26917,ws_sales_price#26918,ws_ext_discount_amt#26919,ws_ext_sales_price#26920,ws_ext_wholesale_cost#26921,... 10 more fields] orc
      +- Project [d_date_sk#26954L]
         +- Filter ((isnotnull(d_date#26956) AND ((d_date#26956 >= 1998-03-18) AND (d_date#26956 <= 1998-06-16))) AND isnotnull(d_date_sk#26954L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26954L,d_date_id#26955,d_date#26956,d_month_seq#26957,d_week_seq#26958,d_quarter_seq#26959,d_year#26960,d_dow#26961,d_moy#26962,d_dom#26963,d_qoy#26964,d_fy_year#26965,d_fy_quarter_seq#26966,d_fy_week_seq#26967,d_day_name#26968,d_quarter_name#26969,d_holiday#26970,d_weekend#26971,d_following_holiday#26972,d_first_dom#26973,d_last_dom#26974,d_same_day_ly#26975,d_same_day_lq#26976,d_current_day#26977,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(ws_ext_discount_amt#26919)], output=[Excess Discount Amount#26896])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#28257]
      +- HashAggregate(keys=[], functions=[partial_sum(ws_ext_discount_amt#26919)], output=[sum#27052])
         +- Project [ws_ext_discount_amt#26919]
            +- BroadcastHashJoin [ws_sold_date_sk#26931L], [d_date_sk#26954L], Inner, BuildRight, false
               :- Project [ws_ext_discount_amt#26919, ws_sold_date_sk#26931L]
               :  +- BroadcastHashJoin [i_item_sk#26932L], [ws_item_sk#26900L], Inner, BuildLeft, (ws_ext_discount_amt#26919 > (1.3 * avg(ws_ext_discount_amt))#27045), false
               :     :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28248]
               :     :  +- Project [i_item_sk#26932L, (1.3 * avg(ws_ext_discount_amt))#27045]
               :     :     +- BroadcastHashJoin [i_item_sk#26932L], [ws_item_sk#26984L], Inner, BuildLeft, false
               :     :        :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28244]
               :     :        :  +- Project [i_item_sk#26932L]
               :     :        :     +- Filter ((isnotnull(i_manufact_id#26945) AND (i_manufact_id#26945 = 269)) AND isnotnull(i_item_sk#26932L))
               :     :        :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#26932L,i_manufact_id#26945] Batched: true, DataFilters: [isnotnull(i_manufact_id#26945), (i_manufact_id#26945 = 269), isnotnull(i_item_sk#26932L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,269), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_manufact_id:int>
               :     :        +- Filter isnotnull((1.3 * avg(ws_ext_discount_amt))#27045)
               :     :           +- HashAggregate(keys=[ws_item_sk#26984L], functions=[avg(ws_ext_discount_amt#27003)], output=[(1.3 * avg(ws_ext_discount_amt))#27045, ws_item_sk#26984L])
               :     :              +- Exchange hashpartitioning(ws_item_sk#26984L, 3000), ENSURE_REQUIREMENTS, [id=#28240]
               :     :                 +- HashAggregate(keys=[ws_item_sk#26984L], functions=[partial_avg(ws_ext_discount_amt#27003)], output=[ws_item_sk#26984L, sum#27055, count#27056L])
               :     :                    +- Project [ws_item_sk#26984L, ws_ext_discount_amt#27003]
               :     :                       +- BroadcastHashJoin [ws_sold_date_sk#27015L], [d_date_sk#27016L], Inner, BuildRight, false
               :     :                          :- Filter isnotnull(ws_item_sk#26984L)
               :     :                          :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#26984L,ws_ext_discount_amt#27003,ws_sold_date_sk#27015L] Batched: true, DataFilters: [isnotnull(ws_item_sk#26984L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#27015L), dynamicpruningexpression(ws_sold_date_sk#27015L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:bigint,ws_ext_discount_amt:double>
               :     :                          :        +- SubqueryAdaptiveBroadcast dynamicpruning#27049, 0, true, Project [d_date_sk#27016L], [d_date_sk#27016L]
               :     :                          :           +- AdaptiveSparkPlan isFinalPlan=false
               :     :                          :              +- Project [d_date_sk#27016L]
               :     :                          :                 +- Filter (((isnotnull(d_date#27018) AND (d_date#27018 >= 1998-03-18)) AND (d_date#27018 <= 1998-06-16)) AND isnotnull(d_date_sk#27016L))
               :     :                          :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27016L,d_date#27018] Batched: true, DataFilters: [isnotnull(d_date#27018), (d_date#27018 >= 1998-03-18), (d_date#27018 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               :     :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28235]
               :     :                             +- Project [d_date_sk#27016L]
               :     :                                +- Filter (((isnotnull(d_date#27018) AND (d_date#27018 >= 1998-03-18)) AND (d_date#27018 <= 1998-06-16)) AND isnotnull(d_date_sk#27016L))
               :     :                                   +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27016L,d_date#27018] Batched: true, DataFilters: [isnotnull(d_date#27018), (d_date#27018 >= 1998-03-18), (d_date#27018 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               :     +- Filter (isnotnull(ws_item_sk#26900L) AND isnotnull(ws_ext_discount_amt#26919))
               :        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_item_sk#26900L,ws_ext_discount_amt#26919,ws_sold_date_sk#26931L] Batched: true, DataFilters: [isnotnull(ws_item_sk#26900L), isnotnull(ws_ext_discount_amt#26919)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ws_sold_date_sk#26931L), dynamicpruningexpression(ws_sold_date_sk#26931L IN dynamicpru..., PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_ext_discount_amt)], ReadSchema: struct<ws_item_sk:bigint,ws_ext_discount_amt:double>
               :              +- SubqueryAdaptiveBroadcast dynamicpruning#27050, 0, true, Project [d_date_sk#26954L], [d_date_sk#26954L]
               :                 +- AdaptiveSparkPlan isFinalPlan=false
               :                    +- Project [d_date_sk#26954L]
               :                       +- Filter (((isnotnull(d_date#26956) AND (d_date#26956 >= 1998-03-18)) AND (d_date#26956 <= 1998-06-16)) AND isnotnull(d_date_sk#26954L))
               :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26954L,d_date#26956] Batched: true, DataFilters: [isnotnull(d_date#26956), (d_date#26956 >= 1998-03-18), (d_date#26956 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28252]
                  +- Project [d_date_sk#26954L]
                     +- Filter (((isnotnull(d_date#26956) AND (d_date#26956 >= 1998-03-18)) AND (d_date#26956 <= 1998-06-16)) AND isnotnull(d_date_sk#26954L))
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#26954L,d_date#26956] Batched: true, DataFilters: [isnotnull(d_date#26956), (d_date#26956 >= 1998-03-18), (d_date#26956 <= 1998-06-16), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>

read query: spark_queries/q93.sql
explain query: q93
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['sumsales ASC NULLS FIRST, 'ss_customer_sk ASC NULLS FIRST], true
      +- 'Aggregate ['ss_customer_sk], ['ss_customer_sk, 'sum('act_sales) AS sumsales#27058]
         +- 'SubqueryAlias t
            +- 'Project ['ss_item_sk, 'ss_ticket_number, 'ss_customer_sk, CASE WHEN isnotnull('sr_return_quantity) THEN (('ss_quantity - 'sr_return_quantity) * 'ss_sales_price) ELSE ('ss_quantity * 'ss_sales_price) END AS act_sales#27057]
               +- 'Filter (('sr_reason_sk = 'r_reason_sk) AND ('r_reason_desc = Did not like the warranty))
                  +- 'Join Inner
                     :- 'Join LeftOuter, (('sr_item_sk = 'ss_item_sk) AND ('sr_ticket_number = 'ss_ticket_number))
                     :  :- 'UnresolvedRelation [store_sales], [], false
                     :  +- 'UnresolvedRelation [store_returns], [], false
                     +- 'UnresolvedRelation [reason], [], false

== Analyzed Logical Plan ==
ss_customer_sk: bigint, sumsales: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [sumsales#27058 ASC NULLS FIRST, ss_customer_sk#27061L ASC NULLS FIRST], true
      +- Aggregate [ss_customer_sk#27061L], [ss_customer_sk#27061L, sum(act_sales#27057) AS sumsales#27058]
         +- SubqueryAlias t
            +- Project [ss_item_sk#27060L, ss_ticket_number#27067L, ss_customer_sk#27061L, CASE WHEN isnotnull(sr_return_quantity#27091) THEN (cast((ss_quantity#27068 - sr_return_quantity#27091) as double) * ss_sales_price#27071) ELSE (cast(ss_quantity#27068 as double) * ss_sales_price#27071) END AS act_sales#27057]
               +- Filter ((sr_reason_sk#27089L = r_reason_sk#27102L) AND (r_reason_desc#27104 = Did not like the warranty))
                  +- Join Inner
                     :- Join LeftOuter, ((sr_item_sk#27083L = ss_item_sk#27060L) AND (sr_ticket_number#27090L = ss_ticket_number#27067L))
                     :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                     :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27059L,ss_item_sk#27060L,ss_customer_sk#27061L,ss_cdemo_sk#27062L,ss_hdemo_sk#27063L,ss_addr_sk#27064L,ss_store_sk#27065L,ss_promo_sk#27066L,ss_ticket_number#27067L,ss_quantity#27068,ss_wholesale_cost#27069,ss_list_price#27070,ss_sales_price#27071,ss_ext_discount_amt#27072,ss_ext_sales_price#27073,ss_ext_wholesale_cost#27074,ss_ext_list_price#27075,ss_ext_tax#27076,ss_coupon_amt#27077,ss_net_paid#27078,ss_net_paid_inc_tax#27079,ss_net_profit#27080,ss_sold_date_sk#27081L] orc
                     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_returns
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#27082L,sr_item_sk#27083L,sr_customer_sk#27084L,sr_cdemo_sk#27085L,sr_hdemo_sk#27086L,sr_addr_sk#27087L,sr_store_sk#27088L,sr_reason_sk#27089L,sr_ticket_number#27090L,sr_return_quantity#27091,sr_return_amt#27092,sr_return_tax#27093,sr_return_amt_inc_tax#27094,sr_fee#27095,sr_return_ship_cost#27096,sr_refunded_cash#27097,sr_reversed_charge#27098,sr_store_credit#27099,sr_net_loss#27100,sr_returned_date_sk#27101L] orc
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.reason
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#27102L,r_reason_id#27103,r_reason_desc#27104] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [sumsales#27058 ASC NULLS FIRST, ss_customer_sk#27061L ASC NULLS FIRST], true
      +- Aggregate [ss_customer_sk#27061L], [ss_customer_sk#27061L, sum(act_sales#27057) AS sumsales#27058]
         +- Project [ss_customer_sk#27061L, CASE WHEN isnotnull(sr_return_quantity#27091) THEN (cast((ss_quantity#27068 - sr_return_quantity#27091) as double) * ss_sales_price#27071) ELSE (cast(ss_quantity#27068 as double) * ss_sales_price#27071) END AS act_sales#27057]
            +- Join Inner, ((sr_item_sk#27083L = ss_item_sk#27060L) AND (sr_ticket_number#27090L = ss_ticket_number#27067L))
               :- Project [sr_item_sk#27083L, sr_ticket_number#27090L, sr_return_quantity#27091]
               :  +- Join Inner, (sr_reason_sk#27089L = r_reason_sk#27102L)
               :     :- Project [sr_item_sk#27083L, sr_reason_sk#27089L, sr_ticket_number#27090L, sr_return_quantity#27091]
               :     :  +- Filter ((isnotnull(sr_item_sk#27083L) AND isnotnull(sr_ticket_number#27090L)) AND isnotnull(sr_reason_sk#27089L))
               :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_return_time_sk#27082L,sr_item_sk#27083L,sr_customer_sk#27084L,sr_cdemo_sk#27085L,sr_hdemo_sk#27086L,sr_addr_sk#27087L,sr_store_sk#27088L,sr_reason_sk#27089L,sr_ticket_number#27090L,sr_return_quantity#27091,sr_return_amt#27092,sr_return_tax#27093,sr_return_amt_inc_tax#27094,sr_fee#27095,sr_return_ship_cost#27096,sr_refunded_cash#27097,sr_reversed_charge#27098,sr_store_credit#27099,sr_net_loss#27100,sr_returned_date_sk#27101L] orc
               :     +- Project [r_reason_sk#27102L]
               :        +- Filter ((isnotnull(r_reason_desc#27104) AND (r_reason_desc#27104 = Did not like the warranty)) AND isnotnull(r_reason_sk#27102L))
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#27102L,r_reason_id#27103,r_reason_desc#27104] orc
               +- Project [ss_item_sk#27060L, ss_customer_sk#27061L, ss_ticket_number#27067L, ss_quantity#27068, ss_sales_price#27071]
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27059L,ss_item_sk#27060L,ss_customer_sk#27061L,ss_cdemo_sk#27062L,ss_hdemo_sk#27063L,ss_addr_sk#27064L,ss_store_sk#27065L,ss_promo_sk#27066L,ss_ticket_number#27067L,ss_quantity#27068,ss_wholesale_cost#27069,ss_list_price#27070,ss_sales_price#27071,ss_ext_discount_amt#27072,ss_ext_sales_price#27073,ss_ext_wholesale_cost#27074,ss_ext_list_price#27075,ss_ext_tax#27076,ss_coupon_amt#27077,ss_net_paid#27078,ss_net_paid_inc_tax#27079,ss_net_profit#27080,ss_sold_date_sk#27081L] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[sumsales#27058 ASC NULLS FIRST,ss_customer_sk#27061L ASC NULLS FIRST], output=[ss_customer_sk#27061L,sumsales#27058])
   +- HashAggregate(keys=[ss_customer_sk#27061L], functions=[sum(act_sales#27057)], output=[ss_customer_sk#27061L, sumsales#27058])
      +- Exchange hashpartitioning(ss_customer_sk#27061L, 3000), ENSURE_REQUIREMENTS, [id=#28320]
         +- HashAggregate(keys=[ss_customer_sk#27061L], functions=[partial_sum(act_sales#27057)], output=[ss_customer_sk#27061L, sum#27109])
            +- Project [ss_customer_sk#27061L, CASE WHEN isnotnull(sr_return_quantity#27091) THEN (cast((ss_quantity#27068 - sr_return_quantity#27091) as double) * ss_sales_price#27071) ELSE (cast(ss_quantity#27068 as double) * ss_sales_price#27071) END AS act_sales#27057]
               +- SortMergeJoin [sr_item_sk#27083L, sr_ticket_number#27090L], [ss_item_sk#27060L, ss_ticket_number#27067L], Inner
                  :- Sort [sr_item_sk#27083L ASC NULLS FIRST, sr_ticket_number#27090L ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(sr_item_sk#27083L, sr_ticket_number#27090L, 3000), ENSURE_REQUIREMENTS, [id=#28312]
                  :     +- Project [sr_item_sk#27083L, sr_ticket_number#27090L, sr_return_quantity#27091]
                  :        +- BroadcastHashJoin [sr_reason_sk#27089L], [r_reason_sk#27102L], Inner, BuildRight, false
                  :           :- Project [sr_item_sk#27083L, sr_reason_sk#27089L, sr_ticket_number#27090L, sr_return_quantity#27091]
                  :           :  +- Filter ((isnotnull(sr_item_sk#27083L) AND isnotnull(sr_ticket_number#27090L)) AND isnotnull(sr_reason_sk#27089L))
                  :           :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_returns[sr_item_sk#27083L,sr_reason_sk#27089L,sr_ticket_number#27090L,sr_return_quantity#27091,sr_returned_date_sk#27101L] Batched: true, DataFilters: [isnotnull(sr_item_sk#27083L), isnotnull(sr_ticket_number#27090L), isnotnull(sr_reason_sk#27089L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(sr_item_sk), IsNotNull(sr_ticket_number), IsNotNull(sr_reason_sk)], ReadSchema: struct<sr_item_sk:bigint,sr_reason_sk:bigint,sr_ticket_number:bigint,sr_return_quantity:int>
                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28307]
                  :              +- Project [r_reason_sk#27102L]
                  :                 +- Filter ((isnotnull(r_reason_desc#27104) AND (r_reason_desc#27104 = Did not like the warranty)) AND isnotnull(r_reason_sk#27102L))
                  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.reason[r_reason_sk#27102L,r_reason_desc#27104] Batched: true, DataFilters: [isnotnull(r_reason_desc#27104), (r_reason_desc#27104 = Did not like the warranty), isnotnull(r_r..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_desc), EqualTo(r_reason_desc,Did not like the warranty), IsNotNull(r_reason_sk)], ReadSchema: struct<r_reason_sk:bigint,r_reason_desc:string>
                  +- Sort [ss_item_sk#27060L ASC NULLS FIRST, ss_ticket_number#27067L ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(ss_item_sk#27060L, ss_ticket_number#27067L, 3000), ENSURE_REQUIREMENTS, [id=#28313]
                        +- Project [ss_item_sk#27060L, ss_customer_sk#27061L, ss_ticket_number#27067L, ss_quantity#27068, ss_sales_price#27071]
                           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#27060L,ss_customer_sk#27061L,ss_ticket_number#27067L,ss_quantity#27068,ss_sales_price#27071,ss_sold_date_sk#27081L] Batched: true, DataFilters: [], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint,ss_ticket_number:bigint,ss_quantity:int,ss_sales_p...

read query: spark_queries/q94.sql
explain query: q94
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['count(distinct 'ws_order_number) ASC NULLS FIRST], true
      +- 'Project ['count(distinct 'ws_order_number) AS order count#27110, 'sum('ws_ext_ship_cost) AS total shipping cost#27111, 'sum('ws_net_profit) AS total net profit#27112]
         +- 'Filter ((((('d_date >= 1999-5-01) AND ('d_date <= (cast(1999-5-01 as date) + INTERVAL '60' DAY))) AND ('ws1.ws_ship_date_sk = 'd_date_sk)) AND (('ws1.ws_ship_addr_sk = 'ca_address_sk) AND ('ca_state = TX))) AND ((('ws1.ws_web_site_sk = 'web_site_sk) AND ('web_company_name = pri)) AND (exists#27113 [] AND NOT exists#27114 [])))
            :  :- 'Project [*]
            :  :  +- 'Filter (('ws1.ws_order_number = 'ws2.ws_order_number) AND NOT ('ws1.ws_warehouse_sk = 'ws2.ws_warehouse_sk))
            :  :     +- 'SubqueryAlias ws2
            :  :        +- 'UnresolvedRelation [web_sales], [], false
            :  +- 'Project [*]
            :     +- 'Filter ('ws1.ws_order_number = 'wr1.wr_order_number)
            :        +- 'SubqueryAlias wr1
            :           +- 'UnresolvedRelation [web_returns], [], false
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'SubqueryAlias ws1
               :  :  :  +- 'UnresolvedRelation [web_sales], [], false
               :  :  +- 'UnresolvedRelation [date_dim], [], false
               :  +- 'UnresolvedRelation [customer_address], [], false
               +- 'UnresolvedRelation [web_site], [], false

== Analyzed Logical Plan ==
order count: bigint, total shipping cost: double, total net profit: double
GlobalLimit 100
+- LocalLimit 100
   +- Sort [order count#27110L ASC NULLS FIRST], true
      +- Aggregate [count(distinct ws_order_number#27131L) AS order count#27110L, sum(ws_ext_ship_cost#27142) AS total shipping cost#27111, sum(ws_net_profit#27147) AS total net profit#27112]
         +- Filter (((((d_date#27151 >= cast(1999-5-01 as date)) AND (d_date#27151 <= date_add(cast(1999-5-01 as date), extractansiintervaldays(INTERVAL '60' DAY)))) AND (ws_ship_date_sk#27116L = d_date_sk#27149L)) AND ((ws_ship_addr_sk#27125L = ca_address_sk#27177L) AND (ca_state#27185 = TX))) AND (((ws_web_site_sk#27127L = web_site_sk#27190L) AND (web_company_name#27204 = pri)) AND (exists#27113 [ws_order_number#27131L && ws_warehouse_sk#27129L] AND NOT exists#27114 [ws_order_number#27131L])))
            :  :- Project [ws_sold_time_sk#27216L, ws_ship_date_sk#27217L, ws_item_sk#27218L, ws_bill_customer_sk#27219L, ws_bill_cdemo_sk#27220L, ws_bill_hdemo_sk#27221L, ws_bill_addr_sk#27222L, ws_ship_customer_sk#27223L, ws_ship_cdemo_sk#27224L, ws_ship_hdemo_sk#27225L, ws_ship_addr_sk#27226L, ws_web_page_sk#27227L, ws_web_site_sk#27228L, ws_ship_mode_sk#27229L, ws_warehouse_sk#27230L, ws_promo_sk#27231L, ws_order_number#27232L, ws_quantity#27233, ws_wholesale_cost#27234, ws_list_price#27235, ws_sales_price#27236, ws_ext_discount_amt#27237, ws_ext_sales_price#27238, ws_ext_wholesale_cost#27239, ... 10 more fields]
            :  :  +- Filter ((outer(ws_order_number#27131L) = ws_order_number#27232L) AND NOT (outer(ws_warehouse_sk#27129L) = ws_warehouse_sk#27230L))
            :  :     +- SubqueryAlias ws2
            :  :        +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
            :  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27216L,ws_ship_date_sk#27217L,ws_item_sk#27218L,ws_bill_customer_sk#27219L,ws_bill_cdemo_sk#27220L,ws_bill_hdemo_sk#27221L,ws_bill_addr_sk#27222L,ws_ship_customer_sk#27223L,ws_ship_cdemo_sk#27224L,ws_ship_hdemo_sk#27225L,ws_ship_addr_sk#27226L,ws_web_page_sk#27227L,ws_web_site_sk#27228L,ws_ship_mode_sk#27229L,ws_warehouse_sk#27230L,ws_promo_sk#27231L,ws_order_number#27232L,ws_quantity#27233,ws_wholesale_cost#27234,ws_list_price#27235,ws_sales_price#27236,ws_ext_discount_amt#27237,ws_ext_sales_price#27238,ws_ext_wholesale_cost#27239,... 10 more fields] orc
            :  +- Project [wr_returned_time_sk#27250L, wr_item_sk#27251L, wr_refunded_customer_sk#27252L, wr_refunded_cdemo_sk#27253L, wr_refunded_hdemo_sk#27254L, wr_refunded_addr_sk#27255L, wr_returning_customer_sk#27256L, wr_returning_cdemo_sk#27257L, wr_returning_hdemo_sk#27258L, wr_returning_addr_sk#27259L, wr_web_page_sk#27260L, wr_reason_sk#27261L, wr_order_number#27262L, wr_return_quantity#27263, wr_return_amt#27264, wr_return_tax#27265, wr_return_amt_inc_tax#27266, wr_fee#27267, wr_return_ship_cost#27268, wr_refunded_cash#27269, wr_reversed_charge#27270, wr_account_credit#27271, wr_net_loss#27272, wr_returned_date_sk#27273L]
            :     +- Filter (outer(ws_order_number#27131L) = wr_order_number#27262L)
            :        +- SubqueryAlias wr1
            :           +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
            :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#27250L,wr_item_sk#27251L,wr_refunded_customer_sk#27252L,wr_refunded_cdemo_sk#27253L,wr_refunded_hdemo_sk#27254L,wr_refunded_addr_sk#27255L,wr_returning_customer_sk#27256L,wr_returning_cdemo_sk#27257L,wr_returning_hdemo_sk#27258L,wr_returning_addr_sk#27259L,wr_web_page_sk#27260L,wr_reason_sk#27261L,wr_order_number#27262L,wr_return_quantity#27263,wr_return_amt#27264,wr_return_tax#27265,wr_return_amt_inc_tax#27266,wr_fee#27267,wr_return_ship_cost#27268,wr_refunded_cash#27269,wr_reversed_charge#27270,wr_account_credit#27271,wr_net_loss#27272,wr_returned_date_sk#27273L] orc
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias ws1
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27115L,ws_ship_date_sk#27116L,ws_item_sk#27117L,ws_bill_customer_sk#27118L,ws_bill_cdemo_sk#27119L,ws_bill_hdemo_sk#27120L,ws_bill_addr_sk#27121L,ws_ship_customer_sk#27122L,ws_ship_cdemo_sk#27123L,ws_ship_hdemo_sk#27124L,ws_ship_addr_sk#27125L,ws_web_page_sk#27126L,ws_web_site_sk#27127L,ws_ship_mode_sk#27128L,ws_warehouse_sk#27129L,ws_promo_sk#27130L,ws_order_number#27131L,ws_quantity#27132,ws_wholesale_cost#27133,ws_list_price#27134,ws_sales_price#27135,ws_ext_discount_amt#27136,ws_ext_sales_price#27137,ws_ext_wholesale_cost#27138,... 10 more fields] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27149L,d_date_id#27150,d_date#27151,d_month_seq#27152,d_week_seq#27153,d_quarter_seq#27154,d_year#27155,d_dow#27156,d_moy#27157,d_dom#27158,d_qoy#27159,d_fy_year#27160,d_fy_quarter_seq#27161,d_fy_week_seq#27162,d_day_name#27163,d_quarter_name#27164,d_holiday#27165,d_weekend#27166,d_following_holiday#27167,d_first_dom#27168,d_last_dom#27169,d_same_day_ly#27170,d_same_day_lq#27171,d_current_day#27172,... 4 more fields] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27177L,ca_address_id#27178,ca_street_number#27179,ca_street_name#27180,ca_street_type#27181,ca_suite_number#27182,ca_city#27183,ca_county#27184,ca_state#27185,ca_zip#27186,ca_country#27187,ca_gmt_offset#27188,ca_location_type#27189] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_site
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27190L,web_site_id#27191,web_rec_start_date#27192,web_rec_end_date#27193,web_name#27194,web_open_date_sk#27195L,web_close_date_sk#27196L,web_class#27197,web_manager#27198,web_mkt_id#27199,web_mkt_class#27200,web_mkt_desc#27201,web_market_manager#27202,web_company_id#27203,web_company_name#27204,web_street_number#27205,web_street_name#27206,web_street_type#27207,web_suite_number#27208,web_city#27209,web_county#27210,web_state#27211,web_zip#27212,web_country#27213,... 2 more fields] orc

== Optimized Logical Plan ==
Aggregate [count(distinct ws_order_number#27131L) AS order count#27110L, sum(ws_ext_ship_cost#27142) AS total shipping cost#27111, sum(ws_net_profit#27147) AS total net profit#27112]
+- Project [ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
   +- Join Inner, (ws_ship_date_sk#27116L = d_date_sk#27149L)
      :- Project [ws_ship_date_sk#27116L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
      :  +- Join Inner, (ws_web_site_sk#27127L = web_site_sk#27190L)
      :     :- Project [ws_ship_date_sk#27116L, ws_web_site_sk#27127L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
      :     :  +- Join Inner, (ws_ship_addr_sk#27125L = ca_address_sk#27177L)
      :     :     :- Join LeftAnti, (ws_order_number#27131L = wr_order_number#27262L)
      :     :     :  :- Project [ws_ship_date_sk#27116L, ws_ship_addr_sk#27125L, ws_web_site_sk#27127L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
      :     :     :  :  +- Join LeftSemi, ((ws_order_number#27131L = ws_order_number#27232L) AND NOT (ws_warehouse_sk#27129L = ws_warehouse_sk#27230L))
      :     :     :  :     :- Project [ws_ship_date_sk#27116L, ws_ship_addr_sk#27125L, ws_web_site_sk#27127L, ws_warehouse_sk#27129L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
      :     :     :  :     :  +- Filter ((isnotnull(ws_ship_date_sk#27116L) AND isnotnull(ws_ship_addr_sk#27125L)) AND isnotnull(ws_web_site_sk#27127L))
      :     :     :  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27115L,ws_ship_date_sk#27116L,ws_item_sk#27117L,ws_bill_customer_sk#27118L,ws_bill_cdemo_sk#27119L,ws_bill_hdemo_sk#27120L,ws_bill_addr_sk#27121L,ws_ship_customer_sk#27122L,ws_ship_cdemo_sk#27123L,ws_ship_hdemo_sk#27124L,ws_ship_addr_sk#27125L,ws_web_page_sk#27126L,ws_web_site_sk#27127L,ws_ship_mode_sk#27128L,ws_warehouse_sk#27129L,ws_promo_sk#27130L,ws_order_number#27131L,ws_quantity#27132,ws_wholesale_cost#27133,ws_list_price#27134,ws_sales_price#27135,ws_ext_discount_amt#27136,ws_ext_sales_price#27137,ws_ext_wholesale_cost#27138,... 10 more fields] orc
      :     :     :  :     +- Project [ws_warehouse_sk#27230L, ws_order_number#27232L]
      :     :     :  :        +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27216L,ws_ship_date_sk#27217L,ws_item_sk#27218L,ws_bill_customer_sk#27219L,ws_bill_cdemo_sk#27220L,ws_bill_hdemo_sk#27221L,ws_bill_addr_sk#27222L,ws_ship_customer_sk#27223L,ws_ship_cdemo_sk#27224L,ws_ship_hdemo_sk#27225L,ws_ship_addr_sk#27226L,ws_web_page_sk#27227L,ws_web_site_sk#27228L,ws_ship_mode_sk#27229L,ws_warehouse_sk#27230L,ws_promo_sk#27231L,ws_order_number#27232L,ws_quantity#27233,ws_wholesale_cost#27234,ws_list_price#27235,ws_sales_price#27236,ws_ext_discount_amt#27237,ws_ext_sales_price#27238,ws_ext_wholesale_cost#27239,... 10 more fields] orc
      :     :     :  +- Project [wr_order_number#27262L]
      :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#27250L,wr_item_sk#27251L,wr_refunded_customer_sk#27252L,wr_refunded_cdemo_sk#27253L,wr_refunded_hdemo_sk#27254L,wr_refunded_addr_sk#27255L,wr_returning_customer_sk#27256L,wr_returning_cdemo_sk#27257L,wr_returning_hdemo_sk#27258L,wr_returning_addr_sk#27259L,wr_web_page_sk#27260L,wr_reason_sk#27261L,wr_order_number#27262L,wr_return_quantity#27263,wr_return_amt#27264,wr_return_tax#27265,wr_return_amt_inc_tax#27266,wr_fee#27267,wr_return_ship_cost#27268,wr_refunded_cash#27269,wr_reversed_charge#27270,wr_account_credit#27271,wr_net_loss#27272,wr_returned_date_sk#27273L] orc
      :     :     +- Project [ca_address_sk#27177L]
      :     :        +- Filter ((isnotnull(ca_state#27185) AND (ca_state#27185 = TX)) AND isnotnull(ca_address_sk#27177L))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27177L,ca_address_id#27178,ca_street_number#27179,ca_street_name#27180,ca_street_type#27181,ca_suite_number#27182,ca_city#27183,ca_county#27184,ca_state#27185,ca_zip#27186,ca_country#27187,ca_gmt_offset#27188,ca_location_type#27189] orc
      :     +- Project [web_site_sk#27190L]
      :        +- Filter ((isnotnull(web_company_name#27204) AND (web_company_name#27204 = pri)) AND isnotnull(web_site_sk#27190L))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27190L,web_site_id#27191,web_rec_start_date#27192,web_rec_end_date#27193,web_name#27194,web_open_date_sk#27195L,web_close_date_sk#27196L,web_class#27197,web_manager#27198,web_mkt_id#27199,web_mkt_class#27200,web_mkt_desc#27201,web_market_manager#27202,web_company_id#27203,web_company_name#27204,web_street_number#27205,web_street_name#27206,web_street_type#27207,web_suite_number#27208,web_city#27209,web_county#27210,web_state#27211,web_zip#27212,web_country#27213,... 2 more fields] orc
      +- Project [d_date_sk#27149L]
         +- Filter ((isnotnull(d_date#27151) AND ((d_date#27151 >= 1999-05-01) AND (d_date#27151 <= 1999-06-30))) AND isnotnull(d_date_sk#27149L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27149L,d_date_id#27150,d_date#27151,d_month_seq#27152,d_week_seq#27153,d_quarter_seq#27154,d_year#27155,d_dow#27156,d_moy#27157,d_dom#27158,d_qoy#27159,d_fy_year#27160,d_fy_quarter_seq#27161,d_fy_week_seq#27162,d_day_name#27163,d_quarter_name#27164,d_holiday#27165,d_weekend#27166,d_following_holiday#27167,d_first_dom#27168,d_last_dom#27169,d_same_day_ly#27170,d_same_day_lq#27171,d_current_day#27172,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(ws_ext_ship_cost#27142), sum(ws_net_profit#27147), count(distinct ws_order_number#27131L)], output=[order count#27110L, total shipping cost#27111, total net profit#27112])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#28444]
      +- HashAggregate(keys=[], functions=[merge_sum(ws_ext_ship_cost#27142), merge_sum(ws_net_profit#27147), partial_count(distinct ws_order_number#27131L)], output=[sum#27282, sum#27284, count#27287L])
         +- HashAggregate(keys=[ws_order_number#27131L], functions=[merge_sum(ws_ext_ship_cost#27142), merge_sum(ws_net_profit#27147)], output=[ws_order_number#27131L, sum#27282, sum#27284])
            +- HashAggregate(keys=[ws_order_number#27131L], functions=[partial_sum(ws_ext_ship_cost#27142), partial_sum(ws_net_profit#27147)], output=[ws_order_number#27131L, sum#27282, sum#27284])
               +- Project [ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
                  +- BroadcastHashJoin [ws_ship_date_sk#27116L], [d_date_sk#27149L], Inner, BuildRight, false
                     :- Project [ws_ship_date_sk#27116L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
                     :  +- BroadcastHashJoin [ws_web_site_sk#27127L], [web_site_sk#27190L], Inner, BuildRight, false
                     :     :- Project [ws_ship_date_sk#27116L, ws_web_site_sk#27127L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
                     :     :  +- BroadcastHashJoin [ws_ship_addr_sk#27125L], [ca_address_sk#27177L], Inner, BuildRight, false
                     :     :     :- SortMergeJoin [ws_order_number#27131L], [wr_order_number#27262L], LeftAnti
                     :     :     :  :- Project [ws_ship_date_sk#27116L, ws_ship_addr_sk#27125L, ws_web_site_sk#27127L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
                     :     :     :  :  +- SortMergeJoin [ws_order_number#27131L], [ws_order_number#27232L], LeftSemi, NOT (ws_warehouse_sk#27129L = ws_warehouse_sk#27230L)
                     :     :     :  :     :- Sort [ws_order_number#27131L ASC NULLS FIRST], false, 0
                     :     :     :  :     :  +- Exchange hashpartitioning(ws_order_number#27131L, 3000), ENSURE_REQUIREMENTS, [id=#28417]
                     :     :     :  :     :     +- Project [ws_ship_date_sk#27116L, ws_ship_addr_sk#27125L, ws_web_site_sk#27127L, ws_warehouse_sk#27129L, ws_order_number#27131L, ws_ext_ship_cost#27142, ws_net_profit#27147]
                     :     :     :  :     :        +- Filter ((isnotnull(ws_ship_date_sk#27116L) AND isnotnull(ws_ship_addr_sk#27125L)) AND isnotnull(ws_web_site_sk#27127L))
                     :     :     :  :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_ship_date_sk#27116L,ws_ship_addr_sk#27125L,ws_web_site_sk#27127L,ws_warehouse_sk#27129L,ws_order_number#27131L,ws_ext_ship_cost#27142,ws_net_profit#27147,ws_sold_date_sk#27148L] Batched: true, DataFilters: [isnotnull(ws_ship_date_sk#27116L), isnotnull(ws_ship_addr_sk#27125L), isnotnull(ws_web_site_sk#2..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_date_sk), IsNotNull(ws_ship_addr_sk), IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_ship_date_sk:bigint,ws_ship_addr_sk:bigint,ws_web_site_sk:bigint,ws_warehouse_sk:bigint...
                     :     :     :  :     +- Sort [ws_order_number#27232L ASC NULLS FIRST], false, 0
                     :     :     :  :        +- Exchange hashpartitioning(ws_order_number#27232L, 3000), ENSURE_REQUIREMENTS, [id=#28418]
                     :     :     :  :           +- Project [ws_warehouse_sk#27230L, ws_order_number#27232L]
                     :     :     :  :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_warehouse_sk#27230L,ws_order_number#27232L,ws_sold_date_sk#27249L] Batched: true, DataFilters: [], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ws_warehouse_sk:bigint,ws_order_number:bigint>
                     :     :     :  +- Sort [wr_order_number#27262L ASC NULLS FIRST], false, 0
                     :     :     :     +- Exchange hashpartitioning(wr_order_number#27262L, 3000), ENSURE_REQUIREMENTS, [id=#28425]
                     :     :     :        +- Project [wr_order_number#27262L]
                     :     :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_order_number#27262L,wr_returned_date_sk#27273L] Batched: true, DataFilters: [], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<wr_order_number:bigint>
                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28429]
                     :     :        +- Project [ca_address_sk#27177L]
                     :     :           +- Filter ((isnotnull(ca_state#27185) AND (ca_state#27185 = TX)) AND isnotnull(ca_address_sk#27177L))
                     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27177L,ca_state#27185] Batched: true, DataFilters: [isnotnull(ca_state#27185), (ca_state#27185 = TX), isnotnull(ca_address_sk#27177L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,TX), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28433]
                     :        +- Project [web_site_sk#27190L]
                     :           +- Filter ((isnotnull(web_company_name#27204) AND (web_company_name#27204 = pri)) AND isnotnull(web_site_sk#27190L))
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27190L,web_company_name#27204] Batched: true, DataFilters: [isnotnull(web_company_name#27204), (web_company_name#27204 = pri), isnotnull(web_site_sk#27190L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(web_company_name), EqualTo(web_company_name,pri), IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:bigint,web_company_name:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28437]
                        +- Project [d_date_sk#27149L]
                           +- Filter (((isnotnull(d_date#27151) AND (d_date#27151 >= 1999-05-01)) AND (d_date#27151 <= 1999-06-30)) AND isnotnull(d_date_sk#27149L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27149L,d_date#27151] Batched: true, DataFilters: [isnotnull(d_date#27151), (d_date#27151 >= 1999-05-01), (d_date#27151 <= 1999-06-30), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-05-01), LessThanOrEqual(d_date,1999-06-30), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>

read query: spark_queries/q95.sql
explain query: q95
== Parsed Logical Plan ==
CTE [ws_wh]
:  +- 'SubqueryAlias ws_wh
:     +- 'Project ['ws1.ws_order_number, 'ws1.ws_warehouse_sk AS wh1#27294, 'ws2.ws_warehouse_sk AS wh2#27295]
:        +- 'Filter (('ws1.ws_order_number = 'ws2.ws_order_number) AND NOT ('ws1.ws_warehouse_sk = 'ws2.ws_warehouse_sk))
:           +- 'Join Inner
:              :- 'SubqueryAlias ws1
:              :  +- 'UnresolvedRelation [web_sales], [], false
:              +- 'SubqueryAlias ws2
:                 +- 'UnresolvedRelation [web_sales], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['count(distinct 'ws_order_number) ASC NULLS FIRST], true
         +- 'Project ['count(distinct 'ws_order_number) AS order count#27289, 'sum('ws_ext_ship_cost) AS total shipping cost#27290, 'sum('ws_net_profit) AS total net profit#27291]
            +- 'Filter ((((('d_date >= 1999-5-01) AND ('d_date <= (cast(1999-5-01 as date) + INTERVAL '60' DAY))) AND ('ws1.ws_ship_date_sk = 'd_date_sk)) AND (('ws1.ws_ship_addr_sk = 'ca_address_sk) AND ('ca_state = TX))) AND ((('ws1.ws_web_site_sk = 'web_site_sk) AND ('web_company_name = pri)) AND ('ws1.ws_order_number IN (list#27292 []) AND 'ws1.ws_order_number IN (list#27293 []))))
               :  :- 'Project ['ws_order_number]
               :  :  +- 'UnresolvedRelation [ws_wh], [], false
               :  +- 'Project ['wr_order_number]
               :     +- 'Filter ('wr_order_number = 'ws_wh.ws_order_number)
               :        +- 'Join Inner
               :           :- 'UnresolvedRelation [web_returns], [], false
               :           +- 'UnresolvedRelation [ws_wh], [], false
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'SubqueryAlias ws1
                  :  :  :  +- 'UnresolvedRelation [web_sales], [], false
                  :  :  +- 'UnresolvedRelation [date_dim], [], false
                  :  +- 'UnresolvedRelation [customer_address], [], false
                  +- 'UnresolvedRelation [web_site], [], false

== Analyzed Logical Plan ==
order count: bigint, total shipping cost: double, total net profit: double
WithCTE
:- CTERelationDef 66
:  +- SubqueryAlias ws_wh
:     +- Project [ws_order_number#27312L, ws_warehouse_sk#27310L AS wh1#27294L, ws_warehouse_sk#27344L AS wh2#27295L]
:        +- Filter ((ws_order_number#27312L = ws_order_number#27346L) AND NOT (ws_warehouse_sk#27310L = ws_warehouse_sk#27344L))
:           +- Join Inner
:              :- SubqueryAlias ws1
:              :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:              :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27296L,ws_ship_date_sk#27297L,ws_item_sk#27298L,ws_bill_customer_sk#27299L,ws_bill_cdemo_sk#27300L,ws_bill_hdemo_sk#27301L,ws_bill_addr_sk#27302L,ws_ship_customer_sk#27303L,ws_ship_cdemo_sk#27304L,ws_ship_hdemo_sk#27305L,ws_ship_addr_sk#27306L,ws_web_page_sk#27307L,ws_web_site_sk#27308L,ws_ship_mode_sk#27309L,ws_warehouse_sk#27310L,ws_promo_sk#27311L,ws_order_number#27312L,ws_quantity#27313,ws_wholesale_cost#27314,ws_list_price#27315,ws_sales_price#27316,ws_ext_discount_amt#27317,ws_ext_sales_price#27318,ws_ext_wholesale_cost#27319,... 10 more fields] orc
:              +- SubqueryAlias ws2
:                 +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
:                    +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27330L,ws_ship_date_sk#27331L,ws_item_sk#27332L,ws_bill_customer_sk#27333L,ws_bill_cdemo_sk#27334L,ws_bill_hdemo_sk#27335L,ws_bill_addr_sk#27336L,ws_ship_customer_sk#27337L,ws_ship_cdemo_sk#27338L,ws_ship_hdemo_sk#27339L,ws_ship_addr_sk#27340L,ws_web_page_sk#27341L,ws_web_site_sk#27342L,ws_ship_mode_sk#27343L,ws_warehouse_sk#27344L,ws_promo_sk#27345L,ws_order_number#27346L,ws_quantity#27347,ws_wholesale_cost#27348,ws_list_price#27349,ws_sales_price#27350,ws_ext_discount_amt#27351,ws_ext_sales_price#27352,ws_ext_wholesale_cost#27353,... 10 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [order count#27289L ASC NULLS FIRST], true
         +- Aggregate [count(distinct ws_order_number#27380L) AS order count#27289L, sum(ws_ext_ship_cost#27391) AS total shipping cost#27290, sum(ws_net_profit#27396) AS total net profit#27291]
            +- Filter (((((d_date#27400 >= cast(1999-5-01 as date)) AND (d_date#27400 <= date_add(cast(1999-5-01 as date), extractansiintervaldays(INTERVAL '60' DAY)))) AND (ws_ship_date_sk#27365L = d_date_sk#27398L)) AND ((ws_ship_addr_sk#27374L = ca_address_sk#27426L) AND (ca_state#27434 = TX))) AND (((ws_web_site_sk#27376L = web_site_sk#27439L) AND (web_company_name#27453 = pri)) AND (ws_order_number#27380L IN (list#27292 []) AND ws_order_number#27380L IN (list#27293 []))))
               :  :- Project [ws_order_number#27312L]
               :  :  +- SubqueryAlias ws_wh
               :  :     +- CTERelationRef 66, true, [ws_order_number#27312L, wh1#27294L, wh2#27295L]
               :  +- Project [wr_order_number#27477L]
               :     +- Filter (wr_order_number#27477L = ws_order_number#27312L)
               :        +- Join Inner
               :           :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_returns
               :           :  +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#27465L,wr_item_sk#27466L,wr_refunded_customer_sk#27467L,wr_refunded_cdemo_sk#27468L,wr_refunded_hdemo_sk#27469L,wr_refunded_addr_sk#27470L,wr_returning_customer_sk#27471L,wr_returning_cdemo_sk#27472L,wr_returning_hdemo_sk#27473L,wr_returning_addr_sk#27474L,wr_web_page_sk#27475L,wr_reason_sk#27476L,wr_order_number#27477L,wr_return_quantity#27478,wr_return_amt#27479,wr_return_tax#27480,wr_return_amt_inc_tax#27481,wr_fee#27482,wr_return_ship_cost#27483,wr_refunded_cash#27484,wr_reversed_charge#27485,wr_account_credit#27486,wr_net_loss#27487,wr_returned_date_sk#27488L] orc
               :           +- SubqueryAlias ws_wh
               :              +- CTERelationRef 66, true, [ws_order_number#27312L, wh1#27294L, wh2#27295L]
               +- Join Inner
                  :- Join Inner
                  :  :- Join Inner
                  :  :  :- SubqueryAlias ws1
                  :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_sales
                  :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27364L,ws_ship_date_sk#27365L,ws_item_sk#27366L,ws_bill_customer_sk#27367L,ws_bill_cdemo_sk#27368L,ws_bill_hdemo_sk#27369L,ws_bill_addr_sk#27370L,ws_ship_customer_sk#27371L,ws_ship_cdemo_sk#27372L,ws_ship_hdemo_sk#27373L,ws_ship_addr_sk#27374L,ws_web_page_sk#27375L,ws_web_site_sk#27376L,ws_ship_mode_sk#27377L,ws_warehouse_sk#27378L,ws_promo_sk#27379L,ws_order_number#27380L,ws_quantity#27381,ws_wholesale_cost#27382,ws_list_price#27383,ws_sales_price#27384,ws_ext_discount_amt#27385,ws_ext_sales_price#27386,ws_ext_wholesale_cost#27387,... 10 more fields] orc
                  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27398L,d_date_id#27399,d_date#27400,d_month_seq#27401,d_week_seq#27402,d_quarter_seq#27403,d_year#27404,d_dow#27405,d_moy#27406,d_dom#27407,d_qoy#27408,d_fy_year#27409,d_fy_quarter_seq#27410,d_fy_week_seq#27411,d_day_name#27412,d_quarter_name#27413,d_holiday#27414,d_weekend#27415,d_following_holiday#27416,d_first_dom#27417,d_last_dom#27418,d_same_day_ly#27419,d_same_day_lq#27420,d_current_day#27421,... 4 more fields] orc
                  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.customer_address
                  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27426L,ca_address_id#27427,ca_street_number#27428,ca_street_name#27429,ca_street_type#27430,ca_suite_number#27431,ca_city#27432,ca_county#27433,ca_state#27434,ca_zip#27435,ca_country#27436,ca_gmt_offset#27437,ca_location_type#27438] orc
                  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.web_site
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27439L,web_site_id#27440,web_rec_start_date#27441,web_rec_end_date#27442,web_name#27443,web_open_date_sk#27444L,web_close_date_sk#27445L,web_class#27446,web_manager#27447,web_mkt_id#27448,web_mkt_class#27449,web_mkt_desc#27450,web_market_manager#27451,web_company_id#27452,web_company_name#27453,web_street_number#27454,web_street_name#27455,web_street_type#27456,web_suite_number#27457,web_city#27458,web_county#27459,web_state#27460,web_zip#27461,web_country#27462,... 2 more fields] orc

== Optimized Logical Plan ==
Aggregate [count(distinct ws_order_number#27380L) AS order count#27289L, sum(ws_ext_ship_cost#27391) AS total shipping cost#27290, sum(ws_net_profit#27396) AS total net profit#27291]
+- Project [ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
   +- Join Inner, (ws_ship_date_sk#27365L = d_date_sk#27398L)
      :- Project [ws_ship_date_sk#27365L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
      :  +- Join Inner, (ws_web_site_sk#27376L = web_site_sk#27439L)
      :     :- Project [ws_ship_date_sk#27365L, ws_web_site_sk#27376L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
      :     :  +- Join Inner, (ws_ship_addr_sk#27374L = ca_address_sk#27426L)
      :     :     :- Join LeftSemi, (ws_order_number#27380L = wr_order_number#27477L)
      :     :     :  :- Join LeftSemi, (ws_order_number#27380L = ws_order_number#27312L)
      :     :     :  :  :- Project [ws_ship_date_sk#27365L, ws_ship_addr_sk#27374L, ws_web_site_sk#27376L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
      :     :     :  :  :  +- Filter ((isnotnull(ws_ship_date_sk#27365L) AND isnotnull(ws_ship_addr_sk#27374L)) AND isnotnull(ws_web_site_sk#27376L))
      :     :     :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27364L,ws_ship_date_sk#27365L,ws_item_sk#27366L,ws_bill_customer_sk#27367L,ws_bill_cdemo_sk#27368L,ws_bill_hdemo_sk#27369L,ws_bill_addr_sk#27370L,ws_ship_customer_sk#27371L,ws_ship_cdemo_sk#27372L,ws_ship_hdemo_sk#27373L,ws_ship_addr_sk#27374L,ws_web_page_sk#27375L,ws_web_site_sk#27376L,ws_ship_mode_sk#27377L,ws_warehouse_sk#27378L,ws_promo_sk#27379L,ws_order_number#27380L,ws_quantity#27381,ws_wholesale_cost#27382,ws_list_price#27383,ws_sales_price#27384,ws_ext_discount_amt#27385,ws_ext_sales_price#27386,ws_ext_wholesale_cost#27387,... 10 more fields] orc
      :     :     :  :  +- Project [ws_order_number#27312L]
      :     :     :  :     +- Join Inner, ((ws_order_number#27312L = ws_order_number#27346L) AND NOT (ws_warehouse_sk#27310L = ws_warehouse_sk#27344L))
      :     :     :  :        :- Project [ws_warehouse_sk#27310L, ws_order_number#27312L]
      :     :     :  :        :  +- Filter (isnotnull(ws_order_number#27312L) AND isnotnull(ws_warehouse_sk#27310L))
      :     :     :  :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27296L,ws_ship_date_sk#27297L,ws_item_sk#27298L,ws_bill_customer_sk#27299L,ws_bill_cdemo_sk#27300L,ws_bill_hdemo_sk#27301L,ws_bill_addr_sk#27302L,ws_ship_customer_sk#27303L,ws_ship_cdemo_sk#27304L,ws_ship_hdemo_sk#27305L,ws_ship_addr_sk#27306L,ws_web_page_sk#27307L,ws_web_site_sk#27308L,ws_ship_mode_sk#27309L,ws_warehouse_sk#27310L,ws_promo_sk#27311L,ws_order_number#27312L,ws_quantity#27313,ws_wholesale_cost#27314,ws_list_price#27315,ws_sales_price#27316,ws_ext_discount_amt#27317,ws_ext_sales_price#27318,ws_ext_wholesale_cost#27319,... 10 more fields] orc
      :     :     :  :        +- Project [ws_warehouse_sk#27344L, ws_order_number#27346L]
      :     :     :  :           +- Filter (isnotnull(ws_order_number#27346L) AND isnotnull(ws_warehouse_sk#27344L))
      :     :     :  :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27330L,ws_ship_date_sk#27331L,ws_item_sk#27332L,ws_bill_customer_sk#27333L,ws_bill_cdemo_sk#27334L,ws_bill_hdemo_sk#27335L,ws_bill_addr_sk#27336L,ws_ship_customer_sk#27337L,ws_ship_cdemo_sk#27338L,ws_ship_hdemo_sk#27339L,ws_ship_addr_sk#27340L,ws_web_page_sk#27341L,ws_web_site_sk#27342L,ws_ship_mode_sk#27343L,ws_warehouse_sk#27344L,ws_promo_sk#27345L,ws_order_number#27346L,ws_quantity#27347,ws_wholesale_cost#27348,ws_list_price#27349,ws_sales_price#27350,ws_ext_discount_amt#27351,ws_ext_sales_price#27352,ws_ext_wholesale_cost#27353,... 10 more fields] orc
      :     :     :  +- Project [wr_order_number#27477L]
      :     :     :     +- Join Inner, ((ws_order_number#27312L = ws_order_number#27346L) AND NOT (ws_warehouse_sk#27310L = ws_warehouse_sk#27344L))
      :     :     :        :- Join Inner, (wr_order_number#27477L = ws_order_number#27312L)
      :     :     :        :  :- Project [wr_order_number#27477L]
      :     :     :        :  :  +- Filter isnotnull(wr_order_number#27477L)
      :     :     :        :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_returned_time_sk#27465L,wr_item_sk#27466L,wr_refunded_customer_sk#27467L,wr_refunded_cdemo_sk#27468L,wr_refunded_hdemo_sk#27469L,wr_refunded_addr_sk#27470L,wr_returning_customer_sk#27471L,wr_returning_cdemo_sk#27472L,wr_returning_hdemo_sk#27473L,wr_returning_addr_sk#27474L,wr_web_page_sk#27475L,wr_reason_sk#27476L,wr_order_number#27477L,wr_return_quantity#27478,wr_return_amt#27479,wr_return_tax#27480,wr_return_amt_inc_tax#27481,wr_fee#27482,wr_return_ship_cost#27483,wr_refunded_cash#27484,wr_reversed_charge#27485,wr_account_credit#27486,wr_net_loss#27487,wr_returned_date_sk#27488L] orc
      :     :     :        :  +- Project [ws_warehouse_sk#27310L, ws_order_number#27312L]
      :     :     :        :     +- Filter (isnotnull(ws_order_number#27312L) AND isnotnull(ws_warehouse_sk#27310L))
      :     :     :        :        +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27296L,ws_ship_date_sk#27297L,ws_item_sk#27298L,ws_bill_customer_sk#27299L,ws_bill_cdemo_sk#27300L,ws_bill_hdemo_sk#27301L,ws_bill_addr_sk#27302L,ws_ship_customer_sk#27303L,ws_ship_cdemo_sk#27304L,ws_ship_hdemo_sk#27305L,ws_ship_addr_sk#27306L,ws_web_page_sk#27307L,ws_web_site_sk#27308L,ws_ship_mode_sk#27309L,ws_warehouse_sk#27310L,ws_promo_sk#27311L,ws_order_number#27312L,ws_quantity#27313,ws_wholesale_cost#27314,ws_list_price#27315,ws_sales_price#27316,ws_ext_discount_amt#27317,ws_ext_sales_price#27318,ws_ext_wholesale_cost#27319,... 10 more fields] orc
      :     :     :        +- Project [ws_warehouse_sk#27344L, ws_order_number#27346L]
      :     :     :           +- Filter (isnotnull(ws_order_number#27346L) AND isnotnull(ws_warehouse_sk#27344L))
      :     :     :              +- Relation spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_sold_time_sk#27330L,ws_ship_date_sk#27331L,ws_item_sk#27332L,ws_bill_customer_sk#27333L,ws_bill_cdemo_sk#27334L,ws_bill_hdemo_sk#27335L,ws_bill_addr_sk#27336L,ws_ship_customer_sk#27337L,ws_ship_cdemo_sk#27338L,ws_ship_hdemo_sk#27339L,ws_ship_addr_sk#27340L,ws_web_page_sk#27341L,ws_web_site_sk#27342L,ws_ship_mode_sk#27343L,ws_warehouse_sk#27344L,ws_promo_sk#27345L,ws_order_number#27346L,ws_quantity#27347,ws_wholesale_cost#27348,ws_list_price#27349,ws_sales_price#27350,ws_ext_discount_amt#27351,ws_ext_sales_price#27352,ws_ext_wholesale_cost#27353,... 10 more fields] orc
      :     :     +- Project [ca_address_sk#27426L]
      :     :        +- Filter ((isnotnull(ca_state#27434) AND (ca_state#27434 = TX)) AND isnotnull(ca_address_sk#27426L))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27426L,ca_address_id#27427,ca_street_number#27428,ca_street_name#27429,ca_street_type#27430,ca_suite_number#27431,ca_city#27432,ca_county#27433,ca_state#27434,ca_zip#27435,ca_country#27436,ca_gmt_offset#27437,ca_location_type#27438] orc
      :     +- Project [web_site_sk#27439L]
      :        +- Filter ((isnotnull(web_company_name#27453) AND (web_company_name#27453 = pri)) AND isnotnull(web_site_sk#27439L))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27439L,web_site_id#27440,web_rec_start_date#27441,web_rec_end_date#27442,web_name#27443,web_open_date_sk#27444L,web_close_date_sk#27445L,web_class#27446,web_manager#27447,web_mkt_id#27448,web_mkt_class#27449,web_mkt_desc#27450,web_market_manager#27451,web_company_id#27452,web_company_name#27453,web_street_number#27454,web_street_name#27455,web_street_type#27456,web_suite_number#27457,web_city#27458,web_county#27459,web_state#27460,web_zip#27461,web_country#27462,... 2 more fields] orc
      +- Project [d_date_sk#27398L]
         +- Filter ((isnotnull(d_date#27400) AND ((d_date#27400 >= 1999-05-01) AND (d_date#27400 <= 1999-06-30))) AND isnotnull(d_date_sk#27398L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27398L,d_date_id#27399,d_date#27400,d_month_seq#27401,d_week_seq#27402,d_quarter_seq#27403,d_year#27404,d_dow#27405,d_moy#27406,d_dom#27407,d_qoy#27408,d_fy_year#27409,d_fy_quarter_seq#27410,d_fy_week_seq#27411,d_day_name#27412,d_quarter_name#27413,d_holiday#27414,d_weekend#27415,d_following_holiday#27416,d_first_dom#27417,d_last_dom#27418,d_same_day_ly#27419,d_same_day_lq#27420,d_current_day#27421,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(ws_ext_ship_cost#27391), sum(ws_net_profit#27396), count(distinct ws_order_number#27380L)], output=[order count#27289L, total shipping cost#27290, total net profit#27291])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#28625]
      +- HashAggregate(keys=[], functions=[merge_sum(ws_ext_ship_cost#27391), merge_sum(ws_net_profit#27396), partial_count(distinct ws_order_number#27380L)], output=[sum#27497, sum#27499, count#27502L])
         +- HashAggregate(keys=[ws_order_number#27380L], functions=[merge_sum(ws_ext_ship_cost#27391), merge_sum(ws_net_profit#27396)], output=[ws_order_number#27380L, sum#27497, sum#27499])
            +- HashAggregate(keys=[ws_order_number#27380L], functions=[partial_sum(ws_ext_ship_cost#27391), partial_sum(ws_net_profit#27396)], output=[ws_order_number#27380L, sum#27497, sum#27499])
               +- Project [ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
                  +- BroadcastHashJoin [ws_ship_date_sk#27365L], [d_date_sk#27398L], Inner, BuildRight, false
                     :- Project [ws_ship_date_sk#27365L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
                     :  +- BroadcastHashJoin [ws_web_site_sk#27376L], [web_site_sk#27439L], Inner, BuildRight, false
                     :     :- Project [ws_ship_date_sk#27365L, ws_web_site_sk#27376L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
                     :     :  +- BroadcastHashJoin [ws_ship_addr_sk#27374L], [ca_address_sk#27426L], Inner, BuildRight, false
                     :     :     :- SortMergeJoin [ws_order_number#27380L], [wr_order_number#27477L], LeftSemi
                     :     :     :  :- SortMergeJoin [ws_order_number#27380L], [ws_order_number#27312L], LeftSemi
                     :     :     :  :  :- Sort [ws_order_number#27380L ASC NULLS FIRST], false, 0
                     :     :     :  :  :  +- Exchange hashpartitioning(ws_order_number#27380L, 3000), ENSURE_REQUIREMENTS, [id=#28592]
                     :     :     :  :  :     +- Project [ws_ship_date_sk#27365L, ws_ship_addr_sk#27374L, ws_web_site_sk#27376L, ws_order_number#27380L, ws_ext_ship_cost#27391, ws_net_profit#27396]
                     :     :     :  :  :        +- Filter ((isnotnull(ws_ship_date_sk#27365L) AND isnotnull(ws_ship_addr_sk#27374L)) AND isnotnull(ws_web_site_sk#27376L))
                     :     :     :  :  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_ship_date_sk#27365L,ws_ship_addr_sk#27374L,ws_web_site_sk#27376L,ws_order_number#27380L,ws_ext_ship_cost#27391,ws_net_profit#27396,ws_sold_date_sk#27397L] Batched: true, DataFilters: [isnotnull(ws_ship_date_sk#27365L), isnotnull(ws_ship_addr_sk#27374L), isnotnull(ws_web_site_sk#2..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_date_sk), IsNotNull(ws_ship_addr_sk), IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_ship_date_sk:bigint,ws_ship_addr_sk:bigint,ws_web_site_sk:bigint,ws_order_number:bigint...
                     :     :     :  :  +- Project [ws_order_number#27312L]
                     :     :     :  :     +- SortMergeJoin [ws_order_number#27312L], [ws_order_number#27346L], Inner, NOT (ws_warehouse_sk#27310L = ws_warehouse_sk#27344L)
                     :     :     :  :        :- Sort [ws_order_number#27312L ASC NULLS FIRST], false, 0
                     :     :     :  :        :  +- Exchange hashpartitioning(ws_order_number#27312L, 3000), ENSURE_REQUIREMENTS, [id=#28584]
                     :     :     :  :        :     +- Project [ws_warehouse_sk#27310L, ws_order_number#27312L]
                     :     :     :  :        :        +- Filter (isnotnull(ws_order_number#27312L) AND isnotnull(ws_warehouse_sk#27310L))
                     :     :     :  :        :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_warehouse_sk#27310L,ws_order_number#27312L,ws_sold_date_sk#27329L] Batched: true, DataFilters: [isnotnull(ws_order_number#27312L), isnotnull(ws_warehouse_sk#27310L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_order_number), IsNotNull(ws_warehouse_sk)], ReadSchema: struct<ws_warehouse_sk:bigint,ws_order_number:bigint>
                     :     :     :  :        +- Sort [ws_order_number#27346L ASC NULLS FIRST], false, 0
                     :     :     :  :           +- Exchange hashpartitioning(ws_order_number#27346L, 3000), ENSURE_REQUIREMENTS, [id=#28585]
                     :     :     :  :              +- Project [ws_warehouse_sk#27344L, ws_order_number#27346L]
                     :     :     :  :                 +- Filter (isnotnull(ws_order_number#27346L) AND isnotnull(ws_warehouse_sk#27344L))
                     :     :     :  :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_warehouse_sk#27344L,ws_order_number#27346L,ws_sold_date_sk#27363L] Batched: true, DataFilters: [isnotnull(ws_order_number#27346L), isnotnull(ws_warehouse_sk#27344L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_order_number), IsNotNull(ws_warehouse_sk)], ReadSchema: struct<ws_warehouse_sk:bigint,ws_order_number:bigint>
                     :     :     :  +- Project [wr_order_number#27477L]
                     :     :     :     +- SortMergeJoin [ws_order_number#27312L], [ws_order_number#27346L], Inner, NOT (ws_warehouse_sk#27310L = ws_warehouse_sk#27344L)
                     :     :     :        :- SortMergeJoin [wr_order_number#27477L], [ws_order_number#27312L], Inner
                     :     :     :        :  :- Sort [wr_order_number#27477L ASC NULLS FIRST], false, 0
                     :     :     :        :  :  +- Exchange hashpartitioning(wr_order_number#27477L, 3000), ENSURE_REQUIREMENTS, [id=#28596]
                     :     :     :        :  :     +- Project [wr_order_number#27477L]
                     :     :     :        :  :        +- Filter isnotnull(wr_order_number#27477L)
                     :     :     :        :  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_returns[wr_order_number#27477L,wr_returned_date_sk#27488L] Batched: true, DataFilters: [isnotnull(wr_order_number#27477L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(wr_order_number)], ReadSchema: struct<wr_order_number:bigint>
                     :     :     :        :  +- Sort [ws_order_number#27312L ASC NULLS FIRST], false, 0
                     :     :     :        :     +- Exchange hashpartitioning(ws_order_number#27312L, 3000), ENSURE_REQUIREMENTS, [id=#28597]
                     :     :     :        :        +- Project [ws_warehouse_sk#27310L, ws_order_number#27312L]
                     :     :     :        :           +- Filter (isnotnull(ws_order_number#27312L) AND isnotnull(ws_warehouse_sk#27310L))
                     :     :     :        :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_warehouse_sk#27310L,ws_order_number#27312L,ws_sold_date_sk#27329L] Batched: true, DataFilters: [isnotnull(ws_order_number#27312L), isnotnull(ws_warehouse_sk#27310L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_order_number), IsNotNull(ws_warehouse_sk)], ReadSchema: struct<ws_warehouse_sk:bigint,ws_order_number:bigint>
                     :     :     :        +- Sort [ws_order_number#27346L ASC NULLS FIRST], false, 0
                     :     :     :           +- Exchange hashpartitioning(ws_order_number#27346L, 3000), ENSURE_REQUIREMENTS, [id=#28603]
                     :     :     :              +- Project [ws_warehouse_sk#27344L, ws_order_number#27346L]
                     :     :     :                 +- Filter (isnotnull(ws_order_number#27346L) AND isnotnull(ws_warehouse_sk#27344L))
                     :     :     :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_sales[ws_warehouse_sk#27344L,ws_order_number#27346L,ws_sold_date_sk#27363L] Batched: true, DataFilters: [isnotnull(ws_order_number#27346L), isnotnull(ws_warehouse_sk#27344L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_order_number), IsNotNull(ws_warehouse_sk)], ReadSchema: struct<ws_warehouse_sk:bigint,ws_order_number:bigint>
                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28610]
                     :     :        +- Project [ca_address_sk#27426L]
                     :     :           +- Filter ((isnotnull(ca_state#27434) AND (ca_state#27434 = TX)) AND isnotnull(ca_address_sk#27426L))
                     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.customer_address[ca_address_sk#27426L,ca_state#27434] Batched: true, DataFilters: [isnotnull(ca_state#27434), (ca_state#27434 = TX), isnotnull(ca_address_sk#27426L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,TX), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:bigint,ca_state:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28614]
                     :        +- Project [web_site_sk#27439L]
                     :           +- Filter ((isnotnull(web_company_name#27453) AND (web_company_name#27453 = pri)) AND isnotnull(web_site_sk#27439L))
                     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.web_site[web_site_sk#27439L,web_company_name#27453] Batched: true, DataFilters: [isnotnull(web_company_name#27453), (web_company_name#27453 = pri), isnotnull(web_site_sk#27439L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(web_company_name), EqualTo(web_company_name,pri), IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:bigint,web_company_name:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28618]
                        +- Project [d_date_sk#27398L]
                           +- Filter (((isnotnull(d_date#27400) AND (d_date#27400 >= 1999-05-01)) AND (d_date#27400 <= 1999-06-30)) AND isnotnull(d_date_sk#27398L))
                              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27398L,d_date#27400] Batched: true, DataFilters: [isnotnull(d_date#27400), (d_date#27400 >= 1999-05-01), (d_date#27400 <= 1999-06-30), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-05-01), LessThanOrEqual(d_date,1999-06-30), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>

read query: spark_queries/q96.sql
explain query: q96
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['count(1) ASC NULLS FIRST], true
      +- 'Project [unresolvedalias('count(1), None)]
         +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) AND ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) AND (('ss_store_sk = 's_store_sk) AND ('time_dim.t_hour = 8))) AND ((('time_dim.t_minute >= 30) AND ('household_demographics.hd_dep_count = 5)) AND ('store.s_store_name = ese)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'UnresolvedRelation [store_sales], [], false
               :  :  +- 'UnresolvedRelation [household_demographics], [], false
               :  +- 'UnresolvedRelation [time_dim], [], false
               +- 'UnresolvedRelation [store], [], false

== Analyzed Logical Plan ==
count(1): bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [count(1)#27573L ASC NULLS FIRST], true
      +- Aggregate [count(1) AS count(1)#27573L]
         +- Filter ((((ss_sold_time_sk#27506L = t_time_sk#27534L) AND (ss_hdemo_sk#27510L = hd_demo_sk#27529L)) AND ((ss_store_sk#27512L = s_store_sk#27544L) AND (t_hour#27537 = 8))) AND (((t_minute#27538 >= 30) AND (hd_dep_count#27532 = 5)) AND (s_store_name#27549 = ese)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
               :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27506L,ss_item_sk#27507L,ss_customer_sk#27508L,ss_cdemo_sk#27509L,ss_hdemo_sk#27510L,ss_addr_sk#27511L,ss_store_sk#27512L,ss_promo_sk#27513L,ss_ticket_number#27514L,ss_quantity#27515,ss_wholesale_cost#27516,ss_list_price#27517,ss_sales_price#27518,ss_ext_discount_amt#27519,ss_ext_sales_price#27520,ss_ext_wholesale_cost#27521,ss_ext_list_price#27522,ss_ext_tax#27523,ss_coupon_amt#27524,ss_net_paid#27525,ss_net_paid_inc_tax#27526,ss_net_profit#27527,ss_sold_date_sk#27528L] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.household_demographics
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#27529L,hd_income_band_sk#27530L,hd_buy_potential#27531,hd_dep_count#27532,hd_vehicle_count#27533] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.time_dim
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#27534L,t_time_id#27535,t_time#27536,t_hour#27537,t_minute#27538,t_second#27539,t_am_pm#27540,t_shift#27541,t_sub_shift#27542,t_meal_time#27543] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#27544L,s_store_id#27545,s_rec_start_date#27546,s_rec_end_date#27547,s_closed_date_sk#27548L,s_store_name#27549,s_number_employees#27550,s_floor_space#27551,s_hours#27552,s_manager#27553,s_market_id#27554,s_geography_class#27555,s_market_desc#27556,s_market_manager#27557,s_division_id#27558,s_division_name#27559,s_company_id#27560,s_company_name#27561,s_street_number#27562,s_street_name#27563,s_street_type#27564,s_suite_number#27565,s_city#27566,s_county#27567,... 5 more fields] orc

== Optimized Logical Plan ==
Aggregate [count(1) AS count(1)#27573L]
+- Project
   +- Join Inner, (ss_hdemo_sk#27510L = hd_demo_sk#27529L)
      :- Project [ss_hdemo_sk#27510L]
      :  +- Join Inner, (ss_store_sk#27512L = s_store_sk#27544L)
      :     :- Project [ss_hdemo_sk#27510L, ss_store_sk#27512L]
      :     :  +- Join Inner, (ss_sold_time_sk#27506L = t_time_sk#27534L)
      :     :     :- Project [ss_sold_time_sk#27506L, ss_hdemo_sk#27510L, ss_store_sk#27512L]
      :     :     :  +- Filter (isnotnull(ss_hdemo_sk#27510L) AND (isnotnull(ss_sold_time_sk#27506L) AND isnotnull(ss_store_sk#27512L)))
      :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27506L,ss_item_sk#27507L,ss_customer_sk#27508L,ss_cdemo_sk#27509L,ss_hdemo_sk#27510L,ss_addr_sk#27511L,ss_store_sk#27512L,ss_promo_sk#27513L,ss_ticket_number#27514L,ss_quantity#27515,ss_wholesale_cost#27516,ss_list_price#27517,ss_sales_price#27518,ss_ext_discount_amt#27519,ss_ext_sales_price#27520,ss_ext_wholesale_cost#27521,ss_ext_list_price#27522,ss_ext_tax#27523,ss_coupon_amt#27524,ss_net_paid#27525,ss_net_paid_inc_tax#27526,ss_net_profit#27527,ss_sold_date_sk#27528L] orc
      :     :     +- Project [t_time_sk#27534L]
      :     :        +- Filter (((isnotnull(t_hour#27537) AND isnotnull(t_minute#27538)) AND ((t_hour#27537 = 8) AND (t_minute#27538 >= 30))) AND isnotnull(t_time_sk#27534L))
      :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#27534L,t_time_id#27535,t_time#27536,t_hour#27537,t_minute#27538,t_second#27539,t_am_pm#27540,t_shift#27541,t_sub_shift#27542,t_meal_time#27543] orc
      :     +- Project [s_store_sk#27544L]
      :        +- Filter ((isnotnull(s_store_name#27549) AND (s_store_name#27549 = ese)) AND isnotnull(s_store_sk#27544L))
      :           +- Relation spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#27544L,s_store_id#27545,s_rec_start_date#27546,s_rec_end_date#27547,s_closed_date_sk#27548L,s_store_name#27549,s_number_employees#27550,s_floor_space#27551,s_hours#27552,s_manager#27553,s_market_id#27554,s_geography_class#27555,s_market_desc#27556,s_market_manager#27557,s_division_id#27558,s_division_name#27559,s_company_id#27560,s_company_name#27561,s_street_number#27562,s_street_name#27563,s_street_type#27564,s_suite_number#27565,s_city#27566,s_county#27567,... 5 more fields] orc
      +- Project [hd_demo_sk#27529L]
         +- Filter ((isnotnull(hd_dep_count#27532) AND (hd_dep_count#27532 = 5)) AND isnotnull(hd_demo_sk#27529L))
            +- Relation spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#27529L,hd_income_band_sk#27530L,hd_buy_potential#27531,hd_dep_count#27532,hd_vehicle_count#27533] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[count(1)], output=[count(1)#27573L])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#28703]
      +- HashAggregate(keys=[], functions=[partial_count(1)], output=[count#27576L])
         +- Project
            +- BroadcastHashJoin [ss_hdemo_sk#27510L], [hd_demo_sk#27529L], Inner, BuildRight, false
               :- Project [ss_hdemo_sk#27510L]
               :  +- BroadcastHashJoin [ss_store_sk#27512L], [s_store_sk#27544L], Inner, BuildRight, false
               :     :- Project [ss_hdemo_sk#27510L, ss_store_sk#27512L]
               :     :  +- BroadcastHashJoin [ss_sold_time_sk#27506L], [t_time_sk#27534L], Inner, BuildRight, false
               :     :     :- Project [ss_sold_time_sk#27506L, ss_hdemo_sk#27510L, ss_store_sk#27512L]
               :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#27510L) AND isnotnull(ss_sold_time_sk#27506L)) AND isnotnull(ss_store_sk#27512L))
               :     :     :     +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27506L,ss_hdemo_sk#27510L,ss_store_sk#27512L,ss_sold_date_sk#27528L] Batched: true, DataFilters: [isnotnull(ss_hdemo_sk#27510L), isnotnull(ss_sold_time_sk#27506L), isnotnull(ss_store_sk#27512L)], Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:bigint,ss_hdemo_sk:bigint,ss_store_sk:bigint>
               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28690]
               :     :        +- Project [t_time_sk#27534L]
               :     :           +- Filter ((((isnotnull(t_hour#27537) AND isnotnull(t_minute#27538)) AND (t_hour#27537 = 8)) AND (t_minute#27538 >= 30)) AND isnotnull(t_time_sk#27534L))
               :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.time_dim[t_time_sk#27534L,t_hour#27537,t_minute#27538] Batched: true, DataFilters: [isnotnull(t_hour#27537), isnotnull(t_minute#27538), (t_hour#27537 = 8), (t_minute#27538 >= 30), ..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,8), GreaterThanOrEqual(t_minute,30), IsNo..., ReadSchema: struct<t_time_sk:bigint,t_hour:int,t_minute:int>
               :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28694]
               :        +- Project [s_store_sk#27544L]
               :           +- Filter ((isnotnull(s_store_name#27549) AND (s_store_name#27549 = ese)) AND isnotnull(s_store_sk#27544L))
               :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store[s_store_sk#27544L,s_store_name#27549] Batched: true, DataFilters: [isnotnull(s_store_name#27549), (s_store_name#27549 = ese), isnotnull(s_store_sk#27544L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:bigint,s_store_name:string>
               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28698]
                  +- Project [hd_demo_sk#27529L]
                     +- Filter ((isnotnull(hd_dep_count#27532) AND (hd_dep_count#27532 = 5)) AND isnotnull(hd_demo_sk#27529L))
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.household_demographics[hd_demo_sk#27529L,hd_dep_count#27532] Batched: true, DataFilters: [isnotnull(hd_dep_count#27532), (hd_dep_count#27532 = 5), isnotnull(hd_demo_sk#27529L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(hd_dep_count), EqualTo(hd_dep_count,5), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:bigint,hd_dep_count:int>

read query: spark_queries/q97.sql
explain query: q97
== Parsed Logical Plan ==
CTE [ssci, csci]
:  :- 'SubqueryAlias ssci
:  :  +- 'Aggregate ['ss_customer_sk, 'ss_item_sk], ['ss_customer_sk AS customer_sk#27580, 'ss_item_sk AS item_sk#27581]
:  :     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
:  :        +- 'Join Inner
:  :           :- 'UnresolvedRelation [store_sales], [], false
:  :           +- 'UnresolvedRelation [date_dim], [], false
:  +- 'SubqueryAlias csci
:     +- 'Aggregate ['cs_bill_customer_sk, 'cs_item_sk], ['cs_bill_customer_sk AS customer_sk#27582, 'cs_item_sk AS item_sk#27583]
:        +- 'Filter (('cs_sold_date_sk = 'd_date_sk) AND (('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))))
:           +- 'Join Inner
:              :- 'UnresolvedRelation [catalog_sales], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Project ['sum(CASE WHEN (isnotnull('ssci.customer_sk) AND isnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS store_only#27577, 'sum(CASE WHEN (isnull('ssci.customer_sk) AND isnotnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS catalog_only#27578, 'sum(CASE WHEN (isnotnull('ssci.customer_sk) AND isnotnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS store_and_catalog#27579]
         +- 'Join FullOuter, (('ssci.customer_sk = 'csci.customer_sk) AND ('ssci.item_sk = 'csci.item_sk))
            :- 'UnresolvedRelation [ssci], [], false
            +- 'UnresolvedRelation [csci], [], false

== Analyzed Logical Plan ==
store_only: bigint, catalog_only: bigint, store_and_catalog: bigint
WithCTE
:- CTERelationDef 67
:  +- SubqueryAlias ssci
:     +- Aggregate [ss_customer_sk#27586L, ss_item_sk#27585L], [ss_customer_sk#27586L AS customer_sk#27580L, ss_item_sk#27585L AS item_sk#27581L]
:        +- Filter ((ss_sold_date_sk#27606L = d_date_sk#27607L) AND ((d_month_seq#27610 >= 1212) AND (d_month_seq#27610 <= (1212 + 11))))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27584L,ss_item_sk#27585L,ss_customer_sk#27586L,ss_cdemo_sk#27587L,ss_hdemo_sk#27588L,ss_addr_sk#27589L,ss_store_sk#27590L,ss_promo_sk#27591L,ss_ticket_number#27592L,ss_quantity#27593,ss_wholesale_cost#27594,ss_list_price#27595,ss_sales_price#27596,ss_ext_discount_amt#27597,ss_ext_sales_price#27598,ss_ext_wholesale_cost#27599,ss_ext_list_price#27600,ss_ext_tax#27601,ss_coupon_amt#27602,ss_net_paid#27603,ss_net_paid_inc_tax#27604,ss_net_profit#27605,ss_sold_date_sk#27606L] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27607L,d_date_id#27608,d_date#27609,d_month_seq#27610,d_week_seq#27611,d_quarter_seq#27612,d_year#27613,d_dow#27614,d_moy#27615,d_dom#27616,d_qoy#27617,d_fy_year#27618,d_fy_quarter_seq#27619,d_fy_week_seq#27620,d_day_name#27621,d_quarter_name#27622,d_holiday#27623,d_weekend#27624,d_following_holiday#27625,d_first_dom#27626,d_last_dom#27627,d_same_day_ly#27628,d_same_day_lq#27629,d_current_day#27630,... 4 more fields] orc
:- CTERelationDef 68
:  +- SubqueryAlias csci
:     +- Aggregate [cs_bill_customer_sk#27637L, cs_item_sk#27649L], [cs_bill_customer_sk#27637L AS customer_sk#27582L, cs_item_sk#27649L AS item_sk#27583L]
:        +- Filter ((cs_sold_date_sk#27668L = d_date_sk#27669L) AND ((d_month_seq#27672 >= 1212) AND (d_month_seq#27672 <= (1212 + 11))))
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
:              :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#27635L,cs_ship_date_sk#27636L,cs_bill_customer_sk#27637L,cs_bill_cdemo_sk#27638L,cs_bill_hdemo_sk#27639L,cs_bill_addr_sk#27640L,cs_ship_customer_sk#27641L,cs_ship_cdemo_sk#27642L,cs_ship_hdemo_sk#27643L,cs_ship_addr_sk#27644L,cs_call_center_sk#27645L,cs_catalog_page_sk#27646L,cs_ship_mode_sk#27647L,cs_warehouse_sk#27648L,cs_item_sk#27649L,cs_promo_sk#27650L,cs_order_number#27651L,cs_quantity#27652,cs_wholesale_cost#27653,cs_list_price#27654,cs_sales_price#27655,cs_ext_discount_amt#27656,cs_ext_sales_price#27657,cs_ext_wholesale_cost#27658,... 10 more fields] orc
:              +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
:                 +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27669L,d_date_id#27670,d_date#27671,d_month_seq#27672,d_week_seq#27673,d_quarter_seq#27674,d_year#27675,d_dow#27676,d_moy#27677,d_dom#27678,d_qoy#27679,d_fy_year#27680,d_fy_quarter_seq#27681,d_fy_week_seq#27682,d_day_name#27683,d_quarter_name#27684,d_holiday#27685,d_weekend#27686,d_following_holiday#27687,d_first_dom#27688,d_last_dom#27689,d_same_day_ly#27690,d_same_day_lq#27691,d_current_day#27692,... 4 more fields] orc
+- GlobalLimit 100
   +- LocalLimit 100
      +- Aggregate [sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS store_only#27577L, sum(CASE WHEN (isnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS catalog_only#27578L, sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS store_and_catalog#27579L]
         +- Join FullOuter, ((customer_sk#27580L = customer_sk#27582L) AND (item_sk#27581L = item_sk#27583L))
            :- SubqueryAlias ssci
            :  +- CTERelationRef 67, true, [customer_sk#27580L, item_sk#27581L]
            +- SubqueryAlias csci
               +- CTERelationRef 68, true, [customer_sk#27582L, item_sk#27583L]

== Optimized Logical Plan ==
Aggregate [sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS store_only#27577L, sum(CASE WHEN (isnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS catalog_only#27578L, sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END) AS store_and_catalog#27579L]
+- Project [customer_sk#27580L, customer_sk#27582L]
   +- Join FullOuter, ((customer_sk#27580L = customer_sk#27582L) AND (item_sk#27581L = item_sk#27583L))
      :- Aggregate [ss_customer_sk#27586L, ss_item_sk#27585L], [ss_customer_sk#27586L AS customer_sk#27580L, ss_item_sk#27585L AS item_sk#27581L]
      :  +- Project [ss_item_sk#27585L, ss_customer_sk#27586L]
      :     +- Join Inner, (ss_sold_date_sk#27606L = d_date_sk#27607L)
      :        :- Project [ss_item_sk#27585L, ss_customer_sk#27586L, ss_sold_date_sk#27606L]
      :        :  +- Filter (isnotnull(ss_sold_date_sk#27606L) AND dynamicpruning#27703 [ss_sold_date_sk#27606L])
      :        :     :  +- Project [d_date_sk#27607L]
      :        :     :     +- Filter ((isnotnull(d_month_seq#27610) AND ((d_month_seq#27610 >= 1212) AND (d_month_seq#27610 <= 1223))) AND isnotnull(d_date_sk#27607L))
      :        :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27607L,d_date_id#27608,d_date#27609,d_month_seq#27610,d_week_seq#27611,d_quarter_seq#27612,d_year#27613,d_dow#27614,d_moy#27615,d_dom#27616,d_qoy#27617,d_fy_year#27618,d_fy_quarter_seq#27619,d_fy_week_seq#27620,d_day_name#27621,d_quarter_name#27622,d_holiday#27623,d_weekend#27624,d_following_holiday#27625,d_first_dom#27626,d_last_dom#27627,d_same_day_ly#27628,d_same_day_lq#27629,d_current_day#27630,... 4 more fields] orc
      :        :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27584L,ss_item_sk#27585L,ss_customer_sk#27586L,ss_cdemo_sk#27587L,ss_hdemo_sk#27588L,ss_addr_sk#27589L,ss_store_sk#27590L,ss_promo_sk#27591L,ss_ticket_number#27592L,ss_quantity#27593,ss_wholesale_cost#27594,ss_list_price#27595,ss_sales_price#27596,ss_ext_discount_amt#27597,ss_ext_sales_price#27598,ss_ext_wholesale_cost#27599,ss_ext_list_price#27600,ss_ext_tax#27601,ss_coupon_amt#27602,ss_net_paid#27603,ss_net_paid_inc_tax#27604,ss_net_profit#27605,ss_sold_date_sk#27606L] orc
      :        +- Project [d_date_sk#27607L]
      :           +- Filter ((isnotnull(d_month_seq#27610) AND ((d_month_seq#27610 >= 1212) AND (d_month_seq#27610 <= 1223))) AND isnotnull(d_date_sk#27607L))
      :              +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27607L,d_date_id#27608,d_date#27609,d_month_seq#27610,d_week_seq#27611,d_quarter_seq#27612,d_year#27613,d_dow#27614,d_moy#27615,d_dom#27616,d_qoy#27617,d_fy_year#27618,d_fy_quarter_seq#27619,d_fy_week_seq#27620,d_day_name#27621,d_quarter_name#27622,d_holiday#27623,d_weekend#27624,d_following_holiday#27625,d_first_dom#27626,d_last_dom#27627,d_same_day_ly#27628,d_same_day_lq#27629,d_current_day#27630,... 4 more fields] orc
      +- Aggregate [cs_bill_customer_sk#27637L, cs_item_sk#27649L], [cs_bill_customer_sk#27637L AS customer_sk#27582L, cs_item_sk#27649L AS item_sk#27583L]
         +- Project [cs_bill_customer_sk#27637L, cs_item_sk#27649L]
            +- Join Inner, (cs_sold_date_sk#27668L = d_date_sk#27669L)
               :- Project [cs_bill_customer_sk#27637L, cs_item_sk#27649L, cs_sold_date_sk#27668L]
               :  +- Filter (isnotnull(cs_sold_date_sk#27668L) AND dynamicpruning#27704 [cs_sold_date_sk#27668L])
               :     :  +- Project [d_date_sk#27669L]
               :     :     +- Filter ((isnotnull(d_month_seq#27672) AND ((d_month_seq#27672 >= 1212) AND (d_month_seq#27672 <= 1223))) AND isnotnull(d_date_sk#27669L))
               :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27669L,d_date_id#27670,d_date#27671,d_month_seq#27672,d_week_seq#27673,d_quarter_seq#27674,d_year#27675,d_dow#27676,d_moy#27677,d_dom#27678,d_qoy#27679,d_fy_year#27680,d_fy_quarter_seq#27681,d_fy_week_seq#27682,d_day_name#27683,d_quarter_name#27684,d_holiday#27685,d_weekend#27686,d_following_holiday#27687,d_first_dom#27688,d_last_dom#27689,d_same_day_ly#27690,d_same_day_lq#27691,d_current_day#27692,... 4 more fields] orc
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#27635L,cs_ship_date_sk#27636L,cs_bill_customer_sk#27637L,cs_bill_cdemo_sk#27638L,cs_bill_hdemo_sk#27639L,cs_bill_addr_sk#27640L,cs_ship_customer_sk#27641L,cs_ship_cdemo_sk#27642L,cs_ship_hdemo_sk#27643L,cs_ship_addr_sk#27644L,cs_call_center_sk#27645L,cs_catalog_page_sk#27646L,cs_ship_mode_sk#27647L,cs_warehouse_sk#27648L,cs_item_sk#27649L,cs_promo_sk#27650L,cs_order_number#27651L,cs_quantity#27652,cs_wholesale_cost#27653,cs_list_price#27654,cs_sales_price#27655,cs_ext_discount_amt#27656,cs_ext_sales_price#27657,cs_ext_wholesale_cost#27658,... 10 more fields] orc
               +- Project [d_date_sk#27669L]
                  +- Filter ((isnotnull(d_month_seq#27672) AND ((d_month_seq#27672 >= 1212) AND (d_month_seq#27672 <= 1223))) AND isnotnull(d_date_sk#27669L))
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27669L,d_date_id#27670,d_date#27671,d_month_seq#27672,d_week_seq#27673,d_quarter_seq#27674,d_year#27675,d_dow#27676,d_moy#27677,d_dom#27678,d_qoy#27679,d_fy_year#27680,d_fy_quarter_seq#27681,d_fy_week_seq#27682,d_day_name#27683,d_quarter_name#27684,d_holiday#27685,d_weekend#27686,d_following_holiday#27687,d_first_dom#27688,d_last_dom#27689,d_same_day_ly#27690,d_same_day_lq#27691,d_current_day#27692,... 4 more fields] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- HashAggregate(keys=[], functions=[sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnull(customer_sk#27582L)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END)], output=[store_only#27577L, catalog_only#27578L, store_and_catalog#27579L])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#28822]
      +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnull(customer_sk#27582L)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (isnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (isnotnull(customer_sk#27580L) AND isnotnull(customer_sk#27582L)) THEN 1 ELSE 0 END)], output=[sum#27708L, sum#27709L, sum#27710L])
         +- Project [customer_sk#27580L, customer_sk#27582L]
            +- SortMergeJoin [customer_sk#27580L, item_sk#27581L], [customer_sk#27582L, item_sk#27583L], FullOuter
               :- Sort [customer_sk#27580L ASC NULLS FIRST, item_sk#27581L ASC NULLS FIRST], false, 0
               :  +- HashAggregate(keys=[ss_customer_sk#27586L, ss_item_sk#27585L], functions=[], output=[customer_sk#27580L, item_sk#27581L])
               :     +- Exchange hashpartitioning(ss_customer_sk#27586L, ss_item_sk#27585L, 3000), ENSURE_REQUIREMENTS, [id=#28805]
               :        +- HashAggregate(keys=[ss_customer_sk#27586L, ss_item_sk#27585L], functions=[], output=[ss_customer_sk#27586L, ss_item_sk#27585L])
               :           +- Project [ss_item_sk#27585L, ss_customer_sk#27586L]
               :              +- BroadcastHashJoin [ss_sold_date_sk#27606L], [d_date_sk#27607L], Inner, BuildRight, false
               :                 :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#27585L,ss_customer_sk#27586L,ss_sold_date_sk#27606L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#27606L), dynamicpruningexpression(ss_sold_date_sk#27606L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<ss_item_sk:bigint,ss_customer_sk:bigint>
               :                 :     +- SubqueryAdaptiveBroadcast dynamicpruning#27703, 0, true, Project [d_date_sk#27607L], [d_date_sk#27607L]
               :                 :        +- AdaptiveSparkPlan isFinalPlan=false
               :                 :           +- Project [d_date_sk#27607L]
               :                 :              +- Filter (((isnotnull(d_month_seq#27610) AND (d_month_seq#27610 >= 1212)) AND (d_month_seq#27610 <= 1223)) AND isnotnull(d_date_sk#27607L))
               :                 :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27607L,d_month_seq#27610] Batched: true, DataFilters: [isnotnull(d_month_seq#27610), (d_month_seq#27610 >= 1212), (d_month_seq#27610 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
               :                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28800]
               :                    +- Project [d_date_sk#27607L]
               :                       +- Filter (((isnotnull(d_month_seq#27610) AND (d_month_seq#27610 >= 1212)) AND (d_month_seq#27610 <= 1223)) AND isnotnull(d_date_sk#27607L))
               :                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27607L,d_month_seq#27610] Batched: true, DataFilters: [isnotnull(d_month_seq#27610), (d_month_seq#27610 >= 1212), (d_month_seq#27610 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
               +- Sort [customer_sk#27582L ASC NULLS FIRST, item_sk#27583L ASC NULLS FIRST], false, 0
                  +- HashAggregate(keys=[cs_bill_customer_sk#27637L, cs_item_sk#27649L], functions=[], output=[customer_sk#27582L, item_sk#27583L])
                     +- Exchange hashpartitioning(cs_bill_customer_sk#27637L, cs_item_sk#27649L, 3000), ENSURE_REQUIREMENTS, [id=#28812]
                        +- HashAggregate(keys=[cs_bill_customer_sk#27637L, cs_item_sk#27649L], functions=[], output=[cs_bill_customer_sk#27637L, cs_item_sk#27649L])
                           +- Project [cs_bill_customer_sk#27637L, cs_item_sk#27649L]
                              +- BroadcastHashJoin [cs_sold_date_sk#27668L], [d_date_sk#27669L], Inner, BuildRight, false
                                 :- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_bill_customer_sk#27637L,cs_item_sk#27649L,cs_sold_date_sk#27668L] Batched: true, DataFilters: [], Format: ORC, Location: InMemoryFileIndex(1836 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(cs_sold_date_sk#27668L), dynamicpruningexpression(cs_sold_date_sk#27668L IN dynamicpru..., PushedFilters: [], ReadSchema: struct<cs_bill_customer_sk:bigint,cs_item_sk:bigint>
                                 :     +- SubqueryAdaptiveBroadcast dynamicpruning#27704, 0, true, Project [d_date_sk#27669L], [d_date_sk#27669L]
                                 :        +- AdaptiveSparkPlan isFinalPlan=false
                                 :           +- Project [d_date_sk#27669L]
                                 :              +- Filter (((isnotnull(d_month_seq#27672) AND (d_month_seq#27672 >= 1212)) AND (d_month_seq#27672 <= 1223)) AND isnotnull(d_date_sk#27669L))
                                 :                 +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27669L,d_month_seq#27672] Batched: true, DataFilters: [isnotnull(d_month_seq#27672), (d_month_seq#27672 >= 1212), (d_month_seq#27672 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28807]
                                    +- Project [d_date_sk#27669L]
                                       +- Filter (((isnotnull(d_month_seq#27672) AND (d_month_seq#27672 >= 1212)) AND (d_month_seq#27672 <= 1223)) AND isnotnull(d_date_sk#27669L))
                                          +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27669L,d_month_seq#27672] Batched: true, DataFilters: [isnotnull(d_month_seq#27672), (d_month_seq#27672 >= 1212), (d_month_seq#27672 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>

read query: spark_queries/q98.sql
explain query: q98
== Parsed Logical Plan ==
'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true
+- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('ss_ext_sales_price) AS itemrevenue#27711, (('sum('ss_ext_sales_price) * 100) / 'sum('sum('ss_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#27712]
   +- 'Filter ((('ss_item_sk = 'i_item_sk) AND 'i_category IN (Jewelry,Sports,Books)) AND (('ss_sold_date_sk = 'd_date_sk) AND (('d_date >= cast(2001-01-12 as date)) AND ('d_date <= (cast(2001-01-12 as date) + INTERVAL '30' DAY)))))
      +- 'Join Inner
         :- 'Join Inner
         :  :- 'UnresolvedRelation [store_sales], [], false
         :  +- 'UnresolvedRelation [item], [], false
         +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
i_item_desc: string, i_category: string, i_class: string, i_current_price: double, itemrevenue: double, revenueratio: double
Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, revenueratio#27712]
+- Sort [i_category#27748 ASC NULLS FIRST, i_class#27746 ASC NULLS FIRST, i_item_id#27737 ASC NULLS FIRST, i_item_desc#27740 ASC NULLS FIRST, revenueratio#27712 ASC NULLS FIRST], true
   +- Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, revenueratio#27712, i_item_id#27737]
      +- Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, _w0#27790, _w1#27791, _we0#27792, ((_w0#27790 * cast(100 as double)) / _we0#27792) AS revenueratio#27712, i_item_id#27737]
         +- Window [sum(_w1#27791) windowspecdefinition(i_class#27746, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#27792], [i_class#27746]
            +- Aggregate [i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741], [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, sum(ss_ext_sales_price#27727) AS itemrevenue#27711, sum(ss_ext_sales_price#27727) AS _w0#27790, sum(ss_ext_sales_price#27727) AS _w1#27791, i_item_id#27737]
               +- Filter (((ss_item_sk#27714L = i_item_sk#27736L) AND i_category#27748 IN (Jewelry,Sports,Books)) AND ((ss_sold_date_sk#27735L = d_date_sk#27758L) AND ((d_date#27760 >= cast(2001-01-12 as date)) AND (d_date#27760 <= date_add(cast(2001-01-12 as date), extractansiintervaldays(INTERVAL '30' DAY))))))
                  +- Join Inner
                     :- Join Inner
                     :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.store_sales
                     :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27713L,ss_item_sk#27714L,ss_customer_sk#27715L,ss_cdemo_sk#27716L,ss_hdemo_sk#27717L,ss_addr_sk#27718L,ss_store_sk#27719L,ss_promo_sk#27720L,ss_ticket_number#27721L,ss_quantity#27722,ss_wholesale_cost#27723,ss_list_price#27724,ss_sales_price#27725,ss_ext_discount_amt#27726,ss_ext_sales_price#27727,ss_ext_wholesale_cost#27728,ss_ext_list_price#27729,ss_ext_tax#27730,ss_coupon_amt#27731,ss_net_paid#27732,ss_net_paid_inc_tax#27733,ss_net_profit#27734,ss_sold_date_sk#27735L] orc
                     :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.item
                     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#27736L,i_item_id#27737,i_rec_start_date#27738,i_rec_end_date#27739,i_item_desc#27740,i_current_price#27741,i_wholesale_cost#27742,i_brand_id#27743,i_brand#27744,i_class_id#27745,i_class#27746,i_category_id#27747,i_category#27748,i_manufact_id#27749,i_manufact#27750,i_size#27751,i_formulation#27752,i_color#27753,i_units#27754,i_container#27755,i_manager_id#27756,i_product_name#27757] orc
                     +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27758L,d_date_id#27759,d_date#27760,d_month_seq#27761,d_week_seq#27762,d_quarter_seq#27763,d_year#27764,d_dow#27765,d_moy#27766,d_dom#27767,d_qoy#27768,d_fy_year#27769,d_fy_quarter_seq#27770,d_fy_week_seq#27771,d_day_name#27772,d_quarter_name#27773,d_holiday#27774,d_weekend#27775,d_following_holiday#27776,d_first_dom#27777,d_last_dom#27778,d_same_day_ly#27779,d_same_day_lq#27780,d_current_day#27781,... 4 more fields] orc

== Optimized Logical Plan ==
Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, revenueratio#27712]
+- Sort [i_category#27748 ASC NULLS FIRST, i_class#27746 ASC NULLS FIRST, i_item_id#27737 ASC NULLS FIRST, i_item_desc#27740 ASC NULLS FIRST, revenueratio#27712 ASC NULLS FIRST], true
   +- Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, ((_w0#27790 * 100.0) / _we0#27792) AS revenueratio#27712, i_item_id#27737]
      +- Window [sum(_w1#27791) windowspecdefinition(i_class#27746, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#27792], [i_class#27746]
         +- Aggregate [i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741], [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, sum(ss_ext_sales_price#27727) AS itemrevenue#27711, sum(ss_ext_sales_price#27727) AS _w0#27790, sum(ss_ext_sales_price#27727) AS _w1#27791, i_item_id#27737]
            +- Project [ss_ext_sales_price#27727, i_item_id#27737, i_item_desc#27740, i_current_price#27741, i_class#27746, i_category#27748]
               +- Join Inner, (ss_item_sk#27714L = i_item_sk#27736L)
                  :- Project [ss_item_sk#27714L, ss_ext_sales_price#27727]
                  :  +- Join Inner, (ss_sold_date_sk#27735L = d_date_sk#27758L)
                  :     :- Project [ss_item_sk#27714L, ss_ext_sales_price#27727, ss_sold_date_sk#27735L]
                  :     :  +- Filter ((isnotnull(ss_item_sk#27714L) AND isnotnull(ss_sold_date_sk#27735L)) AND dynamicpruning#27799 [ss_sold_date_sk#27735L])
                  :     :     :  +- Project [d_date_sk#27758L]
                  :     :     :     +- Filter ((isnotnull(d_date#27760) AND ((d_date#27760 >= 2001-01-12) AND (d_date#27760 <= 2001-02-11))) AND isnotnull(d_date_sk#27758L))
                  :     :     :        +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27758L,d_date_id#27759,d_date#27760,d_month_seq#27761,d_week_seq#27762,d_quarter_seq#27763,d_year#27764,d_dow#27765,d_moy#27766,d_dom#27767,d_qoy#27768,d_fy_year#27769,d_fy_quarter_seq#27770,d_fy_week_seq#27771,d_day_name#27772,d_quarter_name#27773,d_holiday#27774,d_weekend#27775,d_following_holiday#27776,d_first_dom#27777,d_last_dom#27778,d_same_day_ly#27779,d_same_day_lq#27780,d_current_day#27781,... 4 more fields] orc
                  :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_sold_time_sk#27713L,ss_item_sk#27714L,ss_customer_sk#27715L,ss_cdemo_sk#27716L,ss_hdemo_sk#27717L,ss_addr_sk#27718L,ss_store_sk#27719L,ss_promo_sk#27720L,ss_ticket_number#27721L,ss_quantity#27722,ss_wholesale_cost#27723,ss_list_price#27724,ss_sales_price#27725,ss_ext_discount_amt#27726,ss_ext_sales_price#27727,ss_ext_wholesale_cost#27728,ss_ext_list_price#27729,ss_ext_tax#27730,ss_coupon_amt#27731,ss_net_paid#27732,ss_net_paid_inc_tax#27733,ss_net_profit#27734,ss_sold_date_sk#27735L] orc
                  :     +- Project [d_date_sk#27758L]
                  :        +- Filter ((isnotnull(d_date#27760) AND ((d_date#27760 >= 2001-01-12) AND (d_date#27760 <= 2001-02-11))) AND isnotnull(d_date_sk#27758L))
                  :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27758L,d_date_id#27759,d_date#27760,d_month_seq#27761,d_week_seq#27762,d_quarter_seq#27763,d_year#27764,d_dow#27765,d_moy#27766,d_dom#27767,d_qoy#27768,d_fy_year#27769,d_fy_quarter_seq#27770,d_fy_week_seq#27771,d_day_name#27772,d_quarter_name#27773,d_holiday#27774,d_weekend#27775,d_following_holiday#27776,d_first_dom#27777,d_last_dom#27778,d_same_day_ly#27779,d_same_day_lq#27780,d_current_day#27781,... 4 more fields] orc
                  +- Project [i_item_sk#27736L, i_item_id#27737, i_item_desc#27740, i_current_price#27741, i_class#27746, i_category#27748]
                     +- Filter (i_category#27748 IN (Jewelry,Sports,Books) AND isnotnull(i_item_sk#27736L))
                        +- Relation spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#27736L,i_item_id#27737,i_rec_start_date#27738,i_rec_end_date#27739,i_item_desc#27740,i_current_price#27741,i_wholesale_cost#27742,i_brand_id#27743,i_brand#27744,i_class_id#27745,i_class#27746,i_category_id#27747,i_category#27748,i_manufact_id#27749,i_manufact#27750,i_size#27751,i_formulation#27752,i_color#27753,i_units#27754,i_container#27755,i_manager_id#27756,i_product_name#27757] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, revenueratio#27712]
   +- Sort [i_category#27748 ASC NULLS FIRST, i_class#27746 ASC NULLS FIRST, i_item_id#27737 ASC NULLS FIRST, i_item_desc#27740 ASC NULLS FIRST, revenueratio#27712 ASC NULLS FIRST], true, 0
      +- Exchange rangepartitioning(i_category#27748 ASC NULLS FIRST, i_class#27746 ASC NULLS FIRST, i_item_id#27737 ASC NULLS FIRST, i_item_desc#27740 ASC NULLS FIRST, revenueratio#27712 ASC NULLS FIRST, 3000), ENSURE_REQUIREMENTS, [id=#28937]
         +- Project [i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, ((_w0#27790 * 100.0) / _we0#27792) AS revenueratio#27712, i_item_id#27737]
            +- Window [sum(_w1#27791) windowspecdefinition(i_class#27746, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#27792], [i_class#27746]
               +- Sort [i_class#27746 ASC NULLS FIRST], false, 0
                  +- Exchange hashpartitioning(i_class#27746, 3000), ENSURE_REQUIREMENTS, [id=#28932]
                     +- HashAggregate(keys=[i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741], functions=[sum(ss_ext_sales_price#27727)], output=[i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, itemrevenue#27711, _w0#27790, _w1#27791, i_item_id#27737])
                        +- Exchange hashpartitioning(i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, 3000), ENSURE_REQUIREMENTS, [id=#28929]
                           +- HashAggregate(keys=[i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, knownfloatingpointnormalized(normalizenanandzero(i_current_price#27741)) AS i_current_price#27741], functions=[partial_sum(ss_ext_sales_price#27727)], output=[i_item_id#27737, i_item_desc#27740, i_category#27748, i_class#27746, i_current_price#27741, sum#27801])
                              +- Project [ss_ext_sales_price#27727, i_item_id#27737, i_item_desc#27740, i_current_price#27741, i_class#27746, i_category#27748]
                                 +- SortMergeJoin [ss_item_sk#27714L], [i_item_sk#27736L], Inner
                                    :- Sort [ss_item_sk#27714L ASC NULLS FIRST], false, 0
                                    :  +- Exchange hashpartitioning(ss_item_sk#27714L, 3000), ENSURE_REQUIREMENTS, [id=#28921]
                                    :     +- Project [ss_item_sk#27714L, ss_ext_sales_price#27727]
                                    :        +- BroadcastHashJoin [ss_sold_date_sk#27735L], [d_date_sk#27758L], Inner, BuildRight, false
                                    :           :- Filter isnotnull(ss_item_sk#27714L)
                                    :           :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.store_sales[ss_item_sk#27714L,ss_ext_sales_price#27727,ss_sold_date_sk#27735L] Batched: true, DataFilters: [isnotnull(ss_item_sk#27714L)], Format: ORC, Location: InMemoryFileIndex(1823 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9..., PartitionFilters: [isnotnull(ss_sold_date_sk#27735L), dynamicpruningexpression(ss_sold_date_sk#27735L IN dynamicpru..., PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:bigint,ss_ext_sales_price:double>
                                    :           :        +- SubqueryAdaptiveBroadcast dynamicpruning#27799, 0, true, Project [d_date_sk#27758L], [d_date_sk#27758L]
                                    :           :           +- AdaptiveSparkPlan isFinalPlan=false
                                    :           :              +- Project [d_date_sk#27758L]
                                    :           :                 +- Filter (((isnotnull(d_date#27760) AND (d_date#27760 >= 2001-01-12)) AND (d_date#27760 <= 2001-02-11)) AND isnotnull(d_date_sk#27758L))
                                    :           :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27758L,d_date#27760] Batched: true, DataFilters: [isnotnull(d_date#27760), (d_date#27760 >= 2001-01-12), (d_date#27760 <= 2001-02-11), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                    :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#28916]
                                    :              +- Project [d_date_sk#27758L]
                                    :                 +- Filter (((isnotnull(d_date#27760) AND (d_date#27760 >= 2001-01-12)) AND (d_date#27760 <= 2001-02-11)) AND isnotnull(d_date_sk#27758L))
                                    :                    +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27758L,d_date#27760] Batched: true, DataFilters: [isnotnull(d_date#27760), (d_date#27760 >= 2001-01-12), (d_date#27760 <= 2001-02-11), isnotnull(d..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2001-01-12), LessThanOrEqual(d_date,2001-02-11), Is..., ReadSchema: struct<d_date_sk:bigint,d_date:date>
                                    +- Sort [i_item_sk#27736L ASC NULLS FIRST], false, 0
                                       +- Exchange hashpartitioning(i_item_sk#27736L, 3000), ENSURE_REQUIREMENTS, [id=#28922]
                                          +- Filter (i_category#27748 IN (Jewelry,Sports,Books) AND isnotnull(i_item_sk#27736L))
                                             +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.item[i_item_sk#27736L,i_item_id#27737,i_item_desc#27740,i_current_price#27741,i_class#27746,i_category#27748] Batched: true, DataFilters: [i_category#27748 IN (Jewelry,Sports,Books), isnotnull(i_item_sk#27736L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [In(i_category, [Books,Jewelry,Sports]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:bigint,i_item_id:string,i_item_desc:string,i_current_price:double,i_class:string...

read query: spark_queries/q99.sql
explain query: q99
== Parsed Logical Plan ==
'GlobalLimit 100
+- 'LocalLimit 100
   +- 'Sort ['substr('w_warehouse_name, 1, 20) ASC NULLS FIRST, 'sm_type ASC NULLS FIRST, 'cc_name ASC NULLS FIRST], true
      +- 'Aggregate ['substr('w_warehouse_name, 1, 20), 'sm_type, 'cc_name], [unresolvedalias('substr('w_warehouse_name, 1, 20), None), 'sm_type, 'cc_name, 'sum(CASE WHEN (('cs_ship_date_sk - 'cs_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#27802, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 30) AND (('cs_ship_date_sk - 'cs_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#27803, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 60) AND (('cs_ship_date_sk - 'cs_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#27804, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 90) AND (('cs_ship_date_sk - 'cs_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#27805, 'sum(CASE WHEN (('cs_ship_date_sk - 'cs_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#27806]
         +- 'Filter ((((('d_month_seq >= 1212) AND ('d_month_seq <= (1212 + 11))) AND ('cs_ship_date_sk = 'd_date_sk)) AND ('cs_warehouse_sk = 'w_warehouse_sk)) AND (('cs_ship_mode_sk = 'sm_ship_mode_sk) AND ('cs_call_center_sk = 'cc_call_center_sk)))
            +- 'Join Inner
               :- 'Join Inner
               :  :- 'Join Inner
               :  :  :- 'Join Inner
               :  :  :  :- 'UnresolvedRelation [catalog_sales], [], false
               :  :  :  +- 'UnresolvedRelation [warehouse], [], false
               :  :  +- 'UnresolvedRelation [ship_mode], [], false
               :  +- 'UnresolvedRelation [call_center], [], false
               +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
substr(w_warehouse_name, 1, 20): string, sm_type: string, cc_name: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(w_warehouse_name, 1, 20)#27920 ASC NULLS FIRST, sm_type#27857 ASC NULLS FIRST, cc_name#27867 ASC NULLS FIRST], true
      +- Aggregate [substr(w_warehouse_name#27843, 1, 20), sm_type#27857, cc_name#27867], [substr(w_warehouse_name#27843, 1, 20) AS substr(w_warehouse_name, 1, 20)#27920, sm_type#27857, cc_name#27867, sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= cast(30 as bigint)) THEN 1 ELSE 0 END) AS 30 days#27802L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > cast(30 as bigint)) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= cast(60 as bigint))) THEN 1 ELSE 0 END) AS 31-60 days#27803L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > cast(60 as bigint)) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= cast(90 as bigint))) THEN 1 ELSE 0 END) AS 61-90 days#27804L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > cast(90 as bigint)) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= cast(120 as bigint))) THEN 1 ELSE 0 END) AS 91-120 days#27805L, sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > cast(120 as bigint)) THEN 1 ELSE 0 END) AS >120 days#27806L]
         +- Filter (((((d_month_seq#27895 >= 1212) AND (d_month_seq#27895 <= (1212 + 11))) AND (cs_ship_date_sk#27808L = d_date_sk#27892L)) AND (cs_warehouse_sk#27820L = w_warehouse_sk#27841L)) AND ((cs_ship_mode_sk#27819L = sm_ship_mode_sk#27855L) AND (cs_call_center_sk#27817L = cc_call_center_sk#27861L)))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.catalog_sales
               :  :  :  :  +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#27807L,cs_ship_date_sk#27808L,cs_bill_customer_sk#27809L,cs_bill_cdemo_sk#27810L,cs_bill_hdemo_sk#27811L,cs_bill_addr_sk#27812L,cs_ship_customer_sk#27813L,cs_ship_cdemo_sk#27814L,cs_ship_hdemo_sk#27815L,cs_ship_addr_sk#27816L,cs_call_center_sk#27817L,cs_catalog_page_sk#27818L,cs_ship_mode_sk#27819L,cs_warehouse_sk#27820L,cs_item_sk#27821L,cs_promo_sk#27822L,cs_order_number#27823L,cs_quantity#27824,cs_wholesale_cost#27825,cs_list_price#27826,cs_sales_price#27827,cs_ext_discount_amt#27828,cs_ext_sales_price#27829,cs_ext_wholesale_cost#27830,... 10 more fields] orc
               :  :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.warehouse
               :  :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#27841L,w_warehouse_id#27842,w_warehouse_name#27843,w_warehouse_sq_ft#27844,w_street_number#27845,w_street_name#27846,w_street_type#27847,w_suite_number#27848,w_city#27849,w_county#27850,w_state#27851,w_zip#27852,w_country#27853,w_gmt_offset#27854] orc
               :  :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.ship_mode
               :  :     +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#27855L,sm_ship_mode_id#27856,sm_type#27857,sm_code#27858,sm_carrier#27859,sm_contract#27860] orc
               :  +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.call_center
               :     +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#27861L,cc_call_center_id#27862,cc_rec_start_date#27863,cc_rec_end_date#27864,cc_closed_date_sk#27865L,cc_open_date_sk#27866L,cc_name#27867,cc_class#27868,cc_employees#27869,cc_sq_ft#27870,cc_hours#27871,cc_manager#27872,cc_mkt_id#27873,cc_mkt_class#27874,cc_mkt_desc#27875,cc_market_manager#27876,cc_division#27877,cc_division_name#27878,cc_company#27879,cc_company_name#27880,cc_street_number#27881,cc_street_name#27882,cc_street_type#27883,cc_suite_number#27884,... 7 more fields] orc
               +- SubqueryAlias spark_catalog.spark_tpcds_bin_partitioned_orc_10000.date_dim
                  +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27892L,d_date_id#27893,d_date#27894,d_month_seq#27895,d_week_seq#27896,d_quarter_seq#27897,d_year#27898,d_dow#27899,d_moy#27900,d_dom#27901,d_qoy#27902,d_fy_year#27903,d_fy_quarter_seq#27904,d_fy_week_seq#27905,d_day_name#27906,d_quarter_name#27907,d_holiday#27908,d_weekend#27909,d_following_holiday#27910,d_first_dom#27911,d_last_dom#27912,d_same_day_ly#27913,d_same_day_lq#27914,d_current_day#27915,... 4 more fields] orc

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [substr(w_warehouse_name, 1, 20)#27920 ASC NULLS FIRST, sm_type#27857 ASC NULLS FIRST, cc_name#27867 ASC NULLS FIRST], true
      +- Aggregate [_groupingexpression#27934, sm_type#27857, cc_name#27867], [_groupingexpression#27934 AS substr(w_warehouse_name, 1, 20)#27920, sm_type#27857, cc_name#27867, sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 30) THEN 1 ELSE 0 END) AS 30 days#27802L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 30) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#27803L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 60) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#27804L, sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 90) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#27805L, sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 120) THEN 1 ELSE 0 END) AS >120 days#27806L]
         +- Project [cs_ship_date_sk#27808L, cs_sold_date_sk#27840L, sm_type#27857, cc_name#27867, substr(w_warehouse_name#27843, 1, 20) AS _groupingexpression#27934]
            +- Join Inner, (cs_warehouse_sk#27820L = w_warehouse_sk#27841L)
               :- Project [cs_ship_date_sk#27808L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L, sm_type#27857, cc_name#27867]
               :  +- Join Inner, (cs_call_center_sk#27817L = cc_call_center_sk#27861L)
               :     :- Project [cs_ship_date_sk#27808L, cs_call_center_sk#27817L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L, sm_type#27857]
               :     :  +- Join Inner, (cs_ship_mode_sk#27819L = sm_ship_mode_sk#27855L)
               :     :     :- Project [cs_ship_date_sk#27808L, cs_call_center_sk#27817L, cs_ship_mode_sk#27819L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L]
               :     :     :  +- Join Inner, (cs_ship_date_sk#27808L = d_date_sk#27892L)
               :     :     :     :- Project [cs_ship_date_sk#27808L, cs_call_center_sk#27817L, cs_ship_mode_sk#27819L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L]
               :     :     :     :  +- Filter ((isnotnull(cs_warehouse_sk#27820L) AND isnotnull(cs_ship_mode_sk#27819L)) AND (isnotnull(cs_call_center_sk#27817L) AND isnotnull(cs_ship_date_sk#27808L)))
               :     :     :     :     +- Relation spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_sold_time_sk#27807L,cs_ship_date_sk#27808L,cs_bill_customer_sk#27809L,cs_bill_cdemo_sk#27810L,cs_bill_hdemo_sk#27811L,cs_bill_addr_sk#27812L,cs_ship_customer_sk#27813L,cs_ship_cdemo_sk#27814L,cs_ship_hdemo_sk#27815L,cs_ship_addr_sk#27816L,cs_call_center_sk#27817L,cs_catalog_page_sk#27818L,cs_ship_mode_sk#27819L,cs_warehouse_sk#27820L,cs_item_sk#27821L,cs_promo_sk#27822L,cs_order_number#27823L,cs_quantity#27824,cs_wholesale_cost#27825,cs_list_price#27826,cs_sales_price#27827,cs_ext_discount_amt#27828,cs_ext_sales_price#27829,cs_ext_wholesale_cost#27830,... 10 more fields] orc
               :     :     :     +- Project [d_date_sk#27892L]
               :     :     :        +- Filter ((isnotnull(d_month_seq#27895) AND ((d_month_seq#27895 >= 1212) AND (d_month_seq#27895 <= 1223))) AND isnotnull(d_date_sk#27892L))
               :     :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27892L,d_date_id#27893,d_date#27894,d_month_seq#27895,d_week_seq#27896,d_quarter_seq#27897,d_year#27898,d_dow#27899,d_moy#27900,d_dom#27901,d_qoy#27902,d_fy_year#27903,d_fy_quarter_seq#27904,d_fy_week_seq#27905,d_day_name#27906,d_quarter_name#27907,d_holiday#27908,d_weekend#27909,d_following_holiday#27910,d_first_dom#27911,d_last_dom#27912,d_same_day_ly#27913,d_same_day_lq#27914,d_current_day#27915,... 4 more fields] orc
               :     :     +- Project [sm_ship_mode_sk#27855L, sm_type#27857]
               :     :        +- Filter isnotnull(sm_ship_mode_sk#27855L)
               :     :           +- Relation spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#27855L,sm_ship_mode_id#27856,sm_type#27857,sm_code#27858,sm_carrier#27859,sm_contract#27860] orc
               :     +- Project [cc_call_center_sk#27861L, cc_name#27867]
               :        +- Filter isnotnull(cc_call_center_sk#27861L)
               :           +- Relation spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#27861L,cc_call_center_id#27862,cc_rec_start_date#27863,cc_rec_end_date#27864,cc_closed_date_sk#27865L,cc_open_date_sk#27866L,cc_name#27867,cc_class#27868,cc_employees#27869,cc_sq_ft#27870,cc_hours#27871,cc_manager#27872,cc_mkt_id#27873,cc_mkt_class#27874,cc_mkt_desc#27875,cc_market_manager#27876,cc_division#27877,cc_division_name#27878,cc_company#27879,cc_company_name#27880,cc_street_number#27881,cc_street_name#27882,cc_street_type#27883,cc_suite_number#27884,... 7 more fields] orc
               +- Project [w_warehouse_sk#27841L, w_warehouse_name#27843]
                  +- Filter isnotnull(w_warehouse_sk#27841L)
                     +- Relation spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#27841L,w_warehouse_id#27842,w_warehouse_name#27843,w_warehouse_sq_ft#27844,w_street_number#27845,w_street_name#27846,w_street_type#27847,w_suite_number#27848,w_city#27849,w_county#27850,w_state#27851,w_zip#27852,w_country#27853,w_gmt_offset#27854] orc

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#27920 ASC NULLS FIRST,sm_type#27857 ASC NULLS FIRST,cc_name#27867 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#27920,sm_type#27857,cc_name#27867,30 days#27802L,31-60 days#27803L,61-90 days#27804L,91-120 days#27805L,>120 days#27806L])
   +- HashAggregate(keys=[_groupingexpression#27934, sm_type#27857, cc_name#27867], functions=[sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 30) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 60) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 90) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#27920, sm_type#27857, cc_name#27867, 30 days#27802L, 31-60 days#27803L, 61-90 days#27804L, 91-120 days#27805L, >120 days#27806L])
      +- Exchange hashpartitioning(_groupingexpression#27934, sm_type#27857, cc_name#27867, 3000), ENSURE_REQUIREMENTS, [id=#29050]
         +- HashAggregate(keys=[_groupingexpression#27934, sm_type#27857, cc_name#27867], functions=[partial_sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 30) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 60) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 90) AND ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((cs_ship_date_sk#27808L - cs_sold_date_sk#27840L) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#27934, sm_type#27857, cc_name#27867, sum#27940L, sum#27941L, sum#27942L, sum#27943L, sum#27944L])
            +- Project [cs_ship_date_sk#27808L, cs_sold_date_sk#27840L, sm_type#27857, cc_name#27867, substr(w_warehouse_name#27843, 1, 20) AS _groupingexpression#27934]
               +- BroadcastHashJoin [cs_warehouse_sk#27820L], [w_warehouse_sk#27841L], Inner, BuildRight, false
                  :- Project [cs_ship_date_sk#27808L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L, sm_type#27857, cc_name#27867]
                  :  +- BroadcastHashJoin [cs_call_center_sk#27817L], [cc_call_center_sk#27861L], Inner, BuildRight, false
                  :     :- Project [cs_ship_date_sk#27808L, cs_call_center_sk#27817L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L, sm_type#27857]
                  :     :  +- BroadcastHashJoin [cs_ship_mode_sk#27819L], [sm_ship_mode_sk#27855L], Inner, BuildRight, false
                  :     :     :- Project [cs_ship_date_sk#27808L, cs_call_center_sk#27817L, cs_ship_mode_sk#27819L, cs_warehouse_sk#27820L, cs_sold_date_sk#27840L]
                  :     :     :  +- BroadcastHashJoin [cs_ship_date_sk#27808L], [d_date_sk#27892L], Inner, BuildRight, false
                  :     :     :     :- Filter (((isnotnull(cs_warehouse_sk#27820L) AND isnotnull(cs_ship_mode_sk#27819L)) AND isnotnull(cs_call_center_sk#27817L)) AND isnotnull(cs_ship_date_sk#27808L))
                  :     :     :     :  +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.catalog_sales[cs_ship_date_sk#27808L,cs_call_center_sk#27817L,cs_ship_mode_sk#27819L,cs_warehouse_sk#27820L,cs_sold_date_sk#27840L] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#27820L), isnotnull(cs_ship_mode_sk#27819L), isnotnull(cs_call_center_s..., Format: ORC, Location: CatalogFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000/..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_ship_date_sk:bigint,cs_call_center_sk:bigint,cs_ship_mode_sk:bigint,cs_warehouse_sk:big...
                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, true]),false), [id=#29033]
                  :     :     :        +- Project [d_date_sk#27892L]
                  :     :     :           +- Filter (((isnotnull(d_month_seq#27895) AND (d_month_seq#27895 >= 1212)) AND (d_month_seq#27895 <= 1223)) AND isnotnull(d_date_sk#27892L))
                  :     :     :              +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.date_dim[d_date_sk#27892L,d_month_seq#27895] Batched: true, DataFilters: [isnotnull(d_month_seq#27895), (d_month_seq#27895 >= 1212), (d_month_seq#27895 <= 1223), isnotnul..., Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_date_sk:bigint,d_month_seq:int>
                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#29037]
                  :     :        +- Filter isnotnull(sm_ship_mode_sk#27855L)
                  :     :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.ship_mode[sm_ship_mode_sk#27855L,sm_type#27857] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#27855L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:bigint,sm_type:string>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#29041]
                  :        +- Filter isnotnull(cc_call_center_sk#27861L)
                  :           +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.call_center[cc_call_center_sk#27861L,cc_name#27867] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#27861L)], Format: ORC, Location: InMemoryFileIndex(1 paths)[hdfs://master-1-1.c-c0b1b51568050168.cn-hangzhou.emr.aliyuncs.com:9000..., PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:bigint,cc_name:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, bigint, false]),false), [id=#29045]
                     +- Filter isnotnull(w_warehouse_sk#27841L)
                        +- FileScan orc spark_tpcds_bin_partitioned_orc_10000.warehouse[w_warehouse_sk#27841L,w_warehouse_name#27843] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#27841L)], Format: ORC, Loc